/**
 * @version 1.0.0.0
 * @copyright Copyright Â©  2017
 * @compiler Bridge.NET 16.3.0
 */
Bridge.assembly("CirnoGame", function ($asm, globals) {
    "use strict";

    Bridge.define("CirnoGame.GameMode", {
        statics: {
            fields: {
                TeamBattle: null,
                DeathMatch: null,
                gameModes: null
            },
            ctors: {
                init: function () {
                    Bridge.ready(this.init);
                }
            },
            methods: {
                GetGameModesOfType: function (type) {
                    return new (System.Collections.Generic.List$1(CirnoGame.GameMode)).$ctor1(System.Linq.Enumerable.from(CirnoGame.GameMode.gameModes).where(function (G) {
                            return G.ModeType === type;
                        }));
                },
                GetGameModeByName: function (name) {
                    var ret = new (System.Collections.Generic.List$1(CirnoGame.GameMode)).$ctor1(System.Linq.Enumerable.from(CirnoGame.GameMode.gameModes).where(function (G) {
                            return Bridge.referenceEquals(G.Name, name);
                        }));
                    if (ret.Count > 0) {
                        return ret.getItem(0);
                    }
                    return null;
                },
                init: function () {
                    if (CirnoGame.GameMode.TeamBattle == null) {
                        CirnoGame.GameMode.gameModes = new (System.Collections.Generic.List$1(CirnoGame.GameMode)).ctor();
                        CirnoGame.GameMode.TeamBattle = new CirnoGame.GameMode("Team Battle");
                        CirnoGame.GameMode.TeamBattle.Description = "2 teams battle with limited lives\nuntil only 1 team remains.";
                        CirnoGame.GameMode.DeathMatch = new CirnoGame.GameMode("Death Match");
                        CirnoGame.GameMode.DeathMatch.Description = "A free for all match with\nlimited lives.";
                        CirnoGame.GameMode.DeathMatch.Teams = false;
                    }
                }
            }
        },
        $entryPoint: true,
        props: {
            Teams: false,
            StartingLives: 0,
            Survival: false,
            AllowOnlinePlay: false,
            AllowCharacterSelect: false,
            NumberOfPlayers: 0,
            RespawnTime: 0,
            Name: null,
            ModeType: 0,
            unlocked: false,
            Description: null
        },
        ctors: {
            ctor: function (name) {
                this.$initialize();
                this.Teams = true;
                this.StartingLives = 3;
                this.Survival = true;
                this.AllowOnlinePlay = true;
                this.AllowCharacterSelect = true;
                this.NumberOfPlayers = 6;
                this.RespawnTime = 390;
                this.Name = name;
                this.ModeType = CirnoGame.GameMode.ModeTypes.Skirmish;
                this.Description = System.String.concat("Missing description for ", name);
                this.unlocked = true;
                CirnoGame.GameMode.gameModes.add(this);
            }
        }
    });

    Bridge.define("CirnoGame.EntityBehavior", {
        fields: {
            enabled: false,
            FramesPerTick: 0,
            entity: null
        },
        props: {
            BehaviorName: null
        },
        ctors: {
            init: function () {
                this.enabled = true;
                this.FramesPerTick = 0;
            },
            ctor: function (entity) {
                this.$initialize();
                this.entity = entity;
                if (Bridge.referenceEquals(this.BehaviorName, "") || this.BehaviorName == null) {
                    var test = Bridge.getType(this);
                    var FN = test["$$fullname"];
                    //Helper.Log("FN:" + FN);
                    var s = FN.split(".");
                    this.BehaviorName = s[System.Array.index(((s.length - 1) | 0), s)];
                    //BehaviorName = GetType().FullName;
                    //GetType().GetClassName

                }
            }
        },
        methods: {
            Update: function () {

            },
            Draw: function (g) { },
            SendCustomEvent: function (evt, triggerflush) {
                if (triggerflush === void 0) { triggerflush = false; }
                var D = { };
                D.I = this.entity.ID;
                D.D = evt;
                //D.T = this.GetType().FullName;
                D.T = this.BehaviorName;
                this.entity.Game.SendEvent("CBE", D, triggerflush);
            },
            CustomEvent: function (evt) {

            }
        }
    });

    Bridge.define("CirnoGame.Animation", {
        fields: {
            Images: null,
            _currentImage: null,
            CurrentFrame: 0,
            ImageSpeed: 0,
            Position: null,
            AnimationTimeElapsed: 0,
            StretchWidth: 0,
            StretchHeight: 0,
            Rotation: 0,
            Alpha: 0,
            Looping: false,
            Looped: false,
            FrameChanged: false,
            Flipped: false,
            _transformed: false,
            _shadow: 0,
            _shadowColor: null,
            BufferNeedsRedraw: false,
            _hueColor: null,
            _hueRecolorStrength: 0,
            _buffer: null,
            _bg: null
        },
        props: {
            CurrentImage: {
                get: function () {
                    return this._currentImage;
                },
                set: function (value) {
                    if (!Bridge.referenceEquals(this._currentImage, value)) {
                        this.BufferNeedsRedraw = true;
                    }
                    this._currentImage = value;

                }
            },
            X: {
                get: function () {
                    return this.Position.X;
                },
                set: function (value) {
                    this.Position.X = value;
                }
            },
            Y: {
                get: function () {
                    return this.Position.Y;
                },
                set: function (value) {
                    this.Position.Y = value;
                }
            },
            Shadow: {
                get: function () {
                    return this._shadow;
                },
                set: function (value) {
                    if (this._shadow !== value) {
                        this._shadow = value;
                        this.BufferNeedsRedraw = true;
                    }
                }
            },
            Shadowcolor: {
                get: function () {
                    return this._shadowColor;
                },
                set: function (value) {
                    if (!Bridge.referenceEquals(this._shadowColor, value)) {
                        this._shadowColor = value;
                        this.BufferNeedsRedraw = true;
                    }
                }
            },
            HueColor: {
                get: function () {
                    return this._hueColor;
                },
                set: function (value) {
                    if (!Bridge.referenceEquals(this._hueColor, value)) {
                        this.BufferNeedsRedraw = true;
                    }
                    this._hueColor = value;

                }
            },
            HueRecolorStrength: {
                get: function () {
                    return this._hueRecolorStrength;
                },
                set: function (value) {
                    if (this._hueRecolorStrength !== value) {
                        this.BufferNeedsRedraw = true;
                    }
                    this._hueRecolorStrength = value;
                }
            }
        },
        ctors: {
            init: function () {
                this.StretchWidth = 0;
                this.StretchHeight = 0;
                this.Rotation = 0;
                this.Alpha = 1;
                this.Looping = true;
                this.Looped = false;
                this.FrameChanged = false;
                this.Flipped = false;
                this._transformed = false;
                this.BufferNeedsRedraw = true;
            },
            ctor: function (data) {
                this.$initialize();
                this.Images = data;
                if (this.Images == null) {
                    this.Images = new (System.Collections.Generic.List$1(HTMLImageElement)).ctor();
                }
                this.ImageSpeed = 1.0;
                this.Position = new CirnoGame.Vector2();
                this.AnimationTimeElapsed = 0;
                this.Shadow = 0;
                this.Shadowcolor = "#FFFFFF";
                this.HueColor = "";
                this.HueRecolorStrength = 0.6;
                this._buffer = document.createElement("canvas");
                this._bg = this._buffer.getContext("2d");
                if (this.Images.Count > 0) {
                    this.SetImage();
                }
            }
        },
        methods: {
            Update: function () {
                var LI = this.CurrentImage;
                var last = Bridge.Int.clip32(this.CurrentFrame);
                this.CurrentFrame += this.ImageSpeed;
                var current = Bridge.Int.clip32(this.CurrentFrame);
                if (current !== last) {
                    if (this.Images.Count > 0) {
                        while (current >= this.Images.Count && current > 0) {
                            if (this.Looping) {
                                current = (current - this.Images.Count) | 0;
                                this.CurrentFrame -= this.Images.Count;
                            } else {
                                this.CurrentFrame -= this.ImageSpeed;
                            }
                        }
                        while (current < 0) {
                            current = (current + this.Images.Count) | 0;
                            this.CurrentFrame += this.Images.Count;
                        }
                    }
                    this.SetImage();
                }

                this.Looped = false;
                if (!Bridge.referenceEquals(LI, this.CurrentImage)) {
                    this.FrameChanged = true;
                    if ((this.ImageSpeed > 0 && current === 0) || ((this.ImageSpeed < 0 && current === ((this.Images.Count - 1) | 0)))) {
                        this.Looped = true;
                    }
                } else {
                    this.FrameChanged = false;
                }
                this.AnimationTimeElapsed = (this.AnimationTimeElapsed + 1) | 0;
            },
            ChangeAnimation: function (ani, reset) {
                if (reset === void 0) { reset = true; }
                if (reset) {
                    this.CurrentFrame = 0;
                    this.AnimationTimeElapsed = 0;
                }
                this.Images = ani;
                //CurrentImage = Images[(int)CurrentFrame];
                this.SetImage();
            },
            SetImage: function () {
                if (this.Images.Count < 2) {
                    this.CurrentFrame = 0;
                } else {
                    var ln = this.Images.Count;
                    while (this.CurrentFrame < 0) {
                        this.CurrentFrame += ln;
                    }
                    while (this.CurrentFrame >= ln) {
                        this.CurrentFrame -= ln;
                    }
                }
                var current = Bridge.Int.clip32(this.CurrentFrame);
                if (current >= 0 && current < this.Images.Count) {
                    this.CurrentImage = this.Images.getItem(current);
                }
            },
            Draw: function (g) {
                this.Draw$1(g, this.Position);
            },
            Draw$1: function (g, position) {
                var x = position.X;
                var y = position.Y;
                if (this.CurrentImage == null) {
                    var current = Bridge.Int.clip32(this.CurrentFrame);
                    if (current >= 0 && current < this.Images.Count) {
                        this.CurrentImage = this.Images.getItem(current);
                    }
                    if (this.CurrentImage == null) {
                        return;
                    }
                }
                var X = x;
                var Y = y;
                var lastalpha = g.globalAlpha;
                var centered = false;
                var useBuffer = false;
                if (!Bridge.referenceEquals(this.HueColor, "")) {
                    if (this.BufferNeedsRedraw) {
                        var adv = true;
                        this._bg.globalCompositeOperation = "source-over";
                        this._buffer.width = this.CurrentImage.width;
                        this._buffer.height = this.CurrentImage.height;
                        this._bg.drawImage(this.CurrentImage, 0.0, 0.0);
                        this._bg.globalAlpha = this.HueRecolorStrength;
                        this._bg.globalCompositeOperation = "hue";
                        this._bg.fillStyle = this.HueColor;
                        this._bg.fillRect(0, 0, this._buffer.width, this._buffer.height);

                        if (adv) {
                            this._bg.globalAlpha = (1 + this.HueRecolorStrength) / 2.0;
                            this._bg.globalCompositeOperation = "source-over";
                            this._bg.fillRect(0, 0, this._buffer.width, this._buffer.height);
                        }

                        this._bg.globalAlpha = 1;
                        if (adv) {
                            this._bg.globalCompositeOperation = "luminosity";
                            this._bg.drawImage(this.CurrentImage, 0.0, 0.0);
                        }
                        this._bg.globalCompositeOperation = 'destination-in';
                        this._bg.drawImage(this.CurrentImage, 0.0, 0.0);
                        if (adv) {
                            this._bg.globalCompositeOperation = "hue";
                            this._bg.globalAlpha = this.HueRecolorStrength * 0.4;
                            this._bg.drawImage(this.CurrentImage, 0.0, 0.0);
                        }

                    }
                    useBuffer = true;
                }
                if (this.Alpha < 1) {
                    if (this.Alpha <= 0) {
                        return;
                    }
                    g.globalAlpha = g.globalAlpha * this.Alpha;
                }
                //if (rotation != 0)
                {
                    var x2 = this.CurrentImage.width / 2.0;
                    var y2 = this.CurrentImage.height / 2.0;

                    X = -x2;
                    Y = -y2;
                    if (!this._transformed) {
                        g.save();
                        this._transformed = true;
                    }
                    g.translate(x + x2, y + y2);
                    centered = true;
                    g.rotate(this.Rotation);
                }
                if (this.Flipped) {
                    if (!this._transformed) {
                        g.save();
                        this._transformed = true;
                    }
                    g.scale(-1, 1);
                    //don't translate if it's centered.
                    if (!centered) {
                        g.translate(this.CurrentImage.width, 0);
                    }
                }
                if (this.Shadow > 0) {
                    g.shadowBlur = this.Shadow;
                    g.shadowColor = this.Shadowcolor;
                    if (!useBuffer && this.BufferNeedsRedraw) {
                        this._bg.shadowBlur = 0;
                        this._buffer.width = this.CurrentImage.width;
                        this._buffer.height = this.CurrentImage.height;
                        this._bg.drawImage(this.CurrentImage, 0.0, 0.0);
                        useBuffer = true;
                        //BufferNeedsRedraw = true;
                    }
                    useBuffer = true;
                    //if ((useBuffer && BufferNeedsRedraw) || Rotation!=0 || true)
                    if (this.BufferNeedsRedraw) {
                        var C = CirnoGame.Helper.CloneCanvas(this._buffer);
                        var CG = CirnoGame.Helper.GetContext(C);
                        this._buffer.width = (this._buffer.width + Bridge.Int.clip32(this.Shadow * 2)) | 0;
                        this._buffer.height = (this._buffer.height + Bridge.Int.clip32(this.Shadow * 2)) | 0;
                        this._bg.shadowBlur = this.Shadow;
                        this._bg.shadowColor = this.Shadowcolor;
                        this.drawWithShadows(this._bg, C, this.Shadow, this.Shadow, 0, 0, this.Shadow / 3.0);
                        useBuffer = true;
                    }
                    X -= this.Shadow;
                    Y -= this.Shadow;
                    g.shadowBlur = 0;
                }

                if (this.StretchWidth === 0 && this.StretchHeight === 0) {
                    if (this.Shadow > 0 && false) {
                        var I = this.CurrentImage;
                        if (useBuffer) {
                            I = this._buffer;
                        }
                        this.drawWithShadows(g, I, X, Y, 0, 0, this.Shadow / 3);
                    } else {
                        if (!useBuffer) {
                            g.drawImage(this.CurrentImage, X, Y);
                        } else {
                            g.drawImage(this._buffer, X, Y);
                        }
                    }
                } else {
                    if (this.Shadow > 0 && false) {
                        var I1 = this.CurrentImage;
                        if (useBuffer) {
                            I1 = this._buffer;
                        }
                        this.drawWithShadows(g, I1, X, Y, this.StretchWidth, this.StretchHeight, this.Shadow / 3);
                    } else {
                        if (!useBuffer) {
                            g.drawImage(this.CurrentImage, X, Y, this.StretchWidth, this.StretchHeight);
                        } else {
                            g.drawImage(this._buffer, X, Y, this.StretchWidth, this.StretchHeight);
                        }
                    }
                }
                if (this._transformed) {
                    g.restore();
                    this._transformed = false;
                }
                if (this.Shadow > 0) {
                    g.shadowBlur = 0;
                }
                if (this.Alpha < 1) {
                    g.globalAlpha = lastalpha;
                }
                this.BufferNeedsRedraw = false;
            },
            drawWithShadows: function (g, I, X, Y, W, H, size) {
                if (W === 0) {
                    W = I.width;
                    H = I.height;
                }
                g.shadowOffsetX = -size;
                g.drawImage(I, X, Y, W, H);
                g.shadowOffsetX = size;
                g.drawImage(I, X, Y, W, H);
                g.shadowOffsetX = 0;
                g.shadowOffsetY = -size;
                g.drawImage(I, X, Y, W, H);
                g.shadowOffsetY = size;
                g.drawImage(I, X, Y, W, H);

                g.shadowOffsetY = 0;
            }
        }
    });

    Bridge.define("CirnoGame.AnimationLoader", {
        statics: {
            fields: {
                __this: null
            },
            props: {
                _this: {
                    get: function () {
                        if (CirnoGame.AnimationLoader.__this == null) {
                            CirnoGame.AnimationLoader.__this = new CirnoGame.AnimationLoader();
                            throw new System.Exception("Animation loader not initiated.");
                        }
                        return CirnoGame.AnimationLoader.__this;
                    }
                }
            },
            methods: {
                Init: function (Archive) {
                    CirnoGame.AnimationLoader.__this = new CirnoGame.AnimationLoader();
                    CirnoGame.AnimationLoader.__this.Archive = Archive;
                },
                Get: function (ani) {
                    return CirnoGame.AnimationLoader._this.GetAnimation(ani);
                }
            }
        },
        fields: {
            _data: null,
            Archive: null
        },
        ctors: {
            ctor: function () {
                this.$initialize();
                this._data = new (System.Collections.Generic.Dictionary$2(System.String,System.Collections.Generic.List$1(HTMLImageElement)))();
            }
        },
        methods: {
            GetAnimation: function (ani) {
                if (this._data.containsKey(ani)) {
                    return this._data.get(ani);
                }
                var A = new (System.Collections.Generic.List$1(HTMLImageElement)).ctor();
                var I = this.Archive.GetImage(System.String.concat(ani, ".png"));
                if (I != null) {
                    A.add(I);
                } else {
                    var j = 0;
                    var Sani = System.String.concat(ani, "_");
                    while (true) {
                        I = this.Archive.GetImage(System.String.concat(Sani, (Bridge.identity(j, (j = (j + 1) | 0))), ".png"));
                        if (I == null) {
                            break;
                        } else {
                            A.add(I);
                        }
                    }
                    /* do
                    {
                       I = Archive.GetImage(ani + "_" + j + ".png");
                       if (I != null)
                       {
                           A.Add(I);
                       }
                    } while (I != null);*/
                }
                this._data.set(ani, A);
                return A;
            }
        }
    });

    Bridge.define("CirnoGame.App", {
        main: function Main () {
            //USE THE JSON ZIP ARCHIVE FEATURE FROM BNTEST FOR LOADING IMAGES AND FILES.

            document.body.style.cssText = "overflow: hidden;margin: 0;padding: 0;";
            CirnoGame.GamePadManager._this = new CirnoGame.GamePadManager();
            CirnoGame.GamePadManager._this.Update();
            Bridge.global.setTimeout(function () {
                CirnoGame.GamePadManager._this.Update();

                CirnoGame.App.IC = CirnoGame.InputControllerManager._this.Controllers.getItem(0);
                var IM = CirnoGame.InputControllerManager._this.Controllers.getItem(0).InputMapping.getItem(2);

            }, 5);

            var ok = false;
            var uptest = true;
            CirnoGame.JSONArchive.Open("Assets/Images.JSON", function (json) {
                CirnoGame.App.JSON = json;

                CirnoGame.App.JSON.PreloadImages(function () {
                    ok = true;
                    CirnoGame.App.Finish();
                });
            });

            // After building (Ctrl + Shift + B) this project, 
            // browse to the /bin/Debug or /bin/Release folder.

            // A new bridge/ folder is created and contains
            // your projects JavaScript files. 

            // Open the bridge/index.html file in a brower by
            // Right-Click > Open With..., then choose a
            // web browser from the list

            // This application will then run in a browser.


        },
        statics: {
            fields: {
                Frame: 0,
                Div: null,
                Canvas: null,
                ScreenBounds: null,
                JSON: null,
                G: null,
                TargetAspect: 0,
                _lSize: 0,
                _missingTime: 0,
                _lTime: 0,
                totalTime: 0,
                _frameRendered: false,
                _gameRendered: false,
                IC: null,
                CurrentView: null,
                GameName: null,
                GameVersion: null,
                DEBUG: false
            },
            ctors: {
                init: function () {
                    this.Frame = 0;
                    this._lSize = -1;
                    this._missingTime = 0;
                    this._lTime = -1;
                    this._frameRendered = false;
                    this._gameRendered = false;
                    this.GameName = "Cirno's Mysterious Tower";
                    this.GameVersion = "0.3";
                    this.DEBUG = false;
                }
            },
            methods: {
                Finish: function () {
                    CirnoGame.AnimationLoader.Init(CirnoGame.App.JSON);
                    var LT = document.getElementById("loadtext");
                    LT.textContent = "";
                    document.body.style.cursor = "auto";
                    document.title = System.String.concat(CirnoGame.App.GameName, " ", CirnoGame.App.GameVersion, " by:RSGmaker");
                    //var R = new Renderer();
                    //Document.Body.AppendChild(R.view);

                    CirnoGame.App.Div = document.createElement("div");
                    var Canv = document.createElement("canvas");
                    CirnoGame.App.Canvas = Canv;
                    CirnoGame.App.TargetAspect = 0.75;
                    Canv.width = 1024;
                    Canv.height = Bridge.Int.clip32(Canv.width * CirnoGame.App.TargetAspect);
                    CirnoGame.App.ScreenBounds = new CirnoGame.Rectangle(0, 0, Canv.width, Canv.height);

                    CirnoGame.App.Div.appendChild(Canv);
                    document.body.appendChild(CirnoGame.App.Div);
                    //Document.Body.AppendChild(Canv);
                    CirnoGame.App.G = CirnoGame.App.Canvas.getContext("2d");

                    CirnoGame.App.G.imageSmoothingEnabled = false;
                    CirnoGame.App.Canvas.style.imageRendering = "pixelated";
                    var gg = CirnoGame.App.G;
                    gg.webkitImageSmoothingEnabled = false;
                    gg.mozImageSmoothingEnabled = false;


                    CirnoGame.KeyboardManager.Init();

                    CirnoGame.App.CurrentView = new CirnoGame.Game();

                    var OnF = CirnoGame.App.RAF;
                    requestAnimationFrame(OnF);
                },
                updateWindow: function () {
                    var size = Math.ceil(window.innerHeight * (1 / CirnoGame.App.TargetAspect));
                    if (size !== CirnoGame.App._lSize) {
                        CirnoGame.App.Canvas.style.width = "100%";
                        CirnoGame.App.Div.style.width = System.Double.format(size) + "px";

                        CirnoGame.App.Div.style.position = "relative";
                        CirnoGame.App.Div.style.left = System.Double.format(((((Bridge.Int.div(window.innerWidth, 2)) | 0)) - (size / 2))) + "px";
                        size = CirnoGame.App._lSize;
                    }
                },
                UpdateInputs: function () {
                    if (CirnoGame.App.IC != null) {
                        var L = CirnoGame.InputControllerManager._this.Controllers;
                        if (L.Count > 1) {
                            /* List<int> keys = KeyboardManager._this.TappedButtons;
                            if (keys.Contains(107))
                            {
                               int index = L.IndexOf(IC);
                               index++;
                               if (index >= L.Count)
                               {
                                   index -= L.Count;
                               }
                               IC = L[index];
                            }
                            if (keys.Contains(109))
                            {
                               int index = L.IndexOf(IC);
                               index--;
                               if (index < 0)
                               {
                                   index += L.Count;
                               }
                               IC = L[index];
                            }*/
                        }
                    }
                    CirnoGame.KeyboardManager.Update();
                },
                Update: function (time) {
                    var delta = 0;
                    CirnoGame.App.totalTime = time;
                    if (time >= 0) {
                        if (CirnoGame.App._lTime < 0) {
                            CirnoGame.App._lTime = time;
                        } else {
                            //missingTime -= 16.666666666666666666666666666667;
                        }
                        delta = (time - CirnoGame.App._lTime);
                        CirnoGame.App._missingTime += (delta);
                        if (Bridge.is(CirnoGame.App.CurrentView, CirnoGame.Game)) {
                            var G = Bridge.cast(CirnoGame.App.CurrentView, CirnoGame.Game);
                            if (G.running) {
                                G.totalTime += delta;
                                if (G.timeRemaining > 0) {
                                    G.timeRemaining -= delta;
                                }
                                if (G.timeRemaining <= 0) {
                                    G.timeRemaining = 0;
                                }
                            }
                        }
                    }
                    CirnoGame.App.updateWindow();
                    /* if (delta > 22)
                    {
                       Lagging = true;
                    }*/

                    if (CirnoGame.App._missingTime > 12) {
                        if (CirnoGame.App.CurrentView != null) {
                            CirnoGame.App.CurrentView.Update();
                        }

                        CirnoGame.App._missingTime -= 16.666666666666668;
                        CirnoGame.App._frameRendered = false;
                        CirnoGame.App._gameRendered = false;

                    } else {
                        CirnoGame.App._lTime = time;
                        return;
                    }
                    if (time >= 0) {
                        if (CirnoGame.App._missingTime >= 3000) {
                            CirnoGame.App._missingTime = 0;
                        }
                        if (CirnoGame.App._missingTime >= 10000) {
                            //Game is lagging too much to properly play multiplayer.
                        }
                        var T = 16.666666666666668;
                        if (true) {
                            T += 8;
                        }
                        while (CirnoGame.App._missingTime >= T) {
                            if (CirnoGame.App.CurrentView != null) {
                                CirnoGame.App.CurrentView.Update();
                            }
                            CirnoGame.App._missingTime -= 16.666666666666668;
                        }
                    }
                    //game.Draw(g);
                    CirnoGame.App._lTime = time;
                    CirnoGame.App.Frame = (CirnoGame.App.Frame + 1) | 0;
                    CirnoGame.HelperExtensions.Clear(CirnoGame.App.G);
                    CirnoGame.GamePadManager._this.Update();
                    if (CirnoGame.App.CurrentView != null) {

                        CirnoGame.App.CurrentView.Update();
                        CirnoGame.App.CurrentView.Render();
                        CirnoGame.App.G.drawImage(CirnoGame.App.CurrentView.spriteBuffer, 0.0, 0.0, CirnoGame.App.Canvas.width, CirnoGame.App.Canvas.height);
                    }
                    //G.FillStyle = ""+Convert. Frame;
                    //G.FillStyle = "#" + Frame.ToString("X6");
                    /* G.FillStyle = "#" + ColorFromAhsb(1,(Frame/2) % 360,0.8f,0.7f).ToString("X6");
                    G.FillRect(0, 0, G.Canvas.Width, G.Canvas.Height);

                    G.FillStyle = "red";
                    var x = ((0 + Frame * 3) % (G.Canvas.Width + 100)) - 100;
                    var y = ((0 + Frame) % (G.Canvas.Height + 100)) - 100;
                    //G.FillRect(x, y, 100, 100);

                    var V = JSON.Images.Values.ToArray();

                    var img = V[(Frame/10) % V.Length];
                    G.DrawImage(img, x, y,img.Width*4,img.Height * 4);*/
                    CirnoGame.App.UpdateInputs();
                },
                RAF: function () {

                    var OnF = CirnoGame.App.RAF;
                    requestAnimationFrame(OnF);
                    var time = Bridge.global.performance.now();
                    CirnoGame.App.Update(time);
                },
                ColorFromAhsb: function (a, h, s, b) {

                    /* if (0 > a || 255 < a)
                    {
                       throw new ArgumentOutOfRangeException("a", a,
                         Properties.Resources.InvalidAlpha);
                    }
                    if (0f > h || 360f < h)
                    {
                       throw new ArgumentOutOfRangeException("h", h,
                         Properties.Resources.InvalidHue);
                    }
                    if (0f > s || 1f < s)
                    {
                       throw new ArgumentOutOfRangeException("s", s,
                         Properties.Resources.InvalidSaturation);
                    }
                    if (0f > b || 1f < b)
                    {
                       throw new ArgumentOutOfRangeException("b", b,
                         Properties.Resources.InvalidBrightness);
                    }*/

                    if (0 === s) {
                        //return CreateShade(b / 255.0);
                        //return 0x808080;
                        var shade = Bridge.Int.clip32(b / 255.0);
                        return CirnoGame.App.RGBToInt(shade, shade, shade);
                    }

                    var fMax, fMid, fMin;
                    var iSextant, iMax, iMid, iMin;

                    if (0.5 < b) {
                        fMax = b - (b * s) + s;
                        fMin = b + (b * s) - s;
                    } else {
                        fMax = b + (b * s);
                        fMin = b - (b * s);
                    }

                    iSextant = Bridge.Int.clip32(Math.floor(h / 60.0));
                    if (300.0 <= h) {
                        h -= 360.0;
                    }
                    h /= 60.0;
                    h -= 2.0 * Math.floor(((iSextant + 1.0) % 6.0) / 2.0);
                    if (0 === iSextant % 2) {
                        fMid = h * (fMax - fMin) + fMin;
                    } else {
                        fMid = fMin - h * (fMax - fMin);
                    }

                    iMax = System.Convert.toInt32(Bridge.box(fMax * 255, System.Single, System.Single.format, System.Single.getHashCode));
                    iMid = System.Convert.toInt32(Bridge.box(fMid * 255, System.Single, System.Single.format, System.Single.getHashCode));
                    iMin = System.Convert.toInt32(Bridge.box(fMin * 255, System.Single, System.Single.format, System.Single.getHashCode));

                    switch (iSextant) {
                        case 1: 
                            return CirnoGame.App.RGBToInt(iMid, iMax, iMin);
                        case 2: 
                            return CirnoGame.App.RGBToInt(iMin, iMax, iMid);
                        case 3: 
                            return CirnoGame.App.RGBToInt(iMin, iMid, iMax);
                        case 4: 
                            return CirnoGame.App.RGBToInt(iMid, iMin, iMax);
                        case 5: 
                            return CirnoGame.App.RGBToInt(iMax, iMin, iMid);
                        default: 
                            return CirnoGame.App.RGBToInt(iMax, iMid, iMin);
                    }
                },
                RGBToInt: function (R, G, B) {
                    return ((((R + (G << 8)) | 0) + (B << 16)) | 0);
                }
            }
        }
    });

    Bridge.define("CirnoGame.Audio", {
        fields: {
            _AM: null,
            _audio: null,
            _hasPlayed: false,
            _blast: null,
            lastplayed: 0,
            _loop: false,
            OnPlay: null,
            OnStop: null,
            lasttime: 0
        },
        props: {
            ID: null,
            IsPlaying: {
                get: function () {
                    return !(!this._hasPlayed || this._audio.paused || this._audio.currentTime === 0.0);
                },
                set: function (value) {
                    if (value) {
                        this.Play();
                    } else {
                        this.Pause();
                    }
                }
            },
            Loop: {
                get: function () {
                    //return _audio.Loop;
                    return this._loop;
                },
                set: function (value) {
                    //_audio.Loop = value;
                    this._loop = value;
                    //_audio.Loop = value;
                }
            },
            CurrentTime: {
                get: function () {
                    return this._audio.currentTime;
                },
                set: function (value) {
                    this._audio.currentTime = value;
                }
            },
            Volume: {
                get: function () {
                    return this._audio.volume;
                },
                set: function (value) {
                    this._audio.volume = value;
                }
            }
        },
        ctors: {
            init: function () {
                this.lastplayed = Number.NEGATIVE_INFINITY;
                this.lasttime = 0;
            },
            ctor: function (audio, ID, AudioManager) {
                this.$initialize();
                this._audio = audio;
                this.ID = ID;
                var self = this;
                this._AM = AudioManager;
                //object A = (() => self._OnPlay);
                //Action A = new Action(() => self._OnPlay());

                this._audio.onplay = function () {
                    self._OnPlay();
                };
                this._audio.onpause = function () {
                    self._OnStop();
                };
                //_audio.OnEnded = new Action(() => self._OnStop()).ToDynamic();
                this._audio.onended = function () {
                    self._OnEnd();
                };
                this._audio.ontimeupdate = function () {
                    self._OnUpdate();
                };

                this._blast = new (System.Collections.Generic.List$1(HTMLAudioElement)).ctor();
                var maxvoices = 6;
                var voices = 1;
                while (voices < maxvoices) {
                    this._blast.add(Bridge.cast(this._audio.cloneNode(), HTMLAudioElement));
                    voices = (voices + 1) | 0;
                }
                /* _blast.Add((AudioElement)_audio.CloneNode());
                _blast.Add((AudioElement)_audio.CloneNode());
                _blast.Add((AudioElement)_audio.CloneNode());
                _blast.Add((AudioElement)_audio.CloneNode());*/
                /* _audio.OnPlay = "self._OnPlay()".ToDynamic();
                _audio.OnPause = "self._OnStop()".ToDynamic();
                _audio.OnEnded = "self._OnStop()".ToDynamic();*/
            }
        },
        methods: {
            Play: function () {
                if (!this.IsPlaying) {
                    this.lasttime = this.CurrentTime;
                    this._audio.play();
                    this._hasPlayed = true;
                    return true;
                }
                return false;
            },
            Pause: function () {
                if (this.IsPlaying) {
                    this._audio.pause();
                    return true;
                }
                return false;
            },
            Stop: function () {
                if (this.IsPlaying) {
                    this._audio.pause();
                    this._audio.currentTime = 0;
                    return true;
                }
                return false;
            },
            Blast: function (volume) {
                if (volume === void 0) { volume = 1.0; }
                var T = CirnoGame.App.totalTime;
                if (T - this.lasttime < 150) {
                    return; //prevent audio spam.
                }
                if (!this.IsPlaying) {
                    this.Volume = volume;
                    this.Play();
                    this.lasttime = T;
                } else {
                    //((AudioElement)_audio.CloneNode()).Play();
                    var i = 0;
                    while (i < this._blast.Count) {
                        var A = this._blast.getItem(i);
                        //if (A.Paused || A.CurrentTime<0.15f || A.Played.Length==0)
                        if (A.paused || A.currentTime < 0.1 || A.played.length === 0) {
                            if (A.paused || A.currentTime === 0.0 || A.played.length === 0) {
                                A.volume = volume;
                                A.play();
                                i = this._blast.Count;
                                this.lasttime = T;
                            }
                        }
                        i = (i + 1) | 0;
                    }
                }
            },
            _OnPlay: function () {
                this._AM.OnPlay(this);
                if (this.OnPlay) {
                    this.OnPlay(this);
                }
            },
            _OnStop: function () {
                this._AM.OnStop(this);
                if (this.OnStop) {
                    this.OnStop(this);
                }
            },
            _OnEnd: function () {
                /* if (_loop)
                {
                   CurrentTime = 0;
                   Play();
                }
                else*/
                {
                    this._OnStop();
                }
            },
            _OnUpdate: function () {
                if (this._loop) {
                    //if ((CurrentTime+0.35) >= _audio.Duration)
                    if ((this.CurrentTime + ((this.CurrentTime - this.lasttime) * 0.8)) >= this._audio.duration) {
                        this.CurrentTime = 0;
                        this.Play();
                    }
                    this.lasttime = this.CurrentTime;
                }
            }
        }
    });

    Bridge.define("CirnoGame.AudioManager", {
        statics: {
            fields: {
                Directory: null,
                __this: null
            },
            props: {
                _this: {
                    get: function () {
                        if (CirnoGame.AudioManager.__this == null) {
                            CirnoGame.AudioManager.__this = new CirnoGame.AudioManager();
                        }
                        return CirnoGame.AudioManager.__this;
                    }
                }
            },
            ctors: {
                init: function () {
                    this.Directory = "";
                }
            },
            methods: {
                Init: function () {
                    if (CirnoGame.AudioManager.__this == null) {
                        CirnoGame.AudioManager.__this = new CirnoGame.AudioManager();
                    }
                }
            }
        },
        fields: {
            data: null,
            playing: null
        },
        ctors: {
            ctor: function () {
                this.$initialize();
                this.data = new (System.Collections.Generic.Dictionary$2(System.String,CirnoGame.Audio))();
                this.playing = new (System.Collections.Generic.List$1(CirnoGame.Audio)).ctor();
            }
        },
        methods: {
            Get: function (path) {
                path = System.String.concat(CirnoGame.AudioManager.Directory, path);
                if (this.data.containsKey(path)) {
                    return this.data.get(path);
                } else {
                    var AE = new Audio(path);
                    var A = new CirnoGame.Audio(AE, path, this);
                    this.data.add(path, A);
                    return A;
                }
            },
            Play: function (path, loop) {
                if (loop === void 0) { loop = false; }
                var A = this.Get(path);
                A.Loop = loop;
                A.Play();
                return A;
            },
            Blast: function (path, volume) {
                if (volume === void 0) { volume = 1.0; }
                var A = this.Get(path);
                A.Blast(volume);
            },
            Stop: function (path) {
                var A = this.Get(path);
                A.Stop();
            },
            Pause: function (path) {
                var A = this.Get(path);
                A.Pause();
            },
            OnPlay: function (audio) {
                if (!this.playing.contains(audio)) {
                    this.playing.add(audio);
                }
            },
            OnStop: function (audio) {
                if (this.playing.contains(audio)) {
                    this.playing.remove(audio);
                }
            },
            StopAllFromDirectory: function (directory) {
                directory = System.String.concat(CirnoGame.AudioManager.Directory, directory);
                CirnoGame.HelperExtensions.ForEach(Bridge.global.CirnoGame.Audio, this.data.getValues(), function (A) {
                    if (System.String.startsWith(A.ID, directory)) {
                        A.Stop();
                    }
                });
            },
            StopAll: function () {
                CirnoGame.HelperExtensions.ForEach(Bridge.global.CirnoGame.Audio, this.data.getValues(), function (A) {
                    A.Stop();
                });
            }
        }
    });

    Bridge.define("CirnoGame.ButtonMenu", {
        fields: {
            rows: null,
            MenuWidth: 0,
            MenuHeight: 0,
            FontSize: 0,
            SelectionMenu: false,
            Selected: null,
            Self: null,
            OnChoose: null,
            Position: null
        },
        props: {
            SelectedData: {
                get: function () {
                    if (this.Self.Selected != null) {
                        return this.Self.Selected.Data;
                    }
                    return null;
                }
            },
            SelectedText: {
                get: function () {
                    if (this.Self.Selected != null) {
                        if (Bridge.is(this.Self.Selected.Contents, CirnoGame.TextSprite)) {
                            return Bridge.cast(this.Self.Selected.Contents, CirnoGame.TextSprite).Text;
                        }
                    }
                    return null;
                }
            }
        },
        ctors: {
            init: function () {
                this.Position = new CirnoGame.Vector2();
            },
            ctor: function (menuWidth, menuHeight, FontSize, selectionMenu) {
                if (selectionMenu === void 0) { selectionMenu = false; }

                this.$initialize();
                this.rows = new (System.Collections.Generic.List$1(System.Collections.Generic.List$1(CirnoGame.ButtonSprite))).ctor();
                this.MenuWidth = menuWidth;
                this.MenuHeight = menuHeight;
                this.FontSize = FontSize;
                this.SelectionMenu = selectionMenu;
                this.Self = this;
            }
        },
        methods: {
            GetAllButtons: function () {
                var all = new (System.Collections.Generic.List$1(CirnoGame.ButtonSprite)).ctor();
                this.rows.forEach(function (R) {
                    all.addRange(R);
                });
                return all;
            },
            GetSpriteByData: function (data) {
                var all = new (System.Collections.Generic.List$1(CirnoGame.ButtonSprite)).$ctor1(System.Linq.Enumerable.from(this.GetAllButtons()).where(function (B) {
                        return Bridge.referenceEquals(B.Data, data);
                    }));
                if (all.Count > 0) {
                    return all.getItem(0);
                }
                return null;
            },
            AddButtons: function (buttonText) {
                CirnoGame.HelperExtensions.ForEach(System.String, buttonText, Bridge.fn.bind(this, function (T) {
                    this.AddButton(T);
                }));
            },
            AddButton: function (buttonText, row, data) {
                if (row === void 0) { row = -1; }
                if (data === void 0) { data = null; }
                var T = new CirnoGame.TextSprite();
                T.Text = buttonText;
                T.FontSize = this.FontSize;
                //ButtonSprite B = new ButtonSprite(T, (int)(FontSize * 0.05));
                var B = new CirnoGame.ButtonSprite(T, Bridge.Int.clip32(this.FontSize * 0.1));
                if (data != null) {
                    B.Data = data;
                }
                this.AddButton$1(B, row);
                return B;
            },
            AddButton$1: function (button, row) {
                if (row === void 0) { row = -1; }
                if (this.rows.Count === 0) {
                    this.rows.add(new (System.Collections.Generic.List$1(CirnoGame.ButtonSprite)).ctor());
                }
                if (row === -1) {
                    row = (this.rows.Count - 1) | 0;
                }
                if (button != null) {
                    button.OnClick = Bridge.fn.bind(this, function () {
                        this.Self.Select(button);
                    });
                }
                this.rows.getItem(row).add(button);
            },
            Select: function (button) {
                if (!Bridge.referenceEquals(this.Selected, button) || !this.SelectionMenu) {
                    if (this.Selected != null && this.SelectionMenu) {
                        //Selected.BorderColor = "#00AA33";
                        //Selected.ButtonColor = "#11CC55";
                        this.Selected.SetColorScheme$1(0);
                    }
                    this.Selected = button;
                    var OSC = this.OnChoose;
                    var self = this;
                    if (this.SelectionMenu && this.Selected != null) {
                        //Selected.BorderColor = "#FFFFFF";
                        //Selected.ButtonColor = "#FF0000";
                        this.Selected.SetColorScheme$1(1);
                    }
                    if (this.Selected != null && OSC) {
                        self.OnChoose();
                    }
                }
            },
            CombineRows: function () {
                var all = new (System.Collections.Generic.List$1(CirnoGame.ButtonSprite)).ctor();
                this.rows.forEach(function (R) {
                    all.addRange(R);
                });

                this.rows = new (System.Collections.Generic.List$1(System.Collections.Generic.List$1(CirnoGame.ButtonSprite))).ctor();
                this.rows.add(all);
            },
            addRow: function () {
                var ret = new (System.Collections.Generic.List$1(CirnoGame.ButtonSprite)).ctor();
                this.rows.add(ret);
                return ret;
            },
            BreakUp: function (totalRows) {
                this.CombineRows();
                var all = this.rows.getItem(0);
                this.rows = new (System.Collections.Generic.List$1(System.Collections.Generic.List$1(CirnoGame.ButtonSprite))).ctor();
                var C = Math.ceil(all.Count / totalRows);
                var row = this.addRow();
                var i = 0;
                while (i < all.Count) {
                    if (row.Count >= C) {
                        row = this.addRow();
                    }
                    this.AddButton$1(all.getItem(i));
                    i = (i + 1) | 0;
                }
            },
            CenterOn: function (sprite, Center) {
                sprite.Draw(null);
                var S = sprite.Size;
                var S2 = CirnoGame.Vector2.op_Division(S, 2.0);
                sprite.Position = CirnoGame.Vector2.op_Subtraction(Center, S2);
            },
            UpdateRow: function (index, y) {
                var row = this.rows.getItem(index);
                var X = (this.MenuWidth / (row.Count + 1.0));
                var i = 0;
                var CX = X;

                CX += this.Position.X;
                while (i < row.Count) {
                    var B = row.getItem(i);
                    if (B != null) {
                        this.CenterOn(B, new CirnoGame.Vector2(CX, y));
                    }
                    CX += X;
                    i = (i + 1) | 0;
                }
            },
            Finish: function (totalRows) {
                if (totalRows === void 0) { totalRows = -1; }
                if (totalRows > 0) {
                    this.BreakUp(totalRows);
                }
                var y = 0;
                var CY = 0;
                if (totalRows > 0 && this.rows.Count < totalRows) {
                    y = (this.MenuHeight / (((this.rows.Count + 1) | 0)));
                    CY = y;
                } else {
                    y = (this.MenuHeight / (this.rows.Count));
                    CY = 0;
                }

                CY += this.Position.Y;
                var i = 0;
                while (i < this.rows.Count) {
                    this.UpdateRow(i, CY);
                    CY += y;
                    i = (i + 1) | 0;
                }
            },
            Update: function (mousePosition, clicked) {
                if (mousePosition === void 0) { mousePosition = null; }
                if (clicked === void 0) { clicked = true; }
                if (CirnoGame.Vector2.op_Equality(mousePosition, null)) {
                    mousePosition = CirnoGame.KeyboardManager._this.CMouse;
                    clicked = CirnoGame.KeyboardManager._this.TappedMouseButtons.contains(0);
                }
                if (clicked) {
                    this.rows.forEach(function (R) {
                        R.forEach(function (B) {
                            if (B != null) {
                                B.CheckClick(mousePosition);
                            }
                        });
                    });
                }
            },
            Draw: function (g) {
                this.rows.forEach(function (R) {
                    R.forEach(function (B) {
                        if (B != null) {
                            B.Draw(g);
                        }
                    });
                });
            }
        }
    });

    Bridge.define("CirnoGame.Sprite", {
        fields: {
            Position: null,
            spriteBuffer: null,
            Visible: false,
            spriteGraphics: null
        },
        props: {
            Size: {
                get: function () {
                    return new CirnoGame.Vector2(this.spriteBuffer.width, this.spriteBuffer.height);
                },
                set: function (value) {
                    if (CirnoGame.Vector2.op_Equality(value, null)) {
                        value = new CirnoGame.Vector2();
                    }
                    this.spriteBuffer.width = Bridge.Int.clip32(value.X);
                    this.spriteBuffer.height = Bridge.Int.clip32(value.Y);
                }
            }
        },
        ctors: {
            init: function () {
                this.Visible = true;
            },
            ctor: function () {
                this.$initialize();
                this.spriteBuffer = document.createElement("canvas");
                this.spriteGraphics = this.spriteBuffer.getContext("2d");
                this.spriteGraphics.imageSmoothingEnabled = false;
                this.Position = new CirnoGame.Vector2();
            }
        },
        methods: {
            GetGraphics: function () {
                return this.spriteGraphics;
            },
            OnFrame: function () {

            },
            Draw: function (g) {
                if (!this.Visible) {
                    return;
                }
                g.drawImage(this.spriteBuffer, this.Position.X, this.Position.Y);
            },
            GetBounds: function () {
                return new CirnoGame.Rectangle(this.Position.X, this.Position.Y, this.spriteBuffer.width, this.spriteBuffer.height);
            }
        }
    });

    Bridge.define("CirnoGame.ButtonSprite.ColorScheme", {
        fields: {
            BorderColor: null,
            ButtonColor: null
        },
        ctors: {
            ctor: function (borderColor, buttonColor) {
                if (borderColor === void 0) { borderColor = "#00AA33"; }
                if (buttonColor === void 0) { buttonColor = "#11CC55"; }

                this.$initialize();
                this.BorderColor = borderColor;
                this.ButtonColor = buttonColor;
            }
        }
    });

    Bridge.define("CirnoGame.Camera", {
        fields: {
            instawarp: false,
            Position: null,
            TargetPosition: null,
            /**
             * @instance
             * @public
             * @memberof CirnoGame.Camera
             * @default 0.8
             * @type number
             */
            LinearPanSpeed: 0,
            /**
             * @instance
             * @public
             * @memberof CirnoGame.Camera
             * @default 0.07
             * @type number
             */
            LerpPanSpeed: 0,
            _scale: 0,
            speedmod: 0,
            _invscale: 0,
            _center: null,
            viewport_width: 0,
            viewport_height: 0,
            CameraBounds: null,
            StageBounds: null,
            tmp: null
        },
        props: {
            CenteredTargetPosition: {
                set: function (value) {
                    this.TargetPosition = new CirnoGame.Vector2(value.X - (this.CameraBounds.width / 2), value.Y - (this.CameraBounds.height / 2));
                }
            },
            Scale: {
                get: function () {
                    return this._scale;
                },
                set: function (value) {
                    this._scale = value;
                    this._invscale = 1 / this._scale;
                    this.UpdateCameraBounds();
                }
            },
            InvScale: {
                get: function () {
                    return this._invscale;
                },
                set: function (value) {
                    this._invscale = value;
                    this._scale = 1 / this._invscale;
                    this.UpdateCameraBounds();
                }
            },
            Center: {
                get: function () {
                    var R = this.CameraBounds;
                    //return R.Center;
                    R.GetCenter(this._center);
                    return this._center;
                },
                set: function (value) {
                    this.Position.X = value.X - (this.CameraBounds.width / 2);
                    this.Position.Y = value.Y - (this.CameraBounds.height / 2);
                }
            }
        },
        ctors: {
            init: function () {
                this.instawarp = false;
                this.LinearPanSpeed = 0.8;
                this.LerpPanSpeed = 0.07;
                this._scale = 1.0;
                this.speedmod = 1;
                this._invscale = 1.0;
                this._center = new CirnoGame.Vector2();
                this.viewport_width = 1;
                this.viewport_height = 1;
                this.tmp = new CirnoGame.Vector2();
            },
            ctor: function (viewport_width, viewport_height) {
                if (viewport_width === void 0) { viewport_width = -1.0; }
                if (viewport_height === void 0) { viewport_height = -1.0; }

                this.$initialize();
                this.Position = new CirnoGame.Vector2();
                this.TargetPosition = new CirnoGame.Vector2();
                this.viewport_width = viewport_width;
                this.viewport_height = viewport_height;
                this.CameraBounds = new CirnoGame.Rectangle(0, 0, viewport_width, viewport_height);
                this._invscale = 1.0 / this._scale;
                this.UpdateCameraBounds();
            }
        },
        methods: {
            ScaleToSize: function (sizeInPixels) {
                this.Scale = sizeInPixels / CirnoGame.App.Canvas.width;
            },
            UpdateCameraBounds: function () {
                //CameraBounds.width = App.Canvas.Width * _invscale;
                //CameraBounds.height = App.Canvas.Height * _invscale;
                this.CameraBounds.width = this.viewport_width * this._invscale;
                this.CameraBounds.height = this.viewport_height * this._invscale;
            },
            Update: function () {
                if (this.Position.X !== this.TargetPosition.X || this.Position.Y !== this.TargetPosition.Y) {
                    //float dist = (Position - TargetPosition).Length;
                    var dist = this.Position.Distance(this.TargetPosition);
                    var spd = this.LinearPanSpeed + (dist * this.LerpPanSpeed);
                    spd *= this.speedmod;

                    if (dist <= spd || this.instawarp) {
                        this.Position.X = this.TargetPosition.X;
                        this.Position.Y = this.TargetPosition.Y;
                        this.instawarp = false;
                        return;
                    } else {
                        this.tmp.CopyFrom(this.Position);
                        this.tmp.Subtract(this.TargetPosition);
                        this.tmp.SetAsNormalize(spd);
                        //Vector2 V = (Position - TargetPosition).Normalize(spd);
                        this.Position.Subtract(this.tmp);
                    }
                    if (this.StageBounds != null) {
                        this.Position.X = CirnoGame.MathHelper.Clamp$1(this.Position.X, this.StageBounds.left, this.StageBounds.right - this.CameraBounds.width);
                        this.Position.Y = CirnoGame.MathHelper.Clamp$1(this.Position.Y, this.StageBounds.top, this.StageBounds.bottom - this.CameraBounds.height);

                        this.TargetPosition.X = CirnoGame.MathHelper.Clamp$1(this.TargetPosition.X, this.StageBounds.left, this.StageBounds.right - this.CameraBounds.width);
                        this.TargetPosition.Y = CirnoGame.MathHelper.Clamp$1(this.TargetPosition.Y, this.StageBounds.top, this.StageBounds.bottom - this.CameraBounds.height);
                    }

                }
                this.CameraBounds.x = this.Position.X;
                this.CameraBounds.y = this.Position.Y;
            },
            Apply: function (g) {
                g.scale(this.Scale, this.Scale);
                g.translate(-this.Position.X, -this.Position.Y);
            }
        }
    });

    Bridge.define("CirnoGame.Entity", {
        fields: {
            Ani: null,
            Alive: false,
            Visible: false,
            Speed: null,
            Game: null,
            _behaviors: null,
            _behaviorTicks: null,
            data: null,
            ZOrder: 0,
            ID: null,
            HideHitbox: false,
            HandledLocally: false,
            RemovedOnLevelEnd: false,
            HitboxBuffer: null
        },
        props: {
            Hspeed: {
                get: function () {
                    return this.Speed.X;
                },
                set: function (value) {
                    this.Speed.X = value;
                }
            },
            Vspeed: {
                get: function () {
                    return this.Speed.Y;
                },
                set: function (value) {
                    this.Speed.Y = value;
                }
            },
            Position: {
                get: function () {
                    return this.Ani.Position;
                },
                set: function (value) {
                    this.Ani.Position = value;
                }
            },
            x: {
                get: function () {
                    return this.Ani.Position.X;
                },
                set: function (value) {
                    this.Ani.Position.X = value;
                }
            },
            y: {
                get: function () {
                    return this.Ani.Position.Y;
                },
                set: function (value) {
                    this.Ani.Position.Y = value;
                }
            },
            Width: {
                get: function () {
                    if (this.Ani.CurrentImage != null) {
                        return this.Ani.CurrentImage.width;
                    }
                    return 0;
                }
            },
            Height: {
                get: function () {
                    if (this.Ani.CurrentImage != null) {
                        return this.Ani.CurrentImage.height;
                    }
                    return 0;
                }
            }
        },
        ctors: {
            init: function () {
                this.Alive = true;
                this.Visible = true;
                this.Speed = new CirnoGame.Vector2();
                this.data = new (System.Collections.Generic.Dictionary$2(System.String,System.Object))();
                this.ZOrder = 0;
                this.HandledLocally = true;
                this.RemovedOnLevelEnd = true;
                this.HitboxBuffer = new CirnoGame.Rectangle();
            },
            ctor: function (game) {
                this.$initialize();
                //ID = Math.Random();
                this.ID = CirnoGame.Helper.GetRandomString();
                this.Game = game;
            }
        },
        methods: {
            AddBehavior$1: function (behavior) {
                if (this._behaviors == null) {
                    this._behaviors = new (System.Collections.Generic.List$1(CirnoGame.EntityBehavior)).ctor();
                    this._behaviorTicks = new (System.Collections.Generic.List$1(System.Int32)).ctor();
                }
                this._behaviors.add(behavior);
                this._behaviorTicks.add(0);
            },
            AddBehavior: function (T) {
                if (this._behaviors == null) {
                    this._behaviors = new (System.Collections.Generic.List$1(CirnoGame.EntityBehavior)).ctor();
                    this._behaviorTicks = new (System.Collections.Generic.List$1(System.Int32)).ctor();
                }
                var B = Bridge.createInstance(T, [this]);
                this._behaviors.add(Bridge.cast(B, CirnoGame.EntityBehavior));
                this._behaviorTicks.add(0);
                return Bridge.unbox(B);
                /* if (B is EntityBehavior)
                {
                   _behaviors.Add((EntityBehavior)B);
                   _behaviorTicks.Add(0);
                }else
                {
                   throw new Exception("Attempted to add an invalid behavior");
                }*/
            },
            RemoveBehavior: function (behavior) {
                if (this._behaviors == null) {
                    this._behaviors = new (System.Collections.Generic.List$1(CirnoGame.EntityBehavior)).ctor();
                    this._behaviorTicks = new (System.Collections.Generic.List$1(System.Int32)).ctor();
                }
                if (this._behaviors.contains(behavior)) {
                    this._behaviorTicks.removeAt(this._behaviors.indexOf(behavior));
                    this._behaviors.remove(behavior);
                }
            },
            RemoveBehavior$1: function (T) {
                var $t;
                if (this._behaviors == null) {
                    return;
                }
                var L = new (System.Collections.Generic.List$1(CirnoGame.EntityBehavior)).$ctor1(System.Linq.Enumerable.from(this._behaviors).where(function (behavior) {
                        return Bridge.is(behavior, T);
                    }));
                /* if (L.Count > 0)
                {
                   RemoveBehavior(L[0]);
                }*/
                $t = Bridge.getEnumerator(L);
                try {
                    while ($t.moveNext()) {
                        var behavior = $t.Current;
                        this.RemoveBehavior(behavior);
                    }
                } finally {
                    if (Bridge.is($t, System.IDisposable)) {
                        $t.System$IDisposable$dispose();
                    }
                }return;
            },
            GetBehavior: function (T) {
                if (this._behaviors == null) {
                    return Bridge.getDefaultValue(T);
                }
                /* List<EntityBehavior> L = new List<EntityBehavior>(_behaviors.Where(behavior => behavior is T));
                if (L.Count>0)
                {
                   return (dynamic)L[0];
                }*/
                return Bridge.cast(System.Linq.Enumerable.from(this._behaviors).first(function (behavior) {
                        return Bridge.is(behavior, T);
                    }), T);
            },
            GetBehavior$1: function (T, func) {
                var L = new (System.Collections.Generic.List$1(CirnoGame.EntityBehavior)).$ctor1(System.Linq.Enumerable.from(this._behaviors).where(function (behavior) {
                        return Bridge.is(behavior, T);
                    }));
                var F = func;
                return Bridge.cast(System.Linq.Enumerable.from(L).first(F), T);
                //return L.First(func).Cast<T>();
            },
            GetTeamColor: function () {
                if (Bridge.is(this, CirnoGame.ICombatant)) {
                    if (this.Game.GamePlaySettings.GameMode.Teams) {
                        return CirnoGame.Game.GetTeamColor(Bridge.cast(this, CirnoGame.ICombatant).CirnoGame$ICombatant$Team);
                    } else {
                        if (Bridge.referenceEquals(this, this.Game.player)) {
                            return CirnoGame.Game.GetTeamColor(1);
                        } else {
                            return CirnoGame.Game.GetTeamColor(2);
                        }
                    }
                }
                return "";
            },
            SameTeam: function (combatant) {
                if (this == combatant) {
                    return true;
                }
                var A = this;
                var B = combatant;

                if (A.PointsForKilling && B.PointsForKilling) {
                    var AA = A;
                    var BB = B;
                    if (AA.Team == BB.Team) {
                        if (this.Game.Teams) {
                            //return ((ICombatant)this).Team != 0;
                            return true;
                        } else {
                            return AA.Team == 0;
                        }
                    }
                }
                return false;
            },
            GetBehaviorFromName: function (Name) {
                if (this._behaviors == null) {
                    return null;
                }
                //List<EntityBehavior> L = new List<EntityBehavior>(_behaviors.Where(behavior => behavior.GetType().FullName==typeFullName));
                /* List<EntityBehavior> L = new List<EntityBehavior>(_behaviors.Where(behavior => behavior.BehaviorName == Name));
                if (L.Count > 0)
                {
                   return (dynamic)L[0];
                }*/
                try {
                    return System.Linq.Enumerable.from(this._behaviors).first(function (behavior) {
                            return Bridge.referenceEquals(behavior.BehaviorName, Name);
                        });
                }
                catch ($e1) {
                    $e1 = System.Exception.create($e1);
                    System.Console.WriteLine(System.String.concat("Behavior ", Name, " was not found."));
                }
                return null;
            },
            CustomEvent: function (evt) {

            },
            PlaySound: function (sound) {
                this.Game.PlaySoundEffect(this.getCenter(), sound);
            },
            getCenter: function () {
                //return Position + new Vector2(Width / 2, Height / 2);
                return CirnoGame.Vector2.Add$1(this.Position, this.Width / 2, this.Height / 2);
            },
            GetHitbox: function () {
                if (this.Ani != null && this.Ani.CurrentImage != null) {
                    //return new Rectangle(Ani.X, Ani.Y, Ani.CurrentImage.Width, Ani.CurrentImage.Height);
                    var CI = this.Ani.CurrentImage;
                    this.HitboxBuffer.Set(this.Ani.X, this.Ani.Y, CI.width, CI.height);
                    return this.HitboxBuffer;
                }
                return null;
            },
            Update: function () {
                var $t;
                this.Ani.Position = CirnoGame.Vector2.op_Addition(this.Ani.Position, this.Speed);
                this.Ani.Update();
                if (this._behaviors != null) {
                    var i = 0;
                    while (i < this._behaviors.Count) {
                        var behavior = this._behaviors.getItem(i);
                        if (behavior.enabled && Bridge.identity(this._behaviorTicks.getItem(i), ($t = (this._behaviorTicks.getItem(i) + 1) | 0, this._behaviorTicks.setItem(i, $t), $t)) >= behavior.FramesPerTick) {
                            this._behaviorTicks.setItem(i, 0);
                            behavior.Update();
                        }
                        i = (i + 1) | 0;
                    }
                }
            },
            RefreshBehaviorTick: function (T) {
                var B = this.GetBehavior(T);
                if (B != null) {
                    this._behaviorTicks.setItem(this._behaviors.indexOf(B), B.FramesPerTick);
                }
            },
            Draw: function (g) {
                var $t;
                this.Ani.Draw(g);
                if (!this.HideHitbox && this.Game.ShowHitbox) {
                    this.DrawHitbox(g);
                }
                if (this._behaviors != null) {
                    $t = Bridge.getEnumerator(this._behaviors);
                    try {
                        while ($t.moveNext()) {
                            var behavior = $t.Current;
                            behavior.Draw(g);
                        }
                    } finally {
                        if (Bridge.is($t, System.IDisposable)) {
                            $t.System$IDisposable$dispose();
                        }
                    }}
            },
            DrawHitbox: function (g) {
                var R = this.GetHitbox();
                if (R != null) {
                    g.strokeStyle = "#FFFF00";
                    g.strokeRect(R.x, R.y, R.width, R.height);
                }
            },
            onRemove: function () {

            }
        }
    });

    Bridge.define("CirnoGame.GameMode.ModeTypes", {
        $kind: "enum",
        statics: {
            fields: {
                
                Skirmish: 0,
                /**
                 * Singleplayer, gameplay is changed up with a mode specific task.
                 *
                 * @static
                 * @public
                 * @memberof number
                 * @constant
                 * @default 1
                 * @type number
                 */
                Challenge: 1,
                /**
                 * Like challenge, but is designed for multiple human players.
                 *
                 * @static
                 * @public
                 * @memberof number
                 * @constant
                 * @default 2
                 * @type number
                 */
                CallengeCoop: 2
            }
        }
    });

    Bridge.define("CirnoGame.GamePad", {
        fields: {
            connected: false,
            axes: null,
            buttons: null,
            id: null,
            index: System.Int64(0)
        },
        ctors: {
            ctor: function (pad) {
                this.$initialize();
                this.id = pad.id;
                this.index = System.Int64(pad.index);
                this.connected = pad.connected;
                this.axes = pad.axes;

                var length = pad.buttons.length;

                this.buttons = System.Array.init(length, null, CirnoGame.GamePadButton);
                var i = 0;
                while (i < length) {
                    this.buttons[System.Array.index(i, this.buttons)] = pad.buttons[i];
                    i = (i + 1) | 0;
                }
            }
        },
        methods: {
            Update: function () {
                var i = 0;
                while (i < this.buttons.length) {
                    this.buttons[System.Array.index(i, this.buttons)].tapped = false;
                    i = (i + 1) | 0;
                }
            },
            CombineData: function (pad) {
                if (Bridge.referenceEquals(this.id, pad.id)) {
                    this.connected = pad.connected;
                    this.axes = pad.axes;
                    //buttons = pad.buttons;
                    this.CombineButtonData(pad.buttons);
                }
            },
            CombineButtonData: function (buttons) {
                var Lb = buttons;
                this.buttons = buttons;
                var i = 0;
                while (i < buttons.length) {
                    if (buttons[System.Array.index(i, buttons)].pressed && !Lb[System.Array.index(i, Lb)].pressed) {
                        buttons[System.Array.index(i, buttons)].tapped = true;
                    }
                    i = (i + 1) | 0;
                }
            }
        }
    });

    Bridge.define("CirnoGame.GamePadButton", {
        fields: {
            tapped: false,
            pressed: false,
            value: 0
        },
        ctors: {
            ctor: function (button) {
                this.$initialize();
                this.pressed = button.pressed;
                this.value = button.value;
                this.tapped = false;
            }
        }
    });

    Bridge.define("CirnoGame.GamePadManager", {
        statics: {
            fields: {
                _this: null
            }
        },
        fields: {
            keyboard: null,
            gamepads: null,
            tempgamepads: null
        },
        props: {
            activeGamepads: {
                get: function () {
                    return new (System.Collections.Generic.List$1(CirnoGame.GamePad)).$ctor1(System.Linq.Enumerable.from(this.gamepads).where(function (gamepad) {
                            return gamepad.connected;
                        }));
                }
            }
        },
        ctors: {
            ctor: function () {
                this.$initialize();
                this.gamepads = new (System.Collections.Generic.List$1(CirnoGame.GamePad)).ctor();
                this.Update();
            }
        },
        methods: {
            CallBackTest: function () {
                Bridge.global.alert("Callback!");
            },
            GetPad: function (id) {
                var L = new (System.Collections.Generic.List$1(CirnoGame.GamePad)).$ctor1(System.Linq.Enumerable.from(this.gamepads).where(function (gamepad) {
                        return Bridge.referenceEquals(gamepad.id, id);
                    }));
                if (L.Count > 0) {
                    return L.getItem(0);
                }
                return null;
            },
            Update: function () {
                var i = 0;
                while (i < this.gamepads.Count) {
                    this.gamepads.getItem(i).Update();
                    i = (i + 1) | 0;
                }
                i = 0;
                this.tempgamepads = (navigator.getGamepads() || navigator.webkitGetGamepads() || []);
                var pads = new (System.Collections.Generic.List$1(CirnoGame.GamePad)).ctor();
                while (i < this.tempgamepads.length) {
                    if (this.tempgamepads[i] != null) {
                        var pad = new CirnoGame.GamePad(this.tempgamepads[i]);
                        this._Update(pad);
                        pads.add(pad);
                    }
                    i = (i + 1) | 0;
                }
                i = 0;
                //Adds any newly found gamepads.
                while (i < pads.Count) {
                    var id = pads.getItem(i).id;
                    var j = 0;
                    var ok = true;
                    while (j < this.gamepads.Count) {
                        if (Bridge.referenceEquals(this.gamepads.getItem(j).id, id)) {
                            ok = false;
                        }
                        j = (j + 1) | 0;
                    }
                    if (ok) {
                        this.gamepads.add(pads.getItem(i));
                    }
                    i = (i + 1) | 0;
                }

                /* Action F = CallBackTest;
                Script.Write("setTimeout(F, 3000);");*/
                //Global.SetTimeout()
            },
            _Update: function (pad) {
                var i = 0;
                while (i < this.gamepads.Count) {
                    var P = this.gamepads.getItem(i);
                    if (Bridge.referenceEquals(P.id, pad.id)) {
                        P.CombineData(pad);
                    }
                    i = (i + 1) | 0;
                }
            }
        }
    });

    Bridge.define("CirnoGame.GamePlaySettings", {
        fields: {
            Online: false,
            MyCharacter: null,
            GameMode: null,
            MyTeam: 0,
            BlueNPCs: 0,
            RedNPCs: 0,
            RoomID: null,
            /**
             * @instance
             * @public
             * @memberof CirnoGame.GamePlaySettings
             * @default 1.0
             * @type number
             */
            ComputerAIModifier: 0
        },
        ctors: {
            init: function () {
                this.Online = false;
                this.MyCharacter = "Reisen";
                this.MyTeam = 1;
                this.BlueNPCs = 3;
                this.RedNPCs = 2;
                this.RoomID = "";
                this.ComputerAIModifier = 1.0;
            },
            ctor: function () {
                this.$initialize();
                //GameMode = new GameMode();
                //GameMode = GameMode.DeathMatch;
                this.GameMode = CirnoGame.GameMode.TeamBattle;
            }
        }
    });

    Bridge.define("CirnoGame.Helper", {
        statics: {
            fields: {
                _namespaces: null
            },
            ctors: {
                init: function () {
                    this._namespaces = new (System.Collections.Generic.Dictionary$2(System.String,System.Object))();
                }
            },
            methods: {
                GetRandomString: function () {
                    //return (Math.Random() * new Date().GetTime()).ToString(36).Replace("/\\./ g, '-'",null);
                    //return (Math.Random() * new Date().GetTime()).ToString(36).Replace(new Bridge.Text.RegularExpressions.Regex("", null);
                    //return Script.Write<string>("(Math.random() * new Date().getTime()).toString(36).replace(/\\./ g, '-')");
                    return (Math.random() * new Date().getTime()).toString(36);
                },
                GetType: function (FullName) {
                    var name = FullName;
                    if (Bridge.referenceEquals(name, "") || name == null || !System.String.contains(name,".")) {
                        return null;
                    }
                    var s = name.split(".");
                    //string nm = GetType().FullName.Split(".")[0];
                    var i = 1;
                    /* if (s[0] != nm)
                       return null;*/

                    //dynamic obj = Script.Write<object>(nm);

                    //Get namespace
                    var obj;
                    if (CirnoGame.Helper._namespaces.containsKey(s[System.Array.index(0, s)])) {
                        obj = CirnoGame.Helper._namespaces.get(s[System.Array.index(0, s)]);
                    } else {
                        obj = eval(s[System.Array.index(0, s)]);
                        CirnoGame.Helper._namespaces.set(s[System.Array.index(0, s)], obj);
                    }

                    while (i < s.length) {
                        //Parse through object hierarchy.
                        if (!obj) {
                            return null;
                        }
                        obj = obj[s[System.Array.index(i, s)]];
                        i = (i + 1) | 0;
                    }
                    return obj;
                },
                AddMultiple: function (T, array, item, number) {
                    while (number > 0) {
                        array.push(item);
                        number = (number - 1) | 0;
                    }
                },
                Repeat: function (s, number) {
                    if (number < 1) {
                        return "";
                    }
                    var ret = s;
                    var i = (number - 1) | 0;
                    while (i > 0) {
                        ret = System.String.concat(ret, s);
                        i = (i - 1) | 0;
                    }
                    return ret;
                },
                CloneCanvas: function (C) {
                    var ret = document.createElement("canvas");
                    ret.width = C.width;
                    ret.height = C.height;
                    var g = ret.getContext("2d");
                    g.drawImage(C, 0.0, 0.0);
                    return ret;
                },
                GetContext: function (C) {
                    return C.getContext("2d");
                },
                GetField: function (target, fieldName) {
                    var O = target;
                    //if (O[fieldName])
                    if (CirnoGame.Helper.Has(O, fieldName)) {
                        return O[fieldName];
                    }
                    if (O[System.String.concat("get", fieldName)]) {
                        return O[System.String.concat("get", fieldName)]();
                    }
                    var s = "";
                    try {
                        s = System.String.concat("Helper get field: Field \"", fieldName, "\" was not in " + target.GetType().FullName, ".");
                    }
                    catch ($e1) {
                        $e1 = System.Exception.create($e1);
                        s = System.String.concat("Helper get field: Field \"", fieldName, "\" was not in " + target, ".");
                    }

                    //Console.WriteLine(s);
                    console.log(s);
                    return null;
                },
                Has: function (target, fieldName) {
                    /* if (O[fieldName] || ((string)O) == "false")
                    {
                       return true;
                    }*/
                    return typeof target[fieldName] != 'undefined';
                },
                ReloadPage: function () {
                    window.location.href = window.location.href;
                },
                SetField: function (target, fieldName, data) {
                    var O = target;
                    //if (O[fieldName])
                    if (CirnoGame.Helper.Has(O, fieldName)) {
                        O[fieldName] = data;
                        return;
                    }
                    if (O[System.String.concat("set", fieldName)]) {
                        O[System.String.concat("set", fieldName)](data);
                        return;
                    }
                    var s = "";
                    try {
                        s = System.String.concat("Helper set field: Field \"", fieldName, "\" was not in " + target.GetType().FullName, ".");
                    }
                    catch ($e1) {
                        $e1 = System.Exception.create($e1);
                        s = System.String.concat("Helper set field: Field \"", fieldName, "\" was not in " + target, ".");
                    }
                    //Console.WriteLine(s);
                    console.log(s);
                },
                CopyFields: function (source, target, Fields) {
                    if (Fields === void 0) { Fields = null; }
                    if (Fields == null) {
                        Fields = Object.keys(source);
                    }
                    var i = 0;
                    while (i < Fields.length) {
                        var f = Fields[System.Array.index(i, Fields)];
                        CirnoGame.Helper.SetField(target, f, CirnoGame.Helper.GetField(source, f));
                        i = (i + 1) | 0;
                    }
                },
                KeyCodeToString: function (keycode) {
                    var codenames = System.Array.init(["", "", "", "CANCEL", "", "", "HELP", "", "BACK_SPACE", "TAB", "", "", "CLEAR", "ENTER", "ENTER_SPECIAL", "", "SHIFT", "CONTROL", "ALT", "PAUSE", "CAPS_LOCK", "KANA", "EISU", "JUNJA", "FINAL", "HANJA", "", "ESCAPE", "CONVERT", "NONCONVERT", "ACCEPT", "MODECHANGE", "SPACE", "PAGE_UP", "PAGE_DOWN", "END", "HOME", "LEFT", "UP", "RIGHT", "DOWN", "SELECT", "PRINT", "EXECUTE", "PRINTSCREEN", "INSERT", "DELETE", "", "0", "1", "2", "3", "4", "5", "6", "7", "8", "9", "COLON", "SEMICOLON", "LESS_THAN", "EQUALS", "GREATER_THAN", "QUESTION_MARK", "AT", "A", "B", "C", "D", "E", "F", "G", "H", "I", "J", "K", "L", "M", "N", "O", "P", "Q", "R", "S", "T", "U", "V", "W", "X", "Y", "Z", "OS_KEY", "", "CONTEXT_MENU", "", "SLEEP", "NUMPAD0", "NUMPAD1", "NUMPAD2", "NUMPAD3", "NUMPAD4", "NUMPAD5", "NUMPAD6", "NUMPAD7", "NUMPAD8", "NUMPAD9", "MULTIPLY", "ADD", "SEPARATOR", "SUBTRACT", "DECIMAL", "DIVIDE", "F1", "F2", "F3", "F4", "F5", "F6", "F7", "F8", "F9", "F10", "F11", "F12", "F13", "F14", "F15", "F16", "F17", "F18", "F19", "F20", "F21", "F22", "F23", "F24", "", "", "", "", "", "", "", "", "NUM_LOCK", "SCROLL_LOCK", "WIN_OEM_FJ_JISHO", "WIN_OEM_FJ_MASSHOU", "WIN_OEM_FJ_TOUROKU", "WIN_OEM_FJ_LOYA", "WIN_OEM_FJ_ROYA", "", "", "", "", "", "", "", "", "", "CIRCUMFLEX", "EXCLAMATION", "DOUBLE_QUOTE", "HASH", "DOLLAR", "PERCENT", "AMPERSAND", "UNDERSCORE", "OPEN_PAREN", "CLOSE_PAREN", "ASTERISK", "PLUS", "PIPE", "HYPHEN_MINUS", "OPEN_CURLY_BRACKET", "CLOSE_CURLY_BRACKET", "TILDE", "", "", "", "", "VOLUME_MUTE", "VOLUME_DOWN", "VOLUME_UP", "", "", "SEMICOLON", "EQUALS", "COMMA", "MINUS", "PERIOD", "SLASH", "BACK_QUOTE", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "OPEN_BRACKET", "BACK_SLASH", "CLOSE_BRACKET", "QUOTE", "", "META", "ALTGR", "", "WIN_ICO_HELP", "WIN_ICO_00", "", "WIN_ICO_CLEAR", "", "", "WIN_OEM_RESET", "WIN_OEM_JUMP", "WIN_OEM_PA1", "WIN_OEM_PA2", "WIN_OEM_PA3", "WIN_OEM_WSCTRL", "WIN_OEM_CUSEL", "WIN_OEM_ATTN", "WIN_OEM_FINISH", "WIN_OEM_COPY", "WIN_OEM_AUTO", "WIN_OEM_ENLW", "WIN_OEM_BACKTAB", "ATTN", "CRSEL", "EXSEL", "EREOF", "PLAY", "ZOOM", "", "PA1", "WIN_OEM_CLEAR", ""], System.String);
                    if (keycode >= 0 && keycode < codenames.length) {
                        return codenames[System.Array.index(keycode, codenames)];
                    }
                    var kc = keycode;
                    return String.FromCharCode(kc);
                },
                MakeShallowCopy: function (source, fieldNames) {
                    if (fieldNames === void 0) { fieldNames = null; }
                    var target = { };
                    var Fields = fieldNames;
                    if (Fields == null) {
                        Fields = Object.keys(source);
                    }
                    var i = 0;
                    while (i < Fields.length) {
                        var f = Fields[System.Array.index(i, Fields)];
                        target[f] = CirnoGame.Helper.GetField(source, f);
                        i = (i + 1) | 0;
                    }
                    return target;
                }
            }
        }
    });

    Bridge.define("CirnoGame.HelperExtensions", {
        statics: {
            methods: {
                Pick: function (T, list, RND) {
                    var $t;
                    if (RND === void 0) { RND = null; }
                    if (RND == null) {
                        RND = new System.Random.ctor();
                    }
                    var L = new (System.Collections.Generic.List$1(T)).ctor();
                    $t = Bridge.getEnumerator(list, T);
                    try {
                        while ($t.moveNext()) {
                            var item = $t.Current;
                            L.add(item);
                        }
                    } finally {
                        if (Bridge.is($t, System.IDisposable)) {
                            $t.System$IDisposable$dispose();
                        }
                    }return L.getItem(RND.next$1(L.Count));
                },
                ForEach: function (T, list, action) {
                    var $t;
                    $t = Bridge.getEnumerator(list, T);
                    try {
                        while ($t.moveNext()) {
                            var item = $t.Current;
                            action(item);
                        }
                    } finally {
                        if (Bridge.is($t, System.IDisposable)) {
                            $t.System$IDisposable$dispose();
                        }
                    }},
                ForEach$1: function (T, list, methodName) {
                    var $t;
                    $t = Bridge.getEnumerator(list, T);
                    try {
                        while ($t.moveNext()) {
                            var item = $t.Current;
                            var A = Bridge.unbox(item[methodName]);
                            A();
                        }
                    } finally {
                        if (Bridge.is($t, System.IDisposable)) {
                            $t.System$IDisposable$dispose();
                        }
                    }},
                AddIfNew: function (T, list, item) {
                    var i = 0;
                    var ln = list.Count;
                    var A = item;
                    while (i < ln) {
                        var B = list.getItem(i);
                        if (A == B) {
                            return;
                        }
                        i = (i + 1) | 0;
                    }
                    list.add(item);
                    /* if (!list.Contains(item))
                    {
                       list.Add(item);
                    }*/
                },
                RemoveAll: function (T, list, predicate) {

                    //foreach (var item in list)
                    var i = 0;
                    while (i < list.Count) {
                        var item = list.getItem(i);
                        //action(item);
                        if (predicate(item)) {
                            //list.rem
                            list.remove(item);
                            i = (i - 1) | 0;
                        }
                        i = (i + 1) | 0;
                    }
                },
                PushIfNew: function (T, list, val) {
                    if (!CirnoGame.HelperExtensions.ContainsB(T, list, val)) {
                        list.push(val);
                    }
                },
                PushRange: function (T, list, val) {
                    if (val === void 0) { val = []; }
                    var i = 0;
                    while (i < val.length) {
                        list.push(val[System.Array.index(i, val)]);
                        i = (i + 1) | 0;
                    }
                },
                Clear$1: function (T, list) {
                    var i = list.length;
                    while (Bridge.identity(i, (i = (i - 1) | 0)) > 0) {
                        list.pop();
                    }
                },
                Clear: function (G) {
                    var C = G.canvas;
                    G.clearRect(0, 0, C.width, C.height);
                },
                ReplaceAll: function (T, list, Source, Destination) {
                    var i = -1;
                    i = CirnoGame.HelperExtensions.IndexOf(T, list, Source, ((i + 1) | 0), 3);
                    var ln = Source.length;
                    while (i >= 0) {
                        var j = 0;

                        while (j < ln) {
                            list[System.Array.index(((i + j) | 0), list)] = Destination[System.Array.index(j, Destination)];
                            j = (j + 1) | 0;
                        }
                        i = CirnoGame.HelperExtensions.IndexOf(T, list, Source, ((i + 1) | 0), 3);
                    }
                },
                WhereB: function (T, list, predicate) {
                    var ret = System.Array.init(0, null, System.Object);
                    var i = 0;
                    var ln = list.length;
                    while (i < ln) {
                        var item = list[System.Array.index(i, list)];
                        if (predicate(item)) {
                            ret.push(item);
                        }
                        i = (i + 1) | 0;
                    }

                    return Bridge.unbox(ret);
                },
                ContainsB$1: function (T, list, Value) {
                    var L = Bridge.unbox(list.items);
                    return CirnoGame.HelperExtensions.ContainsB(T, L, Value);
                },
                ContainsB: function (T, list, Value) {
                    var i = 0;
                    var ln = list.length;
                    while (i < ln) {
                        var O = list[System.Array.index(i, list)];
                        if (O == Value) {
                            return true;
                        }
                        i = (i + 1) | 0;
                    }
                    return false;
                },
                IndexOf: function (T, list, Value, index, structureSize) {
                    if (index === void 0) { index = 0; }
                    if (structureSize === void 0) { structureSize = 1; }
                    var i = index;
                    var ln = list.length;
                    var vln = Value.length;
                    var O = Value[System.Array.index(0, Value)];
                    var A;
                    var B;
                    while (i < ln && i >= 0) {
                        /* var c = i+1;
                        i = -1;
                        B = Value[0];
                        while (c < list.Length && i==-1)
                        {
                           A = list[c];
                           if (A == B)
                           {
                               i = c;
                           }
                           c++;
                        }
                        if (i == -1)
                        {
                           return -1;
                        }*/
                        i = list.indexOf(Bridge.unbox(O), ((i + 1) | 0));
                        while (i >= 0 && i % structureSize > 0) {
                            i = list.indexOf(Bridge.unbox(O), ((i + 1) | 0));
                        }
                        if (i === -1) {
                            return -1;
                        }
                        var k = 1;
                        var l = (i + 1) | 0;

                        if (i < ln && i >= 0) {
                            var ok = true;
                            while (ok && k < vln) {
                                A = list[System.Array.index(l, list)];
                                B = Value[System.Array.index(k, Value)];
                                if (!Bridge.referenceEquals(A, B)) {
                                    ok = false;
                                }
                                k = (k + 1) | 0;
                                l = (l + 1) | 0;
                            }
                            if (ok) {
                                return i;
                            }
                        }
                    }
                    return -1;
                },
                Identical: function (T, list, list2) {
                    if (Bridge.referenceEquals(list, list2)) {
                        return true;
                    }
                    if (list == null || list2 == null) {
                        return false;
                    }
                    var ln = list.length;
                    if (ln === list2.length) {
                        var i = 0;

                        while (i < ln) {
                            var A = list[System.Array.index(i, list)];
                            var B = list2[System.Array.index(i, list2)];
                            if (!Bridge.referenceEquals(A, B)) {
                                return false;
                            }
                            i = (i + 1) | 0;
                        }
                        return true;
                    }
                    return false;
                },
                ReverseOrderWithStructure: function (T, list, size) {
                    //T[] ret = new T[0];
                    var ret = new (System.Collections.Generic.List$1(T)).ctor();
                    var i = 0;
                    var ln = list.length;
                    while (i < ln) {
                        var j = 0;
                        while (j < size) {
                            //ret.Push(list[j]);
                            ret.insert(0, list[System.Array.index((((((size - 1) | 0)) - j) | 0), list)]);
                            j = (j + 1) | 0;
                        }
                        i = (i + size) | 0;
                    }
                },
                /**
                 * not yet tested with deep inheritence...
                 *
                 * @static
                 * @public
                 * @this CirnoGame.HelperExtensions
                 * @memberof CirnoGame.HelperExtensions
                 * @param   {Function}         T           
                 * @param   {System.Object}    instance
                 * @return  {boolean}
                 */
                IsInstanceOfTypeFast: function (T, instance) {
                    var C = Bridge.unbox(instance).ctor;
                    var A = Bridge.unbox(T.$$inheritors); //list of all types that inherit from this type
                    return (Bridge.referenceEquals(C, T) || (A != null && A.indexOf(C) >= 0));
                }
            }
        }
    });

    Bridge.define("CirnoGame.ICombatant", {
        $kind: "interface"
    });

    Bridge.define("CirnoGame.IHarmfulEntity", {
        $kind: "interface"
    });

    Bridge.define("CirnoGame.ILightProducer", {
        $kind: "interface"
    });

    Bridge.define("CirnoGame.ILightSource", {
        $kind: "interface"
    });

    Bridge.define("CirnoGame.InputController", {
        statics: {
            fields: {
                NumberOfActions: 0,
                GM: null
            },
            ctors: {
                init: function () {
                    this.NumberOfActions = 8;
                }
            }
        },
        fields: {
            InputMapping: null
        },
        props: {
            id: null
        },
        ctors: {
            ctor: function (id) {
                if (id === void 0) { id = "Keyboard"; }

                this.$initialize();
                this.id = id;
                this.InputMapping = new (System.Collections.Generic.List$1(CirnoGame.InputMap)).ctor();

                if (Bridge.referenceEquals(id, "Keyboard")) {
                    this.initkeyboard();
                } else {
                    this.initgamepad();
                }
                if (CirnoGame.InputController.GM == null) {
                    if (CirnoGame.GamePadManager._this == null) {
                        CirnoGame.GamePadManager._this = new CirnoGame.GamePadManager();
                    }
                    CirnoGame.InputController.GM = CirnoGame.GamePadManager._this;
                }
            }
        },
        methods: {
            CopyMap: function () {
                /* dynamic D = new object();
                return D;*/
                var fields = System.Array.init(["map", "antimap", "name", "axis", "controllerID"], System.String);
                var ret = System.Array.init(this.InputMapping.Count, null, System.Object);
                var i = 0;
                while (i < ret.length) {
                    ret[System.Array.index(i, ret)] = CirnoGame.Helper.MakeShallowCopy(this.InputMapping.getItem(i), fields);
                    i = (i + 1) | 0;
                }
                return ret;
            },
            CopyFromMap: function (Map) {
                var fields = System.Array.init(["map", "antimap", "name", "axis", "controllerID"], System.String);

                var i = 0;
                while (i < Map.length) {
                    if (i >= this.InputMapping.Count) {
                        this.InputMapping.add(new CirnoGame.InputMap.ctor());
                    }
                    var IM = this.InputMapping.getItem(i);
                    CirnoGame.Helper.CopyFields(Map[System.Array.index(i, Map)], IM, fields);
                    //ret[i] = Helper.MakeShallowCopy(InputMapping[i], fields);
                    i = (i + 1) | 0;
                }
            },
            initkeyboard: function () {
                var i = 0;
                while (i < CirnoGame.InputController.NumberOfActions) {
                    var map = new CirnoGame.InputMap.$ctor1(-1);
                    if (i === 0) {
                        map.map = 39;
                        map.antimap = 37;

                        /* map.map = 68;
                        map.antimap= 65;*/
                    }
                    if (i === 1) {
                        map.map = 40;
                        map.antimap = 38;

                        /* map.map = 83;
                        map.antimap = 87;*/
                    }

                    if (i === 2) {
                        //map.map = 32;
                        map.map = 90;
                    }
                    if (i === 3) {
                        map.map = 88;
                    }
                    if (i === 4) {
                        map.map = 65; //a
                    }
                    if (i === 5) {
                        map.map = 13; //enter
                    }
                    this.InputMapping.add(map);
                    i = (i + 1) | 0;
                }
            },
            initgamepad: function () {
                var i = 0;
                while (i < CirnoGame.InputController.NumberOfActions) {
                    var map = new CirnoGame.InputMap.$ctor1(-1);
                    if (i === 0) {
                        map.map = 0;
                        map.axis = true;
                    }
                    if (i === 1) {
                        map.map = 1;
                        map.axis = true;
                    }

                    if (i > 1) {
                        map.map = (i - 2) | 0;
                    }
                    this.InputMapping.add(map);
                    i = (i + 1) | 0;
                }
            },
            getState: function (action, map) {
                if (map === void 0) { map = null; }
                if (map == null) {
                    map = this.InputMapping.getItem(action);
                }
                /* InputController IC = this;
                if (map.controller != null)
                {
                   IC = map.controller;
                }*/
                var TID = this.id;
                if (!Bridge.referenceEquals(map.controllerID, "")) {
                    TID = map.controllerID;
                }

                if (Bridge.referenceEquals(TID, "Keyboard")) {
                    return this.getKeyboardMapState(map);
                } else if (Bridge.referenceEquals(TID, "Mouse")) {
                    return this.getMouseMapState(map);
                } else {
                    return this.getGamepadMapState(map);
                }
            },
            getPressed: function (action, map) {
                if (map === void 0) { map = null; }
                return this.getState(action, map) >= 0.7;
            },
            FindAnyPressedGamePadInput: function () {
                var ret = new CirnoGame.InputMap.ctor();
                var L = CirnoGame.GamePadManager._this.activeGamepads;
                L.forEach(function (G) {
                    if (ret.map === -1) {
                        ret.controllerID = G.id;
                        var GB = System.Linq.Enumerable.from(G.buttons).where(function (B) {
                                return B.pressed;
                            }).toArray(CirnoGame.GamePadButton);
                        if (GB.length > 0) {
                            ret.axis = false;
                            var tmp = GB[System.Array.index(0, GB)];
                            ret.map = new (System.Collections.Generic.List$1(CirnoGame.GamePadButton)).$ctor1(G.buttons).indexOf(tmp);
                        } else {
                            var i = 0;
                            while (i < G.axes.length && ret.map === -1) {
                                if (Math.abs(G.axes[System.Array.index(i, G.axes)]) > 0.7 && Math.abs(G.axes[System.Array.index(i, G.axes)]) < 2.0) {
                                    ret.axis = true;
                                    ret.map = i;
                                    if (G.axes[System.Array.index(i, G.axes)] < 0) {
                                        ret.name = "anti";
                                        ret.antimap = i;
                                    }
                                }
                                i = (i + 1) | 0;
                            }
                        }
                    }
                });
                if (ret.map !== -1) {
                    return ret;
                }
                return null;
            },
            getMapControllerID: function (map) {
                if (!Bridge.referenceEquals(map.controllerID, "")) {
                    return map.controllerID;
                } else {
                    return this.id;
                }
            },
            getMapControllerID$1: function (action) {
                return this.getMapControllerID(this.InputMapping.getItem(action));
            },
            getGamepadMapState: function (map) {
                var TID = this.id;
                if (!Bridge.referenceEquals(map.controllerID, "")) {
                    TID = map.controllerID;
                }
                var P = CirnoGame.GamePadManager._this.GetPad(TID);
                if (P == null || !P.connected) {
                    return 0;
                }
                if (!map.axis) {
                    if (P.buttons[System.Array.index(map.map, P.buttons)].pressed) {
                        return 1;
                    } else if (map.antimap >= 0 && P.buttons[System.Array.index(map.antimap, P.buttons)].pressed) {
                        return -1;
                    }
                    return 0;
                } else {
                    return P.axes[System.Array.index(map.map, P.axes)];
                }
            },
            getKeyboardMapState: function (map) {
                var L = CirnoGame.KeyboardManager._this.PressedButtons;
                if (L.contains(map.map)) {
                    return 1.0;
                } else if (L.contains(map.antimap)) {
                    return -1.0;
                }
                return 0;
            },
            getMouseMapState: function (map) {
                var L = CirnoGame.KeyboardManager._this.PressedMouseButtons;
                if (L.contains(map.map)) {
                    return 1.0;
                } else if (L.contains(map.antimap)) {
                    return -1.0;
                }
                return 0;
            }
        }
    });

    Bridge.define("CirnoGame.InputControllerManager", {
        statics: {
            fields: {
                __this: null
            },
            props: {
                _this: {
                    get: function () {
                        if (CirnoGame.InputControllerManager.__this == null) {
                            CirnoGame.InputControllerManager.__this = new CirnoGame.InputControllerManager();
                        }
                        return CirnoGame.InputControllerManager.__this;
                    }
                }
            },
            methods: {
                Init: function () {
                    if (CirnoGame.InputControllerManager.__this == null) {
                        CirnoGame.InputControllerManager.__this = new CirnoGame.InputControllerManager();
                    }
                }
            }
        },
        fields: {
            Controllers: null
        },
        ctors: {
            ctor: function () {
                this.$initialize();
                this.Controllers = new (System.Collections.Generic.List$1(CirnoGame.InputController)).ctor();

                this.Controllers.add(new CirnoGame.InputController());
                var gamepads = CirnoGame.GamePadManager._this.activeGamepads;
                var i = 0;
                while (i < gamepads.Count) {
                    this.Controllers.add(new CirnoGame.InputController(gamepads.getItem(i).id));
                    i = (i + 1) | 0;
                }
            }
        }
    });

    Bridge.define("CirnoGame.InputMap", {
        fields: {
            map: 0,
            antimap: 0,
            name: null,
            axis: false,
            controllerID: null
        },
        ctors: {
            init: function () {
                this.map = -1;
                this.antimap = -1;
                this.name = "";
                this.axis = false;
                this.controllerID = "";
            },
            ctor: function () {
                this.$initialize();
                this.axis = false;
            },
            $ctor1: function (map, antimap, axis) {
                if (antimap === void 0) { antimap = -1; }
                if (axis === void 0) { axis = false; }

                this.$initialize();
                this.map = map;
                this.antimap = antimap;
                this.axis = axis;
            }
        }
    });

    Bridge.define("CirnoGame.JSONArchive", {
        statics: {
            methods: {
                Open: function (ArchiveFile, action) {
                    var XHR = new XMLHttpRequest();
                    //XHR.ResponseType = XMLHttpRequestResponseType.Blob;
                    XHR.onload = function (Evt) {
                        action(new CirnoGame.JSONArchive(XHR.responseText));
                    };
                    XHR.open("GET", ArchiveFile, false);
                    XHR.send();
                    //if (XHR.Status)

                }
            }
        },
        fields: {
            Data: null,
            Images: null
        },
        ctors: {
            init: function () {
                this.Data = new (System.Collections.Generic.Dictionary$2(System.String,System.String))();
                this.Images = new (System.Collections.Generic.Dictionary$2(System.String,HTMLImageElement))();
            },
            ctor: function (Archive) {
                this.$initialize();
                //this.Archive = Archive;
                var D = JSON.parse(Archive);
                var i = 0;
                var ln = D.length;
                while (i < ln) {
                    var A = D[System.Array.index(Bridge.identity(i, (i = (i + 1) | 0)), D)];
                    this.Data.set(A[System.Array.index(0, A)].toLowerCase(), A[System.Array.index(1, A)]);
                }
            }
        },
        methods: {
            PreloadImages: function (action, delay) {
                if (delay === void 0) { delay = 100; }
                var K = System.Linq.Enumerable.from(this.Data.getKeys()).toArray();
                var i = 0;
                while (i < this.Data.count) {
                    var A = K[System.Array.index(i, K)];
                    this.GetImage(A);
                    i = (i + 1) | 0;
                }
                Bridge.global.setTimeout(action, delay);
            },
            GetData: function (file) {
                var f = file.toLowerCase();
                if (this.Data.containsKey(f)) {
                    return this.Data.get(f);
                }
                return null;
            },
            GetImage: function (file) {
                var f = file.toLowerCase();
                if (this.Images.containsKey(f)) {
                    return this.Images.get(f);
                }
                var D = this.GetData(f);
                if (D == null) {
                    return null;
                }
                var ret = new Image();
                ret.onload = function (E) {
                    console.log(System.String.concat("loaded ", f, " from JSON!"));
                };
                ret.src = System.String.concat("data:image/png;base64,", D);
                this.Images.set(f, ret);
                return ret;
            }
        }
    });

    Bridge.define("CirnoGame.KeyboardManager", {
        statics: {
            fields: {
                __this: null
            },
            props: {
                _this: {
                    get: function () {
                        if (CirnoGame.KeyboardManager.__this == null) {
                            CirnoGame.KeyboardManager.__this = new CirnoGame.KeyboardManager();
                        }
                        return CirnoGame.KeyboardManager.__this;
                    }
                }
            },
            methods: {
                Init: function () {
                    if (CirnoGame.KeyboardManager.__this == null) {
                        CirnoGame.KeyboardManager.__this = new CirnoGame.KeyboardManager();
                    }
                },
                Update: function () {
                    CirnoGame.KeyboardManager.__this.TappedButtons.clear();
                    CirnoGame.KeyboardManager.__this.TappedMouseButtons.clear();
                },
                NeverinBounds: function (evt) {
                    return !CirnoGame.App.ScreenBounds.containsPoint$1(CirnoGame.KeyboardManager._this.CMouse.X, CirnoGame.KeyboardManager._this.CMouse.Y);
                },
                onKeyDown: function (evt) {
                    var keyCode = evt.keyCode;

                    if (!CirnoGame.KeyboardManager.__this.PressedButtons.contains(keyCode)) {
                        CirnoGame.KeyboardManager.__this.PressedButtons.add(keyCode);
                        CirnoGame.KeyboardManager.__this.TappedButtons.add(keyCode);
                    }
                    if ((keyCode >= 37 && keyCode <= 40) || keyCode === 32 || keyCode === 112) {
                        return false;
                    }
                    return true;
                },
                onKeyUp: function (evt) {
                    var keyCode = evt.keyCode;

                    if (CirnoGame.KeyboardManager.__this.PressedButtons.contains(keyCode)) {
                        CirnoGame.KeyboardManager.__this.PressedButtons.remove(keyCode);
                    }
                },
                onMouseDown: function (evt) {
                    var btn = evt.button;
                    if (!CirnoGame.KeyboardManager.__this.PressedMouseButtons.contains(btn)) {
                        CirnoGame.KeyboardManager.__this.PressedMouseButtons.add(btn);
                        CirnoGame.KeyboardManager.__this.TappedMouseButtons.add(btn);
                    }
                    return btn < 1;
                },
                onMouseUp: function (evt) {
                    var btn = evt.button;
                    if (CirnoGame.KeyboardManager.__this.PressedMouseButtons.contains(btn)) {
                        CirnoGame.KeyboardManager.__this.PressedMouseButtons.remove(btn);
                    }
                    return btn < 1;
                },
                onMouseMove: function (evt) {
                    CirnoGame.KeyboardManager._this.MousePosition = new CirnoGame.Vector2(evt.clientX, evt.clientY);

                    //float left = float.Parse(App.Canvas.Style.Left.Replace("px", ""));
                    if (System.String.indexOf(CirnoGame.App.Div.style.left, "px") < 0) {
                        return;
                    }
                    var left = System.Single.parse(System.String.replaceAll(CirnoGame.App.Div.style.left, "px", ""));
                    var x = evt.clientX - left;
                    var y = evt.clientY;

                    //float scale = (App.Canvas.Width * 1.25f) / float.Parse(App.Canvas.Style.Width.Replace("px", ""));

                    //float scale = (App.Canvas.Width) / float.Parse(App.Canvas.Style.Width.Replace("px", ""));
                    var scale = (CirnoGame.App.Canvas.width) / System.Single.parse(System.String.replaceAll(CirnoGame.App.Div.style.width, "px", ""));
                    CirnoGame.KeyboardManager._this.CMouse = new CirnoGame.Vector2(x * scale, y * scale);
                    //Console.WriteLine("mx:"+_this.CMouse.x + " my:" + _this.CMouse.y);
                }
            }
        },
        fields: {
            PressedButtons: null,
            TappedButtons: null,
            PressedMouseButtons: null,
            TappedMouseButtons: null,
            MousePosition: null,
            CMouse: null
        },
        ctors: {
            init: function () {
                this.MousePosition = new CirnoGame.Vector2();
                this.CMouse = new CirnoGame.Vector2();
            },
            ctor: function () {
                this.$initialize();
                this.PressedButtons = new (System.Collections.Generic.List$1(System.Int32)).ctor();
                this.TappedButtons = new (System.Collections.Generic.List$1(System.Int32)).ctor();
                this.PressedMouseButtons = new (System.Collections.Generic.List$1(System.Int32)).ctor();
                this.TappedMouseButtons = new (System.Collections.Generic.List$1(System.Int32)).ctor();

                var KD = CirnoGame.KeyboardManager.onKeyDown;
                document.onkeydown = KD;

                var KU = CirnoGame.KeyboardManager.onKeyUp;
                document.onkeyup = KU;

                var MM = CirnoGame.KeyboardManager.onMouseMove;
                document.onmousemove = MM;

                var MD = CirnoGame.KeyboardManager.onMouseDown;
                document.onmousedown = MD;

                var MU = CirnoGame.KeyboardManager.onMouseUp;
                document.onmouseup = MU;

                var NB = CirnoGame.KeyboardManager.NeverinBounds;
                document.oncontextmenu = NB;
            }
        }
    });

    Bridge.define("CirnoGame.MapGenerator", {
        statics: {
            fields: {
                rootroom: null,
                doorroom: null,
                keyroom: null,
                blank: null
            },
            ctors: {
                init: function () {
                    this.blank = new CirnoGame.TileData();
                }
            },
            methods: {
                Generate: function (game) {
                    var player = game.player; //player character
                    var map = game.TM; //the tilemap to generate
                    var bounds = game.stageBounds; //the bounds to stay within

                    //List<Rectangle> rooms = new List<Rectangle>();

                    var X = 0;
                    var Y = 0;
                    if (Math.random() < 0.5) {
                        X = Math.random() < 0.5 ? -1 : 1;
                    } else {
                        Y = Math.random() < 0.5 ? -1 : 1;
                    }
                    var T = new CirnoGame.TileData();
                    T.texture = 1;
                    T.enabled = true;
                    T.visible = true;
                    T.map = map;
                    T.solid = true;
                    T.topSolid = true;
                    //map.SetAll(T);
                    player.x = (bounds.left + bounds.right) / 2;
                    player.y = (bounds.top + bounds.bottom) / 2;
                    //pathMiner(game,map.columns/2,map.rows/2,X,Y,20);
                    CirnoGame.MapGenerator.pathMiner(game, ((Bridge.Int.div(map.columns, 2)) | 0), ((Bridge.Int.div(map.rows, 4)) | 0), X, Y, 30);

                    var V = CirnoGame.MapGenerator.FindEmptySpace(game);
                    if (CirnoGame.Vector2.op_Inequality(V, null)) {
                        player.x = V.X;
                        player.y = V.Y;
                        console.log("spawning at:" + Bridge.Int.clip32(V.X) + "," + Bridge.Int.clip32(V.Y));
                    } else {
                        console.log("cannot locate a spawn point...");
                    }
                },
                BoxyGenerate: function (game) {
                    console.log("boxy generate");
                    var player = game.player; //player character
                    var map = game.TM; //the tilemap to generate
                    var bounds = game.stageBounds; //the bounds to stay within
                    CirnoGame.MapRoom.PlacedRooms = new (System.Collections.Generic.List$1(CirnoGame.MapRoom)).ctor();
                    CirnoGame.MapRoom.OpenRooms = new (System.Collections.Generic.List$1(CirnoGame.MapRoom)).ctor();

                    var SX = (Bridge.Int.div(map.columns, 2)) | 0;
                    var SY = (Bridge.Int.div(map.rows, 3)) | 0;
                    var root = new CirnoGame.MapRoom();
                    root.SX = SX;
                    root.SY = SY;
                    root.EX = (((SX + 6) | 0) + Bridge.Int.clip32((Math.random() * 10))) | 0;
                    root.EY = (((SY + 6) | 0) + Bridge.Int.clip32((Math.random() * 10))) | 0;

                    root.game = game;
                    CirnoGame.MapGenerator.rootroom = root;

                    //var roomtotal = 12+(int)(Math.Random() * 10);
                    //var roomtotal = 16 + (int)(Math.Random() * 16);

                    //var roomMinimum = 16;
                    var roomMinimum = (10 + Math.min(game.level, 4)) | 0;
                    var roomtotal = (roomMinimum + Bridge.Int.clip32((Math.random() * (roomMinimum)))) | 0;
                    //var rooms = 0;

                    var attempts = 400;
                    var R = root;
                    if (!root.PlaceAndExpand()) {
                        console.log("Couldn't generate root room.");
                        return;
                    }
                    while (CirnoGame.MapRoom.OpenRooms.Count < roomtotal && attempts > 0) {
                        var L = CirnoGame.HelperExtensions.Pick(Bridge.global.CirnoGame.MapRoom, CirnoGame.MapRoom.FindValidUnplacedRooms());
                        if (L.PlaceAndExpand()) {
                            //rooms++;
                        }
                        attempts = (attempts - 1) | 0;
                    }
                    var RR = CirnoGame.Rectangle.op_Subtraction(game.stageBounds, game.TM.position);
                    RR.width -= game.TM.tilesize;
                    RR.height -= game.TM.tilesize;
                    game.TM.DrawRect(RR);
                    game.TM.ApplyBreakable();
                    var secrets = Math.random() < 0.3 ? 1 : 0;
                    if (secrets > 0 && Math.random() < 0.3) {
                        secrets = (secrets + 1) | 0;
                    }
                    while (secrets > 0) {
                        var L1 = CirnoGame.HelperExtensions.Pick(Bridge.global.CirnoGame.MapRoom, CirnoGame.MapRoom.FindValidUnplacedRooms());
                        if (L1.PlaceAndExpand()) {
                            L1.MakeSecret();
                            var lever = CirnoGame.MapGenerator.AttemptCreateLever(game, L1);
                            game.AddEntity(lever);
                            console.log("Placed secret room at:" + L1.SX + "," + L1.SY);
                        }
                        secrets = (secrets - 1) | 0;
                    }
                    var V = CirnoGame.MapGenerator.FindEmptySpace(game);
                    CirnoGame.MapGenerator.keyroom = null;
                    if (CirnoGame.Vector2.op_Inequality(V, null)) {
                        /* player.x = V.X;
                        player.y = V.Y;*/
                        game.Door.Position.CopyFrom(V);
                        game.Door.DropToGround();
                        CirnoGame.MapGenerator.doorroom = CirnoGame.MapRoom.FindRoom(game.Door.Position);
                        if (CirnoGame.MapGenerator.doorroom == null) {
                            console.log("Door room could not be determined...");
                        }

                        var PC = player;
                        //PC.MoveToNewSpawn(V);
                        PC.MoveToNewSpawn(game.Door.Position);
                        console.log("spawning at:" + Bridge.Int.clip32(V.X) + "," + Bridge.Int.clip32(V.Y));
                    } else {
                        console.log("cannot locate a spawn point...");
                    }

                },
                AttemptCreateLever: function (game, Target) {
                    var i = 0;
                    while (i < 20) {
                        var lever = CirnoGame.RoomOpeningLever.FindAndPlaceOnWall(game, CirnoGame.MapRoom.FindAnyEmptySpot(), Target);
                        if (lever != null) {
                            return lever;
                        }
                    }
                    return null;
                },
                FindEmptySpace: function (game) {
                    var map = game.TM;
                    var bounds = game.stageBounds; //the bounds to stay within
                    var i = 0;
                    var ret = new CirnoGame.Vector2();
                    var tmp = new CirnoGame.Vector2();
                    while (i < 2000) {
                        ret.X = bounds.left + (Math.random() * (bounds.width - map.tilesize));
                        ret.Y = bounds.top + (Math.random() * (bounds.bottom - map.tilesize));
                        if (!map.CheckForTile(ret).visible) {
                            tmp.X = ret.X;
                            tmp.Y = ret.Y - map.tilesize;
                            if (!map.CheckForTile(ret).visible) {
                                return ret;
                            }
                        }
                        i = (i + 1) | 0;
                    }
                    //return ret;
                    return null;
                },
                pathMiner: function (game, X, Y, Xdir, YDir, limit) {
                    if (limit <= 0) {
                        return;
                    }
                    var player = game.player; //player character
                    var map = game.TM; //the tilemap to generate
                    var bounds = game.stageBounds; //the bounds to stay within

                    var dist = 0;
                    var pow = 1;
                    if (YDir !== 0) {
                        pow = 2;
                    }
                    while (dist < 7 && Math.random() < (Math.pow(0.95, pow))) {
                        X = (X + Xdir) | 0;
                        Y = (Y + YDir) | 0;
                        CirnoGame.MapGenerator.Erase(map, X, Y, 3);
                        if (Math.random() < (0.2 * pow)) {
                            if (Xdir === 0) {
                                X = (X + (Math.random() < 0.5 ? 1 : -1)) | 0;
                            } else {
                                Y = (Y + (Math.random() < 0.5 ? 1 : -1)) | 0;
                            }
                        } else if (Math.random() < (0.02 * pow) && limit > 4) {
                            limit = (Bridge.Int.div(limit, 2)) | 0;
                            var XD = Math.random() < 0.5 ? YDir : ((-YDir) | 0);
                            var YD = Math.random() < 0.5 ? Xdir : ((-Xdir) | 0);
                            CirnoGame.MapGenerator.pathMiner(game, X, Y, XD, YD, limit);
                        }
                    }
                    limit = (limit - 1) | 0;
                    if (limit > 1) {
                        CirnoGame.MapGenerator.roomMiner(game, X, Y, Xdir, YDir, limit);
                    }

                },
                roomMiner: function (game, X, Y, Xdir, YDir, limit) {
                    if (limit <= 0) {
                        return;
                    }

                    var SZ = Bridge.Int.clip32(4 + (Math.random() * 4));
                    X = (X + (Bridge.Int.mul(Xdir, (((Bridge.Int.div(SZ, 2)) | 0))))) | 0;
                    Y = (Y + (Bridge.Int.mul(YDir, (((Bridge.Int.div(SZ, 2)) | 0))))) | 0;

                    //Erase(game.TM, X, Y, (SZ * 2)+2);
                    CirnoGame.MapGenerator.EraseAndRando(game.TM, X, Y, (((Bridge.Int.mul(SZ, 2)) + 2) | 0));

                    var XD = Xdir;
                    var YD = YDir;
                    if (Math.random() < 0.2 || (YD !== 0 && Math.random() < 0.65) || YD < 0) {
                        XD = Math.random() < 0.5 ? YDir : ((-YDir) | 0);
                        YD = Math.random() < 0.5 ? Xdir : ((-Xdir) | 0);
                        if (YD < 0) {
                            YD = (-YD) | 0;
                        }
                    }
                    Xdir = XD;
                    YDir = YD;

                    X = (X + (Bridge.Int.mul(Xdir, (((Bridge.Int.div(SZ, 2)) | 0))))) | 0;
                    Y = (Y + (Bridge.Int.mul(YDir, (((Bridge.Int.div(SZ, 2)) | 0))))) | 0;

                    limit = (limit - 1) | 0;
                    CirnoGame.MapGenerator.pathMiner(game, X, Y, Xdir, YDir, limit);
                },
                Erase: function (TM, column, row, size) {
                    TM.ClearRect$1(((column - (((Bridge.Int.div(size, 2)) | 0))) | 0), ((row - (((Bridge.Int.div(size, 2)) | 0))) | 0), (size), (size));
                },
                EraseAndRando: function (TM, column, row, size) {
                    var SX = (column - (((Bridge.Int.div(size, 2)) | 0))) | 0;
                    var SY = (row - (((Bridge.Int.div(size, 2)) | 0))) | 0;
                    TM.ClearRect$1(SX, SY, (size), (size));
                    TM._GenRect(SX, SY, ((SX + (size)) | 0), ((SY + (size)) | 0));
                }
            }
        }
    });

    Bridge.define("CirnoGame.MapRoom", {
        statics: {
            fields: {
                PlacedRooms: null,
                OpenRooms: null,
                RNG: null
            },
            ctors: {
                init: function () {
                    this.PlacedRooms = new (System.Collections.Generic.List$1(CirnoGame.MapRoom)).ctor();
                    this.OpenRooms = new (System.Collections.Generic.List$1(CirnoGame.MapRoom)).ctor();
                    this.RNG = new System.Random.ctor();
                }
            },
            methods: {
                FindValidUnplacedRooms: function () {
                    var L = new (System.Collections.Generic.List$1(CirnoGame.MapRoom)).ctor();
                    var i = 0;
                    var ln = CirnoGame.MapRoom.OpenRooms.Count;
                    while (i < ln) {
                        var P = CirnoGame.MapRoom.OpenRooms.getItem(i);
                        L.addRange(System.Linq.Enumerable.from(P.ExitRooms).where(function (F) {
                                return F.CanBePlaced() && !F.placed;
                            }));
                        i = (i + 1) | 0;
                    }
                    return L;
                },
                FindRoom: function (V) {
                    var L = System.Linq.Enumerable.from(CirnoGame.MapRoom.OpenRooms).where(function (R) {
                            return R.ContainsPosition(V);
                        }).toArray(CirnoGame.MapRoom);
                    if (L.length > 0) {
                        return L[System.Array.index(0, L)];
                    }
                    return null;
                },
                FindAnyEmptySpot: function () {
                    if (CirnoGame.MapRoom.OpenRooms.Count < 1) {
                        return null;
                    }
                    var i = 0;
                    while (i < 10) {
                        var ret = CirnoGame.HelperExtensions.Pick(Bridge.global.CirnoGame.MapRoom, CirnoGame.MapRoom.OpenRooms, CirnoGame.MapRoom.RNG).FindEmptySpot();
                        if (CirnoGame.Vector2.op_Inequality(ret, null)) {
                            return ret;
                        }
                        i = (i + 1) | 0;
                    }
                    return null;
                }
            }
        },
        fields: {
            SX: 0,
            SY: 0,
            EX: 0,
            EY: 0,
            placed: false,
            secret: false,
            ExitRooms: null,
            parent: null,
            goldchests: null,
            game: null
        },
        ctors: {
            init: function () {
                this.placed = false;
                this.secret = false;
                this.ExitRooms = new (System.Collections.Generic.List$1(CirnoGame.MapRoom)).ctor();
                this.goldchests = System.Array.init(0, null, CirnoGame.Chest);
            }
        },
        methods: {
            IsValid: function () {
                var map = this.game.TM;
                if (this.SX >= 0 && this.SY >= 0 && this.EX < map.columns && this.EY < map.rows) {
                    //in bounds
                    return true;
                }
                return false;
            },
            CanBePlaced: function () {
                var map = this.game.TM;
                if (this.IsValid()) {
                    if (map.IsRectSolid(this.SX, this.SY, this.EX, this.EY)) {
                        return true;
                    }
                }
                return false;
            },
            GenerateAdjacentRooms: function () {
                var M = this.GenerateAdjacentRoom(-1, 0);
                if (M != null) {
                    this.ExitRooms.add(M);
                }
                M = this.GenerateAdjacentRoom(1, 0);
                if (M != null) {
                    this.ExitRooms.add(M);
                }
                if (Math.random() < 0.5) {
                    M = this.GenerateAdjacentRoom(0, -1);
                    if (M != null) {
                        this.ExitRooms.add(M);
                    }
                    M = this.GenerateAdjacentRoom(0, 1);
                    if (M != null) {
                        this.ExitRooms.add(M);
                    }
                }
            },
            GenerateAdjacentRoom: function (Xdir, Ydir) {
                /* var min = 6;
                var max = 18;*/
                var min = 5;
                var max = 13;
                var dif = (((max - min) | 0));
                var W = Bridge.Int.clip32(min + (Math.random() * dif));

                //min += 1;
                min = (min - 1) | 0;
                max = (max - 3) | 0;
                dif = (((max - min) | 0));
                var H = Bridge.Int.clip32(min + (Math.random() * dif));

                var X = -1;
                var Y = -1;
                if (Xdir !== 0) {
                    Y = Bridge.Int.clip32(this.SY + (Math.random() * (((this.EY - this.SY) | 0))));
                    if (Xdir < 0) {
                        X = (this.SX - W) | 0;
                    } else {
                        X = this.EX;
                    }
                } else if (Ydir !== 0) {
                    X = Bridge.Int.clip32(this.SX + Math.random() * ((((this.EX - this.SX) | 0))));
                    if (Ydir < 0) {
                        Y = (this.SY - H) | 0;
                    } else {
                        Y = this.EY;
                    }
                }

                if (X >= 0 && Y >= 0) {
                    var M = new CirnoGame.MapRoom();
                    M.SX = X;
                    M.SY = Y;
                    M.EX = (X + W) | 0;
                    M.EY = (Y + H) | 0;
                    M.parent = this;
                    M.game = this.game;
                    if (M.CanBePlaced()) {
                        return M;
                    }
                }
                return null;
            },
            ContainsTile: function (X, Y) {
                return X >= this.SX && Y >= this.SY && X < this.EX && Y < this.EY;
            },
            ContainsPosition: function (V) {
                var X = Bridge.Int.clip32((V.X - this.game.TM.position.X) / this.game.TM.tilesize);
                var Y = Bridge.Int.clip32((V.Y - this.game.TM.position.Y) / this.game.TM.tilesize);
                return X >= this.SX && Y >= this.SY && X < this.EX && Y < this.EY;
            },
            /**
             * clears out the room's area, and attempts to generate exitrooms.
             If the room is invalid it does nothing, and removes itself from it's parent list.
             *
             * @instance
             * @public
             * @this CirnoGame.MapRoom
             * @memberof CirnoGame.MapRoom
             * @return  {boolean}        returns true if it was valid and was placed.
             */
            PlaceAndExpand: function () {
                if (this.ExitRooms.Count < 1 && !this.placed && this.CanBePlaced()) {
                    this.Place();
                    if (this.placed) {
                        this.GenerateAdjacentRooms();
                    }
                    return this.placed;
                } else if (!this.placed) {
                    if (this.parent != null) {
                        if (CirnoGame.HelperExtensions.ContainsB$1(Bridge.global.CirnoGame.MapRoom, this.parent.ExitRooms, this)) {
                            this.parent.ExitRooms.remove(this);
                        }
                    }
                }
                return false;
            },
            GenerateGoldChests: function () {
                var locked = !CirnoGame.MapRoom.OpenRooms.contains(this);

                var V = this.FindEmptySpot();
                var chest = new CirnoGame.Chest(this.game);
                this.goldchests.push(chest);
                chest.ForceLocked = locked;
                chest.Position.CopyFrom(V);
                chest.Goldify();
                this.game.AddEntity(chest);

                var V2 = this.FindEmptySpot();
                var attempts = 0;
                while (Bridge.identity(attempts, (attempts = (attempts + 1) | 0)) < 5 && (CirnoGame.Vector2.op_Equality(V2, null) || Math.abs(V2.X - V.X) < 16)) {
                    V2 = this.FindEmptySpot();
                }

                if (CirnoGame.Vector2.op_Inequality(V2, null) && Math.abs(V2.X - V.X) > 16) {
                    chest = new CirnoGame.Chest(this.game);
                    this.goldchests.push(chest);
                    chest.Position.CopyFrom(V2);
                    chest.ForceLocked = locked;
                    chest.Goldify();
                    this.game.AddEntity(chest);
                }
            },
            NMakeSecret: function () {
                var TM = this.game.TM;
                var W = (this.EX - this.SX) | 0;
                var H = (this.EY - this.SY) | 0;
                //TM.FillRect(SX, SY, W, H);
                //ClearRoom();
                TM.DrawRect$1(this.SX, this.SY, W, H);
                TM.SetBreakableRect(this.SX, this.SY, W, H, false);
                TM.ClearRect$1(((this.SX + 1) | 0), ((this.SY + 1) | 0), ((W - 2) | 0), ((H - 2) | 0));

                if (CirnoGame.MapRoom.OpenRooms.contains(this)) {
                    CirnoGame.MapRoom.OpenRooms.remove(this);
                }
                this.secret = true;

                this.GenerateGoldChests();

                this.ForceRedraw();
            },
            MakeSecret: function () {
                var TM = this.game.TM;
                var W = (this.EX - this.SX) | 0;
                var H = (this.EY - this.SY) | 0;
                TM.FillRect(this.SX, this.SY, W, H);
                TM.SetBreakableRect(this.SX, this.SY, W, H, false);
                TM.SetBreakableRect(((this.SX + 1) | 0), ((this.SY + 1) | 0), ((W - 2) | 0), ((H - 2) | 0), true);
                if (CirnoGame.MapRoom.OpenRooms.contains(this)) {
                    CirnoGame.MapRoom.OpenRooms.remove(this);
                }
                this.secret = true;
            },
            NUnleashSecret: function () {
                var TM = this.game.TM;

                TM.ClearOuterRect(this.SX, this.SY, (((this.EX - this.SX) | 0)), (((this.EY - this.SY) | 0)), false);
                //TM.ClearRect(SX+1, SY+1, (EX - SX)-2, (EY - SY)-2);
                //TM._GenRect(SX, SY, EX, EY);

                CirnoGame.MapRoom.OpenRooms.add(this);
                CirnoGame.HelperExtensions.ForEach(Bridge.global.CirnoGame.Chest, this.goldchests, function (C) {
                    C.ForceLocked = false;
                });

                this.ForceRedraw();
            },
            UnleashSecret: function () {
                var TM = this.game.TM;

                TM.ClearRect$1(((this.SX + 1) | 0), ((this.SY + 1) | 0), (((((this.EX - this.SX) | 0)) - 2) | 0), (((((this.EY - this.SY) | 0)) - 2) | 0));
                TM._GenRect(this.SX, this.SY, this.EX, this.EY);

                CirnoGame.MapRoom.OpenRooms.add(this);

                this.GenerateGoldChests();
                this.ForceRedraw();
            },
            ClearRoom: function () {
                var TM = this.game.TM;

                TM.ClearRect$1(this.SX, this.SY, ((this.EX - this.SX) | 0), ((this.EY - this.SY) | 0));
            },
            GeneratePlatforms: function () {
                var TM = this.game.TM;
                TM._GenRect(this.SX, this.SY, this.EX, this.EY);
            },
            Place: function () {
                var TM = this.game.TM;
                TM.ClearRect$1(this.SX, this.SY, ((this.EX - this.SX) | 0), ((this.EY - this.SY) | 0));
                TM._GenRect(this.SX, this.SY, this.EX, this.EY);

                CirnoGame.MapRoom.PlacedRooms.add(this);
                CirnoGame.MapRoom.OpenRooms.add(this);
                this.placed = true;
            },
            ApplyBreakable: function () {
                var TM = this.game.TM;
                TM.ApplyBreakableRect(((this.SX - 2) | 0), ((this.SY - 2) | 0), (((((this.EX - this.SX) | 0)) + 4) | 0), (((((this.EY - this.SY) | 0)) + 4) | 0));
            },
            ForceRedraw: function () {
                var TM = this.game.TM;
                var X = (this.SX - 2) | 0;
                var Y = (this.SY - 2) | 0;
                var W = ((((this.EX - this.SX) | 0)) + 4) | 0;
                var H = ((((this.EY - this.SY) | 0)) + 4) | 0;
                TM.bg.clearRect(Bridge.Int.mul(Bridge.Int.clip32(TM.tilesize), X), Bridge.Int.mul(Bridge.Int.clip32(TM.tilesize), Y), Bridge.Int.mul(Bridge.Int.clip32(TM.tilesize), W), Bridge.Int.mul(Bridge.Int.clip32(TM.tilesize), H));

                TM.Redraw(TM.bg, X, Y, W, H);
            },
            FindEmptySpot: function () {
                var W = (this.EX - this.SX) | 0;
                var H = (this.EY - this.SY) | 0;
                var i = 0;
                var map = this.game.TM;
                while (i < 50) {
                    var X = Bridge.Int.clip32(this.SX + Math.random() * W);
                    var Y = Bridge.Int.clip32(this.SY + Math.random() * H);
                    var T = map.GetTile(X, Y);
                    if (T != null && (!T.enabled || !T.solid)) {
                        T = map.GetTile(X, ((Y - 1) | 0));
                        if (T != null && (!T.enabled || !T.solid)) {
                            return new CirnoGame.Vector2(map.position.X + (X * map.tilesize), map.position.Y + (Y * map.tilesize));
                        }
                    }
                    i = (i + 1) | 0;
                }
                return null;
            }
        }
    });

    Bridge.define("CirnoGame.MathHelper", {
        statics: {
            fields: {
                PI: 0,
                PI2: 0,
                PIOver2: 0
            },
            ctors: {
                init: function () {
                    this.PI = 3.14159274;
                    this.PI2 = 6.28318548;
                    this.PIOver2 = 1.57079637;
                }
            },
            methods: {
                DistanceBetweenPoints: function (A, B) {
                    return CirnoGame.MathHelper.DistanceBetweenPoints$1(A.X, A.Y, B.X, B.Y);
                },
                DistanceBetweenPoints$1: function (x1, y1, x2, y2) {
                    return Math.sqrt((Math.pow(x1 - x2, 2) + Math.pow(y1 - y2, 2)));
                },
                Clamp$1: function (value, min, max) {
                    return Math.min(max, Math.max(min, value));
                },
                Clamp: function (value, min, max) {
                    if (min === void 0) { min = 0.0; }
                    if (max === void 0) { max = 1.0; }
                    return Math.min(max, Math.max(min, value));
                },
                Lerp$1: function (value1, value2, amount) {
                    return value1 + ((value2 - value1) * amount);
                },
                Lerp: function (D1, D2, lerp) {
                    lerp = CirnoGame.MathHelper.Clamp(lerp);
                    return (D1 * (1 - lerp)) + (D2 * lerp);
                },
                DegreesToRadians: function (degrees) {
                    return degrees * 0.0174532924;
                },
                RadiansToDegrees: function (radians) {
                    return radians * 57.29578;
                },
                GetAngle$1: function (a, b) {
                    var angle = Math.atan2(b.Y - a.Y, b.X - a.X);
                    return angle;
                },
                GetAngle: function (a) {
                    var angle = Math.atan2(a.Y, a.X);
                    return angle;
                },
                RoughDistanceBetweenPoints: function (a, b) {
                    //return (float)(Math.Abs(a.x - b.x) + Math.Abs(a.y - b.y));
                    return (CirnoGame.Vector2.op_Subtraction(a, b)).RoughLength;
                },
                MagnitudeOfRectangle: function (R) {
                    return R.width + R.height;
                },
                WrapRadians: function (radian) {
                    while (radian < -3.14159274) {
                        radian += CirnoGame.MathHelper.PI2;
                    }
                    while (radian >= CirnoGame.MathHelper.PI) {
                        radian -= CirnoGame.MathHelper.PI2;
                    }
                    return radian;
                    //return radian % PI2;
                },
                incrementTowards: function (current, destination, speed) {
                    if (current < destination) {
                        current += speed;
                        if (current > destination) {
                            current = destination;
                        }
                    }
                    if (current > destination) {
                        current -= speed;
                        if (current < destination) {
                            current = destination;
                        }
                    }
                    return current;
                },
                incrementTowards$1: function (current, destination, incspeed, decspeed) {
                    if (current < destination) {
                        current += incspeed;
                        if (current > destination) {
                            current = destination;
                        }
                    }
                    if (current > destination) {
                        current -= decspeed;
                        if (current < destination) {
                            current = destination;
                        }
                    }
                    return current;
                },
                RadianToVector: function (radian) {
                    return new CirnoGame.Vector2(Math.cos(radian), Math.sin(radian));
                },
                Within: function (val, min, max) {
                    return val >= min && val <= max;
                },
                Mean: function (val) {
                    if (val === void 0) { val = []; }
                    var ret = 0;
                    var i = 0;
                    while (i < val.length) {
                        ret += val[System.Array.index(i, val)];
                        i = (i + 1) | 0;
                    }
                    ret /= val.length;
                    return ret;
                },
                Decelerate: function (momentum, deceleration) {
                    var dir = momentum >= 0;
                    momentum = (dir ? momentum : -momentum) - deceleration;
                    if (momentum < 0) {
                        return 0;
                    }
                    return dir ? momentum : -momentum;
                }
            }
        }
    });

    Bridge.define("CirnoGame.Point", {
        fields: {
            X: 0,
            Y: 0
        },
        ctors: {
            ctor: function (x, y) {
                if (x === void 0) { x = 0; }
                if (y === void 0) { y = 0; }

                this.$initialize();
                this.X = x;
                this.Y = y;
            }
        }
    });

    Bridge.define("CirnoGame.Rectangle", {
        statics: {
            methods: {
                op_Addition: function (A, B) {
                    return new CirnoGame.Rectangle(A.x + B.X, A.y + B.Y, A.width, A.height);
                },
                op_Subtraction: function (A, B) {
                    return new CirnoGame.Rectangle(A.x - B.X, A.y - B.Y, A.width, A.height);
                }
            }
        },
        fields: {
            x: 0,
            y: 0,
            width: 0,
            height: 0
        },
        props: {
            left: {
                get: function () {
                    return this.x;
                },
                set: function (value) {
                    this.x = value;
                }
            },
            top: {
                get: function () {
                    return this.y;
                },
                set: function (value) {
                    this.y = value;
                }
            },
            right: {
                get: function () {
                    return this.x + this.width;
                },
                set: function (value) {
                    this.width = value - this.x;
                }
            },
            bottom: {
                get: function () {
                    return this.y + this.height;
                },
                set: function (value) {
                    this.height = value - this.y;
                }
            },
            points: {
                get: function () {
                    var ret = System.Array.init(8, 0, System.Single);
                    var i = 0;
                    ret[System.Array.index(Bridge.identity(i, (i = (i + 1) | 0)), ret)] = this.x;
                    ret[System.Array.index(Bridge.identity(i, (i = (i + 1) | 0)), ret)] = this.y;

                    ret[System.Array.index(Bridge.identity(i, (i = (i + 1) | 0)), ret)] = this.right;
                    ret[System.Array.index(Bridge.identity(i, (i = (i + 1) | 0)), ret)] = this.y;

                    ret[System.Array.index(Bridge.identity(i, (i = (i + 1) | 0)), ret)] = this.right;
                    ret[System.Array.index(Bridge.identity(i, (i = (i + 1) | 0)), ret)] = this.bottom;

                    ret[System.Array.index(Bridge.identity(i, (i = (i + 1) | 0)), ret)] = this.x;
                    ret[System.Array.index(Bridge.identity(i, (i = (i + 1) | 0)), ret)] = this.bottom;

                    return ret;
                }
            },
            Center: {
                get: function () {
                    return new CirnoGame.Vector2(this.left + (this.width / 2), this.top + (this.height / 2));
                }
            },
            Min: {
                get: function () {
                    return new CirnoGame.Vector2(this.x, this.y);
                },
                set: function (value) {
                    if (CirnoGame.Vector2.op_Equality(value, null)) {
                        return;
                    }
                    this.x = value.X;
                    this.y = value.Y;
                }
            },
            Max: {
                get: function () {
                    return new CirnoGame.Vector2(this.right, this.bottom);
                },
                set: function (value) {
                    if (CirnoGame.Vector2.op_Equality(value, null)) {
                        return;
                    }
                    this.right = value.X;
                    this.bottom = value.Y;
                }
            }
        },
        ctors: {
            init: function () {
                this.x = 0;
                this.y = 0;
                this.width = 0;
                this.height = 0;
            },
            ctor: function (x, y, width, height) {
                if (x === void 0) { x = 0.0; }
                if (y === void 0) { y = 0.0; }
                if (width === void 0) { width = 0.0; }
                if (height === void 0) { height = 0.0; }

                this.$initialize();
                this.x = x;
                this.y = y;
                this.width = width;
                this.height = height;
            }
        },
        methods: {
            CopyFrom: function (R) {
                this.x = R.x;
                this.y = R.y;
                this.width = R.width;
                this.height = R.height;
            },
            GetCenter: function (OUT) {
                OUT.X = this.left + (this.width / 2);
                OUT.Y = this.top + (this.height / 2);
            },
            containsPoint$1: function (x, y) {
                if (x >= this.x && y >= this.y && x <= this.right && y <= this.bottom) {
                    return true;
                }
                return false;
            },
            containsPoint: function (point) {
                if (point.X >= this.x && point.Y >= this.y && point.X <= this.right && point.Y <= this.bottom) {
                    return true;
                }
                return false;
            },
            intersects: function (R) {
                var p = R.points;
                var contain = false;
                var outside = false;
                var i = 0;
                while (i < p.length) {
                    if (this.containsPoint$1(p[System.Array.index(Bridge.identity(i, (i = (i + 1) | 0)), p)], p[System.Array.index(Bridge.identity(i, (i = (i + 1) | 0)), p)])) {
                        contain = true;
                    } else {
                        outside = true;
                    }
                }
                if (contain && outside) {
                    return true;
                }
                if (R.left < this.left && R.right > this.right) {
                    //if ((top <= R.top && bottom <= R.top) || (top <= R.bottom && bottom <= R.bottom))
                    if ((this.top <= R.top && this.bottom >= R.top) || (this.top <= R.bottom && this.bottom >= R.bottom)) {
                        return true;
                    }
                }
                if (R.top < this.top && R.bottom > this.bottom) {
                    if ((this.left <= R.left && this.right >= R.left) || (this.left <= R.right && this.right >= R.right)) {
                        return true;
                    }
                }
                /* if (R.left < left && R.right > right)
                {
                   if ((top <= R.top && bottom <= R.top) || (top <= R.bottom && bottom <= R.bottom))
                   {
                       return true;
                   }
                }
                if (R.top < top && R.bottom > bottom)
                {
                   if ((left <= R.left && right <= R.left) || (left <= R.right && right <= R.right))
                   {
                       return true;
                   }
                }*/
                return false;
            },
            isTouching: function (R) {
                if (R == null) {
                    return false;
                }
                var p = R.points;
                var i = 0;
                while (i < p.length) {
                    if (this.containsPoint$1(p[System.Array.index(Bridge.identity(i, (i = (i + 1) | 0)), p)], p[System.Array.index(Bridge.identity(i, (i = (i + 1) | 0)), p)])) {
                        return true;
                    }
                }
                if (this.intersects(R)) {
                    return true;
                }
                /* if (R.left < left && R.right > right)
                {
                   if ((top<=R.top && bottom<=R.top) || (top <= R.bottom && bottom <= R.bottom))
                   {
                       return true;
                   }
                }
                if (R.top < top && R.bottom > bottom)
                {
                   if ((left <= R.left && right <= R.left) || (left <= R.right && right <= R.right))
                   {
                       return true;
                   }
                }*/
                return false;
            },
            Set: function (x, y, width, height) {
                if (x === void 0) { x = 0.0; }
                if (y === void 0) { y = 0.0; }
                if (width === void 0) { width = 0.0; }
                if (height === void 0) { height = 0.0; }
                this.x = x;
                this.y = y;
                this.width = width;
                this.height = height;
            }
        }
    });

    Bridge.define("CirnoGame.RectangleI", {
        statics: {
            methods: {
                op_Addition: function (A, B) {
                    return new CirnoGame.RectangleI(((A.x + B.X) | 0), ((A.y + B.Y) | 0), A.width, A.height);
                },
                op_Subtraction: function (A, B) {
                    return new CirnoGame.RectangleI(((A.x - B.X) | 0), ((A.y - B.Y) | 0), A.width, A.height);
                }
            }
        },
        fields: {
            x: 0,
            y: 0,
            width: 0,
            height: 0
        },
        props: {
            left: {
                get: function () {
                    return this.x;
                },
                set: function (value) {
                    this.x = value;
                }
            },
            top: {
                get: function () {
                    return this.y;
                },
                set: function (value) {
                    this.y = value;
                }
            },
            right: {
                get: function () {
                    return ((this.x + this.width) | 0);
                },
                set: function (value) {
                    this.width = (value - this.x) | 0;
                }
            },
            bottom: {
                get: function () {
                    return ((this.y + this.height) | 0);
                },
                set: function (value) {
                    this.height = (value - this.y) | 0;
                }
            },
            points: {
                get: function () {
                    var ret = System.Array.init(8, 0, System.Int32);
                    var i = 0;
                    ret[System.Array.index(Bridge.identity(i, (i = (i + 1) | 0)), ret)] = this.x;
                    ret[System.Array.index(Bridge.identity(i, (i = (i + 1) | 0)), ret)] = this.y;

                    ret[System.Array.index(Bridge.identity(i, (i = (i + 1) | 0)), ret)] = this.right;
                    ret[System.Array.index(Bridge.identity(i, (i = (i + 1) | 0)), ret)] = this.y;

                    ret[System.Array.index(Bridge.identity(i, (i = (i + 1) | 0)), ret)] = this.right;
                    ret[System.Array.index(Bridge.identity(i, (i = (i + 1) | 0)), ret)] = this.bottom;

                    ret[System.Array.index(Bridge.identity(i, (i = (i + 1) | 0)), ret)] = this.x;
                    ret[System.Array.index(Bridge.identity(i, (i = (i + 1) | 0)), ret)] = this.bottom;

                    return ret;
                }
            },
            Center: {
                get: function () {
                    return new CirnoGame.Point(((this.left + (((Bridge.Int.div(this.width, 2)) | 0))) | 0), ((this.top + (((Bridge.Int.div(this.height, 2)) | 0))) | 0));
                }
            },
            Min: {
                get: function () {
                    return new CirnoGame.Point(this.x, this.y);
                },
                set: function (value) {
                    if (value == null) {
                        return;
                    }
                    this.x = value.X;
                    this.y = value.Y;
                }
            },
            Max: {
                get: function () {
                    return new CirnoGame.Point(this.right, this.bottom);
                },
                set: function (value) {
                    if (value == null) {
                        return;
                    }
                    this.right = value.X;
                    this.bottom = value.Y;
                }
            }
        },
        ctors: {
            init: function () {
                this.x = 0;
                this.y = 0;
                this.width = 0;
                this.height = 0;
            },
            ctor: function (x, y, width, height) {
                if (x === void 0) { x = 0; }
                if (y === void 0) { y = 0; }
                if (width === void 0) { width = 0; }
                if (height === void 0) { height = 0; }

                this.$initialize();
                this.x = x;
                this.y = y;
                this.width = width;
                this.height = height;
            }
        },
        methods: {
            containsPoint$1: function (x, y) {
                if (x >= this.x && y >= this.y && x <= this.right && y <= this.bottom) {
                    return true;
                }
                return false;
            },
            containsPoint: function (point) {
                if (point.X >= this.x && point.Y >= this.y && point.X <= this.right && point.Y <= this.bottom) {
                    return true;
                }
                return false;
            },
            intersects: function (R) {
                var p = R.points;
                var contain = false;
                var outside = false;
                var i = 0;
                while (i < p.length) {
                    if (this.containsPoint$1(p[System.Array.index(Bridge.identity(i, (i = (i + 1) | 0)), p)], p[System.Array.index(Bridge.identity(i, (i = (i + 1) | 0)), p)])) {
                        contain = true;
                    } else {
                        outside = true;
                    }
                }
                if (contain && outside) {
                    return true;
                }
                if (R.left < this.left && R.right > this.right) {
                    //if ((top <= R.top && bottom <= R.top) || (top <= R.bottom && bottom <= R.bottom))
                    if ((this.top <= R.top && this.bottom >= R.top) || (this.top <= R.bottom && this.bottom >= R.bottom)) {
                        return true;
                    }
                }
                if (R.top < this.top && R.bottom > this.bottom) {
                    if ((this.left <= R.left && this.right >= R.left) || (this.left <= R.right && this.right >= R.right)) {
                        return true;
                    }
                }
                /* if (R.left < left && R.right > right)
                {
                   if ((top <= R.top && bottom <= R.top) || (top <= R.bottom && bottom <= R.bottom))
                   {
                       return true;
                   }
                }
                if (R.top < top && R.bottom > bottom)
                {
                   if ((left <= R.left && right <= R.left) || (left <= R.right && right <= R.right))
                   {
                       return true;
                   }
                }*/
                return false;
            },
            isTouching: function (R) {
                if (R == null) {
                    return false;
                }
                var p = R.points;
                var i = 0;
                while (i < p.length) {
                    if (this.containsPoint$1(p[System.Array.index(Bridge.identity(i, (i = (i + 1) | 0)), p)], p[System.Array.index(Bridge.identity(i, (i = (i + 1) | 0)), p)])) {
                        return true;
                    }
                }
                if (this.intersects(R)) {
                    return true;
                }
                return false;
            }
        }
    });

    Bridge.define("CirnoGame.Renderer", {
        fields: {
            view: null
        },
        ctors: {
            ctor: function (width, height, backgroundColor) {
                if (width === void 0) { width = 800; }
                if (height === void 0) { height = 600; }
                if (backgroundColor === void 0) { backgroundColor = 1087931; }

                this.$initialize();
                /* var width = 800;
                var height = 600;
                var backgroundColor = 0x1099bb;*/
                this.view = new PIXI.Application(width, height, {backgroundColor : backgroundColor});
            }
        }
    });

    Bridge.define("CirnoGame.TileData", {
        fields: {
            texture: 0,
            row: 0,
            column: 0,
            enabled: false,
            map: null,
            visible: false,
            topSolid: false,
            rightSolid: false,
            leftSolid: false,
            bottomSolid: false,
            CanSlope: false,
            Breakable: false,
            HP: 0,
            maxHP: 0,
            opaque: false,
            _hitbox: null,
            SteppedOn: null,
            HR: null
        },
        props: {
            solid: {
                get: function () {
                    return this.topSolid && this.rightSolid && this.leftSolid && this.bottomSolid;
                },
                set: function (value) {
                    this.topSolid = value;
                    this.leftSolid = value;
                    this.rightSolid = value;
                    this.bottomSolid = value;
                }
            },
            platform: {
                get: function () {
                    return this.topSolid && !this.rightSolid && !this.leftSolid && !this.bottomSolid;
                }
            },
            IsSlope: {
                get: function () {
                    return this.SlopeDirection !== 0;
                }
            },
            SlopeDirection: {
                get: function () {
                    if (!this.CanSlope) {
                        return 0;
                    }
                    var Bottom = this.GetTileData(0, 1);
                    if (!(Bottom != null && Bottom.enabled && Bottom.solid)) {
                        return 0;
                    }
                    var Left = this.GetTileData(-1, 0);
                    var Right = this.GetTileData(1, 0);
                    var Lsolid = Left != null && Left.enabled && Left.solid;
                    var Rsolid = Right != null && Right.enabled && Right.solid;
                    if (!this.CanSlope || !this.solid || (Lsolid && Rsolid) || (!Rsolid && !Lsolid)) {
                        return 0;
                    }
                    var Top = this.GetTileData(0, -1);
                    var Tsolid = Top != null && Top.enabled && Top.solid;
                    if (Tsolid) {
                        return 0;
                    }
                    if (Rsolid) {
                        return 1;
                    } else {
                        return -1;
                    }
                }
            }
        },
        ctors: {
            init: function () {
                this.Breakable = false;
                this.HP = 4;
                this.maxHP = 4;
                this.opaque = true;
                this.HR = new CirnoGame.Rectangle();
            }
        },
        methods: {
            Clone: function () {
                var T = new CirnoGame.TileData();
                T.texture = this.texture;
                T.enabled = this.enabled;
                T.map = this.map;
                T.visible = this.visible;
                T.topSolid = this.topSolid;
                T.rightSolid = this.rightSolid;
                T.leftSolid = this.leftSolid;
                T.bottomSolid = this.bottomSolid;
                T.CanSlope = this.CanSlope;
                return T;
            },
            Damage: function (damage) {
                this.HP -= damage;
                if (this.HP <= 0 && this.topSolid) {
                    this.solid = false;
                    this.visible = false;
                    this.enabled = false;
                    /* enabled = true;
                    visible = true;
                    texture = 2;*/
                    /* map.ForceRedraw();*/
                    this.UpdateTile();
                    this.SpawnParticles();
                    return true;
                } else {
                    this.map.RedrawTile(this.column, this.row, false);
                    return false;
                }
            },
            UpdateTile: function () {
                this.map.RedrawTile(this.column, this.row);
            },
            SpawnParticles: function () {
                var tx = Bridge.Int.clip32(CirnoGame.MathHelper.Clamp$1(this.texture, 0, ((this.map.tiles.Count - 1) | 0)));
                var T = this.map.tiles.getItem(tx);

                var sz = Bridge.Int.clip32(this.map.tilesize / 2);
                var G = this.map.game;
                var HB = this.GetHitbox();
                //var spd = 1.5f;
                var spd = 1;


                var C = document.createElement("canvas");
                C.width = sz;
                C.height = sz;
                var g = CirnoGame.Helper.GetContext(C);

                g.drawImage(T, 0, 0, sz, sz, 0, 0, sz, sz);
                var P = new CirnoGame.Particle(G, C);
                P.Hspeed = (-spd) | 0;
                P.Vspeed = (-spd) | 0;
                P.x = HB.left;
                P.y = HB.top;
                G.AddEntity(P);

                //
                C = document.createElement("canvas");
                C.width = sz;
                C.height = sz;
                g = CirnoGame.Helper.GetContext(C);

                g.drawImage(T, sz, 0, sz, sz, 0, 0, sz, sz);
                P = new CirnoGame.Particle(G, C);
                P.Hspeed = spd;
                P.Vspeed = (-spd) | 0;
                P.x = HB.left + sz;
                P.y = HB.top;
                G.AddEntity(P);

                //
                C = document.createElement("canvas");
                C.width = sz;
                C.height = sz;
                g = CirnoGame.Helper.GetContext(C);

                g.drawImage(T, 0, sz, sz, sz, 0, 0, sz, sz);
                P = new CirnoGame.Particle(G, C);
                P.Hspeed = (-spd) | 0;
                P.Vspeed = spd;
                P.x = HB.left;
                P.y = HB.top + sz;
                G.AddEntity(P);

                //
                C = document.createElement("canvas");
                C.width = sz;
                C.height = sz;
                g = CirnoGame.Helper.GetContext(C);

                g.drawImage(T, sz, sz, sz, sz, 0, 0, sz, sz);
                P = new CirnoGame.Particle(G, C);
                P.Hspeed = spd;
                P.Vspeed = spd;
                P.x = HB.left + sz;
                P.y = HB.top + sz;
                G.AddEntity(P);
            },
            GetHitbox: function () {
                /* if (_hitbox == null)
                {
                   var tsz = map.tilesize;
                   var pos = map.position;
                   _hitbox = new Rectangle(pos.X + (column * tsz), pos.Y + (row * tsz), tsz, tsz);
                }*/
                var tsz = this.map.tilesize;
                var pos = this.map.position;
                this.HR.Set(pos.X + (this.column * tsz), pos.Y + (this.row * tsz), tsz, tsz);
                return this.HR;
                //return new Rectangle(pos.X + (column * tsz), pos.Y + (row * tsz), tsz, tsz);
                //return _hitbox;
            },
            GetHitbox2: function (OUT) {
                /* if (_hitbox == null)
                {
                   var tsz = map.tilesize;
                   var pos = map.position;
                   _hitbox = new Rectangle(pos.X + (column * tsz), pos.Y + (row * tsz), tsz, tsz);
                }*/
                var tsz = this.map.tilesize;
                var pos = this.map.position;
                OUT.x = pos.X + (this.column * tsz);
                OUT.y = pos.Y + (this.row * tsz);
                OUT.width = tsz;
                OUT.height = tsz;
                //return _hitbox;
            },
            GetTileData: function (relativeX, relativeY) {
                return this.map.GetTile(((this.column + relativeX) | 0), ((this.row + relativeY) | 0));
            },
            solidToSpeed: function (angle) {
                if (!this.enabled) {
                    return false;
                }
                if (angle.RoughLength === 0) {
                    return this.solid;
                } else {
                    if ((angle.X > 0 && this.leftSolid) || (angle.X < 0 && this.rightSolid) || (angle.Y > 0 && this.topSolid) || (angle.Y > 0 && this.bottomSolid)) {
                        return true;
                    }
                }
                return false;
            },
            GetTop: function (position) {

                /* TileData Left = GetTileData(-1, 0);
                TileData Right = GetTileData(1, 0);
                bool Lsolid = Left != null && Left.enabled && Left.solid;
                bool Rsolid = Right != null && Right.enabled && Right.solid;*/
                var direction = this.SlopeDirection;
                //if (!CanSlope || !solid || (Lsolid && Rsolid))
                var tsz = this.map.tilesize;
                if (direction === 0) {
                    //return R.top;

                    var pos = this.map.position;
                    return pos.Y + (this.row * tsz);
                } else {
                    var R = this.GetHitbox();
                    var Y = ((R.right - position.X) / R.width) * tsz;
                    if (direction > 0) {
                        Y = (tsz - Y);
                    }
                    //Y *= 1.0f;
                    Y = Math.min(tsz, Math.max(0, Y));
                    return R.bottom - Y;
                    //return (float)Math.Min(R.top, Math.Max(R.bottom,((R.right - position.X) / R.width) * R.height));
                }
            }
        }
    });

    Bridge.define("CirnoGame.TileMap", {
        fields: {
            position: null,
            tilesize: 0,
            rows: 0,
            columns: 0,
            data: null,
            tiles: null,
            cracks: null,
            game: null,
            buffer: null,
            bg: null,
            RND: null,
            Seed: 0,
            needRedraw: false,
            AllowSkyBridge: false,
            rtmp: null
        },
        ctors: {
            init: function () {
                this.Seed = 0;
                this.AllowSkyBridge = false;
                this.rtmp = new CirnoGame.Rectangle();
            },
            ctor: function (game, Seed) {
                if (Seed === void 0) { Seed = -1; }

                this.$initialize();
                this.RND = new System.Random.ctor();
                //position = new Vector2(-576);
                this.position = new CirnoGame.Vector2();
                //tilesize = 48;
                this.tilesize = 16;
                //rows = 16;
                /* columns = 52;*/
                this.rows = Bridge.Int.clip32(Math.ceil(((-this.position.Y * 2) + game.stageBounds.bottom) / this.tilesize));
                this.columns = Bridge.Int.clip32(Math.ceil(((-this.position.X * 2) + game.stageBounds.right) / this.tilesize));
                this.data = System.Array.create(null, null, CirnoGame.TileData, this.columns, this.rows);
                this.tiles = CirnoGame.AnimationLoader.Get("images/land/brick");
                this.cracks = CirnoGame.AnimationLoader.Get("images/land/cracks");
                this.game = game;

                this.buffer = document.createElement("canvas");
                this.bg = this.buffer.getContext("2d");
                if (Seed < 0) {
                    this.Seed = this.RND.next();
                } else {
                    this.Seed = Seed;
                }
                //Randomize();
                this.Generate();
            }
        },
        methods: {
            /**
             * returns true if the rectangle has no empty spaces.
             *
             * @instance
             * @public
             * @this CirnoGame.TileMap
             * @memberof CirnoGame.TileMap
             * @param   {number}     sX    
             * @param   {number}     sY    
             * @param   {number}     eX    
             * @param   {number}     eY
             * @return  {boolean}
             */
            IsRectSolid: function (sX, sY, eX, eY) {
                var X = sX;
                var Y = sY;
                while (Y < eY) {
                    X = sY;
                    while (X < eX) {
                        var T = this.data.get([X, Y]);
                        if (!(T.enabled && T.topSolid)) {
                            return false;
                        }
                        X = (X + 1) | 0;
                    }
                    Y = (Y + 1) | 0;
                }
                return true;
            },
            ForceRedraw: function () {
                this.needRedraw = true;
            },
            Randomize: function () {
                var row = 0;
                var column = 0;
                while (row < this.rows) {
                    while (column < this.columns) {
                        var T = new CirnoGame.TileData();
                        T.row = row;
                        T.column = column;
                        T.texture = 1;
                        //T.enabled = (Math.Random() < 0.15) || (row>=rows-1);
                        T.enabled = (this.RND.nextDouble() < 0.15) || (row >= ((this.rows - 1) | 0));
                        T.topSolid = T.enabled;
                        if (T.enabled && (row >= ((this.rows - 1) | 0))) {
                            T.texture = 2;
                            T.solid = true;
                        } else if (T.enabled) {
                            if (this.RND.nextDouble() < 0.3) {
                                T.solid = true;
                                T.texture = 0;
                                if (this.RND.nextDouble() < 0.5) {
                                    T.texture = 3;
                                }
                            }
                        }
                        T.visible = T.enabled;
                        T.map = this;
                        this.data.set([column, row], T);
                        column = (column + 1) | 0;
                    }
                    column = 0;
                    row = (row + 1) | 0;
                }
            },
            Generate: function () {
                this.RND = new System.Random.$ctor1(this.Seed);
                //Randomize();
                this._Gen();
                this.needRedraw = true;
            },
            _Gen: function () {
                var heightmap = System.Array.init(this.columns, 0, System.Int32);
                //float entropy = 0.8f;
                //float entropy = 0.45f;
                var entropy = 0.6;
                var max = Bridge.Int.clip32(this.rows * entropy);
                //int smoothnessSize = 12;
                var smoothnessSize = 8;
                var smoothnessStrength = 2;

                var X = 0;
                //randomizes the heightmap
                while (X < this.columns) {
                    heightmap[System.Array.index(X, heightmap)] = Bridge.Int.clip32(this.RND.nextDouble() * max);
                    X = (X + 1) | 0;
                }
                var s = 0;
                while (s < smoothnessStrength) {
                    var oheightmap = heightmap;
                    heightmap = System.Array.init(this.columns, 0, System.Int32);
                    X = 0;
                    while (X < this.columns) {
                        heightmap[System.Array.index(X, heightmap)] = this.blur(oheightmap, X, smoothnessSize);
                        X = (X + 1) | 0;
                    }

                    X = 1;
                    s = (s + 1) | 0;
                }
                //removes bumps from heightmap
                while (X < ((this.columns - 1) | 0)) {
                    var A = heightmap[System.Array.index(((X - 1) | 0), heightmap)];
                    var B = heightmap[System.Array.index(((X + 1) | 0), heightmap)];

                    var H = heightmap[System.Array.index(X, heightmap)];
                    //if (A == B && Math.Abs(A- H)==1)
                    if ((A > H) === (B > H) && H !== A) {
                        heightmap[System.Array.index(X, heightmap)] = (Bridge.Int.div((((A + B) | 0)), 2)) | 0;
                    }
                    X = (X + 1) | 0;
                }



                var row = 0;
                var column = 0;
                var LT = null;
                var bridgeChance = 0.9;
                var RNDbridge = 0;
                while (row < this.rows) {
                    while (column < this.columns) {
                        var H1 = (this.rows - heightmap[System.Array.index(column, heightmap)]) | 0;
                        var fill = row >= H1;
                        var T = new CirnoGame.TileData();
                        T.row = row;
                        T.column = column;
                        T.texture = 1;
                        //T.enabled = (Math.Random() < 0.15) || (row >= rows - 1);
                        T.enabled = (fill) || (row >= ((this.rows - 1) | 0));
                        T.topSolid = T.enabled;
                        T.bottomSolid = T.enabled;
                        if (T.enabled && (row >= ((this.rows - 1) | 0))) {
                            T.texture = 2;
                            T.solid = true;
                        } else if (T.enabled) {
                            //if (Math.Random() < 0.3)
                            {
                                T.solid = true;
                                T.texture = 4;
                                T.CanSlope = true;
                                if (this.RND.nextDouble() < 0.5) {
                                    T.texture = 5;
                                }
                                if (row > H1 && this.RND.nextDouble() < 0.02) {
                                    T.texture = 6;
                                }
                            }
                        }
                        if (!T.enabled) {
                            if ((this.AllowSkyBridge && row === 20 && this.RND.nextDouble() < 0.93) || (((row + 4) | 0) >= H1 && ((row + 2) | 0) < H1 && this.RND.nextDouble() < 0.025) || (LT != null && LT.enabled && LT.texture === 1 && this.RND.nextDouble() < bridgeChance)) {
                                T.enabled = true;
                                T.topSolid = T.enabled;
                                bridgeChance -= 0.075;
                            } else {
                                if (RNDbridge < 1 && this.RND.nextDouble() < 0.015) {
                                    RNDbridge = this.RND.next$1(8);
                                }
                                if (RNDbridge > 0) {
                                    T.enabled = true;
                                    T.topSolid = T.enabled;
                                    RNDbridge = (RNDbridge - 1) | 0;
                                    //}else if (RND.NextDouble() < 0.025)
                                } else if (this.RND.nextDouble() < 0.035) {
                                    T.enabled = true;
                                    T.topSolid = T.enabled;
                                } else if (true) {
                                    T.enabled = true;
                                    T.topSolid = T.enabled;
                                    T.CanSlope = Math.random() < 0.5;
                                }
                            }
                        }
                        if (!T.enabled || T.texture !== 1) {
                            bridgeChance = 0.9;
                        }
                        T.visible = T.enabled;
                        T.map = this;
                        T.solid = true;
                        this.data.set([column, row], T);
                        LT = T;
                        column = (column + 1) | 0;
                    }
                    column = 0;
                    row = (row + 1) | 0;
                }
            },
            _GenRect: function (SX, SY, EX, EY) {
                SX = Bridge.Int.clip32(CirnoGame.MathHelper.Clamp$1(SX, 0, ((this.columns - 1) | 0)));
                SY = Bridge.Int.clip32(CirnoGame.MathHelper.Clamp$1(SY, 0, ((this.rows - 1) | 0)));
                EX = Bridge.Int.clip32(CirnoGame.MathHelper.Clamp$1(EX, 0, ((this.columns - 1) | 0)));
                EY = Bridge.Int.clip32(CirnoGame.MathHelper.Clamp$1(EY, 0, ((this.rows - 1) | 0)));

                //float entropy = 0.8f;
                //float entropy = 0.45f;
                //float entropy = 0.60f;
                //int smoothnessSize = 12;

                var X = 0;



                var row = SY;
                var column = SX;
                var LT = null;
                //float bridgeChance = 0.90f;
                var RNDbridge = 0;

                while (row < EY) {
                    while (column < EX) {
                        var fill = false;
                        var T = new CirnoGame.TileData();
                        T.row = row;
                        T.column = column;
                        T.texture = 1;
                        //T.enabled = (Math.Random() < 0.15) || (row >= rows - 1);
                        T.enabled = (fill) || (row >= ((this.rows - 1) | 0));
                        T.topSolid = T.enabled;
                        T.bottomSolid = T.enabled;
                        /* if (T.enabled && (row >= rows - 1))
                        {
                           T.texture = 2;
                           T.solid = true;
                        }
                        else if (T.enabled)
                        {
                           //if (Math.Random() < 0.3)
                           {
                               T.solid = true;
                               T.texture = 4;
                               T.CanSlope = true;
                               if (RND.NextDouble() < 0.5)
                               {
                                   T.texture = 5;
                               }
                               if (false && RND.NextDouble() < 0.02)
                               {
                                   T.texture = 6;
                               }
                           }
                        }*/
                        if (!T.enabled) {
                            /* if ((AllowSkyBridge && row == 20 && RND.NextDouble() < 0.93) || (false && false && RND.NextDouble() < 0.025) || (LT != null && LT.enabled && LT.texture == 1 && RND.NextDouble() < bridgeChance))
                            {
                               T.enabled = true;
                               T.topSolid = T.enabled;
                               bridgeChance -= 0.075f;
                            }
                            else*/
                            {
                                if (RNDbridge < 1 && this.RND.nextDouble() < 0.03) {
                                    //RNDbridge = RND.Next(8);
                                    RNDbridge = (2 + this.RND.next$1(4)) | 0;
                                    /* if (Math.Random() < 0.9)
                                    {
                                       RNDbridge += 1;
                                    }*/
                                }
                                if (RNDbridge > 0) {
                                    T.enabled = true;
                                    T.topSolid = T.enabled;
                                    T.CanSlope = true;
                                    RNDbridge = (RNDbridge - 1) | 0;
                                    //}else if (RND.NextDouble() < 0.025)
                                } else if (this.RND.nextDouble() < 0.03) {
                                    T.enabled = true;
                                    T.topSolid = T.enabled;
                                    T.CanSlope = true;
                                }

                            }
                        }
                        /* if (!T.enabled || T.texture != 1)
                        {
                           bridgeChance = 0.90f;
                        }*/
                        T.visible = T.enabled;
                        T.map = this;
                        T.solid = true;
                        this.data.set([column, row], T);
                        LT = T;
                        column = (column + 1) | 0;
                    }
                    column = SX;
                    row = (row + 1) | 0;
                }
            },
            SetBreakableRect: function (column, row, Width, Height, breakable) {
                var SX = column;
                var SY = row;
                var EX = ((SX + Width) | 0);
                var EY = ((SY + Height) | 0);
                SX = Bridge.Int.clip32(CirnoGame.MathHelper.Clamp$1(SX, 0, ((this.columns - 1) | 0)));
                SY = Bridge.Int.clip32(CirnoGame.MathHelper.Clamp$1(SY, 0, ((this.rows - 1) | 0)));
                EX = Bridge.Int.clip32(CirnoGame.MathHelper.Clamp$1(EX, 0, ((this.columns - 1) | 0)));
                EY = Bridge.Int.clip32(CirnoGame.MathHelper.Clamp$1(EY, 0, ((this.rows - 1) | 0)));
                var X = SX;
                var Y = SY;
                var T = new CirnoGame.TileData();
                T.row = Y;
                T.column = X;
                T.texture = 1;
                T.enabled = true;
                T.visible = true;
                T.map = this;
                T.solid = true;
                if (breakable) {
                    T.texture = 1;
                    if (Math.random() < 0.02) {
                        T.texture = Math.random() < 0.5 ? 5 : 6;
                    }
                    T.Breakable = true;
                } else {
                    T.texture = 0;
                    T.Breakable = false;
                }
                while (Y < EY) {
                    X = SX;
                    while (X < EX) {
                        /* var TT = T.Clone();
                        TT.column = X;
                        TT.row = Y;
                        data[X, Y] = TT;*/
                        var TT = this.data.get([X, Y]);
                        if (TT == null) {
                            TT = T.Clone();
                        }
                        if (T.solid) {
                            TT.texture = T.texture;
                            TT.Breakable = T.Breakable;
                        }
                        X = (X + 1) | 0;
                    }
                    Y = (Y + 1) | 0;
                }
            },
            FillRect: function (column, row, Width, Height) {
                var SX = column;
                var SY = row;
                var EX = ((SX + Width) | 0);
                var EY = ((SY + Height) | 0);
                SX = Bridge.Int.clip32(CirnoGame.MathHelper.Clamp$1(SX, 0, ((this.columns - 1) | 0)));
                SY = Bridge.Int.clip32(CirnoGame.MathHelper.Clamp$1(SY, 0, ((this.rows - 1) | 0)));
                EX = Bridge.Int.clip32(CirnoGame.MathHelper.Clamp$1(EX, 0, ((this.columns - 1) | 0)));
                EY = Bridge.Int.clip32(CirnoGame.MathHelper.Clamp$1(EY, 0, ((this.rows - 1) | 0)));
                var X = SX;
                var Y = SY;
                var T = new CirnoGame.TileData();
                T.row = Y;
                T.column = X;
                T.texture = 1;
                T.enabled = true;
                T.visible = true;
                T.map = this;
                T.solid = true;
                while (Y < EY) {
                    X = SX;
                    while (X < EX) {
                        var TT = T.Clone();
                        TT.column = X;
                        TT.row = Y;
                        this.data.set([X, Y], TT);
                        X = (X + 1) | 0;
                    }
                    Y = (Y + 1) | 0;
                }
            },
            DrawRect$1: function (column, row, Width, Height) {
                var X = column;
                var Y = row;
                var TX = X;
                var TY = Y;
                var EX = (X + Width) | 0;
                var EY = (Y + Height) | 0;

                while (TX < EX) {
                    var T = new CirnoGame.TileData();
                    T.row = TY;
                    T.column = TX;
                    T.texture = 1;
                    T.enabled = true;
                    T.visible = true;
                    T.map = this;
                    T.solid = true;
                    this.SetTile(TX, TY, T);
                    TX = (TX + 1) | 0;
                }
                TX = X;
                TY = EY;
                while (TX < EX) {
                    var T1 = new CirnoGame.TileData();
                    T1.row = TY;
                    T1.column = TX;
                    T1.texture = 1;
                    T1.enabled = true;
                    T1.visible = true;
                    T1.map = this;
                    T1.solid = true;
                    this.SetTile(TX, TY, T1);
                    TX = (TX + 1) | 0;
                }

                TX = X;
                TY = Y;
                while (TY < EY) {
                    var T2 = new CirnoGame.TileData();
                    T2.row = TY;
                    T2.column = TX;
                    T2.texture = 1;
                    T2.enabled = true;
                    T2.visible = true;
                    T2.map = this;
                    T2.solid = true;
                    this.SetTile(TX, TY, T2);
                    TY = (TY + 1) | 0;
                }
                TX = EX;
                TY = Y;
                while (TY < EY) {
                    var T3 = new CirnoGame.TileData();
                    T3.row = TY;
                    T3.column = TX;
                    T3.texture = 1;
                    T3.enabled = true;
                    T3.visible = true;
                    T3.map = this;
                    T3.solid = true;
                    this.SetTile(TX, TY, T3);
                    TY = (TY + 1) | 0;
                }
            },
            DrawRect: function (rect) {
                /* var PX = (int)((position.X - TP.X) / tilesize);
                var PY = (int)((position.Y - TP.Y) / tilesize);*/
                this.DrawRect$1(Bridge.Int.clip32(rect.left / this.tilesize), Bridge.Int.clip32(rect.top / this.tilesize), Bridge.Int.clip32(rect.width / this.tilesize), Bridge.Int.clip32(rect.height / this.tilesize));
            },
            SetAll: function (T) {
                var X = 0;
                var Y = 0;
                while (Y < this.rows) {
                    X = 0;
                    while (X < this.columns) {
                        var TD = T.Clone();
                        TD.column = X;
                        TD.row = Y;
                        this.data.set([X, Y], T);
                        X = (X + 1) | 0;
                    }
                    Y = (Y + 1) | 0;
                }
            },
            ClearOuterRect: function (column, row, width, height, bottom) {
                if (bottom === void 0) { bottom = true; }
                var SX = column;
                var SY = row;
                var EX = ((SX + width) | 0);
                var EY = ((SY + height) | 0);
                SX = Bridge.Int.clip32(CirnoGame.MathHelper.Clamp$1(SX, 0, ((this.columns - 1) | 0)));
                SY = Bridge.Int.clip32(CirnoGame.MathHelper.Clamp$1(SY, 0, ((this.rows - 1) | 0)));
                EX = Bridge.Int.clip32(CirnoGame.MathHelper.Clamp$1(EX, 0, ((this.columns - 1) | 0)));
                EY = Bridge.Int.clip32(CirnoGame.MathHelper.Clamp$1(EY, 0, ((this.rows - 1) | 0)));
                var X = SX;
                var Y = SY;
                var T = new CirnoGame.TileData();
                T.map = this;
                T.visible = false;
                T.solid = false;
                var TX = X;
                var TY = Y;
                while (TX < ((EX - 1) | 0)) {
                    var TT = T.Clone();
                    TT.column = TX;
                    TT.row = TY;
                    this.SetTile(TX, TY, TT);
                    TX = (TX + 1) | 0;
                }
                TX = X;
                TY = EY;
                if (bottom) {
                    while (TX < EX) {
                        var TT1 = T.Clone();
                        TT1.column = TX;
                        TT1.row = TY;
                        this.SetTile(TX, TY, TT1);
                        TX = (TX + 1) | 0;
                    }
                }

                TX = X;
                TY = Y;
                while (TY < ((EY - 1) | 0)) {
                    var TT2 = T.Clone();
                    TT2.column = TX;
                    TT2.row = TY;
                    this.SetTile(TX, TY, TT2);
                    TY = (TY + 1) | 0;
                }
                TX = EX;
                TY = Y;
                while (TY < ((EY - 1) | 0)) {
                    var TT3 = T.Clone();
                    TT3.column = TX;
                    TT3.row = TY;
                    this.SetTile(TX, TY, TT3);
                    TY = (TY + 1) | 0;
                }
            },
            ClearRect$1: function (column, row, width, height) {
                var SX = column;
                var SY = row;
                var EX = ((SX + width) | 0);
                var EY = ((SY + height) | 0);
                SX = Bridge.Int.clip32(CirnoGame.MathHelper.Clamp$1(SX, 0, ((this.columns - 1) | 0)));
                SY = Bridge.Int.clip32(CirnoGame.MathHelper.Clamp$1(SY, 0, ((this.rows - 1) | 0)));
                EX = Bridge.Int.clip32(CirnoGame.MathHelper.Clamp$1(EX, 0, ((this.columns - 1) | 0)));
                EY = Bridge.Int.clip32(CirnoGame.MathHelper.Clamp$1(EY, 0, ((this.rows - 1) | 0)));
                var X = SX;
                var Y = SY;
                var T = new CirnoGame.TileData();
                T.map = this;
                T.visible = false;
                T.solid = false;
                T.enabled = false;
                while (Y < EY) {
                    X = SX;
                    while (X < EX) {
                        var TT = T.Clone();
                        TT.column = X;
                        TT.row = Y;
                        this.data.set([X, Y], TT);
                        X = (X + 1) | 0;
                    }
                    Y = (Y + 1) | 0;
                }
            },
            ClearRect: function (rect) {
                var SX = Bridge.Int.clip32(rect.left / this.tilesize);
                var SY = Bridge.Int.clip32(rect.top / this.tilesize);
                var EX = Bridge.Int.clip32(rect.right / this.tilesize);
                var EY = Bridge.Int.clip32(rect.height / this.tilesize);
                var X = SX;
                var Y = SY;
                var T = new CirnoGame.TileData();
                T.map = this;
                T.visible = false;
                T.solid = false;
                while (Y < EY) {
                    X = SX;
                    while (X < EX) {
                        var TT = T.Clone();
                        TT.column = X;
                        TT.row = Y;
                        this.data.set([X, Y], TT);
                        X = (X + 1) | 0;
                    }
                    Y = (Y + 1) | 0;
                }
            },
            SetTile: function (column, row, T) {
                if (column >= 0 && row >= 0 && column < System.Array.getLength(this.data, 0) && row < System.Array.getLength(this.data, 1)) {
                    this.data.set([column, row], T);
                }
            },
            blur: function (array, index, blur) {
                if (blur === void 0) { blur = 1; }
                var total = 0;
                var ret = 0;
                var i = 0;
                var ind = index;
                if (ind >= 0 && ind < array.length) {
                    total = (total + 1) | 0;
                    ret = (ret + array[System.Array.index(ind, array)]) | 0;
                }
                while (i < blur) {
                    ind = (ind - 1) | 0;
                    if (ind >= 0 && ind < array.length) {
                        total = (total + 1) | 0;
                        ret = (ret + array[System.Array.index(ind, array)]) | 0;
                    }
                    i = (i + 1) | 0;
                }
                i = 0;
                while (i < blur) {
                    ind = (ind + 1) | 0;
                    if (ind >= 0 && ind < array.length) {
                        total = (total + 1) | 0;
                        ret = (ret + array[System.Array.index(ind, array)]) | 0;
                    }
                    i = (i + 1) | 0;
                }
                return ((Bridge.Int.div(ret, total)) | 0);
            },
            CheckForTile: function (position) {
                /* position = position - this.position;
                position /= tilesize;
                if (position.X>=0 && position.X<columns && position.Y>=0 && position.Y<rows)
                {
                   return data[(int)position.X, (int)position.Y];
                }*/
                var TP = this.position;
                var PX = Bridge.Int.clip32((position.X - TP.X) / this.tilesize);
                var PY = Bridge.Int.clip32((position.Y - TP.Y) / this.tilesize);
                if (PX >= 0 && PX < this.columns && PY >= 0 && PY < this.rows) {
                    return this.data.get([PX, PY]);
                }
                return null;
            },
            GetTile: function (column, row) {
                if (column >= 0 && row >= 0 && column < this.columns && row < this.rows) {
                    return this.data.get([column, row]);
                }
                return null;
            },
            _Draw: function () {
                if (this.needRedraw) {
                    var W = Bridge.Int.clip32(Math.ceil(this.columns * this.tilesize));
                    var H = Bridge.Int.clip32(Math.ceil(this.rows * this.tilesize));

                    if (this.buffer.width !== W || this.buffer.height !== H) {
                        this.buffer.width = W;
                        this.buffer.height = H;
                    } else {
                        this.bg.clearRect(0, 0, this.buffer.width, this.buffer.height);
                    }

                    this.Redraw(this.bg);
                    this.needRedraw = false;
                }
            },
            Draw: function (g) {
                this._Draw();
                //g.DrawImage(buffer, position.X, position.Y);
                this.rtmp.CopyFrom(this.game.camera.CameraBounds);
                //hide floating point seams.
                this.rtmp.x -= 1;
                this.rtmp.y -= 1;
                this.rtmp.width += 2;
                this.rtmp.height += 2;
                var CB = this.rtmp;
                //var CB = game.camera.CameraBounds;
                //g.DrawImage(buffer, CB.left-position.X, CB.top-position.Y, CB.width, CB.height, CB.left, CB.top, CB.width, CB.height);//draw map cropped to camera bounds
                g.drawImage(this.buffer, CB.left - this.position.X, CB.top - this.position.Y, CB.width, CB.height, CB.left, CB.top, CB.width, CB.height); //draw map cropped to camera bounds
            },
            RedrawTile: function (X, Y, updateNeighbors) {
                if (updateNeighbors === void 0) { updateNeighbors = true; }
                if (updateNeighbors) {
                    var TX = Bridge.Int.mul((((X - 1) | 0)), Bridge.Int.clip32(this.tilesize));
                    var TY = Bridge.Int.mul((((Y - 1) | 0)), Bridge.Int.clip32(this.tilesize));
                    this.bg.clearRect(TX, TY, Bridge.Int.mul(Bridge.Int.clip32(this.tilesize), 3), Bridge.Int.mul(Bridge.Int.clip32(this.tilesize), 3));

                    this.Redraw(this.bg, ((X - 1) | 0), ((Y - 1) | 0), 3, 3);
                } else {
                    var TX1 = Bridge.Int.mul((X), Bridge.Int.clip32(this.tilesize));
                    var TY1 = Bridge.Int.mul((Y), Bridge.Int.clip32(this.tilesize));
                    this.bg.clearRect(TX1, TY1, this.tilesize, this.tilesize);

                    this.Redraw(this.bg, X, Y, 1, 1);
                }
            },
            Redraw: function (g, SX, SY, W, H) {
                if (SX === void 0) { SX = -1; }
                if (SY === void 0) { SY = -1; }
                if (W === void 0) { W = -1; }
                if (H === void 0) { H = -1; }
                var PX = this.position.X;
                var PY = this.position.Y;
                PX = 0;
                PY = 0;
                if (SX === -1) {
                    SX = 0;
                }
                if (SY === -1) {
                    SY = 0;
                }

                if (W === -1) {
                    W = this.columns;
                }
                if (H === -1) {
                    H = this.rows;
                }
                var EX = (SX + W) | 0;
                var EY = (SY + H) | 0;
                SX = Bridge.Int.clip32(CirnoGame.MathHelper.Clamp$1(SX, 0, this.columns));
                SY = Bridge.Int.clip32(CirnoGame.MathHelper.Clamp$1(SY, 0, this.rows));

                EX = Bridge.Int.clip32(CirnoGame.MathHelper.Clamp$1(EX, 0, this.columns));
                EY = Bridge.Int.clip32(CirnoGame.MathHelper.Clamp$1(EY, 0, this.rows));

                var X = PX + (SX * this.tilesize);
                var Y = PY + (SY * this.tilesize);
                var row = SY;
                var column = SX;
                var BG = this.tiles.getItem(2);
                //var BG2 = tiles[3];
                var BG2 = System.Array.init([this.tiles.getItem(3), this.tiles.getItem(9), this.tiles.getItem(10)], HTMLImageElement);
                var tilesC = this.tiles.Count;

                var R = new CirnoGame.Rectangle();
                var doorroom = CirnoGame.MapGenerator.doorroom;
                var keyroom = CirnoGame.MapGenerator.keyroom;
                var doorroomcolor = "#000000";
                //var keyroomcolor = "#CC0000";
                //var keyroomcolor = "#118822";
                var keyroomcolor = "#558822";

                var gradcolor = "#000077";
                var Agradcolor = "#CC0000";

                var DX = 0;
                var DY = 0;

                if (doorroom != null) {
                    DX = (Bridge.Int.div((((doorroom.SX + doorroom.EX) | 0)), 2)) | 0;
                    DY = (Bridge.Int.div((((doorroom.SY + doorroom.EY) | 0)), 2)) | 0;
                }

                while (row < EY) {
                    while (column < EX) {
                        //if (R.isTouching(new Rectangle(X, Y, tilesize, tilesize)))
                        {
                            var T = this.data.get([column, row]);
                            var tex = Math.min(((this.tiles.Count - 1) | 0), T.texture);
                            if (T.enabled && tex >= 0 && tex < tilesC) {
                                g.drawImage(this.tiles.getItem(tex), X, Y);
                                if (T.Breakable && T.HP < T.maxHP) {
                                    var dmg = (Bridge.Int.clip32(Math.max(1, Math.min(Bridge.Math.round(T.maxHP - T.HP, 0, 6), 3))) - 1) | 0;
                                    g.drawImage(this.cracks.getItem(dmg), X, Y);
                                }
                                var sd = T.SlopeDirection;
                                if (sd !== 0) {
                                    //object sg = g;
                                    //Script.Write("sg.globalCompositeOperation = 'destination-out'");
                                    g.globalCompositeOperation = "destination-out";
                                    T.GetHitbox2(R);
                                    R.x -= this.position.X;
                                    R.y -= this.position.Y;
                                    g.beginPath();
                                    g.moveTo(R.left, R.top);
                                    var P;
                                    P = new CirnoGame.Vector2(R.left + (R.width / 2.0), R.top + (R.height / 2.0));
                                    if (sd > 0) {
                                        g.lineTo(R.left, R.bottom);
                                    } else {
                                        g.lineTo(R.right, R.bottom);
                                    }

                                    g.lineTo(R.right, R.top);

                                    g.lineTo(R.left, R.top);

                                    g.fill();

                                    g.globalCompositeOperation = "destination-over";
                                    /* if (doorroom!=null && doorroom.ContainsTile(column, row))
                                    {
                                       g.GlobalAlpha = 0.55f;
                                       g.FillStyle = doorroomcolor;
                                       //g.FillRect(R.x.ToDynamic(), R.y.ToDynamic(), R.width.ToDynamic(), R.height.ToDynamic());
                                       g.FillRect(X.ToDynamic(), Y.ToDynamic(), tilesize.ToDynamic(), tilesize.ToDynamic());
                                       g.GlobalAlpha = 1f;
                                    }
                                    else */
                                    if (keyroom != null && keyroom.ContainsTile(column, row)) {
                                        g.globalAlpha = 0.17;
                                        g.fillStyle = keyroomcolor;
                                        //g.FillRect(R.x.ToDynamic(), R.y.ToDynamic(), R.width.ToDynamic(), R.height.ToDynamic());
                                        g.fillRect(X, Y, this.tilesize, this.tilesize);
                                        g.globalAlpha = 1.0;
                                    } else if (doorroom != null) {
                                        var Dist = Math.max(((((Math.abs(((column - DX) | 0)) + Math.abs(((row - DY) | 0))) | 0) - 5) | 0), 0);
                                        var A = 0.5 - (Dist * 0.03);
                                        var G = gradcolor;
                                        if (A < 0) {
                                            //A = Math.Min((-A * 0.50f) - 0.22f, 0.30f);
                                            A = (-A * 0.5) - 0.22;
                                            G = Agradcolor;
                                            if (A > 0.3) {
                                                A = 0.6 - A;
                                                if (A < 0) {
                                                    /* A = -A;*/
                                                    G = gradcolor;
                                                    A = 0;
                                                }
                                            }

                                        }
                                        if (A > 0) {
                                            g.globalAlpha = A;
                                            g.fillStyle = G;
                                            g.fillRect(X, Y, this.tilesize, this.tilesize);
                                            g.globalAlpha = 1.0;
                                        }
                                    }
                                    g.drawImage(BG, X, Y);
                                    g.globalCompositeOperation = "source-over";

                                } else if (!T.opaque) {
                                    g.globalCompositeOperation = "destination-over";
                                    /* if (doorroom!=null && doorroom.ContainsTile(column, row))
                                    {
                                       g.GlobalAlpha = 0.55f;
                                       g.FillStyle = doorroomcolor;
                                       //g.FillRect(R.x.ToDynamic(), R.y.ToDynamic(), R.width.ToDynamic(), R.height.ToDynamic());
                                       g.FillRect(X.ToDynamic(), Y.ToDynamic(), tilesize.ToDynamic(), tilesize.ToDynamic());
                                       g.GlobalAlpha = 1f;
                                    }
                                    else */
                                    if (keyroom != null && keyroom.ContainsTile(column, row)) {
                                        g.globalAlpha = 0.17;
                                        g.fillStyle = keyroomcolor;
                                        //g.FillRect(R.x.ToDynamic(), R.y.ToDynamic(), R.width.ToDynamic(), R.height.ToDynamic());
                                        g.fillRect(X, Y, this.tilesize, this.tilesize);
                                        g.globalAlpha = 1.0;
                                    } else if (doorroom != null) {
                                        var Dist1 = Math.max(((((Math.abs(((column - DX) | 0)) + Math.abs(((row - DY) | 0))) | 0) - 5) | 0), 0);
                                        var A1 = 0.5 - (Dist1 * 0.03);
                                        var G1 = gradcolor;
                                        if (A1 < 0) {
                                            //A = Math.Min((-A * 0.50f) - 0.22f, 0.30f);
                                            A1 = (-A1 * 0.5) - 0.22;
                                            G1 = Agradcolor;
                                            if (A1 > 0.3) {
                                                A1 = 0.6 - A1;
                                                if (A1 < 0) {
                                                    /* A = -A;*/
                                                    G1 = gradcolor;
                                                    A1 = 0;
                                                }
                                            }

                                        }
                                        if (A1 > 0) {
                                            g.globalAlpha = A1;
                                            g.fillStyle = G1;
                                            g.fillRect(X, Y, this.tilesize, this.tilesize);
                                            g.globalAlpha = 1.0;
                                        }
                                    }

                                    g.drawImage(BG, X, Y);
                                    g.globalCompositeOperation = "source-over";
                                }

                            } else {
                                var texture = BG;
                                //if (Math.Random() >= 0.98)
                                if (Math.random() >= 0.97) {
                                    texture = CirnoGame.HelperExtensions.Pick(Bridge.global.HTMLImageElement, BG2);
                                }
                                //g.DrawImage(Math.Random() < 0.98 ? BG : BG2, X, Y);
                                g.drawImage(texture, X, Y);
                                /* if (doorroom != null && doorroom.ContainsTile(column, row))
                                {
                                   g.GlobalAlpha = 0.55f;
                                   g.FillStyle = doorroomcolor;
                                   g.FillRect(X.ToDynamic(), Y.ToDynamic(), tilesize.ToDynamic(), tilesize.ToDynamic());
                                   g.GlobalAlpha = 1f;
                                }
                                else */
                                if (keyroom != null && keyroom.ContainsTile(column, row)) {
                                    /* T.GetHitbox2(R);
                                    R.x -= position.X;
                                    R.y -= position.Y;*/
                                    g.globalAlpha = 0.17;
                                    g.fillStyle = keyroomcolor;
                                    g.fillRect(X, Y, this.tilesize, this.tilesize);
                                    g.globalAlpha = 1.0;
                                } else if (doorroom != null) {
                                    var Dist2 = Math.max(((((Math.abs(((column - DX) | 0)) + Math.abs(((row - DY) | 0))) | 0) - 5) | 0), 0);
                                    var A2 = 0.5 - (Dist2 * 0.03);
                                    var G2 = gradcolor;
                                    if (A2 < 0) {
                                        //A = Math.Min((-A * 0.50f) - 0.22f, 0.30f);
                                        A2 = (-A2 * 0.5) - 0.22;
                                        G2 = Agradcolor;
                                        if (A2 > 0.3) {
                                            A2 = 0.6 - A2;
                                            if (A2 < 0) {
                                                /* A = -A;*/
                                                G2 = gradcolor;
                                                A2 = 0;
                                            }
                                        }

                                    }
                                    if (A2 > 0) {
                                        g.globalAlpha = A2;
                                        g.fillStyle = G2;
                                        g.fillRect(X, Y, this.tilesize, this.tilesize);
                                        g.globalAlpha = 1.0;
                                    }
                                }
                            }
                        }
                        column = (column + 1) | 0;
                        X += this.tilesize;
                    }
                    X = PX + (SX * this.tilesize);
                    Y += this.tilesize;
                    column = SX;
                    row = (row + 1) | 0;
                }
            },
            IsExposed: function (X, Y) {
                var row = (Y - 2) | 0;
                var column = (X - 2) | 0;
                var TDRaw = this.data;
                var ind = 0;
                var lind = 0;

                ind = Bridge.Int.mul(column, this.rows);
                ind = (ind + row) | 0;

                while (row <= ((Y + 2) | 0)) {
                    lind = ind;
                    while (column <= ((X + 2) | 0)) {
                        /* var T = data[column, row];
                        T.texture = Math.Random() < 0.5 ? 0 : 1;*/
                        if (row >= 0 && column >= 0 && row < this.rows && column < this.columns) {
                            //var T = data[column, row];
                            var T = TDRaw[System.Array.index(ind, TDRaw)];
                            if (!T.enabled || !T.solid) {
                                return true;
                            }
                        }
                        column = (column + 1) | 0;
                        ind = (ind + this.rows) | 0;
                    }
                    ind = lind;
                    ind = (ind + 1) | 0;
                    row = (row + 1) | 0;
                    column = (X - 2) | 0;
                }
                return false;
            },
            ApplyBreakableRect: function (SX, SY, W, H) {
                if (SX === void 0) { SX = -1; }
                if (SY === void 0) { SY = -1; }
                if (W === void 0) { W = -1; }
                if (H === void 0) { H = -1; }
                if (SX === -1) {
                    SX = 0;
                }
                if (SY === -1) {
                    SY = 0;
                }

                if (W === -1) {
                    W = this.columns;
                }
                if (H === -1) {
                    H = this.rows;
                }
                var EX = (SX + W) | 0;
                var EY = (SY + H) | 0;
                SX = Bridge.Int.clip32(CirnoGame.MathHelper.Clamp$1(SX, 0, this.columns));
                SY = Bridge.Int.clip32(CirnoGame.MathHelper.Clamp$1(SY, 0, this.rows));

                EX = Bridge.Int.clip32(CirnoGame.MathHelper.Clamp$1(EX, 0, this.columns));
                EY = Bridge.Int.clip32(CirnoGame.MathHelper.Clamp$1(EY, 0, this.rows));
                var row = SX;
                var column = SY;

                while (row < EY) {
                    while (column < EX) {
                        /* var T = data[column, row];
                        T.texture = Math.Random() < 0.5 ? 0 : 1;*/
                        var T = this.data.get([column, row]);
                        var TT = T.Clone();
                        TT.column = column;
                        TT.row = row;
                        this.data.set([column, row], TT);
                        T = TT;
                        if (this.IsExposed(column, row)) {
                            T.texture = 1;
                            if (Math.random() < 0.02) {
                                T.texture = Math.random() < 0.5 ? 5 : 6;
                            }
                            T.Breakable = true;
                        } else {
                            T.texture = 0;
                            T.Breakable = false;
                        }
                        column = (column + 1) | 0;
                    }
                    row = (row + 1) | 0;
                    column = SX;
                }
                this.needRedraw = true;
            },
            ApplyBreakable: function () {
                var row = 0;
                var column = 0;
                var TDRaw = this.data;
                var ind = 0;
                var lind = 0;

                while (row < this.rows) {
                    lind = ind;
                    while (column < this.columns) {
                        /* var T = data[column, row];
                        T.texture = Math.Random() < 0.5 ? 0 : 1;*/

                        var T = TDRaw[System.Array.index(ind, TDRaw)];
                        //var T = data[column, row];
                        var TT = T.Clone();
                        TT.column = column;
                        TT.row = row;
                        //data[column, row] = TT;
                        TDRaw[System.Array.index(ind, TDRaw)] = TT;
                        T = TT;
                        if (this.IsExposed(column, row)) {
                            T.texture = 1;
                            if (Math.random() < 0.02) {
                                T.texture = Math.random() < 0.5 ? 5 : 6;
                            }
                            T.Breakable = true;
                        } else {
                            T.texture = 0;
                            T.Breakable = false;
                        }
                        column = (column + 1) | 0;
                        ind = (ind + this.rows) | 0;
                    }
                    ind = lind;
                    row = (row + 1) | 0;
                    //ind -= (columns * rows);
                    column = 0;

                    ind = (ind + 1) | 0;
                }
                this.needRedraw = true;
            },
            testTexture: function () {
                var row = 0;
                var column = 0;

                while (row < this.rows) {
                    while (column < this.columns) {
                        var T = this.data.get([column, row]);
                        T.texture = Math.random() < 0.5 ? 0 : 1;
                        column = (column + 1) | 0;
                    }
                    row = (row + 1) | 0;
                    column = 0;
                }
                this.needRedraw = true;
            }
        }
    });

    Bridge.define("CirnoGame.Vector2", {
        statics: {
            props: {
                Empty: {
                    get: function () {
                        return new CirnoGame.Vector2();
                    }
                }
            },
            methods: {
                FromRadian: function (radian) {
                    return CirnoGame.MathHelper.RadianToVector(radian);
                },
                Add: function (A, B) {
                    return new CirnoGame.Vector2(A.X + B.X, A.Y + B.Y);
                },
                Add$1: function (A, X, Y) {
                    return new CirnoGame.Vector2(A.X + X, A.Y + Y);
                },
                Subtract: function (A, B) {
                    return new CirnoGame.Vector2(A.X - B.X, A.Y - B.Y);
                },
                Subtract$1: function (A, X, Y) {
                    return new CirnoGame.Vector2(A.X - X, A.Y - Y);
                },
                op_Equality: function (A, B) {
                    var OA = A;
                    var OB = B;
                    if ((OA == null || OB == null) && (OA != null || OB != null)) {
                        return false;
                    }
                    if (OA == null && OB == null) {
                        return true;
                    }
                    return A.X === B.X && A.Y === B.Y;
                    //return false;
                },
                op_Inequality: function (A, B) {
                    return !(CirnoGame.Vector2.op_Equality(A, B));
                },
                op_Multiply: function (A, scale) {
                    return new CirnoGame.Vector2(A.X * scale, A.Y * scale);
                },
                op_Division: function (A, scale) {
                    return new CirnoGame.Vector2(A.X / scale, A.Y / scale);
                },
                op_Addition: function (A, B) {
                    return new CirnoGame.Vector2(A.X + B.X, A.Y + B.Y);
                },
                op_Subtraction: function (A, B) {
                    return new CirnoGame.Vector2(A.X - B.X, A.Y - B.Y);
                }
            }
        },
        fields: {
            X: 0,
            Y: 0
        },
        props: {
            Length: {
                get: function () {
                    return Math.sqrt((this.X * this.X) + (this.Y * this.Y));
                }
            },
            /**
             * Returns a rough estimate of the vector's length.
             *
             * @instance
             * @public
             * @readonly
             * @memberof CirnoGame.Vector2
             * @function EstimatedLength
             * @type number
             */
            EstimatedLength: {
                get: function () {
                    var A = Math.abs(this.X);
                    var B = Math.abs(this.Y);
                    if (B > A) {
                        var tmp = A;
                        A = B;
                        B = tmp;
                    }
                    B *= 0.34;
                    return A + B;
                    //return (float)(Math.Abs(X) + Math.Abs(Y));
                }
            },
            /**
             * Returns the sum of its absolute parts.
             *
             * @instance
             * @public
             * @readonly
             * @memberof CirnoGame.Vector2
             * @function RoughLength
             * @type number
             */
            RoughLength: {
                get: function () {
                    return Math.abs(this.X) + Math.abs(this.Y);
                }
            }
        },
        ctors: {
            ctor: function (x, y) {
                if (x === void 0) { x = 0.0; }
                if (y === void 0) { y = 0.0; }

                this.$initialize();
                this.X = x;
                this.Y = y;
            }
        },
        methods: {
            Distance: function (P) {
                var XX = this.X - P.X;
                var YY = this.Y - P.Y;
                return Math.sqrt((XX * XX) + (YY * YY));
            },
            /**
             * Returns a rough estimate of the vector's length.
             *
             * @instance
             * @public
             * @this CirnoGame.Vector2
             * @memberof CirnoGame.Vector2
             * @param   {CirnoGame.Vector2}    P
             * @return  {number}
             */
            EstimatedDistance: function (P) {
                var A = Math.abs(this.X - P.X);
                var B = Math.abs(this.Y - P.Y);
                if (B > A) {
                    var tmp = A;
                    A = B;
                    B = tmp;
                }
                B *= 0.34;
                return A + B;
                //return (float)(Math.Abs(X) + Math.Abs(Y));
            },
            Multiply: function (f) {
                this.X *= f;
                this.Y *= f;
            },
            RoughNormalize: function (length) {
                if (length === void 0) { length = 1.0; }
                var D = this.Length / length;
                return new CirnoGame.Vector2(this.X / D, this.Y / D);
            },
            Normalize: function (length) {
                if (length === void 0) { length = 1.0; }
                var distance = Math.sqrt(this.X * this.X + this.Y * this.Y);
                var V = new CirnoGame.Vector2();
                V.X = this.X / distance;
                V.Y = this.Y / distance;
                V.X *= length;
                V.Y *= length;
                return V;
            },
            SetAsNormalize: function (length) {
                if (length === void 0) { length = 1.0; }
                var distance = Math.sqrt(this.X * this.X + this.Y * this.Y);
                this.X = this.X / distance;
                this.Y = this.Y / distance;
                this.X *= length;
                this.Y *= length;
            },
            ToCardinal: function () {
                var x = this.X;
                var y = this.Y;
                var A = Math.abs(this.X);
                var B = Math.abs(this.Y);
                if (B > A) {
                    x = 0;
                } else if (A > B) {
                    y = 0;
                }
                return new CirnoGame.Vector2(x, y);
            },
            Equals: function (o) {
                var B = o;
                if (CirnoGame.Vector2.op_Inequality(this, B) && CirnoGame.Vector2.op_Equality(B, null)) {
                    return false;
                }
                return B.X === this.X && B.Y === this.Y;
            },
            equals: function (o) {
                if (Bridge.is(o, CirnoGame.Vector2)) {
                    var B = Bridge.cast(o, CirnoGame.Vector2);
                    if (CirnoGame.Vector2.op_Inequality(this, B) && CirnoGame.Vector2.op_Equality(B, null)) {
                        return false;
                    }
                    return B.X === this.X && B.Y === this.Y;
                }
                return Bridge.equals(this, o);
            },
            ToAngle: function () {
                return CirnoGame.MathHelper.WrapRadians(CirnoGame.MathHelper.GetAngle(this));
                //return MathHelper.WrapRadians(MathHelper.GetAngle(new Vector2(), this));
            },
            Clone: function () {
                return new CirnoGame.Vector2(this.X, this.Y);
            },
            CopyFrom: function (V) {
                if (CirnoGame.Vector2.op_Equality(V, null)) {
                    return;
                }
                this.X = V.X;
                this.Y = V.Y;
            },
            Rotate: function (radian) {
                var angle = this.ToAngle() + radian;
                return CirnoGame.Vector2.FromRadian(angle).Normalize(this.Length);
            },
            Add: function (V) {
                this.X += V.X;
                this.Y += V.Y;
            },
            Subtract: function (V) {
                this.X -= V.X;
                this.Y -= V.Y;
            }
        }
    });

    Bridge.define("CirnoGame.AimedShooter", {
        inherits: [CirnoGame.EntityBehavior],
        fields: {
            time: 0,
            maxtime: 0,
            Target: null,
            maxDistance: 0,
            maxShadow: 0,
            attackpower: 0,
            bulletSpeed: 0,
            bulletDuration: 0,
            ignoresterrain: false,
            bulletgraphic: null,
            attackTelegraphTime: 0
        },
        ctors: {
            init: function () {
                this.time = 0;
                this.maxtime = 480;
                this.maxDistance = 130;
                this.maxShadow = 5;
                this.attackpower = 1;
                this.bulletSpeed = 0.5;
                this.bulletDuration = 900;
                this.ignoresterrain = false;
                this.bulletgraphic = "ebullet";
                this.attackTelegraphTime = 60;
            },
            ctor: function (entity) {
                this.$initialize();
                CirnoGame.EntityBehavior.ctor.call(this, entity);
                /* entity.Ani.HueColor = "#FF0000";
                entity.Ani.HueRecolorStrength = 2.0f;*/
                entity.Ani.Shadowcolor = "#FF0000";
            }
        },
        methods: {
            Update: function () {
                CirnoGame.EntityBehavior.prototype.Update.call(this);
                this.UpdateTarget();
                var A = this.entity.Ani;



                if (this.Target != null) {
                    if (this.time < this.attackTelegraphTime) {
                        //if ((time & 4) > 0)
                        if (true) {
                            //A.Shadow = 6-(time * 0.1f);
                            A.Shadow = this.maxShadow;
                        } else {
                            A.Shadow = 0;
                        }
                    } else {
                        A.Shadow = 0;
                    }
                    this.time = (this.time - 1) | 0;
                    if (this.time <= 0) {
                        this.ResetTimer();
                        this.Shoot();
                    }
                } else {
                    A.Shadow = 0;
                }
                /* A.Shadowcolor = A.HueColor;
                A.Shadow = A.Shadowcolor != "" ? 0 : 3;
                A.HueColor = "#FF0000";
                A.HueRecolorStrength = 2.0f;*/
                //A.Update();

            },
            UpdateTarget: function () {
                if (this.Target != null) {
                    if (this.Target.Position.EstimatedDistance(this.entity.Position) > this.maxDistance) {
                        this.Target = null;
                    } else {
                        return;
                    }
                }
                var T = this.entity.Game.player;
                if (T.Position.EstimatedDistance(this.entity.Position) < this.maxDistance) {
                    this.Target = T;
                    this.ResetTimer();
                }
            },
            ResetTimer: function () {
                this.time = (((Bridge.Int.div(this.maxtime, 2)) | 0));
                this.time = (this.time + Bridge.Int.clip32(Bridge.Math.round(this.time * Math.random(), 0, 6))) | 0;
            },
            Shoot: function () {
                if (this.Target == null || Bridge.cast(this.Target, CirnoGame.ICombatant).CirnoGame$ICombatant$HP <= 0) {
                    return;
                }
                var P = new CirnoGame.PlayerBullet(this.entity.Game, this.entity, System.String.concat("images/misc/", this.bulletgraphic));
                P.Position.CopyFrom(this.entity.getCenter());

                var D = (CirnoGame.Vector2.op_Subtraction(this.Target.getCenter(), P.Position));
                D.SetAsNormalize(this.bulletSpeed);
                P.Hspeed = D.X;
                P.Vspeed = D.Y;
                P.touchDamage = this.attackpower;
                P.ignoresterrain = this.ignoresterrain;
                P.Duration = this.bulletDuration;
                this.entity.Game.AddEntity(P);
            }
        }
    });

    Bridge.define("CirnoGame.ButtonSprite", {
        inherits: [CirnoGame.Sprite],
        fields: {
            _buttonNeedsRerender: false,
            _buttonBuffer: null,
            _buttonGraphic: null,
            Data: null,
            _contents: null,
            _borderSize: 0,
            _borderColor: null,
            LockedClickSound: null,
            ClickSound: null,
            _buttonColor: null,
            ColorSchemes: null,
            locked: false,
            OnClick: null,
            LContentSize: null
        },
        props: {
            Contents: {
                get: function () {
                    return this._contents;
                },
                set: function (value) {
                    if (!Bridge.referenceEquals(this._contents, value)) {
                        this._contents = value;
                        this._buttonNeedsRerender = true;
                    }
                }
            },
            BorderSize: {
                get: function () {
                    return this._borderSize;
                },
                set: function (value) {
                    if (this._borderSize !== value) {
                        this._borderSize = value;
                        this._buttonNeedsRerender = true;
                    }
                }
            },
            BorderColor: {
                get: function () {
                    return this._borderColor;
                },
                set: function (value) {
                    if (!Bridge.referenceEquals(this._borderColor, value)) {
                        this._borderColor = value;
                        this._buttonNeedsRerender = true;
                    }
                }
            },
            ButtonColor: {
                get: function () {
                    return this._buttonColor;
                },
                set: function (value) {
                    if (!Bridge.referenceEquals(this._buttonColor, value)) {
                        this._buttonColor = value;
                        this._buttonNeedsRerender = true;
                    }
                }
            }
        },
        ctors: {
            init: function () {
                this.LockedClickSound = "hit";
                this.ClickSound = "select";
                this.locked = false;
                this.LContentSize = new CirnoGame.Vector2();
            },
            ctor: function (contents, borderSize, borderColor, buttonColor, data) {
                if (borderSize === void 0) { borderSize = 2; }
                if (borderColor === void 0) { borderColor = "#00AA33"; }
                if (buttonColor === void 0) { buttonColor = "#11CC55"; }
                if (data === void 0) { data = null; }

                this.$initialize();
                CirnoGame.Sprite.ctor.call(this);
                this.Contents = contents;
                this.BorderSize = borderSize;
                this.BorderColor = borderColor;
                this.ButtonColor = buttonColor;

                this._buttonBuffer = new CirnoGame.Sprite();
                this._buttonBuffer.Size = contents.Size;
                this._buttonGraphic = this._buttonBuffer.GetGraphics();
                this._buttonNeedsRerender = true;
                this.ColorSchemes = new (System.Collections.Generic.List$1(CirnoGame.ButtonSprite.ColorScheme)).ctor();
                this.ColorSchemes.add(new CirnoGame.ButtonSprite.ColorScheme(borderColor, buttonColor));
                this.ColorSchemes.add(new CirnoGame.ButtonSprite.ColorScheme("#FFFFFF", "#FF0000"));
                this.ColorSchemes.add(new CirnoGame.ButtonSprite.ColorScheme("#777777", "#CCCCCC"));

                this.Data = data;
                if (data == null && Bridge.is(contents, CirnoGame.TextSprite)) {
                    this.Data = Bridge.cast(contents, CirnoGame.TextSprite).Text;
                }

                this.Draw(null);
            }
        },
        methods: {
            SetColorScheme: function (scheme) {
                this.BorderColor = scheme.BorderColor;
                this.ButtonColor = scheme.ButtonColor;
            },
            SetColorScheme$1: function (index) {
                var C = this.ColorSchemes.getItem(index);
                this.SetColorScheme(C);
            },
            drawButton: function () {
                var g = this._buttonGraphic;
                var sz = (this._borderSize + this._borderSize) | 0;
                this._buttonBuffer.Size = CirnoGame.Vector2.op_Addition(this.Contents.Size, new CirnoGame.Vector2(sz, sz));
                var size = this._buttonBuffer.Size;

                g.fillStyle = this._borderColor;
                g.fillRect(0, 0, size.X, size.Y);

                g.fillStyle = this.ButtonColor;
                g.fillRect(this._borderSize, this._borderSize, ((Bridge.Int.clip32(size.X) - sz) | 0), ((Bridge.Int.clip32(size.Y) - sz) | 0));

                var color = "rgba(255,255,255,0)";

                var wht = "rgba(255,255,255,0.7)";


                var grd = g.createLinearGradient(0, 0, 0, size.Y);
                grd.addColorStop(0, color);
                grd.addColorStop(0.4, wht);
                grd.addColorStop(1, color);
                g.fillStyle = grd;
                g.fillRect(0, 0, this._buttonBuffer.Size.X, this._buttonBuffer.Size.Y);
            },
            Lock: function (setcolorscheme) {
                if (setcolorscheme === void 0) { setcolorscheme = true; }
                if (this.locked) {
                    return;
                }
                this.locked = true;
                if (setcolorscheme) {
                    this.SetColorScheme$1(2);
                }
            },
            Unlock: function (setcolorscheme) {
                if (setcolorscheme === void 0) { setcolorscheme = true; }
                if (!this.locked) {
                    return;
                }
                this.locked = false;
                if (setcolorscheme) {
                    this.SetColorScheme$1(0);
                }
            },
            CheckClick: function (mousePosition) {
                if (this.Visible && this.GetBounds().containsPoint(mousePosition)) {
                    if (this.locked) {
                        if (!Bridge.referenceEquals(this.LockedClickSound, "") && this.LockedClickSound != null) {
                            CirnoGame.AudioManager._this.Blast(System.String.concat("SFX/", this.LockedClickSound, ".ogg"));
                        }
                        return false;
                    }

                    if (!Bridge.referenceEquals(this.ClickSound, "") && this.ClickSound != null) {
                        //AudioManager._this.Get("SFX/" + ClickSound);
                        CirnoGame.AudioManager._this.Blast(System.String.concat("SFX/", this.ClickSound, ".ogg"));

                    }
                    var tmp = this.OnClick;
                    if (tmp) {
                        this.OnClick();
                    }
                    return true;
                }
                return false;
            },
            Draw: function (g) {
                //if (_contents.Size != LContentSize)
                if (this._contents.Size.X !== this.LContentSize.X || this._contents.Size.Y !== this.LContentSize.Y) {
                    this._buttonNeedsRerender = true;
                    this.LContentSize = this._contents.Size.Clone();
                }
                if (this._buttonNeedsRerender) {
                    this.drawButton();
                    this._buttonNeedsRerender = false;
                }
                this.Size = this._buttonBuffer.Size.Clone();
                //spriteGraphics.DrawImage(_bu)
                this._buttonBuffer.Draw(this.spriteGraphics);
                this.Contents.Position = new CirnoGame.Vector2(this._borderSize, this._borderSize);
                this.Contents.Draw(this.spriteGraphics);

                if (g != null) {
                    CirnoGame.Sprite.prototype.Draw.call(this, g);
                }
            }
        }
    });

    Bridge.define("CirnoGame.Chest", {
        inherits: [CirnoGame.Entity],
        fields: {
            ForceLocked: false,
            TupleNames: null
        },
        props: {
            Golden: false,
            Opened: false,
            Heart: false
        },
        ctors: {
            init: function () {
                this.ForceLocked = false;
                this.TupleNames = System.Array.init(["Null", "Single", "Double", "Triple", "Quadruple", "Quintuple", "Sextuple", "Septuple", "Octuple", "Nonuple", "Decuple"], System.String);
            },
            ctor: function (game) {
                this.$initialize();
                CirnoGame.Entity.ctor.call(this, game);
                this.Ani = new CirnoGame.Animation(CirnoGame.AnimationLoader._this.GetAnimation("images/misc/chest"));
                this.Ani.ImageSpeed = 0;
                if (Math.random() < 0.15) {
                    this.Heartify();
                }
            }
        },
        methods: {
            Goldify: function () {
                var P = this.Ani.Position;
                this.Ani = new CirnoGame.Animation(CirnoGame.AnimationLoader._this.GetAnimation("images/misc/goldchest"));
                this.Ani.ImageSpeed = 0;
                this.Ani.Position.CopyFrom(P);
                this.Golden = true;
                this.Heart = false;
            },
            Heartify: function () {
                var P = this.Ani.Position;
                this.Ani = new CirnoGame.Animation(CirnoGame.AnimationLoader._this.GetAnimation("images/misc/pinkchest"));
                this.Ani.ImageSpeed = 0;
                this.Ani.Position.CopyFrom(P);
                this.Heart = true;
            },
            Update: function () {
                CirnoGame.Entity.prototype.Update.call(this);
                var F = this.GetFloor();
                if (F == null) {
                    this.Vspeed = 2;
                } else {
                    this.Vspeed = 0;
                    this.y = F.GetHitbox().top - this.Ani.CurrentImage.height;
                }
                var P = this.Game.player;
                if (P.Position.EstimatedDistance(this.Position) < 16) {
                    if (!this.ForceLocked) {
                        if (!this.Opened && P.Controller[System.Array.index(2, P.Controller)] && (P.keys > 0 || this.Golden)) {
                            if (!this.Golden) {
                                P.keys = (P.keys - 1) | 0;
                            }
                            this.Open(P);
                        }
                    } else if (P.Controller[System.Array.index(2, P.Controller)]) {
                        P.MSG.ChangeText("It's sealed with magic...");
                    }
                }
            },
            Open: function (player) {
                if (!this.Opened) {
                    this.PlaySound("chestopen");
                    this.Ani.CurrentFrame = 1;
                    this.Ani.SetImage();
                    this.Ani.Update();
                    this.Opened = true;
                    //TODO:give player a permanent upgrade, and display text above the chest telling the player what they just got
                    var M = "";
                    var ok = true;
                    var S = "";
                    var color = "#FFFFFF";
                    var picker = null;
                    while (ok) {
                        var common = System.Array.init(["point", "point", "point", "point", "point", "point", "heart", "heart", "tripleheart", "singleorb"], System.String);
                        var rare = System.Array.init(["attackpower", "defensepower", "mining"], System.String);
                        var legendary = System.Array.init(["triplejump", "cheaperblocks", "invincibility", "repeater", "movespeed"], System.String);

                        var heartTable = System.Array.init(["supertripleheart"], System.String);


                        var R = Math.random();
                        var C;
                        if (this.Heart) {
                            C = CirnoGame.HelperExtensions.Pick(System.String, heartTable);
                            S = "common";
                            color = "#FFFFFF";
                        } else {
                            if (picker == null || Math.random() < 0.2) {
                                if (R < 0.6 && !this.Golden) {
                                    picker = common;
                                    S = "common";
                                    color = "#FFFFFF";
                                } else {
                                    R = Math.random();
                                    if (R < 0.91) {
                                        picker = rare;
                                        S = "rare";
                                        color = "#FFBB33";
                                    } else {
                                        picker = legendary;
                                        S = "legendary";
                                        color = "#FF55FF";
                                    }
                                }
                            }
                            if (true) {
                                C = CirnoGame.HelperExtensions.Pick(System.String, picker);
                            } else {
                                picker = legendary;
                                S = "legendary";
                                color = "#FF55FF";
                                C = "movespeed";
                            }
                        }
                        ok = false;
                        var CI;
                        switch (C) {
                            case "point": 
                                var P = new CirnoGame.PointItem(this.Game);
                                P.Position.CopyFrom(this.Position);
                                P.Vspeed = -2.0;
                                P.Hspeed = -2.0;
                                P.collectionDelay = 30;
                                this.Game.AddEntity(P);
                                P = new CirnoGame.PointItem(this.Game);
                                P.Position.CopyFrom(this.Position);
                                P.Vspeed = -2.0;
                                P.Hspeed = 2.0;
                                P.collectionDelay = 30;
                                this.Game.AddEntity(P);
                                M = "Points";
                                break;
                            case "heart": 
                                if (player.HP >= player.maxHP) {
                                    ok = true;
                                    break;
                                }
                                var H = new CirnoGame.HealingItem(this.Game);
                                H.Position.CopyFrom(this.Position);
                                H.Vspeed = -2.0;
                                H.collectionDelay = 30;
                                this.Game.AddEntity(H);
                                M = "Heal";
                                break;
                            case "tripleheart": 
                                if ((player.HP > player.maxHP / 3) && !this.Heart) {
                                    ok = true;
                                    break;
                                }
                                var H1 = new CirnoGame.HealingItem(this.Game);
                                H1.Position.CopyFrom(this.Position);
                                H1.Vspeed = -2.0;
                                H1.Hspeed = -2.0;
                                H1.collectionDelay = 30;
                                this.Game.AddEntity(H1);
                                H1 = new CirnoGame.HealingItem(this.Game);
                                H1.Position.CopyFrom(this.Position);
                                H1.Vspeed = -2.0;
                                H1.Hspeed = 0;
                                H1.collectionDelay = 30;
                                this.Game.AddEntity(H1);
                                H1 = new CirnoGame.HealingItem(this.Game);
                                H1.Position.CopyFrom(this.Position);
                                H1.Vspeed = -2.0;
                                H1.Hspeed = 2.0;
                                H1.collectionDelay = 30;
                                this.Game.AddEntity(H1);
                                M = "Heal x3";
                                break;
                            case "supertripleheart": 
                                if ((player.HP > player.maxHP / 3) && !this.Heart) {
                                    ok = true;
                                    break;
                                }
                                H1 = new CirnoGame.HealingItem(this.Game);
                                H1.Position.CopyFrom(this.Position);
                                H1.Vspeed = -2.0;
                                H1.Hspeed = -2.0;
                                H1.healingPower *= 1.5;
                                H1.collectionDelay = 30;
                                this.Game.AddEntity(H1);
                                H1 = new CirnoGame.HealingItem(this.Game);
                                H1.Position.CopyFrom(this.Position);
                                H1.Vspeed = -2.0;
                                H1.Hspeed = 0;
                                H1.healingPower *= 1.5;
                                H1.collectionDelay = 30;
                                this.Game.AddEntity(H1);
                                H1 = new CirnoGame.HealingItem(this.Game);
                                H1.Position.CopyFrom(this.Position);
                                H1.Vspeed = -2.0;
                                H1.Hspeed = 2.0;
                                H1.healingPower *= 1.5;
                                H1.collectionDelay = 30;
                                this.Game.AddEntity(H1);
                                M = "Heal+";
                                break;
                            case "singleorb": 
                                if (this.Game.timeRemaining > 0) {
                                    ok = true;
                                    break;
                                }
                                CI = new CirnoGame.Orb(this.Game);
                                CI.Position.CopyFrom(this.Position);
                                CI.Vspeed = -2.0;
                                CI.Hspeed = -2.0;
                                CI.collectionDelay = 30;
                                this.Game.AddEntity(CI);
                                /* CI = new Orb(Game);
                                CI.Position.CopyFrom(Position);
                                CI.Vspeed = -2f;
                                CI.Hspeed = 2f;
                                CI.collectionDelay = 30;
                                Game.AddEntity(CI);*/
                                M = "Orb";
                                break;
                            case "mining": 
                                if (player.digpower < 2.0) {
                                    player.digpower += 0.5;
                                } else {
                                    ok = true;
                                }
                                M = "Mining Power " + System.Single.format((player.digpower)) + "x";
                                break;
                            case "triplejump": 
                                var PC = player.GetBehavior(CirnoGame.PlatformerControls);
                                if (PC.maxAirJumps < 2) {
                                    PC.maxAirJumps = 2;
                                } else {
                                    ok = true;
                                }
                                M = "Triple Jump";
                                break;
                            case "cheaperblocks": 
                                if (player.blockprice !== 4) {
                                    ok = true;
                                    break;
                                }
                                player.blockprice = 1;
                                M = "Blocks are cheaper now";
                                break;
                            case "movespeed": 
                                if (player.data.containsKey("movespeed")) {
                                    ok = true;
                                    break;
                                }
                                player.data.set("movespeed", true);
                                var Plat = player.GetBehavior(CirnoGame.PlatformerControls);
                                Plat.maxSpeed *= 1.07;
                                Plat.accel *= 1.07;
                                M = "Movement speed+";
                                break;
                            case "invincibility": 
                                if (player.invincibilitymod !== 1) {
                                    ok = true;
                                    break;
                                }
                                player.invincibilitymod = 2;
                                M = "Invincibility extended";
                                break;
                            case "attackpower": 
                                player.attackpower += 1;
                                M = "Attack Power " + Bridge.Int.clip32((player.attackpower));
                                break;
                            case "defensepower": 
                                player.defensepower += 1;
                                M = "Defensive Power " + Bridge.Int.clip32((player.defensepower));
                                break;
                            case "repeater": 
                                if (player.totalshots > 2) {
                                    ok = true;
                                    break;
                                }
                                player.totalshots = (player.totalshots + 1) | 0;
                                M = System.String.concat(this.TupleNames[System.Array.index(player.totalshots, this.TupleNames)], " shot");
                                break;
                            default: 
                                ok = true;
                                break;
                        }

                    }
                    if (!ok && !Bridge.referenceEquals(M, "")) {
                        var FM = new CirnoGame.FloatingMessage(this.Game, M);
                        FM.Text.TextColor = color;
                        //FM.Position = new Vector2(x - 8, y - 20);
                        FM.Position = new CirnoGame.Vector2(this.x + 8, this.y - 20);
                        this.Game.AddEntity(FM);
                        if (!Bridge.referenceEquals(S, "") && !Bridge.referenceEquals(S, "common")) {
                            this.PlaySound("ok2B");
                        } else {
                            this.PlaySound("jump");
                        }
                    }
                }
            },
            GetFloor: function () {
                var T = null;
                var W = this.Width / 3;
                var Y = this.Height;
                if (!(T != null && T.enabled && T.topSolid)) {
                    T = this.Game.TM.CheckForTile(CirnoGame.Vector2.Add$1(this.Position, this.Width / 2, Y));
                }
                if (!(T != null && T.enabled && T.topSolid)) {
                    T = this.Game.TM.CheckForTile(CirnoGame.Vector2.Add$1(this.Position, W, Y));
                }
                if (!(T != null && T.enabled && T.topSolid)) {
                    T = this.Game.TM.CheckForTile(CirnoGame.Vector2.Add$1(this.Position, this.Width - W, Y));
                }
                if (!(T != null && T.enabled && T.topSolid)) {
                    T = null;
                }
                return T;
            }
        }
    });

    Bridge.define("CirnoGame.CollectableItem", {
        inherits: [CirnoGame.Entity],
        fields: {
            floats: false,
            magnetDistance: 0,
            magnetSpeed: 0,
            maxFallSpeed: 0,
            fallaccel: 0,
            itemName: null,
            collectionDelay: 0,
            sound: null
        },
        ctors: {
            init: function () {
                this.floats = true;
                this.magnetDistance = 35;
                this.magnetSpeed = 8;
                this.maxFallSpeed = 2;
                this.fallaccel = 0.1;
                this.collectionDelay = 10;
                this.sound = "powerup";
            },
            ctor: function (game, itemName) {
                this.$initialize();
                CirnoGame.Entity.ctor.call(this, game);
                this.Ani = new CirnoGame.Animation(CirnoGame.AnimationLoader.Get(System.String.concat("images/items/", itemName)));
                this.Ani.SetImage();
                this.itemName = itemName;
            }
        },
        methods: {
            CanCollect: function (player) {
                return true;
            },
            Update: function () {
                if (this.collectionDelay > 0) {
                    this.collectionDelay = (this.collectionDelay - 1) | 0;
                }
                var C;
                var player = this.Game.player;

                if (this.collectionDelay <= 0 && this.CanCollect(player) && (((C = player.getCenter())).EstimatedDistance(this.Position) < this.magnetDistance)) {
                    var C2 = this.getCenter();
                    var P = CirnoGame.Vector2.op_Subtraction(C, C2);
                    var ln = P.Length;
                    var spd = this.magnetSpeed;
                    var fspd = spd / Math.max(1, ln);
                    if (ln <= fspd) {
                        //((PlayerCharacter)Game.player).onCollectItem(this);
                        this.Alive = false;
                        this.Hspeed = 0;
                        this.Vspeed = 0;
                        this.Position.CopyFrom(this.Game.player.Position);
                        this.onCollected(this.Game.player);
                        this.PlaySound(this.sound);
                        return;

                    }
                    P = P.Normalize(fspd);
                    /* x += P.X;
                    y += P.Y;*/
                    this.Hspeed = P.X;
                    this.Vspeed = P.Y;

                    //Vspeed = 0;
                } else if (!this.floats) {
                    var F = this.GetFloor();
                    if (F == null) {
                        if (this.Vspeed < this.maxFallSpeed) {
                            this.Vspeed = Math.min(this.Vspeed + this.fallaccel, this.maxFallSpeed);
                        } else {
                            this.Vspeed = this.maxFallSpeed;
                        }
                    } else {
                        this.Vspeed = 0;
                        this.y = F.GetHitbox().top - this.Ani.CurrentImage.height;
                    }
                    //Hspeed = 0;
                    this.Hspeed = CirnoGame.MathHelper.Decelerate(this.Hspeed, 0.1);
                } else {
                    //Hspeed = 0;
                    //Vspeed = 0;
                    this.Hspeed = CirnoGame.MathHelper.Decelerate(this.Hspeed, 0.1);
                    this.Vspeed = CirnoGame.MathHelper.Decelerate(this.Vspeed, 0.1);
                }
                CirnoGame.Entity.prototype.Update.call(this);
            },
            GetFloor: function () {
                var T = null;
                var W = this.Width / 3;
                var Y = this.Height;
                if (!(T != null && T.enabled && T.topSolid)) {
                    T = this.Game.TM.CheckForTile(CirnoGame.Vector2.Add$1(this.Position, this.Width / 2, Y));
                }
                if (!(T != null && T.enabled && T.topSolid)) {
                    T = this.Game.TM.CheckForTile(CirnoGame.Vector2.Add$1(this.Position, W, Y));
                }
                if (!(T != null && T.enabled && T.topSolid)) {
                    T = this.Game.TM.CheckForTile(CirnoGame.Vector2.Add$1(this.Position, this.Width - W, Y));
                }
                if (!(T != null && T.enabled && T.topSolid)) {
                    T = null;
                }
                return T;
            }
        }
    });

    Bridge.define("CirnoGame.ControllableEntity", {
        inherits: [CirnoGame.Entity],
        fields: {
            Controller: null,
            LController: null
        },
        ctors: {
            ctor: function (game) {
                this.$initialize();
                CirnoGame.Entity.ctor.call(this, game);
                this.Controller = System.Array.init(7, false, System.Boolean);
                this.LController = System.Array.init(this.Controller.length, false, System.Boolean);
            }
        },
        methods: {
            /**
             * returns true if the button was just pressed.
             *
             * @instance
             * @public
             * @this CirnoGame.ControllableEntity
             * @memberof CirnoGame.ControllableEntity
             * @param   {number}     button
             * @return  {boolean}
             */
            Pressed: function (button) {
                return (this.Controller[System.Array.index(button, this.Controller)] !== this.LController[System.Array.index(button, this.LController)] && this.Controller[System.Array.index(button, this.Controller)]);
            },
            /**
             * returns true if just released.
             *
             * @instance
             * @public
             * @this CirnoGame.ControllableEntity
             * @memberof CirnoGame.ControllableEntity
             * @param   {number}     button
             * @return  {boolean}
             */
            Released: function (button) {
                return (this.Controller[System.Array.index(button, this.Controller)] !== this.LController[System.Array.index(button, this.LController)] && !this.Controller[System.Array.index(button, this.Controller)]);
            }
        }
    });

    Bridge.define("CirnoGame.ExitDoor", {
        inherits: [CirnoGame.Entity],
        fields: {
            reset: 0,
            RT: null,
            _Opened: false
        },
        props: {
            Opened: {
                get: function () {
                    return this._Opened;
                },
                set: function (value) {
                    this._Opened = value;
                    if (this._Opened) {
                        this.Ani.CurrentFrame = 1;
                        this.Ani.SetImage();
                    } else {
                        this.Ani.CurrentFrame = 0;
                        this.Ani.SetImage();
                    }
                }
            }
        },
        ctors: {
            init: function () {
                this.reset = 0;
                this._Opened = false;
            },
            ctor: function (game) {
                this.$initialize();
                CirnoGame.Entity.ctor.call(this, game);
                this.Ani = new CirnoGame.Animation(CirnoGame.AnimationLoader.Get("images/misc/door"));
                this.Ani.ImageSpeed = 0;
                this.Ani.SetImage();
                this.RemovedOnLevelEnd = false;
            }
        },
        methods: {
            DropToGround: function () {
                while (this.GetFloor() == null) {
                    this.y += 16;
                }
                var F = this.GetFloor();
                //F.Breakable = false;
                var FB = F.GetHitbox();
                this.x = FB.left;
                this.y = FB.top - 32;
                var T = this.Game.TM.GetTile(F.column, ((F.row - 1) | 0));
                if (T != null && T.enabled && T.topSolid) {
                    this.y -= 16;
                    F = T;
                    console.log("dug door out of the ground");

                }
                this.RT = F;
                /* F.Breakable = false;
                F.texture = 0;

                Game.TM.RedrawTile(F.column, F.row);*/
                this.reset = 0;

            },
            Update: function () {
                CirnoGame.Entity.prototype.Update.call(this);
                if (!this._Opened) {
                    return;
                }
                /* var F = GetFloor();
                if (F == null)
                {
                   Vspeed = 1;
                }
                else
                {
                   Vspeed = 0;
                   y = F.GetHitbox().top - Ani.CurrentImage.Height;
                }*/
                var P = this.Game.player;
                if (P.Position.EstimatedDistance(this.Position) < 20 && P.Controller[System.Array.index(2, P.Controller)]) {
                    this.Opened = false;
                    P.score = (P.score + (Bridge.Int.mul(this.Game.level, 10))) | 0;

                    var time = 13000;
                    if (this.Game.timeRemaining > 0) {
                        this.Game.timeRemaining += time;
                        this.Game.timeRemaining = Math.min(this.Game.defaultTimeRemaining, this.Game.timeRemaining);
                    } else {
                        this.Game.timeRemaining += time;
                    }
                    this.Game.StartNextLevel();

                    /* P.keys--;
                    Open(P);*/
                    /* Ani.CurrentFrame = 1;
                    Ani.SetImage();
                    Ani.Update();*/
                }
                if (this.reset < 2) {
                    this.reset = (this.reset + 1) | 0;
                    //reset = false;
                    //var F = GetFloor();
                    var F = this.RT;
                    if (F != null && this.reset === 2) {
                        F.Breakable = false;
                        F.texture = 0;
                        this.Game.TM.RedrawTile(F.column, F.row);
                    }
                }
            },
            GetFloor: function () {
                var T = null;
                var W = this.Width / 3;
                var Y = this.Height;
                if (!(T != null && T.enabled && T.topSolid)) {
                    T = this.Game.TM.CheckForTile(CirnoGame.Vector2.Add$1(this.Position, this.Width / 2, Y));
                }
                if (!(T != null && T.enabled && T.topSolid)) {
                    T = this.Game.TM.CheckForTile(CirnoGame.Vector2.Add$1(this.Position, W, Y));
                }
                if (!(T != null && T.enabled && T.topSolid)) {
                    T = this.Game.TM.CheckForTile(CirnoGame.Vector2.Add$1(this.Position, this.Width - W, Y));
                }
                if (!(T != null && T.enabled && T.topSolid)) {
                    T = null;
                }
                return T;
            }
        }
    });

    Bridge.define("CirnoGame.FlightControls", {
        inherits: [CirnoGame.EntityBehavior],
        fields: {
            accel: 0,
            maxSpeed: 0,
            _platformer: null
        },
        ctors: {
            init: function () {
                this.accel = 0.35;
                this.maxSpeed = 1.5;
            },
            ctor: function (entity) {
                this.$initialize();
                CirnoGame.EntityBehavior.ctor.call(this, entity);
                this._platformer = entity;
            }
        },
        methods: {
            Update: function () {
                var controller = this._platformer.Controller;
                if (controller[System.Array.index(0, controller)] && this._platformer.Hspeed > -this.maxSpeed) {
                    this._platformer.Hspeed = Math.max(this._platformer.Hspeed - (this.accel + this._platformer.friction), -this.maxSpeed);
                }
                if (controller[System.Array.index(1, controller)] && this._platformer.Hspeed < this.maxSpeed) {
                    this._platformer.Hspeed = Math.min(this._platformer.Hspeed + (this.accel + this._platformer.friction), this.maxSpeed);
                }
                if (controller[System.Array.index(2, controller)] && this._platformer.Vspeed > -this.maxSpeed) {
                    this._platformer.Vspeed = Math.max(this._platformer.Vspeed - (this.accel + this._platformer.friction), -this.maxSpeed);
                }
                if (controller[System.Array.index(3, controller)] && this._platformer.Vspeed < this.maxSpeed) {
                    this._platformer.Vspeed = Math.min(this._platformer.Vspeed + (this.accel + this._platformer.friction), this.maxSpeed);
                }
                /* var jumpbutton = 5;
                if (_platformer.Vspeed >= 0 && _platformer.onGround)
                {
                   if (_platformer.Pressed(jumpbutton) && _platformer.onGround && _platformer.Ceiling == null)
                   {
                       _platformer.Vspeed = -jumpSpeed;
                       ///entity.PlaySound("jump");
                   }
                }
                else if (airJumps < maxAirJumps && _platformer.Pressed(jumpbutton) && _platformer.Ceiling == null)
                {
                   _platformer.Vspeed = -(jumpSpeed * airjumppower);
                   airJumps++;
                }
                if (_platformer.Vspeed < 0 && !controller[jumpbutton])
                {
                   _platformer.Vspeed += (_platformer.gravity * 2);
                }*/
                CirnoGame.EntityBehavior.prototype.Update.call(this);
            }
        }
    });

    Bridge.define("CirnoGame.FloatingMessage", {
        inherits: [CirnoGame.Entity],
        fields: {
            time: 0,
            Text: null,
            alpha: 0,
            autokill: false
        },
        ctors: {
            init: function () {
                this.time = 30;
                this.alpha = 1;
                this.autokill = true;
            },
            ctor: function (game, text) {
                this.$initialize();
                CirnoGame.Entity.ctor.call(this, game);
                this.Ani = new CirnoGame.Animation(null);
                this.Text = new CirnoGame.TextSprite();
                this.Text.Text = text;
                this.Text.TextColor = "#FFFFFF";
                this.Text.ShadowColor = "#000000";
                this.Text.ShadowOffset = new CirnoGame.Vector2(2, 2);
                this.Text.ShadowBlur = 1;
                this.Text.FontSize = 14;
                this.time = (30 + (Bridge.Int.mul(text.length, 20))) | 0;
            }
        },
        methods: {
            ChangeText: function (text, color) {
                if (color === void 0) { color = null; }
                this.Text.Text = text;
                this.time = (30 + (Bridge.Int.mul(text.length, 20))) | 0;
                this.alpha = 1;
                if (color != null) {
                    this.Text.TextColor = color;
                }
            },
            Update: function () {
                CirnoGame.Entity.prototype.Update.call(this);
                if (this.time > 0) {
                    this.time = (this.time - 1) | 0;
                    if (this.time < 1 && this.alpha > 0) {
                        //Alive = false;
                        this.alpha -= 0.05;
                        if (this.alpha <= 0) {
                            this.alpha = 0;
                            if (this.autokill) {
                                this.Alive = false;
                            }
                        }
                        this.time = 1;
                    }
                }
            },
            Draw: function (g) {
                //base.Draw(g);
                if (this.alpha < 1) {
                    if (this.alpha <= 0) {
                        return;
                    }
                    g.globalAlpha = this.alpha;
                }
                //Text.Position.CopyFrom(Position);
                this.Text.ForceUpdate();
                this.Text.Position.X = (Bridge.Int.clip32(this.Position.X) - (((Bridge.Int.div(this.Text.spriteBuffer.width, 2)) | 0))) | 0;
                this.Text.Position.Y = (Bridge.Int.clip32(this.Position.Y) - (((Bridge.Int.div(this.Text.spriteBuffer.height, 2)) | 0))) | 0;
                this.Text.Draw(g);
                g.globalAlpha = 1.0;
            }
        }
    });

    Bridge.define("CirnoGame.GameSprite", {
        inherits: [CirnoGame.Sprite],
        ctors: {
            ctor: function () {
                this.$initialize();
                CirnoGame.Sprite.ctor.call(this);

            }
        },
        methods: {
            Update: function () {

            },
            Render: function () {

            }
        }
    });

    Bridge.define("CirnoGame.Particle", {
        inherits: [CirnoGame.Entity],
        fields: {
            HP: 0,
            alphatime: 0
        },
        ctors: {
            init: function () {
                this.HP = 12;
                this.alphatime = 0.2;
            },
            ctor: function (game, image) {
                this.$initialize();
                CirnoGame.Entity.ctor.call(this, game);
                this.Ani = new CirnoGame.Animation(new (System.Collections.Generic.List$1(HTMLImageElement)).$ctor1(System.Array.init([image], HTMLImageElement)));
            }
        },
        methods: {
            Update: function () {
                var $t;
                this.HP = (this.HP - 1) | 0;
                if (this.HP <= 0) {
                    if ((($t = this.Ani.Alpha - this.alphatime, this.Ani.Alpha = $t, $t)) <= 0) {
                        this.Alive = false;
                    }
                    /* if (alphatime > 0)
                    {
                       alpha -= alphatime;
                       Ani.Alpha = alpha;
                       if (alpha <= 0)
                       {
                           Alive = false;
                       }
                    }
                    else
                    {
                       Alive = false;
                    }*/
                }
                CirnoGame.Entity.prototype.Update.call(this);
            }
        }
    });

    Bridge.define("CirnoGame.PlatformerControls", {
        inherits: [CirnoGame.EntityBehavior],
        fields: {
            _platformer: null,
            accel: 0,
            jumpSpeed: 0,
            maxSpeed: 0,
            maxAirJumps: 0,
            airJumps: 0,
            airjumppower: 0
        },
        ctors: {
            init: function () {
                this.accel = 0.35;
                this.jumpSpeed = 2.25;
                this.maxSpeed = 1.5;
                this.maxAirJumps = 1;
                this.airJumps = 0;
                this.airjumppower = 0.815;
            },
            ctor: function (entity) {
                this.$initialize();
                CirnoGame.EntityBehavior.ctor.call(this, entity);
                this._platformer = entity;
            }
        },
        methods: {
            Update: function () {
                var againstwall = false;
                var controller = this._platformer.Controller;
                var X = 0;
                if (controller[System.Array.index(0, controller)] && !controller[System.Array.index(1, controller)] && this._platformer.Hspeed > -this.maxSpeed) {
                    this._platformer.Hspeed = Math.max(this._platformer.Hspeed - (this.accel + this._platformer.friction), -this.maxSpeed);
                    X = -1;
                    if (this._platformer.RightWall != null) {
                        againstwall = true;
                    }
                }
                if (controller[System.Array.index(1, controller)] && !controller[System.Array.index(0, controller)] && this._platformer.Hspeed < this.maxSpeed) {
                    this._platformer.Hspeed = Math.min(this._platformer.Hspeed + (this.accel + this._platformer.friction), this.maxSpeed);
                    X = 1;
                    if (this._platformer.LeftWall != null) {
                        againstwall = true;
                    }
                }
                var jumpbutton = 5;
                if (this._platformer.onGround) {
                    this.airJumps = 0;
                }
                if (this._platformer.Vspeed >= 0 && this._platformer.onGround) {
                    if (this._platformer.Pressed(jumpbutton) && this._platformer.onGround && this._platformer.Ceiling == null) {
                        this._platformer.Vspeed = -this.jumpSpeed;
                        this.entity.PlaySound("jump");
                    }
                } else if (this.airJumps < this.maxAirJumps && this._platformer.Pressed(jumpbutton) && this._platformer.Ceiling == null) {
                    this._platformer.Vspeed = -(this.jumpSpeed * this.airjumppower);
                    this.airJumps = (this.airJumps + 1) | 0;
                }
                if (this._platformer.Vspeed < 0 && !controller[System.Array.index(jumpbutton, controller)]) {
                    this._platformer.Vspeed += (this._platformer.gravity * 2);
                }
                CirnoGame.EntityBehavior.prototype.Update.call(this);
            }
        }
    });

    Bridge.define("CirnoGame.PlayerBullet", {
        inherits: [CirnoGame.Entity,CirnoGame.IHarmfulEntity,CirnoGame.ILightSource],
        fields: {
            shooter: null,
            Duration: 0,
            hitEntities: null,
            piercing: false,
            spinrate: 0,
            Gravity: null,
            Bounces: false,
            attacksterrain: false,
            digpower: 0,
            ignoresterrain: false,
            _maxLightRadius: 0,
            _touchDamage: 0
        },
        props: {
            Attacker: {
                get: function () {
                    return this.shooter;
                }
            },
            IsHarmful: {
                get: function () {
                    return true;
                }
            },
            lightFlicker: {
                get: function () {
                    return false;
                }
            },
            lightPosition: {
                get: function () {
                    return this.getCenter();
                }
            },
            maxLightRadius: {
                get: function () {
                    return this.Ani.Alpha >= 1 ? this._maxLightRadius : 0.0;
                },
                set: function (value) {
                    this._maxLightRadius = value;
                }
            },
            touchDamage: {
                get: function () {
                    return this._touchDamage;
                },
                set: function (value) {
                    this._touchDamage = value;
                }
            }
        },
        alias: [
            "Attacker", "CirnoGame$IHarmfulEntity$Attacker",
            "IsHarmful", "CirnoGame$IHarmfulEntity$IsHarmful",
            "lightFlicker", "CirnoGame$ILightSource$lightFlicker",
            "lightPosition", "CirnoGame$ILightSource$lightPosition",
            "maxLightRadius", "CirnoGame$ILightSource$maxLightRadius",
            "touchDamage", "CirnoGame$IHarmfulEntity$touchDamage",
            "ontouchDamage", "CirnoGame$IHarmfulEntity$ontouchDamage"
        ],
        ctors: {
            init: function () {
                this.Duration = 0;
                this.spinrate = 0;
                this.Gravity = new CirnoGame.Vector2();
                this.attacksterrain = false;
                this.digpower = 0.5;
                this.ignoresterrain = false;
                this._maxLightRadius = 1.5;
                this._touchDamage = 1.0;
            },
            ctor: function (game, shooter, graphic) {
                if (graphic === void 0) { graphic = "Reisenbullet"; }

                this.$initialize();
                CirnoGame.Entity.ctor.call(this, game);
                this.Ani = new CirnoGame.Animation(CirnoGame.AnimationLoader._this.GetAnimation(graphic));
                this.shooter = shooter;

                //Ani.HueColor = Game.GetTeamColor(((ICombatant)shooter).Team);
                this.piercing = false;

                this.hitEntities = new (System.Collections.Generic.List$1(CirnoGame.Entity)).ctor();
            }
        },
        methods: {
            GetHitbox: function () {
                if (this.Ani != null && this.Ani.CurrentImage != null) {
                    //float s = Math.Max(Ani.CurrentImage.Width, Ani.CurrentImage.Height);
                    //float s = Ani.CurrentImage.Height;
                    var s = this.Ani.CurrentImage.height * 1.5;
                    //float s2 = s / 2f;
                    //Vector2 V = Ani.Position;
                    var so2 = s / 2;
                    //Vector2 V = getCenter() - new Vector2(so2,so2);
                    var V = CirnoGame.Vector2.Subtract$1(this.getCenter(), so2, so2);
                    return new CirnoGame.Rectangle(V.X, V.Y, s, s);
                }
                return null;
            },
            ontouchDamage: function (target) {
                if (!this.piercing) {
                    this.Alive = false;
                }

                var ok = !this.hitEntities.contains(Bridge.cast(target, CirnoGame.Entity));
                if (ok) {
                    this.hitEntities.add(Bridge.cast(target, CirnoGame.Entity));
                    return true;
                }
                return false;
            },
            Update: function () {
                CirnoGame.Entity.prototype.Update.call(this);
                if (this.spinrate !== 0) {
                    this.Ani.Rotation += this.spinrate;
                }
                if (this.Gravity.RoughLength !== 0) {
                    this.Speed = CirnoGame.Vector2.op_Addition(this.Speed, this.Gravity);
                }
                //if (!App.screenbounds.isTouching(GetHitbox()))

                //if (!Game.stageBounds.isTouching(GetHitbox()))
                if (!this.Game.stageBounds.containsPoint(this.Position)) {
                    if ((this.Ani.X > 0 === this.Hspeed > 0 || this.Ani.X < 0 === this.Hspeed < 0) || (this.Ani.Y > 0 === this.Vspeed > 0 || this.Ani.Y < 0 === this.Vspeed < 0)) {
                        this.Alive = false;
                    }
                }
                //Vector2 center = getCenter();
                var center = CirnoGame.Vector2.Add$1(this.Position, 8, 0);
                if (!this.ignoresterrain) {
                    var T = null;
                    if (!this.Bounces) {
                        T = this.Game.TM.CheckForTile(new CirnoGame.Vector2(center.X, this.y));
                    }
                    if (T != null && T.enabled && T.solid) {
                        if (this.attacksterrain) {
                            if (T.Breakable) {
                                //T.Damage(_touchDamage * digpower);
                                if (T.Damage(this.digpower)) {
                                    this.PlaySound("thunk4");
                                } else {
                                    this.PlaySound("thunk");
                                }
                            } else {
                                this.PlaySound("plink");
                            }
                        }
                        this.Alive = false;
                    } else if (this.Bounces) {

                        T = this.Game.TM.CheckForTile(CirnoGame.Vector2.op_Addition(center, new CirnoGame.Vector2(this.Speed.X)));
                        if (T != null && T.enabled && T.solidToSpeed(this.Speed.ToCardinal())) {
                            this.Speed.X = -this.Speed.X;
                        }

                        T = this.Game.TM.CheckForTile(CirnoGame.Vector2.op_Addition(center, new CirnoGame.Vector2(0, this.Speed.Y)));
                        if (T != null && T.enabled && T.solidToSpeed(this.Speed.ToCardinal())) {
                            this.Speed.Y = -this.Speed.Y;
                        }

                        T = this.Game.TM.CheckForTile(CirnoGame.Vector2.op_Addition(center, this.Speed));
                        if (T != null && T.enabled && T.solidToSpeed(this.Speed.ToCardinal())) {
                            this.Speed.X = -this.Speed.X;
                            this.Speed.Y = -this.Speed.Y;
                        }
                    }
                }
                if (this.Duration > 0) {
                    this.Duration = (this.Duration - 1) | 0;
                    if (this.Duration <= 0) {
                        this.Duration = 1;
                        this.Ani.Alpha -= 0.2;
                        if (this.Ani.Alpha <= 0) {
                            this.Alive = false;
                        }
                    }
                }
            }
        }
    });

    Bridge.define("CirnoGame.RandomAI", {
        inherits: [CirnoGame.EntityBehavior],
        fields: {
            CE: null
        },
        ctors: {
            ctor: function (entity) {
                this.$initialize();
                CirnoGame.EntityBehavior.ctor.call(this, entity);
                this.CE = entity;
                this.FramesPerTick = 15;
            }
        },
        methods: {
            Update: function () {
                CirnoGame.EntityBehavior.prototype.Update.call(this);
                if (Math.random() < 0.1) {
                    var Controller = this.CE.Controller;
                    Controller[System.Array.index(0, Controller)] = false;
                    Controller[System.Array.index(1, Controller)] = false;
                    Controller[System.Array.index(2, Controller)] = false;
                    Controller[System.Array.index(3, Controller)] = false;

                    if (Math.random() < 0.5) {
                        Controller[System.Array.index(0, Controller)] = Math.random() < 0.5;
                        Controller[System.Array.index(1, Controller)] = !Controller[System.Array.index(0, Controller)];
                    }

                    if (Math.random() < 0.5) {
                        Controller[System.Array.index(2, Controller)] = Math.random() < 0.5;
                        Controller[System.Array.index(3, Controller)] = !Controller[System.Array.index(2, Controller)];
                    }
                }
            }
        }
    });

    Bridge.define("CirnoGame.RoomOpeningLever", {
        inherits: [CirnoGame.Entity],
        statics: {
            fields: {
                TEST: null
            },
            methods: {
                FindAndPlaceOnWall: function (game, P, Target) {
                    var T = game.TM.CheckForTile(P);
                    if (T != null) {
                        var X = T.column;
                        var Y = T.row;

                        var XD = Math.random() < 0.5 ? -1 : 1;
                        while (true) {
                            X = (X + XD) | 0;
                            var T2 = game.TM.GetTile(X, Y);
                            if (T2 != null) {
                                if (T2.enabled && T2.solid) {
                                    var T3 = game.TM.GetTile(((X - XD) | 0), ((Y + 1) | 0));
                                    if (!(T3 != null && T3.enabled && T3.solid)) {
                                        var ret = new CirnoGame.RoomOpeningLever(game, new CirnoGame.Point(X, Y), Target, XD === 1);
                                        return ret.Alive ? ret : null;
                                    } else {
                                        return null;
                                    }
                                }
                            } else {
                                return null;
                            }
                        }
                    }
                    return null;
                }
            }
        },
        fields: {
            Room: null,
            Block: null
        },
        props: {
            Activated: false
        },
        ctors: {
            ctor: function (game, Tile, Target, flipped) {
                if (flipped === void 0) { flipped = false; }

                this.$initialize();
                CirnoGame.Entity.ctor.call(this, game);
                this.Ani = new CirnoGame.Animation(CirnoGame.AnimationLoader._this.GetAnimation("images/misc/lever"));
                this.Ani.ImageSpeed = 0;
                this.Block = Tile;
                var T = game.TM.GetTile(Tile.X, Tile.Y);
                CirnoGame.RoomOpeningLever.TEST = this;
                if (T != null && T.solid) {
                    if (Target != null) {
                        this.Room = Target;
                    }
                    T.Breakable = false;
                    T.CanSlope = false;
                    var R = T.GetHitbox();
                    if (flipped) {
                        this.Ani.Position.X = R.left - 16;
                        this.Ani.Flipped = true;
                    } else {
                        this.Ani.Position.X = R.right;
                    }
                    this.Ani.Position.Y = R.top;
                } else {
                    this.Alive = false;
                }
            }
        },
        methods: {
            Update: function () {
                CirnoGame.Entity.prototype.Update.call(this);
                var T = this.Game.TM.GetTile(this.Block.X, this.Block.X);
                if (T != null && T.enabled && T.solid) {
                    T.Breakable = false;
                    T.CanSlope = false;
                } else {
                    this.Alive = false;
                    if (this.Room != null) {
                        this.Room.ClearRoom();
                        this.Room.GeneratePlatforms();
                        this.Room.ApplyBreakable(); //attempt to remove seams
                        this.Room.ForceRedraw();
                    }
                    //Helper.Log("Removing broken lever...");
                }
                var P = this.Game.player;
                if (!this.Activated && P.Position.EstimatedDistance(this.Position) < 16 && P.Controller[System.Array.index(2, P.Controller)]) {
                    this.Activate();
                }
            },
            Activate: function () {
                if (!this.Activated) {
                    this.Activated = true;
                    this.PlaySound("open2"); //sounds better than the electronic switch.
                    this.Ani.CurrentFrame = 1;
                    this.Ani.SetImage();
                    this.Ani.Update();
                    this.Room.UnleashSecret();
                }
            }
        }
    });

    Bridge.define("CirnoGame.TextSprite", {
        inherits: [CirnoGame.Sprite],
        fields: {
            _Text: null,
            textInvallidated: false,
            imageInvallidated: false,
            TextImage: null,
            TextGraphic: null,
            _TextColor: null,
            _FontWeight: null,
            _FontFamily: null,
            _FontSize: 0,
            _shadowBlur: 0,
            _shadowOffset: null,
            _shadowColor: null
        },
        props: {
            Text: {
                get: function () {
                    return this._Text;
                },
                set: function (value) {
                    if (!Bridge.referenceEquals(this._Text, value)) {
                        this._Text = value;
                        /* RedrawBaseTextImage();
                        RenderTextImage();*/
                        this.textInvallidated = true;
                        //imageInvallidated = true;
                    }
                }
            },
            TextColor: {
                get: function () {
                    return this._TextColor;
                },
                set: function (value) {
                    if (!Bridge.referenceEquals(this._TextColor, value)) {
                        this._TextColor = value;
                        //RenderTextImage();
                        this.textInvallidated = true;

                        //imageInvallidated = true;
                    }
                }
            },
            FontWeight: {
                get: function () {
                    return this._FontWeight;
                },
                set: function (value) {
                    if (!Bridge.referenceEquals(this._FontWeight, value)) {
                        this._FontWeight = value;
                        this.UpdateFont();
                    }
                }
            },
            FontFamily: {
                get: function () {
                    return this._FontFamily;
                },
                set: function (value) {
                    if (!Bridge.referenceEquals(this._FontFamily, value)) {
                        this._FontFamily = value;
                        this.UpdateFont();
                    }
                }
            },
            FontSize: {
                get: function () {
                    return this._FontSize;
                },
                set: function (value) {
                    if (this._FontSize !== value) {
                        this._FontSize = value;
                        this.UpdateFont();
                    }
                }
            },
            ShadowBlur: {
                get: function () {
                    return this._shadowBlur;
                },
                set: function (value) {
                    if (this._shadowBlur !== value) {
                        this._shadowBlur = value;
                        this.imageInvallidated = true;
                    }
                }
            },
            ShadowOffset: {
                get: function () {
                    return this._shadowOffset.Clone();
                },
                set: function (value) {
                    if (CirnoGame.Vector2.op_Inequality(this._shadowOffset, value) && value.X !== this._shadowOffset.X && value.Y !== this._shadowOffset.Y) {
                        this._shadowOffset = value.Clone();
                        this.imageInvallidated = true;
                    }
                }
            },
            ShadowColor: {
                get: function () {
                    return this._shadowColor;
                },
                set: function (value) {
                    if (!Bridge.referenceEquals(this._shadowColor, value)) {
                        this._shadowColor = value;
                        this.imageInvallidated = true;
                    }
                }
            }
        },
        ctors: {
            init: function () {
                this._FontWeight = "normal";
                this._FontFamily = "sans-serif";
                this._FontSize = 10;
                this._shadowBlur = 0.0;
                this._shadowOffset = new CirnoGame.Vector2();
                this._shadowColor = "#000000";
            },
            ctor: function () {
                this.$initialize();
                CirnoGame.Sprite.ctor.call(this);
                this.TextImage = document.createElement("canvas");
                this.TextGraphic = this.TextImage.getContext("2d");
                this.TextGraphic.imageSmoothingEnabled = false;
                //TextGraphic.Font.
                this.TextImage.style.imageRendering = "pixelated";
                this.TextGraphic.fillStyle = "#FFFFFF";
            }
        },
        methods: {
            UpdateFont: function () {
                this.TextGraphic.font = System.String.concat(this._FontWeight, " ", this._FontSize, "px ", this._FontFamily);
                this.textInvallidated = true;
                this.imageInvallidated = true;
                this.TextGraphic.fillStyle = this._TextColor;
            },
            RedrawBaseTextImage: function () {
                this.UpdateFont();
                var lines = System.String.split(this._Text, [10].map(function(i) {{ return String.fromCharCode(i); }}));
                var H = this.FontSize * 1.0;


                var W = 0;
                var i = 0;
                while (i < lines.length) {
                    var TM = this.TextGraphic.measureText(lines[System.Array.index(i, lines)]);
                    W = Math.max(W, Bridge.Int.clip32(Math.ceil(TM.width)));
                    i = (i + 1) | 0;
                }
                //TextImage.Height = (int)(H * (lines.Length+0.5f));
                this.TextImage.height = Bridge.Int.clip32(H * (lines.length + 0.25));
                this.TextImage.width = W;
                this.UpdateFont();

                var Y = 0;
                i = 0;
                while (i < lines.length) {
                    this.TextGraphic.fillText(lines[System.Array.index(i, lines)], 0, this.FontSize + Y);
                    Y += H;
                    i = (i + 1) | 0;
                }

                this.textInvallidated = false;
                this.imageInvallidated = true;
            },
            RenderTextImage: function () {

                if (this._shadowBlur <= 0) {
                    this.spriteBuffer.width = this.TextImage.width;
                    this.spriteBuffer.height = this.TextImage.height;
                } else {
                    var S = Bridge.Int.clip32(Math.ceil(this._shadowBlur + this._shadowBlur));
                    this.spriteBuffer.width = (this.TextImage.width + S) | 0;
                    this.spriteBuffer.height = (this.TextImage.height + S) | 0;
                }
                this.spriteGraphics.shadowBlur = 0;

                this.spriteGraphics.globalCompositeOperation = "source-over";
                /* spriteGraphics.FillStyle = _TextColor;
                spriteGraphics.FillRect(0, 0, spriteBuffer.Width, spriteBuffer.Height);
                Script.Write("this.spriteGraphics.globalCompositeOperation = 'destination-in'");*/
                if (this.TextImage.width <= 0) {
                    this.imageInvallidated = false;
                    return;
                }
                if (this._shadowBlur <= 0) {
                    this.spriteGraphics.drawImage(this.TextImage, 0.0, 0.0);
                } else {
                    this.spriteGraphics.drawImage(this.TextImage, this._shadowBlur, this._shadowBlur);
                }

                if (this._shadowBlur > 0) {
                    this.spriteGraphics.shadowBlur = this._shadowBlur;
                    this.spriteGraphics.shadowColor = this._shadowColor;
                    this.spriteGraphics.shadowOffsetX = this._shadowOffset.X;
                    this.spriteGraphics.shadowOffsetY = this._shadowOffset.Y;
                    this.spriteGraphics.drawImage(this.spriteBuffer, 0.0, 0.0);
                }



                this.imageInvallidated = false;
            },
            ForceUpdate: function () {
                if (this.textInvallidated) {
                    this.RedrawBaseTextImage();
                }
                if (this.imageInvallidated) {
                    this.RenderTextImage();
                }
            },
            Draw: function (g) {
                this.ForceUpdate();
                CirnoGame.Sprite.prototype.Draw.call(this, g);
            }
        }
    });

    Bridge.define("CirnoGame.Tile", {
        inherits: [CirnoGame.Entity],
        fields: {
            tile: 0
        },
        ctors: {
            ctor: function (game, tile) {
                this.$initialize();
                CirnoGame.Entity.ctor.call(this, game);
                this.tile = tile;
                this.Ani = new CirnoGame.Animation(CirnoGame.AnimationLoader.Get("images/land/brick"));
                this.Ani.CurrentFrame = tile;
                this.Ani.ImageSpeed = 0;
            }
        },
        methods: {
            Draw: function (g) {
                /* if (tile>=0 && tile < ani.images.Count)
                {
                   ani.currentFrame = tile;
                }*/
                CirnoGame.Entity.prototype.Draw.call(this, g);
            }
        }
    });

    Bridge.define("CirnoGame.TitleScreen", {
        inherits: [CirnoGame.Sprite],
        fields: {
            Title: null,
            Version: null,
            Desc: null,
            Controls: null,
            Credits: null,
            menu: null,
            Controller: null,
            game: null
        },
        ctors: {
            ctor: function () {
                this.$initialize();
                CirnoGame.Sprite.ctor.call(this);
                this.spriteBuffer.width = CirnoGame.App.Canvas.width;
                this.spriteBuffer.height = Bridge.Int.clip32(this.spriteBuffer.width * CirnoGame.App.TargetAspect);
                this.Title = new CirnoGame.TextSprite();
                this.Title.FontSize = Bridge.Int.clip32(this.spriteBuffer.width * 0.06);
                //Title.Text = "Cirno and the mysterious tower";
                this.Title.Text = CirnoGame.App.GameName;
                this.Title.TextColor = "#77FFFF";
                this.Title.ShadowColor = "#000000";
                this.Title.ShadowOffset = new CirnoGame.Vector2(2, 2);
                this.Title.ShadowBlur = 2;

                this.CenterTextWithFloats(this.Title, 0.5, 0.06);

                this.Version = new CirnoGame.TextSprite();
                this.Version.FontSize = Bridge.Int.clip32(this.spriteBuffer.width * 0.016);
                this.Version.Text = System.String.concat("Version:", CirnoGame.App.GameVersion);
                this.Version.TextColor = "#FFFFFF";
                this.Version.ShadowColor = "#000000";
                this.Version.ShadowOffset = new CirnoGame.Vector2(2, 2);
                this.Version.ShadowBlur = 2;

                this.CenterTextWithFloats(this.Version, 0.75, 0.11);

                /* Title.ForceUpdate();
                Title.Position.Y = spriteBuffer.Height * 0.01f;
                Title.Position.X = (spriteBuffer.Width / 2) - (Title.spriteBuffer.Width / 2);*/



                this.Desc = new CirnoGame.TextSprite();
                this.Desc.FontSize = Bridge.Int.clip32(this.spriteBuffer.width * 0.03);
                this.Desc.TextColor = "#FFFFFF";
                //Desc.Text = "Cirno has found herself in a strange dungeon filled with ghosts!\nHer energy has been stolen, reclaim the energy orbs to extend your time.\nFind the big key to unlock the door.";
                //Desc.Text = "Cirno has found herself in a strange dungeon filled with ghosts!\nReclaim your stolen energy sealed inside the orbs to extend your time.\nFind the gold key to unlock the door.";
                this.Desc.Text = "Cirno has found herself in a strange tower filled with ghosts!\nReclaim your stolen energy sealed inside the orbs to extend your time.\nRemember the door's location and search for the gold key.";
                this.Desc.ShadowColor = "#000000";
                this.Desc.ShadowOffset = new CirnoGame.Vector2(2, 2);
                this.Desc.ShadowBlur = 2;
                this.CenterTextWithFloats(this.Desc, 0.5, 0.2);

                this.Controls = new CirnoGame.TextSprite();
                this.Controls.FontSize = Bridge.Int.clip32(this.spriteBuffer.width * 0.025);
                this.Controls.TextColor = "#FFFFFF";
                this.Controls.Text = "Keyboard Controls:\nLeft/Right=Move\nUp/Down=Aim(Up activates chests/doors)\nZ=Shoot\nX=Jump/Mid-air jump\nA=Place block below you(costs time)\nEnter=Pause\nM=Toggle mute";
                this.Controls.ShadowColor = "#000000";
                this.Controls.ShadowOffset = new CirnoGame.Vector2(2, 2);
                this.Controls.ShadowBlur = 2;
                this.CenterTextWithFloats(this.Controls, 0.5, 0.4);
                this.Controls.Position.X = this.Desc.Position.X;

                this.menu = new CirnoGame.ButtonMenu(this.spriteBuffer.width * 0.8, this.spriteBuffer.height * 0.5, Bridge.Int.clip32(this.spriteBuffer.width * 0.05));
                var B = this.menu.AddButton("Start Game");
                B.OnClick = Bridge.fn.bind(this, function () {
                    this.game.Start();
                });
                //menu.Finish();
                B.Position.X += this.spriteBuffer.width * 0.38;
                B.Position.Y = this.spriteBuffer.height * 0.7;

                //var CB = menu.AddButton("Controller:"+InputControllerManager._this.Controllers[0].id);
                var CB = this.menu.AddButton(System.String.concat("Controller:", CirnoGame.App.IC.id));
                this.Controller = CB;
                CB.OnClick = function () {
                    var ind = CirnoGame.InputControllerManager._this.Controllers.indexOf(CirnoGame.App.IC);
                    ind = (ind + 1) | 0;
                    if (ind >= CirnoGame.InputControllerManager._this.Controllers.Count) {
                        ind = (ind - CirnoGame.InputControllerManager._this.Controllers.Count) | 0;
                    }
                    CirnoGame.App.IC = CirnoGame.InputControllerManager._this.Controllers.getItem(ind);
                    var TS = CB.Contents;
                    var W = TS.spriteBuffer.width;
                    TS.Text = System.String.concat("Controller:", CirnoGame.App.IC.id);
                    TS.ForceUpdate();
                    CB.Position.X -= ((((Bridge.Int.div((((TS.spriteBuffer.width - W) | 0)), 2)) | 0))) | 0;
                };
                CB.Position.X += this.spriteBuffer.width * 0.38;
                ;
                CB.Position.Y = B.Position.Y + (this.spriteBuffer.height * 0.15);
                //CB.Visible = false;
                CB.Lock();

                this.Credits = new CirnoGame.TextSprite();
                this.Credits.FontSize = Bridge.Int.clip32(this.spriteBuffer.width * 0.015);
                this.Credits.TextColor = "#77FFFF";
                //Credits.Text = "Made by:RSGmaker                                                                                                                     Touhou Project and it's characters are owned by ZUN";
                this.Credits.Text = "Made by:RSGmaker                                                                                                           Touhou Project and it's characters are owned by ZUN";
                this.Credits.ShadowColor = "#000000";
                this.Credits.ShadowOffset = new CirnoGame.Vector2(2, 2);
                this.Credits.ShadowBlur = 2;
                this.CenterTextWithFloats(this.Credits, 0.5, 0.98);
            }
        },
        methods: {
            CenterTextWithFloats: function (T, X, Y) {
                this.CenterText(T, new CirnoGame.Vector2(this.spriteBuffer.width * X, this.spriteBuffer.height * Y));
            },
            CenterText: function (T, Location) {
                T.ForceUpdate();
                T.Position.X = Location.X - (((Bridge.Int.div(T.spriteBuffer.width, 2)) | 0));
                T.Position.Y = Location.Y - (((Bridge.Int.div(T.spriteBuffer.height, 2)) | 0));
            },
            Draw: function (g) {
                CirnoGame.Sprite.prototype.Draw.call(this, g);
                if (this.Controller.locked && CirnoGame.InputControllerManager._this.Controllers.Count > 1) {
                    this.Controller.Unlock();
                }

                this.Title.Draw(g);
                this.Version.Draw(g);
                this.Desc.Draw(g);
                this.Controls.Draw(g);
                this.menu.Draw(g);
                this.menu.Update();
                this.Credits.Draw(g);

                //var M = KeyboardManager._this.MousePosition.Clone();
                var M = CirnoGame.KeyboardManager._this.CMouse.Clone();
                if (!System.String.contains(CirnoGame.App.Div.style.left,"px")) {
                    return;
                }
                /* M.X -= float.Parse(App.Div.Style.Left.Replace("px", ""));*/
                //Credits.Text = "X:" + M.X+"/"+(spriteBuffer.Width * 0.1) +" Y:"+M.Y+"/"+(spriteBuffer.Height * 0.96);
                if (M.X < this.spriteBuffer.width * 0.17 && M.Y >= this.spriteBuffer.height * 0.96) {
                    CirnoGame.App.Div.style.cursor = "pointer";
                    if (CirnoGame.KeyboardManager._this.TappedMouseButtons.contains(0)) {
                        Bridge.global.location.href = "https://rsgmaker.deviantart.com";
                    }
                } else {
                    CirnoGame.App.Div.style.cursor = null;
                }
            }
        }
    });

    Bridge.define("CirnoGame.Turret", {
        inherits: [CirnoGame.Entity,CirnoGame.ICombatant],
        fields: {
            attackpower: 0,
            TTD: null
        },
        props: {
            Team: 0,
            HP: 0,
            PointsForKilling: {
                get: function () {
                    return 1;
                }
            },
            TargetPriority: {
                get: function () {
                    return 0.5;
                }
            }
        },
        alias: [
            "Team", "CirnoGame$ICombatant$Team",
            "HP", "CirnoGame$ICombatant$HP",
            "PointsForKilling", "CirnoGame$ICombatant$PointsForKilling",
            "TargetPriority", "CirnoGame$ICombatant$TargetPriority",
            "onDamaged", "CirnoGame$ICombatant$onDamaged",
            "onDeath", "CirnoGame$ICombatant$onDeath",
            "onKill", "CirnoGame$ICombatant$onKill"
        ],
        ctors: {
            init: function () {
                this.attackpower = 1;
            },
            ctor: function (game) {
                this.$initialize();
                CirnoGame.Entity.ctor.call(this, game);
                this.Ani = new CirnoGame.Animation(CirnoGame.AnimationLoader._this.GetAnimation("images/enemies/turret"));
                this.Ani.ImageSpeed = 0;

                this.attackpower = 1 + (this.Game.level * 0.5);
                this.attackpower *= 2;
                this.HP = 0;
                this.Team = 2;
                //defensepower = 1 + (Game.level * 0.5f);
                if (this.Game.playing) {
                    var A = this.AddBehavior(CirnoGame.AimedShooter);
                    A.attackpower = this.attackpower;
                    A.maxtime = Math.max(((480 - (Bridge.Int.mul(this.Game.level, 10))) | 0), 380);
                    //A.maxtime = (int)(A.maxtime*1.75f);
                    A.maxtime = Bridge.Int.clip32(A.maxtime * 1.25);
                    A.ignoresterrain = true;
                    A.maxDistance *= 1.3;
                    A.maxShadow = 1;
                    A.bulletSpeed *= 0.8;
                    A.bulletDuration = 540;
                    A.bulletgraphic = "turretbullet";
                    A.attackTelegraphTime = (A.attackTelegraphTime + A.attackTelegraphTime) | 0;
                }
            }
        },
        methods: {
            getCenter: function () {
                return CirnoGame.Vector2.Add$1(this.Position, 5, 5);
            },
            onDamaged: function (source, amount) {
                //throw new NotImplementedException();
            },
            onDeath: function (source) {
                //throw new NotImplementedException();
            },
            onKill: function (combatant) {
                //throw new NotImplementedException();
            },
            SetDown: function (forcedown) {
                if (forcedown === void 0) { forcedown = false; }
                var TZ = this.Game.TM.tilesize;
                var TD = this.Game.TM.CheckForTile(this.Position);
                var attempts = 0;
                var direction = Math.random() < 0.5 ? TZ : -TZ;
                if (forcedown) {
                    direction = TZ;
                }
                while (!(TD != null && TD.solid && TD.visible) && attempts < 20) {
                    this.y += direction;
                    TD = this.Game.TM.CheckForTile(this.Position);
                }
                if (attempts >= 20) {
                    this.Alive = false;
                    return;
                } else {
                    this.x = (TD.column * TZ) + this.Game.TM.position.X;
                    this.y = (TD.row * TZ) + this.Game.TM.position.Y;
                    //TD.HP = TD.maxHP * 2;
                }
                this.TTD = TD;

            },
            Update: function () {
                var TD = this.Game.TM.CheckForTile(this.Position);
                if (TD != null && TD.solid && TD.visible && TD.opaque) {

                } else if (this.Alive) {
                    this.Alive = false;
                    var P = new CirnoGame.PointItem(this.Game);
                    P.Position.CopyFrom(this.Position);
                    P.collectionDelay = (Bridge.Int.div(P.collectionDelay, 2)) | 0;
                    this.Game.AddEntity(P);
                    if (Math.random() < 0.15) {
                        P = new CirnoGame.HealingItem(this.Game);
                        P.Position.CopyFrom(this.Position);
                        P.Vspeed = -2;
                        P.collectionDelay = (Bridge.Int.div(P.collectionDelay, 2)) | 0;
                        this.Game.AddEntity(P);
                    }
                    return;
                }
                if (TD.CanSlope) {
                    var redraw = false;
                    if (TD.SlopeDirection !== 0) {
                        redraw = true;
                    }
                    TD.CanSlope = false;
                    if (redraw) {
                        TD.UpdateTile();
                    }
                }
                if (this.Ani.Shadow > 0) {
                    this.Ani.ImageSpeed = 0.25;
                } else if (this.Ani.ImageSpeed > 0) {
                    this.Ani.ImageSpeed = 0;
                    this.Ani.CurrentFrame = 0;
                    this.Ani.SetImage();
                }
                CirnoGame.Entity.prototype.Update.call(this);

            }
        }
    });

    Bridge.define("CirnoGame.DoorKey", {
        inherits: [CirnoGame.CollectableItem],
        ctors: {
            ctor: function (game) {
                this.$initialize();
                CirnoGame.CollectableItem.ctor.call(this, game, "bigkey");
                this.floats = false;
                this.magnetDistance = 20;
                this.sound = "key";
            }
        },
        methods: {
            onCollected: function (player) {
                //throw new NotImplementedException();
                this.Game.Door.Opened = true;

                var FM = new CirnoGame.FloatingMessage(this.Game, "Door Unlocked!");
                FM.Text.TextColor = "#77FFFF";
                FM.Position = new CirnoGame.Vector2(this.x + 8, this.y - 20);
                this.Game.AddEntity(FM);
            },
            Update: function () {
                CirnoGame.CollectableItem.prototype.Update.call(this);
                if (this.y <= 0) {
                    this.Game.LevelRestart();
                }
            }
        }
    });

    Bridge.define("CirnoGame.Game", {
        inherits: [CirnoGame.GameSprite],
        statics: {
            methods: {
                GetTeamColor: function (team) {
                    if (team === 1) {
                        return "#FF0000";
                    } else if (team === 2 || team === 0) {
                        return "#0000FF";
                    } else if (team === 3) {
                        return "#FFFF00";
                    }
                    return "#000000";
                }
            }
        },
        fields: {
            player: null,
            entities: null,
            harmful: null,
            combatants: null,
            camera: null,
            stageBounds: null,
            TM: null,
            GamePlaySettings: null,
            TimerSprite: null,
            defaultTimeRemaining: 0,
            lastStand: 0,
            baseLifeCost: 0,
            timeRemaining: 0,
            totalTime: 0,
            level: 0,
            playing: false,
            paused: false,
            cameraWanderPoint: null,
            TS: null,
            Teams: false,
            skiprender: false,
            ScoreSprite: null,
            EG: null,
            Door: null,
            Key: null,
            BigKey: null,
            muted: false,
            lastPauseButtonState: false,
            ShowHitbox: false,
            freecam: false
        },
        props: {
            running: {
                get: function () {
                    return this.playing && !this.paused;
                }
            }
        },
        ctors: {
            init: function () {
                this.defaultTimeRemaining = 180000;
                this.lastStand = 30000;
                this.baseLifeCost = 15000;
                this.totalTime = 0;
                this.level = 0;
                this.playing = false;
                this.paused = false;
                this.Teams = true;
                this.skiprender = true;
                this.muted = false;
                this.lastPauseButtonState = false;
                this.ShowHitbox = false;
                this.freecam = false;
            },
            ctor: function () {
                this.$initialize();
                CirnoGame.GameSprite.ctor.call(this);
                this.GamePlaySettings = new CirnoGame.GamePlaySettings();
                this.Door = new CirnoGame.ExitDoor(this);
                this.entities = new (System.Collections.Generic.List$1(CirnoGame.Entity)).ctor();
                this.combatants = new (System.Collections.Generic.List$1(CirnoGame.Entity)).ctor();
                this.harmful = new (System.Collections.Generic.List$1(CirnoGame.Entity)).ctor();

                this.player = new CirnoGame.PlayerCharacter(this);
                this.player.HP = 0;
                this.timeRemaining = this.defaultTimeRemaining;
                //timeRemaining *= 0.3334f * 0.25f;

                /* test.Ani = new Animation(AnimationLoader._this.Get("images/cirno/walk"));
                test.Ani.ImageSpeed = 0.1f;*/

                //stageBounds = new Rectangle(0, 0, 8000, 3000);
                //stageBounds = new Rectangle(0, 0, 6000, 4000);
                //stageBounds = new Rectangle(0, 0, 2000, 1500);
                //stageBounds = new Rectangle(0, 0, 1000, 750);
                //stageBounds = new Rectangle(0, 0, 2000, 1000);
                this.stageBounds = new CirnoGame.Rectangle(0, 0, 4000, 2000);
                this.TM = new CirnoGame.TileMap(this);
                this.TM.Seed = Bridge.Int.clip32(Math.random() * System.Int64([1410065407,2]));
                this.TM.position.Y = 0;
                var R = CirnoGame.Rectangle.op_Subtraction(this.stageBounds, this.TM.position);
                R.width -= this.TM.tilesize;
                R.height -= this.TM.tilesize;
                //TM.DrawRect(R);



                this.player.Position.Y = this.stageBounds.height / 3;
                this.player.Position.X = this.stageBounds.width / 2;

                this.EG = CirnoGame.Helper.GetContext(document.createElement("canvas"));
                //MapGenerator.Generate(this);
                /* MapGenerator.BoxyGenerate(this);            
                TM.DrawRect(R);
                //TM.testTexture();
                TM.ApplyBreakable();*/
                /* var E = new Entity(this);
                E.Ani = new Animation(AnimationLoader.Get("Images/land/brick"));
                E.y += 24;
                entities.Add(E);
                var ln = 10;
                var i = 0;
                while (i < ln)
                {
                   E = new Entity(this);
                   E.Ani = new Animation(AnimationLoader.Get("Images/land/brick"));
                   E.y += 24;
                   E.x += 16 * (i+1);
                   entities.Add(E);
                   i++;
                }
                i = 0;
                while (i < ln)
                {
                   E = new Entity(this);
                   E.Ani = new Animation(AnimationLoader.Get("Images/land/brick"));
                   E.y += 24;
                   E.x += 16 * -(i + 1);
                   entities.Add(E);
                   i++;
                }*/


                //entities.Add(test);
                this.AddEntity(this.Door);


                //spriteBuffer.Width = 200;
                this.spriteBuffer.width = CirnoGame.App.Canvas.width;
                this.spriteBuffer.height = Bridge.Int.clip32(this.spriteBuffer.width * CirnoGame.App.TargetAspect);
                /* camera.viewport_width = spriteBuffer.Width;
                camera.viewport_height = spriteBuffer.Height;*/
                this.camera = new CirnoGame.Camera(this.spriteBuffer.width, this.spriteBuffer.height);
                //camera.Scale = 6;
                //camera.Scale = 4;
                //camera.Scale = 3.5f;
                this.camera.Scale = 3.75;

                //camera.Scale = 1f;
                this.camera.StageBounds = this.stageBounds;
                this.camera.Update();
                this.camera.instawarp = true;
                /* spriteBuffer.Width = App.Canvas.Width;
                spriteBuffer.Height = App.Canvas.Height;*/
                this.spriteGraphics.imageSmoothingEnabled = false;

                /* PlaceAndAddEntity(new DoorKey(this));

                var i = 0;
                //while (i < 110)
                while (i < 24)
                {
                   PlaceAndAddEntity(new MRGhosty(this));
                   i++;
                }
                i = 0;
                while (i++ <= 6)
                   PlaceAndAddEntity(new Orb(this));
                i = 0;
                while (i++ <= 3)
                {
                   PlaceAndAddEntity(new Chest(this));
                   PlaceAndAddEntity(new KeyItem(this));
                }
                i = 0;
                while (i++ <= 2)
                {
                   PlaceAndAddEntity(new HealingItem(this));
                }*/
                this.StartNextLevel();


                this.TimerSprite = new CirnoGame.TextSprite();
                this.TimerSprite.FontSize = (Bridge.Int.div(this.spriteBuffer.height, 24)) | 0;
                this.TimerSprite.Text = "3:00";
                this.TimerSprite.TextColor = "#FFFFFF";
                this.TimerSprite.ShadowColor = "#000000";
                this.TimerSprite.ShadowOffset = new CirnoGame.Vector2(3, 3);
                this.TimerSprite.ShadowBlur = 1;

                this.TimerSprite.Position.X = this.spriteBuffer.width * 0.47;
                this.TimerSprite.Position.Y = (Bridge.Int.div(((-this.TimerSprite.FontSize) | 0), 8)) | 0;

                this.ScoreSprite = new CirnoGame.TextSprite();
                //ScoreSprite.FontSize = spriteBuffer.Height / 24;
                this.ScoreSprite.FontSize = (Bridge.Int.div(this.spriteBuffer.height, 28)) | 0;
                this.ScoreSprite.Text = "Level:1 Score:0";
                this.ScoreSprite.TextColor = "#FFFFFF";
                this.ScoreSprite.ShadowColor = "#000000";
                this.ScoreSprite.ShadowOffset = new CirnoGame.Vector2(3, 3);
                this.ScoreSprite.ShadowBlur = 1;

                //ScoreSprite.Position.X = spriteBuffer.Width * 0.7f;
                this.ScoreSprite.ForceUpdate();
                this.ScoreSprite.Position.X = (this.spriteBuffer.width * 0.98) - this.ScoreSprite.spriteBuffer.width;
                this.ScoreSprite.Position.Y = (Bridge.Int.div(((-this.ScoreSprite.FontSize) | 0), 8)) | 0;

                this.Key = CirnoGame.AnimationLoader.Get("images/items/key").getItem(0);
                this.BigKey = CirnoGame.AnimationLoader.Get("images/items/bigkey").getItem(0);

                this.TS = new CirnoGame.TitleScreen();
                this.TS.game = this;

                //PlayMusic("theme2");
                this.SetMusic();
            }
        },
        methods: {
            ClearEntities: function () {
                var L = this.entities.toArray();
                var i = 0;
                while (i < L.length) {
                    var E = L[System.Array.index(i, L)];
                    //if (!(E == player || E is ExitDoor))
                    if (E.RemovedOnLevelEnd) {
                        E.Alive = false;
                        this.RemoveEntity(E);
                    }
                    i = (i + 1) | 0;
                }
            },
            StartNextLevel: function () {
                this.ClearEntities();
                CirnoGame.RoomOpeningLever.TEST = null;
                this.level = (this.level + 1) | 0;
                var R = CirnoGame.Rectangle.op_Subtraction(this.stageBounds, this.TM.position);
                R.width -= this.TM.tilesize;
                R.height -= this.TM.tilesize;
                this.TM.Generate();
                CirnoGame.MapGenerator.BoxyGenerate(this);
                //TM.DrawRect(R);
                //TM.ApplyBreakable();


                //var ghosts = (int)(Math.Min(18 + level * 2, 28) * 0.85);
                var ghosts = Bridge.Int.clip32(Math.min(((18 + Bridge.Int.mul(this.level, 2)) | 0), 28) * 1.0);
                var i = 0;
                //while (i < 110)
                while (i < ghosts) {
                    //if (Math.Random() < 0.67)
                    if (Math.random() < 0.5) {
                        this.PlaceAndAddEnemy(new CirnoGame.MRGhosty(this));
                    } else {
                        var spike = Math.random() < 0.25;
                        var T = new CirnoGame.Turret(this);
                        this.PlaceAndAddEnemy(T);
                        T.SetDown(spike);
                        if (spike) {
                            var TD = T.TTD;
                            if (TD != null && this.TM.rows > ((TD.row + 1) | 0)) {
                                var TDD = this.TM.data.get([TD.column, ((TD.row + 1) | 0)]);
                                if (TDD.enabled && TDD.solid) {
                                    T.Alive = false;

                                    TD.texture = 7;
                                    TD.Breakable = false;
                                    TD.CanSlope = false;
                                    TD.opaque = false;
                                    TD.SteppedOn = Bridge.fn.bind(this, function (E) {
                                        var IC = E;
                                        if (IC.blockprice > 0 && IC.invincibilitytime <= 0) {
                                            IC.onDamaged(null, 1.5 + (this.level * 1.5));
                                            IC.PlaySound("damaged");
                                            if (IC.HP <= 0) {
                                                IC.onDeath(null);
                                            }
                                        }
                                    });
                                }
                            }
                        }
                    }
                    i = (i + 1) | 0;
                }
                i = 0;
                //while (i++ <= 6)
                while (Bridge.identity(i, (i = (i + 1) | 0)) <= 4) {
                    this.PlaceAndAddEntity(new CirnoGame.Orb(this));
                }
                i = 0;
                while (Bridge.identity(i, (i = (i + 1) | 0)) <= 3) {
                    this.PlaceAndAddEntity(new CirnoGame.Chest(this));
                    this.PlaceAndAddEntity(new CirnoGame.KeyItem(this));
                }
                i = 0;
                while (Bridge.identity(i, (i = (i + 1) | 0)) <= 1) {
                    this.PlaceAndAddEntity(new CirnoGame.HealingItem(this));
                }

                var key = new CirnoGame.DoorKey(this);
                var attempts = 0;

                this.PlaceAndAddEntity(key);
                while (Math.abs(key.x - this.player.x) < 70 && attempts < 5) { //attempt to prevent key from spawning too close
                    console.log("Door key is too close, repositioning key...");

                    key.Position.CopyFrom(CirnoGame.MapRoom.FindAnyEmptySpot());
                    attempts = (attempts + 1) | 0;
                }
                CirnoGame.MapGenerator.keyroom = CirnoGame.MapRoom.FindRoom(key.Position);
                /* PlaceAndAddEntity(new DoorKey(this));
                PlaceAndAddEntity(new DoorKey(this));
                PlaceAndAddEntity(new DoorKey(this));
                PlaceAndAddEntity(new DoorKey(this));*/

                this.player.invincibilitytime = 180;
                this.camera.instawarp = true;
                this.skiprender = true;
                if (this.playing) {
                    this.SetMusic();
                }
            },
            SetMusic: function () {
                if (!this.playing) {
                    this.PlayMusic("theme3");
                    return;
                }
                var songs = 3;
                var levelspersong = 5;
                var S = ((Bridge.Int.div(this.level, levelspersong)) | 0);
                S = S % songs;
                this.PlayMusic("theme" + (((S + 1) | 0)));
            },
            PlaceAndAddEntity: function (E) {
                E.Position.CopyFrom(CirnoGame.MapRoom.FindAnyEmptySpot());
                this.AddEntity(E);
            },
            PlaceAndAddEnemy: function (E) {
                E.Position.CopyFrom(CirnoGame.MapRoom.FindAnyEmptySpot());
                var attempts = 1;
                while (E.Position.EstimatedDistance(this.player.Position) < 128 && attempts < 5) {
                    console.log("Enemy spawned too close, repositioning enemy...");

                    E.Position.CopyFrom(CirnoGame.MapRoom.FindAnyEmptySpot());
                    attempts = (attempts + 1) | 0;
                }
                this.AddEntity(E);
                this.AddEntity(E);
            },
            Update: function () {
                CirnoGame.GameSprite.prototype.Update.call(this);
                this.Teams = this.GamePlaySettings.GameMode.Teams;
                //if (playing && KeyboardManager._this.TappedButtons.Contains(13))
                if (this.playing && CirnoGame.App.IC.getPressed(5) && !this.lastPauseButtonState) {
                    this.paused = !this.paused;
                }
                this.lastPauseButtonState = CirnoGame.App.IC.getPressed(5);
                if (this.playing && CirnoGame.KeyboardManager._this.TappedButtons.contains(77)) {
                    CirnoGame.AudioManager._this.StopAll();
                    this.muted = !this.muted;
                    if (!this.muted) {
                        this.SetMusic();
                    }
                    CirnoGame.KeyboardManager._this.TappedButtons.remove(77);
                }
                if (!this.paused) {
                    this.UpdateControls();

                    var i = 0;
                    while (i < this.entities.Count) {
                        var E = this.entities.getItem(i);
                        if (E.Alive) {
                            E.Update();
                        }
                        if (!E.Alive) {
                            this.RemoveEntity(E);
                            i = (i - 1) | 0;
                        }
                        i = (i + 1) | 0;
                    }
                    this.UpdateCollisions();
                    this.UpdateTime();
                    if (this.playing && this.player.y < 0) {
                        //player glitched out somehow make a new level.
                        this.LevelRestart();
                    }
                } else {
                    this.TimerSprite.Text = "Paused";
                }
            },
            LevelRestart: function () {
                this.level = (this.level - 1) | 0;
                this.StartNextLevel();
            },
            DoGameOver: function () {
                if (!this.playing) {
                    return;
                }
                if (this.entities.contains(this.player)) {
                    this.RemoveEntity(this.player);
                    //DoGameOver();
                }
                this.playing = false;
                this.StartNextLevel();

            },
            UpdateTime: function () {
                var $t;
                //timeRemaining -= 16.66667f;
                if (this.paused) {
                    this.TimerSprite.Text = "Paused";
                    return;
                }
                if (this.timeRemaining <= 0) {
                    this.timeRemaining = 0;
                    this.TimerSprite.Text = "0";
                    this.TimerSprite.TextColor = "#FF0000";
                    if (this.player.HP > 0) {
                        this.player.HP -= 0.006;
                    } else {
                        this.DoGameOver();
                    }
                    return;
                } else if (this.timeRemaining < this.baseLifeCost) {
                    this.TimerSprite.TextColor = "#FF0000";
                } else if (this.timeRemaining < this.lastStand) {
                    this.TimerSprite.TextColor = "#FFFF00";
                } else {
                    this.TimerSprite.TextColor = "#FFFFFF";
                }
                var totalseconds = this.timeRemaining / 1000.0;
                var totalminutes = totalseconds / 60;

                var minutes = Bridge.Int.clip32(Math.floor(totalminutes));
                var seconds = (totalseconds - (Bridge.Int.mul(minutes, 60)));

                var S = "";
                if (minutes > 0) {
                    S = "" + minutes + ":";
                }
                var prefix = "";
                if (seconds < 10) {
                    prefix = "0";
                    if (totalseconds < 10) {
                        prefix = " ";
                    }
                }
                S = System.String.concat(S, this.RestrictLength(System.String.concat(prefix, System.Single.format(Math.max(0, seconds))), 4));
                if (totalseconds >= 60) {
                    if (System.String.indexOf(S, ".") >= 0) {
                        S = ($t = S.split("."))[System.Array.index(0, $t)];
                    }
                }
                this.TimerSprite.Text = S;
            },
            RestrictLength: function (s, length) {
                if (s.length > length) {
                    return s.substr(0, length);
                }
                return s;
            },
            UpdateCollisions: function () {
                //List<Entity> combatants = new List<Entity>(System.Linq.Enumerable.Where<global::CirnoGame.Entity>(entities, (global::System.Func<global::CirnoGame.Entity, bool>)(entity => entity is ICombatant && entity.Ani.CurrentImage != null && ((ICombatant)entity).HP > 0)));
                //List<Entity> harmfulEntity = new List<Entity>(System.Linq.Enumerable.Where<global::CirnoGame.Entity>(entities, (global::System.Func<global::CirnoGame.Entity, bool>)(entity => entity is IHarmfulEntity && entity.Ani.CurrentImage != null)));
                var combatants = new (System.Collections.Generic.List$1(CirnoGame.Entity)).$ctor1(System.Linq.Enumerable.from(this.combatants).where(function (entity) {
                        return entity.Ani.CurrentImage != null && (entity).CirnoGame$ICombatant$HP > 0;
                    }));
                var harmfulEntity = new (System.Collections.Generic.List$1(CirnoGame.Entity)).$ctor1(System.Linq.Enumerable.from(this.harmful).where(function (entity) {
                        return entity.Ani.CurrentImage != null;
                    }));
                var R2 = new CirnoGame.Rectangle();
                var OR2 = new CirnoGame.Rectangle();
                var i = 0;
                var count = combatants.Count;
                var spd = new CirnoGame.Vector2();
                var spd2 = new CirnoGame.Vector2();
                while (i < count) {
                    var E = { v : combatants.getItem(i) };
                    //if (E is ICombatant)
                    {
                        var EI = { v : E.v };
                        var R = E.v.GetHitbox();
                        spd.CopyFrom(E.v.Speed);
                        spd.Multiply(0.5);
                        //Vector2 spd = E.Speed * 0.5f;
                        //spd.CopyFrom()
                        //Rectangle R2 = new Rectangle(R.x - (spd.X), R.y - (spd.Y), R.width, R.height);
                        R2.Set(R.x - (spd.X), R.y - (spd.Y), R.width, R.height);
                        //List<Entity> L = new List<Entity>(harmfulEntity.Where(entity => entity != E && entity.GetHitbox().isTouching(R)));
                        //List<Entity> L = new List<Entity>(harmfulEntity.Where(entity => entity != E && ((ICombatant)((IHarmfulEntity)entity).Attacker).Team != EI.Team));
                        //List<Entity> L = new List<Entity>(System.Linq.Enumerable.Where<global::CirnoGame.Entity>(harmfulEntity, (global::System.Func<global::CirnoGame.Entity, bool>)(entity => entity != E && !((IHarmfulEntity)entity).Attacker.SameTeam((Entity)EI))));
                        var L = new (System.Collections.Generic.List$1(CirnoGame.Entity)).$ctor1(System.Linq.Enumerable.from(harmfulEntity).where((function ($me, E, EI) {
                                return function (entity) {
                                    return !Bridge.referenceEquals(entity, E.v) && !(entity).CirnoGame$IHarmfulEntity$Attacker.SameTeam(EI.v);
                                };
                            })(this, E, EI)));
                        var j = 0;
                        var ln = L.Count;
                        while (j < ln) {
                            var tmp = L.getItem(j);
                            var HE = tmp;
                            var OR = tmp.GetHitbox();
                            //Vector2 spd2 = tmp.Speed * 0.5f;
                            spd2.CopyFrom(tmp.Speed);
                            spd2.Multiply(0.5);
                            //Rectangle OR2 = new Rectangle(OR.x - (spd2.X), OR.y - (spd2.Y), OR.width, OR.height);
                            OR2.Set(OR.x - (spd2.X), OR.y - (spd2.Y), OR.width, OR.height);
                            //if (EI.Team != ((ICombatant)HE.Attacker).Team)
                            if ((R.isTouching(OR) || R2.isTouching(OR2))) {
                                if (HE.CirnoGame$IHarmfulEntity$ontouchDamage(EI.v)) {
                                    var LHP = EI.v.CirnoGame$ICombatant$HP;
                                    EI.v.CirnoGame$ICombatant$onDamaged(HE, HE.CirnoGame$IHarmfulEntity$touchDamage);
                                    var damaged = LHP > EI.v.CirnoGame$ICombatant$HP;

                                    if (damaged) {
                                        if (Bridge.referenceEquals(EI.v, this.player)) {
                                            EI.v.PlaySound("damaged");
                                        } else {
                                            EI.v.PlaySound("hit");
                                        }
                                    }

                                    if (EI.v.CirnoGame$ICombatant$HP <= 0) {
                                        if (EI.v.HandledLocally) {
                                            var D = { };
                                            D.I = EI.v.ID;
                                            D.A = HE.CirnoGame$IHarmfulEntity$Attacker.ID;
                                            D.S = HE.ID;
                                            this.SendEvent("Kill", D);
                                        }
                                        /* if (damaged)
                                        {
                                           EI.As<Entity>().PlaySound("kill");
                                        }*/
                                    } else {
                                        /* if (damaged)
                                        {
                                           EI.As<Entity>().PlaySound("hit");
                                        }*/
                                    }
                                }
                                this.Attack(EI.v, HE);
                            }
                            j = (j + 1) | 0;
                        }
                        /* List<Entity> L = new List<Entity>(combatants.Where(entity => entity != E && entity is ICombatant && entity.GetHitbox().intersects(R)));
                        int j = 0;
                        while (j < L.Count)
                        {

                           j++;
                        }*/
                    }
                    i = (i + 1) | 0;
                }
            },
            Attack: function (target, source) {
                if (target.CirnoGame$ICombatant$HP > 0 && source.CirnoGame$IHarmfulEntity$ontouchDamage(target)) {
                    target.CirnoGame$ICombatant$onDamaged(source, source.CirnoGame$IHarmfulEntity$touchDamage);
                    //((Entity)target).PlaySound("hit");
                    if (target.CirnoGame$ICombatant$HP <= 0) {
                        if (Bridge.cast(target, CirnoGame.Entity).HandledLocally) {
                            var D = { };
                            D.I = Bridge.cast(target, CirnoGame.Entity).ID;
                            D.A = source.CirnoGame$IHarmfulEntity$Attacker.ID;
                            D.S = Bridge.cast(source, CirnoGame.Entity).ID;
                            this.SendEvent("Kill", D);
                        }
                    }
                }
            },
            PlaySoundEffect: function (source, sound) {
                if (this.muted) {
                    return;
                }
                var vol = 1.0;
                /* float min = 640;
                float maxLength = 320;*/
                //float min = 700;
                var min = 50;
                var maxLength = 200;
                if (CirnoGame.Vector2.op_Inequality(source, null)) {
                    //float dist = (camera.Center - source).RoughLength;
                    //float dist = (camera.Center - source).Length;
                    var dist = this.camera.Center.EstimatedDistance(source);
                    dist -= min;
                    if (dist > 0) {
                        if (dist >= maxLength) {
                            //volume of 0, just don't play it.
                            return;
                        } else {
                            vol = 1.0 - (dist / maxLength);
                        }
                    }
                }
                CirnoGame.AudioManager._this.Blast(System.String.concat("SFX/", sound, ".ogg"), vol);
            },
            AddEntity: function (E) {
                this.entities.add(E);
                if (Bridge.is(E, CirnoGame.ICombatant)) {
                    this.combatants.add(E);
                }
                if (Bridge.is(E, CirnoGame.IHarmfulEntity)) {
                    this.harmful.add(E);
                }
            },
            RemoveEntity: function (E) {
                E.onRemove();
                this.entities.remove(E);
                if (Bridge.is(E, CirnoGame.ICombatant)) {
                    this.combatants.remove(E);
                }
                if (Bridge.is(E, CirnoGame.IHarmfulEntity)) {
                    this.harmful.remove(E);
                }
            },
            Render: function () {
                CirnoGame.GameSprite.prototype.Render.call(this);

                var g = this.spriteGraphics;
                if (this.skiprender) {
                    g = this.EG;
                    this.skiprender = false;
                }
                this.UpdateCamera();
                this.DrawBackground(g);

                g.save();

                this.camera.Apply(g);
                //TM.position.Y = -200;
                this.TM.Draw(g);
                this.entities.forEach(function (E) {
                    if (E.Alive && E.Visible) {
                        E.Draw(g);
                    }
                });

                g.restore();

                if (this.playing) {
                    this.RenderGUI(g);
                } else {
                    g.globalAlpha = 0.3;
                    g.fillStyle = "#000000";
                    g.fillRect(0, 0, this.spriteBuffer.width, this.spriteBuffer.height);
                    g.globalAlpha = 1.0;
                    this.TS.Draw(g);
                    if (this.player.score > 0) {
                        this.ScoreSprite.Text = "Level:" + this.level + " Score:" + this.player.score;
                        this.ScoreSprite.ForceUpdate();
                        this.ScoreSprite.Position.X = (this.spriteBuffer.width * 0.98) - this.ScoreSprite.spriteBuffer.width;
                        this.ScoreSprite.Draw(g);
                    }
                }

            },
            Start: function () {
                if (this.entities.contains(this.player)) {
                    this.RemoveEntity(this.player);
                }
                this.player = new CirnoGame.PlayerCharacter(this);
                this.AddEntity(this.player);
                this.playing = true;
                this.level = 0;
                this.StartNextLevel();
                CirnoGame.App.Div.style.cursor = null;

                this.totalTime = 0;
                this.timeRemaining = this.defaultTimeRemaining;
                //timeRemaining *= 0.3334f * 0.25f;
                /* timeRemaining *= 0.3334f * 0.05f;
                player.HP = 5;*/
            },
            PlayMusic: function (song) {
                if (this.muted) {
                    return;
                }
                var M = CirnoGame.AudioManager._this.Get(System.String.concat("BGM/", song, ".ogg"));
                if (!M.IsPlaying) {
                    CirnoGame.AudioManager._this.StopAllFromDirectory("BGM/");
                    //M.Volume = 0.35;
                    M.Volume = 0.35;
                    M.Loop = true;
                    M.Play();
                }
            },
            RenderGUI: function (g) {
                var PC = this.player;
                var color = "#00DD00";
                if (this.timeRemaining < this.baseLifeCost) {
                    if (this.timeRemaining <= 0) {
                        color = "#CC0088";
                    } else {
                        color = "#FF0000";
                    }
                }

                g.globalAlpha = 0.8;
                this.DrawGauge(g, new CirnoGame.Vector2(0, 0), new CirnoGame.Vector2(((Bridge.Int.div(this.spriteBuffer.width, 4)) | 0), ((Bridge.Int.div(this.spriteBuffer.height, 20)) | 0)), 5, PC.HP / PC.maxHP, color);
                g.globalAlpha = 1;

                this.TimerSprite.Draw(g);
                this.ScoreSprite.Text = "Level:" + this.level + " Score:" + this.player.score;
                this.ScoreSprite.ForceUpdate();
                this.ScoreSprite.Position.X = (this.spriteBuffer.width * 0.98) - this.ScoreSprite.spriteBuffer.width;
                this.ScoreSprite.Draw(g);
                this.RenderIcons(g);
            },
            RenderIcons: function (g) {
                var R = (Bridge.Int.div(this.Key.height, this.Key.width)) | 0;
                var W = this.spriteBuffer.width * 0.02;
                var H = this.spriteBuffer.height * 0.055;

                var Y = H;
                var X = W / 2;
                var i = 0;

                //var sz = spriteBuffer.Width * 0.015f;
                var sz = this.spriteBuffer.width * 0.0115;
                g.globalAlpha = 0.8;
                if (this.Door.Opened) {
                    var DA = this.BigKey;
                    //var Dsz = spriteBuffer.Width * 0.018f;
                    var Dsz = sz * 1.5;
                    var DR = (Bridge.Int.div(DA.height, DA.width)) | 0;

                    g.drawImage(DA, X, Y, Dsz, Dsz * R);
                    X += W;
                }
                while (i < this.player.keys) {
                    g.drawImage(this.Key, X, Y, sz, sz * R);
                    X += W;
                    i = (i + 1) | 0;
                }
                g.globalAlpha = 1.0;
            },
            DrawGauge: function (g, position, size, border, progress, color, drawborder) {
                if (drawborder === void 0) { drawborder = true; }
                var alpha = g.globalAlpha;
                if (drawborder) {
                    g.globalAlpha = 0.6 * alpha;
                    g.fillStyle = "#000000";

                    g.fillRect(position.X, position.Y, size.X, size.Y);
                }

                g.fillStyle = color;
                g.globalAlpha = 1.0 * alpha;
                g.fillRect(((Bridge.Int.clip32(position.X) + border) | 0), ((Bridge.Int.clip32(position.Y) + border) | 0), (size.X - (((border + border) | 0))) * progress, ((Bridge.Int.clip32(size.Y) - (((border + border) | 0))) | 0));

                g.globalAlpha = 0.5 * alpha;
                //Script.Write("var grd = g.createLinearGradient(0, 0, 0, size.y);grd.addColorStop(0, color);grd.addColorStop(0.4, \"white\");grd.addColorStop(1, color);g.fillStyle = grd;");
                var grd = g.createLinearGradient(0, 0, 0, size.Y);
                grd.addColorStop(0, color);
                grd.addColorStop(0.4, "white");
                grd.addColorStop(1, color);
                g.fillStyle = grd;


                g.fillRect(((Bridge.Int.clip32(position.X) + border) | 0), ((Bridge.Int.clip32(position.Y) + border) | 0), (size.X - (((border + border) | 0))) * progress, ((Bridge.Int.clip32(size.Y) - (((border + border) | 0))) | 0));
                g.globalAlpha = alpha;
            },
            SendEvent: function (eventName, data, triggerflush) {
                if (triggerflush === void 0) { triggerflush = false; }
                var D = { };
                D.E = eventName;
                D.D = data;
                /* NetPlayUser NU = null;
                if (Online)
                {
                   NP.Send(D);
                   NU = NP.Me;
                }*/
                //ProcessEvent(D, NU, 0);
                this.ProcessEvent(D);
                /* if (triggerflush)
                {
                   NetPlayNeedsFlush = true;
                }*/
            },
            ProcessEvent: function (msg, user, latency) {
                if (user === void 0) { user = null; }
                if (latency === void 0) { latency = 0.0; }
                var D = msg.D;
                /* List<Player> LP = new List<Player>(players.Where(player => user != null && player.NetworkID == user.userID));
                Player P = null;

                bool hascharacter = true;
                if (LP.Count <= 0)
                {
                   if (P == null && user == null && !Online)
                   {
                       P = localplayer;
                   }
                   else
                   {
                       if (user.IsMe)
                       {
                           localplayer.NetworkID = user.userID;
                           P = localplayer;
                       }
                       else
                       {
                           hascharacter = false;
                       }
                   }
                }
                else
                {
                   P = LP[0];
                }*/
                var evt = msg.E;
                /* if (user != null && !user.IsMe)
                {
                   Dlatency += latency;
                   //latency *= 0.99f;
                   Dlatency *= (1 - (1 / latencyM));
                }
                //if (msg.E == "Init" && !P.local)
                if (evt == "Init" && P == null)
                {
                   if (!hascharacter)
                   {
                       P = new Player(false, false);
                       P.NetworkID = user.userID;
                       //PlayerCharacter PC = new PlayerCharacter(this, P, "Reisen");
                       PlayerCharacter PC = new PlayerCharacter(this, P, D.C);
                       //PC.Team = 1;
                       PC.Team = D.T;
                       PC.x = 700;
                       PC.y = 240;
                       PC.ID = D.I;
                       players.Add(P);
                       AddEntity(PC);
                       if (Hoster)
                       {
                           SendEvent("MapSeed", TM.Seed);

                           List<Entity> L = new List<Entity>(entities.Where(E => E is MadnessOrb || (E is PlayerCharacter && ((PlayerCharacter)E).player.CPU)));
                           int i = 0;
                           while (i < L.Count)
                           {
                               SendEntitySpawnCheck(L[i]);
                               i++;
                           }
                       }
                       Console.WriteLine("User:" + P.NetworkID + " has joined!");
                   }
                }
                if (evt == "Spawn")
                {
                   Entity E = EntityFromID(D.I);
                   if (E == null)
                   {
                       Type T = Helper.GetType(D.T);
                       E = Activator.CreateInstance(T, this).ToDynamic();
                       E.ID = D.I;
                       E.x = D.X;
                       E.y = D.Y;

                       if (D.D)
                       {
                           Helper.CopyFields(D.D, E);
                       }
                       AddEntity(E);
                       CatchupEntity(E, latency);
                       //Activator.CreateInstance()
                       //System.Reflection.
                       //Type T = Type.GetType("");
                   }
                }
                if (evt == "Unpause")
                {
                   paused = false;
                   Console.WriteLine("Game unpaused");
                   SendInit();
                }
                if (evt == "MapSeed" && !Hoster)
                {
                   if (TM.Seed != D)
                   {
                       TM.Seed = D;
                       TM.Generate();
                       //clean up local client entities.
                       if (!connected)
                       {
                           int i = 0;
                           while (i < entities.Count)
                           {
                               if (entities[i] is MadnessOrb || (entities[i] is PlayerCharacter && ((PlayerCharacter)entities[i]).player.CPU))
                               {
                                   RemoveEntity(entities[i]);
                                   i--;
                               }
                               i++;
                           }
                           connected = true;
                       }
                   }

                }
                if (evt == "CE")
                {
                   Entity entity = EntityFromID(D.I);
                   if (entity != null)
                   {
                       entity.CustomEvent(D.D);
                   }
                }
                if (evt == "CBE")
                {
                   Entity entity = EntityFromID(D.I);
                   if (entity != null)
                   {
                       EntityBehavior b = entity.GetBehaviorFromName(D.T);
                       b.CustomEvent(D.D);
                       //entity.CustomEvent(D.D);
                   }
                }*/
                if (Bridge.referenceEquals(evt, "Kill")) {
                    var entity = this.EntityFromID(D.I);
                    if (entity != null) {
                        var attacker = this.EntityFromID(D.A);
                        Bridge.cast(entity, CirnoGame.ICombatant).CirnoGame$ICombatant$onDeath(this.EntityFromID(D.S));
                        if (attacker != null && Bridge.is(attacker, CirnoGame.PlayerCharacter)) {
                            var PC = Bridge.cast(attacker, CirnoGame.PlayerCharacter);
                            //PC.player.Score += ((ICombatant)entity).PointsForKilling;
                            PC.score = (PC.score + Bridge.cast(entity, CirnoGame.ICombatant).CirnoGame$ICombatant$PointsForKilling) | 0;
                            PC.onKill(Bridge.cast(entity, CirnoGame.ICombatant));
                        }
                    }
                }
            },
            EntityFromID: function (ID) {
                var i = 0;
                while (i < this.entities.Count) {
                    var E = this.entities.getItem(i);
                    if (Bridge.referenceEquals(E.ID, ID)) {
                        return E;
                    }
                    i = (i + 1) | 0;
                }
                return null;
            },
            UpdateCamera: function () {
                var $t, $t1;
                //float D = test.Hspeed * 18;
                //float D = (float)Math.Abs(test.Hspeed) * 9;
                //var freecam = true;
                this.camera.speedmod = 1.0;

                /* if (KeyboardManager._this.TappedButtons.ContainsB(67) && App.DEBUG)
                {
                   freecam = !freecam;
                }*/
                if (this.freecam) {
                    var spd = 16 / this.camera.Scale;
                    var PB = CirnoGame.KeyboardManager._this.PressedButtons;
                    //numpad panning
                    if (CirnoGame.HelperExtensions.ContainsB$1(System.Int32, PB, Bridge.box(100, System.Int32))) {
                        this.camera.TargetPosition.X -= spd;
                    }
                    if (CirnoGame.HelperExtensions.ContainsB$1(System.Int32, PB, Bridge.box(102, System.Int32))) {
                        this.camera.TargetPosition.X += spd;
                    }

                    if (CirnoGame.HelperExtensions.ContainsB$1(System.Int32, PB, Bridge.box(104, System.Int32))) {
                        this.camera.TargetPosition.Y -= spd;
                    }
                    if (CirnoGame.HelperExtensions.ContainsB$1(System.Int32, PB, Bridge.box(98, System.Int32))) {
                        this.camera.TargetPosition.Y += spd;
                    }
                    if (CirnoGame.HelperExtensions.ContainsB$1(System.Int32, PB, Bridge.box(107, System.Int32))) {
                        var CC = this.camera.Center;
                        this.camera.Scale *= 1.01;
                        this.camera.Center = CC;
                        this.camera.TargetPosition.X = this.camera.Position.X;
                        this.camera.TargetPosition.Y = this.camera.Position.Y;
                    }
                    if (CirnoGame.HelperExtensions.ContainsB$1(System.Int32, PB, Bridge.box(109, System.Int32))) {
                        var CC1 = this.camera.Center;
                        this.camera.Scale *= 0.99;
                        this.camera.Center = CC1;
                        this.camera.TargetPosition.X = this.camera.Position.X;
                        this.camera.TargetPosition.Y = this.camera.Position.Y;
                    }
                    if (CirnoGame.HelperExtensions.ContainsB$1(System.Int32, PB, Bridge.box(36, System.Int32))) {
                        this.camera.CenteredTargetPosition = this.player.Position;
                    }
                    if (CirnoGame.HelperExtensions.ContainsB$1(System.Int32, PB, Bridge.box(13, System.Int32))) {
                        this.player.Position.X = this.camera.Center.X;
                        this.player.Position.Y = this.camera.Center.Y;
                    }
                    this.camera.Update();
                    return;
                }
                if (!this.playing) {
                    this.camera.speedmod = 0.05;
                    if (CirnoGame.Vector2.op_Equality(this.camera.TargetPosition, null) || this.camera.Position.EstimatedDistance(this.camera.TargetPosition) < 40) {
                        if (Math.random() < 0.0035 || this.camera.instawarp) {
                            this.camera.CenteredTargetPosition = CirnoGame.MapRoom.FindAnyEmptySpot();
                        }
                    }
                    /* camera.TargetPosition = null;
                    if (cameraWanderPoint == null)
                    {
                       cameraWanderPoint = MapRoom.FindAnyEmptySpot();
                    }*/
                    this.camera.Update();
                    return;
                }

                if (this.freecam) {
                    if (CirnoGame.KeyboardManager._this.PressedButtons.contains(101) || CirnoGame.KeyboardManager._this.PressedButtons.contains(111)) {
                        var TEST = CirnoGame.RoomOpeningLever.TEST;
                        if (CirnoGame.KeyboardManager._this.PressedButtons.contains(106) && !TEST.Activated) {
                            TEST.Activate();
                        }
                        if (TEST != null) {
                            if (!TEST.Activated && !CirnoGame.KeyboardManager._this.PressedButtons.contains(111)) {
                                this.camera.CenteredTargetPosition = TEST.Position;
                            } else {
                                var T = this.TM.GetTile(TEST.Room.SX, TEST.Room.SY);
                                var HB = T.GetHitbox();
                                this.camera.CenteredTargetPosition = new CirnoGame.Vector2(HB.left, HB.top);
                            }
                            if (CirnoGame.KeyboardManager._this.TappedButtons.contains(32)) {
                                this.player.Position.X = this.camera.Center.X;
                                this.player.Position.Y = this.camera.Center.Y;
                            }
                            this.camera.Update();
                            return;
                        } else {
                            this.player.MSG.ChangeText("No lever on map");
                        }
                    }
                }
                if (this.player.HP < 0) {
                    return;
                }
                var D = this.player.Hspeed * 32;
                var lookAheadRate = 0.3;
                var H = this.camera.CameraBounds.width / 8;
                D += !this.player.Ani.Flipped ? H : -H;
                var C = CirnoGame.App.Canvas;
                var IS = this.camera.InvScale;
                var V = Math.max(0, this.player.Vspeed * 30);
                if (($t = this.player.Controller)[System.Array.index(2, $t)]) {
                    //V -= camera.CameraBounds.height / 4;
                    V -= this.camera.CameraBounds.height / 3;
                } else if (($t1 = this.player.Controller)[System.Array.index(3, $t1)]) {
                    //V += camera.CameraBounds.height / 4;
                    V += this.camera.CameraBounds.height / 3;
                } else if (this.player.onGround) {
                    //V -= camera.CameraBounds.height / 8;
                    V -= this.camera.CameraBounds.height / 10;
                } else {
                    V += this.camera.CameraBounds.height / 12;
                }

                var TP = this.camera.TargetPosition;
                /* TP.X = (test.x + D) - ((C.Width / 2) * IS);
                TP.Y = (float)Math.Max(0, (test.y + V) - ((C.Height / 2) * IS));*/
                /* TP.X = test.x;
                TP.Y = test.y;*/
                var X = this.player.x + (this.player.Width / 2) + (D * lookAheadRate);
                var Y = this.player.y + (this.player.Height / 2) + (V * lookAheadRate);
                this.camera.CenteredTargetPosition = new CirnoGame.Vector2(X, Y);
                this.camera.Update();
            },
            DrawBackground: function (g) {
                g.fillStyle = "#77AAFF";
                g.fillRect(0, 0, CirnoGame.App.Canvas.width, CirnoGame.App.Canvas.height);
                /* if (BG < 0 || BG >= BGs.Count)
                {
                   g.FillStyle = "#77AAFF";
                   g.FillRect(0, 0, App.Canvas.Width, App.Canvas.Height);
                }
                else
                {
                   g.DrawImage(BGs[BG], (float)0, (float)0);
                }*/
            },
            UpdateControls: function () {

                var PC = this.player;
                var threshhold = 0.7;
                var C = PC.Controller;
                var IC = CirnoGame.App.IC;

                if (IC == null) {
                    return;
                }
                var x = IC.getState(0);
                var y = IC.getState(1);
                C[System.Array.index(0, C)] = x <= -threshhold;
                C[System.Array.index(1, C)] = x >= threshhold;
                C[System.Array.index(2, C)] = y <= -threshhold;
                C[System.Array.index(3, C)] = y >= threshhold;

                var cid = IC.getMapControllerID$1(5);
                if (Bridge.referenceEquals(cid, "Keyboard") || Bridge.referenceEquals(cid, "Mouse")) {
                    /* C[4] = KeyboardManager._this.PressedMouseButtons.Contains(0);
                    C[5] = KeyboardManager._this.PressedMouseButtons.Contains(2);*/
                    C[System.Array.index(4, C)] = IC.getPressed(2);
                    C[System.Array.index(5, C)] = IC.getPressed(3);
                    C[System.Array.index(6, C)] = IC.getPressed(4);
                } else {
                    /* GamePad P = GamePadManager._this.GetPad(IC.id);
                    PC.aimAngle = new Vector2((float)P.axes[2], (float)P.axes[3]).ToAngle();*/
                    var aim = new CirnoGame.Vector2(IC.getState(4), IC.getState(5));
                    if (aim.RoughLength > 0.5) {
                    }


                }
                C[System.Array.index(4, C)] = IC.getPressed(2);
                C[System.Array.index(5, C)] = IC.getPressed(3);
                C[System.Array.index(6, C)] = IC.getPressed(4);
                /* C[4] = IC.getPressed(3);
                C[5] = IC.getPressed(4);*/

                var o = { };
            }
        }
    });

    Bridge.define("CirnoGame.HealingItem", {
        inherits: [CirnoGame.CollectableItem],
        fields: {
            healingPower: 0
        },
        ctors: {
            init: function () {
                this.healingPower = 1.5;
            },
            ctor: function (game) {
                this.$initialize();
                CirnoGame.CollectableItem.ctor.call(this, game, "heart");
                this.floats = false;
                this.magnetDistance = 20;
                this.sound = "ok";
            }
        },
        methods: {
            CanCollect: function (player) {
                return player.HP < player.maxHP;
            },
            onCollected: function (player) {
                player.HP = Math.min(player.HP + this.healingPower, player.maxHP);
            }
        }
    });

    Bridge.define("CirnoGame.KeyItem", {
        inherits: [CirnoGame.CollectableItem],
        ctors: {
            ctor: function (game) {
                this.$initialize();
                CirnoGame.CollectableItem.ctor.call(this, game, "key");
                this.floats = false;
                this.magnetDistance = 20;
            }
        },
        methods: {
            CanCollect: function (player) {
                return player.keys < 5;
            },
            onCollected: function (player) {
                player.keys = (player.keys + 1) | 0;
            }
        }
    });

    Bridge.define("CirnoGame.PlatformerEntity", {
        inherits: [CirnoGame.ControllableEntity],
        fields: {
            friction: 0,
            onGround: false,
            GravityEnabled: false,
            gravity: 0,
            maxFallSpeed: 0,
            feetposition: 0,
            headposition: 0,
            Floor: null,
            Ceiling: null,
            LeftWall: null,
            RightWall: null
        },
        ctors: {
            init: function () {
                this.friction = 0.5;
                this.GravityEnabled = true;
                this.gravity = 0.02;
                this.maxFallSpeed = 2.0;
                this.feetposition = 23;
                this.headposition = 7;
            },
            ctor: function (game) {
                this.$initialize();
                CirnoGame.ControllableEntity.ctor.call(this, game);

            }
        },
        methods: {
            Update: function () {
                CirnoGame.ControllableEntity.prototype.Update.call(this);
                if (this.GravityEnabled) {
                    if (this.Vspeed < this.maxFallSpeed && this.GravityEnabled) {
                        this.Vspeed = Math.min(this.Vspeed + this.gravity, this.maxFallSpeed);
                    }
                }
                /* if (y > 0 && Vspeed>=0)
                {
                   y = 0;
                   Vspeed = 0;
                   onGround = true;
                }
                if (y < 0)
                {
                   onGround = false;
                }*/
                this.ApplyFriction();
                this.UpdateTerrainCollision();

                this.onGround = (this.Floor != null && this.Vspeed >= 0);

                if (this.onGround) {
                    var Y = this.Floor.GetTop(this.getCenter()) - this.feetposition;
                    /* if (y < Y)
                    {
                       onGround = false;
                       Floor = null;
                    }
                    else*/
                    {
                        //y = ((Floor.row * Game.TM.tilesize) + Game.TM.position.Y) - feetposition;
                        this.y = Y;
                        this.Vspeed = 0;
                        this.onGround = true;
                    }
                }
                if (this.Ceiling != null && this.Vspeed < 0) {
                    this.Vspeed = 0;
                    this.y = ((this.Ceiling.row * this.Game.TM.tilesize) + this.Game.TM.position.Y) + this.Game.TM.tilesize - this.headposition;
                }
                if (this.LeftWall != null) {
                    this.Hspeed = Math.max(0, this.Hspeed);
                }
                if (this.RightWall != null) {
                    this.Hspeed = Math.min(0, this.Hspeed);
                }
            },
            ApplyFriction: function () {
                this.Hspeed = CirnoGame.MathHelper.Decelerate(this.Hspeed, this.friction);
                if (!this.GravityEnabled) {
                    this.Vspeed = CirnoGame.MathHelper.Decelerate(this.Vspeed, this.friction);
                }
            },
            GetFloor: function () {
                var T = null;
                var W = this.Width / 3;
                var Y = this.Height;
                if (!(T != null && T.enabled && T.topSolid)) {
                    T = this.Game.TM.CheckForTile(CirnoGame.Vector2.Add$1(this.Position, this.Width / 2, Y));
                }
                if (!(T != null && T.enabled && T.topSolid)) {
                    T = this.Game.TM.CheckForTile(CirnoGame.Vector2.Add$1(this.Position, W, Y));
                }
                if (!(T != null && T.enabled && T.topSolid)) {
                    T = this.Game.TM.CheckForTile(CirnoGame.Vector2.Add$1(this.Position, this.Width - W, Y));
                }
                if (!(T != null && T.enabled && T.topSolid)) {
                    T = null;
                }
                return T;
            },
            GetCeiling: function () {
                var T = null;
                var W = this.Width / 3;
                //float Y = 16;
                var Y = 0 + this.headposition;
                if (!(T != null && T.enabled && T.bottomSolid)) {
                    T = this.Game.TM.CheckForTile(CirnoGame.Vector2.Add$1(this.Position, W, Y));
                }
                if (!(T != null && T.enabled && T.bottomSolid)) {
                    T = this.Game.TM.CheckForTile(CirnoGame.Vector2.Add$1(this.Position, this.Width - W, Y));
                }
                if (!(T != null && T.enabled && T.bottomSolid)) {
                    T = null;
                }
                return T;
            },
            CheckWall: function (X) {
                var T = null;
                /* if (!(T != null && T.enabled && ((T.leftSolid && X > 0) || (T.rightSolid && X < 0))))
                {
                   T = Game.TM.CheckForTile(Position + new Vector2(X, (Height / 2)-2));
                }
                if (!(T != null && T.enabled && ((T.leftSolid && X > 0) || (T.rightSolid && X < 0))))
                {
                   T = Game.TM.CheckForTile(Position + new Vector2(X, Height-2));
                   if (T != null && T.IsSlope)
                   {
                       T = null;
                   }
                }
                if (!(T != null && T.enabled && ((T.leftSolid && X > 0) || (T.rightSolid && X < 0))))
                {
                   T = null;
                }*/
                if (!this.IsTileObstacle(T, X)) {
                    T = this.Game.TM.CheckForTile(CirnoGame.Vector2.Add$1(this.Position, X, (this.Height / 2) - 2));
                }
                if (!this.IsTileObstacle(T, X)) {
                    T = this.Game.TM.CheckForTile(CirnoGame.Vector2.Add$1(this.Position, X, this.Height - 2));
                }
                if (!this.IsTileObstacle(T, X)) {
                    T = null;
                }
                return T;
            },
            IsTileObstacle: function (T, X) {
                if (T != null && T.enabled && ((T.leftSolid && X > 0) || (T.rightSolid && X < 0)) && (this.Floor == null || T.row < this.Floor.row)) {
                    var Y = this.y + this.Height;
                    //if (T.GetHitbox().y < Y-28)
                    //if (T.GetHitbox().y < Y - 8)
                    //if (T.GetHitbox().y < Y - 4)
                    if (T.GetHitbox().y < Y - 0) {
                        return !T.IsSlope;
                    }
                }
                return false;
            },
            UpdateTerrainCollision: function () {
                this.Floor = this.GetFloor();
                this.Ceiling = this.GetCeiling();
                if (this.Floor != null && this.Floor.SteppedOn) {
                    this.Floor.SteppedOn(this);
                }


                if (this.Vspeed < this.maxFallSpeed && this.GravityEnabled) {
                    this.Vspeed = Math.min(this.Vspeed + this.gravity, this.maxFallSpeed);
                }
                var stuck = false;
                if (this.Floor != null) {
                    var c = true;
                    while (c) {
                        var T = this.Floor.GetTileData(0, -1);
                        if (T != null && T.enabled && T.solid) {
                            this.Floor = T;
                            stuck = true;
                        } else {
                            c = false;
                        }
                    }
                }
                stuck = false;
                this.onGround = false;
                if (this.Floor != null && this.Vspeed >= 0) {
                    //float Y = Floor.GetHitbox().top - Height;
                    var Y = this.Floor.GetTop(this.getCenter()) - this.Height;
                    //if (!Floor.platform || y <= Y + Vspeed)
                    //if (!Floor.platform || y+Vspeed>=Y)
                    if ((!this.Floor.platform || this.y <= Y + this.Vspeed) && this.y + (this.Vspeed + 10) >= Y) {
                        if (this.Vspeed > 0) {
                            this.Vspeed = 0;
                            this.onGround = true;
                        }
                        this.y = Y;
                    }
                }
                if (this.Hspeed !== 0) {
                    var wall = this.Hspeed > 0 ? this.RightWall : this.LeftWall;
                    if (wall != null) {
                        this.Hspeed = 0;
                    }
                }
                var W = this.Width / 3;
                var X = Math.abs(this.Hspeed);
                if (this.Hspeed < 0) {
                    X -= 2 - W;
                } else {
                    X += (this.Width - W) + 2;
                }
                this.RightWall = this.CheckWall(X);

                X = -Math.abs(this.Hspeed);
                if (this.Hspeed < 0) {
                    X -= 2 - W;
                } else {
                    X += (this.Width - W) + 2;
                }
                this.LeftWall = this.CheckWall(X);
                if (this.LeftWall != null && Bridge.referenceEquals(this.LeftWall, this.RightWall)) {
                    var R = this.LeftWall.GetHitbox();
                    var V = R.Center;
                    if ((CirnoGame.Vector2.op_Subtraction(V, this.Position)).X > 0) {
                        this.x += 1;
                        if (this.Hspeed < 0) {
                            this.Hspeed = 0;
                        }
                    } else {
                        this.x -= 1;
                        if (this.Hspeed > 0) {
                            this.Hspeed = 0;
                        }
                    }
                }
                if (stuck) {
                    this.UpdateTerrainCollision();
                }
            }
        }
    });

    Bridge.define("CirnoGame.Orb", {
        inherits: [CirnoGame.CollectableItem],
        ctors: {
            ctor: function (game) {
                this.$initialize();
                CirnoGame.CollectableItem.ctor.call(this, game, "orb");
                //Ani = new Animation(AnimationLoader.Get("images/misc/orb"));
                this.magnetDistance = 55;
            }
        },
        methods: {
            onCollected: function (player) {
                //throw new NotImplementedException();
                var time = (1000) * (13 - Math.min(this.Game.level - 0.15, 7));
                if (this.Game.timeRemaining > 0) {
                    this.Game.timeRemaining += time;
                    this.Game.timeRemaining = Math.min(this.Game.defaultTimeRemaining, this.Game.timeRemaining);
                } else {
                    this.Game.timeRemaining += time;
                }
            }
        }
    });

    Bridge.define("CirnoGame.PointItem", {
        inherits: [CirnoGame.CollectableItem],
        ctors: {
            ctor: function (game) {
                this.$initialize();
                CirnoGame.CollectableItem.ctor.call(this, game, "point");
                this.floats = false;
                //magnetDistance = 100;
                this.magnetDistance = 70;
                this.magnetSpeed *= 8;
            }
        },
        methods: {
            onCollected: function (player) {
                player.score = (player.score + 5) | 0;
            }
        }
    });

    Bridge.define("CirnoGame.MRGhosty", {
        inherits: [CirnoGame.PlatformerEntity,CirnoGame.ICombatant,CirnoGame.IHarmfulEntity],
        fields: {
            animation: null,
            attackpower: 0,
            defensepower: 0
        },
        props: {
            Team: 0,
            HP: 0,
            PointsForKilling: {
                get: function () {
                    return 1;
                }
            },
            TargetPriority: {
                get: function () {
                    return 0.5;
                }
            },
            IsHarmful: {
                get: function () {
                    return true;
                }
            },
            Attacker: {
                get: function () {
                    return this;
                }
            },
            touchDamage: {
                get: function () {
                    return this.attackpower * 1.5;
                }
            }
        },
        alias: [
            "Team", "CirnoGame$ICombatant$Team",
            "HP", "CirnoGame$ICombatant$HP",
            "PointsForKilling", "CirnoGame$ICombatant$PointsForKilling",
            "TargetPriority", "CirnoGame$ICombatant$TargetPriority",
            "IsHarmful", "CirnoGame$IHarmfulEntity$IsHarmful",
            "Attacker", "CirnoGame$IHarmfulEntity$Attacker",
            "touchDamage", "CirnoGame$IHarmfulEntity$touchDamage",
            "onDamaged", "CirnoGame$ICombatant$onDamaged",
            "onDeath", "CirnoGame$ICombatant$onDeath",
            "onKill", "CirnoGame$ICombatant$onKill",
            "ontouchDamage", "CirnoGame$IHarmfulEntity$ontouchDamage"
        ],
        ctors: {
            init: function () {
                this.animation = "???";
                this.attackpower = 1;
                this.defensepower = 1;
            },
            ctor: function (game) {
                this.$initialize();
                CirnoGame.PlatformerEntity.ctor.call(this, game);
                this.ChangeAni("");
                this.AddBehavior$1(new CirnoGame.FlightControls(this));
                this.AddBehavior$1(new CirnoGame.RandomAI(this));
                this.attackpower = 1 + (this.Game.level * 0.5);
                this.defensepower = 1 + (this.Game.level * 0.5);
                if (this.Game.playing) {
                    this.AddBehavior(CirnoGame.AimedShooter);
                    this.GetBehavior(CirnoGame.AimedShooter).attackpower = this.attackpower;
                    this.GetBehavior(CirnoGame.AimedShooter).maxtime = Math.max(((480 - (Bridge.Int.mul(this.Game.level, 10))) | 0), 380);
                }
                this.GetBehavior(CirnoGame.FlightControls).maxSpeed *= 0.5;

                this.GravityEnabled = false;
                this.Team = 2;
                this.HP = 2;
            }
        },
        methods: {
            Update: function () {
                CirnoGame.PlatformerEntity.prototype.Update.call(this);
                this.Ani.Flipped = (this.Hspeed < 0);
                this.Ani.ImageSpeed = (Math.abs(this.Hspeed) + Math.abs(this.Vspeed)) * 0.125;
            },
            ChangeAni: function (animation, reset) {
                if (reset === void 0) { reset = false; }
                if (Bridge.referenceEquals(this.animation, animation)) {
                    return;
                }
                if (this.Ani == null) {
                    this.Ani = new CirnoGame.Animation(CirnoGame.AnimationLoader.Get(System.String.concat("images/enemies/mrghost", animation)));
                } else {
                    this.Ani.ChangeAnimation(CirnoGame.AnimationLoader.Get(System.String.concat("images/enemies/mrghost", animation)), reset);
                }
                this.animation = animation;
            },
            onDamaged: function (source, amount) {
                //throw new NotImplementedException();
                //if (!(source is MRGhosty))
                {
                    this.HP -= (amount / this.defensepower);
                }
                /* else
                {
                   Helper.Log("ghosts are allergic to themselves???");
                }*/
            },
            onDeath: function (source) {
                //throw new NotImplementedException();
                this.Alive = false;
                var P = new CirnoGame.PointItem(this.Game);
                P.Position.CopyFrom(this.Position);
                P.collectionDelay = (Bridge.Int.div(P.collectionDelay, 2)) | 0;
                this.Game.AddEntity(P);
                if (Math.random() < 0.15) {
                    P = new CirnoGame.HealingItem(this.Game);
                    P.Position.CopyFrom(this.Position);
                    P.Vspeed = -2;
                    P.collectionDelay = (Bridge.Int.div(P.collectionDelay, 2)) | 0;
                    this.Game.AddEntity(P);
                }
            },
            onKill: function (combatant) {
                //throw new NotImplementedException();
            },
            ontouchDamage: function (target) {
                //throw new NotImplementedException();
                return true;
            }
        }
    });

    Bridge.define("CirnoGame.PlayerCharacter", {
        inherits: [CirnoGame.PlatformerEntity,CirnoGame.ICombatant],
        fields: {
            animation: null,
            shoottime: 0,
            prefix: null,
            newInput: false,
            tapTimer: null,
            shootRecharge: 0,
            turntime: 0,
            score: 0,
            orbs: 0,
            keys: 0,
            energyRecharge: 0,
            maxEnergy: 0,
            energy: 0,
            maxHP: 0,
            regenRate: 0,
            SpawnLocation: null,
            lives: 0,
            frame: 0,
            digpower: 0,
            attackpower: 0,
            defensepower: 0,
            invincibilitytime: 0,
            blockprice: 0,
            invincibilitymod: 0,
            currentshot: 0,
            shotdelay: 0,
            currentshotdelay: 0,
            totalshots: 0,
            MSG: null
        },
        props: {
            Team: 0,
            HP: 0,
            PointsForKilling: {
                get: function () {
                    return 300;
                }
            },
            TargetPriority: {
                get: function () {
                    return 0.7;
                }
            }
        },
        alias: [
            "Team", "CirnoGame$ICombatant$Team",
            "HP", "CirnoGame$ICombatant$HP",
            "PointsForKilling", "CirnoGame$ICombatant$PointsForKilling",
            "TargetPriority", "CirnoGame$ICombatant$TargetPriority",
            "onDamaged", "CirnoGame$ICombatant$onDamaged",
            "onDeath", "CirnoGame$ICombatant$onDeath",
            "onKill", "CirnoGame$ICombatant$onKill"
        ],
        ctors: {
            init: function () {
                this.animation = "???";
                this.shoottime = 0;
                this.prefix = "";
                this.shootRecharge = 0;
                this.turntime = 0;
                this.score = 0;
                this.orbs = 0;
                this.keys = 0;
                this.energyRecharge = 0.022;
                this.maxEnergy = 4;
                this.energy = 4;
                this.maxHP = 20;
                this.regenRate = 1.0;
                this.SpawnLocation = new CirnoGame.Vector2();
                this.lives = 3;
                this.frame = 0;
                this.digpower = 1.0;
                this.attackpower = 1.0;
                this.defensepower = 1.0;
                this.invincibilitytime = 0;
                this.blockprice = 4.0;
                this.invincibilitymod = 1.0;
                this.currentshot = 0;
                this.shotdelay = 5;
                this.currentshotdelay = 0;
                this.totalshots = 1;
            },
            ctor: function (game) {
                this.$initialize();
                CirnoGame.PlatformerEntity.ctor.call(this, game);
                this.ChangeAni("stand");
                this.AddBehavior(CirnoGame.PlatformerControls);
                //AddBehavior(new PlatformerControls(this));
                this.tapTimer = System.Array.init(this.Controller.length, 0, System.Int32);
                this.Team = 0;
                this.HP = this.maxHP;
                this.MSG = new CirnoGame.FloatingMessage(game, "");
                this.MSG.Text.TextColor = "#FFFFFF";
                //MSG.ChangeText("hello world");
                this.MSG.autokill = false;
                game.AddEntity(this.MSG);
                this.MSG.RemovedOnLevelEnd = false;
                this.RemovedOnLevelEnd = false;
            }
        },
        methods: {
            MoveToNewSpawn: function (NewSpawnLocation) {
                this.SpawnLocation.CopyFrom(NewSpawnLocation);
                this.Position.CopyFrom(this.SpawnLocation);
            },
            shoot: function () {
                if (this.energy < 1) {
                    return;
                }
                if (this.shoottime < 1) {
                    this.prefix = "s";
                    this.ChangeAni(System.String.concat(this.prefix, this.animation));
                }
                if (this.shootRecharge <= 0) {
                    this.currentshot = 1;
                    this.DoShot();
                    this.energy -= 1;
                    //shootRecharge = 12;

                    this.currentshotdelay = 0;
                    //shootRecharge = 20;
                    this.shootRecharge = 16;

                }
                this.shoottime = 50;
                //shoottime = 40;
                this.turntime = 0;

            },
            DoShot: function () {
                var PB = new CirnoGame.PlayerBullet(this.Game, this, "Images/misc/crystal");
                PB.Hspeed = this.Ani.Flipped ? -2.5 : 2.5;
                PB.x = this.x + (this.Ani.Flipped ? -4 : 12);
                PB.y = this.y + 10;
                if (!this.Controller[System.Array.index(0, this.Controller)] && !this.Controller[System.Array.index(1, this.Controller)]) {
                    if (this.Controller[System.Array.index(2, this.Controller)]) {
                        PB.Hspeed *= 0.8;
                        PB.Vspeed = -Math.abs(PB.Hspeed);
                        PB.Hspeed *= 0.6;
                    } else if (this.Controller[System.Array.index(3, this.Controller)]) {
                        PB.Hspeed *= 0.8;
                        PB.Vspeed = Math.abs(PB.Hspeed);
                        PB.Hspeed *= 0.6;
                    }
                } else {
                    if (this.Controller[System.Array.index(2, this.Controller)]) {
                        PB.Hspeed *= 0.9;
                        PB.Vspeed = -Math.abs(PB.Hspeed * 0.7);

                    } else if (this.Controller[System.Array.index(3, this.Controller)]) {
                        PB.Hspeed *= 0.9;
                        PB.Vspeed = Math.abs(PB.Hspeed * 0.7);
                    }
                }
                PB.x -= PB.Hspeed;
                PB.y -= PB.Vspeed;
                PB.attacksterrain = this.currentshot === 1;
                PB.digpower = (this.digpower) * 0.6667;
                PB.touchDamage = this.attackpower / (((this.totalshots - 1.0) / 2.0) + 1.0);
                this.Game.AddEntity(PB);
            },
            Update: function () {
                CirnoGame.PlatformerEntity.prototype.Update.call(this);
                this.MSG.Position.X = this.Position.X;
                this.MSG.Position.Y = this.Position.Y - 10;

                if (this.shoottime > 0) {
                    this.shoottime = (this.shoottime - 1) | 0;
                    if (this.shoottime < 1) {
                        if (Bridge.referenceEquals("" + String.fromCharCode(this.animation.charCodeAt(0)), this.prefix)) {
                            this.ChangeAni(this.animation.substr(1));
                        }
                        this.prefix = "";
                    }
                }

                if (this.onGround) {
                    if (this.Hspeed !== 0) {
                        this.ChangeAni(System.String.concat(this.prefix, "walk"));
                    } else {
                        this.ChangeAni(System.String.concat(this.prefix, "stand"));
                    }
                    this.Ani.ImageSpeed = Math.abs(this.Hspeed * 0.125);
                    //Ani.ImageSpeed = Ani.Flipped ? Hspeed * 0.125f : -Hspeed * 0.125f;
                    //Ani.ImageSpeed = (Ani.Flipped ? -Hspeed : Hspeed) * 0.125f;
                } else {
                    this.ChangeAni(System.String.concat(this.prefix, "jump"));
                    //Ani.ImageSpeed = (float)Math.Abs(Vspeed * 0.125);
                    this.Ani.ImageSpeed = 0.15 + ((Math.abs(this.Hspeed) + Math.abs(this.Vspeed)) * 0.7);
                }
                if (this.Ani.Flipped !== this.Hspeed < 0 || (this.Hspeed === 0 && this.onGround)) {
                    this.turntime = (this.turntime + 1) | 0;
                } else {
                    this.turntime = 0;
                }

                //if (LController[3] != Controller[3] && Controller[3])
                /* if (Pressed(3) || Pressed(4) || Pressed(5) || Pressed(6))
                {
                   shoot();
                }*/
                if (this.currentshot < this.totalshots) {
                    this.currentshotdelay = (this.currentshotdelay + 1) | 0;
                    if (this.currentshotdelay >= this.shotdelay) {
                        this.currentshotdelay = 0;
                        this.currentshot = (this.currentshot + 1) | 0;
                        this.DoShot();
                    }
                } else {
                    if (this.shootRecharge > 0) {
                        this.shootRecharge = (this.shootRecharge - 1) | 0;
                    }
                    this.energy = Math.min(this.energy + this.energyRecharge, this.maxEnergy);
                }
                if (this.Controller[System.Array.index(4, this.Controller)]) {
                    this.turntime = 0;
                }
                //if (Pressed(4))
                if (this.Controller[System.Array.index(4, this.Controller)]) {
                    this.shoot();
                }
                if (this.Pressed(6)) {
                    this.PlaceBlock();
                }

                this.UpdateController();
                //if (turntime > 22 && Hspeed != 0)
                //if (turntime > 18 && Hspeed != 0)
                //if (turntime > 14 && Hspeed != 0)
                if (this.turntime > 8 && this.Hspeed !== 0) {
                    this.Ani.Flipped = this.Hspeed < 0;
                }
                if (this.invincibilitytime > 0) {
                    //Ani.Alpha = Ani.Alpha == 0 ? 1 : 0;
                    if ((this.frame & 1) > 0) {
                        this.Visible = !this.Visible;
                    }
                    this.invincibilitytime -= 1;
                } else {
                    this.Visible = true;
                }
                //if (Game.timeRemaining > 0 && HP>0 && invincibilitytime<=0 && HP<maxHP && Game.timeRemaining < Game.defaultTimeRemaining)
                /* if (Game.timeRemaining > 0 && HP > 0 && invincibilitytime <= 0 && HP < maxHP && Game.timeRemaining < Game.lastStand)
                {
                   var staticMod = 0.005f;
                   var HPRate = 1-(HP / maxHP);
                   var TimeRate = 1-(Game.timeRemaining / Game.defaultTimeRemaining);
                   var rate = (HPRate * TimeRate * regenRate);
                   HP += (rate * staticMod);
                   if (HP > maxHP)
                   {
                       HP = maxHP;
                   }
                }*/


                this.frame = (this.frame + 1) | 0;
            },
            PlaceBlock: function () {
                var price = 1000 * this.blockprice;
                if (this.Game.timeRemaining < this.blockprice) {
                    return;
                }
                var W = this.Width / 3;
                var Y = this.Height;
                var T = this.Game.TM.CheckForTile(CirnoGame.Vector2.Add$1(this.Position, this.Width / 2, Y));
                if (T != null && (!T.enabled || !T.solid)) {
                    T.solid = true;
                    T.Breakable = true;
                    T.enabled = true;
                    T.texture = 4;
                    T.UpdateTile();
                    T.HP = T.maxHP * 2;
                    this.Game.timeRemaining -= price;
                }
            },
            ChangeAni: function (animation, reset) {
                if (reset === void 0) { reset = false; }
                if (Bridge.referenceEquals(this.animation, animation)) {
                    return;
                }
                if (this.Ani == null) {
                    this.Ani = new CirnoGame.Animation(CirnoGame.AnimationLoader.Get(System.String.concat("images/cirno/", animation)));
                } else {
                    this.Ani.ChangeAnimation(CirnoGame.AnimationLoader.Get(System.String.concat("images/cirno/", animation)), reset);
                }
                if (!Bridge.referenceEquals(this.animation, "stand")) {
                    this.turntime = 0;
                }
                this.animation = animation;
            },
            UpdateController: function () {
                this.newInput = false;
                var i = 0;
                while (i < this.Controller.length) {
                    this.tapTimer[System.Array.index(i, this.tapTimer)] = (this.tapTimer[System.Array.index(i, this.tapTimer)] + 1) | 0;
                    if (this.Controller[System.Array.index(i, this.Controller)] && !this.LController[System.Array.index(i, this.LController)]) {
                        this.tapTimer[System.Array.index(i, this.tapTimer)] = 0;
                        this.newInput = true;
                    }
                    this.LController[System.Array.index(i, this.LController)] = this.Controller[System.Array.index(i, this.Controller)];
                    i = (i + 1) | 0;
                }
                /* if (_lAimAngle != _aimAngle)
                {
                   newInput = true;
                }
                _lAimAngle = _aimAngle;*/
                if (this.newInput) {
                    //GetBehavior<NetworkSync>().Sync();
                }
            },
            onDamaged: function (source, amount) {
                //throw new NotImplementedException();
                if (this.invincibilitytime <= 0) {
                    this.HP -= (amount / this.defensepower);
                    this.invincibilitytime = 50 * this.invincibilitymod;
                }
            },
            onRemove: function () {
                CirnoGame.PlatformerEntity.prototype.onRemove.call(this);
                this.Game.RemoveEntity(this.MSG);
            },
            onDeath: function (source) {
                //throw new NotImplementedException();
                this.invincibilitytime *= 3.0;

                if (Bridge.referenceEquals(this.Game.player, this)) {
                    //if (Game.timeRemaining > 0)
                    if (this.Game.timeRemaining >= this.Game.baseLifeCost) {
                        this.Position.CopyFrom(this.SpawnLocation);
                        this.HP = this.maxHP;
                        this.Game.timeRemaining -= this.Game.baseLifeCost;
                        //Game.timeRemaining *= 0.85f;
                        //Game.timeRemaining *= 0.6667f;
                        this.Game.camera.instawarp = true;
                        this.Game.skiprender = true;
                    } else {
                        this.Game.DoGameOver();
                    }
                } else {
                    this.Position.CopyFrom(this.SpawnLocation);
                    this.HP = this.maxHP;
                }
            },
            onKill: function (combatant) {
                //throw new NotImplementedException();
            },
            GetHitbox: function () {
                //return base.GetHitbox();
                if (this.Ani != null && this.Ani.CurrentImage != null) {
                    /* var size = 4;
                    var W = Ani.CurrentImage.Width / size;
                    var H = Ani.CurrentImage.Height / size;
                    var W4 = (Ani.CurrentImage.Width / 2) - (W / 2);
                    var H4 = (Ani.CurrentImage.Height / 2) - (H / 2);
                    return new Rectangle(Ani.X+W4, Ani.Y+H4, W, H);*/
                    return new CirnoGame.Rectangle(this.Ani.X + (this.Ani.CurrentImage.width / 2.0), this.Ani.Y + (this.Ani.CurrentImage.height / 2.0), 1, 1);
                }
                return null;
            }
        }
    });
});

//# sourceMappingURL=data:application/json;base64,ewogICJ2ZXJzaW9uIjogMywKICAiZmlsZSI6ICJDaXJub0dhbWUuanMiLAogICJzb3VyY2VSb290IjogIiIsCiAgInNvdXJjZXMiOiBbIkdhbWVNb2RlLmNzIiwiRW50aXR5QmVoYXZpb3IuY3MiLCJBbmltYXRpb24uY3MiLCJBbmltYXRpb25Mb2FkZXIuY3MiLCJBcHAuY3MiLCJBdWRpby5jcyIsIkF1ZGlvTWFuYWdlci5jcyIsIkJ1dHRvbk1lbnUuY3MiLCJTcHJpdGUuY3MiLCJCdXR0b25TcHJpdGUuY3MiLCJDYW1lcmEuY3MiLCJFbnRpdHkuY3MiLCJHYW1lcGFkLmNzIiwiR2FtZVBhZEJ1dHRvbi5jcyIsIkdhbWVQYWRNYW5hZ2VyLmNzIiwiR2FtZVBsYXlTZXR0aW5ncy5jcyIsIkhlbHBlci5jcyIsIkhlbHBlckV4dGVuc2lvbnMuY3MiLCJJbnB1dENvbnRyb2xsZXJzLmNzIiwiSW5wdXRDb250cm9sbGVyTWFuYWdlci5jcyIsIklucHV0TWFwLmNzIiwiSlNPTkFyY2hpdmUuY3MiLCJLZXlib2FyZE1hbmFnZXIuY3MiLCJNYXBHZW5lcmF0b3IuY3MiLCJNYXBSb29tLmNzIiwiTWF0aEhlbHBlci5jcyIsIlBvaW50LmNzIiwiUmVjdGFuZ2xlLmNzIiwiUmVjdGFuZ2xlSS5jcyIsIlJlbmRlcmVyLmNzIiwiVGlsZURhdGEuY3MiLCJUaWxlTWFwLmNzIiwiVmVjdG9yMi5jcyIsIkJlaGF2aW9ycy9BaW1lZFNob290ZXIuY3MiLCJDaGVzdC5jcyIsIkNvbGxlY3RhYmxlSXRlbS5jcyIsIkNvbnRyb2xsYWJsZUVudGl0eS5jcyIsIkV4aXREb29yLmNzIiwiQmVoYXZpb3JzL0ZsaWdodENvbnRyb2xzLmNzIiwiRmxvYXRpbmdNZXNzYWdlLmNzIiwiUGFydGljbGUuY3MiLCJCZWhhdmlvcnMvUGxhdGZvcm1lckNvbnRyb2xzLmNzIiwiUGxheWVyQnVsbGV0LmNzIiwiQmVoYXZpb3JzL1JhbmRvbUFJLmNzIiwiUm9vbU9wZW5pbmdMZXZlci5jcyIsIlRleHRTcHJpdGUuY3MiLCJUaWxlLmNzIiwiVGl0bGVTY3JlZW4uY3MiLCJFbmVtaWVzL1R1cnJldC5jcyIsIkRvb3JLZXkuY3MiLCJHYW1lLmNzIiwiSGVhbGluZ0l0ZW0uY3MiLCJLZXlJdGVtLmNzIiwiUGxhdGZvcm1lckVudGl0eS5jcyIsIk9yYi5jcyIsIlBvaW50SXRlbS5jcyIsIkVuZW1pZXMvTVJHaG9zdHkuY3MiLCJQbGF5ZXJDaGFyYWN0ZXIuY3MiXSwKICAibmFtZXMiOiBbIiJdLAogICJtYXBwaW5ncyI6ICI7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs4Q0F5Q3dEQTtvQkFFNUNBLE9BQU9BLEtBQUlBLDhEQUFlQSw0QkFBeURBLG9DQUFVQSxBQUF3REE7bUNBQUtBLGVBQWNBOzs7NkNBR25JQTtvQkFFckNBLFVBQVVBLEtBQUlBLDhEQUFlQSw0QkFBeURBLG9DQUFVQSxBQUF3REE7bUNBQUtBLCtCQUFVQTs7b0JBQ3ZLQSxJQUFJQTt3QkFDQUEsT0FBT0E7O29CQUNYQSxPQUFPQTs7O29CQTBCUEEsSUFBSUEsaUNBQWNBO3dCQUVkQSwrQkFBWUEsS0FBSUE7d0JBQ2hCQSxnQ0FBYUEsSUFBSUE7d0JBQ2pCQTt3QkFDQUEsZ0NBQWFBLElBQUlBO3dCQUNqQkE7d0JBQ0FBOzs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs0QkE5QldBOztnQkFFZkE7Z0JBQ0FBO2dCQUNBQTtnQkFDQUE7Z0JBQ0FBO2dCQUNBQTtnQkFDQUE7Z0JBQ0FBLFlBQU9BO2dCQUNQQSxnQkFBV0E7Z0JBQ1hBLG1CQUFjQSxpREFBNkJBO2dCQUMzQ0E7Z0JBQ0FBLGlDQUFjQTs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs0QkNuRElBOztnQkFFbEJBLGNBQWNBO2dCQUNkQSxJQUFJQSxpREFBc0JBLHFCQUFnQkE7b0JBRXRDQSxXQUFlQTtvQkFDZkEsU0FBU0E7O29CQUVUQSxRQUFhQTtvQkFDYkEsb0JBQWVBLHFCQUFFQSxzQkFBRkE7Ozs7Ozs7Ozs7OzRCQVVFQTt1Q0FHR0EsS0FBYUE7O2dCQUVyQ0EsUUFBWUE7Z0JBQ1pBLE1BQU1BO2dCQUNOQSxNQUFNQTs7Z0JBRU5BLE1BQU1BO2dCQUNO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QkFBb0JBLDhCQUFvQkEsc0NBQWtCQSxhQUFZQTs7Z0JBRTFFQSxJQUFJQTtvQkFFQUE7O2dCQUVKQSxpQkFBaUJBOzs7Z0JBSWpCQTtnQkFDQUE7Z0JBQ0FBLE9BQU9BLElBQUlBO29CQUVQQSxpQ0FBU0EsR0FBVEEsb0RBQVNBLEdBQVRBO29CQUNBQSxJQUFJQSxtQ0FBV0EsR0FBWEEscUJBQWlCQSxDQUFDQSxvQ0FBWUEsR0FBWkE7d0JBRWxCQSxpQ0FBU0EsR0FBVEE7d0JBQ0FBOztvQkFFSkEsb0NBQVlBLEdBQVpBLHFCQUFpQkEsbUNBQVdBLEdBQVhBO29CQUNqQkE7Ozs7Ozs7Z0JBT0pBLElBQUlBOzs7O2lDQU1jQSxRQUF1QkE7O2dCQUd6Q0EsSUFBSUE7b0JBRUFBLFdBQU1BLENBQUNBLFNBQVNBO29CQUNoQkEseUJBQW9CQSxLQUFHQTs7OztnQkFLM0JBO2dCQUNBQSx1QkFBa0JBOzsrQkFHRkE7O2dCQUdoQkE7O2dCQUVBQSxJQUFJQSx5Q0FBZUE7O29CQUdmQSxJQUFJQSwyQkFBb0JBO3dCQUVwQkEsdUJBQWtCQTt3QkFDbEJBLFVBQUtBO3dCQUNMQSwyQkFBc0JBOzs7d0JBR3RCQTt3QkFDQUE7O3dCQUlBQTs7O29CQUtKQSx1QkFBa0JBO29CQUNsQkEsVUFBS0E7Ozs4QkFJTUE7Ozs7O2dCQU9mQSxJQUFJQSxZQUFPQSxRQUFRQSx5QkFBb0JBOzs7Ozs7O29CQVFuQ0EsT0FBT0EsSUFBSUEsb0JBQVVBLGFBQVFBLENBQUNBLG9DQUE4QkEsYUFBUUEsQ0FBQ0E7O2dCQUV6RUEsT0FBT0EiLAogICJzb3VyY2VzQ29udGVudCI6IFsidXNpbmcgU3lzdGVtO1xyXG51c2luZyBTeXN0ZW0uQ29sbGVjdGlvbnMuR2VuZXJpYztcclxudXNpbmcgU3lzdGVtLkxpbnE7XHJcbnVzaW5nIFN5c3RlbS5UZXh0O1xyXG51c2luZyBTeXN0ZW0uVGhyZWFkaW5nLlRhc2tzO1xyXG51c2luZyBCcmlkZ2U7XHJcbnVzaW5nIEJyaWRnZS5IdG1sNTtcclxuXHJcbm5hbWVzcGFjZSBDaXJub0dhbWVcclxue1xyXG4gICAgW1ByaW9yaXR5KDEpXVxyXG4gICAgcHVibGljIGNsYXNzIEdhbWVNb2RlXHJcbiAgICB7XHJcbiAgICAgICAgcHVibGljIGVudW0gTW9kZVR5cGVzXHJcbiAgICAgICAge1xyXG4gICAgICAgICAgICAvLy8gPHN1bW1hcnk+XHJcbiAgICAgICAgICAgIC8vLyBTaW5nbGUgJiBNdWx0aXBsYXllciwganVzdCBhIGdlbmVyYWwgZ2FtZS5cclxuICAgICAgICAgICAgLy8vIDwvc3VtbWFyeT5cclxuICAgICAgICAgICAgU2tpcm1pc2gsXHJcbiAgICAgICAgICAgIC8vLyA8c3VtbWFyeT5cclxuICAgICAgICAgICAgLy8vIFNpbmdsZXBsYXllciwgZ2FtZXBsYXkgaXMgY2hhbmdlZCB1cCB3aXRoIGEgbW9kZSBzcGVjaWZpYyB0YXNrLlxyXG4gICAgICAgICAgICAvLy8gPC9zdW1tYXJ5PlxyXG4gICAgICAgICAgICBDaGFsbGVuZ2UsXHJcbiAgICAgICAgICAgIC8vLyA8c3VtbWFyeT5cclxuICAgICAgICAgICAgLy8vIExpa2UgY2hhbGxlbmdlLCBidXQgaXMgZGVzaWduZWQgZm9yIG11bHRpcGxlIGh1bWFuIHBsYXllcnMuXHJcbiAgICAgICAgICAgIC8vLyA8L3N1bW1hcnk+XHJcbiAgICAgICAgICAgIENhbGxlbmdlQ29vcFxyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgcHVibGljIGJvb2wgVGVhbXMgeyBnZXQ7IHByb3RlY3RlZCBzZXQ7IH1cclxuICAgICAgICBwdWJsaWMgaW50IFN0YXJ0aW5nTGl2ZXMgeyBnZXQ7IHByb3RlY3RlZCBzZXQ7IH1cclxuICAgICAgICBwdWJsaWMgYm9vbCBTdXJ2aXZhbCB7IGdldDsgcHJvdGVjdGVkIHNldDsgfVxyXG4gICAgICAgIHB1YmxpYyBib29sIEFsbG93T25saW5lUGxheSB7IGdldDsgcHJvdGVjdGVkIHNldDsgfVxyXG4gICAgICAgIHB1YmxpYyBib29sIEFsbG93Q2hhcmFjdGVyU2VsZWN0IHsgZ2V0OyBwcm90ZWN0ZWQgc2V0OyB9XHJcbiAgICAgICAgcHVibGljIGludCBOdW1iZXJPZlBsYXllcnMgeyBnZXQ7IHByb3RlY3RlZCBzZXQ7IH1cclxuICAgICAgICBwdWJsaWMgaW50IFJlc3Bhd25UaW1lIHsgZ2V0OyBwcm90ZWN0ZWQgc2V0OyB9XHJcbiAgICAgICAgcHVibGljIHN0cmluZyBOYW1lIHsgZ2V0OyBwcm90ZWN0ZWQgc2V0OyB9XHJcbiAgICAgICAgcHVibGljIE1vZGVUeXBlcyBNb2RlVHlwZSB7IGdldDsgcHJvdGVjdGVkIHNldDsgfVxyXG4gICAgICAgIHB1YmxpYyBib29sIHVubG9ja2VkIHsgZ2V0OyBwcm90ZWN0ZWQgc2V0OyB9XHJcbiAgICAgICAgcHVibGljIHN0cmluZyBEZXNjcmlwdGlvbiB7IGdldDsgcHJvdGVjdGVkIHNldDsgfVxyXG5cclxuICAgICAgICBwdWJsaWMgc3RhdGljIExpc3Q8R2FtZU1vZGU+IEdldEdhbWVNb2Rlc09mVHlwZShNb2RlVHlwZXMgdHlwZSlcclxuICAgICAgICB7XHJcbiAgICAgICAgICAgIHJldHVybiBuZXcgTGlzdDxHYW1lTW9kZT4oU3lzdGVtLkxpbnEuRW51bWVyYWJsZS5XaGVyZTxnbG9iYWw6OkNpcm5vR2FtZS5HYW1lTW9kZT4oZ2FtZU1vZGVzLChnbG9iYWw6OlN5c3RlbS5GdW5jPGdsb2JhbDo6Q2lybm9HYW1lLkdhbWVNb2RlLCBib29sPikoRyA9PiBHLk1vZGVUeXBlID09IHR5cGUpKSk7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBwdWJsaWMgc3RhdGljIEdhbWVNb2RlIEdldEdhbWVNb2RlQnlOYW1lKHN0cmluZyBuYW1lKVxyXG4gICAgICAgIHtcclxuICAgICAgICAgICAgdmFyIHJldCA9IG5ldyBMaXN0PEdhbWVNb2RlPihTeXN0ZW0uTGlucS5FbnVtZXJhYmxlLldoZXJlPGdsb2JhbDo6Q2lybm9HYW1lLkdhbWVNb2RlPihnYW1lTW9kZXMsKGdsb2JhbDo6U3lzdGVtLkZ1bmM8Z2xvYmFsOjpDaXJub0dhbWUuR2FtZU1vZGUsIGJvb2w+KShHID0+IEcuTmFtZSA9PSBuYW1lKSkpO1xyXG4gICAgICAgICAgICBpZiAocmV0LkNvdW50ID4gMClcclxuICAgICAgICAgICAgICAgIHJldHVybiByZXRbMF07XHJcbiAgICAgICAgICAgIHJldHVybiBudWxsO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgcHJvdGVjdGVkIEdhbWVNb2RlKHN0cmluZyBuYW1lKVxyXG4gICAgICAgIHtcclxuICAgICAgICAgICAgVGVhbXMgPSB0cnVlO1xyXG4gICAgICAgICAgICBTdGFydGluZ0xpdmVzID0gMztcclxuICAgICAgICAgICAgU3Vydml2YWwgPSB0cnVlO1xyXG4gICAgICAgICAgICBBbGxvd09ubGluZVBsYXkgPSB0cnVlO1xyXG4gICAgICAgICAgICBBbGxvd0NoYXJhY3RlclNlbGVjdCA9IHRydWU7XHJcbiAgICAgICAgICAgIE51bWJlck9mUGxheWVycyA9IDY7XHJcbiAgICAgICAgICAgIFJlc3Bhd25UaW1lID0gMzkwO1xyXG4gICAgICAgICAgICBOYW1lID0gbmFtZTtcclxuICAgICAgICAgICAgTW9kZVR5cGUgPSBHYW1lTW9kZS5Nb2RlVHlwZXMuU2tpcm1pc2g7XHJcbiAgICAgICAgICAgIERlc2NyaXB0aW9uID0gXCJNaXNzaW5nIGRlc2NyaXB0aW9uIGZvciBcIiArIG5hbWU7XHJcbiAgICAgICAgICAgIHVubG9ja2VkID0gdHJ1ZTtcclxuICAgICAgICAgICAgZ2FtZU1vZGVzLkFkZCh0aGlzKTtcclxuICAgICAgICB9XHJcbiAgICAgICAgcHVibGljIHN0YXRpYyBHYW1lTW9kZSBUZWFtQmF0dGxlO1xyXG4gICAgICAgIHB1YmxpYyBzdGF0aWMgR2FtZU1vZGUgRGVhdGhNYXRjaDtcclxuICAgICAgICBwcm90ZWN0ZWQgc3RhdGljIExpc3Q8R2FtZU1vZGU+IGdhbWVNb2RlcztcclxuXHJcbiAgICAgICAgLy9bSW5pdF1cclxuICAgICAgICBbUmVhZHldXHJcbiAgICAgICAgcHJvdGVjdGVkIHN0YXRpYyB2b2lkIGluaXQoKVxyXG4gICAgICAgIHtcclxuICAgICAgICAgICAgaWYgKFRlYW1CYXR0bGUgPT0gbnVsbClcclxuICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgZ2FtZU1vZGVzID0gbmV3IExpc3Q8R2FtZU1vZGU+KCk7XHJcbiAgICAgICAgICAgICAgICBUZWFtQmF0dGxlID0gbmV3IEdhbWVNb2RlKFwiVGVhbSBCYXR0bGVcIik7XHJcbiAgICAgICAgICAgICAgICBUZWFtQmF0dGxlLkRlc2NyaXB0aW9uID0gXCIyIHRlYW1zIGJhdHRsZSB3aXRoIGxpbWl0ZWQgbGl2ZXNcXG51bnRpbCBvbmx5IDEgdGVhbSByZW1haW5zLlwiO1xyXG4gICAgICAgICAgICAgICAgRGVhdGhNYXRjaCA9IG5ldyBHYW1lTW9kZShcIkRlYXRoIE1hdGNoXCIpO1xyXG4gICAgICAgICAgICAgICAgRGVhdGhNYXRjaC5EZXNjcmlwdGlvbiA9IFwiQSBmcmVlIGZvciBhbGwgbWF0Y2ggd2l0aFxcbmxpbWl0ZWQgbGl2ZXMuXCI7XHJcbiAgICAgICAgICAgICAgICBEZWF0aE1hdGNoLlRlYW1zID0gZmFsc2U7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcbiAgICB9XHJcbn1cclxuIiwidXNpbmcgU3lzdGVtO1xyXG51c2luZyBTeXN0ZW0uQ29sbGVjdGlvbnMuR2VuZXJpYztcclxudXNpbmcgU3lzdGVtLkxpbnE7XHJcbnVzaW5nIFN5c3RlbS5UZXh0O1xyXG51c2luZyBTeXN0ZW0uVGhyZWFkaW5nLlRhc2tzO1xyXG51c2luZyBCcmlkZ2U7XHJcbnVzaW5nIEJyaWRnZS5IdG1sNTtcclxuXHJcbm5hbWVzcGFjZSBDaXJub0dhbWVcclxue1xyXG4gICAgcHVibGljIGNsYXNzIEVudGl0eUJlaGF2aW9yXHJcbiAgICB7XHJcbiAgICAgICAgcHVibGljIGJvb2wgZW5hYmxlZCA9IHRydWU7XHJcbiAgICAgICAgcHVibGljIGludCBGcmFtZXNQZXJUaWNrID0gMDtcclxuICAgICAgICBwdWJsaWMgRW50aXR5IGVudGl0eTtcclxuICAgICAgICBwdWJsaWMgc3RyaW5nIEJlaGF2aW9yTmFtZSB7IGdldDsgcHJvdGVjdGVkIHNldDsgfVxyXG4gICAgICAgIHB1YmxpYyBFbnRpdHlCZWhhdmlvcihFbnRpdHkgZW50aXR5KVxyXG4gICAgICAgIHtcclxuICAgICAgICAgICAgdGhpcy5lbnRpdHkgPSBlbnRpdHk7XHJcbiAgICAgICAgICAgIGlmIChCZWhhdmlvck5hbWUgPT0gXCJcIiB8fCBCZWhhdmlvck5hbWUgPT0gbnVsbClcclxuICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgZHluYW1pYyB0ZXN0ID0gR2V0VHlwZSgpO1xyXG4gICAgICAgICAgICAgICAgdmFyIEZOID0gU2NyaXB0LldyaXRlPHN0cmluZz4oXCJ0ZXN0W1xcXCIkJGZ1bGxuYW1lXFxcIl1cIik7XHJcbiAgICAgICAgICAgICAgICAvL0hlbHBlci5Mb2coXCJGTjpcIiArIEZOKTtcclxuICAgICAgICAgICAgICAgIHN0cmluZ1tdIHMgPSBGTi5TcGxpdChcIi5cIik7XHJcbiAgICAgICAgICAgICAgICBCZWhhdmlvck5hbWUgPSBzW3MuTGVuZ3RoIC0gMV07XHJcbiAgICAgICAgICAgICAgICAvL0JlaGF2aW9yTmFtZSA9IEdldFR5cGUoKS5GdWxsTmFtZTtcclxuICAgICAgICAgICAgICAgIC8vR2V0VHlwZSgpLkdldENsYXNzTmFtZVxyXG5cclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuICAgICAgICBwdWJsaWMgdmlydHVhbCB2b2lkIFVwZGF0ZSgpXHJcbiAgICAgICAge1xyXG5cclxuICAgICAgICB9XHJcbiAgICAgICAgcHVibGljIHZpcnR1YWwgdm9pZCBEcmF3KENhbnZhc1JlbmRlcmluZ0NvbnRleHQyRCBnKVxyXG4gICAgICAgIHtcclxuICAgICAgICB9XHJcbiAgICAgICAgcHVibGljIHZvaWQgU2VuZEN1c3RvbUV2ZW50KGR5bmFtaWMgZXZ0LCBib29sIHRyaWdnZXJmbHVzaCA9IGZhbHNlKVxyXG4gICAgICAgIHtcclxuICAgICAgICAgICAgZHluYW1pYyBEID0gbmV3IG9iamVjdCgpO1xyXG4gICAgICAgICAgICBELkkgPSBlbnRpdHkuSUQ7XHJcbiAgICAgICAgICAgIEQuRCA9IGV2dDtcclxuICAgICAgICAgICAgLy9ELlQgPSB0aGlzLkdldFR5cGUoKS5GdWxsTmFtZTtcclxuICAgICAgICAgICAgRC5UID0gQmVoYXZpb3JOYW1lO1xyXG4gICAgICAgICAgICBlbnRpdHkuR2FtZS5TZW5kRXZlbnQoXCJDQkVcIiwgRCwgdHJpZ2dlcmZsdXNoKTtcclxuICAgICAgICB9XHJcbiAgICAgICAgcHVibGljIHZpcnR1YWwgdm9pZCBDdXN0b21FdmVudChkeW5hbWljIGV2dClcclxuICAgICAgICB7XHJcblxyXG4gICAgICAgIH1cclxuICAgIH1cclxufVxyXG4iLCJ1c2luZyBTeXN0ZW07XHJcbnVzaW5nIFN5c3RlbS5Db2xsZWN0aW9ucy5HZW5lcmljO1xyXG51c2luZyBTeXN0ZW0uTGlucTtcclxudXNpbmcgU3lzdGVtLlRleHQ7XHJcbnVzaW5nIFN5c3RlbS5UaHJlYWRpbmcuVGFza3M7XHJcbnVzaW5nIEJyaWRnZTtcclxudXNpbmcgQnJpZGdlLkh0bWw1O1xyXG5cclxubmFtZXNwYWNlIENpcm5vR2FtZVxyXG57XHJcbiAgICBwdWJsaWMgY2xhc3MgQW5pbWF0aW9uXHJcbiAgICB7XHJcbiAgICAgICAgcHVibGljIExpc3Q8SFRNTEltYWdlRWxlbWVudD4gSW1hZ2VzO1xyXG4gICAgICAgIHByb3RlY3RlZCBIVE1MSW1hZ2VFbGVtZW50IF9jdXJyZW50SW1hZ2U7XHJcbiAgICAgICAgcHVibGljIEhUTUxJbWFnZUVsZW1lbnQgQ3VycmVudEltYWdlXHJcbiAgICAgICAge1xyXG4gICAgICAgICAgICBnZXRcclxuICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuIF9jdXJyZW50SW1hZ2U7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgc2V0XHJcbiAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgIGlmIChfY3VycmVudEltYWdlICE9IHZhbHVlKVxyXG4gICAgICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgICAgIEJ1ZmZlck5lZWRzUmVkcmF3ID0gdHJ1ZTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIF9jdXJyZW50SW1hZ2UgPSB2YWx1ZTtcclxuXHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcbiAgICAgICAgcHVibGljIGZsb2F0IEN1cnJlbnRGcmFtZTtcclxuICAgICAgICBwdWJsaWMgZmxvYXQgSW1hZ2VTcGVlZDtcclxuICAgICAgICBwdWJsaWMgVmVjdG9yMiBQb3NpdGlvbjtcclxuICAgICAgICBwdWJsaWMgaW50IEFuaW1hdGlvblRpbWVFbGFwc2VkO1xyXG4gICAgICAgIHB1YmxpYyBmbG9hdCBYXHJcbiAgICAgICAge1xyXG4gICAgICAgICAgICBnZXRcclxuICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuIFBvc2l0aW9uLlg7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgc2V0XHJcbiAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgIFBvc2l0aW9uLlggPSB2YWx1ZTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuICAgICAgICBwdWJsaWMgZmxvYXQgWVxyXG4gICAgICAgIHtcclxuICAgICAgICAgICAgZ2V0XHJcbiAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgIHJldHVybiBQb3NpdGlvbi5ZO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIHNldFxyXG4gICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICBQb3NpdGlvbi5ZID0gdmFsdWU7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcbiAgICAgICAgcHVibGljIGZsb2F0IFN0cmV0Y2hXaWR0aCA9IDA7XHJcbiAgICAgICAgcHVibGljIGZsb2F0IFN0cmV0Y2hIZWlnaHQgPSAwO1xyXG4gICAgICAgIHB1YmxpYyBmbG9hdCBSb3RhdGlvbiA9IDA7XHJcbiAgICAgICAgcHVibGljIGZsb2F0IEFscGhhID0gMTtcclxuXHJcbiAgICAgICAgcHVibGljIGJvb2wgTG9vcGluZyA9IHRydWU7XHJcbiAgICAgICAgcHVibGljIGJvb2wgTG9vcGVkID0gZmFsc2U7XHJcbiAgICAgICAgcHVibGljIGJvb2wgRnJhbWVDaGFuZ2VkID0gZmFsc2U7XHJcbiAgICAgICAgcHVibGljIGJvb2wgRmxpcHBlZCA9IGZhbHNlO1xyXG4gICAgICAgIHByb3RlY3RlZCBib29sIF90cmFuc2Zvcm1lZCA9IGZhbHNlO1xyXG5cclxuICAgICAgICBwcm90ZWN0ZWQgZmxvYXQgX3NoYWRvdztcclxuICAgICAgICBwdWJsaWMgZmxvYXQgU2hhZG93XHJcbiAgICAgICAge1xyXG4gICAgICAgICAgICBnZXRcclxuICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuIF9zaGFkb3c7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgc2V0XHJcbiAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgIGlmIChfc2hhZG93ICE9IHZhbHVlKVxyXG4gICAgICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgICAgIF9zaGFkb3cgPSB2YWx1ZTtcclxuICAgICAgICAgICAgICAgICAgICBCdWZmZXJOZWVkc1JlZHJhdyA9IHRydWU7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcbiAgICAgICAgcHJvdGVjdGVkIHN0cmluZyBfc2hhZG93Q29sb3I7XHJcbiAgICAgICAgcHVibGljIHN0cmluZyBTaGFkb3djb2xvclxyXG4gICAgICAgIHtcclxuICAgICAgICAgICAgZ2V0XHJcbiAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgIHJldHVybiBfc2hhZG93Q29sb3I7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgc2V0XHJcbiAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgIGlmIChfc2hhZG93Q29sb3IgIT0gdmFsdWUpXHJcbiAgICAgICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICAgICAgX3NoYWRvd0NvbG9yID0gdmFsdWU7XHJcbiAgICAgICAgICAgICAgICAgICAgQnVmZmVyTmVlZHNSZWRyYXcgPSB0cnVlO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBwcm90ZWN0ZWQgYm9vbCBCdWZmZXJOZWVkc1JlZHJhdyA9IHRydWU7XHJcbiAgICAgICAgcHJvdGVjdGVkIHN0cmluZyBfaHVlQ29sb3I7XHJcbiAgICAgICAgcHVibGljIHN0cmluZyBIdWVDb2xvclxyXG4gICAgICAgIHtcclxuICAgICAgICAgICAgZ2V0XHJcbiAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgIHJldHVybiBfaHVlQ29sb3I7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgc2V0XHJcbiAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgIGlmIChfaHVlQ29sb3IgIT0gdmFsdWUpXHJcbiAgICAgICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICAgICAgQnVmZmVyTmVlZHNSZWRyYXcgPSB0cnVlO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgX2h1ZUNvbG9yID0gdmFsdWU7XHJcblxyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHByb3RlY3RlZCBmbG9hdCBfaHVlUmVjb2xvclN0cmVuZ3RoO1xyXG4gICAgICAgIHB1YmxpYyBmbG9hdCBIdWVSZWNvbG9yU3RyZW5ndGhcclxuICAgICAgICB7XHJcbiAgICAgICAgICAgIGdldFxyXG4gICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gX2h1ZVJlY29sb3JTdHJlbmd0aDtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBzZXRcclxuICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgaWYgKF9odWVSZWNvbG9yU3RyZW5ndGggIT0gdmFsdWUpXHJcbiAgICAgICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICAgICAgQnVmZmVyTmVlZHNSZWRyYXcgPSB0cnVlO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgX2h1ZVJlY29sb3JTdHJlbmd0aCA9IHZhbHVlO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBwcm90ZWN0ZWQgSFRNTENhbnZhc0VsZW1lbnQgX2J1ZmZlcjtcclxuICAgICAgICBwcm90ZWN0ZWQgQ2FudmFzUmVuZGVyaW5nQ29udGV4dDJEIF9iZztcclxuXHJcbiAgICAgICAgcHVibGljIEFuaW1hdGlvbihMaXN0PEhUTUxJbWFnZUVsZW1lbnQ+IGRhdGEpXHJcbiAgICAgICAge1xyXG4gICAgICAgICAgICBJbWFnZXMgPSBkYXRhO1xyXG4gICAgICAgICAgICBpZiAoSW1hZ2VzID09IG51bGwpXHJcbiAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgIEltYWdlcyA9IG5ldyBMaXN0PEhUTUxJbWFnZUVsZW1lbnQ+KCk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgSW1hZ2VTcGVlZCA9IDFmO1xyXG4gICAgICAgICAgICBQb3NpdGlvbiA9IG5ldyBWZWN0b3IyKCk7XHJcbiAgICAgICAgICAgIEFuaW1hdGlvblRpbWVFbGFwc2VkID0gMDtcclxuICAgICAgICAgICAgU2hhZG93ID0gMDtcclxuICAgICAgICAgICAgU2hhZG93Y29sb3IgPSBcIiNGRkZGRkZcIjtcclxuICAgICAgICAgICAgSHVlQ29sb3IgPSBcIlwiO1xyXG4gICAgICAgICAgICBIdWVSZWNvbG9yU3RyZW5ndGggPSAwLjZmO1xyXG4gICAgICAgICAgICBfYnVmZmVyID0gbmV3IEhUTUxDYW52YXNFbGVtZW50KCk7XHJcbiAgICAgICAgICAgIF9iZyA9IF9idWZmZXIuR2V0Q29udGV4dChDYW52YXNUeXBlcy5DYW52YXNDb250ZXh0MkRUeXBlLkNhbnZhc1JlbmRlcmluZ0NvbnRleHQyRCk7XHJcbiAgICAgICAgICAgIGlmIChJbWFnZXMuQ291bnQgPiAwKVxyXG4gICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICBTZXRJbWFnZSgpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHB1YmxpYyB2b2lkIFVwZGF0ZSgpXHJcbiAgICAgICAge1xyXG4gICAgICAgICAgICBIVE1MSW1hZ2VFbGVtZW50IExJID0gQ3VycmVudEltYWdlO1xyXG4gICAgICAgICAgICBpbnQgbGFzdCA9IChpbnQpQ3VycmVudEZyYW1lO1xyXG4gICAgICAgICAgICBDdXJyZW50RnJhbWUgKz0gSW1hZ2VTcGVlZDtcclxuICAgICAgICAgICAgaW50IGN1cnJlbnQgPSAoaW50KUN1cnJlbnRGcmFtZTtcclxuICAgICAgICAgICAgaWYgKGN1cnJlbnQgIT0gbGFzdClcclxuICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgaWYgKEltYWdlcy5Db3VudCA+IDApXHJcbiAgICAgICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICAgICAgd2hpbGUgKGN1cnJlbnQgPj0gSW1hZ2VzLkNvdW50ICYmIGN1cnJlbnQgPiAwKVxyXG4gICAgICAgICAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKExvb3BpbmcpXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGN1cnJlbnQgLT0gSW1hZ2VzLkNvdW50O1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgQ3VycmVudEZyYW1lIC09IEltYWdlcy5Db3VudDtcclxuICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgICAgICBlbHNlXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIEN1cnJlbnRGcmFtZSAtPSBJbWFnZVNwZWVkO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgIHdoaWxlIChjdXJyZW50IDwgMClcclxuICAgICAgICAgICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGN1cnJlbnQgKz0gSW1hZ2VzLkNvdW50O1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBDdXJyZW50RnJhbWUgKz0gSW1hZ2VzLkNvdW50O1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIFNldEltYWdlKCk7XHJcbiAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgIExvb3BlZCA9IGZhbHNlO1xyXG4gICAgICAgICAgICBpZiAoTEkgIT0gQ3VycmVudEltYWdlKVxyXG4gICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICBGcmFtZUNoYW5nZWQgPSB0cnVlO1xyXG4gICAgICAgICAgICAgICAgaWYgKChJbWFnZVNwZWVkID4gMCAmJiBjdXJyZW50ID09IDApIHx8ICgoSW1hZ2VTcGVlZCA8IDAgJiYgY3VycmVudCA9PSBJbWFnZXMuQ291bnQgLSAxKSkpXHJcbiAgICAgICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICAgICAgTG9vcGVkID0gdHJ1ZTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBlbHNlXHJcbiAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgIEZyYW1lQ2hhbmdlZCA9IGZhbHNlO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIEFuaW1hdGlvblRpbWVFbGFwc2VkKys7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHB1YmxpYyB2b2lkIENoYW5nZUFuaW1hdGlvbihMaXN0PEhUTUxJbWFnZUVsZW1lbnQ+IGFuaSwgYm9vbCByZXNldCA9IHRydWUpXHJcbiAgICAgICAge1xyXG4gICAgICAgICAgICBpZiAocmVzZXQpXHJcbiAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgIEN1cnJlbnRGcmFtZSA9IDA7XHJcbiAgICAgICAgICAgICAgICBBbmltYXRpb25UaW1lRWxhcHNlZCA9IDA7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgSW1hZ2VzID0gYW5pO1xyXG4gICAgICAgICAgICAvL0N1cnJlbnRJbWFnZSA9IEltYWdlc1soaW50KUN1cnJlbnRGcmFtZV07XHJcbiAgICAgICAgICAgIFNldEltYWdlKCk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHB1YmxpYyB2b2lkIFNldEltYWdlKClcclxuICAgICAgICB7XHJcbiAgICAgICAgICAgIGlmIChJbWFnZXMuQ291bnQgPCAyKVxyXG4gICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICBDdXJyZW50RnJhbWUgPSAwO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIGVsc2VcclxuICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgdmFyIGxuID0gSW1hZ2VzLkNvdW50O1xyXG4gICAgICAgICAgICAgICAgd2hpbGUgKEN1cnJlbnRGcmFtZSA8IDApXHJcbiAgICAgICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICAgICAgQ3VycmVudEZyYW1lICs9IGxuO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgd2hpbGUgKEN1cnJlbnRGcmFtZSA+PSBsbilcclxuICAgICAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgICAgICBDdXJyZW50RnJhbWUgLT0gbG47XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgaW50IGN1cnJlbnQgPSAoaW50KUN1cnJlbnRGcmFtZTtcclxuICAgICAgICAgICAgaWYgKGN1cnJlbnQgPj0gMCAmJiBjdXJyZW50IDwgSW1hZ2VzLkNvdW50KVxyXG4gICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICBDdXJyZW50SW1hZ2UgPSBJbWFnZXNbY3VycmVudF07XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcbiAgICAgICAgcHVibGljIHZvaWQgRHJhdyhDYW52YXNSZW5kZXJpbmdDb250ZXh0MkQgZylcclxuICAgICAgICB7XHJcbiAgICAgICAgICAgIERyYXcoZywgUG9zaXRpb24pO1xyXG4gICAgICAgIH1cclxuICAgICAgICBwdWJsaWMgdm9pZCBEcmF3KENhbnZhc1JlbmRlcmluZ0NvbnRleHQyRCBnLCBWZWN0b3IyIHBvc2l0aW9uKVxyXG4gICAgICAgIHtcclxuICAgICAgICAgICAgZmxvYXQgeCA9IHBvc2l0aW9uLlg7XHJcbiAgICAgICAgICAgIGZsb2F0IHkgPSBwb3NpdGlvbi5ZO1xyXG4gICAgICAgICAgICBpZiAoQ3VycmVudEltYWdlID09IG51bGwpXHJcbiAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgIGludCBjdXJyZW50ID0gKGludClDdXJyZW50RnJhbWU7XHJcbiAgICAgICAgICAgICAgICBpZiAoY3VycmVudCA+PSAwICYmIGN1cnJlbnQgPCBJbWFnZXMuQ291bnQpXHJcbiAgICAgICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICAgICAgQ3VycmVudEltYWdlID0gSW1hZ2VzW2N1cnJlbnRdO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgaWYgKEN1cnJlbnRJbWFnZSA9PSBudWxsKVxyXG4gICAgICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgICAgIHJldHVybjtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBmbG9hdCBYID0geDtcclxuICAgICAgICAgICAgZmxvYXQgWSA9IHk7XHJcbiAgICAgICAgICAgIGZsb2F0IGxhc3RhbHBoYSA9IGcuR2xvYmFsQWxwaGE7XHJcbiAgICAgICAgICAgIGJvb2wgY2VudGVyZWQgPSBmYWxzZTtcclxuICAgICAgICAgICAgYm9vbCB1c2VCdWZmZXIgPSBmYWxzZTtcclxuICAgICAgICAgICAgaWYgKEh1ZUNvbG9yICE9IFwiXCIpXHJcbiAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgIGlmIChCdWZmZXJOZWVkc1JlZHJhdylcclxuICAgICAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgICAgICBib29sIGFkdiA9IHRydWU7XHJcbiAgICAgICAgICAgICAgICAgICAgX2JnLkdsb2JhbENvbXBvc2l0ZU9wZXJhdGlvbiA9IENhbnZhc1R5cGVzLkNhbnZhc0NvbXBvc2l0ZU9wZXJhdGlvblR5cGUuU291cmNlT3ZlcjtcclxuICAgICAgICAgICAgICAgICAgICBfYnVmZmVyLldpZHRoID0gQ3VycmVudEltYWdlLldpZHRoO1xyXG4gICAgICAgICAgICAgICAgICAgIF9idWZmZXIuSGVpZ2h0ID0gQ3VycmVudEltYWdlLkhlaWdodDtcclxuICAgICAgICAgICAgICAgICAgICBfYmcuRHJhd0ltYWdlKEN1cnJlbnRJbWFnZSwgMGYsIDBmKTtcclxuICAgICAgICAgICAgICAgICAgICBfYmcuR2xvYmFsQWxwaGEgPSBIdWVSZWNvbG9yU3RyZW5ndGg7XHJcbiAgICAgICAgICAgICAgICAgICAgX2JnLkdsb2JhbENvbXBvc2l0ZU9wZXJhdGlvbiA9IENhbnZhc1R5cGVzLkNhbnZhc0NvbXBvc2l0ZU9wZXJhdGlvblR5cGUuSHVlO1xyXG4gICAgICAgICAgICAgICAgICAgIF9iZy5GaWxsU3R5bGUgPSBIdWVDb2xvcjtcclxuICAgICAgICAgICAgICAgICAgICBfYmcuRmlsbFJlY3QoMCwgMCwgX2J1ZmZlci5XaWR0aCwgX2J1ZmZlci5IZWlnaHQpO1xyXG5cclxuICAgICAgICAgICAgICAgICAgICBpZiAoYWR2KVxyXG4gICAgICAgICAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgX2JnLkdsb2JhbEFscGhhID0gKDEgKyBIdWVSZWNvbG9yU3RyZW5ndGgpIC8gMmY7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIF9iZy5HbG9iYWxDb21wb3NpdGVPcGVyYXRpb24gPSBDYW52YXNUeXBlcy5DYW52YXNDb21wb3NpdGVPcGVyYXRpb25UeXBlLlNvdXJjZU92ZXI7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIF9iZy5GaWxsUmVjdCgwLCAwLCBfYnVmZmVyLldpZHRoLCBfYnVmZmVyLkhlaWdodCk7XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgICAgICAgICBfYmcuR2xvYmFsQWxwaGEgPSAxO1xyXG4gICAgICAgICAgICAgICAgICAgIGlmIChhZHYpXHJcbiAgICAgICAgICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBfYmcuR2xvYmFsQ29tcG9zaXRlT3BlcmF0aW9uID0gQ2FudmFzVHlwZXMuQ2FudmFzQ29tcG9zaXRlT3BlcmF0aW9uVHlwZS5MdW1pbm9zaXR5O1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBfYmcuRHJhd0ltYWdlKEN1cnJlbnRJbWFnZSwgMGYsIDBmKTtcclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgU2NyaXB0LldyaXRlKFwidGhpcy5fYmcuZ2xvYmFsQ29tcG9zaXRlT3BlcmF0aW9uID0gJ2Rlc3RpbmF0aW9uLWluJ1wiKTtcclxuICAgICAgICAgICAgICAgICAgICBfYmcuRHJhd0ltYWdlKEN1cnJlbnRJbWFnZSwgMGYsIDBmKTtcclxuICAgICAgICAgICAgICAgICAgICBpZiAoYWR2KVxyXG4gICAgICAgICAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgX2JnLkdsb2JhbENvbXBvc2l0ZU9wZXJhdGlvbiA9IENhbnZhc1R5cGVzLkNhbnZhc0NvbXBvc2l0ZU9wZXJhdGlvblR5cGUuSHVlO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBfYmcuR2xvYmFsQWxwaGEgPSBIdWVSZWNvbG9yU3RyZW5ndGggKiAwLjRmO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBfYmcuRHJhd0ltYWdlKEN1cnJlbnRJbWFnZSwgMGYsIDBmKTtcclxuICAgICAgICAgICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgdXNlQnVmZmVyID0gdHJ1ZTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBpZiAoQWxwaGEgPCAxKVxyXG4gICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICBpZiAoQWxwaGEgPD0gMClcclxuICAgICAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgICAgICByZXR1cm47XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICBnLkdsb2JhbEFscGhhID0gZy5HbG9iYWxBbHBoYSAqIEFscGhhO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIC8vaWYgKHJvdGF0aW9uICE9IDApXHJcbiAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgIGZsb2F0IHgyID0gQ3VycmVudEltYWdlLldpZHRoIC8gMmY7XHJcbiAgICAgICAgICAgICAgICBmbG9hdCB5MiA9IEN1cnJlbnRJbWFnZS5IZWlnaHQgLyAyZjtcclxuXHJcbiAgICAgICAgICAgICAgICBYID0gLXgyO1xyXG4gICAgICAgICAgICAgICAgWSA9IC15MjtcclxuICAgICAgICAgICAgICAgIGlmICghX3RyYW5zZm9ybWVkKVxyXG4gICAgICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgICAgIGcuU2F2ZSgpO1xyXG4gICAgICAgICAgICAgICAgICAgIF90cmFuc2Zvcm1lZCA9IHRydWU7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICBnLlRyYW5zbGF0ZSh4ICsgeDIsIHkgKyB5Mik7XHJcbiAgICAgICAgICAgICAgICBjZW50ZXJlZCA9IHRydWU7XHJcbiAgICAgICAgICAgICAgICBnLlJvdGF0ZShSb3RhdGlvbik7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgaWYgKEZsaXBwZWQpXHJcbiAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgIGlmICghX3RyYW5zZm9ybWVkKVxyXG4gICAgICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgICAgIGcuU2F2ZSgpO1xyXG4gICAgICAgICAgICAgICAgICAgIF90cmFuc2Zvcm1lZCA9IHRydWU7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICBnLlNjYWxlKC0xLCAxKTtcclxuICAgICAgICAgICAgICAgIC8vZG9uJ3QgdHJhbnNsYXRlIGlmIGl0J3MgY2VudGVyZWQuXHJcbiAgICAgICAgICAgICAgICBpZiAoIWNlbnRlcmVkKVxyXG4gICAgICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgICAgIGcuVHJhbnNsYXRlKEN1cnJlbnRJbWFnZS5XaWR0aCwgMCk7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgaWYgKFNoYWRvdyA+IDApXHJcbiAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgIGcuU2hhZG93Qmx1ciA9IFNoYWRvdztcclxuICAgICAgICAgICAgICAgIGcuU2hhZG93Q29sb3IgPSBTaGFkb3djb2xvcjtcclxuICAgICAgICAgICAgICAgIGlmICghdXNlQnVmZmVyICYmIEJ1ZmZlck5lZWRzUmVkcmF3KVxyXG4gICAgICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgICAgIF9iZy5TaGFkb3dCbHVyID0gMDtcclxuICAgICAgICAgICAgICAgICAgICBfYnVmZmVyLldpZHRoID0gQ3VycmVudEltYWdlLldpZHRoO1xyXG4gICAgICAgICAgICAgICAgICAgIF9idWZmZXIuSGVpZ2h0ID0gQ3VycmVudEltYWdlLkhlaWdodDtcclxuICAgICAgICAgICAgICAgICAgICBfYmcuRHJhd0ltYWdlKEN1cnJlbnRJbWFnZSwgMGYsIDBmKTtcclxuICAgICAgICAgICAgICAgICAgICB1c2VCdWZmZXIgPSB0cnVlO1xyXG4gICAgICAgICAgICAgICAgICAgIC8vQnVmZmVyTmVlZHNSZWRyYXcgPSB0cnVlO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgdXNlQnVmZmVyID0gdHJ1ZTtcclxuICAgICAgICAgICAgICAgIC8vaWYgKCh1c2VCdWZmZXIgJiYgQnVmZmVyTmVlZHNSZWRyYXcpIHx8IFJvdGF0aW9uIT0wIHx8IHRydWUpXHJcbiAgICAgICAgICAgICAgICBpZiAoQnVmZmVyTmVlZHNSZWRyYXcpXHJcbiAgICAgICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICAgICAgSFRNTENhbnZhc0VsZW1lbnQgQyA9IEhlbHBlci5DbG9uZUNhbnZhcyhfYnVmZmVyKTtcclxuICAgICAgICAgICAgICAgICAgICBDYW52YXNSZW5kZXJpbmdDb250ZXh0MkQgQ0cgPSBIZWxwZXIuR2V0Q29udGV4dChDKTtcclxuICAgICAgICAgICAgICAgICAgICBfYnVmZmVyLldpZHRoICs9IChpbnQpKFNoYWRvdyAqIDIpO1xyXG4gICAgICAgICAgICAgICAgICAgIF9idWZmZXIuSGVpZ2h0ICs9IChpbnQpKFNoYWRvdyAqIDIpO1xyXG4gICAgICAgICAgICAgICAgICAgIF9iZy5TaGFkb3dCbHVyID0gU2hhZG93O1xyXG4gICAgICAgICAgICAgICAgICAgIF9iZy5TaGFkb3dDb2xvciA9IFNoYWRvd2NvbG9yO1xyXG4gICAgICAgICAgICAgICAgICAgIGRyYXdXaXRoU2hhZG93cyhfYmcsIEMsIFNoYWRvdywgU2hhZG93LCAwLCAwLCBTaGFkb3cgLyAzZik7XHJcbiAgICAgICAgICAgICAgICAgICAgdXNlQnVmZmVyID0gdHJ1ZTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIFggLT0gU2hhZG93O1xyXG4gICAgICAgICAgICAgICAgWSAtPSBTaGFkb3c7XHJcbiAgICAgICAgICAgICAgICBnLlNoYWRvd0JsdXIgPSAwO1xyXG4gICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICBpZiAoU3RyZXRjaFdpZHRoID09IDAgJiYgU3RyZXRjaEhlaWdodCA9PSAwKVxyXG4gICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICBpZiAoU2hhZG93ID4gMCAmJiBmYWxzZSlcclxuICAgICAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgICAgICBkeW5hbWljIEkgPSBDdXJyZW50SW1hZ2U7XHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKHVzZUJ1ZmZlcilcclxuICAgICAgICAgICAgICAgICAgICAgICAgSSA9IF9idWZmZXI7XHJcbiAgICAgICAgICAgICAgICAgICAgZHJhd1dpdGhTaGFkb3dzKGcsIEksIFgsIFksIDAsIDAsIFNoYWRvdyAvIDMpO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgZWxzZVxyXG4gICAgICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgICAgIGlmICghdXNlQnVmZmVyKVxyXG4gICAgICAgICAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgZy5EcmF3SW1hZ2UoQ3VycmVudEltYWdlLCBYLCBZKTtcclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgZWxzZVxyXG4gICAgICAgICAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgZy5EcmF3SW1hZ2UoX2J1ZmZlciwgWCwgWSk7XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIGVsc2VcclxuICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgaWYgKFNoYWRvdyA+IDAgJiYgZmFsc2UpXHJcbiAgICAgICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICAgICAgZHluYW1pYyBJID0gQ3VycmVudEltYWdlO1xyXG4gICAgICAgICAgICAgICAgICAgIGlmICh1c2VCdWZmZXIpXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIEkgPSBfYnVmZmVyO1xyXG4gICAgICAgICAgICAgICAgICAgIGRyYXdXaXRoU2hhZG93cyhnLCBJLCBYLCBZLCBTdHJldGNoV2lkdGgsIFN0cmV0Y2hIZWlnaHQsIFNoYWRvdyAvIDMpO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgZWxzZVxyXG4gICAgICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgICAgIGlmICghdXNlQnVmZmVyKVxyXG4gICAgICAgICAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgZy5EcmF3SW1hZ2UoQ3VycmVudEltYWdlLCBYLCBZLCBTdHJldGNoV2lkdGgsIFN0cmV0Y2hIZWlnaHQpO1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICBlbHNlXHJcbiAgICAgICAgICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBnLkRyYXdJbWFnZShfYnVmZmVyLCBYLCBZLCBTdHJldGNoV2lkdGgsIFN0cmV0Y2hIZWlnaHQpO1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBpZiAoX3RyYW5zZm9ybWVkKVxyXG4gICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICBnLlJlc3RvcmUoKTtcclxuICAgICAgICAgICAgICAgIF90cmFuc2Zvcm1lZCA9IGZhbHNlO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIGlmIChTaGFkb3cgPiAwKVxyXG4gICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICBnLlNoYWRvd0JsdXIgPSAwO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIGlmIChBbHBoYSA8IDEpXHJcbiAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgIGcuR2xvYmFsQWxwaGEgPSBsYXN0YWxwaGE7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgQnVmZmVyTmVlZHNSZWRyYXcgPSBmYWxzZTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIHByb3RlY3RlZCB2b2lkIGRyYXdXaXRoU2hhZG93cyhDYW52YXNSZW5kZXJpbmdDb250ZXh0MkQgZywgZHluYW1pYyBJLCBmbG9hdCBYLCBmbG9hdCBZLCBmbG9hdCBXLCBmbG9hdCBILCBmbG9hdCBzaXplKVxyXG4gICAgICAgIHtcclxuICAgICAgICAgICAgaWYgKFcgPT0gMClcclxuICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgVyA9IEkud2lkdGg7XHJcbiAgICAgICAgICAgICAgICBIID0gSS5oZWlnaHQ7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgZy5TaGFkb3dPZmZzZXRYID0gLXNpemU7XHJcbiAgICAgICAgICAgIGcuRHJhd0ltYWdlKEksIFgsIFksIFcsIEgpO1xyXG4gICAgICAgICAgICBnLlNoYWRvd09mZnNldFggPSBzaXplO1xyXG4gICAgICAgICAgICBnLkRyYXdJbWFnZShJLCBYLCBZLCBXLCBIKTtcclxuICAgICAgICAgICAgZy5TaGFkb3dPZmZzZXRYID0gMDtcclxuICAgICAgICAgICAgZy5TaGFkb3dPZmZzZXRZID0gLXNpemU7XHJcbiAgICAgICAgICAgIGcuRHJhd0ltYWdlKEksIFgsIFksIFcsIEgpO1xyXG4gICAgICAgICAgICBnLlNoYWRvd09mZnNldFkgPSBzaXplO1xyXG4gICAgICAgICAgICBnLkRyYXdJbWFnZShJLCBYLCBZLCBXLCBIKTtcclxuXHJcbiAgICAgICAgICAgIGcuU2hhZG93T2Zmc2V0WSA9IDA7XHJcbiAgICAgICAgfVxyXG5cclxuXHJcbiAgICB9XHJcbn1cclxuIiwidXNpbmcgU3lzdGVtO1xyXG51c2luZyBTeXN0ZW0uQ29sbGVjdGlvbnMuR2VuZXJpYztcclxudXNpbmcgU3lzdGVtLkxpbnE7XHJcbnVzaW5nIFN5c3RlbS5UZXh0O1xyXG51c2luZyBTeXN0ZW0uVGhyZWFkaW5nLlRhc2tzO1xyXG51c2luZyBCcmlkZ2U7XHJcbnVzaW5nIEJyaWRnZS5IdG1sNTtcclxuXHJcbm5hbWVzcGFjZSBDaXJub0dhbWVcclxue1xyXG4gICAgcHVibGljIGNsYXNzIEFuaW1hdGlvbkxvYWRlclxyXG4gICAge1xyXG4gICAgICAgIHByb3RlY3RlZCBEaWN0aW9uYXJ5PHN0cmluZywgTGlzdDxIVE1MSW1hZ2VFbGVtZW50Pj4gX2RhdGE7XHJcbiAgICAgICAgcHJvdGVjdGVkIHN0YXRpYyBBbmltYXRpb25Mb2FkZXIgX190aGlzO1xyXG4gICAgICAgIHB1YmxpYyBzdGF0aWMgQW5pbWF0aW9uTG9hZGVyIF90aGlzXHJcbiAgICAgICAge1xyXG4gICAgICAgICAgICBnZXRcclxuICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgaWYgKF9fdGhpcyA9PSBudWxsKVxyXG4gICAgICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgICAgIF9fdGhpcyA9IG5ldyBBbmltYXRpb25Mb2FkZXIoKTtcclxuICAgICAgICAgICAgICAgICAgICB0aHJvdyBuZXcgRXhjZXB0aW9uKFwiQW5pbWF0aW9uIGxvYWRlciBub3QgaW5pdGlhdGVkLlwiKTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIHJldHVybiBfX3RoaXM7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcbiAgICAgICAgcHVibGljIEpTT05BcmNoaXZlIEFyY2hpdmU7XHJcbiAgICAgICAgcHVibGljIHN0YXRpYyB2b2lkIEluaXQoSlNPTkFyY2hpdmUgQXJjaGl2ZSlcclxuICAgICAgICB7XHJcbiAgICAgICAgICAgIF9fdGhpcyA9IG5ldyBBbmltYXRpb25Mb2FkZXIoKTtcclxuICAgICAgICAgICAgX190aGlzLkFyY2hpdmUgPSBBcmNoaXZlO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgcHVibGljIEFuaW1hdGlvbkxvYWRlcigpXHJcbiAgICAgICAge1xyXG4gICAgICAgICAgICBfZGF0YSA9IG5ldyBEaWN0aW9uYXJ5PHN0cmluZywgTGlzdDxIVE1MSW1hZ2VFbGVtZW50Pj4oKTtcclxuICAgICAgICB9XHJcbiAgICAgICAgcHVibGljIHN0YXRpYyBMaXN0PEhUTUxJbWFnZUVsZW1lbnQ+IEdldChzdHJpbmcgYW5pKVxyXG4gICAgICAgIHtcclxuICAgICAgICAgICAgcmV0dXJuIF90aGlzLkdldEFuaW1hdGlvbihhbmkpO1xyXG4gICAgICAgIH1cclxuICAgICAgICBwdWJsaWMgTGlzdDxIVE1MSW1hZ2VFbGVtZW50PiBHZXRBbmltYXRpb24oc3RyaW5nIGFuaSlcclxuICAgICAgICB7XHJcbiAgICAgICAgICAgIGlmIChfZGF0YS5Db250YWluc0tleShhbmkpKVxyXG4gICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gX2RhdGFbYW5pXTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB2YXIgQSA9IG5ldyBMaXN0PEhUTUxJbWFnZUVsZW1lbnQ+KCk7XHJcbiAgICAgICAgICAgIHZhciBJID0gQXJjaGl2ZS5HZXRJbWFnZShhbmkgKyBcIi5wbmdcIik7XHJcbiAgICAgICAgICAgIGlmIChJICE9IG51bGwpXHJcbiAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgIEEuQWRkKEkpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIGVsc2VcclxuICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgdmFyIGogPSAwO1xyXG4gICAgICAgICAgICAgICAgdmFyIFNhbmkgPSBhbmkgKyBcIl9cIjtcclxuICAgICAgICAgICAgICAgIHdoaWxlICh0cnVlKVxyXG4gICAgICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgICAgIEkgPSBBcmNoaXZlLkdldEltYWdlKFNhbmkgKyAoaisrKSArIFwiLnBuZ1wiKTtcclxuICAgICAgICAgICAgICAgICAgICBpZiAoSSA9PSBudWxsKVxyXG4gICAgICAgICAgICAgICAgICAgICAgICBicmVhaztcclxuICAgICAgICAgICAgICAgICAgICBlbHNlXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIEEuQWRkKEkpO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgLypkb1xyXG4gICAgICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgICAgIEkgPSBBcmNoaXZlLkdldEltYWdlKGFuaSArIFwiX1wiICsgaiArIFwiLnBuZ1wiKTtcclxuICAgICAgICAgICAgICAgICAgICBpZiAoSSAhPSBudWxsKVxyXG4gICAgICAgICAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgQS5BZGQoSSk7XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgfSB3aGlsZSAoSSAhPSBudWxsKTsqL1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIF9kYXRhW2FuaV0gPSBBO1xyXG4gICAgICAgICAgICByZXR1cm4gQTtcclxuICAgICAgICB9XHJcbiAgICB9XHJcbn1cclxuIiwidXNpbmcgQnJpZGdlO1xyXG51c2luZyBCcmlkZ2UuSHRtbDU7XHJcbnVzaW5nIE5ld3RvbnNvZnQuSnNvbjtcclxudXNpbmcgU3lzdGVtLkxpbnE7XHJcbnVzaW5nIFN5c3RlbTtcclxuXHJcbm5hbWVzcGFjZSBDaXJub0dhbWVcclxue1xyXG4gICAgcHVibGljIGNsYXNzIEFwcFxyXG4gICAge1xyXG4gICAgICAgIHB1YmxpYyBzdGF0aWMgaW50IEZyYW1lID0gMDtcclxuICAgICAgICBwdWJsaWMgc3RhdGljIEhUTUxEaXZFbGVtZW50IERpdjtcclxuICAgICAgICBwdWJsaWMgc3RhdGljIEhUTUxDYW52YXNFbGVtZW50IENhbnZhcztcclxuICAgICAgICAvL3B1YmxpYyBzdGF0aWMgSFRNTENhbnZhc0VsZW1lbnQgZ3VpQ2FudmFzO1xyXG4gICAgICAgIC8vcHVibGljIHN0YXRpYyBDYW52YXNSZW5kZXJpbmdDb250ZXh0MkQgZ3VpO1xyXG4gICAgICAgIHB1YmxpYyBzdGF0aWMgUmVjdGFuZ2xlIFNjcmVlbkJvdW5kcztcclxuXHJcbiAgICAgICAgcHVibGljIHN0YXRpYyBKU09OQXJjaGl2ZSBKU09OO1xyXG4gICAgICAgIHB1YmxpYyBzdGF0aWMgQ2FudmFzUmVuZGVyaW5nQ29udGV4dDJEIEc7XHJcbiAgICAgICAgcHVibGljIHN0YXRpYyBkb3VibGUgVGFyZ2V0QXNwZWN0O1xyXG5cclxuICAgICAgICBwcml2YXRlIHN0YXRpYyBkb3VibGUgX2xTaXplID0gLTE7XHJcbiAgICAgICAgcHJvdGVjdGVkIHN0YXRpYyBkb3VibGUgX21pc3NpbmdUaW1lID0gMDtcclxuICAgICAgICBwcm90ZWN0ZWQgc3RhdGljIGRvdWJsZSBfbFRpbWUgPSAtMTtcclxuICAgICAgICBwdWJsaWMgc3RhdGljIGRvdWJsZSB0b3RhbFRpbWU7XHJcblxyXG4gICAgICAgIHByb3RlY3RlZCBzdGF0aWMgYm9vbCBfZnJhbWVSZW5kZXJlZCA9IGZhbHNlO1xyXG5cclxuICAgICAgICBwcm90ZWN0ZWQgc3RhdGljIGJvb2wgX2dhbWVSZW5kZXJlZCA9IGZhbHNlO1xyXG5cclxuICAgICAgICBwdWJsaWMgc3RhdGljIElucHV0Q29udHJvbGxlciBJQztcclxuICAgICAgICBwdWJsaWMgc3RhdGljIEdhbWVTcHJpdGUgQ3VycmVudFZpZXc7XHJcblxyXG4gICAgICAgIHB1YmxpYyBzdGF0aWMgc3RyaW5nIEdhbWVOYW1lID0gXCJDaXJubydzIE15c3RlcmlvdXMgVG93ZXJcIjtcclxuICAgICAgICBwdWJsaWMgc3RhdGljIHN0cmluZyBHYW1lVmVyc2lvbiA9IFwiMC4zXCI7XHJcbiAgICAgICAgLyojaWYgREVCVUdcclxuICAgICAgICAgICAgICAgIHB1YmxpYyBzdGF0aWMgYm9vbCBERUJVRyA9IHRydWU7XHJcbiAgICAgICAgI2Vsc2VcclxuICAgICAgICAgICAgICAgIHB1YmxpYyBzdGF0aWMgYm9vbCBERUJVRyA9IGZhbHNlO1xyXG4gICAgICAgICNlbmRpZiovXHJcbiAgICAgICAgcHVibGljIHN0YXRpYyBib29sIERFQlVHID0gZmFsc2U7XHJcbiAgICAgICAgcHVibGljIHN0YXRpYyB2b2lkIE1haW4oKVxyXG4gICAgICAgIHtcclxuICAgICAgICAgICAgLy9VU0UgVEhFIEpTT04gWklQIEFSQ0hJVkUgRkVBVFVSRSBGUk9NIEJOVEVTVCBGT1IgTE9BRElORyBJTUFHRVMgQU5EIEZJTEVTLlxyXG5cclxuICAgICAgICAgICAgRG9jdW1lbnQuQm9keS5TdHlsZS5Dc3NUZXh0ID0gXCJvdmVyZmxvdzogaGlkZGVuO21hcmdpbjogMDtwYWRkaW5nOiAwO1wiO1xyXG4gICAgICAgICAgICBHYW1lUGFkTWFuYWdlci5fdGhpcyA9IG5ldyBHYW1lUGFkTWFuYWdlcigpO1xyXG4gICAgICAgICAgICBHYW1lUGFkTWFuYWdlci5fdGhpcy5VcGRhdGUoKTtcclxuICAgICAgICAgICAgR2xvYmFsLlNldFRpbWVvdXQoKGdsb2JhbDo6U3lzdGVtLkFjdGlvbikoKCkgPT4ge1xyXG4gICAgICAgICAgICAgICAgR2FtZVBhZE1hbmFnZXIuX3RoaXMuVXBkYXRlKCk7XHJcblxyXG4gICAgICAgICAgICAgICAgSUMgPSBJbnB1dENvbnRyb2xsZXJNYW5hZ2VyLl90aGlzLkNvbnRyb2xsZXJzWzBdO1xyXG4gICAgICAgICAgICAgICAgSW5wdXRNYXAgSU0gPSBJbnB1dENvbnRyb2xsZXJNYW5hZ2VyLl90aGlzLkNvbnRyb2xsZXJzWzBdLklucHV0TWFwcGluZ1syXTtcclxuXHJcbiAgICAgICAgICAgIH0pLCA1KTtcclxuXHJcbiAgICAgICAgICAgIHZhciBvayA9IGZhbHNlO1xyXG4gICAgICAgICAgICB2YXIgdXB0ZXN0ID0gdHJ1ZTtcclxuICAgICAgICAgICAgSlNPTkFyY2hpdmUuT3BlbihcIkFzc2V0cy9JbWFnZXMuSlNPTlwiLCAoZ2xvYmFsOjpTeXN0ZW0uQWN0aW9uPGdsb2JhbDo6Q2lybm9HYW1lLkpTT05BcmNoaXZlPikoanNvbiA9PlxyXG4gICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICBKU09OID0ganNvbjtcclxuXHJcbiAgICAgICAgICAgICAgICBKU09OLlByZWxvYWRJbWFnZXMoKGdsb2JhbDo6U3lzdGVtLkFjdGlvbikoKCkgPT5cclxuICAgICAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgICAgICBvayA9IHRydWU7XHJcbiAgICAgICAgICAgICAgICAgICAgRmluaXNoKCk7XHJcbiAgICAgICAgICAgICAgICB9KSk7XHJcbiAgICAgICAgICAgIH0pKTtcclxuXHJcbiAgICAgICAgICAgIC8vIEFmdGVyIGJ1aWxkaW5nIChDdHJsICsgU2hpZnQgKyBCKSB0aGlzIHByb2plY3QsIFxyXG4gICAgICAgICAgICAvLyBicm93c2UgdG8gdGhlIC9iaW4vRGVidWcgb3IgL2Jpbi9SZWxlYXNlIGZvbGRlci5cclxuXHJcbiAgICAgICAgICAgIC8vIEEgbmV3IGJyaWRnZS8gZm9sZGVyIGlzIGNyZWF0ZWQgYW5kIGNvbnRhaW5zXHJcbiAgICAgICAgICAgIC8vIHlvdXIgcHJvamVjdHMgSmF2YVNjcmlwdCBmaWxlcy4gXHJcblxyXG4gICAgICAgICAgICAvLyBPcGVuIHRoZSBicmlkZ2UvaW5kZXguaHRtbCBmaWxlIGluIGEgYnJvd2VyIGJ5XHJcbiAgICAgICAgICAgIC8vIFJpZ2h0LUNsaWNrID4gT3BlbiBXaXRoLi4uLCB0aGVuIGNob29zZSBhXHJcbiAgICAgICAgICAgIC8vIHdlYiBicm93c2VyIGZyb20gdGhlIGxpc3RcclxuXHJcbiAgICAgICAgICAgIC8vIFRoaXMgYXBwbGljYXRpb24gd2lsbCB0aGVuIHJ1biBpbiBhIGJyb3dzZXIuXHJcblxyXG5cclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIHB1YmxpYyBzdGF0aWMgdm9pZCBGaW5pc2goKVxyXG4gICAgICAgIHtcclxuICAgICAgICAgICAgQW5pbWF0aW9uTG9hZGVyLkluaXQoSlNPTik7XHJcbiAgICAgICAgICAgIHZhciBMVCA9IERvY3VtZW50LkdldEVsZW1lbnRCeUlkKFwibG9hZHRleHRcIikuQXM8SFRNTFBhcmFncmFwaEVsZW1lbnQ+KCk7XHJcbiAgICAgICAgICAgIExULlRleHRDb250ZW50ID0gXCJcIjtcclxuICAgICAgICAgICAgRG9jdW1lbnQuQm9keS5TdHlsZS5DdXJzb3IgPSBDdXJzb3IuQXV0bztcclxuICAgICAgICAgICAgRG9jdW1lbnQuVGl0bGUgPSBHYW1lTmFtZSArIFwiIFwiICsgR2FtZVZlcnNpb24gKyBcIiBieTpSU0dtYWtlclwiO1xyXG4gICAgICAgICAgICAvL3ZhciBSID0gbmV3IFJlbmRlcmVyKCk7XHJcbiAgICAgICAgICAgIC8vRG9jdW1lbnQuQm9keS5BcHBlbmRDaGlsZChSLnZpZXcpO1xyXG5cclxuICAgICAgICAgICAgRGl2ID0gbmV3IEhUTUxEaXZFbGVtZW50KCk7XHJcbiAgICAgICAgICAgIEhUTUxDYW52YXNFbGVtZW50IENhbnYgPSBuZXcgSFRNTENhbnZhc0VsZW1lbnQoKTtcclxuICAgICAgICAgICAgQ2FudmFzID0gQ2FudjtcclxuICAgICAgICAgICAgVGFyZ2V0QXNwZWN0ID0gMC43NTtcclxuICAgICAgICAgICAgQ2Fudi5XaWR0aCA9IDEwMjQ7XHJcbiAgICAgICAgICAgIENhbnYuSGVpZ2h0ID0gKGludCkoQ2Fudi5XaWR0aCAqIFRhcmdldEFzcGVjdCk7XHJcbiAgICAgICAgICAgIFNjcmVlbkJvdW5kcyA9IG5ldyBSZWN0YW5nbGUoMCwgMCwgQ2Fudi5XaWR0aCwgQ2Fudi5IZWlnaHQpO1xyXG5cclxuICAgICAgICAgICAgRGl2LkFwcGVuZENoaWxkKENhbnYpO1xyXG4gICAgICAgICAgICBEb2N1bWVudC5Cb2R5LkFwcGVuZENoaWxkKERpdik7XHJcbiAgICAgICAgICAgIC8vRG9jdW1lbnQuQm9keS5BcHBlbmRDaGlsZChDYW52KTtcclxuICAgICAgICAgICAgRyA9IENhbnZhcy5HZXRDb250ZXh0KENhbnZhc1R5cGVzLkNhbnZhc0NvbnRleHQyRFR5cGUuQ2FudmFzUmVuZGVyaW5nQ29udGV4dDJEKTtcclxuXHJcbiAgICAgICAgICAgIEcuSW1hZ2VTbW9vdGhpbmdFbmFibGVkID0gZmFsc2U7XHJcbiAgICAgICAgICAgIENhbnZhcy5TdHlsZS5JbWFnZVJlbmRlcmluZyA9IEltYWdlUmVuZGVyaW5nLlBpeGVsYXRlZDtcclxuICAgICAgICAgICAgdmFyIGdnID0gRztcclxuICAgICAgICAgICAgU2NyaXB0LldyaXRlKFwiZ2cud2Via2l0SW1hZ2VTbW9vdGhpbmdFbmFibGVkID0gZmFsc2VcIik7XHJcbiAgICAgICAgICAgIFNjcmlwdC5Xcml0ZShcImdnLm1vekltYWdlU21vb3RoaW5nRW5hYmxlZCA9IGZhbHNlXCIpO1xyXG5cclxuXHJcbiAgICAgICAgICAgIEtleWJvYXJkTWFuYWdlci5Jbml0KCk7XHJcblxyXG4gICAgICAgICAgICBDdXJyZW50VmlldyA9IG5ldyBHYW1lKCk7XHJcblxyXG4gICAgICAgICAgICBBY3Rpb24gT25GID0gUkFGO1xyXG4gICAgICAgICAgICBTY3JpcHQuV3JpdGUoXCJyZXF1ZXN0QW5pbWF0aW9uRnJhbWUoT25GKTtcIik7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBwcml2YXRlIHN0YXRpYyB2b2lkIHVwZGF0ZVdpbmRvdygpXHJcbiAgICAgICAge1xyXG4gICAgICAgICAgICBkb3VibGUgc2l6ZSA9IE1hdGguQ2VpbGluZyhXaW5kb3cuSW5uZXJIZWlnaHQgKiAoMSAvIFRhcmdldEFzcGVjdCkpO1xyXG4gICAgICAgICAgICBpZiAoc2l6ZSAhPSBfbFNpemUpXHJcbiAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgIENhbnZhcy5TdHlsZS5XaWR0aCA9IFwiMTAwJVwiO1xyXG4gICAgICAgICAgICAgICAgRGl2LlN0eWxlLldpZHRoID0gc2l6ZSArIFwicHhcIjtcclxuXHJcbiAgICAgICAgICAgICAgICBEaXYuU3R5bGUuUG9zaXRpb24gPSBQb3NpdGlvbi5SZWxhdGl2ZTtcclxuICAgICAgICAgICAgICAgIERpdi5TdHlsZS5MZWZ0ID0gKChXaW5kb3cuSW5uZXJXaWR0aCAvIDIpIC0gKHNpemUgLyAyKSkgKyBcInB4XCI7XHJcbiAgICAgICAgICAgICAgICBzaXplID0gX2xTaXplO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHByb3RlY3RlZCBzdGF0aWMgdm9pZCBVcGRhdGVJbnB1dHMoKVxyXG4gICAgICAgIHtcclxuICAgICAgICAgICAgaWYgKElDICE9IG51bGwpXHJcbiAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgIHZhciBMID0gSW5wdXRDb250cm9sbGVyTWFuYWdlci5fdGhpcy5Db250cm9sbGVycztcclxuICAgICAgICAgICAgICAgIGlmIChMLkNvdW50ID4gMSlcclxuICAgICAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgICAgICAvKkxpc3Q8aW50PiBrZXlzID0gS2V5Ym9hcmRNYW5hZ2VyLl90aGlzLlRhcHBlZEJ1dHRvbnM7XHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKGtleXMuQ29udGFpbnMoMTA3KSlcclxuICAgICAgICAgICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGludCBpbmRleCA9IEwuSW5kZXhPZihJQyk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGluZGV4Kys7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChpbmRleCA+PSBMLkNvdW50KVxyXG4gICAgICAgICAgICAgICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpbmRleCAtPSBMLkNvdW50O1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIElDID0gTFtpbmRleF07XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgIGlmIChrZXlzLkNvbnRhaW5zKDEwOSkpXHJcbiAgICAgICAgICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBpbnQgaW5kZXggPSBMLkluZGV4T2YoSUMpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBpbmRleC0tO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAoaW5kZXggPCAwKVxyXG4gICAgICAgICAgICAgICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpbmRleCArPSBMLkNvdW50O1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIElDID0gTFtpbmRleF07XHJcbiAgICAgICAgICAgICAgICAgICAgfSovXHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgS2V5Ym9hcmRNYW5hZ2VyLlVwZGF0ZSgpO1xyXG4gICAgICAgIH1cclxuICAgICAgICBwcm90ZWN0ZWQgc3RhdGljIHZvaWQgVXBkYXRlKGRvdWJsZSB0aW1lKVxyXG4gICAgICAgIHtcclxuICAgICAgICAgICAgZG91YmxlIGRlbHRhID0gMDtcclxuICAgICAgICAgICAgdG90YWxUaW1lID0gdGltZTtcclxuICAgICAgICAgICAgaWYgKHRpbWUgPj0gMClcclxuICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgaWYgKF9sVGltZSA8IDApXHJcbiAgICAgICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICAgICAgX2xUaW1lID0gdGltZTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIGVsc2VcclxuICAgICAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgICAgICAvL21pc3NpbmdUaW1lIC09IDE2LjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NztcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIGRlbHRhID0gKHRpbWUgLSBfbFRpbWUpO1xyXG4gICAgICAgICAgICAgICAgX21pc3NpbmdUaW1lICs9IChkZWx0YSk7XHJcbiAgICAgICAgICAgICAgICBpZiAoQ3VycmVudFZpZXcgaXMgR2FtZSlcclxuICAgICAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgICAgICB2YXIgRyA9IChHYW1lKUN1cnJlbnRWaWV3O1xyXG4gICAgICAgICAgICAgICAgICAgIGlmIChHLnJ1bm5pbmcpXHJcbiAgICAgICAgICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBHLnRvdGFsVGltZSArPSAoZmxvYXQpZGVsdGE7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChHLnRpbWVSZW1haW5pbmcgPiAwKVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgRy50aW1lUmVtYWluaW5nIC09IChmbG9hdClkZWx0YTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKEcudGltZVJlbWFpbmluZyA8PSAwKVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgRy50aW1lUmVtYWluaW5nID0gMDtcclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgdXBkYXRlV2luZG93KCk7XHJcbiAgICAgICAgICAgIC8qaWYgKGRlbHRhID4gMjIpXHJcbiAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgIExhZ2dpbmcgPSB0cnVlO1xyXG4gICAgICAgICAgICB9Ki9cclxuXHJcbiAgICAgICAgICAgIGlmICgvKnVzZVJBRiB8fCAqL19taXNzaW5nVGltZSA+IDEyLyogfHwgKF9mcmFtZVJlbmRlcmVkICYmIF9taXNzaW5nVGltZSA+IDApKi8pXHJcbiAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgIGlmIChDdXJyZW50VmlldyAhPSBudWxsKVxyXG4gICAgICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgICAgIEN1cnJlbnRWaWV3LlVwZGF0ZSgpO1xyXG4gICAgICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgICAgIF9taXNzaW5nVGltZSAtPSAxNi42NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2Njc7XHJcbiAgICAgICAgICAgICAgICBfZnJhbWVSZW5kZXJlZCA9IGZhbHNlO1xyXG4gICAgICAgICAgICAgICAgX2dhbWVSZW5kZXJlZCA9IGZhbHNlO1xyXG5cclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBlbHNlXHJcbiAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgIF9sVGltZSA9IHRpbWU7XHJcbiAgICAgICAgICAgICAgICByZXR1cm47XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgaWYgKHRpbWUgPj0gMClcclxuICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgaWYgKF9taXNzaW5nVGltZSA+PSAzMDAwKVxyXG4gICAgICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgICAgIF9taXNzaW5nVGltZSA9IDA7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICBpZiAoX21pc3NpbmdUaW1lID49IDEwMDAwKVxyXG4gICAgICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgICAgIC8vR2FtZSBpcyBsYWdnaW5nIHRvbyBtdWNoIHRvIHByb3Blcmx5IHBsYXkgbXVsdGlwbGF5ZXIuXHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICBkb3VibGUgVCA9IDE2LjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NztcclxuICAgICAgICAgICAgICAgIGlmICh0cnVlKVxyXG4gICAgICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgICAgIFQgKz0gODtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIHdoaWxlIChfbWlzc2luZ1RpbWUgPj0gVClcclxuICAgICAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgICAgICBpZiAoQ3VycmVudFZpZXcgIT0gbnVsbClcclxuICAgICAgICAgICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIEN1cnJlbnRWaWV3LlVwZGF0ZSgpO1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICBfbWlzc2luZ1RpbWUgLT0gMTYuNjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY3O1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIC8vL2dhbWUuUmVuZGVyKCk7XHJcbiAgICAgICAgICAgIC8vZ2FtZS5EcmF3KGcpO1xyXG4gICAgICAgICAgICBfbFRpbWUgPSB0aW1lO1xyXG4gICAgICAgICAgICBGcmFtZSsrO1xyXG4gICAgICAgICAgICBHLkNsZWFyKCk7XHJcbiAgICAgICAgICAgIEdhbWVQYWRNYW5hZ2VyLl90aGlzLlVwZGF0ZSgpO1xyXG4gICAgICAgICAgICBpZiAoQ3VycmVudFZpZXcgIT0gbnVsbClcclxuICAgICAgICAgICAge1xyXG5cclxuICAgICAgICAgICAgICAgIEN1cnJlbnRWaWV3LlVwZGF0ZSgpO1xyXG4gICAgICAgICAgICAgICAgQ3VycmVudFZpZXcuUmVuZGVyKCk7XHJcbiAgICAgICAgICAgICAgICBHLkRyYXdJbWFnZShDdXJyZW50Vmlldy5zcHJpdGVCdWZmZXIsIDBmLCAwZiwgQ2FudmFzLldpZHRoLCBDYW52YXMuSGVpZ2h0KTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAvL0cuRmlsbFN0eWxlID0gXCJcIitDb252ZXJ0LiBGcmFtZTtcclxuICAgICAgICAgICAgLy9HLkZpbGxTdHlsZSA9IFwiI1wiICsgRnJhbWUuVG9TdHJpbmcoXCJYNlwiKTtcclxuICAgICAgICAgICAgLypHLkZpbGxTdHlsZSA9IFwiI1wiICsgQ29sb3JGcm9tQWhzYigxLChGcmFtZS8yKSAlIDM2MCwwLjhmLDAuN2YpLlRvU3RyaW5nKFwiWDZcIik7XHJcbiAgICAgICAgICAgIEcuRmlsbFJlY3QoMCwgMCwgRy5DYW52YXMuV2lkdGgsIEcuQ2FudmFzLkhlaWdodCk7XHJcblxyXG4gICAgICAgICAgICBHLkZpbGxTdHlsZSA9IFwicmVkXCI7XHJcbiAgICAgICAgICAgIHZhciB4ID0gKCgwICsgRnJhbWUgKiAzKSAlIChHLkNhbnZhcy5XaWR0aCArIDEwMCkpIC0gMTAwO1xyXG4gICAgICAgICAgICB2YXIgeSA9ICgoMCArIEZyYW1lKSAlIChHLkNhbnZhcy5IZWlnaHQgKyAxMDApKSAtIDEwMDtcclxuICAgICAgICAgICAgLy9HLkZpbGxSZWN0KHgsIHksIDEwMCwgMTAwKTtcclxuXHJcbiAgICAgICAgICAgIHZhciBWID0gSlNPTi5JbWFnZXMuVmFsdWVzLlRvQXJyYXkoKTtcclxuXHJcbiAgICAgICAgICAgIHZhciBpbWcgPSBWWyhGcmFtZS8xMCkgJSBWLkxlbmd0aF07XHJcbiAgICAgICAgICAgIEcuRHJhd0ltYWdlKGltZywgeCwgeSxpbWcuV2lkdGgqNCxpbWcuSGVpZ2h0ICogNCk7Ki9cclxuICAgICAgICAgICAgVXBkYXRlSW5wdXRzKCk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHByaXZhdGUgc3RhdGljIHZvaWQgUkFGKClcclxuICAgICAgICB7XHJcblxyXG4gICAgICAgICAgICBBY3Rpb24gT25GID0gUkFGO1xyXG4gICAgICAgICAgICBTY3JpcHQuV3JpdGUoXCJyZXF1ZXN0QW5pbWF0aW9uRnJhbWUoT25GKTtcIik7XHJcbiAgICAgICAgICAgIGRvdWJsZSB0aW1lID0gR2xvYmFsLlBlcmZvcm1hbmNlLk5vdygpO1xyXG4gICAgICAgICAgICBVcGRhdGUodGltZSk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHB1YmxpYyBzdGF0aWMgaW50IENvbG9yRnJvbUFoc2IoaW50IGEsIGZsb2F0IGgsIGZsb2F0IHMsIGZsb2F0IGIpXHJcbiAgICAgICAge1xyXG5cclxuICAgICAgICAgICAgLyppZiAoMCA+IGEgfHwgMjU1IDwgYSlcclxuICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgdGhyb3cgbmV3IEFyZ3VtZW50T3V0T2ZSYW5nZUV4Y2VwdGlvbihcImFcIiwgYSxcclxuICAgICAgICAgICAgICAgICAgUHJvcGVydGllcy5SZXNvdXJjZXMuSW52YWxpZEFscGhhKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBpZiAoMGYgPiBoIHx8IDM2MGYgPCBoKVxyXG4gICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICB0aHJvdyBuZXcgQXJndW1lbnRPdXRPZlJhbmdlRXhjZXB0aW9uKFwiaFwiLCBoLFxyXG4gICAgICAgICAgICAgICAgICBQcm9wZXJ0aWVzLlJlc291cmNlcy5JbnZhbGlkSHVlKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBpZiAoMGYgPiBzIHx8IDFmIDwgcylcclxuICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgdGhyb3cgbmV3IEFyZ3VtZW50T3V0T2ZSYW5nZUV4Y2VwdGlvbihcInNcIiwgcyxcclxuICAgICAgICAgICAgICAgICAgUHJvcGVydGllcy5SZXNvdXJjZXMuSW52YWxpZFNhdHVyYXRpb24pO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIGlmICgwZiA+IGIgfHwgMWYgPCBiKVxyXG4gICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICB0aHJvdyBuZXcgQXJndW1lbnRPdXRPZlJhbmdlRXhjZXB0aW9uKFwiYlwiLCBiLFxyXG4gICAgICAgICAgICAgICAgICBQcm9wZXJ0aWVzLlJlc291cmNlcy5JbnZhbGlkQnJpZ2h0bmVzcyk7XHJcbiAgICAgICAgICAgIH0qL1xyXG5cclxuICAgICAgICAgICAgaWYgKDAgPT0gcylcclxuICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgLy9yZXR1cm4gQ3JlYXRlU2hhZGUoYiAvIDI1NS4wKTtcclxuICAgICAgICAgICAgICAgIC8vcmV0dXJuIDB4ODA4MDgwO1xyXG4gICAgICAgICAgICAgICAgdmFyIHNoYWRlID0gKGludCkoYiAvIDI1NS4wKTtcclxuICAgICAgICAgICAgICAgIHJldHVybiBSR0JUb0ludChzaGFkZSwgc2hhZGUsIHNoYWRlKTtcclxuICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgZmxvYXQgZk1heCwgZk1pZCwgZk1pbjtcclxuICAgICAgICAgICAgaW50IGlTZXh0YW50LCBpTWF4LCBpTWlkLCBpTWluO1xyXG5cclxuICAgICAgICAgICAgaWYgKDAuNSA8IGIpXHJcbiAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgIGZNYXggPSBiIC0gKGIgKiBzKSArIHM7XHJcbiAgICAgICAgICAgICAgICBmTWluID0gYiArIChiICogcykgLSBzO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIGVsc2VcclxuICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgZk1heCA9IGIgKyAoYiAqIHMpO1xyXG4gICAgICAgICAgICAgICAgZk1pbiA9IGIgLSAoYiAqIHMpO1xyXG4gICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICBpU2V4dGFudCA9IChpbnQpTWF0aC5GbG9vcihoIC8gNjBmKTtcclxuICAgICAgICAgICAgaWYgKDMwMGYgPD0gaClcclxuICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgaCAtPSAzNjBmO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIGggLz0gNjBmO1xyXG4gICAgICAgICAgICBoIC09IDJmICogKGZsb2F0KU1hdGguRmxvb3IoKChpU2V4dGFudCArIDFmKSAlIDZmKSAvIDJmKTtcclxuICAgICAgICAgICAgaWYgKDAgPT0gaVNleHRhbnQgJSAyKVxyXG4gICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICBmTWlkID0gaCAqIChmTWF4IC0gZk1pbikgKyBmTWluO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIGVsc2VcclxuICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgZk1pZCA9IGZNaW4gLSBoICogKGZNYXggLSBmTWluKTtcclxuICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgaU1heCA9IENvbnZlcnQuVG9JbnQzMihmTWF4ICogMjU1KTtcclxuICAgICAgICAgICAgaU1pZCA9IENvbnZlcnQuVG9JbnQzMihmTWlkICogMjU1KTtcclxuICAgICAgICAgICAgaU1pbiA9IENvbnZlcnQuVG9JbnQzMihmTWluICogMjU1KTtcclxuXHJcbiAgICAgICAgICAgIHN3aXRjaCAoaVNleHRhbnQpXHJcbiAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgIGNhc2UgMTpcclxuICAgICAgICAgICAgICAgICAgICByZXR1cm4gUkdCVG9JbnQoaU1pZCwgaU1heCwgaU1pbik7XHJcbiAgICAgICAgICAgICAgICBjYXNlIDI6XHJcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIFJHQlRvSW50KGlNaW4sIGlNYXgsIGlNaWQpO1xyXG4gICAgICAgICAgICAgICAgY2FzZSAzOlxyXG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBSR0JUb0ludChpTWluLCBpTWlkLCBpTWF4KTtcclxuICAgICAgICAgICAgICAgIGNhc2UgNDpcclxuICAgICAgICAgICAgICAgICAgICByZXR1cm4gUkdCVG9JbnQoaU1pZCwgaU1pbiwgaU1heCk7XHJcbiAgICAgICAgICAgICAgICBjYXNlIDU6XHJcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIFJHQlRvSW50KGlNYXgsIGlNaW4sIGlNaWQpO1xyXG4gICAgICAgICAgICAgICAgZGVmYXVsdDpcclxuICAgICAgICAgICAgICAgICAgICByZXR1cm4gUkdCVG9JbnQoaU1heCwgaU1pZCwgaU1pbik7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcbiAgICAgICAgcHVibGljIHN0YXRpYyBpbnQgUkdCVG9JbnQoaW50IFIsIGludCBHLCBpbnQgQilcclxuICAgICAgICB7XHJcbiAgICAgICAgICAgIHJldHVybiBSICsgKEcgPDwgOCkgKyAoQiA8PCAxNik7XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG59IiwidXNpbmcgU3lzdGVtO1xyXG51c2luZyBTeXN0ZW0uQ29sbGVjdGlvbnMuR2VuZXJpYztcclxudXNpbmcgU3lzdGVtLkxpbnE7XHJcbnVzaW5nIFN5c3RlbS5UZXh0O1xyXG51c2luZyBTeXN0ZW0uVGhyZWFkaW5nLlRhc2tzO1xyXG51c2luZyBCcmlkZ2U7XHJcbnVzaW5nIEJyaWRnZS5IdG1sNTtcclxuXHJcbm5hbWVzcGFjZSBDaXJub0dhbWVcclxue1xyXG4gICAgcHVibGljIGNsYXNzIEF1ZGlvXHJcbiAgICB7XHJcbiAgICAgICAgcHJvdGVjdGVkIEF1ZGlvTWFuYWdlciBfQU07XHJcbiAgICAgICAgcHJvdGVjdGVkIEhUTUxBdWRpb0VsZW1lbnQgX2F1ZGlvO1xyXG4gICAgICAgIHByb3RlY3RlZCBib29sIF9oYXNQbGF5ZWQ7XHJcbiAgICAgICAgcHVibGljIHN0cmluZyBJRCB7IGdldDsgcHJvdGVjdGVkIHNldDsgfVxyXG4gICAgICAgIHByb3RlY3RlZCBMaXN0PEhUTUxBdWRpb0VsZW1lbnQ+IF9ibGFzdDtcclxuICAgICAgICBwdWJsaWMgZG91YmxlIGxhc3RwbGF5ZWQgPSBkb3VibGUuTmVnYXRpdmVJbmZpbml0eTtcclxuICAgICAgICBwdWJsaWMgYm9vbCBJc1BsYXlpbmdcclxuICAgICAgICB7XHJcbiAgICAgICAgICAgIGdldFxyXG4gICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gISghX2hhc1BsYXllZCB8fCBfYXVkaW8uUGF1c2VkIHx8IF9hdWRpby5DdXJyZW50VGltZSA9PSAwLjApO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIHNldFxyXG4gICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICBpZiAodmFsdWUpXHJcbiAgICAgICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICAgICAgUGxheSgpO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgZWxzZVxyXG4gICAgICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgICAgIFBhdXNlKCk7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcbiAgICAgICAgcHJvdGVjdGVkIGJvb2wgX2xvb3A7XHJcbiAgICAgICAgcHVibGljIGJvb2wgTG9vcFxyXG4gICAgICAgIHtcclxuICAgICAgICAgICAgZ2V0XHJcbiAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgIC8vcmV0dXJuIF9hdWRpby5Mb29wO1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuIF9sb29wO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIHNldFxyXG4gICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICAvL19hdWRpby5Mb29wID0gdmFsdWU7XHJcbiAgICAgICAgICAgICAgICBfbG9vcCA9IHZhbHVlO1xyXG4gICAgICAgICAgICAgICAgLy9fYXVkaW8uTG9vcCA9IHZhbHVlO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHB1YmxpYyBkb3VibGUgQ3VycmVudFRpbWVcclxuICAgICAgICB7XHJcbiAgICAgICAgICAgIGdldFxyXG4gICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gX2F1ZGlvLkN1cnJlbnRUaW1lO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIHNldFxyXG4gICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICBfYXVkaW8uQ3VycmVudFRpbWUgPSB2YWx1ZTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuICAgICAgICBwdWJsaWMgZG91YmxlIFZvbHVtZVxyXG4gICAgICAgIHtcclxuICAgICAgICAgICAgZ2V0XHJcbiAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgIHJldHVybiBfYXVkaW8uVm9sdW1lO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIHNldFxyXG4gICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICBfYXVkaW8uVm9sdW1lID0gdmFsdWU7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcbiAgICAgICAgcHVibGljIGJvb2wgUGxheSgpXHJcbiAgICAgICAge1xyXG4gICAgICAgICAgICBpZiAoIUlzUGxheWluZylcclxuICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgbGFzdHRpbWUgPSBDdXJyZW50VGltZTtcclxuICAgICAgICAgICAgICAgIF9hdWRpby5QbGF5KCk7XHJcbiAgICAgICAgICAgICAgICBfaGFzUGxheWVkID0gdHJ1ZTtcclxuICAgICAgICAgICAgICAgIHJldHVybiB0cnVlO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIHJldHVybiBmYWxzZTtcclxuICAgICAgICB9XHJcbiAgICAgICAgcHVibGljIGJvb2wgUGF1c2UoKVxyXG4gICAgICAgIHtcclxuICAgICAgICAgICAgaWYgKElzUGxheWluZylcclxuICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgX2F1ZGlvLlBhdXNlKCk7XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gdHJ1ZTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICByZXR1cm4gZmFsc2U7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHB1YmxpYyBib29sIFN0b3AoKVxyXG4gICAgICAgIHtcclxuICAgICAgICAgICAgaWYgKElzUGxheWluZylcclxuICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgX2F1ZGlvLlBhdXNlKCk7XHJcbiAgICAgICAgICAgICAgICBfYXVkaW8uQ3VycmVudFRpbWUgPSAwO1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuIHRydWU7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xyXG4gICAgICAgIH1cclxuICAgICAgICBwdWJsaWMgQWN0aW9uPEF1ZGlvPiBPblBsYXk7XHJcbiAgICAgICAgcHVibGljIEFjdGlvbjxBdWRpbz4gT25TdG9wO1xyXG4gICAgICAgIHB1YmxpYyBBdWRpbyhIVE1MQXVkaW9FbGVtZW50IGF1ZGlvLCBzdHJpbmcgSUQsIEF1ZGlvTWFuYWdlciBBdWRpb01hbmFnZXIpXHJcbiAgICAgICAge1xyXG4gICAgICAgICAgICBfYXVkaW8gPSBhdWRpbztcclxuICAgICAgICAgICAgdGhpcy5JRCA9IElEO1xyXG4gICAgICAgICAgICB2YXIgc2VsZiA9IHRoaXM7XHJcbiAgICAgICAgICAgIF9BTSA9IEF1ZGlvTWFuYWdlcjtcclxuICAgICAgICAgICAgLy9vYmplY3QgQSA9ICgoKSA9PiBzZWxmLl9PblBsYXkpO1xyXG4gICAgICAgICAgICAvL0FjdGlvbiBBID0gbmV3IEFjdGlvbigoKSA9PiBzZWxmLl9PblBsYXkoKSk7XHJcblxyXG4gICAgICAgICAgICBfYXVkaW8uT25QbGF5ID0gbmV3IEFjdGlvbigoKSA9PiBzZWxmLl9PblBsYXkoKSkuVG9EeW5hbWljKCk7XHJcbiAgICAgICAgICAgIF9hdWRpby5PblBhdXNlID0gbmV3IEFjdGlvbigoKSA9PiBzZWxmLl9PblN0b3AoKSkuVG9EeW5hbWljKCk7XHJcbiAgICAgICAgICAgIC8vX2F1ZGlvLk9uRW5kZWQgPSBuZXcgQWN0aW9uKCgpID0+IHNlbGYuX09uU3RvcCgpKS5Ub0R5bmFtaWMoKTtcclxuICAgICAgICAgICAgX2F1ZGlvLk9uRW5kZWQgPSBuZXcgQWN0aW9uKCgpID0+IHNlbGYuX09uRW5kKCkpLlRvRHluYW1pYygpO1xyXG4gICAgICAgICAgICBfYXVkaW8uT25UaW1lVXBkYXRlID0gbmV3IEFjdGlvbigoKSA9PiBzZWxmLl9PblVwZGF0ZSgpKS5Ub0R5bmFtaWMoKTtcclxuXHJcbiAgICAgICAgICAgIF9ibGFzdCA9IG5ldyBMaXN0PEhUTUxBdWRpb0VsZW1lbnQ+KCk7XHJcbiAgICAgICAgICAgIGludCBtYXh2b2ljZXMgPSA2O1xyXG4gICAgICAgICAgICBpbnQgdm9pY2VzID0gMTtcclxuICAgICAgICAgICAgd2hpbGUgKHZvaWNlcyA8IG1heHZvaWNlcylcclxuICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgX2JsYXN0LkFkZCgoSFRNTEF1ZGlvRWxlbWVudClfYXVkaW8uQ2xvbmVOb2RlKCkpO1xyXG4gICAgICAgICAgICAgICAgdm9pY2VzICs9IDE7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgLypfYmxhc3QuQWRkKChBdWRpb0VsZW1lbnQpX2F1ZGlvLkNsb25lTm9kZSgpKTtcclxuICAgICAgICAgICAgX2JsYXN0LkFkZCgoQXVkaW9FbGVtZW50KV9hdWRpby5DbG9uZU5vZGUoKSk7XHJcbiAgICAgICAgICAgIF9ibGFzdC5BZGQoKEF1ZGlvRWxlbWVudClfYXVkaW8uQ2xvbmVOb2RlKCkpO1xyXG4gICAgICAgICAgICBfYmxhc3QuQWRkKChBdWRpb0VsZW1lbnQpX2F1ZGlvLkNsb25lTm9kZSgpKTsqL1xyXG4gICAgICAgICAgICAvKl9hdWRpby5PblBsYXkgPSBcInNlbGYuX09uUGxheSgpXCIuVG9EeW5hbWljKCk7XHJcbiAgICAgICAgICAgIF9hdWRpby5PblBhdXNlID0gXCJzZWxmLl9PblN0b3AoKVwiLlRvRHluYW1pYygpO1xyXG4gICAgICAgICAgICBfYXVkaW8uT25FbmRlZCA9IFwic2VsZi5fT25TdG9wKClcIi5Ub0R5bmFtaWMoKTsqL1xyXG4gICAgICAgIH1cclxuXHJcblxyXG4gICAgICAgIHB1YmxpYyB2b2lkIEJsYXN0KGZsb2F0IHZvbHVtZSA9IDFmKVxyXG4gICAgICAgIHtcclxuICAgICAgICAgICAgdmFyIFQgPSBBcHAudG90YWxUaW1lO1xyXG4gICAgICAgICAgICBpZiAoVCAtIGxhc3R0aW1lIDwgMTUwKVxyXG4gICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICByZXR1cm47Ly9wcmV2ZW50IGF1ZGlvIHNwYW0uXHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgaWYgKCFJc1BsYXlpbmcpXHJcbiAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgIFZvbHVtZSA9IHZvbHVtZTtcclxuICAgICAgICAgICAgICAgIFBsYXkoKTtcclxuICAgICAgICAgICAgICAgIGxhc3R0aW1lID0gVDtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBlbHNlXHJcbiAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgIC8vKChBdWRpb0VsZW1lbnQpX2F1ZGlvLkNsb25lTm9kZSgpKS5QbGF5KCk7XHJcbiAgICAgICAgICAgICAgICBpbnQgaSA9IDA7XHJcbiAgICAgICAgICAgICAgICB3aGlsZSAoaSA8IF9ibGFzdC5Db3VudClcclxuICAgICAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgICAgICBIVE1MQXVkaW9FbGVtZW50IEEgPSBfYmxhc3RbaV07XHJcbiAgICAgICAgICAgICAgICAgICAgLy9pZiAoQS5QYXVzZWQgfHwgQS5DdXJyZW50VGltZTwwLjE1ZiB8fCBBLlBsYXllZC5MZW5ndGg9PTApXHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKEEuUGF1c2VkIHx8IEEuQ3VycmVudFRpbWUgPCAwLjEwZiB8fCBBLlBsYXllZC5MZW5ndGggPT0gMClcclxuICAgICAgICAgICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChBLlBhdXNlZCB8fCBBLkN1cnJlbnRUaW1lID09IDAuMCB8fCBBLlBsYXllZC5MZW5ndGggPT0gMClcclxuICAgICAgICAgICAgICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgQS5Wb2x1bWUgPSB2b2x1bWU7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBBLlBsYXkoKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGkgPSBfYmxhc3QuQ291bnQ7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBsYXN0dGltZSA9IFQ7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgaSsrO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG5cclxuXHJcbiAgICAgICAgcHJvdGVjdGVkIHZvaWQgX09uUGxheSgpXHJcbiAgICAgICAge1xyXG4gICAgICAgICAgICBfQU0uT25QbGF5KHRoaXMpO1xyXG4gICAgICAgICAgICBpZiAoT25QbGF5LlRvRHluYW1pYygpKVxyXG4gICAgICAgICAgICAgICAgT25QbGF5KHRoaXMpO1xyXG4gICAgICAgIH1cclxuICAgICAgICBwcm90ZWN0ZWQgdm9pZCBfT25TdG9wKClcclxuICAgICAgICB7XHJcbiAgICAgICAgICAgIF9BTS5PblN0b3AodGhpcyk7XHJcbiAgICAgICAgICAgIGlmIChPblN0b3AuVG9EeW5hbWljKCkpXHJcbiAgICAgICAgICAgICAgICBPblN0b3AodGhpcyk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHByb3RlY3RlZCB2b2lkIF9PbkVuZCgpXHJcbiAgICAgICAge1xyXG4gICAgICAgICAgICAvKmlmIChfbG9vcClcclxuICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgQ3VycmVudFRpbWUgPSAwO1xyXG4gICAgICAgICAgICAgICAgUGxheSgpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIGVsc2UqL1xyXG4gICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICBfT25TdG9wKCk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcbiAgICAgICAgcHJvdGVjdGVkIGRvdWJsZSBsYXN0dGltZSA9IDA7XHJcbiAgICAgICAgcHJvdGVjdGVkIHZvaWQgX09uVXBkYXRlKClcclxuICAgICAgICB7XHJcbiAgICAgICAgICAgIGlmIChfbG9vcClcclxuICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgLy9pZiAoKEN1cnJlbnRUaW1lKzAuMzUpID49IF9hdWRpby5EdXJhdGlvbilcclxuICAgICAgICAgICAgICAgIGlmICgoQ3VycmVudFRpbWUgKyAoKEN1cnJlbnRUaW1lIC0gbGFzdHRpbWUpICogMC44KSkgPj0gX2F1ZGlvLkR1cmF0aW9uKVxyXG4gICAgICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgICAgIEN1cnJlbnRUaW1lID0gMDtcclxuICAgICAgICAgICAgICAgICAgICBQbGF5KCk7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICBsYXN0dGltZSA9IEN1cnJlbnRUaW1lO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG59XHJcbiIsInVzaW5nIFN5c3RlbTtcclxudXNpbmcgU3lzdGVtLkNvbGxlY3Rpb25zLkdlbmVyaWM7XHJcbnVzaW5nIFN5c3RlbS5MaW5xO1xyXG51c2luZyBTeXN0ZW0uVGV4dDtcclxudXNpbmcgU3lzdGVtLlRocmVhZGluZy5UYXNrcztcclxudXNpbmcgQnJpZGdlO1xyXG51c2luZyBCcmlkZ2UuSHRtbDU7XHJcblxyXG5uYW1lc3BhY2UgQ2lybm9HYW1lXHJcbntcclxuICAgIHB1YmxpYyBjbGFzcyBBdWRpb01hbmFnZXJcclxuICAgIHtcclxuICAgICAgICBwcm90ZWN0ZWQgRGljdGlvbmFyeTxzdHJpbmcsIEF1ZGlvPiBkYXRhO1xyXG4gICAgICAgIHByb3RlY3RlZCBMaXN0PEF1ZGlvPiBwbGF5aW5nO1xyXG4gICAgICAgIHB1YmxpYyBzdGF0aWMgc3RyaW5nIERpcmVjdG9yeSA9IFwiXCI7XHJcbiAgICAgICAgcHVibGljIHN0YXRpYyBBdWRpb01hbmFnZXIgX190aGlzO1xyXG4gICAgICAgIHB1YmxpYyBzdGF0aWMgQXVkaW9NYW5hZ2VyIF90aGlzXHJcbiAgICAgICAge1xyXG4gICAgICAgICAgICBnZXRcclxuICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgaWYgKF9fdGhpcyA9PSBudWxsKVxyXG4gICAgICAgICAgICAgICAgICAgIF9fdGhpcyA9IG5ldyBBdWRpb01hbmFnZXIoKTtcclxuICAgICAgICAgICAgICAgIHJldHVybiBfX3RoaXM7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcbiAgICAgICAgcHVibGljIHN0YXRpYyB2b2lkIEluaXQoKVxyXG4gICAgICAgIHtcclxuICAgICAgICAgICAgaWYgKF9fdGhpcyA9PSBudWxsKVxyXG4gICAgICAgICAgICAgICAgX190aGlzID0gbmV3IEF1ZGlvTWFuYWdlcigpO1xyXG4gICAgICAgIH1cclxuICAgICAgICBwcm90ZWN0ZWQgQXVkaW9NYW5hZ2VyKClcclxuICAgICAgICB7XHJcbiAgICAgICAgICAgIGRhdGEgPSBuZXcgRGljdGlvbmFyeTxzdHJpbmcsIEF1ZGlvPigpO1xyXG4gICAgICAgICAgICBwbGF5aW5nID0gbmV3IExpc3Q8QXVkaW8+KCk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHB1YmxpYyBBdWRpbyBHZXQoc3RyaW5nIHBhdGgpXHJcbiAgICAgICAge1xyXG4gICAgICAgICAgICBwYXRoID0gRGlyZWN0b3J5ICsgcGF0aDtcclxuICAgICAgICAgICAgaWYgKGRhdGEuQ29udGFpbnNLZXkocGF0aCkpXHJcbiAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgIHJldHVybiBkYXRhW3BhdGhdO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIGVsc2VcclxuICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgSFRNTEF1ZGlvRWxlbWVudCBBRSA9IG5ldyBIVE1MQXVkaW9FbGVtZW50KHBhdGgpO1xyXG4gICAgICAgICAgICAgICAgQXVkaW8gQSA9IG5ldyBBdWRpbyhBRSwgcGF0aCwgdGhpcyk7XHJcbiAgICAgICAgICAgICAgICBkYXRhLkFkZChwYXRoLCBBKTtcclxuICAgICAgICAgICAgICAgIHJldHVybiBBO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHB1YmxpYyBBdWRpbyBQbGF5KHN0cmluZyBwYXRoLCBib29sIGxvb3AgPSBmYWxzZSlcclxuICAgICAgICB7XHJcbiAgICAgICAgICAgIEF1ZGlvIEEgPSBHZXQocGF0aCk7XHJcbiAgICAgICAgICAgIEEuTG9vcCA9IGxvb3A7XHJcbiAgICAgICAgICAgIEEuUGxheSgpO1xyXG4gICAgICAgICAgICByZXR1cm4gQTtcclxuICAgICAgICB9XHJcbiAgICAgICAgcHVibGljIHZvaWQgQmxhc3Qoc3RyaW5nIHBhdGgsIGZsb2F0IHZvbHVtZSA9IDFmKVxyXG4gICAgICAgIHtcclxuICAgICAgICAgICAgQXVkaW8gQSA9IEdldChwYXRoKTtcclxuICAgICAgICAgICAgQS5CbGFzdCh2b2x1bWUpO1xyXG4gICAgICAgIH1cclxuICAgICAgICBwdWJsaWMgdm9pZCBTdG9wKHN0cmluZyBwYXRoKVxyXG4gICAgICAgIHtcclxuICAgICAgICAgICAgQXVkaW8gQSA9IEdldChwYXRoKTtcclxuICAgICAgICAgICAgQS5TdG9wKCk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHB1YmxpYyB2b2lkIFBhdXNlKHN0cmluZyBwYXRoKVxyXG4gICAgICAgIHtcclxuICAgICAgICAgICAgQXVkaW8gQSA9IEdldChwYXRoKTtcclxuICAgICAgICAgICAgQS5QYXVzZSgpO1xyXG4gICAgICAgIH1cclxuICAgICAgICBwdWJsaWMgdm9pZCBPblBsYXkoQXVkaW8gYXVkaW8pXHJcbiAgICAgICAge1xyXG4gICAgICAgICAgICBpZiAoIXBsYXlpbmcuQ29udGFpbnMoYXVkaW8pKVxyXG4gICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICBwbGF5aW5nLkFkZChhdWRpbyk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcbiAgICAgICAgcHVibGljIHZvaWQgT25TdG9wKEF1ZGlvIGF1ZGlvKVxyXG4gICAgICAgIHtcclxuICAgICAgICAgICAgaWYgKHBsYXlpbmcuQ29udGFpbnMoYXVkaW8pKVxyXG4gICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICBwbGF5aW5nLlJlbW92ZShhdWRpbyk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcbiAgICAgICAgcHVibGljIHZvaWQgU3RvcEFsbEZyb21EaXJlY3Rvcnkoc3RyaW5nIGRpcmVjdG9yeSlcclxuICAgICAgICB7XHJcbiAgICAgICAgICAgIGRpcmVjdG9yeSA9IERpcmVjdG9yeSArIGRpcmVjdG9yeTtcclxuQ2lybm9HYW1lLkhlbHBlckV4dGVuc2lvbnMuRm9yRWFjaDxnbG9iYWw6OkNpcm5vR2FtZS5BdWRpbz4oICAgICAgICAgICAgZGF0YS5WYWx1ZXMsKGdsb2JhbDo6U3lzdGVtLkFjdGlvbjxnbG9iYWw6OkNpcm5vR2FtZS5BdWRpbz4pKEEgPT4geyBpZiAoQS5JRC5TdGFydHNXaXRoKGRpcmVjdG9yeSkpIHsgQS5TdG9wKCk7IH0gfSkpO1xyXG4gICAgICAgIH1cclxuICAgICAgICBwdWJsaWMgdm9pZCBTdG9wQWxsKClcclxuICAgICAgICB7XHJcbkNpcm5vR2FtZS5IZWxwZXJFeHRlbnNpb25zLkZvckVhY2g8Z2xvYmFsOjpDaXJub0dhbWUuQXVkaW8+KCAgICAgICAgICAgIGRhdGEuVmFsdWVzLChnbG9iYWw6OlN5c3RlbS5BY3Rpb248Z2xvYmFsOjpDaXJub0dhbWUuQXVkaW8+KShBID0+IHsgQS5TdG9wKCk7IH0pKTtcclxuICAgICAgICB9XHJcbiAgICB9XHJcbn1cclxuIiwidXNpbmcgU3lzdGVtO1xyXG51c2luZyBTeXN0ZW0uQ29sbGVjdGlvbnMuR2VuZXJpYztcclxudXNpbmcgU3lzdGVtLkxpbnE7XHJcbnVzaW5nIFN5c3RlbS5UZXh0O1xyXG51c2luZyBTeXN0ZW0uVGhyZWFkaW5nLlRhc2tzO1xyXG51c2luZyBCcmlkZ2U7XHJcbnVzaW5nIEJyaWRnZS5IdG1sNTtcclxuXHJcbm5hbWVzcGFjZSBDaXJub0dhbWVcclxue1xyXG4gICAgcHVibGljIGNsYXNzIEJ1dHRvbk1lbnVcclxuICAgIHtcclxuICAgICAgICAvL3B1YmxpYyBMaXN0PEJ1dHRvblNwcml0ZT4gYnV0dG9ucztcclxuICAgICAgICBwcm90ZWN0ZWQgTGlzdDxMaXN0PEJ1dHRvblNwcml0ZT4+IHJvd3M7XHJcbiAgICAgICAgcHVibGljIGZsb2F0IE1lbnVXaWR0aDtcclxuICAgICAgICBwdWJsaWMgZmxvYXQgTWVudUhlaWdodDtcclxuICAgICAgICBwcm90ZWN0ZWQgaW50IEZvbnRTaXplO1xyXG4gICAgICAgIHB1YmxpYyBib29sIFNlbGVjdGlvbk1lbnU7XHJcbiAgICAgICAgcHVibGljIEJ1dHRvblNwcml0ZSBTZWxlY3RlZCA9IG51bGw7XHJcbiAgICAgICAgcHVibGljIEJ1dHRvbk1lbnUgU2VsZjtcclxuICAgICAgICBwdWJsaWMgZHluYW1pYyBTZWxlY3RlZERhdGFcclxuICAgICAgICB7XHJcbiAgICAgICAgICAgIGdldFxyXG4gICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICBpZiAoU2VsZi5TZWxlY3RlZCAhPSBudWxsKVxyXG4gICAgICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBTZWxmLlNlbGVjdGVkLkRhdGE7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gbnVsbDtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuICAgICAgICBwdWJsaWMgc3RyaW5nIFNlbGVjdGVkVGV4dFxyXG4gICAgICAgIHtcclxuICAgICAgICAgICAgZ2V0XHJcbiAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgIGlmIChTZWxmLlNlbGVjdGVkICE9IG51bGwpXHJcbiAgICAgICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKFNlbGYuU2VsZWN0ZWQuQ29udGVudHMgaXMgVGV4dFNwcml0ZSlcclxuICAgICAgICAgICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiAoKFRleHRTcHJpdGUpU2VsZi5TZWxlY3RlZC5Db250ZW50cykuVGV4dDtcclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gbnVsbDtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgcHVibGljIEFjdGlvbiBPbkNob29zZTtcclxuXHJcbiAgICAgICAgcHVibGljIFZlY3RvcjIgUG9zaXRpb24gPSBuZXcgVmVjdG9yMigpO1xyXG5cclxuICAgICAgICBwdWJsaWMgQnV0dG9uTWVudShmbG9hdCBtZW51V2lkdGgsIGZsb2F0IG1lbnVIZWlnaHQsIGludCBGb250U2l6ZSwgYm9vbCBzZWxlY3Rpb25NZW51ID0gZmFsc2UpXHJcbiAgICAgICAge1xyXG4gICAgICAgICAgICByb3dzID0gbmV3IExpc3Q8TGlzdDxCdXR0b25TcHJpdGU+PigpO1xyXG4gICAgICAgICAgICB0aGlzLk1lbnVXaWR0aCA9IG1lbnVXaWR0aDtcclxuICAgICAgICAgICAgdGhpcy5NZW51SGVpZ2h0ID0gbWVudUhlaWdodDtcclxuICAgICAgICAgICAgdGhpcy5Gb250U2l6ZSA9IEZvbnRTaXplO1xyXG4gICAgICAgICAgICB0aGlzLlNlbGVjdGlvbk1lbnUgPSBzZWxlY3Rpb25NZW51O1xyXG4gICAgICAgICAgICBTZWxmID0gdGhpcztcclxuICAgICAgICB9XHJcbiAgICAgICAgcHVibGljIExpc3Q8QnV0dG9uU3ByaXRlPiBHZXRBbGxCdXR0b25zKClcclxuICAgICAgICB7XHJcbiAgICAgICAgICAgIExpc3Q8QnV0dG9uU3ByaXRlPiBhbGwgPSBuZXcgTGlzdDxCdXR0b25TcHJpdGU+KCk7XHJcbiAgICAgICAgICAgIHJvd3MuRm9yRWFjaCgoZ2xvYmFsOjpTeXN0ZW0uQWN0aW9uPGdsb2JhbDo6U3lzdGVtLkNvbGxlY3Rpb25zLkdlbmVyaWMuTGlzdDxnbG9iYWw6OkNpcm5vR2FtZS5CdXR0b25TcHJpdGU+PikoUiA9PiBhbGwuQWRkUmFuZ2UoUikpKTtcclxuICAgICAgICAgICAgcmV0dXJuIGFsbDtcclxuICAgICAgICB9XHJcbiAgICAgICAgcHVibGljIEJ1dHRvblNwcml0ZSBHZXRTcHJpdGVCeURhdGEoZHluYW1pYyBkYXRhKVxyXG4gICAgICAgIHtcclxuICAgICAgICAgICAgTGlzdDxCdXR0b25TcHJpdGU+IGFsbCA9IG5ldyBMaXN0PEJ1dHRvblNwcml0ZT4oU3lzdGVtLkxpbnEuRW51bWVyYWJsZS5XaGVyZTxnbG9iYWw6OkNpcm5vR2FtZS5CdXR0b25TcHJpdGU+KEdldEFsbEJ1dHRvbnMoKSwoZ2xvYmFsOjpTeXN0ZW0uRnVuYzxnbG9iYWw6OkNpcm5vR2FtZS5CdXR0b25TcHJpdGUsIGJvb2w+KShCID0+IEIuRGF0YSA9PSBkYXRhKSkpO1xyXG4gICAgICAgICAgICBpZiAoYWxsLkNvdW50ID4gMClcclxuICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuIGFsbFswXTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICByZXR1cm4gbnVsbDtcclxuICAgICAgICB9XHJcbiAgICAgICAgcHVibGljIHZvaWQgQWRkQnV0dG9ucyhzdHJpbmdbXSBidXR0b25UZXh0KVxyXG4gICAgICAgIHtcclxuQ2lybm9HYW1lLkhlbHBlckV4dGVuc2lvbnMuRm9yRWFjaDxzdHJpbmc+KCAgICAgICAgICAgIGJ1dHRvblRleHQsKGdsb2JhbDo6U3lzdGVtLkFjdGlvbjxzdHJpbmc+KShUID0+IEFkZEJ1dHRvbigoc3RyaW5nKVQpKSk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHB1YmxpYyBCdXR0b25TcHJpdGUgQWRkQnV0dG9uKHN0cmluZyBidXR0b25UZXh0LCBpbnQgcm93ID0gLTEsIGR5bmFtaWMgZGF0YSA9IG51bGwpXHJcbiAgICAgICAge1xyXG4gICAgICAgICAgICBUZXh0U3ByaXRlIFQgPSBuZXcgVGV4dFNwcml0ZSgpO1xyXG4gICAgICAgICAgICBULlRleHQgPSBidXR0b25UZXh0O1xyXG4gICAgICAgICAgICBULkZvbnRTaXplID0gRm9udFNpemU7XHJcbiAgICAgICAgICAgIC8vQnV0dG9uU3ByaXRlIEIgPSBuZXcgQnV0dG9uU3ByaXRlKFQsIChpbnQpKEZvbnRTaXplICogMC4wNSkpO1xyXG4gICAgICAgICAgICBCdXR0b25TcHJpdGUgQiA9IG5ldyBCdXR0b25TcHJpdGUoVCwgKGludCkoRm9udFNpemUgKiAwLjEpKTtcclxuICAgICAgICAgICAgaWYgKGRhdGEgIT0gbnVsbClcclxuICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgQi5EYXRhID0gZGF0YTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBBZGRCdXR0b24oQiwgcm93KTtcclxuICAgICAgICAgICAgcmV0dXJuIEI7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHB1YmxpYyB2b2lkIEFkZEJ1dHRvbihCdXR0b25TcHJpdGUgYnV0dG9uLCBpbnQgcm93ID0gLTEpXHJcbiAgICAgICAge1xyXG4gICAgICAgICAgICBpZiAocm93cy5Db3VudCA9PSAwKVxyXG4gICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICByb3dzLkFkZChuZXcgTGlzdDxCdXR0b25TcHJpdGU+KCkpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIGlmIChyb3cgPT0gLTEpXHJcbiAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgIHJvdyA9IHJvd3MuQ291bnQgLSAxO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIGlmIChidXR0b24gIT0gbnVsbClcclxuICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgYnV0dG9uLk9uQ2xpY2sgPSAoKSA9PiB7IFNlbGYuU2VsZWN0KGJ1dHRvbik7IH07XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgcm93c1tyb3ddLkFkZChidXR0b24pO1xyXG4gICAgICAgIH1cclxuICAgICAgICBwdWJsaWMgdm9pZCBTZWxlY3QoQnV0dG9uU3ByaXRlIGJ1dHRvbilcclxuICAgICAgICB7XHJcbiAgICAgICAgICAgIGlmIChTZWxlY3RlZCAhPSBidXR0b24gfHwgIVNlbGVjdGlvbk1lbnUpXHJcbiAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgIGlmIChTZWxlY3RlZCAhPSBudWxsICYmIFNlbGVjdGlvbk1lbnUpXHJcbiAgICAgICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICAgICAgLy9TZWxlY3RlZC5Cb3JkZXJDb2xvciA9IFwiIzAwQUEzM1wiO1xyXG4gICAgICAgICAgICAgICAgICAgIC8vU2VsZWN0ZWQuQnV0dG9uQ29sb3IgPSBcIiMxMUNDNTVcIjtcclxuICAgICAgICAgICAgICAgICAgICBTZWxlY3RlZC5TZXRDb2xvclNjaGVtZSgwKTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIFNlbGVjdGVkID0gYnV0dG9uO1xyXG4gICAgICAgICAgICAgICAgdmFyIE9TQyA9IE9uQ2hvb3NlO1xyXG4gICAgICAgICAgICAgICAgdmFyIHNlbGYgPSB0aGlzO1xyXG4gICAgICAgICAgICAgICAgaWYgKFNlbGVjdGlvbk1lbnUgJiYgU2VsZWN0ZWQgIT0gbnVsbClcclxuICAgICAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgICAgICAvL1NlbGVjdGVkLkJvcmRlckNvbG9yID0gXCIjRkZGRkZGXCI7XHJcbiAgICAgICAgICAgICAgICAgICAgLy9TZWxlY3RlZC5CdXR0b25Db2xvciA9IFwiI0ZGMDAwMFwiO1xyXG4gICAgICAgICAgICAgICAgICAgIFNlbGVjdGVkLlNldENvbG9yU2NoZW1lKDEpO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgaWYgKFNlbGVjdGVkICE9IG51bGwgJiYgU2NyaXB0LldyaXRlPGJvb2w+KFwiT1NDXCIpKVxyXG4gICAgICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgICAgIHNlbGYuT25DaG9vc2UoKTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuICAgICAgICBwdWJsaWMgdm9pZCBDb21iaW5lUm93cygpXHJcbiAgICAgICAge1xyXG4gICAgICAgICAgICBMaXN0PEJ1dHRvblNwcml0ZT4gYWxsID0gbmV3IExpc3Q8QnV0dG9uU3ByaXRlPigpO1xyXG4gICAgICAgICAgICByb3dzLkZvckVhY2goKGdsb2JhbDo6U3lzdGVtLkFjdGlvbjxnbG9iYWw6OlN5c3RlbS5Db2xsZWN0aW9ucy5HZW5lcmljLkxpc3Q8Z2xvYmFsOjpDaXJub0dhbWUuQnV0dG9uU3ByaXRlPj4pKFIgPT4gYWxsLkFkZFJhbmdlKFIpKSk7XHJcblxyXG4gICAgICAgICAgICByb3dzID0gbmV3IExpc3Q8TGlzdDxCdXR0b25TcHJpdGU+PigpO1xyXG4gICAgICAgICAgICByb3dzLkFkZChhbGwpO1xyXG4gICAgICAgIH1cclxuICAgICAgICBwcm90ZWN0ZWQgTGlzdDxCdXR0b25TcHJpdGU+IGFkZFJvdygpXHJcbiAgICAgICAge1xyXG4gICAgICAgICAgICBMaXN0PEJ1dHRvblNwcml0ZT4gcmV0ID0gbmV3IExpc3Q8QnV0dG9uU3ByaXRlPigpO1xyXG4gICAgICAgICAgICByb3dzLkFkZChyZXQpO1xyXG4gICAgICAgICAgICByZXR1cm4gcmV0O1xyXG4gICAgICAgIH1cclxuICAgICAgICBwdWJsaWMgdm9pZCBCcmVha1VwKGludCB0b3RhbFJvd3MpXHJcbiAgICAgICAge1xyXG4gICAgICAgICAgICBDb21iaW5lUm93cygpO1xyXG4gICAgICAgICAgICBMaXN0PEJ1dHRvblNwcml0ZT4gYWxsID0gcm93c1swXTtcclxuICAgICAgICAgICAgcm93cyA9IG5ldyBMaXN0PExpc3Q8QnV0dG9uU3ByaXRlPj4oKTtcclxuICAgICAgICAgICAgZG91YmxlIEMgPSBNYXRoLkNlaWxpbmcoYWxsLkNvdW50IC8gKGRvdWJsZSl0b3RhbFJvd3MpO1xyXG4gICAgICAgICAgICBMaXN0PEJ1dHRvblNwcml0ZT4gcm93ID0gYWRkUm93KCk7XHJcbiAgICAgICAgICAgIGludCBpID0gMDtcclxuICAgICAgICAgICAgd2hpbGUgKGkgPCBhbGwuQ291bnQpXHJcbiAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgIGlmIChyb3cuQ291bnQgPj0gQylcclxuICAgICAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgICAgICByb3cgPSBhZGRSb3coKTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIEFkZEJ1dHRvbihhbGxbaV0pO1xyXG4gICAgICAgICAgICAgICAgaSsrO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHByb3RlY3RlZCB2b2lkIENlbnRlck9uKFNwcml0ZSBzcHJpdGUsIFZlY3RvcjIgQ2VudGVyKVxyXG4gICAgICAgIHtcclxuICAgICAgICAgICAgc3ByaXRlLkRyYXcobnVsbCk7XHJcbiAgICAgICAgICAgIFZlY3RvcjIgUyA9IHNwcml0ZS5TaXplO1xyXG4gICAgICAgICAgICBWZWN0b3IyIFMyID0gUyAvIDJmO1xyXG4gICAgICAgICAgICBzcHJpdGUuUG9zaXRpb24gPSBDZW50ZXIgLSBTMjtcclxuICAgICAgICB9XHJcbiAgICAgICAgcHJvdGVjdGVkIHZvaWQgVXBkYXRlUm93KGludCBpbmRleCwgZmxvYXQgeSlcclxuICAgICAgICB7XHJcbiAgICAgICAgICAgIExpc3Q8QnV0dG9uU3ByaXRlPiByb3cgPSByb3dzW2luZGV4XTtcclxuICAgICAgICAgICAgZmxvYXQgWCA9IChNZW51V2lkdGggLyAocm93LkNvdW50ICsgMS4wZikpO1xyXG4gICAgICAgICAgICBpbnQgaSA9IDA7XHJcbiAgICAgICAgICAgIGZsb2F0IENYID0gWDtcclxuXHJcbiAgICAgICAgICAgIENYICs9IFBvc2l0aW9uLlg7XHJcbiAgICAgICAgICAgIHdoaWxlIChpIDwgcm93LkNvdW50KVxyXG4gICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICBCdXR0b25TcHJpdGUgQiA9IHJvd1tpXTtcclxuICAgICAgICAgICAgICAgIGlmIChCICE9IG51bGwpXHJcbiAgICAgICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICAgICAgQ2VudGVyT24oQiwgbmV3IFZlY3RvcjIoQ1gsIHkpKTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIENYICs9IFg7XHJcbiAgICAgICAgICAgICAgICBpKys7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcbiAgICAgICAgcHVibGljIHZvaWQgRmluaXNoKGludCB0b3RhbFJvd3MgPSAtMSlcclxuICAgICAgICB7XHJcbiAgICAgICAgICAgIGlmICh0b3RhbFJvd3MgPiAwKVxyXG4gICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICBCcmVha1VwKHRvdGFsUm93cyk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgZmxvYXQgeSA9IDA7XHJcbiAgICAgICAgICAgIGZsb2F0IENZID0gMDtcclxuICAgICAgICAgICAgaWYgKHRvdGFsUm93cyA+IDAgJiYgcm93cy5Db3VudCA8IHRvdGFsUm93cylcclxuICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgeSA9IChNZW51SGVpZ2h0IC8gKHJvd3MuQ291bnQgKyAxKSk7XHJcbiAgICAgICAgICAgICAgICBDWSA9IHk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgZWxzZVxyXG4gICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICB5ID0gKE1lbnVIZWlnaHQgLyAocm93cy5Db3VudCkpO1xyXG4gICAgICAgICAgICAgICAgQ1kgPSAwO1xyXG4gICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICBDWSArPSBQb3NpdGlvbi5ZO1xyXG4gICAgICAgICAgICB2YXIgaSA9IDA7XHJcbiAgICAgICAgICAgIHdoaWxlIChpIDwgcm93cy5Db3VudClcclxuICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgVXBkYXRlUm93KGksIENZKTtcclxuICAgICAgICAgICAgICAgIENZICs9IHk7XHJcbiAgICAgICAgICAgICAgICBpKys7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcbiAgICAgICAgcHVibGljIHZvaWQgVXBkYXRlKFZlY3RvcjIgbW91c2VQb3NpdGlvbiA9IG51bGwsIGJvb2wgY2xpY2tlZCA9IHRydWUpXHJcbiAgICAgICAge1xyXG4gICAgICAgICAgICBpZiAobW91c2VQb3NpdGlvbiA9PSBudWxsKVxyXG4gICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICBtb3VzZVBvc2l0aW9uID0gS2V5Ym9hcmRNYW5hZ2VyLl90aGlzLkNNb3VzZTtcclxuICAgICAgICAgICAgICAgIGNsaWNrZWQgPSBLZXlib2FyZE1hbmFnZXIuX3RoaXMuVGFwcGVkTW91c2VCdXR0b25zLkNvbnRhaW5zKDApO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIGlmIChjbGlja2VkKVxyXG4gICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICByb3dzLkZvckVhY2goKGdsb2JhbDo6U3lzdGVtLkFjdGlvbjxnbG9iYWw6OlN5c3RlbS5Db2xsZWN0aW9ucy5HZW5lcmljLkxpc3Q8Z2xvYmFsOjpDaXJub0dhbWUuQnV0dG9uU3ByaXRlPj4pKFIgPT4gUi5Gb3JFYWNoKChnbG9iYWw6OlN5c3RlbS5BY3Rpb248Z2xvYmFsOjpDaXJub0dhbWUuQnV0dG9uU3ByaXRlPikoQiA9PiB7IGlmIChCICE9IG51bGwpIEIuQ2hlY2tDbGljayhtb3VzZVBvc2l0aW9uKTsgfSkpKSk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcbiAgICAgICAgcHVibGljIHZvaWQgRHJhdyhDYW52YXNSZW5kZXJpbmdDb250ZXh0MkQgZylcclxuICAgICAgICB7XHJcbiAgICAgICAgICAgIHJvd3MuRm9yRWFjaCgoZ2xvYmFsOjpTeXN0ZW0uQWN0aW9uPGdsb2JhbDo6U3lzdGVtLkNvbGxlY3Rpb25zLkdlbmVyaWMuTGlzdDxnbG9iYWw6OkNpcm5vR2FtZS5CdXR0b25TcHJpdGU+PikoUiA9PiBSLkZvckVhY2goKGdsb2JhbDo6U3lzdGVtLkFjdGlvbjxnbG9iYWw6OkNpcm5vR2FtZS5CdXR0b25TcHJpdGU+KShCID0+IHsgaWYgKEIgIT0gbnVsbCkgQi5EcmF3KGcpOyB9KSkpKTtcclxuICAgICAgICB9XHJcbiAgICB9XHJcbn1cclxuIiwidXNpbmcgU3lzdGVtO1xyXG51c2luZyBTeXN0ZW0uQ29sbGVjdGlvbnMuR2VuZXJpYztcclxudXNpbmcgU3lzdGVtLkxpbnE7XHJcbnVzaW5nIFN5c3RlbS5UZXh0O1xyXG51c2luZyBTeXN0ZW0uVGhyZWFkaW5nLlRhc2tzO1xyXG51c2luZyBCcmlkZ2U7XHJcbnVzaW5nIEJyaWRnZS5IdG1sNTtcclxuXHJcbm5hbWVzcGFjZSBDaXJub0dhbWVcclxue1xyXG4gICAgcHVibGljIGNsYXNzIFNwcml0ZVxyXG4gICAge1xyXG4gICAgICAgIHB1YmxpYyBWZWN0b3IyIFBvc2l0aW9uO1xyXG4gICAgICAgIHB1YmxpYyBIVE1MQ2FudmFzRWxlbWVudCBzcHJpdGVCdWZmZXI7XHJcbiAgICAgICAgcHVibGljIGJvb2wgVmlzaWJsZSA9IHRydWU7XHJcbiAgICAgICAgcHJvdGVjdGVkIENhbnZhc1JlbmRlcmluZ0NvbnRleHQyRCBzcHJpdGVHcmFwaGljcztcclxuICAgICAgICBwdWJsaWMgVmVjdG9yMiBTaXplXHJcbiAgICAgICAge1xyXG4gICAgICAgICAgICBnZXRcclxuICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuIG5ldyBWZWN0b3IyKHNwcml0ZUJ1ZmZlci5XaWR0aCwgc3ByaXRlQnVmZmVyLkhlaWdodCk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgc2V0XHJcbiAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgIGlmICh2YWx1ZSA9PSBudWxsKVxyXG4gICAgICAgICAgICAgICAgICAgIHZhbHVlID0gbmV3IFZlY3RvcjIoKTtcclxuICAgICAgICAgICAgICAgIHNwcml0ZUJ1ZmZlci5XaWR0aCA9IChpbnQpdmFsdWUuWDtcclxuICAgICAgICAgICAgICAgIHNwcml0ZUJ1ZmZlci5IZWlnaHQgPSAoaW50KXZhbHVlLlk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcbiAgICAgICAgcHVibGljIHZpcnR1YWwgQ2FudmFzUmVuZGVyaW5nQ29udGV4dDJEIEdldEdyYXBoaWNzKClcclxuICAgICAgICB7XHJcbiAgICAgICAgICAgIHJldHVybiBzcHJpdGVHcmFwaGljcztcclxuICAgICAgICB9XHJcbiAgICAgICAgcHVibGljIFNwcml0ZSgpXHJcbiAgICAgICAge1xyXG4gICAgICAgICAgICBzcHJpdGVCdWZmZXIgPSBuZXcgSFRNTENhbnZhc0VsZW1lbnQoKTtcclxuICAgICAgICAgICAgc3ByaXRlR3JhcGhpY3MgPSBzcHJpdGVCdWZmZXIuR2V0Q29udGV4dChDYW52YXNUeXBlcy5DYW52YXNDb250ZXh0MkRUeXBlLkNhbnZhc1JlbmRlcmluZ0NvbnRleHQyRCk7XHJcbiAgICAgICAgICAgIHNwcml0ZUdyYXBoaWNzLkltYWdlU21vb3RoaW5nRW5hYmxlZCA9IGZhbHNlO1xyXG4gICAgICAgICAgICBQb3NpdGlvbiA9IG5ldyBWZWN0b3IyKCk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHB1YmxpYyB2aXJ0dWFsIHZvaWQgT25GcmFtZSgpXHJcbiAgICAgICAge1xyXG5cclxuICAgICAgICB9XHJcbiAgICAgICAgcHVibGljIHZpcnR1YWwgdm9pZCBEcmF3KENhbnZhc1JlbmRlcmluZ0NvbnRleHQyRCBnKVxyXG4gICAgICAgIHtcclxuICAgICAgICAgICAgaWYgKCFWaXNpYmxlKVxyXG4gICAgICAgICAgICAgICAgcmV0dXJuO1xyXG4gICAgICAgICAgICBnLkRyYXdJbWFnZShzcHJpdGVCdWZmZXIsIFBvc2l0aW9uLlgsIFBvc2l0aW9uLlkpO1xyXG4gICAgICAgIH1cclxuICAgICAgICBwdWJsaWMgdmlydHVhbCBSZWN0YW5nbGUgR2V0Qm91bmRzKClcclxuICAgICAgICB7XHJcbiAgICAgICAgICAgIHJldHVybiBuZXcgUmVjdGFuZ2xlKFBvc2l0aW9uLlgsIFBvc2l0aW9uLlksIHNwcml0ZUJ1ZmZlci5XaWR0aCwgc3ByaXRlQnVmZmVyLkhlaWdodCk7XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG59XHJcbiIsInVzaW5nIFN5c3RlbTtcclxudXNpbmcgU3lzdGVtLkNvbGxlY3Rpb25zLkdlbmVyaWM7XHJcbnVzaW5nIFN5c3RlbS5MaW5xO1xyXG51c2luZyBTeXN0ZW0uVGV4dDtcclxudXNpbmcgU3lzdGVtLlRocmVhZGluZy5UYXNrcztcclxudXNpbmcgQnJpZGdlO1xyXG51c2luZyBCcmlkZ2UuSHRtbDU7XHJcblxyXG5uYW1lc3BhY2UgQ2lybm9HYW1lXHJcbntcclxuICAgIHB1YmxpYyBjbGFzcyBCdXR0b25TcHJpdGUgOiBTcHJpdGVcclxuICAgIHtcclxuICAgICAgICBwcm90ZWN0ZWQgYm9vbCBfYnV0dG9uTmVlZHNSZXJlbmRlcjtcclxuICAgICAgICBwcm90ZWN0ZWQgU3ByaXRlIF9idXR0b25CdWZmZXI7XHJcbiAgICAgICAgcHJvdGVjdGVkIENhbnZhc1JlbmRlcmluZ0NvbnRleHQyRCBfYnV0dG9uR3JhcGhpYztcclxuICAgICAgICBwdWJsaWMgZHluYW1pYyBEYXRhO1xyXG5cclxuICAgICAgICBwcm90ZWN0ZWQgU3ByaXRlIF9jb250ZW50cztcclxuICAgICAgICBwdWJsaWMgU3ByaXRlIENvbnRlbnRzXHJcbiAgICAgICAge1xyXG4gICAgICAgICAgICBnZXRcclxuICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuIF9jb250ZW50cztcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBzZXRcclxuICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgaWYgKF9jb250ZW50cyAhPSB2YWx1ZSlcclxuICAgICAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgICAgICBfY29udGVudHMgPSB2YWx1ZTtcclxuICAgICAgICAgICAgICAgICAgICBfYnV0dG9uTmVlZHNSZXJlbmRlciA9IHRydWU7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcbiAgICAgICAgcHJvdGVjdGVkIGludCBfYm9yZGVyU2l6ZTtcclxuICAgICAgICBwdWJsaWMgaW50IEJvcmRlclNpemVcclxuICAgICAgICB7XHJcbiAgICAgICAgICAgIGdldFxyXG4gICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gX2JvcmRlclNpemU7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgc2V0XHJcbiAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgIGlmIChfYm9yZGVyU2l6ZSAhPSB2YWx1ZSlcclxuICAgICAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgICAgICBfYm9yZGVyU2l6ZSA9IHZhbHVlO1xyXG4gICAgICAgICAgICAgICAgICAgIF9idXR0b25OZWVkc1JlcmVuZGVyID0gdHJ1ZTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuICAgICAgICBwcm90ZWN0ZWQgc3RyaW5nIF9ib3JkZXJDb2xvcjtcclxuICAgICAgICBwdWJsaWMgc3RyaW5nIEJvcmRlckNvbG9yXHJcbiAgICAgICAge1xyXG4gICAgICAgICAgICBnZXRcclxuICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuIF9ib3JkZXJDb2xvcjtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBzZXRcclxuICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgaWYgKF9ib3JkZXJDb2xvciAhPSB2YWx1ZSlcclxuICAgICAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgICAgICBfYm9yZGVyQ29sb3IgPSB2YWx1ZTtcclxuICAgICAgICAgICAgICAgICAgICBfYnV0dG9uTmVlZHNSZXJlbmRlciA9IHRydWU7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcbiAgICAgICAgcHVibGljIHN0cmluZyBMb2NrZWRDbGlja1NvdW5kID0gXCJoaXRcIjtcclxuICAgICAgICBwdWJsaWMgc3RyaW5nIENsaWNrU291bmQgPSBcInNlbGVjdFwiO1xyXG4gICAgICAgIHByb3RlY3RlZCBzdHJpbmcgX2J1dHRvbkNvbG9yO1xyXG4gICAgICAgIHB1YmxpYyBzdHJpbmcgQnV0dG9uQ29sb3JcclxuICAgICAgICB7XHJcbiAgICAgICAgICAgIGdldFxyXG4gICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gX2J1dHRvbkNvbG9yO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIHNldFxyXG4gICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICBpZiAoX2J1dHRvbkNvbG9yICE9IHZhbHVlKVxyXG4gICAgICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgICAgIF9idXR0b25Db2xvciA9IHZhbHVlO1xyXG4gICAgICAgICAgICAgICAgICAgIF9idXR0b25OZWVkc1JlcmVuZGVyID0gdHJ1ZTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuICAgICAgICBwdWJsaWMgY2xhc3MgQ29sb3JTY2hlbWVcclxuICAgICAgICB7XHJcbiAgICAgICAgICAgIHB1YmxpYyBzdHJpbmcgQm9yZGVyQ29sb3I7XHJcbiAgICAgICAgICAgIHB1YmxpYyBzdHJpbmcgQnV0dG9uQ29sb3I7XHJcbiAgICAgICAgICAgIHB1YmxpYyBDb2xvclNjaGVtZShzdHJpbmcgYm9yZGVyQ29sb3IgPSBcIiMwMEFBMzNcIiwgc3RyaW5nIGJ1dHRvbkNvbG9yID0gXCIjMTFDQzU1XCIpXHJcbiAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgIHRoaXMuQm9yZGVyQ29sb3IgPSBib3JkZXJDb2xvcjtcclxuICAgICAgICAgICAgICAgIHRoaXMuQnV0dG9uQ29sb3IgPSBidXR0b25Db2xvcjtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgcHVibGljIExpc3Q8Q29sb3JTY2hlbWU+IENvbG9yU2NoZW1lcztcclxuXHJcbiAgICAgICAgcHVibGljIGJvb2wgbG9ja2VkID0gZmFsc2U7XHJcblxyXG4gICAgICAgIHB1YmxpYyBBY3Rpb24gT25DbGljaztcclxuICAgICAgICBwdWJsaWMgdm9pZCBTZXRDb2xvclNjaGVtZShDb2xvclNjaGVtZSBzY2hlbWUpXHJcbiAgICAgICAge1xyXG4gICAgICAgICAgICBCb3JkZXJDb2xvciA9IHNjaGVtZS5Cb3JkZXJDb2xvcjtcclxuICAgICAgICAgICAgQnV0dG9uQ29sb3IgPSBzY2hlbWUuQnV0dG9uQ29sb3I7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHB1YmxpYyB2b2lkIFNldENvbG9yU2NoZW1lKGludCBpbmRleClcclxuICAgICAgICB7XHJcbiAgICAgICAgICAgIENvbG9yU2NoZW1lIEMgPSBDb2xvclNjaGVtZXNbaW5kZXhdO1xyXG4gICAgICAgICAgICBTZXRDb2xvclNjaGVtZShDKTtcclxuICAgICAgICB9XHJcbiAgICAgICAgLy9wdWJsaWMgQnV0dG9uU3ByaXRlKFNwcml0ZSBjb250ZW50cyxpbnQgYm9yZGVyU2l6ZT0yLHN0cmluZyBib3JkZXJDb2xvcj1cIiM3Nzc3NzdcIixzdHJpbmcgYnV0dG9uQ29sb3I9XCIjQ0NDQ0NDXCIpXHJcbiAgICAgICAgcHVibGljIEJ1dHRvblNwcml0ZShTcHJpdGUgY29udGVudHMsIGludCBib3JkZXJTaXplID0gMiwgc3RyaW5nIGJvcmRlckNvbG9yID0gXCIjMDBBQTMzXCIsIHN0cmluZyBidXR0b25Db2xvciA9IFwiIzExQ0M1NVwiLCBkeW5hbWljIGRhdGEgPSBudWxsKVxyXG4gICAgICAgIHtcclxuICAgICAgICAgICAgdGhpcy5Db250ZW50cyA9IGNvbnRlbnRzO1xyXG4gICAgICAgICAgICB0aGlzLkJvcmRlclNpemUgPSBib3JkZXJTaXplO1xyXG4gICAgICAgICAgICB0aGlzLkJvcmRlckNvbG9yID0gYm9yZGVyQ29sb3I7XHJcbiAgICAgICAgICAgIHRoaXMuQnV0dG9uQ29sb3IgPSBidXR0b25Db2xvcjtcclxuXHJcbiAgICAgICAgICAgIF9idXR0b25CdWZmZXIgPSBuZXcgU3ByaXRlKCk7XHJcbiAgICAgICAgICAgIF9idXR0b25CdWZmZXIuU2l6ZSA9IGNvbnRlbnRzLlNpemU7XHJcbiAgICAgICAgICAgIF9idXR0b25HcmFwaGljID0gX2J1dHRvbkJ1ZmZlci5HZXRHcmFwaGljcygpO1xyXG4gICAgICAgICAgICBfYnV0dG9uTmVlZHNSZXJlbmRlciA9IHRydWU7XHJcbiAgICAgICAgICAgIENvbG9yU2NoZW1lcyA9IG5ldyBMaXN0PENvbG9yU2NoZW1lPigpO1xyXG4gICAgICAgICAgICBDb2xvclNjaGVtZXMuQWRkKG5ldyBDb2xvclNjaGVtZShib3JkZXJDb2xvciwgYnV0dG9uQ29sb3IpKTtcclxuICAgICAgICAgICAgQ29sb3JTY2hlbWVzLkFkZChuZXcgQ29sb3JTY2hlbWUoXCIjRkZGRkZGXCIsIFwiI0ZGMDAwMFwiKSk7XHJcbiAgICAgICAgICAgIENvbG9yU2NoZW1lcy5BZGQobmV3IENvbG9yU2NoZW1lKFwiIzc3Nzc3N1wiLCBcIiNDQ0NDQ0NcIikpO1xyXG5cclxuICAgICAgICAgICAgdGhpcy5EYXRhID0gZGF0YTtcclxuICAgICAgICAgICAgaWYgKGRhdGEgPT0gbnVsbCAmJiBjb250ZW50cyBpcyBUZXh0U3ByaXRlKVxyXG4gICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICBEYXRhID0gKChUZXh0U3ByaXRlKWNvbnRlbnRzKS5UZXh0O1xyXG4gICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICBEcmF3KG51bGwpO1xyXG4gICAgICAgIH1cclxuICAgICAgICBwcm90ZWN0ZWQgdm9pZCBkcmF3QnV0dG9uKClcclxuICAgICAgICB7XHJcbiAgICAgICAgICAgIENhbnZhc1JlbmRlcmluZ0NvbnRleHQyRCBnID0gX2J1dHRvbkdyYXBoaWM7XHJcbiAgICAgICAgICAgIGludCBzeiA9IF9ib3JkZXJTaXplICsgX2JvcmRlclNpemU7XHJcbiAgICAgICAgICAgIF9idXR0b25CdWZmZXIuU2l6ZSA9IENvbnRlbnRzLlNpemUgKyBuZXcgVmVjdG9yMihzeiwgc3opO1xyXG4gICAgICAgICAgICBWZWN0b3IyIHNpemUgPSBfYnV0dG9uQnVmZmVyLlNpemU7XHJcblxyXG4gICAgICAgICAgICBnLkZpbGxTdHlsZSA9IF9ib3JkZXJDb2xvcjtcclxuICAgICAgICAgICAgZy5GaWxsUmVjdCgwLCAwLCAoaW50KXNpemUuWCwgKGludClzaXplLlkpO1xyXG5cclxuICAgICAgICAgICAgZy5GaWxsU3R5bGUgPSBCdXR0b25Db2xvcjtcclxuICAgICAgICAgICAgZy5GaWxsUmVjdChfYm9yZGVyU2l6ZSwgX2JvcmRlclNpemUsIChpbnQpc2l6ZS5YIC0gc3osIChpbnQpc2l6ZS5ZIC0gc3opO1xyXG5cclxuICAgICAgICAgICAgc3RyaW5nIGNvbG9yID0gXCJyZ2JhKDI1NSwyNTUsMjU1LDApXCI7XHJcblxyXG4gICAgICAgICAgICBzdHJpbmcgd2h0ID0gXCJyZ2JhKDI1NSwyNTUsMjU1LDAuNylcIjtcclxuXHJcblxyXG4gICAgICAgICAgICAvLy9TY3JpcHQuV3JpdGUoXCJ2YXIgZ3JkID0gZy5jcmVhdGVMaW5lYXJHcmFkaWVudCgwLCAwLCAwLCBzaXplLnkpO2dyZC5hZGRDb2xvclN0b3AoMCwgY29sb3IpO2dyZC5hZGRDb2xvclN0b3AoMC40LCB3aHQpO2dyZC5hZGRDb2xvclN0b3AoMSwgY29sb3IpO2cuZmlsbFN0eWxlID0gZ3JkO1wiKTtcclxuICAgICAgICAgICAgdmFyIGdyZCA9IGcuQ3JlYXRlTGluZWFyR3JhZGllbnQoMCwgMCwgMCwgc2l6ZS5ZKTtcclxuICAgICAgICAgICAgZ3JkLkFkZENvbG9yU3RvcCgwLCBjb2xvcik7XHJcbiAgICAgICAgICAgIGdyZC5BZGRDb2xvclN0b3AoMC40LCB3aHQpO1xyXG4gICAgICAgICAgICBncmQuQWRkQ29sb3JTdG9wKDEsIGNvbG9yKTtcclxuICAgICAgICAgICAgZy5GaWxsU3R5bGUgPSBncmQ7XHJcbiAgICAgICAgICAgIGcuRmlsbFJlY3QoMCwgMCwgKGludClfYnV0dG9uQnVmZmVyLlNpemUuWCwgKGludClfYnV0dG9uQnVmZmVyLlNpemUuWSk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHB1YmxpYyB2b2lkIExvY2soYm9vbCBzZXRjb2xvcnNjaGVtZSA9IHRydWUpXHJcbiAgICAgICAge1xyXG4gICAgICAgICAgICBpZiAobG9ja2VkKVxyXG4gICAgICAgICAgICAgICAgcmV0dXJuO1xyXG4gICAgICAgICAgICBsb2NrZWQgPSB0cnVlO1xyXG4gICAgICAgICAgICBpZiAoc2V0Y29sb3JzY2hlbWUpXHJcbiAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgIFNldENvbG9yU2NoZW1lKDIpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHB1YmxpYyB2b2lkIFVubG9jayhib29sIHNldGNvbG9yc2NoZW1lID0gdHJ1ZSlcclxuICAgICAgICB7XHJcbiAgICAgICAgICAgIGlmICghbG9ja2VkKVxyXG4gICAgICAgICAgICAgICAgcmV0dXJuO1xyXG4gICAgICAgICAgICBsb2NrZWQgPSBmYWxzZTtcclxuICAgICAgICAgICAgaWYgKHNldGNvbG9yc2NoZW1lKVxyXG4gICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICBTZXRDb2xvclNjaGVtZSgwKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuICAgICAgICBwcm90ZWN0ZWQgVmVjdG9yMiBMQ29udGVudFNpemUgPSBuZXcgVmVjdG9yMigpO1xyXG4gICAgICAgIHB1YmxpYyBib29sIENoZWNrQ2xpY2soVmVjdG9yMiBtb3VzZVBvc2l0aW9uKVxyXG4gICAgICAgIHtcclxuICAgICAgICAgICAgaWYgKFZpc2libGUgJiYgR2V0Qm91bmRzKCkuY29udGFpbnNQb2ludChtb3VzZVBvc2l0aW9uKSlcclxuICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgaWYgKGxvY2tlZClcclxuICAgICAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgICAgICBpZiAoTG9ja2VkQ2xpY2tTb3VuZCAhPSBcIlwiICYmIExvY2tlZENsaWNrU291bmQgIT0gbnVsbClcclxuICAgICAgICAgICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIEF1ZGlvTWFuYWdlci5fdGhpcy5CbGFzdChcIlNGWC9cIiArIExvY2tlZENsaWNrU291bmQgKyBcIi5vZ2dcIik7XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZTtcclxuICAgICAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgICAgICBpZiAoQ2xpY2tTb3VuZCAhPSBcIlwiICYmIENsaWNrU291bmQgIT0gbnVsbClcclxuICAgICAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgICAgICAvL0F1ZGlvTWFuYWdlci5fdGhpcy5HZXQoXCJTRlgvXCIgKyBDbGlja1NvdW5kKTtcclxuICAgICAgICAgICAgICAgICAgICBBdWRpb01hbmFnZXIuX3RoaXMuQmxhc3QoXCJTRlgvXCIgKyBDbGlja1NvdW5kICsgXCIub2dnXCIpO1xyXG5cclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIHZhciB0bXAgPSBPbkNsaWNrO1xyXG4gICAgICAgICAgICAgICAgaWYgKFNjcmlwdC5Xcml0ZTxib29sPihcInRtcFwiKSlcclxuICAgICAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgICAgICBPbkNsaWNrKCk7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gdHJ1ZTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICByZXR1cm4gZmFsc2U7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHB1YmxpYyBvdmVycmlkZSB2b2lkIERyYXcoQ2FudmFzUmVuZGVyaW5nQ29udGV4dDJEIGcpXHJcbiAgICAgICAge1xyXG4gICAgICAgICAgICAvL2lmIChfY29udGVudHMuU2l6ZSAhPSBMQ29udGVudFNpemUpXHJcbiAgICAgICAgICAgIGlmIChfY29udGVudHMuU2l6ZS5YICE9IExDb250ZW50U2l6ZS5YIHx8IF9jb250ZW50cy5TaXplLlkgIT0gTENvbnRlbnRTaXplLlkpXHJcbiAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgIF9idXR0b25OZWVkc1JlcmVuZGVyID0gdHJ1ZTtcclxuICAgICAgICAgICAgICAgIExDb250ZW50U2l6ZSA9IF9jb250ZW50cy5TaXplLkNsb25lKCk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgaWYgKF9idXR0b25OZWVkc1JlcmVuZGVyKVxyXG4gICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICBkcmF3QnV0dG9uKCk7XHJcbiAgICAgICAgICAgICAgICBfYnV0dG9uTmVlZHNSZXJlbmRlciA9IGZhbHNlO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIFNpemUgPSBfYnV0dG9uQnVmZmVyLlNpemUuQ2xvbmUoKTtcclxuICAgICAgICAgICAgLy9zcHJpdGVHcmFwaGljcy5EcmF3SW1hZ2UoX2J1KVxyXG4gICAgICAgICAgICBfYnV0dG9uQnVmZmVyLkRyYXcoc3ByaXRlR3JhcGhpY3MpO1xyXG4gICAgICAgICAgICBDb250ZW50cy5Qb3NpdGlvbiA9IG5ldyBWZWN0b3IyKF9ib3JkZXJTaXplLCBfYm9yZGVyU2l6ZSk7XHJcbiAgICAgICAgICAgIENvbnRlbnRzLkRyYXcoc3ByaXRlR3JhcGhpY3MpO1xyXG5cclxuICAgICAgICAgICAgaWYgKGcgIT0gbnVsbClcclxuICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgYmFzZS5EcmF3KGcpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG59XHJcbiIsInVzaW5nIFN5c3RlbTtcclxudXNpbmcgU3lzdGVtLkNvbGxlY3Rpb25zLkdlbmVyaWM7XHJcbnVzaW5nIFN5c3RlbS5MaW5xO1xyXG51c2luZyBTeXN0ZW0uVGV4dDtcclxudXNpbmcgU3lzdGVtLlRocmVhZGluZy5UYXNrcztcclxudXNpbmcgQnJpZGdlO1xyXG51c2luZyBCcmlkZ2UuSHRtbDU7XHJcblxyXG5uYW1lc3BhY2UgQ2lybm9HYW1lXHJcbntcclxuICAgIHB1YmxpYyBjbGFzcyBDYW1lcmFcclxuICAgIHtcclxuICAgICAgICBwdWJsaWMgYm9vbCBpbnN0YXdhcnAgPSBmYWxzZTtcclxuICAgICAgICBwdWJsaWMgVmVjdG9yMiBQb3NpdGlvbjtcclxuICAgICAgICBwdWJsaWMgVmVjdG9yMiBUYXJnZXRQb3NpdGlvbjtcclxuICAgICAgICBwdWJsaWMgVmVjdG9yMiBDZW50ZXJlZFRhcmdldFBvc2l0aW9uXHJcbiAgICAgICAge1xyXG4gICAgICAgICAgICBzZXRcclxuICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgVGFyZ2V0UG9zaXRpb24gPSBuZXcgVmVjdG9yMih2YWx1ZS5YIC0gKENhbWVyYUJvdW5kcy53aWR0aCAvIDIpLCB2YWx1ZS5ZIC0gKENhbWVyYUJvdW5kcy5oZWlnaHQgLyAyKSk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIC8vcHVibGljIGZsb2F0IExpbmVhclBhblNwZWVkID0gMS42ZjtcclxuICAgICAgICAvL3B1YmxpYyBmbG9hdCBMaW5lYXJQYW5TcGVlZCA9IDEuM2Y7XHJcbiAgICAgICAgLy8vcHVibGljIGZsb2F0IExpbmVhclBhblNwZWVkID0gMS4yZjtcclxuICAgICAgICBwdWJsaWMgZmxvYXQgTGluZWFyUGFuU3BlZWQgPSAwLjhmO1xyXG4gICAgICAgIC8vL3B1YmxpYyBmbG9hdCBMZXJwUGFuU3BlZWQgPSAwLjA3NWY7XHJcbiAgICAgICAgcHVibGljIGZsb2F0IExlcnBQYW5TcGVlZCA9IDAuMDcwZjtcclxuICAgICAgICAvL3Byb3RlY3RlZCBmbG9hdCBfc2NhbGUgPSAwLjhmO1xyXG4gICAgICAgIHByb3RlY3RlZCBmbG9hdCBfc2NhbGUgPSAxZjtcclxuICAgICAgICBwdWJsaWMgZmxvYXQgc3BlZWRtb2QgPSAxO1xyXG4gICAgICAgIHB1YmxpYyBmbG9hdCBTY2FsZVxyXG4gICAgICAgIHtcclxuICAgICAgICAgICAgZ2V0XHJcbiAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgIHJldHVybiBfc2NhbGU7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgc2V0XHJcbiAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgIF9zY2FsZSA9IHZhbHVlO1xyXG4gICAgICAgICAgICAgICAgX2ludnNjYWxlID0gMSAvIF9zY2FsZTtcclxuICAgICAgICAgICAgICAgIFVwZGF0ZUNhbWVyYUJvdW5kcygpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG4gICAgICAgIC8vcHJvdGVjdGVkIGZsb2F0IF9pbnZzY2FsZSA9IDEuMjVmO1xyXG4gICAgICAgIHByb3RlY3RlZCBmbG9hdCBfaW52c2NhbGUgPSAxLjBmO1xyXG4gICAgICAgIHB1YmxpYyBmbG9hdCBJbnZTY2FsZVxyXG4gICAgICAgIHtcclxuICAgICAgICAgICAgZ2V0XHJcbiAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgIHJldHVybiBfaW52c2NhbGU7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgc2V0XHJcbiAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgIF9pbnZzY2FsZSA9IHZhbHVlO1xyXG4gICAgICAgICAgICAgICAgX3NjYWxlID0gMSAvIF9pbnZzY2FsZTtcclxuICAgICAgICAgICAgICAgIFVwZGF0ZUNhbWVyYUJvdW5kcygpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHByaXZhdGUgVmVjdG9yMiBfY2VudGVyID0gbmV3IFZlY3RvcjIoKTtcclxuICAgICAgICBwdWJsaWMgVmVjdG9yMiBDZW50ZXJcclxuICAgICAgICB7XHJcbiAgICAgICAgICAgIGdldFxyXG4gICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICBSZWN0YW5nbGUgUiA9IENhbWVyYUJvdW5kcztcclxuICAgICAgICAgICAgICAgIC8vcmV0dXJuIFIuQ2VudGVyO1xyXG4gICAgICAgICAgICAgICAgUi5HZXRDZW50ZXIoX2NlbnRlcik7XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gX2NlbnRlcjtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBzZXRcclxuICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgUG9zaXRpb24uWCA9IHZhbHVlLlggLSAoQ2FtZXJhQm91bmRzLndpZHRoIC8gMik7XHJcbiAgICAgICAgICAgICAgICBQb3NpdGlvbi5ZID0gdmFsdWUuWSAtIChDYW1lcmFCb3VuZHMuaGVpZ2h0IC8gMik7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcbiAgICAgICAgcHVibGljIHZvaWQgU2NhbGVUb1NpemUoZmxvYXQgc2l6ZUluUGl4ZWxzKVxyXG4gICAgICAgIHtcclxuICAgICAgICAgICAgU2NhbGUgPSBzaXplSW5QaXhlbHMgLyBBcHAuQ2FudmFzLldpZHRoO1xyXG4gICAgICAgIH1cclxuICAgICAgICBwdWJsaWMgZmxvYXQgdmlld3BvcnRfd2lkdGggPSAxO1xyXG4gICAgICAgIHB1YmxpYyBmbG9hdCB2aWV3cG9ydF9oZWlnaHQgPSAxO1xyXG4gICAgICAgIC8vY2FtZXJhIGhpdGJveFxyXG4gICAgICAgIHB1YmxpYyBSZWN0YW5nbGUgQ2FtZXJhQm91bmRzO1xyXG4gICAgICAgIC8vYXJlYSBjYW1lcmEgbXVzdCBiZSBjb25maW5lZCB0by5cclxuICAgICAgICBwdWJsaWMgUmVjdGFuZ2xlIFN0YWdlQm91bmRzO1xyXG4gICAgICAgIHB1YmxpYyBDYW1lcmEoZmxvYXQgdmlld3BvcnRfd2lkdGggPSAtMSwgZmxvYXQgdmlld3BvcnRfaGVpZ2h0ID0gLTEpXHJcbiAgICAgICAge1xyXG4gICAgICAgICAgICBQb3NpdGlvbiA9IG5ldyBWZWN0b3IyKCk7XHJcbiAgICAgICAgICAgIFRhcmdldFBvc2l0aW9uID0gbmV3IFZlY3RvcjIoKTtcclxuICAgICAgICAgICAgdGhpcy52aWV3cG9ydF93aWR0aCA9IHZpZXdwb3J0X3dpZHRoO1xyXG4gICAgICAgICAgICB0aGlzLnZpZXdwb3J0X2hlaWdodCA9IHZpZXdwb3J0X2hlaWdodDtcclxuICAgICAgICAgICAgQ2FtZXJhQm91bmRzID0gbmV3IFJlY3RhbmdsZSgwLCAwLCB2aWV3cG9ydF93aWR0aCwgdmlld3BvcnRfaGVpZ2h0KTtcclxuICAgICAgICAgICAgX2ludnNjYWxlID0gMS4wZiAvIF9zY2FsZTtcclxuICAgICAgICAgICAgVXBkYXRlQ2FtZXJhQm91bmRzKCk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHByaXZhdGUgdm9pZCBVcGRhdGVDYW1lcmFCb3VuZHMoKVxyXG4gICAgICAgIHtcclxuICAgICAgICAgICAgLy9DYW1lcmFCb3VuZHMud2lkdGggPSBBcHAuQ2FudmFzLldpZHRoICogX2ludnNjYWxlO1xyXG4gICAgICAgICAgICAvL0NhbWVyYUJvdW5kcy5oZWlnaHQgPSBBcHAuQ2FudmFzLkhlaWdodCAqIF9pbnZzY2FsZTtcclxuICAgICAgICAgICAgQ2FtZXJhQm91bmRzLndpZHRoID0gdmlld3BvcnRfd2lkdGggKiBfaW52c2NhbGU7XHJcbiAgICAgICAgICAgIENhbWVyYUJvdW5kcy5oZWlnaHQgPSB2aWV3cG9ydF9oZWlnaHQgKiBfaW52c2NhbGU7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHByaXZhdGUgVmVjdG9yMiB0bXAgPSBuZXcgVmVjdG9yMigpO1xyXG4gICAgICAgIHB1YmxpYyB2b2lkIFVwZGF0ZSgpXHJcbiAgICAgICAge1xyXG4gICAgICAgICAgICBpZiAoUG9zaXRpb24uWCAhPSBUYXJnZXRQb3NpdGlvbi5YIHx8IFBvc2l0aW9uLlkgIT0gVGFyZ2V0UG9zaXRpb24uWSlcclxuICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgLy9mbG9hdCBkaXN0ID0gKFBvc2l0aW9uIC0gVGFyZ2V0UG9zaXRpb24pLkxlbmd0aDtcclxuICAgICAgICAgICAgICAgIGZsb2F0IGRpc3QgPSBQb3NpdGlvbi5EaXN0YW5jZShUYXJnZXRQb3NpdGlvbik7XHJcbiAgICAgICAgICAgICAgICBmbG9hdCBzcGQgPSBMaW5lYXJQYW5TcGVlZCArIChkaXN0ICogTGVycFBhblNwZWVkKTtcclxuICAgICAgICAgICAgICAgIHNwZCAqPSBzcGVlZG1vZDtcclxuXHJcbiAgICAgICAgICAgICAgICBpZiAoZGlzdCA8PSBzcGQgfHwgaW5zdGF3YXJwKVxyXG4gICAgICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgICAgIFBvc2l0aW9uLlggPSBUYXJnZXRQb3NpdGlvbi5YO1xyXG4gICAgICAgICAgICAgICAgICAgIFBvc2l0aW9uLlkgPSBUYXJnZXRQb3NpdGlvbi5ZO1xyXG4gICAgICAgICAgICAgICAgICAgIGluc3Rhd2FycCA9IGZhbHNlO1xyXG4gICAgICAgICAgICAgICAgICAgIHJldHVybjtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIGVsc2VcclxuICAgICAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgICAgICB0bXAuQ29weUZyb20oUG9zaXRpb24pO1xyXG4gICAgICAgICAgICAgICAgICAgIHRtcC5TdWJ0cmFjdChUYXJnZXRQb3NpdGlvbik7XHJcbiAgICAgICAgICAgICAgICAgICAgdG1wLlNldEFzTm9ybWFsaXplKHNwZCk7XHJcbiAgICAgICAgICAgICAgICAgICAgLy9WZWN0b3IyIFYgPSAoUG9zaXRpb24gLSBUYXJnZXRQb3NpdGlvbikuTm9ybWFsaXplKHNwZCk7XHJcbiAgICAgICAgICAgICAgICAgICAgUG9zaXRpb24uU3VidHJhY3QodG1wKTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIGlmIChTdGFnZUJvdW5kcyAhPSBudWxsKVxyXG4gICAgICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgICAgIFBvc2l0aW9uLlggPSBNYXRoSGVscGVyLkNsYW1wKFBvc2l0aW9uLlgsIFN0YWdlQm91bmRzLmxlZnQsIFN0YWdlQm91bmRzLnJpZ2h0IC0gQ2FtZXJhQm91bmRzLndpZHRoKTtcclxuICAgICAgICAgICAgICAgICAgICBQb3NpdGlvbi5ZID0gTWF0aEhlbHBlci5DbGFtcChQb3NpdGlvbi5ZLCBTdGFnZUJvdW5kcy50b3AsIFN0YWdlQm91bmRzLmJvdHRvbSAtIENhbWVyYUJvdW5kcy5oZWlnaHQpO1xyXG5cclxuICAgICAgICAgICAgICAgICAgICBUYXJnZXRQb3NpdGlvbi5YID0gTWF0aEhlbHBlci5DbGFtcChUYXJnZXRQb3NpdGlvbi5YLCBTdGFnZUJvdW5kcy5sZWZ0LCBTdGFnZUJvdW5kcy5yaWdodCAtIENhbWVyYUJvdW5kcy53aWR0aCk7XHJcbiAgICAgICAgICAgICAgICAgICAgVGFyZ2V0UG9zaXRpb24uWSA9IE1hdGhIZWxwZXIuQ2xhbXAoVGFyZ2V0UG9zaXRpb24uWSwgU3RhZ2VCb3VuZHMudG9wLCBTdGFnZUJvdW5kcy5ib3R0b20gLSBDYW1lcmFCb3VuZHMuaGVpZ2h0KTtcclxuICAgICAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgQ2FtZXJhQm91bmRzLnggPSBQb3NpdGlvbi5YO1xyXG4gICAgICAgICAgICBDYW1lcmFCb3VuZHMueSA9IFBvc2l0aW9uLlk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHB1YmxpYyB2b2lkIEFwcGx5KENhbnZhc1JlbmRlcmluZ0NvbnRleHQyRCBnKVxyXG4gICAgICAgIHtcclxuICAgICAgICAgICAgZy5TY2FsZShTY2FsZSwgU2NhbGUpO1xyXG4gICAgICAgICAgICBnLlRyYW5zbGF0ZSgtUG9zaXRpb24uWCwgLVBvc2l0aW9uLlkpO1xyXG4gICAgICAgIH1cclxuICAgIH1cclxufVxyXG4iLCJ1c2luZyBTeXN0ZW07XHJcbnVzaW5nIFN5c3RlbS5Db2xsZWN0aW9ucy5HZW5lcmljO1xyXG51c2luZyBTeXN0ZW0uTGlucTtcclxudXNpbmcgU3lzdGVtLlRleHQ7XHJcbnVzaW5nIFN5c3RlbS5UaHJlYWRpbmcuVGFza3M7XHJcbnVzaW5nIEJyaWRnZTtcclxudXNpbmcgQnJpZGdlLkh0bWw1O1xyXG5cclxubmFtZXNwYWNlIENpcm5vR2FtZVxyXG57XHJcbiAgICBwdWJsaWMgY2xhc3MgRW50aXR5XHJcbiAgICB7XHJcbiAgICAgICAgcHVibGljIEFuaW1hdGlvbiBBbmk7XHJcbiAgICAgICAgcHVibGljIGJvb2wgQWxpdmUgPSB0cnVlO1xyXG4gICAgICAgIHB1YmxpYyBib29sIFZpc2libGUgPSB0cnVlO1xyXG4gICAgICAgIHB1YmxpYyBWZWN0b3IyIFNwZWVkID0gbmV3IFZlY3RvcjIoKTtcclxuICAgICAgICBwdWJsaWMgR2FtZSBHYW1lO1xyXG4gICAgICAgIHByb3RlY3RlZCBMaXN0PEVudGl0eUJlaGF2aW9yPiBfYmVoYXZpb3JzO1xyXG4gICAgICAgIHByb3RlY3RlZCBMaXN0PGludD4gX2JlaGF2aW9yVGlja3M7XHJcbiAgICAgICAgcHVibGljIERpY3Rpb25hcnk8c3RyaW5nLCBkeW5hbWljPiBkYXRhID0gbmV3IERpY3Rpb25hcnk8c3RyaW5nLCBkeW5hbWljPigpO1xyXG4gICAgICAgIHB1YmxpYyBpbnQgWk9yZGVyID0gMDtcclxuICAgICAgICAvL3B1YmxpYyBkb3VibGUgSUQ7XHJcbiAgICAgICAgcHVibGljIHN0cmluZyBJRDtcclxuICAgICAgICBwdWJsaWMgYm9vbCBIaWRlSGl0Ym94O1xyXG4gICAgICAgIHB1YmxpYyBib29sIEhhbmRsZWRMb2NhbGx5ID0gdHJ1ZTtcclxuXHJcbiAgICAgICAgcHVibGljIGJvb2wgUmVtb3ZlZE9uTGV2ZWxFbmQgPSB0cnVlO1xyXG4gICAgICAgIHB1YmxpYyBmbG9hdCBIc3BlZWRcclxuICAgICAgICB7XHJcbiAgICAgICAgICAgIGdldFxyXG4gICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gU3BlZWQuWDtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBzZXRcclxuICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgU3BlZWQuWCA9IHZhbHVlO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHB1YmxpYyBmbG9hdCBWc3BlZWRcclxuICAgICAgICB7XHJcbiAgICAgICAgICAgIGdldFxyXG4gICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gU3BlZWQuWTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBzZXRcclxuICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgU3BlZWQuWSA9IHZhbHVlO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG5cclxuXHJcbiAgICAgICAgcHVibGljIFZlY3RvcjIgUG9zaXRpb25cclxuICAgICAgICB7XHJcbiAgICAgICAgICAgIGdldFxyXG4gICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gQW5pLlBvc2l0aW9uO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIHNldFxyXG4gICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICBBbmkuUG9zaXRpb24gPSB2YWx1ZTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuICAgICAgICBwdWJsaWMgZmxvYXQgeFxyXG4gICAgICAgIHtcclxuICAgICAgICAgICAgZ2V0XHJcbiAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgIHJldHVybiBBbmkuUG9zaXRpb24uWDtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBzZXRcclxuICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgQW5pLlBvc2l0aW9uLlggPSB2YWx1ZTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuICAgICAgICBwdWJsaWMgZmxvYXQgeVxyXG4gICAgICAgIHtcclxuICAgICAgICAgICAgZ2V0XHJcbiAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgIHJldHVybiBBbmkuUG9zaXRpb24uWTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBzZXRcclxuICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgQW5pLlBvc2l0aW9uLlkgPSB2YWx1ZTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgcHVibGljIGZsb2F0IFdpZHRoXHJcbiAgICAgICAge1xyXG4gICAgICAgICAgICBnZXRcclxuICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgaWYgKEFuaS5DdXJyZW50SW1hZ2UgIT0gbnVsbClcclxuICAgICAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgICAgICByZXR1cm4gQW5pLkN1cnJlbnRJbWFnZS5XaWR0aDtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIHJldHVybiAwO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBwdWJsaWMgZmxvYXQgSGVpZ2h0XHJcbiAgICAgICAge1xyXG4gICAgICAgICAgICBnZXRcclxuICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgaWYgKEFuaS5DdXJyZW50SW1hZ2UgIT0gbnVsbClcclxuICAgICAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgICAgICByZXR1cm4gQW5pLkN1cnJlbnRJbWFnZS5IZWlnaHQ7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gMDtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgcHVibGljIHZvaWQgQWRkQmVoYXZpb3IoRW50aXR5QmVoYXZpb3IgYmVoYXZpb3IpXHJcbiAgICAgICAge1xyXG4gICAgICAgICAgICBpZiAoX2JlaGF2aW9ycyA9PSBudWxsKVxyXG4gICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICBfYmVoYXZpb3JzID0gbmV3IExpc3Q8RW50aXR5QmVoYXZpb3I+KCk7XHJcbiAgICAgICAgICAgICAgICBfYmVoYXZpb3JUaWNrcyA9IG5ldyBMaXN0PGludD4oKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBfYmVoYXZpb3JzLkFkZChiZWhhdmlvcik7XHJcbiAgICAgICAgICAgIF9iZWhhdmlvclRpY2tzLkFkZCgwKTtcclxuICAgICAgICB9XHJcbiAgICAgICAgcHVibGljIFQgQWRkQmVoYXZpb3I8VD4oKVxyXG4gICAgICAgIHtcclxuICAgICAgICAgICAgaWYgKF9iZWhhdmlvcnMgPT0gbnVsbClcclxuICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgX2JlaGF2aW9ycyA9IG5ldyBMaXN0PEVudGl0eUJlaGF2aW9yPigpO1xyXG4gICAgICAgICAgICAgICAgX2JlaGF2aW9yVGlja3MgPSBuZXcgTGlzdDxpbnQ+KCk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgdmFyIEIgPSBBY3RpdmF0b3IuQ3JlYXRlSW5zdGFuY2UodHlwZW9mKFQpLCB0aGlzKTtcclxuICAgICAgICAgICAgX2JlaGF2aW9ycy5BZGQoKEVudGl0eUJlaGF2aW9yKUIpO1xyXG4gICAgICAgICAgICBfYmVoYXZpb3JUaWNrcy5BZGQoMCk7XHJcbiAgICAgICAgICAgIHJldHVybiBCLkFzPGR5bmFtaWM+KCk7XHJcbiAgICAgICAgICAgIC8qaWYgKEIgaXMgRW50aXR5QmVoYXZpb3IpXHJcbiAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgIF9iZWhhdmlvcnMuQWRkKChFbnRpdHlCZWhhdmlvcilCKTtcclxuICAgICAgICAgICAgICAgIF9iZWhhdmlvclRpY2tzLkFkZCgwKTtcclxuICAgICAgICAgICAgfWVsc2VcclxuICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgdGhyb3cgbmV3IEV4Y2VwdGlvbihcIkF0dGVtcHRlZCB0byBhZGQgYW4gaW52YWxpZCBiZWhhdmlvclwiKTtcclxuICAgICAgICAgICAgfSovXHJcbiAgICAgICAgfVxyXG4gICAgICAgIHB1YmxpYyB2b2lkIFJlbW92ZUJlaGF2aW9yKEVudGl0eUJlaGF2aW9yIGJlaGF2aW9yKVxyXG4gICAgICAgIHtcclxuICAgICAgICAgICAgaWYgKF9iZWhhdmlvcnMgPT0gbnVsbClcclxuICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgX2JlaGF2aW9ycyA9IG5ldyBMaXN0PEVudGl0eUJlaGF2aW9yPigpO1xyXG4gICAgICAgICAgICAgICAgX2JlaGF2aW9yVGlja3MgPSBuZXcgTGlzdDxpbnQ+KCk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgaWYgKF9iZWhhdmlvcnMuQ29udGFpbnMoYmVoYXZpb3IpKVxyXG4gICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICBfYmVoYXZpb3JUaWNrcy5SZW1vdmVBdChfYmVoYXZpb3JzLkluZGV4T2YoYmVoYXZpb3IpKTtcclxuICAgICAgICAgICAgICAgIF9iZWhhdmlvcnMuUmVtb3ZlKGJlaGF2aW9yKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuICAgICAgICBwdWJsaWMgdm9pZCBSZW1vdmVCZWhhdmlvcjxUPigpXHJcbiAgICAgICAge1xyXG4gICAgICAgICAgICBpZiAoX2JlaGF2aW9ycyA9PSBudWxsKVxyXG4gICAgICAgICAgICAgICAgcmV0dXJuO1xyXG4gICAgICAgICAgICBMaXN0PEVudGl0eUJlaGF2aW9yPiBMID0gbmV3IExpc3Q8RW50aXR5QmVoYXZpb3I+KFN5c3RlbS5MaW5xLkVudW1lcmFibGUuV2hlcmU8Z2xvYmFsOjpDaXJub0dhbWUuRW50aXR5QmVoYXZpb3I+KF9iZWhhdmlvcnMsKGdsb2JhbDo6U3lzdGVtLkZ1bmM8Z2xvYmFsOjpDaXJub0dhbWUuRW50aXR5QmVoYXZpb3IsIGJvb2w+KShiZWhhdmlvciA9PiBiZWhhdmlvciBpcyBUKSkpO1xyXG4gICAgICAgICAgICAvKmlmIChMLkNvdW50ID4gMClcclxuICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgUmVtb3ZlQmVoYXZpb3IoTFswXSk7XHJcbiAgICAgICAgICAgIH0qL1xyXG4gICAgICAgICAgICBmb3JlYWNoIChFbnRpdHlCZWhhdmlvciBiZWhhdmlvciBpbiBMKVxyXG4gICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICBSZW1vdmVCZWhhdmlvcihiZWhhdmlvcik7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgcmV0dXJuO1xyXG4gICAgICAgIH1cclxuICAgICAgICBwdWJsaWMgVCBHZXRCZWhhdmlvcjxUPigpXHJcbiAgICAgICAge1xyXG4gICAgICAgICAgICBpZiAoX2JlaGF2aW9ycyA9PSBudWxsKVxyXG4gICAgICAgICAgICAgICAgcmV0dXJuIGRlZmF1bHQoVCk7XHJcbiAgICAgICAgICAgIC8qTGlzdDxFbnRpdHlCZWhhdmlvcj4gTCA9IG5ldyBMaXN0PEVudGl0eUJlaGF2aW9yPihfYmVoYXZpb3JzLldoZXJlKGJlaGF2aW9yID0+IGJlaGF2aW9yIGlzIFQpKTtcclxuICAgICAgICAgICAgaWYgKEwuQ291bnQ+MClcclxuICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuIChkeW5hbWljKUxbMF07XHJcbiAgICAgICAgICAgIH0qL1xyXG4gICAgICAgICAgICByZXR1cm4gU3lzdGVtLkxpbnEuRW51bWVyYWJsZS5GaXJzdDxnbG9iYWw6OkNpcm5vR2FtZS5FbnRpdHlCZWhhdmlvcj4oX2JlaGF2aW9ycywoZ2xvYmFsOjpTeXN0ZW0uRnVuYzxnbG9iYWw6OkNpcm5vR2FtZS5FbnRpdHlCZWhhdmlvciwgYm9vbD4pKGJlaGF2aW9yID0+IGJlaGF2aW9yIGlzIFQpKS5DYXN0PFQ+KCk7XHJcbiAgICAgICAgICAgIHJldHVybiBkZWZhdWx0KFQpO1xyXG4gICAgICAgIH1cclxuICAgICAgICAvL3B1YmxpYyBUIEdldEJlaGF2aW9yPFQ+KEZ1bmM8RW50aXR5QmVoYXZpb3IsYm9vbD4gZnVuYylcclxuICAgICAgICBwdWJsaWMgVCBHZXRCZWhhdmlvcjxUPihGdW5jPFQsIGJvb2w+IGZ1bmMpXHJcbiAgICAgICAge1xyXG4gICAgICAgICAgICBMaXN0PEVudGl0eUJlaGF2aW9yPiBMID0gbmV3IExpc3Q8RW50aXR5QmVoYXZpb3I+KFN5c3RlbS5MaW5xLkVudW1lcmFibGUuV2hlcmU8Z2xvYmFsOjpDaXJub0dhbWUuRW50aXR5QmVoYXZpb3I+KF9iZWhhdmlvcnMsKGdsb2JhbDo6U3lzdGVtLkZ1bmM8Z2xvYmFsOjpDaXJub0dhbWUuRW50aXR5QmVoYXZpb3IsIGJvb2w+KShiZWhhdmlvciA9PiBiZWhhdmlvciBpcyBUKSkpO1xyXG4gICAgICAgICAgICBGdW5jPEVudGl0eUJlaGF2aW9yLCBib29sPiBGID0gZnVuYy5Ub0R5bmFtaWMoKTtcclxuICAgICAgICAgICAgcmV0dXJuIFN5c3RlbS5MaW5xLkVudW1lcmFibGUuRmlyc3Q8Z2xvYmFsOjpDaXJub0dhbWUuRW50aXR5QmVoYXZpb3I+KEwsKGdsb2JhbDo6U3lzdGVtLkZ1bmM8Z2xvYmFsOjpDaXJub0dhbWUuRW50aXR5QmVoYXZpb3IsIGJvb2w+KUYpLkNhc3Q8VD4oKTtcclxuICAgICAgICAgICAgLy9yZXR1cm4gTC5GaXJzdChmdW5jKS5DYXN0PFQ+KCk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHB1YmxpYyBzdHJpbmcgR2V0VGVhbUNvbG9yKClcclxuICAgICAgICB7XHJcbiAgICAgICAgICAgIGlmICh0aGlzIGlzIElDb21iYXRhbnQpXHJcbiAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgIGlmIChHYW1lLkdhbWVQbGF5U2V0dGluZ3MuR2FtZU1vZGUuVGVhbXMpXHJcbiAgICAgICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIEdhbWUuR2V0VGVhbUNvbG9yKCgoSUNvbWJhdGFudCl0aGlzKS5UZWFtKTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIGVsc2VcclxuICAgICAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgICAgICBpZiAodGhpcyA9PSBHYW1lLnBsYXllcilcclxuICAgICAgICAgICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBHYW1lLkdldFRlYW1Db2xvcigxKTtcclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgZWxzZVxyXG4gICAgICAgICAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIEdhbWUuR2V0VGVhbUNvbG9yKDIpO1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICByZXR1cm4gXCJcIjtcclxuICAgICAgICB9XHJcbiAgICAgICAgcHVibGljIGJvb2wgU2FtZVRlYW0oRW50aXR5IGNvbWJhdGFudClcclxuICAgICAgICB7XHJcbiAgICAgICAgICAgIGlmIChTY3JpcHQuV3JpdGU8Ym9vbD4oXCJ0aGlzID09IGNvbWJhdGFudFwiKSlcclxuICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuIHRydWU7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgZHluYW1pYyBBID0gdGhpcy5Ub0R5bmFtaWMoKTtcclxuICAgICAgICAgICAgZHluYW1pYyBCID0gY29tYmF0YW50LlRvRHluYW1pYygpO1xyXG5cclxuICAgICAgICAgICAgaWYgKEEuUG9pbnRzRm9yS2lsbGluZyAmJiBCLlBvaW50c0ZvcktpbGxpbmcpXHJcbiAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgIElDb21iYXRhbnQgQUEgPSBBO1xyXG4gICAgICAgICAgICAgICAgSUNvbWJhdGFudCBCQiA9IEI7XHJcbiAgICAgICAgICAgICAgICBpZiAoU2NyaXB0LldyaXRlPGJvb2w+KFwiQUEuVGVhbSA9PSBCQi5UZWFtXCIpKVxyXG4gICAgICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgICAgIGlmIChHYW1lLlRlYW1zKVxyXG4gICAgICAgICAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgLy9yZXR1cm4gKChJQ29tYmF0YW50KXRoaXMpLlRlYW0gIT0gMDtcclxuICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHRydWU7XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgIGVsc2VcclxuICAgICAgICAgICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBTY3JpcHQuV3JpdGU8Ym9vbD4oXCJBQS5UZWFtID09IDBcIik7XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIHJldHVybiBmYWxzZTtcclxuICAgICAgICB9XHJcbiAgICAgICAgcHVibGljIEVudGl0eUJlaGF2aW9yIEdldEJlaGF2aW9yRnJvbU5hbWUoc3RyaW5nIE5hbWUpXHJcbiAgICAgICAge1xyXG4gICAgICAgICAgICBpZiAoX2JlaGF2aW9ycyA9PSBudWxsKVxyXG4gICAgICAgICAgICAgICAgcmV0dXJuIG51bGw7XHJcbiAgICAgICAgICAgIC8vTGlzdDxFbnRpdHlCZWhhdmlvcj4gTCA9IG5ldyBMaXN0PEVudGl0eUJlaGF2aW9yPihfYmVoYXZpb3JzLldoZXJlKGJlaGF2aW9yID0+IGJlaGF2aW9yLkdldFR5cGUoKS5GdWxsTmFtZT09dHlwZUZ1bGxOYW1lKSk7XHJcbiAgICAgICAgICAgIC8qTGlzdDxFbnRpdHlCZWhhdmlvcj4gTCA9IG5ldyBMaXN0PEVudGl0eUJlaGF2aW9yPihfYmVoYXZpb3JzLldoZXJlKGJlaGF2aW9yID0+IGJlaGF2aW9yLkJlaGF2aW9yTmFtZSA9PSBOYW1lKSk7XHJcbiAgICAgICAgICAgIGlmIChMLkNvdW50ID4gMClcclxuICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuIChkeW5hbWljKUxbMF07XHJcbiAgICAgICAgICAgIH0qL1xyXG4gICAgICAgICAgICB0cnlcclxuICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuIFN5c3RlbS5MaW5xLkVudW1lcmFibGUuRmlyc3Q8Z2xvYmFsOjpDaXJub0dhbWUuRW50aXR5QmVoYXZpb3I+KF9iZWhhdmlvcnMsKGdsb2JhbDo6U3lzdGVtLkZ1bmM8Z2xvYmFsOjpDaXJub0dhbWUuRW50aXR5QmVoYXZpb3IsIGJvb2w+KShiZWhhdmlvciA9PiBiZWhhdmlvci5CZWhhdmlvck5hbWUgPT0gTmFtZSkpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIGNhdGNoXHJcbiAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgIENvbnNvbGUuV3JpdGVMaW5lKFwiQmVoYXZpb3IgXCIgKyBOYW1lICsgXCIgd2FzIG5vdCBmb3VuZC5cIik7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgcmV0dXJuIG51bGw7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIC8qcHVibGljIHZpcnR1YWwgYm9vbCBIYW5kbGVkTG9jYWxseVxyXG4gICAgICAgIHtcclxuICAgICAgICAgICAgZ2V0XHJcbiAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgIHJldHVybiBHYW1lLkhvc3RlcjtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH0qL1xyXG4gICAgICAgIHB1YmxpYyB2aXJ0dWFsIHZvaWQgQ3VzdG9tRXZlbnQoZHluYW1pYyBldnQpXHJcbiAgICAgICAge1xyXG5cclxuICAgICAgICB9XHJcbiAgICAgICAgLypwdWJsaWMgdm9pZCBTZW5kQ3VzdG9tRXZlbnQoZHluYW1pYyBldnQsIGJvb2wgdHJpZ2dlcmZsdXNoID0gZmFsc2UpXHJcbiAgICAgICAge1xyXG4gICAgICAgICAgICBkeW5hbWljIEQgPSBuZXcgb2JqZWN0KCk7XHJcbiAgICAgICAgICAgIEQuSSA9IElEO1xyXG4gICAgICAgICAgICBELkQgPSBldnQ7XHJcbiAgICAgICAgICAgIEdhbWUuU2VuZEV2ZW50KFwiQ0VcIiwgRCx0cmlnZ2VyZmx1c2gpO1xyXG4gICAgICAgIH0qL1xyXG4gICAgICAgIHB1YmxpYyB2b2lkIFBsYXlTb3VuZChzdHJpbmcgc291bmQpXHJcbiAgICAgICAge1xyXG4gICAgICAgICAgICBHYW1lLlBsYXlTb3VuZEVmZmVjdChnZXRDZW50ZXIoKSwgc291bmQpO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgcHVibGljIHZpcnR1YWwgVmVjdG9yMiBnZXRDZW50ZXIoKVxyXG4gICAgICAgIHtcclxuICAgICAgICAgICAgLy9yZXR1cm4gUG9zaXRpb24gKyBuZXcgVmVjdG9yMihXaWR0aCAvIDIsIEhlaWdodCAvIDIpO1xyXG4gICAgICAgICAgICByZXR1cm4gVmVjdG9yMi5BZGQoUG9zaXRpb24sIFdpZHRoIC8gMiwgSGVpZ2h0IC8gMik7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICAvKnB1YmxpYyBMaWdodCBHZXRMaWdodCgpXHJcbiAgICAgICAge1xyXG4gICAgICAgICAgICBpZiAodGhpcyBpcyBJTGlnaHRTb3VyY2UpXHJcbiAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgIHJldHVybiBHYW1lLkxpZ2h0cy5GaXJzdChsID0+IGwuc291cmNlID09IHRoaXMpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIHJldHVybiBudWxsO1xyXG4gICAgICAgIH0qL1xyXG5cclxuICAgICAgICBwdWJsaWMgRW50aXR5KEdhbWUgZ2FtZSlcclxuICAgICAgICB7XHJcbiAgICAgICAgICAgIC8vSUQgPSBNYXRoLlJhbmRvbSgpO1xyXG4gICAgICAgICAgICBJRCA9IEhlbHBlci5HZXRSYW5kb21TdHJpbmcoKTtcclxuICAgICAgICAgICAgdGhpcy5HYW1lID0gZ2FtZTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIHByb3RlY3RlZCBSZWN0YW5nbGUgSGl0Ym94QnVmZmVyID0gbmV3IFJlY3RhbmdsZSgpO1xyXG5cclxuICAgICAgICBwdWJsaWMgdmlydHVhbCBSZWN0YW5nbGUgR2V0SGl0Ym94KClcclxuICAgICAgICB7XHJcbiAgICAgICAgICAgIGlmIChBbmkgIT0gbnVsbCAmJiBBbmkuQ3VycmVudEltYWdlICE9IG51bGwpXHJcbiAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgIC8vcmV0dXJuIG5ldyBSZWN0YW5nbGUoQW5pLlgsIEFuaS5ZLCBBbmkuQ3VycmVudEltYWdlLldpZHRoLCBBbmkuQ3VycmVudEltYWdlLkhlaWdodCk7XHJcbiAgICAgICAgICAgICAgICB2YXIgQ0kgPSBBbmkuQ3VycmVudEltYWdlO1xyXG4gICAgICAgICAgICAgICAgSGl0Ym94QnVmZmVyLlNldChBbmkuWCwgQW5pLlksIENJLldpZHRoLCBDSS5IZWlnaHQpO1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuIEhpdGJveEJ1ZmZlcjtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICByZXR1cm4gbnVsbDtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIHB1YmxpYyB2aXJ0dWFsIHZvaWQgVXBkYXRlKClcclxuICAgICAgICB7XHJcbiAgICAgICAgICAgIEFuaS5Qb3NpdGlvbiArPSBTcGVlZDtcclxuICAgICAgICAgICAgQW5pLlVwZGF0ZSgpO1xyXG4gICAgICAgICAgICBpZiAoX2JlaGF2aW9ycyAhPSBudWxsKVxyXG4gICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICBpbnQgaSA9IDA7XHJcbiAgICAgICAgICAgICAgICB3aGlsZSAoaSA8IF9iZWhhdmlvcnMuQ291bnQpXHJcbiAgICAgICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICAgICAgRW50aXR5QmVoYXZpb3IgYmVoYXZpb3IgPSBfYmVoYXZpb3JzW2ldO1xyXG4gICAgICAgICAgICAgICAgICAgIGlmIChiZWhhdmlvci5lbmFibGVkICYmIF9iZWhhdmlvclRpY2tzW2ldKysgPj0gYmVoYXZpb3IuRnJhbWVzUGVyVGljaylcclxuICAgICAgICAgICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIF9iZWhhdmlvclRpY2tzW2ldID0gMDtcclxuICAgICAgICAgICAgICAgICAgICAgICAgYmVoYXZpb3IuVXBkYXRlKCk7XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgIGkrKztcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuICAgICAgICBwdWJsaWMgdm9pZCBSZWZyZXNoQmVoYXZpb3JUaWNrPFQ+KClcclxuICAgICAgICB7XHJcbiAgICAgICAgICAgIEVudGl0eUJlaGF2aW9yIEIgPSBHZXRCZWhhdmlvcjxUPigpLlRvRHluYW1pYygpO1xyXG4gICAgICAgICAgICBpZiAoQiAhPSBudWxsKVxyXG4gICAgICAgICAgICAgICAgX2JlaGF2aW9yVGlja3NbX2JlaGF2aW9ycy5JbmRleE9mKEIpXSA9IEIuRnJhbWVzUGVyVGljaztcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIHB1YmxpYyB2aXJ0dWFsIHZvaWQgRHJhdyhDYW52YXNSZW5kZXJpbmdDb250ZXh0MkQgZylcclxuICAgICAgICB7XHJcbiAgICAgICAgICAgIEFuaS5EcmF3KGcpO1xyXG4gICAgICAgICAgICBpZiAoIUhpZGVIaXRib3ggJiYgR2FtZS5TaG93SGl0Ym94KVxyXG4gICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICBEcmF3SGl0Ym94KGcpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIGlmIChfYmVoYXZpb3JzICE9IG51bGwpXHJcbiAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgIGZvcmVhY2ggKEVudGl0eUJlaGF2aW9yIGJlaGF2aW9yIGluIF9iZWhhdmlvcnMpXHJcbiAgICAgICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICAgICAgYmVoYXZpb3IuRHJhdyhnKTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuICAgICAgICBwdWJsaWMgdm9pZCBEcmF3SGl0Ym94KENhbnZhc1JlbmRlcmluZ0NvbnRleHQyRCBnKVxyXG4gICAgICAgIHtcclxuICAgICAgICAgICAgUmVjdGFuZ2xlIFIgPSBHZXRIaXRib3goKTtcclxuICAgICAgICAgICAgaWYgKFIgIT0gbnVsbClcclxuICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgZy5TdHJva2VTdHlsZSA9IFwiI0ZGRkYwMFwiO1xyXG4gICAgICAgICAgICAgICAgZy5TdHJva2VSZWN0KChpbnQpUi54LCAoaW50KVIueSwgKGludClSLndpZHRoLCAoaW50KVIuaGVpZ2h0KTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgcHVibGljIHZpcnR1YWwgdm9pZCBvblJlbW92ZSgpXHJcbiAgICAgICAge1xyXG5cclxuICAgICAgICB9XHJcblxyXG4gICAgfVxyXG59XHJcbiIsInVzaW5nIEJyaWRnZTtcclxudXNpbmcgQnJpZGdlLkh0bWw1O1xyXG51c2luZyBTeXN0ZW07XHJcblxyXG5uYW1lc3BhY2UgQ2lybm9HYW1lXHJcbntcclxuICAgIHB1YmxpYyBjbGFzcyBHYW1lUGFkXHJcbiAgICB7XHJcbiAgICAgICAgcHVibGljIGJvb2wgY29ubmVjdGVkO1xyXG4gICAgICAgIHB1YmxpYyBkb3VibGVbXSBheGVzO1xyXG4gICAgICAgIHB1YmxpYyBHYW1lUGFkQnV0dG9uW10gYnV0dG9ucztcclxuICAgICAgICBwdWJsaWMgc3RyaW5nIGlkO1xyXG4gICAgICAgIHB1YmxpYyBsb25nIGluZGV4O1xyXG4gICAgICAgIHB1YmxpYyBHYW1lUGFkKGR5bmFtaWMgcGFkKVxyXG4gICAgICAgIHtcclxuICAgICAgICAgICAgaWQgPSBwYWQuaWQ7XHJcbiAgICAgICAgICAgIGluZGV4ID0gcGFkLmluZGV4O1xyXG4gICAgICAgICAgICBjb25uZWN0ZWQgPSBwYWQuY29ubmVjdGVkO1xyXG4gICAgICAgICAgICBheGVzID0gcGFkLmF4ZXM7XHJcblxyXG4gICAgICAgICAgICBpbnQgbGVuZ3RoID0gcGFkLmJ1dHRvbnMubGVuZ3RoO1xyXG5cclxuICAgICAgICAgICAgYnV0dG9ucyA9IG5ldyBHYW1lUGFkQnV0dG9uW2xlbmd0aF07XHJcbiAgICAgICAgICAgIGludCBpID0gMDtcclxuICAgICAgICAgICAgd2hpbGUgKGkgPCBsZW5ndGgpXHJcbiAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgIGJ1dHRvbnNbaV0gPSBwYWQuYnV0dG9uc1tpXTtcclxuICAgICAgICAgICAgICAgIGkrKztcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuICAgICAgICBwdWJsaWMgdm9pZCBVcGRhdGUoKVxyXG4gICAgICAgIHtcclxuICAgICAgICAgICAgaW50IGkgPSAwO1xyXG4gICAgICAgICAgICB3aGlsZSAoaSA8IGJ1dHRvbnMuTGVuZ3RoKVxyXG4gICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICBidXR0b25zW2ldLnRhcHBlZCA9IGZhbHNlO1xyXG4gICAgICAgICAgICAgICAgaSsrO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHB1YmxpYyB2b2lkIENvbWJpbmVEYXRhKEdhbWVQYWQgcGFkKVxyXG4gICAgICAgIHtcclxuICAgICAgICAgICAgaWYgKGlkID09IHBhZC5pZClcclxuICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgY29ubmVjdGVkID0gcGFkLmNvbm5lY3RlZDtcclxuICAgICAgICAgICAgICAgIGF4ZXMgPSBwYWQuYXhlcztcclxuICAgICAgICAgICAgICAgIC8vYnV0dG9ucyA9IHBhZC5idXR0b25zO1xyXG4gICAgICAgICAgICAgICAgQ29tYmluZUJ1dHRvbkRhdGEocGFkLmJ1dHRvbnMpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHByb3RlY3RlZCB2b2lkIENvbWJpbmVCdXR0b25EYXRhKEdhbWVQYWRCdXR0b25bXSBidXR0b25zKVxyXG4gICAgICAgIHtcclxuICAgICAgICAgICAgR2FtZVBhZEJ1dHRvbltdIExiID0gYnV0dG9ucztcclxuICAgICAgICAgICAgdGhpcy5idXR0b25zID0gYnV0dG9ucztcclxuICAgICAgICAgICAgaW50IGkgPSAwO1xyXG4gICAgICAgICAgICB3aGlsZSAoaSA8IGJ1dHRvbnMuTGVuZ3RoKVxyXG4gICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICBpZiAoYnV0dG9uc1tpXS5wcmVzc2VkICYmICFMYltpXS5wcmVzc2VkKVxyXG4gICAgICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgICAgIGJ1dHRvbnNbaV0udGFwcGVkID0gdHJ1ZTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIGkrKztcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuICAgIH1cclxufVxyXG4iLCJ1c2luZyBTeXN0ZW07XHJcbnVzaW5nIFN5c3RlbS5Db2xsZWN0aW9ucy5HZW5lcmljO1xyXG51c2luZyBTeXN0ZW0uTGlucTtcclxudXNpbmcgU3lzdGVtLlRleHQ7XHJcbnVzaW5nIFN5c3RlbS5UaHJlYWRpbmcuVGFza3M7XHJcblxyXG5uYW1lc3BhY2UgQ2lybm9HYW1lXHJcbntcclxuICAgIHB1YmxpYyBjbGFzcyBHYW1lUGFkQnV0dG9uXHJcbiAgICB7XHJcbiAgICAgICAgcHVibGljIGJvb2wgdGFwcGVkO1xyXG4gICAgICAgIHB1YmxpYyBib29sIHByZXNzZWQ7XHJcbiAgICAgICAgcHVibGljIGRvdWJsZSB2YWx1ZTtcclxuICAgICAgICBwdWJsaWMgR2FtZVBhZEJ1dHRvbihkeW5hbWljIGJ1dHRvbilcclxuICAgICAgICB7XHJcbiAgICAgICAgICAgIHByZXNzZWQgPSBidXR0b24ucHJlc3NlZDtcclxuICAgICAgICAgICAgdmFsdWUgPSBidXR0b24udmFsdWU7XHJcbiAgICAgICAgICAgIHRhcHBlZCA9IGZhbHNlO1xyXG4gICAgICAgIH1cclxuICAgIH1cclxufVxyXG4iLCJ1c2luZyBCcmlkZ2U7XHJcbnVzaW5nIEJyaWRnZS5IdG1sNTtcclxudXNpbmcgU3lzdGVtO1xyXG51c2luZyBTeXN0ZW0uQ29sbGVjdGlvbnMuR2VuZXJpYztcclxudXNpbmcgU3lzdGVtLkxpbnE7XHJcblxyXG5uYW1lc3BhY2UgQ2lybm9HYW1lXHJcbntcclxuICAgIHB1YmxpYyBjbGFzcyBHYW1lUGFkTWFuYWdlclxyXG4gICAge1xyXG4gICAgICAgIHB1YmxpYyBzdGF0aWMgR2FtZVBhZE1hbmFnZXIgX3RoaXM7XHJcbiAgICAgICAgcHVibGljIEdhbWVQYWRNYW5hZ2VyKClcclxuICAgICAgICB7XHJcbiAgICAgICAgICAgIGdhbWVwYWRzID0gbmV3IExpc3Q8R2FtZVBhZD4oKTtcclxuICAgICAgICAgICAgVXBkYXRlKCk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHB1YmxpYyBMaXN0PEdhbWVQYWQ+IGFjdGl2ZUdhbWVwYWRzXHJcbiAgICAgICAge1xyXG4gICAgICAgICAgICBnZXRcclxuICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuIG5ldyBMaXN0PEdhbWVQYWQ+KFN5c3RlbS5MaW5xLkVudW1lcmFibGUuV2hlcmU8Z2xvYmFsOjpDaXJub0dhbWUuR2FtZVBhZD4oZ2FtZXBhZHMsKGdsb2JhbDo6U3lzdGVtLkZ1bmM8Z2xvYmFsOjpDaXJub0dhbWUuR2FtZVBhZCwgYm9vbD4pKGdhbWVwYWQgPT4gZ2FtZXBhZC5jb25uZWN0ZWQpKSk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcbiAgICAgICAgcHVibGljIEdhbWVQYWQga2V5Ym9hcmQ7XHJcbiAgICAgICAgcHVibGljIExpc3Q8R2FtZVBhZD4gZ2FtZXBhZHM7XHJcbiAgICAgICAgcHJpdmF0ZSBkeW5hbWljIHRlbXBnYW1lcGFkcztcclxuICAgICAgICBwdWJsaWMgdm9pZCBDYWxsQmFja1Rlc3QoKVxyXG4gICAgICAgIHtcclxuICAgICAgICAgICAgR2xvYmFsLkFsZXJ0KFwiQ2FsbGJhY2shXCIpO1xyXG4gICAgICAgIH1cclxuICAgICAgICBwdWJsaWMgR2FtZVBhZCBHZXRQYWQoc3RyaW5nIGlkKVxyXG4gICAgICAgIHtcclxuICAgICAgICAgICAgTGlzdDxHYW1lUGFkPiBMID0gbmV3IExpc3Q8R2FtZVBhZD4oU3lzdGVtLkxpbnEuRW51bWVyYWJsZS5XaGVyZTxnbG9iYWw6OkNpcm5vR2FtZS5HYW1lUGFkPihnYW1lcGFkcywoZ2xvYmFsOjpTeXN0ZW0uRnVuYzxnbG9iYWw6OkNpcm5vR2FtZS5HYW1lUGFkLCBib29sPikoZ2FtZXBhZCA9PiBnYW1lcGFkLmlkID09IGlkKSkpO1xyXG4gICAgICAgICAgICBpZiAoTC5Db3VudCA+IDApXHJcbiAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgIHJldHVybiBMWzBdO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIHJldHVybiBudWxsO1xyXG4gICAgICAgIH1cclxuICAgICAgICBwdWJsaWMgdm9pZCBVcGRhdGUoKVxyXG4gICAgICAgIHtcclxuICAgICAgICAgICAgaW50IGkgPSAwO1xyXG4gICAgICAgICAgICB3aGlsZSAoaSA8IGdhbWVwYWRzLkNvdW50KVxyXG4gICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICBnYW1lcGFkc1tpXS5VcGRhdGUoKTtcclxuICAgICAgICAgICAgICAgIGkrKztcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBpID0gMDtcclxuICAgICAgICAgICAgdGVtcGdhbWVwYWRzID0gU2NyaXB0LldyaXRlPG9iamVjdD4oXCIobmF2aWdhdG9yLmdldEdhbWVwYWRzKCkgfHwgbmF2aWdhdG9yLndlYmtpdEdldEdhbWVwYWRzKCkgfHwgW10pXCIpO1xyXG4gICAgICAgICAgICBMaXN0PEdhbWVQYWQ+IHBhZHMgPSBuZXcgTGlzdDxHYW1lUGFkPigpO1xyXG4gICAgICAgICAgICB3aGlsZSAoaSA8IHRlbXBnYW1lcGFkcy5sZW5ndGgpXHJcbiAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgIGlmICh0ZW1wZ2FtZXBhZHNbaV0gIT0gbnVsbClcclxuICAgICAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgICAgICBHYW1lUGFkIHBhZCA9IG5ldyBHYW1lUGFkKHRlbXBnYW1lcGFkc1tpXSk7XHJcbiAgICAgICAgICAgICAgICAgICAgX1VwZGF0ZShwYWQpO1xyXG4gICAgICAgICAgICAgICAgICAgIHBhZHMuQWRkKHBhZCk7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICBpKys7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgaSA9IDA7XHJcbiAgICAgICAgICAgIC8vQWRkcyBhbnkgbmV3bHkgZm91bmQgZ2FtZXBhZHMuXHJcbiAgICAgICAgICAgIHdoaWxlIChpIDwgcGFkcy5Db3VudClcclxuICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgc3RyaW5nIGlkID0gcGFkc1tpXS5pZDtcclxuICAgICAgICAgICAgICAgIGludCBqID0gMDtcclxuICAgICAgICAgICAgICAgIGJvb2wgb2sgPSB0cnVlO1xyXG4gICAgICAgICAgICAgICAgd2hpbGUgKGogPCBnYW1lcGFkcy5Db3VudClcclxuICAgICAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgICAgICBpZiAoZ2FtZXBhZHNbal0uaWQgPT0gaWQpXHJcbiAgICAgICAgICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBvayA9IGZhbHNlO1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICBqKys7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICBpZiAob2spXHJcbiAgICAgICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICAgICAgZ2FtZXBhZHMuQWRkKHBhZHNbaV0pO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgaSsrO1xyXG4gICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICAvKkFjdGlvbiBGID0gQ2FsbEJhY2tUZXN0O1xyXG4gICAgICAgICAgICBTY3JpcHQuV3JpdGUoXCJzZXRUaW1lb3V0KEYsIDMwMDApO1wiKTsqL1xyXG4gICAgICAgICAgICAvL0dsb2JhbC5TZXRUaW1lb3V0KClcclxuICAgICAgICB9XHJcbiAgICAgICAgcHJpdmF0ZSB2b2lkIF9VcGRhdGUoR2FtZVBhZCBwYWQpXHJcbiAgICAgICAge1xyXG4gICAgICAgICAgICBpbnQgaSA9IDA7XHJcbiAgICAgICAgICAgIHdoaWxlIChpIDwgZ2FtZXBhZHMuQ291bnQpXHJcbiAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgIEdhbWVQYWQgUCA9IGdhbWVwYWRzW2ldO1xyXG4gICAgICAgICAgICAgICAgaWYgKFAuaWQgPT0gcGFkLmlkKVxyXG4gICAgICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgICAgIFAuQ29tYmluZURhdGEocGFkKTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIGkrKztcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuICAgIH1cclxufVxyXG4iLCJ1c2luZyBTeXN0ZW07XHJcbnVzaW5nIFN5c3RlbS5Db2xsZWN0aW9ucy5HZW5lcmljO1xyXG51c2luZyBTeXN0ZW0uTGlucTtcclxudXNpbmcgU3lzdGVtLlRleHQ7XHJcbnVzaW5nIFN5c3RlbS5UaHJlYWRpbmcuVGFza3M7XHJcblxyXG5uYW1lc3BhY2UgQ2lybm9HYW1lXHJcbntcclxuICAgIHB1YmxpYyBjbGFzcyBHYW1lUGxheVNldHRpbmdzXHJcbiAgICB7XHJcbiAgICAgICAgcHVibGljIGJvb2wgT25saW5lID0gZmFsc2U7XHJcbiAgICAgICAgcHVibGljIHN0cmluZyBNeUNoYXJhY3RlciA9IFwiUmVpc2VuXCI7XHJcbiAgICAgICAgcHVibGljIEdhbWVNb2RlIEdhbWVNb2RlO1xyXG4gICAgICAgIHB1YmxpYyBpbnQgTXlUZWFtID0gMTtcclxuICAgICAgICBwdWJsaWMgaW50IEJsdWVOUENzID0gMztcclxuICAgICAgICBwdWJsaWMgaW50IFJlZE5QQ3MgPSAyO1xyXG4gICAgICAgIHB1YmxpYyBzdHJpbmcgUm9vbUlEID0gXCJcIjtcclxuICAgICAgICAvLy9wdWJsaWMgTmV0UGxheSBIb3N0TlBPdXQ7XHJcbiAgICAgICAgcHVibGljIGZsb2F0IENvbXB1dGVyQUlNb2RpZmllciA9IDFmO1xyXG4gICAgICAgIHB1YmxpYyBHYW1lUGxheVNldHRpbmdzKClcclxuICAgICAgICB7XHJcbiAgICAgICAgICAgIC8vR2FtZU1vZGUgPSBuZXcgR2FtZU1vZGUoKTtcclxuICAgICAgICAgICAgLy9HYW1lTW9kZSA9IEdhbWVNb2RlLkRlYXRoTWF0Y2g7XHJcbiAgICAgICAgICAgIEdhbWVNb2RlID0gR2FtZU1vZGUuVGVhbUJhdHRsZTtcclxuICAgICAgICB9XHJcbiAgICB9XHJcbn1cclxuIiwidXNpbmcgU3lzdGVtO1xyXG51c2luZyBTeXN0ZW0uQ29sbGVjdGlvbnMuR2VuZXJpYztcclxudXNpbmcgU3lzdGVtLkxpbnE7XHJcbnVzaW5nIFN5c3RlbS5UZXh0O1xyXG51c2luZyBTeXN0ZW0uVGhyZWFkaW5nLlRhc2tzO1xyXG51c2luZyBCcmlkZ2U7XHJcbnVzaW5nIEJyaWRnZS5IdG1sNTtcclxuXHJcbm5hbWVzcGFjZSBDaXJub0dhbWVcclxue1xyXG4gICAgcHVibGljIGNsYXNzIEhlbHBlclxyXG4gICAge1xyXG4gICAgICAgIHB1YmxpYyBzdGF0aWMgc3RyaW5nIEdldFJhbmRvbVN0cmluZygpXHJcbiAgICAgICAge1xyXG4gICAgICAgICAgICAvL3JldHVybiAoTWF0aC5SYW5kb20oKSAqIG5ldyBEYXRlKCkuR2V0VGltZSgpKS5Ub1N0cmluZygzNikuUmVwbGFjZShcIi9cXFxcLi8gZywgJy0nXCIsbnVsbCk7XHJcbiAgICAgICAgICAgIC8vcmV0dXJuIChNYXRoLlJhbmRvbSgpICogbmV3IERhdGUoKS5HZXRUaW1lKCkpLlRvU3RyaW5nKDM2KS5SZXBsYWNlKG5ldyBCcmlkZ2UuVGV4dC5SZWd1bGFyRXhwcmVzc2lvbnMuUmVnZXgoXCJcIiwgbnVsbCk7XHJcbiAgICAgICAgICAgIC8vcmV0dXJuIFNjcmlwdC5Xcml0ZTxzdHJpbmc+KFwiKE1hdGgucmFuZG9tKCkgKiBuZXcgRGF0ZSgpLmdldFRpbWUoKSkudG9TdHJpbmcoMzYpLnJlcGxhY2UoL1xcXFwuLyBnLCAnLScpXCIpO1xyXG4gICAgICAgICAgICByZXR1cm4gU2NyaXB0LldyaXRlPHN0cmluZz4oXCIoTWF0aC5yYW5kb20oKSAqIG5ldyBEYXRlKCkuZ2V0VGltZSgpKS50b1N0cmluZygzNilcIik7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHByb3RlY3RlZCBzdGF0aWMgRGljdGlvbmFyeTxzdHJpbmcsIG9iamVjdD4gX25hbWVzcGFjZXMgPSBuZXcgRGljdGlvbmFyeTxzdHJpbmcsIG9iamVjdD4oKTtcclxuICAgICAgICBwdWJsaWMgc3RhdGljIFR5cGUgR2V0VHlwZShzdHJpbmcgRnVsbE5hbWUpXHJcbiAgICAgICAge1xyXG4gICAgICAgICAgICBzdHJpbmcgbmFtZSA9IEZ1bGxOYW1lO1xyXG4gICAgICAgICAgICBpZiAobmFtZSA9PSBcIlwiIHx8IG5hbWUgPT0gbnVsbCB8fCAhbmFtZS5Db250YWlucyhcIi5cIikpXHJcbiAgICAgICAgICAgICAgICByZXR1cm4gbnVsbDtcclxuICAgICAgICAgICAgc3RyaW5nW10gcyA9IG5hbWUuU3BsaXQoXCIuXCIpO1xyXG4gICAgICAgICAgICAvL3N0cmluZyBubSA9IEdldFR5cGUoKS5GdWxsTmFtZS5TcGxpdChcIi5cIilbMF07XHJcbiAgICAgICAgICAgIGludCBpID0gMTtcclxuICAgICAgICAgICAgLyppZiAoc1swXSAhPSBubSlcclxuICAgICAgICAgICAgICAgIHJldHVybiBudWxsOyovXHJcblxyXG4gICAgICAgICAgICAvL2R5bmFtaWMgb2JqID0gU2NyaXB0LldyaXRlPG9iamVjdD4obm0pO1xyXG5cclxuICAgICAgICAgICAgLy9HZXQgbmFtZXNwYWNlXHJcbiAgICAgICAgICAgIGR5bmFtaWMgb2JqO1xyXG4gICAgICAgICAgICBpZiAoX25hbWVzcGFjZXMuQ29udGFpbnNLZXkoc1swXSkpXHJcbiAgICAgICAgICAgICAgICBvYmogPSBfbmFtZXNwYWNlc1tzWzBdXTtcclxuICAgICAgICAgICAgZWxzZVxyXG4gICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICBvYmogPSBHbG9iYWwuRXZhbDxvYmplY3Q+KHNbMF0pO1xyXG4gICAgICAgICAgICAgICAgX25hbWVzcGFjZXNbc1swXV0gPSBvYmo7XHJcbiAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgIHdoaWxlIChpIDwgcy5MZW5ndGgpXHJcbiAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgIC8vUGFyc2UgdGhyb3VnaCBvYmplY3QgaGllcmFyY2h5LlxyXG4gICAgICAgICAgICAgICAgaWYgKCFTY3JpcHQuV3JpdGU8Ym9vbD4oXCJvYmpcIikpXHJcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIG51bGw7XHJcbiAgICAgICAgICAgICAgICBvYmogPSBvYmpbc1tpXV07XHJcbiAgICAgICAgICAgICAgICBpKys7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgcmV0dXJuIG9iajtcclxuICAgICAgICB9XHJcbiAgICAgICAgcHVibGljIHN0YXRpYyB2b2lkIEFkZE11bHRpcGxlPFQ+KFRbXSBhcnJheSwgVCBpdGVtLCBpbnQgbnVtYmVyKVxyXG4gICAgICAgIHtcclxuICAgICAgICAgICAgd2hpbGUgKG51bWJlciA+IDApXHJcbiAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgIENpcm5vR2FtZS5IZWxwZXJFeHRlbnNpb25zLlB1c2g8VD4oYXJyYXksIGl0ZW0pO1xyXG4gICAgICAgICAgICAgICAgbnVtYmVyLS07XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcbiAgICAgICAgcHVibGljIHN0YXRpYyBzdHJpbmcgUmVwZWF0KHN0cmluZyBzLCBpbnQgbnVtYmVyKVxyXG4gICAgICAgIHtcclxuICAgICAgICAgICAgaWYgKG51bWJlciA8IDEpXHJcbiAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgIHJldHVybiBcIlwiO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIHN0cmluZyByZXQgPSBzO1xyXG4gICAgICAgICAgICBpbnQgaSA9IG51bWJlciAtIDE7XHJcbiAgICAgICAgICAgIHdoaWxlIChpID4gMClcclxuICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgcmV0ID0gcmV0ICsgcztcclxuICAgICAgICAgICAgICAgIGktLTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICByZXR1cm4gcmV0O1xyXG4gICAgICAgIH1cclxuICAgICAgICBwdWJsaWMgc3RhdGljIEhUTUxDYW52YXNFbGVtZW50IENsb25lQ2FudmFzKEhUTUxDYW52YXNFbGVtZW50IEMpXHJcbiAgICAgICAge1xyXG4gICAgICAgICAgICBIVE1MQ2FudmFzRWxlbWVudCByZXQgPSBuZXcgSFRNTENhbnZhc0VsZW1lbnQoKTtcclxuICAgICAgICAgICAgcmV0LldpZHRoID0gQy5XaWR0aDtcclxuICAgICAgICAgICAgcmV0LkhlaWdodCA9IEMuSGVpZ2h0O1xyXG4gICAgICAgICAgICBDYW52YXNSZW5kZXJpbmdDb250ZXh0MkQgZyA9IHJldC5HZXRDb250ZXh0KENhbnZhc1R5cGVzLkNhbnZhc0NvbnRleHQyRFR5cGUuQ2FudmFzUmVuZGVyaW5nQ29udGV4dDJEKTtcclxuICAgICAgICAgICAgZy5EcmF3SW1hZ2UoQywgMGYsIDBmKTtcclxuICAgICAgICAgICAgcmV0dXJuIHJldDtcclxuICAgICAgICB9XHJcbiAgICAgICAgcHVibGljIHN0YXRpYyBDYW52YXNSZW5kZXJpbmdDb250ZXh0MkQgR2V0Q29udGV4dChIVE1MQ2FudmFzRWxlbWVudCBDKVxyXG4gICAgICAgIHtcclxuICAgICAgICAgICAgcmV0dXJuIEMuR2V0Q29udGV4dChDYW52YXNUeXBlcy5DYW52YXNDb250ZXh0MkRUeXBlLkNhbnZhc1JlbmRlcmluZ0NvbnRleHQyRCk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHB1YmxpYyBzdGF0aWMgZHluYW1pYyBHZXRGaWVsZChkeW5hbWljIHRhcmdldCwgc3RyaW5nIGZpZWxkTmFtZSlcclxuICAgICAgICB7XHJcbiAgICAgICAgICAgIGR5bmFtaWMgTyA9IHRhcmdldDtcclxuICAgICAgICAgICAgLy9pZiAoT1tmaWVsZE5hbWVdKVxyXG4gICAgICAgICAgICBpZiAoSGFzKE8sIGZpZWxkTmFtZSkpXHJcbiAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgIHJldHVybiBPW2ZpZWxkTmFtZV07XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgaWYgKE9bXCJnZXRcIiArIGZpZWxkTmFtZV0pXHJcbiAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgIHJldHVybiBPW1wiZ2V0XCIgKyBmaWVsZE5hbWVdKCk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgc3RyaW5nIHMgPSBcIlwiO1xyXG4gICAgICAgICAgICB0cnlcclxuICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgcyA9IFwiSGVscGVyIGdldCBmaWVsZDogRmllbGQgXFxcIlwiICsgZmllbGROYW1lICsgXCJcXFwiIHdhcyBub3QgaW4gXCIgKyB0YXJnZXQuR2V0VHlwZSgpLkZ1bGxOYW1lICsgXCIuXCI7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgY2F0Y2hcclxuICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgcyA9IFwiSGVscGVyIGdldCBmaWVsZDogRmllbGQgXFxcIlwiICsgZmllbGROYW1lICsgXCJcXFwiIHdhcyBub3QgaW4gXCIgKyB0YXJnZXQgKyBcIi5cIjtcclxuICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgLy9Db25zb2xlLldyaXRlTGluZShzKTtcclxuICAgICAgICAgICAgTG9nKHMpO1xyXG4gICAgICAgICAgICByZXR1cm4gbnVsbDtcclxuICAgICAgICB9XHJcbiAgICAgICAgcHJvdGVjdGVkIHN0YXRpYyBib29sIEhhcyhkeW5hbWljIHRhcmdldCwgc3RyaW5nIGZpZWxkTmFtZSlcclxuICAgICAgICB7XHJcbiAgICAgICAgICAgIC8qaWYgKE9bZmllbGROYW1lXSB8fCAoKHN0cmluZylPKSA9PSBcImZhbHNlXCIpXHJcbiAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgIHJldHVybiB0cnVlO1xyXG4gICAgICAgICAgICB9Ki9cclxuICAgICAgICAgICAgcmV0dXJuIFNjcmlwdC5Xcml0ZTxib29sPihcInR5cGVvZiB0YXJnZXRbZmllbGROYW1lXSAhPSAndW5kZWZpbmVkJ1wiKTtcclxuICAgICAgICB9XHJcbiAgICAgICAgcHVibGljIHN0YXRpYyB2b2lkIFJlbG9hZFBhZ2UoKVxyXG4gICAgICAgIHtcclxuICAgICAgICAgICAgV2luZG93LkxvY2F0aW9uLkhyZWYgPSBXaW5kb3cuTG9jYXRpb24uSHJlZjtcclxuICAgICAgICB9XHJcbiAgICAgICAgcHVibGljIHN0YXRpYyB2b2lkIFNldEZpZWxkKGR5bmFtaWMgdGFyZ2V0LCBzdHJpbmcgZmllbGROYW1lLCBkeW5hbWljIGRhdGEpXHJcbiAgICAgICAge1xyXG4gICAgICAgICAgICBkeW5hbWljIE8gPSB0YXJnZXQ7XHJcbiAgICAgICAgICAgIC8vaWYgKE9bZmllbGROYW1lXSlcclxuICAgICAgICAgICAgaWYgKEhhcyhPLCBmaWVsZE5hbWUpKVxyXG4gICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICBPW2ZpZWxkTmFtZV0gPSBkYXRhO1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIGlmIChPW1wic2V0XCIgKyBmaWVsZE5hbWVdKVxyXG4gICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICBPW1wic2V0XCIgKyBmaWVsZE5hbWVdKGRhdGEpO1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIHN0cmluZyBzID0gXCJcIjtcclxuICAgICAgICAgICAgdHJ5XHJcbiAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgIHMgPSBcIkhlbHBlciBzZXQgZmllbGQ6IEZpZWxkIFxcXCJcIiArIGZpZWxkTmFtZSArIFwiXFxcIiB3YXMgbm90IGluIFwiICsgdGFyZ2V0LkdldFR5cGUoKS5GdWxsTmFtZSArIFwiLlwiO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIGNhdGNoXHJcbiAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgIHMgPSBcIkhlbHBlciBzZXQgZmllbGQ6IEZpZWxkIFxcXCJcIiArIGZpZWxkTmFtZSArIFwiXFxcIiB3YXMgbm90IGluIFwiICsgdGFyZ2V0ICsgXCIuXCI7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgLy9Db25zb2xlLldyaXRlTGluZShzKTtcclxuICAgICAgICAgICAgTG9nKHMpO1xyXG4gICAgICAgIH1cclxuICAgICAgICBbVGVtcGxhdGUoXCJjb25zb2xlLmxvZyh7bWVzc2FnZX0pXCIpXVxyXG4gICAgICAgIHB1YmxpYyBzdGF0aWMgdm9pZCBMb2coc3RyaW5nIG1lc3NhZ2UpXHJcbiAgICAgICAge1xyXG4gICAgICAgICAgICBib29sIGIgPSBTY3JpcHQuV3JpdGU8Ym9vbD4oXCJjb25zb2xlLmxvZyhtZXNzYWdlKVwiKTtcclxuICAgICAgICB9XHJcbiAgICAgICAgcHVibGljIHN0YXRpYyB2b2lkIENvcHlGaWVsZHMoZHluYW1pYyBzb3VyY2UsIGR5bmFtaWMgdGFyZ2V0LCBzdHJpbmdbXSBGaWVsZHMgPSBudWxsKVxyXG4gICAgICAgIHtcclxuICAgICAgICAgICAgaWYgKEZpZWxkcyA9PSBudWxsKVxyXG4gICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICBGaWVsZHMgPSBPYmplY3QuS2V5cyhzb3VyY2UpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIGludCBpID0gMDtcclxuICAgICAgICAgICAgd2hpbGUgKGkgPCBGaWVsZHMuTGVuZ3RoKVxyXG4gICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICBzdHJpbmcgZiA9IEZpZWxkc1tpXTtcclxuICAgICAgICAgICAgICAgIFNldEZpZWxkKHRhcmdldCwgZiwgR2V0RmllbGQoc291cmNlLCBmKSk7XHJcbiAgICAgICAgICAgICAgICBpKys7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcbiAgICAgICAgcHVibGljIHN0YXRpYyBzdHJpbmcgS2V5Q29kZVRvU3RyaW5nKGludCBrZXljb2RlKVxyXG4gICAgICAgIHtcclxuICAgICAgICAgICAgc3RyaW5nW10gY29kZW5hbWVzID0gbmV3IHN0cmluZ1tdIHsgXCJcIiwgLy8gWzBdXHJcbiAgXCJcIiwgLy8gWzFdXHJcbiAgXCJcIiwgLy8gWzJdXHJcbiAgXCJDQU5DRUxcIiwgLy8gWzNdXHJcbiAgXCJcIiwgLy8gWzRdXHJcbiAgXCJcIiwgLy8gWzVdXHJcbiAgXCJIRUxQXCIsIC8vIFs2XVxyXG4gIFwiXCIsIC8vIFs3XVxyXG4gIFwiQkFDS19TUEFDRVwiLCAvLyBbOF1cclxuICBcIlRBQlwiLCAvLyBbOV1cclxuICBcIlwiLCAvLyBbMTBdXHJcbiAgXCJcIiwgLy8gWzExXVxyXG4gIFwiQ0xFQVJcIiwgLy8gWzEyXVxyXG4gIFwiRU5URVJcIiwgLy8gWzEzXVxyXG4gIFwiRU5URVJfU1BFQ0lBTFwiLCAvLyBbMTRdXHJcbiAgXCJcIiwgLy8gWzE1XVxyXG4gIFwiU0hJRlRcIiwgLy8gWzE2XVxyXG4gIFwiQ09OVFJPTFwiLCAvLyBbMTddXHJcbiAgXCJBTFRcIiwgLy8gWzE4XVxyXG4gIFwiUEFVU0VcIiwgLy8gWzE5XVxyXG4gIFwiQ0FQU19MT0NLXCIsIC8vIFsyMF1cclxuICBcIktBTkFcIiwgLy8gWzIxXVxyXG4gIFwiRUlTVVwiLCAvLyBbMjJdXHJcbiAgXCJKVU5KQVwiLCAvLyBbMjNdXHJcbiAgXCJGSU5BTFwiLCAvLyBbMjRdXHJcbiAgXCJIQU5KQVwiLCAvLyBbMjVdXHJcbiAgXCJcIiwgLy8gWzI2XVxyXG4gIFwiRVNDQVBFXCIsIC8vIFsyN11cclxuICBcIkNPTlZFUlRcIiwgLy8gWzI4XVxyXG4gIFwiTk9OQ09OVkVSVFwiLCAvLyBbMjldXHJcbiAgXCJBQ0NFUFRcIiwgLy8gWzMwXVxyXG4gIFwiTU9ERUNIQU5HRVwiLCAvLyBbMzFdXHJcbiAgXCJTUEFDRVwiLCAvLyBbMzJdXHJcbiAgXCJQQUdFX1VQXCIsIC8vIFszM11cclxuICBcIlBBR0VfRE9XTlwiLCAvLyBbMzRdXHJcbiAgXCJFTkRcIiwgLy8gWzM1XVxyXG4gIFwiSE9NRVwiLCAvLyBbMzZdXHJcbiAgXCJMRUZUXCIsIC8vIFszN11cclxuICBcIlVQXCIsIC8vIFszOF1cclxuICBcIlJJR0hUXCIsIC8vIFszOV1cclxuICBcIkRPV05cIiwgLy8gWzQwXVxyXG4gIFwiU0VMRUNUXCIsIC8vIFs0MV1cclxuICBcIlBSSU5UXCIsIC8vIFs0Ml1cclxuICBcIkVYRUNVVEVcIiwgLy8gWzQzXVxyXG4gIFwiUFJJTlRTQ1JFRU5cIiwgLy8gWzQ0XVxyXG4gIFwiSU5TRVJUXCIsIC8vIFs0NV1cclxuICBcIkRFTEVURVwiLCAvLyBbNDZdXHJcbiAgXCJcIiwgLy8gWzQ3XVxyXG4gIFwiMFwiLCAvLyBbNDhdXHJcbiAgXCIxXCIsIC8vIFs0OV1cclxuICBcIjJcIiwgLy8gWzUwXVxyXG4gIFwiM1wiLCAvLyBbNTFdXHJcbiAgXCI0XCIsIC8vIFs1Ml1cclxuICBcIjVcIiwgLy8gWzUzXVxyXG4gIFwiNlwiLCAvLyBbNTRdXHJcbiAgXCI3XCIsIC8vIFs1NV1cclxuICBcIjhcIiwgLy8gWzU2XVxyXG4gIFwiOVwiLCAvLyBbNTddXHJcbiAgXCJDT0xPTlwiLCAvLyBbNThdXHJcbiAgXCJTRU1JQ09MT05cIiwgLy8gWzU5XVxyXG4gIFwiTEVTU19USEFOXCIsIC8vIFs2MF1cclxuICBcIkVRVUFMU1wiLCAvLyBbNjFdXHJcbiAgXCJHUkVBVEVSX1RIQU5cIiwgLy8gWzYyXVxyXG4gIFwiUVVFU1RJT05fTUFSS1wiLCAvLyBbNjNdXHJcbiAgXCJBVFwiLCAvLyBbNjRdXHJcbiAgXCJBXCIsIC8vIFs2NV1cclxuICBcIkJcIiwgLy8gWzY2XVxyXG4gIFwiQ1wiLCAvLyBbNjddXHJcbiAgXCJEXCIsIC8vIFs2OF1cclxuICBcIkVcIiwgLy8gWzY5XVxyXG4gIFwiRlwiLCAvLyBbNzBdXHJcbiAgXCJHXCIsIC8vIFs3MV1cclxuICBcIkhcIiwgLy8gWzcyXVxyXG4gIFwiSVwiLCAvLyBbNzNdXHJcbiAgXCJKXCIsIC8vIFs3NF1cclxuICBcIktcIiwgLy8gWzc1XVxyXG4gIFwiTFwiLCAvLyBbNzZdXHJcbiAgXCJNXCIsIC8vIFs3N11cclxuICBcIk5cIiwgLy8gWzc4XVxyXG4gIFwiT1wiLCAvLyBbNzldXHJcbiAgXCJQXCIsIC8vIFs4MF1cclxuICBcIlFcIiwgLy8gWzgxXVxyXG4gIFwiUlwiLCAvLyBbODJdXHJcbiAgXCJTXCIsIC8vIFs4M11cclxuICBcIlRcIiwgLy8gWzg0XVxyXG4gIFwiVVwiLCAvLyBbODVdXHJcbiAgXCJWXCIsIC8vIFs4Nl1cclxuICBcIldcIiwgLy8gWzg3XVxyXG4gIFwiWFwiLCAvLyBbODhdXHJcbiAgXCJZXCIsIC8vIFs4OV1cclxuICBcIlpcIiwgLy8gWzkwXVxyXG4gIFwiT1NfS0VZXCIsIC8vIFs5MV0gV2luZG93cyBLZXkgKFdpbmRvd3MpIG9yIENvbW1hbmQgS2V5IChNYWMpXHJcbiAgXCJcIiwgLy8gWzkyXVxyXG4gIFwiQ09OVEVYVF9NRU5VXCIsIC8vIFs5M11cclxuICBcIlwiLCAvLyBbOTRdXHJcbiAgXCJTTEVFUFwiLCAvLyBbOTVdXHJcbiAgXCJOVU1QQUQwXCIsIC8vIFs5Nl1cclxuICBcIk5VTVBBRDFcIiwgLy8gWzk3XVxyXG4gIFwiTlVNUEFEMlwiLCAvLyBbOThdXHJcbiAgXCJOVU1QQUQzXCIsIC8vIFs5OV1cclxuICBcIk5VTVBBRDRcIiwgLy8gWzEwMF1cclxuICBcIk5VTVBBRDVcIiwgLy8gWzEwMV1cclxuICBcIk5VTVBBRDZcIiwgLy8gWzEwMl1cclxuICBcIk5VTVBBRDdcIiwgLy8gWzEwM11cclxuICBcIk5VTVBBRDhcIiwgLy8gWzEwNF1cclxuICBcIk5VTVBBRDlcIiwgLy8gWzEwNV1cclxuICBcIk1VTFRJUExZXCIsIC8vIFsxMDZdXHJcbiAgXCJBRERcIiwgLy8gWzEwN11cclxuICBcIlNFUEFSQVRPUlwiLCAvLyBbMTA4XVxyXG4gIFwiU1VCVFJBQ1RcIiwgLy8gWzEwOV1cclxuICBcIkRFQ0lNQUxcIiwgLy8gWzExMF1cclxuICBcIkRJVklERVwiLCAvLyBbMTExXVxyXG4gIFwiRjFcIiwgLy8gWzExMl1cclxuICBcIkYyXCIsIC8vIFsxMTNdXHJcbiAgXCJGM1wiLCAvLyBbMTE0XVxyXG4gIFwiRjRcIiwgLy8gWzExNV1cclxuICBcIkY1XCIsIC8vIFsxMTZdXHJcbiAgXCJGNlwiLCAvLyBbMTE3XVxyXG4gIFwiRjdcIiwgLy8gWzExOF1cclxuICBcIkY4XCIsIC8vIFsxMTldXHJcbiAgXCJGOVwiLCAvLyBbMTIwXVxyXG4gIFwiRjEwXCIsIC8vIFsxMjFdXHJcbiAgXCJGMTFcIiwgLy8gWzEyMl1cclxuICBcIkYxMlwiLCAvLyBbMTIzXVxyXG4gIFwiRjEzXCIsIC8vIFsxMjRdXHJcbiAgXCJGMTRcIiwgLy8gWzEyNV1cclxuICBcIkYxNVwiLCAvLyBbMTI2XVxyXG4gIFwiRjE2XCIsIC8vIFsxMjddXHJcbiAgXCJGMTdcIiwgLy8gWzEyOF1cclxuICBcIkYxOFwiLCAvLyBbMTI5XVxyXG4gIFwiRjE5XCIsIC8vIFsxMzBdXHJcbiAgXCJGMjBcIiwgLy8gWzEzMV1cclxuICBcIkYyMVwiLCAvLyBbMTMyXVxyXG4gIFwiRjIyXCIsIC8vIFsxMzNdXHJcbiAgXCJGMjNcIiwgLy8gWzEzNF1cclxuICBcIkYyNFwiLCAvLyBbMTM1XVxyXG4gIFwiXCIsIC8vIFsxMzZdXHJcbiAgXCJcIiwgLy8gWzEzN11cclxuICBcIlwiLCAvLyBbMTM4XVxyXG4gIFwiXCIsIC8vIFsxMzldXHJcbiAgXCJcIiwgLy8gWzE0MF1cclxuICBcIlwiLCAvLyBbMTQxXVxyXG4gIFwiXCIsIC8vIFsxNDJdXHJcbiAgXCJcIiwgLy8gWzE0M11cclxuICBcIk5VTV9MT0NLXCIsIC8vIFsxNDRdXHJcbiAgXCJTQ1JPTExfTE9DS1wiLCAvLyBbMTQ1XVxyXG4gIFwiV0lOX09FTV9GSl9KSVNIT1wiLCAvLyBbMTQ2XVxyXG4gIFwiV0lOX09FTV9GSl9NQVNTSE9VXCIsIC8vIFsxNDddXHJcbiAgXCJXSU5fT0VNX0ZKX1RPVVJPS1VcIiwgLy8gWzE0OF1cclxuICBcIldJTl9PRU1fRkpfTE9ZQVwiLCAvLyBbMTQ5XVxyXG4gIFwiV0lOX09FTV9GSl9ST1lBXCIsIC8vIFsxNTBdXHJcbiAgXCJcIiwgLy8gWzE1MV1cclxuICBcIlwiLCAvLyBbMTUyXVxyXG4gIFwiXCIsIC8vIFsxNTNdXHJcbiAgXCJcIiwgLy8gWzE1NF1cclxuICBcIlwiLCAvLyBbMTU1XVxyXG4gIFwiXCIsIC8vIFsxNTZdXHJcbiAgXCJcIiwgLy8gWzE1N11cclxuICBcIlwiLCAvLyBbMTU4XVxyXG4gIFwiXCIsIC8vIFsxNTldXHJcbiAgXCJDSVJDVU1GTEVYXCIsIC8vIFsxNjBdXHJcbiAgXCJFWENMQU1BVElPTlwiLCAvLyBbMTYxXVxyXG4gIFwiRE9VQkxFX1FVT1RFXCIsIC8vIFsxNjJdXHJcbiAgXCJIQVNIXCIsIC8vIFsxNjNdXHJcbiAgXCJET0xMQVJcIiwgLy8gWzE2NF1cclxuICBcIlBFUkNFTlRcIiwgLy8gWzE2NV1cclxuICBcIkFNUEVSU0FORFwiLCAvLyBbMTY2XVxyXG4gIFwiVU5ERVJTQ09SRVwiLCAvLyBbMTY3XVxyXG4gIFwiT1BFTl9QQVJFTlwiLCAvLyBbMTY4XVxyXG4gIFwiQ0xPU0VfUEFSRU5cIiwgLy8gWzE2OV1cclxuICBcIkFTVEVSSVNLXCIsIC8vIFsxNzBdXHJcbiAgXCJQTFVTXCIsIC8vIFsxNzFdXHJcbiAgXCJQSVBFXCIsIC8vIFsxNzJdXHJcbiAgXCJIWVBIRU5fTUlOVVNcIiwgLy8gWzE3M11cclxuICBcIk9QRU5fQ1VSTFlfQlJBQ0tFVFwiLCAvLyBbMTc0XVxyXG4gIFwiQ0xPU0VfQ1VSTFlfQlJBQ0tFVFwiLCAvLyBbMTc1XVxyXG4gIFwiVElMREVcIiwgLy8gWzE3Nl1cclxuICBcIlwiLCAvLyBbMTc3XVxyXG4gIFwiXCIsIC8vIFsxNzhdXHJcbiAgXCJcIiwgLy8gWzE3OV1cclxuICBcIlwiLCAvLyBbMTgwXVxyXG4gIFwiVk9MVU1FX01VVEVcIiwgLy8gWzE4MV1cclxuICBcIlZPTFVNRV9ET1dOXCIsIC8vIFsxODJdXHJcbiAgXCJWT0xVTUVfVVBcIiwgLy8gWzE4M11cclxuICBcIlwiLCAvLyBbMTg0XVxyXG4gIFwiXCIsIC8vIFsxODVdXHJcbiAgXCJTRU1JQ09MT05cIiwgLy8gWzE4Nl1cclxuICBcIkVRVUFMU1wiLCAvLyBbMTg3XVxyXG4gIFwiQ09NTUFcIiwgLy8gWzE4OF1cclxuICBcIk1JTlVTXCIsIC8vIFsxODldXHJcbiAgXCJQRVJJT0RcIiwgLy8gWzE5MF1cclxuICBcIlNMQVNIXCIsIC8vIFsxOTFdXHJcbiAgXCJCQUNLX1FVT1RFXCIsIC8vIFsxOTJdXHJcbiAgXCJcIiwgLy8gWzE5M11cclxuICBcIlwiLCAvLyBbMTk0XVxyXG4gIFwiXCIsIC8vIFsxOTVdXHJcbiAgXCJcIiwgLy8gWzE5Nl1cclxuICBcIlwiLCAvLyBbMTk3XVxyXG4gIFwiXCIsIC8vIFsxOThdXHJcbiAgXCJcIiwgLy8gWzE5OV1cclxuICBcIlwiLCAvLyBbMjAwXVxyXG4gIFwiXCIsIC8vIFsyMDFdXHJcbiAgXCJcIiwgLy8gWzIwMl1cclxuICBcIlwiLCAvLyBbMjAzXVxyXG4gIFwiXCIsIC8vIFsyMDRdXHJcbiAgXCJcIiwgLy8gWzIwNV1cclxuICBcIlwiLCAvLyBbMjA2XVxyXG4gIFwiXCIsIC8vIFsyMDddXHJcbiAgXCJcIiwgLy8gWzIwOF1cclxuICBcIlwiLCAvLyBbMjA5XVxyXG4gIFwiXCIsIC8vIFsyMTBdXHJcbiAgXCJcIiwgLy8gWzIxMV1cclxuICBcIlwiLCAvLyBbMjEyXVxyXG4gIFwiXCIsIC8vIFsyMTNdXHJcbiAgXCJcIiwgLy8gWzIxNF1cclxuICBcIlwiLCAvLyBbMjE1XVxyXG4gIFwiXCIsIC8vIFsyMTZdXHJcbiAgXCJcIiwgLy8gWzIxN11cclxuICBcIlwiLCAvLyBbMjE4XVxyXG4gIFwiT1BFTl9CUkFDS0VUXCIsIC8vIFsyMTldXHJcbiAgXCJCQUNLX1NMQVNIXCIsIC8vIFsyMjBdXHJcbiAgXCJDTE9TRV9CUkFDS0VUXCIsIC8vIFsyMjFdXHJcbiAgXCJRVU9URVwiLCAvLyBbMjIyXVxyXG4gIFwiXCIsIC8vIFsyMjNdXHJcbiAgXCJNRVRBXCIsIC8vIFsyMjRdXHJcbiAgXCJBTFRHUlwiLCAvLyBbMjI1XVxyXG4gIFwiXCIsIC8vIFsyMjZdXHJcbiAgXCJXSU5fSUNPX0hFTFBcIiwgLy8gWzIyN11cclxuICBcIldJTl9JQ09fMDBcIiwgLy8gWzIyOF1cclxuICBcIlwiLCAvLyBbMjI5XVxyXG4gIFwiV0lOX0lDT19DTEVBUlwiLCAvLyBbMjMwXVxyXG4gIFwiXCIsIC8vIFsyMzFdXHJcbiAgXCJcIiwgLy8gWzIzMl1cclxuICBcIldJTl9PRU1fUkVTRVRcIiwgLy8gWzIzM11cclxuICBcIldJTl9PRU1fSlVNUFwiLCAvLyBbMjM0XVxyXG4gIFwiV0lOX09FTV9QQTFcIiwgLy8gWzIzNV1cclxuICBcIldJTl9PRU1fUEEyXCIsIC8vIFsyMzZdXHJcbiAgXCJXSU5fT0VNX1BBM1wiLCAvLyBbMjM3XVxyXG4gIFwiV0lOX09FTV9XU0NUUkxcIiwgLy8gWzIzOF1cclxuICBcIldJTl9PRU1fQ1VTRUxcIiwgLy8gWzIzOV1cclxuICBcIldJTl9PRU1fQVRUTlwiLCAvLyBbMjQwXVxyXG4gIFwiV0lOX09FTV9GSU5JU0hcIiwgLy8gWzI0MV1cclxuICBcIldJTl9PRU1fQ09QWVwiLCAvLyBbMjQyXVxyXG4gIFwiV0lOX09FTV9BVVRPXCIsIC8vIFsyNDNdXHJcbiAgXCJXSU5fT0VNX0VOTFdcIiwgLy8gWzI0NF1cclxuICBcIldJTl9PRU1fQkFDS1RBQlwiLCAvLyBbMjQ1XVxyXG4gIFwiQVRUTlwiLCAvLyBbMjQ2XVxyXG4gIFwiQ1JTRUxcIiwgLy8gWzI0N11cclxuICBcIkVYU0VMXCIsIC8vIFsyNDhdXHJcbiAgXCJFUkVPRlwiLCAvLyBbMjQ5XVxyXG4gIFwiUExBWVwiLCAvLyBbMjUwXVxyXG4gIFwiWk9PTVwiLCAvLyBbMjUxXVxyXG4gIFwiXCIsIC8vIFsyNTJdXHJcbiAgXCJQQTFcIiwgLy8gWzI1M11cclxuICBcIldJTl9PRU1fQ0xFQVJcIiwgLy8gWzI1NF1cclxuICBcIlwiIC8vIFsyNTVdXHJcbiAgICAgICAgICAgIH07XHJcbiAgICAgICAgICAgIGlmIChrZXljb2RlID49IDAgJiYga2V5Y29kZSA8IGNvZGVuYW1lcy5MZW5ndGgpXHJcbiAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgIHJldHVybiBjb2RlbmFtZXNba2V5Y29kZV07XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgdmFyIGtjID0ga2V5Y29kZTtcclxuICAgICAgICAgICAgcmV0dXJuIFNjcmlwdC5Xcml0ZTxzdHJpbmc+KFwiU3RyaW5nLkZyb21DaGFyQ29kZShrYylcIik7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHB1YmxpYyBzdGF0aWMgZHluYW1pYyBNYWtlU2hhbGxvd0NvcHkoZHluYW1pYyBzb3VyY2UsIHN0cmluZ1tdIGZpZWxkTmFtZXMgPSBudWxsKVxyXG4gICAgICAgIHtcclxuICAgICAgICAgICAgZHluYW1pYyB0YXJnZXQgPSBuZXcgb2JqZWN0KCk7XHJcbiAgICAgICAgICAgIHN0cmluZ1tdIEZpZWxkcyA9IGZpZWxkTmFtZXM7XHJcbiAgICAgICAgICAgIGlmIChGaWVsZHMgPT0gbnVsbClcclxuICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgRmllbGRzID0gT2JqZWN0LktleXMoc291cmNlKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBpbnQgaSA9IDA7XHJcbiAgICAgICAgICAgIHdoaWxlIChpIDwgRmllbGRzLkxlbmd0aClcclxuICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgc3RyaW5nIGYgPSBGaWVsZHNbaV07XHJcbiAgICAgICAgICAgICAgICB0YXJnZXRbZl0gPSBHZXRGaWVsZChzb3VyY2UsIGYpO1xyXG4gICAgICAgICAgICAgICAgaSsrO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIHJldHVybiB0YXJnZXQ7XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG59XHJcbiIsInVzaW5nIFN5c3RlbTtcclxudXNpbmcgU3lzdGVtLkNvbGxlY3Rpb25zLkdlbmVyaWM7XHJcbnVzaW5nIFN5c3RlbS5MaW5xO1xyXG51c2luZyBTeXN0ZW0uVGV4dDtcclxudXNpbmcgU3lzdGVtLlRocmVhZGluZy5UYXNrcztcclxudXNpbmcgQnJpZGdlLkh0bWw1O1xyXG51c2luZyBCcmlkZ2U7XHJcblxyXG5uYW1lc3BhY2UgQ2lybm9HYW1lXHJcbntcclxuICAgIHB1YmxpYyBzdGF0aWMgY2xhc3MgSGVscGVyRXh0ZW5zaW9uc1xyXG4gICAge1xyXG4gICAgICAgIHB1YmxpYyBzdGF0aWMgVCBQaWNrPFQ+KHRoaXMgSUVudW1lcmFibGU8VD4gbGlzdCwgUmFuZG9tIFJORCA9IG51bGwpXHJcbiAgICAgICAge1xyXG4gICAgICAgICAgICBpZiAoUk5EID09IG51bGwpXHJcbiAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgIFJORCA9IG5ldyBSYW5kb20oKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBMaXN0PFQ+IEwgPSBuZXcgTGlzdDxUPigpO1xyXG4gICAgICAgICAgICBmb3JlYWNoICh2YXIgaXRlbSBpbiBsaXN0KVxyXG4gICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICBMLkFkZChpdGVtKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICByZXR1cm4gTFtSTkQuTmV4dChMLkNvdW50KV07XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHB1YmxpYyBzdGF0aWMgdm9pZCBGb3JFYWNoPFQ+KHRoaXMgSUVudW1lcmFibGU8VD4gbGlzdCwgQWN0aW9uPFQ+IGFjdGlvbilcclxuICAgICAgICB7XHJcbiAgICAgICAgICAgIGZvcmVhY2ggKHZhciBpdGVtIGluIGxpc3QpXHJcbiAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgIGFjdGlvbihpdGVtKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuICAgICAgICBwdWJsaWMgc3RhdGljIHZvaWQgRm9yRWFjaDxUPih0aGlzIElFbnVtZXJhYmxlPFQ+IGxpc3QsIHN0cmluZyBtZXRob2ROYW1lKVxyXG4gICAgICAgIHtcclxuICAgICAgICAgICAgZm9yZWFjaCAodmFyIGl0ZW0gaW4gbGlzdClcclxuICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgQWN0aW9uIEEgPSBpdGVtW21ldGhvZE5hbWVdLkFzPEFjdGlvbj4oKTtcclxuICAgICAgICAgICAgICAgIEEoKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuICAgICAgICBwdWJsaWMgc3RhdGljIHZvaWQgQWRkSWZOZXc8VD4odGhpcyBMaXN0PFQ+IGxpc3QsIFQgaXRlbSlcclxuICAgICAgICB7XHJcbiAgICAgICAgICAgIGludCBpID0gMDtcclxuICAgICAgICAgICAgdmFyIGxuID0gbGlzdC5Db3VudDtcclxuICAgICAgICAgICAgb2JqZWN0IEEgPSBpdGVtO1xyXG4gICAgICAgICAgICB3aGlsZSAoaSA8IGxuKVxyXG4gICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICBvYmplY3QgQiA9IGxpc3RbaV07XHJcbiAgICAgICAgICAgICAgICBpZiAoU2NyaXB0LldyaXRlPGJvb2w+KFwiQSA9PSBCXCIpKVxyXG4gICAgICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgICAgIHJldHVybjtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIGkrKztcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBsaXN0LkFkZChpdGVtKTtcclxuICAgICAgICAgICAgLyppZiAoIWxpc3QuQ29udGFpbnMoaXRlbSkpXHJcbiAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgIGxpc3QuQWRkKGl0ZW0pO1xyXG4gICAgICAgICAgICB9Ki9cclxuICAgICAgICB9XHJcbiAgICAgICAgLy9wdWJsaWMgc3RhdGljIHZvaWQgUmVtb3ZlQWxsPFQ+KHRoaXMgSUVudW1lcmFibGU8VD4gbGlzdCwgQWN0aW9uPFQ+IGFjdGlvbilcclxuICAgICAgICBwdWJsaWMgc3RhdGljIHZvaWQgUmVtb3ZlQWxsPFQ+KHRoaXMgTGlzdDxUPiBsaXN0LCBGdW5jPFQsIGJvb2w+IHByZWRpY2F0ZSlcclxuICAgICAgICB7XHJcblxyXG4gICAgICAgICAgICAvL2ZvcmVhY2ggKHZhciBpdGVtIGluIGxpc3QpXHJcbiAgICAgICAgICAgIGludCBpID0gMDtcclxuICAgICAgICAgICAgd2hpbGUgKGkgPCBsaXN0LkNvdW50KVxyXG4gICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICB2YXIgaXRlbSA9IGxpc3RbaV07XHJcbiAgICAgICAgICAgICAgICAvL2FjdGlvbihpdGVtKTtcclxuICAgICAgICAgICAgICAgIGlmIChwcmVkaWNhdGUoaXRlbSkpXHJcbiAgICAgICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICAgICAgLy9saXN0LnJlbVxyXG4gICAgICAgICAgICAgICAgICAgIGxpc3QuUmVtb3ZlKGl0ZW0pO1xyXG4gICAgICAgICAgICAgICAgICAgIGktLTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIGkrKztcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgW1RlbXBsYXRlKFwieypsaXN0fS5wdXNoKHsqdmFsfSlcIildXHJcbiAgICAgICAgcHVibGljIHN0YXRpYyB2b2lkIFB1c2g8VD4odGhpcyBUW10gbGlzdCwgVCB2YWwpXHJcbiAgICAgICAge1xyXG4gICAgICAgICAgICBTY3JpcHQuV3JpdGUoXCJsaXN0LnB1c2godmFsKVwiKTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIHB1YmxpYyBzdGF0aWMgdm9pZCBQdXNoSWZOZXc8VD4odGhpcyBUW10gbGlzdCwgVCB2YWwpXHJcbiAgICAgICAge1xyXG4gICAgICAgICAgICBpZiAoIUNvbnRhaW5zQjxUPihsaXN0LCB2YWwpKVxyXG4gICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICBQdXNoPFQ+KGxpc3QsIHZhbCk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIHB1YmxpYyBzdGF0aWMgdm9pZCBQdXNoUmFuZ2U8VD4odGhpcyBUW10gbGlzdCwgcGFyYW1zIFRbXSB2YWwpXHJcbiAgICAgICAge1xyXG4gICAgICAgICAgICB2YXIgaSA9IDA7XHJcbiAgICAgICAgICAgIHdoaWxlIChpIDwgdmFsLkxlbmd0aClcclxuICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgUHVzaDxUPihsaXN0LCB2YWxbaV0pO1xyXG4gICAgICAgICAgICAgICAgaSsrO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBbVGVtcGxhdGUoXCJ7Kmxpc3R9LnBvcCgpXCIpXVxyXG4gICAgICAgIHB1YmxpYyBzdGF0aWMgVCBQb3A8VD4odGhpcyBUW10gbGlzdClcclxuICAgICAgICB7XHJcbiAgICAgICAgICAgIHJldHVybiBTY3JpcHQuV3JpdGU8VD4oXCJsaXN0LnBvcCgpXCIpO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgcHVibGljIHN0YXRpYyB2b2lkIENsZWFyPFQ+KHRoaXMgVFtdIGxpc3QpXHJcbiAgICAgICAge1xyXG4gICAgICAgICAgICBpbnQgaSA9IGxpc3QuTGVuZ3RoO1xyXG4gICAgICAgICAgICB3aGlsZSAoaS0tID4gMClcclxuICAgICAgICAgICAgICAgIGxpc3QuUG9wKCk7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBwdWJsaWMgc3RhdGljIHZvaWQgUmVwbGFjZUFsbDxUPih0aGlzIFRbXSBsaXN0LCBUW10gU291cmNlLCBUW10gRGVzdGluYXRpb24pXHJcbiAgICAgICAge1xyXG4gICAgICAgICAgICBpbnQgaSA9IC0xO1xyXG4gICAgICAgICAgICBpID0gSW5kZXhPZjxUPihsaXN0LCBTb3VyY2UsIGkgKyAxLCAzKTtcclxuICAgICAgICAgICAgdmFyIGxuID0gU291cmNlLkxlbmd0aDtcclxuICAgICAgICAgICAgd2hpbGUgKGkgPj0gMClcclxuICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgdmFyIGogPSAwO1xyXG5cclxuICAgICAgICAgICAgICAgIHdoaWxlIChqIDwgbG4pXHJcbiAgICAgICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICAgICAgbGlzdFtpICsgal0gPSBEZXN0aW5hdGlvbltqXTtcclxuICAgICAgICAgICAgICAgICAgICBqKys7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICBpID0gSW5kZXhPZjxUPihsaXN0LCBTb3VyY2UsIGkgKyAxLCAzKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuICAgICAgICBwdWJsaWMgc3RhdGljIFRbXSBXaGVyZUI8VD4odGhpcyBUW10gbGlzdCwgRnVuYzxULCBib29sPiBwcmVkaWNhdGUpXHJcbiAgICAgICAge1xyXG4gICAgICAgICAgICBvYmplY3RbXSByZXQgPSBuZXcgb2JqZWN0WzBdO1xyXG4gICAgICAgICAgICBpbnQgaSA9IDA7XHJcbiAgICAgICAgICAgIGludCBsbiA9IGxpc3QuTGVuZ3RoO1xyXG4gICAgICAgICAgICB3aGlsZSAoaSA8IGxuKVxyXG4gICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICB2YXIgaXRlbSA9IGxpc3RbaV07XHJcbiAgICAgICAgICAgICAgICBpZiAocHJlZGljYXRlKGl0ZW0pKVxyXG4gICAgICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgICAgIENpcm5vR2FtZS5IZWxwZXJFeHRlbnNpb25zLlB1c2g8b2JqZWN0PihyZXQsIGl0ZW0pO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgaSsrO1xyXG4gICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICByZXR1cm4gcmV0LkFzPFRbXT4oKTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIHB1YmxpYyBzdGF0aWMgYm9vbCBDb250YWluc0I8VD4odGhpcyBMaXN0PFQ+IGxpc3QsIG9iamVjdCBWYWx1ZSlcclxuICAgICAgICB7XHJcbiAgICAgICAgICAgIFRbXSBMID0gbGlzdFtcIml0ZW1zXCJdLkFzPFRbXT4oKTtcclxuICAgICAgICAgICAgcmV0dXJuIENvbnRhaW5zQjxUPihMLCBWYWx1ZSk7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBwdWJsaWMgc3RhdGljIGJvb2wgQ29udGFpbnNCPFQ+KHRoaXMgVFtdIGxpc3QsIG9iamVjdCBWYWx1ZSlcclxuICAgICAgICB7XHJcbiAgICAgICAgICAgIGludCBpID0gMDtcclxuICAgICAgICAgICAgaW50IGxuID0gbGlzdC5MZW5ndGg7XHJcbiAgICAgICAgICAgIHdoaWxlIChpIDwgbG4pXHJcbiAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgIG9iamVjdCBPID0gbGlzdFtpXTtcclxuICAgICAgICAgICAgICAgIGlmIChTY3JpcHQuV3JpdGU8Ym9vbD4oXCJPID09IFZhbHVlXCIpKVxyXG4gICAgICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgICAgIHJldHVybiB0cnVlO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgaSsrO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIHJldHVybiBmYWxzZTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIHB1YmxpYyBzdGF0aWMgaW50IEluZGV4T2Y8VD4odGhpcyBUW10gbGlzdCwgVFtdIFZhbHVlLCBpbnQgaW5kZXggPSAwLCBpbnQgc3RydWN0dXJlU2l6ZSA9IDEpXHJcbiAgICAgICAge1xyXG4gICAgICAgICAgICBpbnQgaSA9IGluZGV4O1xyXG4gICAgICAgICAgICB2YXIgbG4gPSBsaXN0Lkxlbmd0aDtcclxuICAgICAgICAgICAgdmFyIHZsbiA9IFZhbHVlLkxlbmd0aDtcclxuICAgICAgICAgICAgb2JqZWN0IE8gPSBWYWx1ZVswXTtcclxuICAgICAgICAgICAgb2JqZWN0IEE7XHJcbiAgICAgICAgICAgIG9iamVjdCBCO1xyXG4gICAgICAgICAgICB3aGlsZSAoaSA8IGxuICYmIGkgPj0gMClcclxuICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgLyp2YXIgYyA9IGkrMTtcclxuICAgICAgICAgICAgICAgIGkgPSAtMTtcclxuICAgICAgICAgICAgICAgIEIgPSBWYWx1ZVswXTtcclxuICAgICAgICAgICAgICAgIHdoaWxlIChjIDwgbGlzdC5MZW5ndGggJiYgaT09LTEpXHJcbiAgICAgICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICAgICAgQSA9IGxpc3RbY107XHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKEEgPT0gQilcclxuICAgICAgICAgICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGkgPSBjO1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICBjKys7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICBpZiAoaSA9PSAtMSlcclxuICAgICAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgICAgICByZXR1cm4gLTE7XHJcbiAgICAgICAgICAgICAgICB9Ki9cclxuICAgICAgICAgICAgICAgIGkgPSBsaXN0LkluZGV4T2YoTy5BczxzdHJpbmc+KCksIGkgKyAxKTtcclxuICAgICAgICAgICAgICAgIHdoaWxlIChpID49IDAgJiYgaSAlIHN0cnVjdHVyZVNpemUgPiAwKVxyXG4gICAgICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgICAgIGkgPSBsaXN0LkluZGV4T2YoTy5BczxzdHJpbmc+KCksIGkgKyAxKTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIGlmIChpID09IC0xKVxyXG4gICAgICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgICAgIHJldHVybiAtMTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIHZhciBrID0gMTtcclxuICAgICAgICAgICAgICAgIHZhciBsID0gaSArIDE7XHJcblxyXG4gICAgICAgICAgICAgICAgaWYgKGkgPCBsbiAmJiBpID49IDApXHJcbiAgICAgICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICAgICAgYm9vbCBvayA9IHRydWU7XHJcbiAgICAgICAgICAgICAgICAgICAgd2hpbGUgKG9rICYmIGsgPCB2bG4pXHJcbiAgICAgICAgICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBBID0gbGlzdFtsXTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgQiA9IFZhbHVlW2tdO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAoQSAhPSBCKVxyXG4gICAgICAgICAgICAgICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBvayA9IGZhbHNlO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGsrKztcclxuICAgICAgICAgICAgICAgICAgICAgICAgbCsrO1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICBpZiAob2spXHJcbiAgICAgICAgICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gaTtcclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgcmV0dXJuIC0xO1xyXG4gICAgICAgIH1cclxuICAgICAgICBwdWJsaWMgc3RhdGljIGJvb2wgSWRlbnRpY2FsPFQ+KHRoaXMgVFtdIGxpc3QsIFRbXSBsaXN0MilcclxuICAgICAgICB7XHJcbiAgICAgICAgICAgIGlmIChsaXN0ID09IGxpc3QyKVxyXG4gICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gdHJ1ZTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBpZiAobGlzdCA9PSBudWxsIHx8IGxpc3QyID09IG51bGwpXHJcbiAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB2YXIgbG4gPSBsaXN0Lkxlbmd0aDtcclxuICAgICAgICAgICAgaWYgKGxuID09IGxpc3QyLkxlbmd0aClcclxuICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgaW50IGkgPSAwO1xyXG5cclxuICAgICAgICAgICAgICAgIHdoaWxlIChpIDwgbG4pXHJcbiAgICAgICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICAgICAgb2JqZWN0IEEgPSBsaXN0W2ldO1xyXG4gICAgICAgICAgICAgICAgICAgIG9iamVjdCBCID0gbGlzdDJbaV07XHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKEEgIT0gQilcclxuICAgICAgICAgICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZTtcclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgaSsrO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgcmV0dXJuIHRydWU7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xyXG4gICAgICAgIH1cclxuICAgICAgICBwdWJsaWMgc3RhdGljIHZvaWQgUmV2ZXJzZU9yZGVyV2l0aFN0cnVjdHVyZTxUPih0aGlzIFRbXSBsaXN0LCBpbnQgc2l6ZSlcclxuICAgICAgICB7XHJcbiAgICAgICAgICAgIC8vVFtdIHJldCA9IG5ldyBUWzBdO1xyXG4gICAgICAgICAgICBMaXN0PFQ+IHJldCA9IG5ldyBMaXN0PFQ+KCk7XHJcbiAgICAgICAgICAgIGludCBpID0gMDtcclxuICAgICAgICAgICAgaW50IGxuID0gbGlzdC5MZW5ndGg7XHJcbiAgICAgICAgICAgIHdoaWxlIChpIDwgbG4pXHJcbiAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgIGludCBqID0gMDtcclxuICAgICAgICAgICAgICAgIHdoaWxlIChqIDwgc2l6ZSlcclxuICAgICAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgICAgICAvL3JldC5QdXNoKGxpc3Rbal0pO1xyXG4gICAgICAgICAgICAgICAgICAgIHJldC5JbnNlcnQoMCwgbGlzdFsoc2l6ZSAtIDEpIC0gal0pO1xyXG4gICAgICAgICAgICAgICAgICAgIGorKztcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIGkgKz0gc2l6ZTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuICAgICAgICBwdWJsaWMgc3RhdGljIHZvaWQgQ2xlYXIodGhpcyBDYW52YXNSZW5kZXJpbmdDb250ZXh0MkQgRylcclxuICAgICAgICB7XHJcbiAgICAgICAgICAgIHZhciBDID0gRy5DYW52YXM7XHJcbiAgICAgICAgICAgIEcuQ2xlYXJSZWN0KDAsIDAsIEMuV2lkdGgsIEMuSGVpZ2h0KTtcclxuICAgICAgICB9XHJcbiAgICAgICAgLy8vIDxzdW1tYXJ5PlxyXG4gICAgICAgIC8vLyBub3QgeWV0IHRlc3RlZCB3aXRoIGRlZXAgaW5oZXJpdGVuY2UuLi5cclxuICAgICAgICAvLy8gPC9zdW1tYXJ5PlxyXG4gICAgICAgIC8vLyA8cGFyYW0gbmFtZT1cIlRcIj48L3BhcmFtPlxyXG4gICAgICAgIC8vLyA8cGFyYW0gbmFtZT1cImluc3RhbmNlXCI+PC9wYXJhbT5cclxuICAgICAgICAvLy8gPHJldHVybnM+PC9yZXR1cm5zPlxyXG4gICAgICAgIHB1YmxpYyBzdGF0aWMgYm9vbCBJc0luc3RhbmNlT2ZUeXBlRmFzdCh0aGlzIFR5cGUgVCwgb2JqZWN0IGluc3RhbmNlKVxyXG4gICAgICAgIHtcclxuICAgICAgICAgICAgdmFyIEMgPSBpbnN0YW5jZS5BczxkeW5hbWljPigpLmN0b3I7XHJcbiAgICAgICAgICAgIG9iamVjdFtdIEEgPSBUW1wiJCRpbmhlcml0b3JzXCJdLkFzPGR5bmFtaWM+KCk7Ly9saXN0IG9mIGFsbCB0eXBlcyB0aGF0IGluaGVyaXQgZnJvbSB0aGlzIHR5cGVcclxuICAgICAgICAgICAgcmV0dXJuIChDID09IFQgfHwgKEEgIT0gbnVsbCAmJiBBLkluZGV4T2YoQykgPj0gMCkpO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICB9XHJcbn1cclxuIiwidXNpbmcgU3lzdGVtO1xyXG51c2luZyBTeXN0ZW0uQ29sbGVjdGlvbnMuR2VuZXJpYztcclxudXNpbmcgU3lzdGVtLkxpbnE7XHJcbnVzaW5nIFN5c3RlbS5UZXh0O1xyXG51c2luZyBTeXN0ZW0uVGhyZWFkaW5nLlRhc2tzO1xyXG5cclxubmFtZXNwYWNlIENpcm5vR2FtZVxyXG57XHJcbiAgICBwdWJsaWMgY2xhc3MgSW5wdXRDb250cm9sbGVyXHJcbiAgICB7XHJcbiAgICAgICAgcHVibGljIHN0YXRpYyBpbnQgTnVtYmVyT2ZBY3Rpb25zID0gODtcclxuICAgICAgICBwcm90ZWN0ZWQgc3RhdGljIEdhbWVQYWRNYW5hZ2VyIEdNO1xyXG4gICAgICAgIHB1YmxpYyBMaXN0PElucHV0TWFwPiBJbnB1dE1hcHBpbmc7XHJcblxyXG4gICAgICAgIHB1YmxpYyBzdHJpbmcgaWQgeyBnZXQ7IHByb3RlY3RlZCBzZXQ7IH1cclxuXHJcbiAgICAgICAgcHVibGljIElucHV0Q29udHJvbGxlcihzdHJpbmcgaWQgPSBcIktleWJvYXJkXCIpXHJcbiAgICAgICAge1xyXG4gICAgICAgICAgICB0aGlzLmlkID0gaWQ7XHJcbiAgICAgICAgICAgIElucHV0TWFwcGluZyA9IG5ldyBMaXN0PElucHV0TWFwPigpO1xyXG5cclxuICAgICAgICAgICAgaWYgKGlkID09IFwiS2V5Ym9hcmRcIilcclxuICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgaW5pdGtleWJvYXJkKCk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgZWxzZVxyXG4gICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICBpbml0Z2FtZXBhZCgpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIGlmIChHTSA9PSBudWxsKVxyXG4gICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICBpZiAoR2FtZVBhZE1hbmFnZXIuX3RoaXMgPT0gbnVsbClcclxuICAgICAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgICAgICBHYW1lUGFkTWFuYWdlci5fdGhpcyA9IG5ldyBHYW1lUGFkTWFuYWdlcigpO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgR00gPSBHYW1lUGFkTWFuYWdlci5fdGhpcztcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuICAgICAgICBwdWJsaWMgZHluYW1pYyBDb3B5TWFwKClcclxuICAgICAgICB7XHJcbiAgICAgICAgICAgIC8qZHluYW1pYyBEID0gbmV3IG9iamVjdCgpO1xyXG4gICAgICAgICAgICByZXR1cm4gRDsqL1xyXG4gICAgICAgICAgICBzdHJpbmdbXSBmaWVsZHMgPSBuZXcgc3RyaW5nW10geyBcIm1hcFwiLCBcImFudGltYXBcIiwgXCJuYW1lXCIsIFwiYXhpc1wiLCBcImNvbnRyb2xsZXJJRFwiIH07XHJcbiAgICAgICAgICAgIGR5bmFtaWNbXSByZXQgPSBuZXcgZHluYW1pY1tJbnB1dE1hcHBpbmcuQ291bnRdO1xyXG4gICAgICAgICAgICBpbnQgaSA9IDA7XHJcbiAgICAgICAgICAgIHdoaWxlIChpIDwgcmV0Lkxlbmd0aClcclxuICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgcmV0W2ldID0gSGVscGVyLk1ha2VTaGFsbG93Q29weShJbnB1dE1hcHBpbmdbaV0sIGZpZWxkcyk7XHJcbiAgICAgICAgICAgICAgICBpKys7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgcmV0dXJuIHJldDtcclxuICAgICAgICB9XHJcbiAgICAgICAgcHVibGljIHZvaWQgQ29weUZyb21NYXAoZHluYW1pY1tdIE1hcClcclxuICAgICAgICB7XHJcbiAgICAgICAgICAgIHN0cmluZ1tdIGZpZWxkcyA9IG5ldyBzdHJpbmdbXSB7IFwibWFwXCIsIFwiYW50aW1hcFwiLCBcIm5hbWVcIiwgXCJheGlzXCIsIFwiY29udHJvbGxlcklEXCIgfTtcclxuXHJcbiAgICAgICAgICAgIGludCBpID0gMDtcclxuICAgICAgICAgICAgd2hpbGUgKGkgPCBNYXAuTGVuZ3RoKVxyXG4gICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICBpZiAoaSA+PSBJbnB1dE1hcHBpbmcuQ291bnQpXHJcbiAgICAgICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICAgICAgSW5wdXRNYXBwaW5nLkFkZChuZXcgSW5wdXRNYXAoKSk7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICBJbnB1dE1hcCBJTSA9IElucHV0TWFwcGluZ1tpXTtcclxuICAgICAgICAgICAgICAgIEhlbHBlci5Db3B5RmllbGRzKE1hcFtpXSwgSU0sIGZpZWxkcyk7XHJcbiAgICAgICAgICAgICAgICAvL3JldFtpXSA9IEhlbHBlci5NYWtlU2hhbGxvd0NvcHkoSW5wdXRNYXBwaW5nW2ldLCBmaWVsZHMpO1xyXG4gICAgICAgICAgICAgICAgaSsrO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHByb3RlY3RlZCB2b2lkIGluaXRrZXlib2FyZCgpXHJcbiAgICAgICAge1xyXG4gICAgICAgICAgICBpbnQgaSA9IDA7XHJcbiAgICAgICAgICAgIHdoaWxlIChpIDwgTnVtYmVyT2ZBY3Rpb25zKVxyXG4gICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICBJbnB1dE1hcCBtYXAgPSBuZXcgSW5wdXRNYXAoLTEpO1xyXG4gICAgICAgICAgICAgICAgaWYgKGkgPT0gMClcclxuICAgICAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgICAgICBtYXAubWFwID0gMzk7XHJcbiAgICAgICAgICAgICAgICAgICAgbWFwLmFudGltYXAgPSAzNztcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgLyptYXAubWFwID0gNjg7XHJcbiAgICAgICAgICAgICAgICAgICAgbWFwLmFudGltYXA9IDY1OyovXHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICBpZiAoaSA9PSAxKVxyXG4gICAgICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgICAgIG1hcC5tYXAgPSA0MDtcclxuICAgICAgICAgICAgICAgICAgICBtYXAuYW50aW1hcCA9IDM4O1xyXG5cclxuICAgICAgICAgICAgICAgICAgICAvKm1hcC5tYXAgPSA4MztcclxuICAgICAgICAgICAgICAgICAgICBtYXAuYW50aW1hcCA9IDg3OyovXHJcbiAgICAgICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICAgICAgaWYgKGkgPT0gMilcclxuICAgICAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgICAgICAvL21hcC5tYXAgPSAzMjtcclxuICAgICAgICAgICAgICAgICAgICBtYXAubWFwID0gOTA7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICBpZiAoaSA9PSAzKVxyXG4gICAgICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgICAgIG1hcC5tYXAgPSA4ODtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIGlmIChpID09IDQpXHJcbiAgICAgICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICAgICAgbWFwLm1hcCA9IDY1Oy8vYVxyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgaWYgKGkgPT0gNSlcclxuICAgICAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgICAgICBtYXAubWFwID0gMTM7Ly9lbnRlclxyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgSW5wdXRNYXBwaW5nLkFkZChtYXApO1xyXG4gICAgICAgICAgICAgICAgaSsrO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHByb3RlY3RlZCB2b2lkIGluaXRnYW1lcGFkKClcclxuICAgICAgICB7XHJcbiAgICAgICAgICAgIGludCBpID0gMDtcclxuICAgICAgICAgICAgd2hpbGUgKGkgPCBOdW1iZXJPZkFjdGlvbnMpXHJcbiAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgIElucHV0TWFwIG1hcCA9IG5ldyBJbnB1dE1hcCgtMSk7XHJcbiAgICAgICAgICAgICAgICBpZiAoaSA9PSAwKVxyXG4gICAgICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgICAgIG1hcC5tYXAgPSAwO1xyXG4gICAgICAgICAgICAgICAgICAgIG1hcC5heGlzID0gdHJ1ZTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIGlmIChpID09IDEpXHJcbiAgICAgICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICAgICAgbWFwLm1hcCA9IDE7XHJcbiAgICAgICAgICAgICAgICAgICAgbWFwLmF4aXMgPSB0cnVlO1xyXG4gICAgICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgICAgIGlmIChpID4gMSlcclxuICAgICAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgICAgICBtYXAubWFwID0gaSAtIDI7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICBJbnB1dE1hcHBpbmcuQWRkKG1hcCk7XHJcbiAgICAgICAgICAgICAgICBpKys7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcbiAgICAgICAgcHVibGljIGZsb2F0IGdldFN0YXRlKGludCBhY3Rpb24sIElucHV0TWFwIG1hcCA9IG51bGwpXHJcbiAgICAgICAge1xyXG4gICAgICAgICAgICBpZiAobWFwID09IG51bGwpXHJcbiAgICAgICAgICAgICAgICBtYXAgPSBJbnB1dE1hcHBpbmdbYWN0aW9uXTtcclxuICAgICAgICAgICAgLypJbnB1dENvbnRyb2xsZXIgSUMgPSB0aGlzO1xyXG4gICAgICAgICAgICBpZiAobWFwLmNvbnRyb2xsZXIgIT0gbnVsbClcclxuICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgSUMgPSBtYXAuY29udHJvbGxlcjtcclxuICAgICAgICAgICAgfSovXHJcbiAgICAgICAgICAgIHN0cmluZyBUSUQgPSBpZDtcclxuICAgICAgICAgICAgaWYgKG1hcC5jb250cm9sbGVySUQgIT0gXCJcIilcclxuICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgVElEID0gbWFwLmNvbnRyb2xsZXJJRDtcclxuICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgaWYgKFRJRCA9PSBcIktleWJvYXJkXCIpXHJcbiAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgIHJldHVybiBnZXRLZXlib2FyZE1hcFN0YXRlKG1hcCk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgZWxzZSBpZiAoVElEID09IFwiTW91c2VcIilcclxuICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuIGdldE1vdXNlTWFwU3RhdGUobWFwKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBlbHNlXHJcbiAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgIHJldHVybiBnZXRHYW1lcGFkTWFwU3RhdGUobWFwKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICByZXR1cm4gMDtcclxuICAgICAgICB9XHJcbiAgICAgICAgcHVibGljIGJvb2wgZ2V0UHJlc3NlZChpbnQgYWN0aW9uLCBJbnB1dE1hcCBtYXAgPSBudWxsKVxyXG4gICAgICAgIHtcclxuICAgICAgICAgICAgcmV0dXJuIGdldFN0YXRlKGFjdGlvbiwgbWFwKSA+PSAwLjdmO1xyXG4gICAgICAgIH1cclxuICAgICAgICBwdWJsaWMgSW5wdXRNYXAgRmluZEFueVByZXNzZWRHYW1lUGFkSW5wdXQoKVxyXG4gICAgICAgIHtcclxuICAgICAgICAgICAgSW5wdXRNYXAgcmV0ID0gbmV3IElucHV0TWFwKCk7XHJcbiAgICAgICAgICAgIExpc3Q8R2FtZVBhZD4gTCA9IEdhbWVQYWRNYW5hZ2VyLl90aGlzLmFjdGl2ZUdhbWVwYWRzO1xyXG4gICAgICAgICAgICBMLkZvckVhY2goKGdsb2JhbDo6U3lzdGVtLkFjdGlvbjxnbG9iYWw6OkNpcm5vR2FtZS5HYW1lUGFkPikoRyA9PlxyXG4gICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICBpZiAocmV0Lm1hcCA9PSAtMSlcclxuICAgICAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgICAgICByZXQuY29udHJvbGxlcklEID0gRy5pZDtcclxuICAgICAgICAgICAgICAgICAgICBHYW1lUGFkQnV0dG9uW10gR0IgPSBTeXN0ZW0uTGlucS5FbnVtZXJhYmxlLldoZXJlPGdsb2JhbDo6Q2lybm9HYW1lLkdhbWVQYWRCdXR0b24+KEcuYnV0dG9ucywoZ2xvYmFsOjpTeXN0ZW0uRnVuYzxnbG9iYWw6OkNpcm5vR2FtZS5HYW1lUGFkQnV0dG9uLCBib29sPikoQiA9PiBCLnByZXNzZWQpKS5Ub0FycmF5KCk7XHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKEdCLkxlbmd0aCA+IDApXHJcbiAgICAgICAgICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICByZXQuYXhpcyA9IGZhbHNlO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBHYW1lUGFkQnV0dG9uIHRtcCA9IEdCWzBdO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICByZXQubWFwID0gbmV3IExpc3Q8R2FtZVBhZEJ1dHRvbj4oRy5idXR0b25zKS5JbmRleE9mKHRtcCk7XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgIGVsc2VcclxuICAgICAgICAgICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGludCBpID0gMDtcclxuICAgICAgICAgICAgICAgICAgICAgICAgd2hpbGUgKGkgPCBHLmF4ZXMuTGVuZ3RoICYmIHJldC5tYXAgPT0gLTEpXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChNYXRoLkFicyhHLmF4ZXNbaV0pID4gMC43ICYmIE1hdGguQWJzKEcuYXhlc1tpXSkgPCAyLjApXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0LmF4aXMgPSB0cnVlO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldC5tYXAgPSBpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChHLmF4ZXNbaV0gPCAwKVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0Lm5hbWUgPSBcImFudGlcIjtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0LmFudGltYXAgPSBpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGkrKztcclxuICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfVxyXG4pICAgICAgICAgICAgICAgICk7XHJcbiAgICAgICAgICAgIGlmIChyZXQubWFwICE9IC0xKVxyXG4gICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gcmV0O1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIHJldHVybiBudWxsO1xyXG4gICAgICAgIH1cclxuICAgICAgICBwdWJsaWMgc3RyaW5nIGdldE1hcENvbnRyb2xsZXJJRChJbnB1dE1hcCBtYXApXHJcbiAgICAgICAge1xyXG4gICAgICAgICAgICBpZiAobWFwLmNvbnRyb2xsZXJJRCAhPSBcIlwiKVxyXG4gICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gbWFwLmNvbnRyb2xsZXJJRDtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBlbHNlXHJcbiAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgIHJldHVybiBpZDtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuICAgICAgICBwdWJsaWMgc3RyaW5nIGdldE1hcENvbnRyb2xsZXJJRChpbnQgYWN0aW9uKVxyXG4gICAgICAgIHtcclxuICAgICAgICAgICAgcmV0dXJuIGdldE1hcENvbnRyb2xsZXJJRChJbnB1dE1hcHBpbmdbYWN0aW9uXSk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHByb3RlY3RlZCBmbG9hdCBnZXRHYW1lcGFkTWFwU3RhdGUoSW5wdXRNYXAgbWFwKVxyXG4gICAgICAgIHtcclxuICAgICAgICAgICAgc3RyaW5nIFRJRCA9IGlkO1xyXG4gICAgICAgICAgICBpZiAobWFwLmNvbnRyb2xsZXJJRCAhPSBcIlwiKVxyXG4gICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICBUSUQgPSBtYXAuY29udHJvbGxlcklEO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIEdhbWVQYWQgUCA9IEdhbWVQYWRNYW5hZ2VyLl90aGlzLkdldFBhZChUSUQpO1xyXG4gICAgICAgICAgICBpZiAoUCA9PSBudWxsIHx8ICFQLmNvbm5lY3RlZClcclxuICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuIDA7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgaWYgKCFtYXAuYXhpcylcclxuICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgaWYgKFAuYnV0dG9uc1ttYXAubWFwXS5wcmVzc2VkKVxyXG4gICAgICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgICAgIHJldHVybiAxO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgZWxzZSBpZiAobWFwLmFudGltYXAgPj0gMCAmJiBQLmJ1dHRvbnNbbWFwLmFudGltYXBdLnByZXNzZWQpXHJcbiAgICAgICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIC0xO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgcmV0dXJuIDA7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgZWxzZVxyXG4gICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gKGZsb2F0KVAuYXhlc1ttYXAubWFwXTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuICAgICAgICBwcm90ZWN0ZWQgZmxvYXQgZ2V0S2V5Ym9hcmRNYXBTdGF0ZShJbnB1dE1hcCBtYXApXHJcbiAgICAgICAge1xyXG4gICAgICAgICAgICBMaXN0PGludD4gTCA9IEtleWJvYXJkTWFuYWdlci5fdGhpcy5QcmVzc2VkQnV0dG9ucztcclxuICAgICAgICAgICAgaWYgKEwuQ29udGFpbnMobWFwLm1hcCkpXHJcbiAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgIHJldHVybiAxZjtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBlbHNlIGlmIChMLkNvbnRhaW5zKG1hcC5hbnRpbWFwKSlcclxuICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuIC0xZjtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICByZXR1cm4gMDtcclxuICAgICAgICB9XHJcbiAgICAgICAgcHJvdGVjdGVkIGZsb2F0IGdldE1vdXNlTWFwU3RhdGUoSW5wdXRNYXAgbWFwKVxyXG4gICAgICAgIHtcclxuICAgICAgICAgICAgTGlzdDxpbnQ+IEwgPSBLZXlib2FyZE1hbmFnZXIuX3RoaXMuUHJlc3NlZE1vdXNlQnV0dG9ucztcclxuICAgICAgICAgICAgaWYgKEwuQ29udGFpbnMobWFwLm1hcCkpXHJcbiAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgIHJldHVybiAxZjtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBlbHNlIGlmIChMLkNvbnRhaW5zKG1hcC5hbnRpbWFwKSlcclxuICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuIC0xZjtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICByZXR1cm4gMDtcclxuICAgICAgICB9XHJcblxyXG5cclxuICAgIH1cclxufVxyXG4iLCJ1c2luZyBTeXN0ZW07XHJcbnVzaW5nIFN5c3RlbS5Db2xsZWN0aW9ucy5HZW5lcmljO1xyXG51c2luZyBTeXN0ZW0uTGlucTtcclxudXNpbmcgU3lzdGVtLlRleHQ7XHJcbnVzaW5nIFN5c3RlbS5UaHJlYWRpbmcuVGFza3M7XHJcblxyXG5uYW1lc3BhY2UgQ2lybm9HYW1lXHJcbntcclxuICAgIHB1YmxpYyBjbGFzcyBJbnB1dENvbnRyb2xsZXJNYW5hZ2VyXHJcbiAgICB7XHJcbiAgICAgICAgcHVibGljIExpc3Q8SW5wdXRDb250cm9sbGVyPiBDb250cm9sbGVycztcclxuICAgICAgICBwdWJsaWMgc3RhdGljIElucHV0Q29udHJvbGxlck1hbmFnZXIgX3RoaXNcclxuICAgICAgICB7XHJcbiAgICAgICAgICAgIGdldFxyXG4gICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICBpZiAoX190aGlzID09IG51bGwpXHJcbiAgICAgICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICAgICAgX190aGlzID0gbmV3IElucHV0Q29udHJvbGxlck1hbmFnZXIoKTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIHJldHVybiBfX3RoaXM7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcbiAgICAgICAgcHVibGljIHN0YXRpYyB2b2lkIEluaXQoKVxyXG4gICAgICAgIHtcclxuICAgICAgICAgICAgaWYgKF9fdGhpcyA9PSBudWxsKVxyXG4gICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICBfX3RoaXMgPSBuZXcgSW5wdXRDb250cm9sbGVyTWFuYWdlcigpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHByb3RlY3RlZCBzdGF0aWMgSW5wdXRDb250cm9sbGVyTWFuYWdlciBfX3RoaXM7XHJcbiAgICAgICAgcHJvdGVjdGVkIElucHV0Q29udHJvbGxlck1hbmFnZXIoKVxyXG4gICAgICAgIHtcclxuICAgICAgICAgICAgQ29udHJvbGxlcnMgPSBuZXcgTGlzdDxJbnB1dENvbnRyb2xsZXI+KCk7XHJcblxyXG4gICAgICAgICAgICBDb250cm9sbGVycy5BZGQobmV3IElucHV0Q29udHJvbGxlcigpKTtcclxuICAgICAgICAgICAgTGlzdDxHYW1lUGFkPiBnYW1lcGFkcyA9IEdhbWVQYWRNYW5hZ2VyLl90aGlzLmFjdGl2ZUdhbWVwYWRzO1xyXG4gICAgICAgICAgICBpbnQgaSA9IDA7XHJcbiAgICAgICAgICAgIHdoaWxlIChpIDwgZ2FtZXBhZHMuQ291bnQpXHJcbiAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgIENvbnRyb2xsZXJzLkFkZChuZXcgSW5wdXRDb250cm9sbGVyKGdhbWVwYWRzW2ldLmlkKSk7XHJcbiAgICAgICAgICAgICAgICBpKys7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcbiAgICB9XHJcbn1cclxuIiwidXNpbmcgU3lzdGVtO1xyXG51c2luZyBTeXN0ZW0uQ29sbGVjdGlvbnMuR2VuZXJpYztcclxudXNpbmcgU3lzdGVtLkxpbnE7XHJcbnVzaW5nIFN5c3RlbS5UZXh0O1xyXG51c2luZyBTeXN0ZW0uVGhyZWFkaW5nLlRhc2tzO1xyXG5cclxubmFtZXNwYWNlIENpcm5vR2FtZVxyXG57XHJcbiAgICBwdWJsaWMgY2xhc3MgSW5wdXRNYXBcclxuICAgIHtcclxuICAgICAgICBwdWJsaWMgaW50IG1hcCA9IC0xO1xyXG4gICAgICAgIHB1YmxpYyBpbnQgYW50aW1hcCA9IC0xO1xyXG4gICAgICAgIHB1YmxpYyBzdHJpbmcgbmFtZSA9IFwiXCI7XHJcbiAgICAgICAgcHVibGljIGJvb2wgYXhpcyA9IGZhbHNlO1xyXG4gICAgICAgIC8vcHVibGljIElucHV0Q29udHJvbGxlciBjb250cm9sbGVyO1xyXG4gICAgICAgIHB1YmxpYyBzdHJpbmcgY29udHJvbGxlcklEID0gXCJcIjtcclxuICAgICAgICBwdWJsaWMgSW5wdXRNYXAoKVxyXG4gICAgICAgIHtcclxuICAgICAgICAgICAgYXhpcyA9IGZhbHNlO1xyXG4gICAgICAgIH1cclxuICAgICAgICBwdWJsaWMgSW5wdXRNYXAoaW50IG1hcCwgaW50IGFudGltYXAgPSAtMSwgYm9vbCBheGlzID0gZmFsc2UpXHJcbiAgICAgICAge1xyXG4gICAgICAgICAgICB0aGlzLm1hcCA9IG1hcDtcclxuICAgICAgICAgICAgdGhpcy5hbnRpbWFwID0gYW50aW1hcDtcclxuICAgICAgICAgICAgdGhpcy5heGlzID0gYXhpcztcclxuICAgICAgICB9XHJcbiAgICB9XHJcbn1cclxuIiwidXNpbmcgU3lzdGVtO1xyXG51c2luZyBTeXN0ZW0uQ29sbGVjdGlvbnMuR2VuZXJpYztcclxudXNpbmcgU3lzdGVtLkxpbnE7XHJcbnVzaW5nIFN5c3RlbS5UZXh0O1xyXG51c2luZyBTeXN0ZW0uVGhyZWFkaW5nLlRhc2tzO1xyXG51c2luZyBCcmlkZ2U7XHJcbnVzaW5nIEJyaWRnZS5IdG1sNTtcclxuXHJcbm5hbWVzcGFjZSBDaXJub0dhbWVcclxue1xyXG4gICAgcHVibGljIGNsYXNzIEpTT05BcmNoaXZlXHJcbiAgICB7XHJcbiAgICAgICAgLy91c2UgRm9sZGVyMkpTT04gdG8gY3JlYXRlIHRoZSBhcmNoaXZlLlxyXG5cclxuICAgICAgICAvL3B1YmxpYyBzdHJpbmcgQXJjaGl2ZTtcclxuICAgICAgICBwdWJsaWMgRGljdGlvbmFyeTxzdHJpbmcsIHN0cmluZz4gRGF0YSA9IG5ldyBEaWN0aW9uYXJ5PHN0cmluZywgc3RyaW5nPigpO1xyXG4gICAgICAgIHB1YmxpYyBEaWN0aW9uYXJ5PHN0cmluZywgSFRNTEltYWdlRWxlbWVudD4gSW1hZ2VzID0gbmV3IERpY3Rpb25hcnk8c3RyaW5nLCBIVE1MSW1hZ2VFbGVtZW50PigpO1xyXG4gICAgICAgIHB1YmxpYyBKU09OQXJjaGl2ZShzdHJpbmcgQXJjaGl2ZSlcclxuICAgICAgICB7XHJcbiAgICAgICAgICAgIC8vdGhpcy5BcmNoaXZlID0gQXJjaGl2ZTtcclxuICAgICAgICAgICAgc3RyaW5nW11bXSBEID0gU2NyaXB0LldyaXRlPGR5bmFtaWM+KFwiSlNPTi5wYXJzZShBcmNoaXZlKVwiKTtcclxuICAgICAgICAgICAgdmFyIGkgPSAwO1xyXG4gICAgICAgICAgICB2YXIgbG4gPSBELkxlbmd0aDtcclxuICAgICAgICAgICAgd2hpbGUgKGkgPCBsbilcclxuICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgdmFyIEEgPSBEW2krK107XHJcbiAgICAgICAgICAgICAgICBEYXRhW0FbMF0uVG9Mb3dlcigpXSA9IEFbMV07XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcbiAgICAgICAgcHVibGljIHN0YXRpYyB2b2lkIE9wZW4oc3RyaW5nIEFyY2hpdmVGaWxlLCBBY3Rpb248SlNPTkFyY2hpdmU+IGFjdGlvbilcclxuICAgICAgICB7XHJcbiAgICAgICAgICAgIFhNTEh0dHBSZXF1ZXN0IFhIUiA9IG5ldyBYTUxIdHRwUmVxdWVzdCgpO1xyXG4gICAgICAgICAgICAvL1hIUi5SZXNwb25zZVR5cGUgPSBYTUxIdHRwUmVxdWVzdFJlc3BvbnNlVHlwZS5CbG9iO1xyXG4gICAgICAgICAgICBYSFIuT25Mb2FkID0gRXZ0ID0+XHJcbiAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgIGFjdGlvbihuZXcgSlNPTkFyY2hpdmUoWEhSLlJlc3BvbnNlVGV4dCkpO1xyXG4gICAgICAgICAgICB9O1xyXG4gICAgICAgICAgICBYSFIuT3BlbihcIkdFVFwiLCBBcmNoaXZlRmlsZSwgZmFsc2UpO1xyXG4gICAgICAgICAgICBYSFIuU2VuZCgpO1xyXG4gICAgICAgICAgICAvL2lmIChYSFIuU3RhdHVzKVxyXG5cclxuICAgICAgICB9XHJcbiAgICAgICAgcHVibGljIHZvaWQgUHJlbG9hZEltYWdlcyhBY3Rpb24gYWN0aW9uLCBpbnQgZGVsYXkgPSAxMDApXHJcbiAgICAgICAge1xyXG4gICAgICAgICAgICB2YXIgSyA9IFN5c3RlbS5MaW5xLkVudW1lcmFibGUuVG9BcnJheTxzdHJpbmc+KERhdGEuS2V5cyk7XHJcbiAgICAgICAgICAgIHZhciBpID0gMDtcclxuICAgICAgICAgICAgd2hpbGUgKGkgPCBEYXRhLkNvdW50KVxyXG4gICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICB2YXIgQSA9IEtbaV07XHJcbiAgICAgICAgICAgICAgICBHZXRJbWFnZShBKTtcclxuICAgICAgICAgICAgICAgIGkrKztcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBHbG9iYWwuU2V0VGltZW91dCgoZ2xvYmFsOjpTeXN0ZW0uQWN0aW9uKWFjdGlvbiwgZGVsYXkpO1xyXG4gICAgICAgIH1cclxuICAgICAgICBwdWJsaWMgc3RyaW5nIEdldERhdGEoc3RyaW5nIGZpbGUpXHJcbiAgICAgICAge1xyXG4gICAgICAgICAgICB2YXIgZiA9IGZpbGUuVG9Mb3dlcigpO1xyXG4gICAgICAgICAgICBpZiAoRGF0YS5Db250YWluc0tleShmKSlcclxuICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuIERhdGFbZl07XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgcmV0dXJuIG51bGw7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHB1YmxpYyBIVE1MSW1hZ2VFbGVtZW50IEdldEltYWdlKHN0cmluZyBmaWxlKVxyXG4gICAgICAgIHtcclxuICAgICAgICAgICAgdmFyIGYgPSBmaWxlLlRvTG93ZXIoKTtcclxuICAgICAgICAgICAgaWYgKEltYWdlcy5Db250YWluc0tleShmKSlcclxuICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuIEltYWdlc1tmXTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB2YXIgRCA9IEdldERhdGEoZik7XHJcbiAgICAgICAgICAgIGlmIChEID09IG51bGwpXHJcbiAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgIHJldHVybiBudWxsO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIHZhciByZXQgPSBuZXcgSFRNTEltYWdlRWxlbWVudCgpO1xyXG4gICAgICAgICAgICByZXQuT25Mb2FkID0gRSA9PlxyXG4gICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICBIZWxwZXIuTG9nKFwibG9hZGVkIFwiICsgZiArIFwiIGZyb20gSlNPTiFcIik7XHJcbiAgICAgICAgICAgIH07XHJcbiAgICAgICAgICAgIHJldC5TcmMgPSBcImRhdGE6aW1hZ2UvcG5nO2Jhc2U2NCxcIiArIEQ7XHJcbiAgICAgICAgICAgIEltYWdlc1tmXSA9IHJldDtcclxuICAgICAgICAgICAgcmV0dXJuIHJldDtcclxuICAgICAgICB9XHJcbiAgICB9XHJcbn1cclxuIiwidXNpbmcgU3lzdGVtO1xyXG51c2luZyBTeXN0ZW0uQ29sbGVjdGlvbnMuR2VuZXJpYztcclxudXNpbmcgU3lzdGVtLkxpbnE7XHJcbnVzaW5nIFN5c3RlbS5UZXh0O1xyXG51c2luZyBTeXN0ZW0uVGhyZWFkaW5nLlRhc2tzO1xyXG51c2luZyBCcmlkZ2U7XHJcbnVzaW5nIEJyaWRnZS5IdG1sNTtcclxuXHJcbm5hbWVzcGFjZSBDaXJub0dhbWVcclxue1xyXG4gICAgcHVibGljIGNsYXNzIEtleWJvYXJkTWFuYWdlclxyXG4gICAge1xyXG4gICAgICAgIHB1YmxpYyBMaXN0PGludD4gUHJlc3NlZEJ1dHRvbnM7XHJcbiAgICAgICAgcHVibGljIExpc3Q8aW50PiBUYXBwZWRCdXR0b25zO1xyXG5cclxuICAgICAgICBwdWJsaWMgTGlzdDxpbnQ+IFByZXNzZWRNb3VzZUJ1dHRvbnM7XHJcbiAgICAgICAgcHVibGljIExpc3Q8aW50PiBUYXBwZWRNb3VzZUJ1dHRvbnM7XHJcblxyXG4gICAgICAgIHB1YmxpYyBWZWN0b3IyIE1vdXNlUG9zaXRpb24gPSBuZXcgVmVjdG9yMigpO1xyXG4gICAgICAgIHB1YmxpYyBWZWN0b3IyIENNb3VzZSA9IG5ldyBWZWN0b3IyKCk7XHJcblxyXG4gICAgICAgIHB1YmxpYyBzdGF0aWMgS2V5Ym9hcmRNYW5hZ2VyIF90aGlzXHJcbiAgICAgICAge1xyXG4gICAgICAgICAgICBnZXRcclxuICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgaWYgKF9fdGhpcyA9PSBudWxsKVxyXG4gICAgICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgICAgIF9fdGhpcyA9IG5ldyBLZXlib2FyZE1hbmFnZXIoKTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIHJldHVybiBfX3RoaXM7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcbiAgICAgICAgcHVibGljIHN0YXRpYyB2b2lkIEluaXQoKVxyXG4gICAgICAgIHtcclxuICAgICAgICAgICAgaWYgKF9fdGhpcyA9PSBudWxsKVxyXG4gICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICBfX3RoaXMgPSBuZXcgS2V5Ym9hcmRNYW5hZ2VyKCk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcbiAgICAgICAgcHJvdGVjdGVkIHN0YXRpYyBLZXlib2FyZE1hbmFnZXIgX190aGlzO1xyXG4gICAgICAgIHByb3RlY3RlZCBLZXlib2FyZE1hbmFnZXIoKVxyXG4gICAgICAgIHtcclxuICAgICAgICAgICAgUHJlc3NlZEJ1dHRvbnMgPSBuZXcgTGlzdDxpbnQ+KCk7XHJcbiAgICAgICAgICAgIFRhcHBlZEJ1dHRvbnMgPSBuZXcgTGlzdDxpbnQ+KCk7XHJcbiAgICAgICAgICAgIFByZXNzZWRNb3VzZUJ1dHRvbnMgPSBuZXcgTGlzdDxpbnQ+KCk7XHJcbiAgICAgICAgICAgIFRhcHBlZE1vdXNlQnV0dG9ucyA9IG5ldyBMaXN0PGludD4oKTtcclxuXHJcbiAgICAgICAgICAgIFByZWRpY2F0ZTxLZXlib2FyZEV2ZW50PiBLRCA9IG9uS2V5RG93bjtcclxuICAgICAgICAgICAgU2NyaXB0LldyaXRlKFwiZG9jdW1lbnQub25rZXlkb3duID0gS0Q7XCIpO1xyXG5cclxuICAgICAgICAgICAgQWN0aW9uPEtleWJvYXJkRXZlbnQ+IEtVID0gb25LZXlVcDtcclxuICAgICAgICAgICAgU2NyaXB0LldyaXRlKFwiZG9jdW1lbnQub25rZXl1cCA9IEtVO1wiKTtcclxuXHJcbiAgICAgICAgICAgIEFjdGlvbjxNb3VzZUV2ZW50PiBNTSA9IG9uTW91c2VNb3ZlO1xyXG4gICAgICAgICAgICBTY3JpcHQuV3JpdGUoXCJkb2N1bWVudC5vbm1vdXNlbW92ZSA9IE1NO1wiKTtcclxuXHJcbiAgICAgICAgICAgIFByZWRpY2F0ZTxNb3VzZUV2ZW50PiBNRCA9IG9uTW91c2VEb3duO1xyXG4gICAgICAgICAgICBTY3JpcHQuV3JpdGUoXCJkb2N1bWVudC5vbm1vdXNlZG93biA9IE1EO1wiKTtcclxuXHJcbiAgICAgICAgICAgIFByZWRpY2F0ZTxNb3VzZUV2ZW50PiBNVSA9IG9uTW91c2VVcDtcclxuICAgICAgICAgICAgU2NyaXB0LldyaXRlKFwiZG9jdW1lbnQub25tb3VzZXVwID0gTVU7XCIpO1xyXG5cclxuICAgICAgICAgICAgUHJlZGljYXRlPE1vdXNlRXZlbnQ+IE5CID0gTmV2ZXJpbkJvdW5kcztcclxuICAgICAgICAgICAgU2NyaXB0LldyaXRlKFwiZG9jdW1lbnQub25jb250ZXh0bWVudSA9IE5CXCIpO1xyXG4gICAgICAgIH1cclxuXHJcblxyXG4gICAgICAgIHB1YmxpYyBzdGF0aWMgdm9pZCBVcGRhdGUoKVxyXG4gICAgICAgIHtcclxuICAgICAgICAgICAgX190aGlzLlRhcHBlZEJ1dHRvbnMuQ2xlYXIoKTtcclxuICAgICAgICAgICAgX190aGlzLlRhcHBlZE1vdXNlQnV0dG9ucy5DbGVhcigpO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgcHVibGljIHN0YXRpYyBib29sIE5ldmVyaW5Cb3VuZHMoTW91c2VFdmVudCBldnQpXHJcbiAgICAgICAge1xyXG4gICAgICAgICAgICByZXR1cm4gIUFwcC5TY3JlZW5Cb3VuZHMuY29udGFpbnNQb2ludChfdGhpcy5DTW91c2UuWCwgX3RoaXMuQ01vdXNlLlkpO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgcHVibGljIHN0YXRpYyBib29sIG9uS2V5RG93bihLZXlib2FyZEV2ZW50IGV2dClcclxuICAgICAgICB7XHJcbiAgICAgICAgICAgIGludCBrZXlDb2RlID0gZXZ0LktleUNvZGU7XHJcblxyXG4gICAgICAgICAgICBpZiAoIV9fdGhpcy5QcmVzc2VkQnV0dG9ucy5Db250YWlucyhrZXlDb2RlKSlcclxuICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgX190aGlzLlByZXNzZWRCdXR0b25zLkFkZChrZXlDb2RlKTtcclxuICAgICAgICAgICAgICAgIF9fdGhpcy5UYXBwZWRCdXR0b25zLkFkZChrZXlDb2RlKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBpZiAoKGtleUNvZGUgPj0gMzcgJiYga2V5Q29kZSA8PSA0MCkgfHwga2V5Q29kZSA9PSAzMiB8fCBrZXlDb2RlID09IDExMilcclxuICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIHJldHVybiB0cnVlO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgcHVibGljIHN0YXRpYyB2b2lkIG9uS2V5VXAoS2V5Ym9hcmRFdmVudCBldnQpXHJcbiAgICAgICAge1xyXG4gICAgICAgICAgICBpbnQga2V5Q29kZSA9IGV2dC5LZXlDb2RlO1xyXG5cclxuICAgICAgICAgICAgaWYgKF9fdGhpcy5QcmVzc2VkQnV0dG9ucy5Db250YWlucyhrZXlDb2RlKSlcclxuICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgX190aGlzLlByZXNzZWRCdXR0b25zLlJlbW92ZShrZXlDb2RlKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuICAgICAgICBwdWJsaWMgc3RhdGljIGJvb2wgb25Nb3VzZURvd24oTW91c2VFdmVudCBldnQpXHJcbiAgICAgICAge1xyXG4gICAgICAgICAgICBpbnQgYnRuID0gZXZ0LkJ1dHRvbjtcclxuICAgICAgICAgICAgaWYgKCFfX3RoaXMuUHJlc3NlZE1vdXNlQnV0dG9ucy5Db250YWlucyhidG4pKVxyXG4gICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICBfX3RoaXMuUHJlc3NlZE1vdXNlQnV0dG9ucy5BZGQoYnRuKTtcclxuICAgICAgICAgICAgICAgIF9fdGhpcy5UYXBwZWRNb3VzZUJ1dHRvbnMuQWRkKGJ0bik7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgcmV0dXJuIGJ0biA8IDE7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHB1YmxpYyBzdGF0aWMgYm9vbCBvbk1vdXNlVXAoTW91c2VFdmVudCBldnQpXHJcbiAgICAgICAge1xyXG4gICAgICAgICAgICBpbnQgYnRuID0gZXZ0LkJ1dHRvbjtcclxuICAgICAgICAgICAgaWYgKF9fdGhpcy5QcmVzc2VkTW91c2VCdXR0b25zLkNvbnRhaW5zKGJ0bikpXHJcbiAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgIF9fdGhpcy5QcmVzc2VkTW91c2VCdXR0b25zLlJlbW92ZShidG4pO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIHJldHVybiBidG4gPCAxO1xyXG4gICAgICAgIH1cclxuICAgICAgICBwdWJsaWMgc3RhdGljIHZvaWQgb25Nb3VzZU1vdmUoTW91c2VFdmVudCBldnQpXHJcbiAgICAgICAge1xyXG4gICAgICAgICAgICBfdGhpcy5Nb3VzZVBvc2l0aW9uID0gbmV3IFZlY3RvcjIoZXZ0LkNsaWVudFgsIGV2dC5DbGllbnRZKTtcclxuXHJcbiAgICAgICAgICAgIC8vZmxvYXQgbGVmdCA9IGZsb2F0LlBhcnNlKEFwcC5DYW52YXMuU3R5bGUuTGVmdC5SZXBsYWNlKFwicHhcIiwgXCJcIikpO1xyXG4gICAgICAgICAgICBpZiAoQXBwLkRpdi5TdHlsZS5MZWZ0LkluZGV4T2YoXCJweFwiKTwwKVxyXG4gICAgICAgICAgICAgICAgcmV0dXJuO1xyXG4gICAgICAgICAgICBmbG9hdCBsZWZ0ID0gZmxvYXQuUGFyc2UoQXBwLkRpdi5TdHlsZS5MZWZ0LlJlcGxhY2UoXCJweFwiLCBcIlwiKSk7XHJcbiAgICAgICAgICAgIGZsb2F0IHggPSBldnQuQ2xpZW50WCAtIGxlZnQ7XHJcbiAgICAgICAgICAgIGZsb2F0IHkgPSBldnQuQ2xpZW50WTtcclxuXHJcbiAgICAgICAgICAgIC8vZmxvYXQgc2NhbGUgPSAoQXBwLkNhbnZhcy5XaWR0aCAqIDEuMjVmKSAvIGZsb2F0LlBhcnNlKEFwcC5DYW52YXMuU3R5bGUuV2lkdGguUmVwbGFjZShcInB4XCIsIFwiXCIpKTtcclxuXHJcbiAgICAgICAgICAgIC8vZmxvYXQgc2NhbGUgPSAoQXBwLkNhbnZhcy5XaWR0aCkgLyBmbG9hdC5QYXJzZShBcHAuQ2FudmFzLlN0eWxlLldpZHRoLlJlcGxhY2UoXCJweFwiLCBcIlwiKSk7XHJcbiAgICAgICAgICAgIGZsb2F0IHNjYWxlID0gKEFwcC5DYW52YXMuV2lkdGgpIC8gZmxvYXQuUGFyc2UoQXBwLkRpdi5TdHlsZS5XaWR0aC5SZXBsYWNlKFwicHhcIiwgXCJcIikpO1xyXG4gICAgICAgICAgICBfdGhpcy5DTW91c2UgPSBuZXcgVmVjdG9yMih4ICogc2NhbGUsIHkgKiBzY2FsZSk7XHJcbiAgICAgICAgICAgIC8vQ29uc29sZS5Xcml0ZUxpbmUoXCJteDpcIitfdGhpcy5DTW91c2UueCArIFwiIG15OlwiICsgX3RoaXMuQ01vdXNlLnkpO1xyXG4gICAgICAgIH1cclxuICAgIH1cclxufVxyXG4iLCJ1c2luZyBTeXN0ZW07XHJcbnVzaW5nIFN5c3RlbS5Db2xsZWN0aW9ucy5HZW5lcmljO1xyXG51c2luZyBTeXN0ZW0uTGlucTtcclxudXNpbmcgU3lzdGVtLlRleHQ7XHJcbnVzaW5nIFN5c3RlbS5UaHJlYWRpbmcuVGFza3M7XHJcblxyXG5uYW1lc3BhY2UgQ2lybm9HYW1lXHJcbntcclxuICAgIHB1YmxpYyBjbGFzcyBNYXBHZW5lcmF0b3JcclxuICAgIHtcclxuICAgICAgICBwdWJsaWMgc3RhdGljIE1hcFJvb20gcm9vdHJvb207XHJcbiAgICAgICAgcHVibGljIHN0YXRpYyBNYXBSb29tIGRvb3Jyb29tO1xyXG4gICAgICAgIHB1YmxpYyBzdGF0aWMgTWFwUm9vbSBrZXlyb29tO1xyXG4gICAgICAgIHB1YmxpYyBzdGF0aWMgdm9pZCBHZW5lcmF0ZShHYW1lIGdhbWUpXHJcbiAgICAgICAge1xyXG4gICAgICAgICAgICB2YXIgcGxheWVyID0gZ2FtZS5wbGF5ZXI7Ly9wbGF5ZXIgY2hhcmFjdGVyXHJcbiAgICAgICAgICAgIHZhciBtYXAgPSBnYW1lLlRNOy8vdGhlIHRpbGVtYXAgdG8gZ2VuZXJhdGVcclxuICAgICAgICAgICAgdmFyIGJvdW5kcyA9IGdhbWUuc3RhZ2VCb3VuZHM7Ly90aGUgYm91bmRzIHRvIHN0YXkgd2l0aGluXHJcblxyXG4gICAgICAgICAgICAvL0xpc3Q8UmVjdGFuZ2xlPiByb29tcyA9IG5ldyBMaXN0PFJlY3RhbmdsZT4oKTtcclxuXHJcbiAgICAgICAgICAgIHZhciBYID0gMDtcclxuICAgICAgICAgICAgdmFyIFkgPSAwO1xyXG4gICAgICAgICAgICBpZiAoTWF0aC5SYW5kb20oKSA8IDAuNSlcclxuICAgICAgICAgICAgICAgIFggPSBNYXRoLlJhbmRvbSgpIDwgMC41ID8gLTEgOiAxO1xyXG4gICAgICAgICAgICBlbHNlXHJcbiAgICAgICAgICAgICAgICBZID0gTWF0aC5SYW5kb20oKSA8IDAuNSA/IC0xIDogMTtcclxuICAgICAgICAgICAgVGlsZURhdGEgVCA9IG5ldyBUaWxlRGF0YSgpO1xyXG4gICAgICAgICAgICBULnRleHR1cmUgPSAxO1xyXG4gICAgICAgICAgICBULmVuYWJsZWQgPSB0cnVlO1xyXG4gICAgICAgICAgICBULnZpc2libGUgPSB0cnVlO1xyXG4gICAgICAgICAgICBULm1hcCA9IG1hcDtcclxuICAgICAgICAgICAgVC5zb2xpZCA9IHRydWU7XHJcbiAgICAgICAgICAgIFQudG9wU29saWQgPSB0cnVlO1xyXG4gICAgICAgICAgICAvL21hcC5TZXRBbGwoVCk7XHJcbiAgICAgICAgICAgIHBsYXllci54ID0gKGJvdW5kcy5sZWZ0ICsgYm91bmRzLnJpZ2h0KSAvIDI7XHJcbiAgICAgICAgICAgIHBsYXllci55ID0gKGJvdW5kcy50b3AgKyBib3VuZHMuYm90dG9tKSAvIDI7XHJcbiAgICAgICAgICAgIC8vcGF0aE1pbmVyKGdhbWUsbWFwLmNvbHVtbnMvMixtYXAucm93cy8yLFgsWSwyMCk7XHJcbiAgICAgICAgICAgIHBhdGhNaW5lcihnYW1lLCBtYXAuY29sdW1ucyAvIDIsIG1hcC5yb3dzIC8gNCwgWCwgWSwgMzApO1xyXG5cclxuICAgICAgICAgICAgdmFyIFYgPSBGaW5kRW1wdHlTcGFjZShnYW1lKTtcclxuICAgICAgICAgICAgaWYgKFYgIT0gbnVsbClcclxuICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgcGxheWVyLnggPSBWLlg7XHJcbiAgICAgICAgICAgICAgICBwbGF5ZXIueSA9IFYuWTtcclxuICAgICAgICAgICAgICAgIEhlbHBlci5Mb2coXCJzcGF3bmluZyBhdDpcIiArIChpbnQpVi5YICsgXCIsXCIgKyAoaW50KVYuWSk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgZWxzZVxyXG4gICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICBIZWxwZXIuTG9nKFwiY2Fubm90IGxvY2F0ZSBhIHNwYXduIHBvaW50Li4uXCIpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHB1YmxpYyBzdGF0aWMgdm9pZCBCb3h5R2VuZXJhdGUoR2FtZSBnYW1lKVxyXG4gICAgICAgIHtcclxuICAgICAgICAgICAgSGVscGVyLkxvZyhcImJveHkgZ2VuZXJhdGVcIik7XHJcbiAgICAgICAgICAgIHZhciBwbGF5ZXIgPSBnYW1lLnBsYXllcjsvL3BsYXllciBjaGFyYWN0ZXJcclxuICAgICAgICAgICAgdmFyIG1hcCA9IGdhbWUuVE07Ly90aGUgdGlsZW1hcCB0byBnZW5lcmF0ZVxyXG4gICAgICAgICAgICB2YXIgYm91bmRzID0gZ2FtZS5zdGFnZUJvdW5kczsvL3RoZSBib3VuZHMgdG8gc3RheSB3aXRoaW5cclxuICAgICAgICAgICAgTWFwUm9vbS5QbGFjZWRSb29tcyA9IG5ldyBMaXN0PE1hcFJvb20+KCk7XHJcbiAgICAgICAgICAgIE1hcFJvb20uT3BlblJvb21zID0gbmV3IExpc3Q8TWFwUm9vbT4oKTtcclxuXHJcbiAgICAgICAgICAgIHZhciBTWCA9IG1hcC5jb2x1bW5zIC8gMjtcclxuICAgICAgICAgICAgdmFyIFNZID0gbWFwLnJvd3MgLyAzO1xyXG4gICAgICAgICAgICB2YXIgcm9vdCA9IG5ldyBNYXBSb29tKCk7XHJcbiAgICAgICAgICAgIHJvb3QuU1ggPSBTWDtcclxuICAgICAgICAgICAgcm9vdC5TWSA9IFNZO1xyXG4gICAgICAgICAgICByb290LkVYID0gU1ggKyA2ICsgKGludCkoTWF0aC5SYW5kb20oKSAqIDEwKTtcclxuICAgICAgICAgICAgcm9vdC5FWSA9IFNZICsgNiArIChpbnQpKE1hdGguUmFuZG9tKCkgKiAxMCk7XHJcblxyXG4gICAgICAgICAgICByb290LmdhbWUgPSBnYW1lO1xyXG4gICAgICAgICAgICByb290cm9vbSA9IHJvb3Q7XHJcblxyXG4gICAgICAgICAgICAvL3ZhciByb29tdG90YWwgPSAxMisoaW50KShNYXRoLlJhbmRvbSgpICogMTApO1xyXG4gICAgICAgICAgICAvL3ZhciByb29tdG90YWwgPSAxNiArIChpbnQpKE1hdGguUmFuZG9tKCkgKiAxNik7XHJcblxyXG4gICAgICAgICAgICAvL3ZhciByb29tTWluaW11bSA9IDE2O1xyXG4gICAgICAgICAgICB2YXIgcm9vbU1pbmltdW0gPSAxMCtNYXRoLk1pbihnYW1lLmxldmVsLDQpO1xyXG4gICAgICAgICAgICB2YXIgcm9vbXRvdGFsID0gcm9vbU1pbmltdW0gKyAoaW50KShNYXRoLlJhbmRvbSgpICogKHJvb21NaW5pbXVtKSk7XHJcbiAgICAgICAgICAgIC8vdmFyIHJvb21zID0gMDtcclxuXHJcbiAgICAgICAgICAgIHZhciBhdHRlbXB0cyA9IDQwMDtcclxuICAgICAgICAgICAgdmFyIFIgPSByb290O1xyXG4gICAgICAgICAgICBpZiAoIXJvb3QuUGxhY2VBbmRFeHBhbmQoKSlcclxuICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgSGVscGVyLkxvZyhcIkNvdWxkbid0IGdlbmVyYXRlIHJvb3Qgcm9vbS5cIik7XHJcbiAgICAgICAgICAgICAgICByZXR1cm47XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgd2hpbGUgKE1hcFJvb20uT3BlblJvb21zLkNvdW50IDwgcm9vbXRvdGFsICYmIGF0dGVtcHRzID4gMClcclxuICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgdmFyIEwgPSBDaXJub0dhbWUuSGVscGVyRXh0ZW5zaW9ucy5QaWNrPGdsb2JhbDo6Q2lybm9HYW1lLk1hcFJvb20+KE1hcFJvb20uRmluZFZhbGlkVW5wbGFjZWRSb29tcygpKTtcclxuICAgICAgICAgICAgICAgIGlmIChMLlBsYWNlQW5kRXhwYW5kKCkpXHJcbiAgICAgICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICAgICAgLy9yb29tcysrO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgYXR0ZW1wdHMtLTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB2YXIgUlIgPSBnYW1lLnN0YWdlQm91bmRzIC0gZ2FtZS5UTS5wb3NpdGlvbjtcclxuICAgICAgICAgICAgUlIud2lkdGggLT0gZ2FtZS5UTS50aWxlc2l6ZTtcclxuICAgICAgICAgICAgUlIuaGVpZ2h0IC09IGdhbWUuVE0udGlsZXNpemU7XHJcbiAgICAgICAgICAgIGdhbWUuVE0uRHJhd1JlY3QoUlIpO1xyXG4gICAgICAgICAgICBnYW1lLlRNLkFwcGx5QnJlYWthYmxlKCk7XHJcbiAgICAgICAgICAgIHZhciBzZWNyZXRzID0gTWF0aC5SYW5kb20oKTwwLjMgPyAxIDogMDtcclxuICAgICAgICAgICAgaWYgKHNlY3JldHMgPiAwICYmIE1hdGguUmFuZG9tKCkgPCAwLjMpXHJcbiAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgIHNlY3JldHMrKztcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB3aGlsZSAoc2VjcmV0cyA+IDApXHJcbiAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgIHZhciBMID0gQ2lybm9HYW1lLkhlbHBlckV4dGVuc2lvbnMuUGljazxnbG9iYWw6OkNpcm5vR2FtZS5NYXBSb29tPihNYXBSb29tLkZpbmRWYWxpZFVucGxhY2VkUm9vbXMoKSk7XHJcbiAgICAgICAgICAgICAgICBpZiAoTC5QbGFjZUFuZEV4cGFuZCgpKVxyXG4gICAgICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgICAgIEwuTWFrZVNlY3JldCgpO1xyXG4gICAgICAgICAgICAgICAgICAgIHZhciBsZXZlciA9IEF0dGVtcHRDcmVhdGVMZXZlcihnYW1lLCBMKTtcclxuICAgICAgICAgICAgICAgICAgICBnYW1lLkFkZEVudGl0eShsZXZlcik7XHJcbiAgICAgICAgICAgICAgICAgICAgSGVscGVyLkxvZyhcIlBsYWNlZCBzZWNyZXQgcm9vbSBhdDpcIiArIEwuU1ggKyBcIixcIiArIEwuU1kpO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgc2VjcmV0cy0tO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIHZhciBWID0gRmluZEVtcHR5U3BhY2UoZ2FtZSk7XHJcbiAgICAgICAgICAgIGtleXJvb20gPSBudWxsO1xyXG4gICAgICAgICAgICBpZiAoViAhPSBudWxsKVxyXG4gICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICAvKnBsYXllci54ID0gVi5YO1xyXG4gICAgICAgICAgICAgICAgcGxheWVyLnkgPSBWLlk7Ki9cclxuICAgICAgICAgICAgICAgIGdhbWUuRG9vci5Qb3NpdGlvbi5Db3B5RnJvbShWKTtcclxuICAgICAgICAgICAgICAgIGdhbWUuRG9vci5Ecm9wVG9Hcm91bmQoKTtcclxuICAgICAgICAgICAgICAgIGRvb3Jyb29tID0gTWFwUm9vbS5GaW5kUm9vbShnYW1lLkRvb3IuUG9zaXRpb24pO1xyXG4gICAgICAgICAgICAgICAgaWYgKGRvb3Jyb29tID09IG51bGwpXHJcbiAgICAgICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICAgICAgSGVscGVyLkxvZyhcIkRvb3Igcm9vbSBjb3VsZCBub3QgYmUgZGV0ZXJtaW5lZC4uLlwiKTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIFxyXG4gICAgICAgICAgICAgICAgdmFyIFBDID0gKFBsYXllckNoYXJhY3RlcilwbGF5ZXI7XHJcbiAgICAgICAgICAgICAgICAvL1BDLk1vdmVUb05ld1NwYXduKFYpO1xyXG4gICAgICAgICAgICAgICAgUEMuTW92ZVRvTmV3U3Bhd24oZ2FtZS5Eb29yLlBvc2l0aW9uKTtcclxuICAgICAgICAgICAgICAgIEhlbHBlci5Mb2coXCJzcGF3bmluZyBhdDpcIiArIChpbnQpVi5YICsgXCIsXCIgKyAoaW50KVYuWSk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgZWxzZVxyXG4gICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICBIZWxwZXIuTG9nKFwiY2Fubm90IGxvY2F0ZSBhIHNwYXduIHBvaW50Li4uXCIpO1xyXG4gICAgICAgICAgICB9XHJcblxyXG4gICAgICAgIH1cclxuICAgICAgICBwdWJsaWMgc3RhdGljIFJvb21PcGVuaW5nTGV2ZXIgQXR0ZW1wdENyZWF0ZUxldmVyKEdhbWUgZ2FtZSxNYXBSb29tIFRhcmdldClcclxuICAgICAgICB7XHJcbiAgICAgICAgICAgIHZhciBpID0gMDtcclxuICAgICAgICAgICAgd2hpbGUgKGkgPCAyMClcclxuICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgdmFyIGxldmVyID0gUm9vbU9wZW5pbmdMZXZlci5GaW5kQW5kUGxhY2VPbldhbGwoZ2FtZSwgTWFwUm9vbS5GaW5kQW55RW1wdHlTcG90KCksIFRhcmdldCk7XHJcbiAgICAgICAgICAgICAgICBpZiAobGV2ZXIgIT0gbnVsbClcclxuICAgICAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgICAgICByZXR1cm4gbGV2ZXI7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgcmV0dXJuIG51bGw7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHB1YmxpYyBzdGF0aWMgVmVjdG9yMiBGaW5kRW1wdHlTcGFjZShHYW1lIGdhbWUpXHJcbiAgICAgICAge1xyXG4gICAgICAgICAgICB2YXIgbWFwID0gZ2FtZS5UTTtcclxuICAgICAgICAgICAgdmFyIGJvdW5kcyA9IGdhbWUuc3RhZ2VCb3VuZHM7Ly90aGUgYm91bmRzIHRvIHN0YXkgd2l0aGluXHJcbiAgICAgICAgICAgIHZhciBpID0gMDtcclxuICAgICAgICAgICAgdmFyIHJldCA9IG5ldyBWZWN0b3IyKCk7XHJcbiAgICAgICAgICAgIHZhciB0bXAgPSBuZXcgVmVjdG9yMigpO1xyXG4gICAgICAgICAgICB3aGlsZSAoaSA8IDIwMDApXHJcbiAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgIHJldC5YID0gKGZsb2F0KShib3VuZHMubGVmdCArIChNYXRoLlJhbmRvbSgpICogKGJvdW5kcy53aWR0aCAtIG1hcC50aWxlc2l6ZSkpKTtcclxuICAgICAgICAgICAgICAgIHJldC5ZID0gKGZsb2F0KShib3VuZHMudG9wICsgKE1hdGguUmFuZG9tKCkgKiAoYm91bmRzLmJvdHRvbSAtIG1hcC50aWxlc2l6ZSkpKTtcclxuICAgICAgICAgICAgICAgIGlmICghbWFwLkNoZWNrRm9yVGlsZShyZXQpLnZpc2libGUpXHJcbiAgICAgICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICAgICAgdG1wLlggPSByZXQuWDtcclxuICAgICAgICAgICAgICAgICAgICB0bXAuWSA9IHJldC5ZIC0gbWFwLnRpbGVzaXplO1xyXG4gICAgICAgICAgICAgICAgICAgIGlmICghbWFwLkNoZWNrRm9yVGlsZShyZXQpLnZpc2libGUpXHJcbiAgICAgICAgICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gcmV0O1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIGkrKztcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAvL3JldHVybiByZXQ7XHJcbiAgICAgICAgICAgIHJldHVybiBudWxsO1xyXG4gICAgICAgIH1cclxuICAgICAgICAvL2NyZWF0ZSB0dW5uZWxzIGhhbGx3YXlzIGV0Y1xyXG4gICAgICAgIHByaXZhdGUgc3RhdGljIHZvaWQgcGF0aE1pbmVyKEdhbWUgZ2FtZSwgaW50IFgsIGludCBZLCBpbnQgWGRpciwgaW50IFlEaXIsIGludCBsaW1pdClcclxuICAgICAgICB7XHJcbiAgICAgICAgICAgIGlmIChsaW1pdCA8PSAwKVxyXG4gICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICByZXR1cm47XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgdmFyIHBsYXllciA9IGdhbWUucGxheWVyOy8vcGxheWVyIGNoYXJhY3RlclxyXG4gICAgICAgICAgICB2YXIgbWFwID0gZ2FtZS5UTTsvL3RoZSB0aWxlbWFwIHRvIGdlbmVyYXRlXHJcbiAgICAgICAgICAgIHZhciBib3VuZHMgPSBnYW1lLnN0YWdlQm91bmRzOy8vdGhlIGJvdW5kcyB0byBzdGF5IHdpdGhpblxyXG5cclxuICAgICAgICAgICAgdmFyIGRpc3QgPSAwO1xyXG4gICAgICAgICAgICB2YXIgcG93ID0gMTtcclxuICAgICAgICAgICAgaWYgKFlEaXIgIT0gMClcclxuICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgcG93ID0gMjtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB3aGlsZSAoZGlzdCA8IDcgJiYgTWF0aC5SYW5kb20oKSA8IChNYXRoLlBvdygwLjk1LCBwb3cpKSlcclxuICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgWCArPSBYZGlyO1xyXG4gICAgICAgICAgICAgICAgWSArPSBZRGlyO1xyXG4gICAgICAgICAgICAgICAgRXJhc2UobWFwLCBYLCBZLCAzKTtcclxuICAgICAgICAgICAgICAgIGlmIChNYXRoLlJhbmRvbSgpIDwgKDAuMiAqIHBvdykpXHJcbiAgICAgICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKFhkaXIgPT0gMClcclxuICAgICAgICAgICAgICAgICAgICAgICAgWCArPSBNYXRoLlJhbmRvbSgpIDwgMC41ID8gMSA6IC0xO1xyXG4gICAgICAgICAgICAgICAgICAgIGVsc2VcclxuICAgICAgICAgICAgICAgICAgICAgICAgWSArPSBNYXRoLlJhbmRvbSgpIDwgMC41ID8gMSA6IC0xO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgZWxzZSBpZiAoTWF0aC5SYW5kb20oKSA8ICgwLjAyICogcG93KSAmJiBsaW1pdCA+IDQpXHJcbiAgICAgICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICAgICAgbGltaXQgPSBsaW1pdCAvIDI7XHJcbiAgICAgICAgICAgICAgICAgICAgdmFyIFhEID0gTWF0aC5SYW5kb20oKSA8IDAuNSA/IFlEaXIgOiAtWURpcjtcclxuICAgICAgICAgICAgICAgICAgICB2YXIgWUQgPSBNYXRoLlJhbmRvbSgpIDwgMC41ID8gWGRpciA6IC1YZGlyO1xyXG4gICAgICAgICAgICAgICAgICAgIHBhdGhNaW5lcihnYW1lLCBYLCBZLCBYRCwgWUQsIGxpbWl0KTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBsaW1pdC0tO1xyXG4gICAgICAgICAgICBpZiAobGltaXQgPiAxKVxyXG4gICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICByb29tTWluZXIoZ2FtZSwgWCwgWSwgWGRpciwgWURpciwgbGltaXQpO1xyXG4gICAgICAgICAgICB9XHJcblxyXG4gICAgICAgIH1cclxuICAgICAgICBwcml2YXRlIHN0YXRpYyB2b2lkIHJvb21NaW5lcihHYW1lIGdhbWUsIGludCBYLCBpbnQgWSwgaW50IFhkaXIsIGludCBZRGlyLCBpbnQgbGltaXQpXHJcbiAgICAgICAge1xyXG4gICAgICAgICAgICBpZiAobGltaXQgPD0gMClcclxuICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuO1xyXG4gICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICB2YXIgU1ogPSAoaW50KSg0ICsgKE1hdGguUmFuZG9tKCkgKiA0KSk7XHJcbiAgICAgICAgICAgIFggKz0gWGRpciAqIChTWiAvIDIpO1xyXG4gICAgICAgICAgICBZICs9IFlEaXIgKiAoU1ogLyAyKTtcclxuXHJcbiAgICAgICAgICAgIC8vRXJhc2UoZ2FtZS5UTSwgWCwgWSwgKFNaICogMikrMik7XHJcbiAgICAgICAgICAgIEVyYXNlQW5kUmFuZG8oZ2FtZS5UTSwgWCwgWSwgKFNaICogMikgKyAyKTtcclxuXHJcbiAgICAgICAgICAgIHZhciBYRCA9IFhkaXI7XHJcbiAgICAgICAgICAgIHZhciBZRCA9IFlEaXI7XHJcbiAgICAgICAgICAgIGlmIChNYXRoLlJhbmRvbSgpIDwgMC4yMCB8fCAoWUQgIT0gMCAmJiBNYXRoLlJhbmRvbSgpIDwgMC42NSkgfHwgWUQgPCAwKVxyXG4gICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICBYRCA9IE1hdGguUmFuZG9tKCkgPCAwLjUgPyBZRGlyIDogLVlEaXI7XHJcbiAgICAgICAgICAgICAgICBZRCA9IE1hdGguUmFuZG9tKCkgPCAwLjUgPyBYZGlyIDogLVhkaXI7XHJcbiAgICAgICAgICAgICAgICBpZiAoWUQgPCAwKVxyXG4gICAgICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgICAgIFlEID0gLVlEO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIFhkaXIgPSBYRDtcclxuICAgICAgICAgICAgWURpciA9IFlEO1xyXG5cclxuICAgICAgICAgICAgWCArPSBYZGlyICogKFNaIC8gMik7XHJcbiAgICAgICAgICAgIFkgKz0gWURpciAqIChTWiAvIDIpO1xyXG5cclxuICAgICAgICAgICAgbGltaXQtLTtcclxuICAgICAgICAgICAgcGF0aE1pbmVyKGdhbWUsIFgsIFksIFhkaXIsIFlEaXIsIGxpbWl0KTtcclxuICAgICAgICB9XHJcbiAgICAgICAgcHJpdmF0ZSBzdGF0aWMgVGlsZURhdGEgYmxhbmsgPSBuZXcgVGlsZURhdGEoKTtcclxuICAgICAgICBwcml2YXRlIHN0YXRpYyB2b2lkIEVyYXNlKFRpbGVNYXAgVE0sIGludCBjb2x1bW4sIGludCByb3csIGludCBzaXplKVxyXG4gICAgICAgIHtcclxuICAgICAgICAgICAgVE0uQ2xlYXJSZWN0KGNvbHVtbiAtIChzaXplIC8gMiksIHJvdyAtIChzaXplIC8gMiksIChzaXplKSwgKHNpemUpKTtcclxuICAgICAgICB9XHJcbiAgICAgICAgcHJpdmF0ZSBzdGF0aWMgdm9pZCBFcmFzZUFuZFJhbmRvKFRpbGVNYXAgVE0sIGludCBjb2x1bW4sIGludCByb3csIGludCBzaXplKVxyXG4gICAgICAgIHtcclxuICAgICAgICAgICAgdmFyIFNYID0gY29sdW1uIC0gKHNpemUgLyAyKTtcclxuICAgICAgICAgICAgdmFyIFNZID0gcm93IC0gKHNpemUgLyAyKTtcclxuICAgICAgICAgICAgVE0uQ2xlYXJSZWN0KFNYLCBTWSwgKHNpemUpLCAoc2l6ZSkpO1xyXG4gICAgICAgICAgICBUTS5fR2VuUmVjdChTWCwgU1ksIFNYICsgKHNpemUpLCBTWSArIChzaXplKSk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIC8vcHJpdmF0ZSB2b2lkIEdyb3dSb29tcyhMaXN0PFJlY3RhbmdsZT4gcm9vbXMsKVxyXG4gICAgfVxyXG59XHJcbiIsInVzaW5nIFN5c3RlbTtcclxudXNpbmcgU3lzdGVtLkNvbGxlY3Rpb25zLkdlbmVyaWM7XHJcbnVzaW5nIFN5c3RlbS5MaW5xO1xyXG51c2luZyBTeXN0ZW0uVGV4dDtcclxudXNpbmcgU3lzdGVtLlRocmVhZGluZy5UYXNrcztcclxuXHJcbm5hbWVzcGFjZSBDaXJub0dhbWVcclxue1xyXG4gICAgcHVibGljIGNsYXNzIE1hcFJvb21cclxuICAgIHtcclxuICAgICAgICBwdWJsaWMgaW50IFNYO1xyXG4gICAgICAgIHB1YmxpYyBpbnQgU1k7XHJcbiAgICAgICAgcHVibGljIGludCBFWDtcclxuICAgICAgICBwdWJsaWMgaW50IEVZO1xyXG5cclxuICAgICAgICBwdWJsaWMgYm9vbCBwbGFjZWQgPSBmYWxzZTtcclxuICAgICAgICBwdWJsaWMgYm9vbCBzZWNyZXQgPSBmYWxzZTtcclxuXHJcbiAgICAgICAgLy9wdWJsaWMgUG9pbnRbXSBFeGl0cztcclxuICAgICAgICBwdWJsaWMgTGlzdDxNYXBSb29tPiBFeGl0Um9vbXMgPSBuZXcgTGlzdDxNYXBSb29tPigpOy8vY29ubmVjdGVkIHJvb21zXHJcblxyXG4gICAgICAgIHB1YmxpYyBzdGF0aWMgTGlzdDxNYXBSb29tPiBQbGFjZWRSb29tcyA9IG5ldyBMaXN0PE1hcFJvb20+KCk7XHJcbiAgICAgICAgcHVibGljIHN0YXRpYyBMaXN0PE1hcFJvb20+IE9wZW5Sb29tcyA9IG5ldyBMaXN0PE1hcFJvb20+KCk7XHJcbiAgICAgICAgcHVibGljIE1hcFJvb20gcGFyZW50O1xyXG4gICAgICAgIHB1YmxpYyBDaGVzdFtdIGdvbGRjaGVzdHMgPSBuZXcgQ2hlc3RbMF07XHJcblxyXG4gICAgICAgIHB1YmxpYyBHYW1lIGdhbWU7XHJcbiAgICAgICAgcHVibGljIGJvb2wgSXNWYWxpZCgpXHJcbiAgICAgICAge1xyXG4gICAgICAgICAgICB2YXIgbWFwID0gZ2FtZS5UTTtcclxuICAgICAgICAgICAgaWYgKFNYID49IDAgJiYgU1kgPj0gMCAmJiBFWCA8IG1hcC5jb2x1bW5zICYmIEVZIDwgbWFwLnJvd3MpXHJcbiAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgIC8vaW4gYm91bmRzXHJcbiAgICAgICAgICAgICAgICByZXR1cm4gdHJ1ZTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICByZXR1cm4gZmFsc2U7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHB1YmxpYyBib29sIENhbkJlUGxhY2VkKClcclxuICAgICAgICB7XHJcbiAgICAgICAgICAgIHZhciBtYXAgPSBnYW1lLlRNO1xyXG4gICAgICAgICAgICBpZiAoSXNWYWxpZCgpKVxyXG4gICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICBpZiAobWFwLklzUmVjdFNvbGlkKFNYLCBTWSwgRVgsIEVZKSkvL3Jvb20gaGFzIG5vIGludGVyc2VjdGluZyBnYXBzLlxyXG4gICAgICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgICAgIHJldHVybiB0cnVlO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIHJldHVybiBmYWxzZTtcclxuICAgICAgICB9XHJcbiAgICAgICAgcHJpdmF0ZSB2b2lkIEdlbmVyYXRlQWRqYWNlbnRSb29tcygpXHJcbiAgICAgICAge1xyXG4gICAgICAgICAgICB2YXIgTSA9IEdlbmVyYXRlQWRqYWNlbnRSb29tKC0xLCAwKTtcclxuICAgICAgICAgICAgaWYgKE0gIT0gbnVsbClcclxuICAgICAgICAgICAgICAgIEV4aXRSb29tcy5BZGQoTSk7XHJcbiAgICAgICAgICAgIE0gPSBHZW5lcmF0ZUFkamFjZW50Um9vbSgxLCAwKTtcclxuICAgICAgICAgICAgaWYgKE0gIT0gbnVsbClcclxuICAgICAgICAgICAgICAgIEV4aXRSb29tcy5BZGQoTSk7XHJcbiAgICAgICAgICAgIGlmIChNYXRoLlJhbmRvbSgpIDwgMC41KVxyXG4gICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICBNID0gR2VuZXJhdGVBZGphY2VudFJvb20oMCwgLTEpO1xyXG4gICAgICAgICAgICAgICAgaWYgKE0gIT0gbnVsbClcclxuICAgICAgICAgICAgICAgICAgICBFeGl0Um9vbXMuQWRkKE0pO1xyXG4gICAgICAgICAgICAgICAgTSA9IEdlbmVyYXRlQWRqYWNlbnRSb29tKDAsIDEpO1xyXG4gICAgICAgICAgICAgICAgaWYgKE0gIT0gbnVsbClcclxuICAgICAgICAgICAgICAgICAgICBFeGl0Um9vbXMuQWRkKE0pO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHByaXZhdGUgTWFwUm9vbSBHZW5lcmF0ZUFkamFjZW50Um9vbShpbnQgWGRpciwgaW50IFlkaXIpXHJcbiAgICAgICAge1xyXG4gICAgICAgICAgICAvKnZhciBtaW4gPSA2O1xyXG4gICAgICAgICAgICB2YXIgbWF4ID0gMTg7Ki9cclxuICAgICAgICAgICAgdmFyIG1pbiA9IDU7XHJcbiAgICAgICAgICAgIHZhciBtYXggPSAxMztcclxuICAgICAgICAgICAgdmFyIGRpZiA9IChtYXggLSBtaW4pO1xyXG4gICAgICAgICAgICBpbnQgVyA9IChpbnQpKG1pbiArIChNYXRoLlJhbmRvbSgpICogZGlmKSk7XHJcblxyXG4gICAgICAgICAgICAvL21pbiArPSAxO1xyXG4gICAgICAgICAgICBtaW4gLT0gMTtcclxuICAgICAgICAgICAgbWF4IC09IDM7XHJcbiAgICAgICAgICAgIGRpZiA9IChtYXggLSBtaW4pO1xyXG4gICAgICAgICAgICBpbnQgSCA9IChpbnQpKG1pbiArIChNYXRoLlJhbmRvbSgpICogZGlmKSk7XHJcblxyXG4gICAgICAgICAgICB2YXIgWCA9IC0xO1xyXG4gICAgICAgICAgICB2YXIgWSA9IC0xO1xyXG4gICAgICAgICAgICBpZiAoWGRpciAhPSAwKVxyXG4gICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICBZID0gKGludCkoU1kgKyAoTWF0aC5SYW5kb20oKSAqIChFWSAtIFNZKSkpO1xyXG4gICAgICAgICAgICAgICAgaWYgKFhkaXIgPCAwKVxyXG4gICAgICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgICAgIFggPSBTWCAtIFc7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICBlbHNlXHJcbiAgICAgICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICAgICAgWCA9IEVYO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIGVsc2UgaWYgKFlkaXIgIT0gMClcclxuICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgWCA9IChpbnQpKFNYICsgTWF0aC5SYW5kb20oKSAqICgoRVggLSBTWCkpKTtcclxuICAgICAgICAgICAgICAgIGlmIChZZGlyIDwgMClcclxuICAgICAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgICAgICBZID0gU1kgLSBIO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgZWxzZVxyXG4gICAgICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgICAgIFkgPSBFWTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgaWYgKFggPj0gMCAmJiBZID49IDApXHJcbiAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgIHZhciBNID0gbmV3IE1hcFJvb20oKTtcclxuICAgICAgICAgICAgICAgIE0uU1ggPSBYO1xyXG4gICAgICAgICAgICAgICAgTS5TWSA9IFk7XHJcbiAgICAgICAgICAgICAgICBNLkVYID0gWCArIFc7XHJcbiAgICAgICAgICAgICAgICBNLkVZID0gWSArIEg7XHJcbiAgICAgICAgICAgICAgICBNLnBhcmVudCA9IHRoaXM7XHJcbiAgICAgICAgICAgICAgICBNLmdhbWUgPSBnYW1lO1xyXG4gICAgICAgICAgICAgICAgaWYgKE0uQ2FuQmVQbGFjZWQoKSlcclxuICAgICAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgICAgICByZXR1cm4gTTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICByZXR1cm4gbnVsbDtcclxuICAgICAgICB9XHJcbiAgICAgICAgcHVibGljIHN0YXRpYyBMaXN0PE1hcFJvb20+IEZpbmRWYWxpZFVucGxhY2VkUm9vbXMoKVxyXG4gICAgICAgIHtcclxuICAgICAgICAgICAgdmFyIEwgPSBuZXcgTGlzdDxNYXBSb29tPigpO1xyXG4gICAgICAgICAgICB2YXIgaSA9IDA7XHJcbiAgICAgICAgICAgIHZhciBsbiA9IE9wZW5Sb29tcy5Db3VudDtcclxuICAgICAgICAgICAgd2hpbGUgKGkgPCBsbilcclxuICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgdmFyIFAgPSBPcGVuUm9vbXNbaV07XHJcbiAgICAgICAgICAgICAgICBMLkFkZFJhbmdlKFN5c3RlbS5MaW5xLkVudW1lcmFibGUuV2hlcmU8Z2xvYmFsOjpDaXJub0dhbWUuTWFwUm9vbT4oUC5FeGl0Um9vbXMsKGdsb2JhbDo6U3lzdGVtLkZ1bmM8Z2xvYmFsOjpDaXJub0dhbWUuTWFwUm9vbSwgYm9vbD4pKEYgPT4gRi5DYW5CZVBsYWNlZCgpICYmICFGLnBsYWNlZCkpKTtcclxuICAgICAgICAgICAgICAgIGkrKztcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICByZXR1cm4gTDtcclxuICAgICAgICB9XHJcbiAgICAgICAgcHVibGljIGJvb2wgQ29udGFpbnNUaWxlKGludCBYLGludCBZKVxyXG4gICAgICAgIHtcclxuICAgICAgICAgICAgcmV0dXJuIFggPj0gU1ggJiYgWSA+PSBTWSAmJiBYIDwgRVggJiYgWSA8IEVZO1xyXG4gICAgICAgIH1cclxuICAgICAgICBwdWJsaWMgYm9vbCBDb250YWluc1Bvc2l0aW9uKFZlY3RvcjIgVilcclxuICAgICAgICB7XHJcbiAgICAgICAgICAgIGludCBYID0gKGludCkoKFYuWCAtIGdhbWUuVE0ucG9zaXRpb24uWCkgLyBnYW1lLlRNLnRpbGVzaXplKTtcclxuICAgICAgICAgICAgaW50IFkgPSAoaW50KSgoVi5ZIC0gZ2FtZS5UTS5wb3NpdGlvbi5ZKSAvIGdhbWUuVE0udGlsZXNpemUpO1xyXG4gICAgICAgICAgICByZXR1cm4gWCA+PSBTWCAmJiBZID49IFNZICYmIFggPCBFWCAmJiBZIDwgRVk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHB1YmxpYyBzdGF0aWMgTWFwUm9vbSBGaW5kUm9vbShWZWN0b3IyIFYpXHJcbiAgICAgICAge1xyXG4gICAgICAgICAgICB2YXIgTCA9IFN5c3RlbS5MaW5xLkVudW1lcmFibGUuV2hlcmU8Z2xvYmFsOjpDaXJub0dhbWUuTWFwUm9vbT4oT3BlblJvb21zLChnbG9iYWw6OlN5c3RlbS5GdW5jPGdsb2JhbDo6Q2lybm9HYW1lLk1hcFJvb20sIGJvb2w+KShSID0+IFIuQ29udGFpbnNQb3NpdGlvbihWKSkpLlRvQXJyYXkoKTtcclxuICAgICAgICAgICAgaWYgKEwuTGVuZ3RoID4gMClcclxuICAgICAgICAgICAgICAgIHJldHVybiBMWzBdO1xyXG4gICAgICAgICAgICByZXR1cm4gbnVsbDtcclxuICAgICAgICB9XHJcbiAgICAgICAgLy8vIDxzdW1tYXJ5PlxyXG4gICAgICAgIC8vLyBjbGVhcnMgb3V0IHRoZSByb29tJ3MgYXJlYSwgYW5kIGF0dGVtcHRzIHRvIGdlbmVyYXRlIGV4aXRyb29tcy5cclxuICAgICAgICAvLy8gSWYgdGhlIHJvb20gaXMgaW52YWxpZCBpdCBkb2VzIG5vdGhpbmcsIGFuZCByZW1vdmVzIGl0c2VsZiBmcm9tIGl0J3MgcGFyZW50IGxpc3QuXHJcbiAgICAgICAgLy8vIDwvc3VtbWFyeT5cclxuICAgICAgICAvLy8gPHJldHVybnM+cmV0dXJucyB0cnVlIGlmIGl0IHdhcyB2YWxpZCBhbmQgd2FzIHBsYWNlZC48L3JldHVybnM+XHJcbiAgICAgICAgcHVibGljIGJvb2wgUGxhY2VBbmRFeHBhbmQoKVxyXG4gICAgICAgIHtcclxuICAgICAgICAgICAgaWYgKEV4aXRSb29tcy5Db3VudCA8IDEgJiYgIXBsYWNlZCAmJiBDYW5CZVBsYWNlZCgpKVxyXG4gICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICBQbGFjZSgpO1xyXG4gICAgICAgICAgICAgICAgaWYgKHBsYWNlZClcclxuICAgICAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgICAgICBHZW5lcmF0ZUFkamFjZW50Um9vbXMoKTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIHJldHVybiBwbGFjZWQ7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgZWxzZSBpZiAoIXBsYWNlZClcclxuICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgaWYgKHBhcmVudCAhPSBudWxsKVxyXG4gICAgICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgICAgIGlmIChDaXJub0dhbWUuSGVscGVyRXh0ZW5zaW9ucy5Db250YWluc0I8Z2xvYmFsOjpDaXJub0dhbWUuTWFwUm9vbT4ocGFyZW50LkV4aXRSb29tcyx0aGlzKSlcclxuICAgICAgICAgICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHBhcmVudC5FeGl0Um9vbXMuUmVtb3ZlKHRoaXMpO1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICByZXR1cm4gZmFsc2U7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHZvaWQgR2VuZXJhdGVHb2xkQ2hlc3RzKClcclxuICAgICAgICB7XHJcbiAgICAgICAgICAgIHZhciBsb2NrZWQgPSAhT3BlblJvb21zLkNvbnRhaW5zKHRoaXMpO1xyXG5cclxuICAgICAgICAgICAgdmFyIFYgPSBGaW5kRW1wdHlTcG90KCk7XHJcbiAgICAgICAgICAgIHZhciBjaGVzdCA9IG5ldyBDaGVzdChnYW1lKTtcclxuQ2lybm9HYW1lLkhlbHBlckV4dGVuc2lvbnMuUHVzaDxnbG9iYWw6OkNpcm5vR2FtZS5DaGVzdD4oICAgICAgICAgICAgZ29sZGNoZXN0cyxjaGVzdCk7XHJcbiAgICAgICAgICAgIGNoZXN0LkZvcmNlTG9ja2VkID0gbG9ja2VkO1xyXG4gICAgICAgICAgICBjaGVzdC5Qb3NpdGlvbi5Db3B5RnJvbShWKTtcclxuICAgICAgICAgICAgY2hlc3QuR29sZGlmeSgpO1xyXG4gICAgICAgICAgICBnYW1lLkFkZEVudGl0eShjaGVzdCk7XHJcblxyXG4gICAgICAgICAgICBWZWN0b3IyIFYyID0gRmluZEVtcHR5U3BvdCgpO1xyXG4gICAgICAgICAgICB2YXIgYXR0ZW1wdHMgPSAwO1xyXG4gICAgICAgICAgICB3aGlsZSAoYXR0ZW1wdHMrKyA8IDUgJiYgKFYyID09IG51bGwgfHwgTWF0aC5BYnMoVjIuWCAtIFYuWCkgPCAxNikpIHsgVjIgPSBGaW5kRW1wdHlTcG90KCk7IH1cclxuXHJcbiAgICAgICAgICAgIGlmIChWMiAhPSBudWxsICYmIE1hdGguQWJzKFYyLlggLSBWLlgpID4gMTYpXHJcbiAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgIGNoZXN0ID0gbmV3IENoZXN0KGdhbWUpO1xyXG5DaXJub0dhbWUuSGVscGVyRXh0ZW5zaW9ucy5QdXNoPGdsb2JhbDo6Q2lybm9HYW1lLkNoZXN0PiggICAgICAgICAgICAgICAgZ29sZGNoZXN0cyxjaGVzdCk7XHJcbiAgICAgICAgICAgICAgICBjaGVzdC5Qb3NpdGlvbi5Db3B5RnJvbShWMik7XHJcbiAgICAgICAgICAgICAgICBjaGVzdC5Gb3JjZUxvY2tlZCA9IGxvY2tlZDtcclxuICAgICAgICAgICAgICAgIGNoZXN0LkdvbGRpZnkoKTtcclxuICAgICAgICAgICAgICAgIGdhbWUuQWRkRW50aXR5KGNoZXN0KTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuICAgICAgICBwdWJsaWMgdm9pZCBOTWFrZVNlY3JldCgpLy9icm9rZW5cclxuICAgICAgICB7XHJcbiAgICAgICAgICAgIHZhciBUTSA9IGdhbWUuVE07XHJcbiAgICAgICAgICAgIHZhciBXID0gRVggLSBTWDtcclxuICAgICAgICAgICAgdmFyIEggPSBFWSAtIFNZO1xyXG4gICAgICAgICAgICAvL1RNLkZpbGxSZWN0KFNYLCBTWSwgVywgSCk7XHJcbiAgICAgICAgICAgIC8vQ2xlYXJSb29tKCk7XHJcbiAgICAgICAgICAgIC8vL1RNLkNsZWFyUmVjdChTWCwgU1ksIFcsIEgpO1xyXG4gICAgICAgICAgICBUTS5EcmF3UmVjdChTWCwgU1ksIFcsIEgpO1xyXG4gICAgICAgICAgICBUTS5TZXRCcmVha2FibGVSZWN0KFNYLCBTWSwgVywgSCwgZmFsc2UpO1xyXG4gICAgICAgICAgICBUTS5DbGVhclJlY3QoU1ggKyAxLCBTWSArIDEsIFcgLSAyLCBIIC0gMik7XHJcblxyXG4gICAgICAgICAgICAvLy9UTS5fR2VuUmVjdChTWCwgU1ksIEVYLCBFWSk7XHJcbiAgICAgICAgICAgIC8vLy9UTS5TZXRCcmVha2FibGVSZWN0KFNYICsgMSwgU1kgKyAxLCBXIC0gMiwgSCAtIDIsIHRydWUpO1xyXG4gICAgICAgICAgICBpZiAoT3BlblJvb21zLkNvbnRhaW5zKHRoaXMpKVxyXG4gICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICBPcGVuUm9vbXMuUmVtb3ZlKHRoaXMpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIHNlY3JldCA9IHRydWU7XHJcblxyXG4gICAgICAgICAgICBHZW5lcmF0ZUdvbGRDaGVzdHMoKTtcclxuICAgICAgICAgICAgXHJcbiAgICAgICAgICAgIEZvcmNlUmVkcmF3KCk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHB1YmxpYyB2b2lkIE1ha2VTZWNyZXQoKVxyXG4gICAgICAgIHtcclxuICAgICAgICAgICAgdmFyIFRNID0gZ2FtZS5UTTtcclxuICAgICAgICAgICAgdmFyIFcgPSBFWCAtIFNYO1xyXG4gICAgICAgICAgICB2YXIgSCA9IEVZIC0gU1k7XHJcbiAgICAgICAgICAgIFRNLkZpbGxSZWN0KFNYLCBTWSwgVywgSCk7XHJcbiAgICAgICAgICAgIFRNLlNldEJyZWFrYWJsZVJlY3QoU1gsIFNZLCBXLCBILGZhbHNlKTtcclxuICAgICAgICAgICAgVE0uU2V0QnJlYWthYmxlUmVjdChTWCsxLCBTWSsxLCBXLTIsIEgtMiwgdHJ1ZSk7XHJcbiAgICAgICAgICAgIGlmIChPcGVuUm9vbXMuQ29udGFpbnModGhpcykpXHJcbiAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgIE9wZW5Sb29tcy5SZW1vdmUodGhpcyk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgc2VjcmV0ID0gdHJ1ZTtcclxuICAgICAgICB9XHJcbiAgICAgICAgcHVibGljIHZvaWQgTlVubGVhc2hTZWNyZXQoKS8vYnJva2VuXHJcbiAgICAgICAge1xyXG4gICAgICAgICAgICB2YXIgVE0gPSBnYW1lLlRNO1xyXG5cclxuICAgICAgICAgICAgVE0uQ2xlYXJPdXRlclJlY3QoU1gsIFNZLCAoRVggLSBTWCksIChFWSAtIFNZKSwgZmFsc2UpO1xyXG4gICAgICAgICAgICAvL1RNLkNsZWFyUmVjdChTWCsxLCBTWSsxLCAoRVggLSBTWCktMiwgKEVZIC0gU1kpLTIpO1xyXG4gICAgICAgICAgICAvL1RNLl9HZW5SZWN0KFNYLCBTWSwgRVgsIEVZKTtcclxuXHJcbiAgICAgICAgICAgIE9wZW5Sb29tcy5BZGQodGhpcyk7XHJcbkNpcm5vR2FtZS5IZWxwZXJFeHRlbnNpb25zLkZvckVhY2g8Z2xvYmFsOjpDaXJub0dhbWUuQ2hlc3Q+KCAgICAgICAgICAgIGdvbGRjaGVzdHMsKGdsb2JhbDo6U3lzdGVtLkFjdGlvbjxnbG9iYWw6OkNpcm5vR2FtZS5DaGVzdD4pKEMgPT4gQy5Gb3JjZUxvY2tlZCA9IGZhbHNlKSk7XHJcblxyXG4gICAgICAgICAgICBGb3JjZVJlZHJhdygpO1xyXG4gICAgICAgIH1cclxuICAgICAgICBwdWJsaWMgdm9pZCBVbmxlYXNoU2VjcmV0KClcclxuICAgICAgICB7XHJcbiAgICAgICAgICAgIHZhciBUTSA9IGdhbWUuVE07XHJcblxyXG4gICAgICAgICAgICBUTS5DbGVhclJlY3QoU1ggKyAxLCBTWSArIDEsIChFWCAtIFNYKSAtIDIsIChFWSAtIFNZKSAtIDIpO1xyXG4gICAgICAgICAgICBUTS5fR2VuUmVjdChTWCwgU1ksIEVYLCBFWSk7XHJcblxyXG4gICAgICAgICAgICBPcGVuUm9vbXMuQWRkKHRoaXMpO1xyXG5cclxuICAgICAgICAgICAgR2VuZXJhdGVHb2xkQ2hlc3RzKCk7XHJcbiAgICAgICAgICAgIEZvcmNlUmVkcmF3KCk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHB1YmxpYyB2b2lkIENsZWFyUm9vbSgpXHJcbiAgICAgICAge1xyXG4gICAgICAgICAgICB2YXIgVE0gPSBnYW1lLlRNO1xyXG5cclxuICAgICAgICAgICAgVE0uQ2xlYXJSZWN0KFNYLCBTWSwgRVggLSBTWCwgRVkgLSBTWSk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHB1YmxpYyB2b2lkIEdlbmVyYXRlUGxhdGZvcm1zKClcclxuICAgICAgICB7XHJcbiAgICAgICAgICAgIHZhciBUTSA9IGdhbWUuVE07XHJcbiAgICAgICAgICAgIFRNLl9HZW5SZWN0KFNYLCBTWSwgRVgsIEVZKTtcclxuICAgICAgICB9XHJcbiAgICAgICAgcHJpdmF0ZSB2b2lkIFBsYWNlKClcclxuICAgICAgICB7XHJcbiAgICAgICAgICAgIHZhciBUTSA9IGdhbWUuVE07XHJcbiAgICAgICAgICAgIFRNLkNsZWFyUmVjdChTWCwgU1ksIEVYIC0gU1gsIEVZIC0gU1kpO1xyXG4gICAgICAgICAgICBUTS5fR2VuUmVjdChTWCwgU1ksIEVYLCBFWSk7XHJcblxyXG4gICAgICAgICAgICBQbGFjZWRSb29tcy5BZGQodGhpcyk7XHJcbiAgICAgICAgICAgIE9wZW5Sb29tcy5BZGQodGhpcyk7XHJcbiAgICAgICAgICAgIHBsYWNlZCA9IHRydWU7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHB1YmxpYyB2b2lkIEFwcGx5QnJlYWthYmxlKClcclxuICAgICAgICB7XHJcbiAgICAgICAgICAgIHZhciBUTSA9IGdhbWUuVE07XHJcbiAgICAgICAgICAgIFRNLkFwcGx5QnJlYWthYmxlUmVjdChTWCAtIDIsIFNZIC0gMiwgKEVYIC0gU1gpICsgNCwgKEVZIC0gU1kpICsgNCk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHB1YmxpYyB2b2lkIEZvcmNlUmVkcmF3KClcclxuICAgICAgICB7XHJcbiAgICAgICAgICAgIHZhciBUTSA9IGdhbWUuVE07XHJcbiAgICAgICAgICAgIHZhciBYID0gU1ggLSAyO1xyXG4gICAgICAgICAgICB2YXIgWSA9IFNZIC0gMjtcclxuICAgICAgICAgICAgdmFyIFcgPSAoRVggLSBTWCkrNDtcclxuICAgICAgICAgICAgdmFyIEggPSAoRVkgLSBTWSkrNDtcclxuICAgICAgICAgICAgVE0uYmcuQ2xlYXJSZWN0KChpbnQpVE0udGlsZXNpemUgKiBYLCAoaW50KVRNLnRpbGVzaXplICogWSwgKGludClUTS50aWxlc2l6ZSAqIFcsIChpbnQpVE0udGlsZXNpemUgKiBIKTtcclxuXHJcbiAgICAgICAgICAgIFRNLlJlZHJhdyhUTS5iZywgWCwgWSwgVywgSCk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHB1YmxpYyBzdGF0aWMgVmVjdG9yMiBGaW5kQW55RW1wdHlTcG90KClcclxuICAgICAgICB7XHJcbiAgICAgICAgICAgIGlmIChPcGVuUm9vbXMuQ291bnQgPCAxKVxyXG4gICAgICAgICAgICAgICAgcmV0dXJuIG51bGw7XHJcbiAgICAgICAgICAgIHZhciBpID0gMDtcclxuICAgICAgICAgICAgd2hpbGUgKGkgPCAxMClcclxuICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgdmFyIHJldCA9IENpcm5vR2FtZS5IZWxwZXJFeHRlbnNpb25zLlBpY2s8Z2xvYmFsOjpDaXJub0dhbWUuTWFwUm9vbT4oT3BlblJvb21zLFJORykuRmluZEVtcHR5U3BvdCgpO1xyXG4gICAgICAgICAgICAgICAgaWYgKHJldCAhPSBudWxsKVxyXG4gICAgICAgICAgICAgICAgICAgIHJldHVybiByZXQ7XHJcbiAgICAgICAgICAgICAgICBpKys7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgcmV0dXJuIG51bGw7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHByaXZhdGUgc3RhdGljIFJhbmRvbSBSTkcgPSBuZXcgUmFuZG9tKCk7XHJcbiAgICAgICAgcHVibGljIFZlY3RvcjIgRmluZEVtcHR5U3BvdCgpXHJcbiAgICAgICAge1xyXG4gICAgICAgICAgICB2YXIgVyA9IEVYIC0gU1g7XHJcbiAgICAgICAgICAgIHZhciBIID0gRVkgLSBTWTtcclxuICAgICAgICAgICAgdmFyIGkgPSAwO1xyXG4gICAgICAgICAgICB2YXIgbWFwID0gZ2FtZS5UTTtcclxuICAgICAgICAgICAgd2hpbGUgKGkgPCA1MClcclxuICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgdmFyIFggPSAoaW50KShTWCArIE1hdGguUmFuZG9tKCkgKiBXKTtcclxuICAgICAgICAgICAgICAgIHZhciBZID0gKGludCkoU1kgKyBNYXRoLlJhbmRvbSgpICogSCk7XHJcbiAgICAgICAgICAgICAgICB2YXIgVCA9IG1hcC5HZXRUaWxlKFgsIFkpO1xyXG4gICAgICAgICAgICAgICAgaWYgKFQgIT0gbnVsbCAmJiAoIVQuZW5hYmxlZCB8fCAhVC5zb2xpZCkpXHJcbiAgICAgICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICAgICAgVCA9IG1hcC5HZXRUaWxlKFgsIFkgLSAxKTtcclxuICAgICAgICAgICAgICAgICAgICBpZiAoVCAhPSBudWxsICYmICghVC5lbmFibGVkIHx8ICFULnNvbGlkKSlcclxuICAgICAgICAgICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBuZXcgVmVjdG9yMihtYXAucG9zaXRpb24uWCArIChYICogbWFwLnRpbGVzaXplKSwgbWFwLnBvc2l0aW9uLlkgKyAoWSAqIG1hcC50aWxlc2l6ZSkpO1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIGkrKztcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICByZXR1cm4gbnVsbDtcclxuICAgICAgICB9XHJcbiAgICAgICAgLypwcml2YXRlIHN0YXRpYyBUaWxlRGF0YSBibGFuayA9IG5ldyBUaWxlRGF0YSgpO1xyXG4gICAgICAgIHByaXZhdGUgc3RhdGljIHZvaWQgRXJhc2UoVGlsZU1hcCBUTSwgaW50IGNvbHVtbiwgaW50IHJvdywgaW50IHNpemUpXHJcbiAgICAgICAge1xyXG4gICAgICAgICAgICBUTS5DbGVhclJlY3QoY29sdW1uIC0gKHNpemUgLyAyKSwgcm93IC0gKHNpemUgLyAyKSwgKHNpemUpLCAoc2l6ZSkpO1xyXG4gICAgICAgIH1cclxuICAgICAgICBwcml2YXRlIHN0YXRpYyB2b2lkIEVyYXNlQW5kUmFuZG8oVGlsZU1hcCBUTSwgaW50IGNvbHVtbiwgaW50IHJvdywgaW50IHNpemUpXHJcbiAgICAgICAge1xyXG4gICAgICAgICAgICB2YXIgU1ggPSBjb2x1bW4gLSAoc2l6ZSAvIDIpO1xyXG4gICAgICAgICAgICB2YXIgU1kgPSByb3cgLSAoc2l6ZSAvIDIpO1xyXG4gICAgICAgICAgICBUTS5DbGVhclJlY3QoU1gsIFNZLCAoc2l6ZSksIChzaXplKSk7XHJcbiAgICAgICAgICAgIFRNLl9HZW5SZWN0KFNYLCBTWSwgU1ggKyAoc2l6ZSksIFNZICsgKHNpemUpKTtcclxuICAgICAgICB9Ki9cclxuICAgIH1cclxufVxyXG4iLCJ1c2luZyBTeXN0ZW07XHJcbnVzaW5nIFN5c3RlbS5Db2xsZWN0aW9ucy5HZW5lcmljO1xyXG51c2luZyBTeXN0ZW0uTGlucTtcclxudXNpbmcgU3lzdGVtLlRleHQ7XHJcbnVzaW5nIFN5c3RlbS5UaHJlYWRpbmcuVGFza3M7XHJcblxyXG5uYW1lc3BhY2UgQ2lybm9HYW1lXHJcbntcclxuICAgIHB1YmxpYyBzdGF0aWMgY2xhc3MgTWF0aEhlbHBlclxyXG4gICAge1xyXG4gICAgICAgIHB1YmxpYyBjb25zdCBmbG9hdCBQSSA9IDMuMTQxNTkyNjUzNTlmO1xyXG4gICAgICAgIHB1YmxpYyBjb25zdCBmbG9hdCBQSTIgPSA2LjI4MzE4NTMwNzE4ZjtcclxuXHJcbiAgICAgICAgcHVibGljIGNvbnN0IGZsb2F0IFBJT3ZlcjIgPSAxLjU3MDc5NjMyNjc5NWY7XHJcblxyXG4gICAgICAgIHB1YmxpYyBzdGF0aWMgZmxvYXQgRGlzdGFuY2VCZXR3ZWVuUG9pbnRzKFZlY3RvcjIgQSwgVmVjdG9yMiBCKVxyXG4gICAgICAgIHtcclxuICAgICAgICAgICAgcmV0dXJuIERpc3RhbmNlQmV0d2VlblBvaW50cyhBLlgsIEEuWSwgQi5YLCBCLlkpO1xyXG4gICAgICAgIH1cclxuICAgICAgICBwdWJsaWMgc3RhdGljIGZsb2F0IERpc3RhbmNlQmV0d2VlblBvaW50cyhmbG9hdCB4MSwgZmxvYXQgeTEsIGZsb2F0IHgyLCBmbG9hdCB5MilcclxuICAgICAgICB7XHJcbiAgICAgICAgICAgIHJldHVybiAoZmxvYXQpTWF0aC5TcXJ0KChNYXRoLlBvdyh4MSAtIHgyLCAyKSArIE1hdGguUG93KHkxIC0geTIsIDIpKSk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHB1YmxpYyBzdGF0aWMgZmxvYXQgQ2xhbXAoZmxvYXQgdmFsdWUsIGZsb2F0IG1pbiwgZmxvYXQgbWF4KVxyXG4gICAgICAgIHtcclxuICAgICAgICAgICAgcmV0dXJuIChmbG9hdClNYXRoLk1pbihtYXgsIE1hdGguTWF4KG1pbiwgdmFsdWUpKTtcclxuICAgICAgICB9XHJcbiAgICAgICAgcHVibGljIHN0YXRpYyBkb3VibGUgQ2xhbXAoZG91YmxlIHZhbHVlLCBkb3VibGUgbWluID0gMCwgZG91YmxlIG1heCA9IDEpXHJcbiAgICAgICAge1xyXG4gICAgICAgICAgICByZXR1cm4gTWF0aC5NaW4obWF4LCBNYXRoLk1heChtaW4sIHZhbHVlKSk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHB1YmxpYyBzdGF0aWMgZmxvYXQgTGVycChmbG9hdCB2YWx1ZTEsIGZsb2F0IHZhbHVlMiwgZmxvYXQgYW1vdW50KVxyXG4gICAgICAgIHtcclxuICAgICAgICAgICAgcmV0dXJuIHZhbHVlMSArICgodmFsdWUyIC0gdmFsdWUxKSAqIGFtb3VudCk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHB1YmxpYyBzdGF0aWMgZmxvYXQgRGVncmVlc1RvUmFkaWFucyhmbG9hdCBkZWdyZWVzKVxyXG4gICAgICAgIHtcclxuICAgICAgICAgICAgcmV0dXJuIGRlZ3JlZXMgKiAwLjAxNzQ1MzI5MjUxZjtcclxuICAgICAgICB9XHJcbiAgICAgICAgcHVibGljIHN0YXRpYyBmbG9hdCBSYWRpYW5zVG9EZWdyZWVzKGZsb2F0IHJhZGlhbnMpXHJcbiAgICAgICAge1xyXG4gICAgICAgICAgICByZXR1cm4gcmFkaWFucyAqIDU3LjI5NTc3OTU0NTdmO1xyXG4gICAgICAgIH1cclxuICAgICAgICBwdWJsaWMgc3RhdGljIGZsb2F0IEdldEFuZ2xlKFZlY3RvcjIgYSwgVmVjdG9yMiBiKVxyXG4gICAgICAgIHtcclxuICAgICAgICAgICAgZmxvYXQgYW5nbGUgPSAoZmxvYXQpKE1hdGguQXRhbjIoYi5ZIC0gYS5ZLCBiLlggLSBhLlgpKTtcclxuICAgICAgICAgICAgcmV0dXJuIGFuZ2xlO1xyXG4gICAgICAgIH1cclxuICAgICAgICBwdWJsaWMgc3RhdGljIGZsb2F0IEdldEFuZ2xlKFZlY3RvcjIgYSlcclxuICAgICAgICB7XHJcbiAgICAgICAgICAgIGZsb2F0IGFuZ2xlID0gKGZsb2F0KShNYXRoLkF0YW4yKGEuWSwgYS5YKSk7XHJcbiAgICAgICAgICAgIHJldHVybiBhbmdsZTtcclxuICAgICAgICB9XHJcbiAgICAgICAgcHVibGljIHN0YXRpYyBmbG9hdCBSb3VnaERpc3RhbmNlQmV0d2VlblBvaW50cyhWZWN0b3IyIGEsIFZlY3RvcjIgYilcclxuICAgICAgICB7XHJcbiAgICAgICAgICAgIC8vcmV0dXJuIChmbG9hdCkoTWF0aC5BYnMoYS54IC0gYi54KSArIE1hdGguQWJzKGEueSAtIGIueSkpO1xyXG4gICAgICAgICAgICByZXR1cm4gKGEgLSBiKS5Sb3VnaExlbmd0aDtcclxuICAgICAgICB9XHJcbiAgICAgICAgcHVibGljIHN0YXRpYyBmbG9hdCBNYWduaXR1ZGVPZlJlY3RhbmdsZShSZWN0YW5nbGUgUilcclxuICAgICAgICB7XHJcbiAgICAgICAgICAgIHJldHVybiBSLndpZHRoICsgUi5oZWlnaHQ7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHB1YmxpYyBzdGF0aWMgZmxvYXQgV3JhcFJhZGlhbnMoZmxvYXQgcmFkaWFuKVxyXG4gICAgICAgIHtcclxuICAgICAgICAgICAgd2hpbGUgKHJhZGlhbiA8IC1QSSlcclxuICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgcmFkaWFuICs9IFBJMjtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB3aGlsZSAocmFkaWFuID49IFBJKVxyXG4gICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICByYWRpYW4gLT0gUEkyO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIHJldHVybiByYWRpYW47XHJcbiAgICAgICAgICAgIC8vcmV0dXJuIHJhZGlhbiAlIFBJMjtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIHB1YmxpYyBzdGF0aWMgZG91YmxlIGluY3JlbWVudFRvd2FyZHMoZG91YmxlIGN1cnJlbnQsIGRvdWJsZSBkZXN0aW5hdGlvbiwgZG91YmxlIHNwZWVkKVxyXG4gICAgICAgIHtcclxuICAgICAgICAgICAgaWYgKGN1cnJlbnQgPCBkZXN0aW5hdGlvbilcclxuICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgY3VycmVudCArPSBzcGVlZDtcclxuICAgICAgICAgICAgICAgIGlmIChjdXJyZW50ID4gZGVzdGluYXRpb24pXHJcbiAgICAgICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICAgICAgY3VycmVudCA9IGRlc3RpbmF0aW9uO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIGlmIChjdXJyZW50ID4gZGVzdGluYXRpb24pXHJcbiAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgIGN1cnJlbnQgLT0gc3BlZWQ7XHJcbiAgICAgICAgICAgICAgICBpZiAoY3VycmVudCA8IGRlc3RpbmF0aW9uKVxyXG4gICAgICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgICAgIGN1cnJlbnQgPSBkZXN0aW5hdGlvbjtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICByZXR1cm4gY3VycmVudDtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIHB1YmxpYyBzdGF0aWMgZG91YmxlIGluY3JlbWVudFRvd2FyZHMoZG91YmxlIGN1cnJlbnQsIGRvdWJsZSBkZXN0aW5hdGlvbiwgZG91YmxlIGluY3NwZWVkLCBkb3VibGUgZGVjc3BlZWQpXHJcbiAgICAgICAge1xyXG4gICAgICAgICAgICBpZiAoY3VycmVudCA8IGRlc3RpbmF0aW9uKVxyXG4gICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICBjdXJyZW50ICs9IGluY3NwZWVkO1xyXG4gICAgICAgICAgICAgICAgaWYgKGN1cnJlbnQgPiBkZXN0aW5hdGlvbilcclxuICAgICAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgICAgICBjdXJyZW50ID0gZGVzdGluYXRpb247XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgaWYgKGN1cnJlbnQgPiBkZXN0aW5hdGlvbilcclxuICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgY3VycmVudCAtPSBkZWNzcGVlZDtcclxuICAgICAgICAgICAgICAgIGlmIChjdXJyZW50IDwgZGVzdGluYXRpb24pXHJcbiAgICAgICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICAgICAgY3VycmVudCA9IGRlc3RpbmF0aW9uO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIHJldHVybiBjdXJyZW50O1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgcHVibGljIHN0YXRpYyBWZWN0b3IyIFJhZGlhblRvVmVjdG9yKGZsb2F0IHJhZGlhbilcclxuICAgICAgICB7XHJcbiAgICAgICAgICAgIHJldHVybiBuZXcgVmVjdG9yMigoZmxvYXQpTWF0aC5Db3MocmFkaWFuKSwgKGZsb2F0KU1hdGguU2luKHJhZGlhbikpO1xyXG4gICAgICAgIH1cclxuICAgICAgICBwdWJsaWMgc3RhdGljIGRvdWJsZSBMZXJwKGRvdWJsZSBEMSwgZG91YmxlIEQyLCBkb3VibGUgbGVycClcclxuICAgICAgICB7XHJcbiAgICAgICAgICAgIGxlcnAgPSBNYXRoSGVscGVyLkNsYW1wKGxlcnApO1xyXG4gICAgICAgICAgICByZXR1cm4gKEQxICogKDEgLSBsZXJwKSkgKyAoRDIgKiBsZXJwKTtcclxuICAgICAgICB9XHJcbiAgICAgICAgcHVibGljIHN0YXRpYyBib29sIFdpdGhpbihkb3VibGUgdmFsLCBkb3VibGUgbWluLCBkb3VibGUgbWF4KVxyXG4gICAgICAgIHtcclxuICAgICAgICAgICAgcmV0dXJuIHZhbCA+PSBtaW4gJiYgdmFsIDw9IG1heDtcclxuICAgICAgICB9XHJcbiAgICAgICAgcHVibGljIHN0YXRpYyBkb3VibGUgTWVhbihwYXJhbXMgZG91YmxlW10gdmFsKVxyXG4gICAgICAgIHtcclxuICAgICAgICAgICAgZG91YmxlIHJldCA9IDA7XHJcbiAgICAgICAgICAgIGludCBpID0gMDtcclxuICAgICAgICAgICAgd2hpbGUgKGkgPCB2YWwuTGVuZ3RoKVxyXG4gICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICByZXQgKz0gdmFsW2ldO1xyXG4gICAgICAgICAgICAgICAgaSsrO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIHJldCAvPSB2YWwuTGVuZ3RoO1xyXG4gICAgICAgICAgICByZXR1cm4gcmV0O1xyXG4gICAgICAgIH1cclxuICAgICAgICBwdWJsaWMgc3RhdGljIGRvdWJsZSBEZWNlbGVyYXRlKGRvdWJsZSBtb21lbnR1bSwgZG91YmxlIGRlY2VsZXJhdGlvbilcclxuICAgICAgICB7XHJcbiAgICAgICAgICAgIHZhciBkaXIgPSBtb21lbnR1bSA+PSAwO1xyXG4gICAgICAgICAgICBtb21lbnR1bSA9IChkaXIgPyBtb21lbnR1bSA6IC1tb21lbnR1bSkgLSBkZWNlbGVyYXRpb247XHJcbiAgICAgICAgICAgIGlmIChtb21lbnR1bSA8IDApXHJcbiAgICAgICAgICAgICAgICByZXR1cm4gMDtcclxuICAgICAgICAgICAgcmV0dXJuIGRpciA/IG1vbWVudHVtIDogLW1vbWVudHVtO1xyXG4gICAgICAgIH1cclxuICAgIH1cclxufVxyXG4iLCJ1c2luZyBTeXN0ZW07XHJcbnVzaW5nIFN5c3RlbS5Db2xsZWN0aW9ucy5HZW5lcmljO1xyXG51c2luZyBTeXN0ZW0uTGlucTtcclxudXNpbmcgU3lzdGVtLlRleHQ7XHJcbnVzaW5nIFN5c3RlbS5UaHJlYWRpbmcuVGFza3M7XHJcblxyXG5uYW1lc3BhY2UgQ2lybm9HYW1lXHJcbntcclxuICAgIHB1YmxpYyBjbGFzcyBQb2ludFxyXG4gICAge1xyXG4gICAgICAgIHB1YmxpYyBpbnQgWDtcclxuICAgICAgICBwdWJsaWMgaW50IFk7XHJcbiAgICAgICAgcHVibGljIFBvaW50KGludCB4ID0gMCwgaW50IHkgPSAwKVxyXG4gICAgICAgIHtcclxuICAgICAgICAgICAgdGhpcy5YID0geDtcclxuICAgICAgICAgICAgdGhpcy5ZID0geTtcclxuICAgICAgICB9XHJcbiAgICB9XHJcbn1cclxuIiwidXNpbmcgU3lzdGVtO1xyXG51c2luZyBTeXN0ZW0uQ29sbGVjdGlvbnMuR2VuZXJpYztcclxudXNpbmcgU3lzdGVtLkxpbnE7XHJcbnVzaW5nIFN5c3RlbS5UZXh0O1xyXG51c2luZyBTeXN0ZW0uVGhyZWFkaW5nLlRhc2tzO1xyXG5cclxubmFtZXNwYWNlIENpcm5vR2FtZVxyXG57XHJcbiAgICBwdWJsaWMgY2xhc3MgUmVjdGFuZ2xlXHJcbiAgICB7XHJcbiAgICAgICAgcHVibGljIGZsb2F0IHggPSAwO1xyXG4gICAgICAgIHB1YmxpYyBmbG9hdCB5ID0gMDtcclxuICAgICAgICBwdWJsaWMgZmxvYXQgd2lkdGggPSAwO1xyXG4gICAgICAgIHB1YmxpYyBmbG9hdCBoZWlnaHQgPSAwO1xyXG5cclxuICAgICAgICBwdWJsaWMgZmxvYXQgbGVmdFxyXG4gICAgICAgIHtcclxuICAgICAgICAgICAgZ2V0XHJcbiAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgIHJldHVybiB4O1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIHNldFxyXG4gICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICB4ID0gdmFsdWU7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcbiAgICAgICAgcHVibGljIGZsb2F0IHRvcFxyXG4gICAgICAgIHtcclxuICAgICAgICAgICAgZ2V0XHJcbiAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgIHJldHVybiB5O1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIHNldFxyXG4gICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICB5ID0gdmFsdWU7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcbiAgICAgICAgcHVibGljIGZsb2F0IHJpZ2h0XHJcbiAgICAgICAge1xyXG4gICAgICAgICAgICBnZXRcclxuICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuIHggKyB3aWR0aDtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBzZXRcclxuICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgd2lkdGggPSB2YWx1ZSAtIHg7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcbiAgICAgICAgcHVibGljIGZsb2F0IGJvdHRvbVxyXG4gICAgICAgIHtcclxuICAgICAgICAgICAgZ2V0XHJcbiAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgIHJldHVybiB5ICsgaGVpZ2h0O1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIHNldFxyXG4gICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICBoZWlnaHQgPSB2YWx1ZSAtIHk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcbiAgICAgICAgcHVibGljIGZsb2F0W10gcG9pbnRzXHJcbiAgICAgICAge1xyXG4gICAgICAgICAgICBnZXRcclxuICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgZmxvYXRbXSByZXQgPSBuZXcgZmxvYXRbOF07XHJcbiAgICAgICAgICAgICAgICBpbnQgaSA9IDA7XHJcbiAgICAgICAgICAgICAgICByZXRbaSsrXSA9IHg7XHJcbiAgICAgICAgICAgICAgICByZXRbaSsrXSA9IHk7XHJcblxyXG4gICAgICAgICAgICAgICAgcmV0W2krK10gPSByaWdodDtcclxuICAgICAgICAgICAgICAgIHJldFtpKytdID0geTtcclxuXHJcbiAgICAgICAgICAgICAgICByZXRbaSsrXSA9IHJpZ2h0O1xyXG4gICAgICAgICAgICAgICAgcmV0W2krK10gPSBib3R0b207XHJcblxyXG4gICAgICAgICAgICAgICAgcmV0W2krK10gPSB4O1xyXG4gICAgICAgICAgICAgICAgcmV0W2krK10gPSBib3R0b207XHJcblxyXG4gICAgICAgICAgICAgICAgcmV0dXJuIHJldDtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuICAgICAgICBwdWJsaWMgVmVjdG9yMiBDZW50ZXJcclxuICAgICAgICB7XHJcbiAgICAgICAgICAgIGdldFxyXG4gICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gbmV3IFZlY3RvcjIobGVmdCArICh3aWR0aCAvIDIpLCB0b3AgKyAoaGVpZ2h0IC8gMikpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHB1YmxpYyB2b2lkIENvcHlGcm9tKFJlY3RhbmdsZSBSKVxyXG4gICAgICAgIHtcclxuICAgICAgICAgICAgeCA9IFIueDtcclxuICAgICAgICAgICAgeSA9IFIueTtcclxuICAgICAgICAgICAgd2lkdGggPSBSLndpZHRoO1xyXG4gICAgICAgICAgICBoZWlnaHQgPSBSLmhlaWdodDtcclxuICAgICAgICB9XHJcbiAgICAgICAgcHVibGljIHZvaWQgR2V0Q2VudGVyKFZlY3RvcjIgT1VUKVxyXG4gICAgICAgIHtcclxuICAgICAgICAgICAgT1VULlggPSBsZWZ0ICsgKHdpZHRoIC8gMik7XHJcbiAgICAgICAgICAgIE9VVC5ZID0gdG9wICsgKGhlaWdodCAvIDIpO1xyXG4gICAgICAgIH1cclxuICAgICAgICBwdWJsaWMgVmVjdG9yMiBNaW5cclxuICAgICAgICB7XHJcbiAgICAgICAgICAgIGdldFxyXG4gICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gbmV3IFZlY3RvcjIoeCwgeSk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgc2V0XHJcbiAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgIGlmICh2YWx1ZSA9PSBudWxsKVxyXG4gICAgICAgICAgICAgICAgICAgIHJldHVybjtcclxuICAgICAgICAgICAgICAgIHggPSB2YWx1ZS5YO1xyXG4gICAgICAgICAgICAgICAgeSA9IHZhbHVlLlk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcbiAgICAgICAgcHVibGljIFZlY3RvcjIgTWF4XHJcbiAgICAgICAge1xyXG4gICAgICAgICAgICBnZXRcclxuICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuIG5ldyBWZWN0b3IyKHJpZ2h0LCBib3R0b20pO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIHNldFxyXG4gICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICBpZiAodmFsdWUgPT0gbnVsbClcclxuICAgICAgICAgICAgICAgICAgICByZXR1cm47XHJcbiAgICAgICAgICAgICAgICByaWdodCA9IHZhbHVlLlg7XHJcbiAgICAgICAgICAgICAgICBib3R0b20gPSB2YWx1ZS5ZO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHB1YmxpYyBib29sIGNvbnRhaW5zUG9pbnQoZmxvYXQgeCwgZmxvYXQgeSlcclxuICAgICAgICB7XHJcbiAgICAgICAgICAgIGlmICh4ID49IHRoaXMueCAmJiB5ID49IHRoaXMueSAmJiB4IDw9IHJpZ2h0ICYmIHkgPD0gYm90dG9tKVxyXG4gICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gdHJ1ZTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICByZXR1cm4gZmFsc2U7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHB1YmxpYyBib29sIGNvbnRhaW5zUG9pbnQoVmVjdG9yMiBwb2ludClcclxuICAgICAgICB7XHJcbiAgICAgICAgICAgIGlmIChwb2ludC5YID49IHRoaXMueCAmJiBwb2ludC5ZID49IHRoaXMueSAmJiBwb2ludC5YIDw9IHJpZ2h0ICYmIHBvaW50LlkgPD0gYm90dG9tKVxyXG4gICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gdHJ1ZTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICByZXR1cm4gZmFsc2U7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHB1YmxpYyBib29sIGludGVyc2VjdHMoUmVjdGFuZ2xlIFIpXHJcbiAgICAgICAge1xyXG4gICAgICAgICAgICBmbG9hdFtdIHAgPSBSLnBvaW50cztcclxuICAgICAgICAgICAgYm9vbCBjb250YWluID0gZmFsc2U7XHJcbiAgICAgICAgICAgIGJvb2wgb3V0c2lkZSA9IGZhbHNlO1xyXG4gICAgICAgICAgICBpbnQgaSA9IDA7XHJcbiAgICAgICAgICAgIHdoaWxlIChpIDwgcC5MZW5ndGgpXHJcbiAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgIGlmIChjb250YWluc1BvaW50KHBbaSsrXSwgcFtpKytdKSlcclxuICAgICAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgICAgICBjb250YWluID0gdHJ1ZTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIGVsc2VcclxuICAgICAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgICAgICBvdXRzaWRlID0gdHJ1ZTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBpZiAoY29udGFpbiAmJiBvdXRzaWRlKVxyXG4gICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gdHJ1ZTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBpZiAoUi5sZWZ0IDwgbGVmdCAmJiBSLnJpZ2h0ID4gcmlnaHQpXHJcbiAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgIC8vaWYgKCh0b3AgPD0gUi50b3AgJiYgYm90dG9tIDw9IFIudG9wKSB8fCAodG9wIDw9IFIuYm90dG9tICYmIGJvdHRvbSA8PSBSLmJvdHRvbSkpXHJcbiAgICAgICAgICAgICAgICBpZiAoKHRvcCA8PSBSLnRvcCAmJiBib3R0b20gPj0gUi50b3ApIHx8ICh0b3AgPD0gUi5ib3R0b20gJiYgYm90dG9tID49IFIuYm90dG9tKSlcclxuICAgICAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgICAgICByZXR1cm4gdHJ1ZTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBpZiAoUi50b3AgPCB0b3AgJiYgUi5ib3R0b20gPiBib3R0b20pXHJcbiAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgIGlmICgobGVmdCA8PSBSLmxlZnQgJiYgcmlnaHQgPj0gUi5sZWZ0KSB8fCAobGVmdCA8PSBSLnJpZ2h0ICYmIHJpZ2h0ID49IFIucmlnaHQpKVxyXG4gICAgICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgICAgIHJldHVybiB0cnVlO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIC8qaWYgKFIubGVmdCA8IGxlZnQgJiYgUi5yaWdodCA+IHJpZ2h0KVxyXG4gICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICBpZiAoKHRvcCA8PSBSLnRvcCAmJiBib3R0b20gPD0gUi50b3ApIHx8ICh0b3AgPD0gUi5ib3R0b20gJiYgYm90dG9tIDw9IFIuYm90dG9tKSlcclxuICAgICAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgICAgICByZXR1cm4gdHJ1ZTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBpZiAoUi50b3AgPCB0b3AgJiYgUi5ib3R0b20gPiBib3R0b20pXHJcbiAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgIGlmICgobGVmdCA8PSBSLmxlZnQgJiYgcmlnaHQgPD0gUi5sZWZ0KSB8fCAobGVmdCA8PSBSLnJpZ2h0ICYmIHJpZ2h0IDw9IFIucmlnaHQpKVxyXG4gICAgICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgICAgIHJldHVybiB0cnVlO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9Ki9cclxuICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xyXG4gICAgICAgIH1cclxuICAgICAgICBwdWJsaWMgYm9vbCBpc1RvdWNoaW5nKFJlY3RhbmdsZSBSKVxyXG4gICAgICAgIHtcclxuICAgICAgICAgICAgaWYgKFIgPT0gbnVsbClcclxuICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIGZsb2F0W10gcCA9IFIucG9pbnRzO1xyXG4gICAgICAgICAgICBpbnQgaSA9IDA7XHJcbiAgICAgICAgICAgIHdoaWxlIChpIDwgcC5MZW5ndGgpXHJcbiAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgIGlmIChjb250YWluc1BvaW50KHBbaSsrXSwgcFtpKytdKSlcclxuICAgICAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgICAgICByZXR1cm4gdHJ1ZTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBpZiAoaW50ZXJzZWN0cyhSKSlcclxuICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuIHRydWU7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgLyppZiAoUi5sZWZ0IDwgbGVmdCAmJiBSLnJpZ2h0ID4gcmlnaHQpXHJcbiAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgIGlmICgodG9wPD1SLnRvcCAmJiBib3R0b208PVIudG9wKSB8fCAodG9wIDw9IFIuYm90dG9tICYmIGJvdHRvbSA8PSBSLmJvdHRvbSkpXHJcbiAgICAgICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHRydWU7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgaWYgKFIudG9wIDwgdG9wICYmIFIuYm90dG9tID4gYm90dG9tKVxyXG4gICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICBpZiAoKGxlZnQgPD0gUi5sZWZ0ICYmIHJpZ2h0IDw9IFIubGVmdCkgfHwgKGxlZnQgPD0gUi5yaWdodCAmJiByaWdodCA8PSBSLnJpZ2h0KSlcclxuICAgICAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgICAgICByZXR1cm4gdHJ1ZTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfSovXHJcbiAgICAgICAgICAgIHJldHVybiBmYWxzZTtcclxuICAgICAgICB9XHJcbiAgICAgICAgcHVibGljIFJlY3RhbmdsZShmbG9hdCB4ID0gMCwgZmxvYXQgeSA9IDAsIGZsb2F0IHdpZHRoID0gMCwgZmxvYXQgaGVpZ2h0ID0gMClcclxuICAgICAgICB7XHJcbiAgICAgICAgICAgIHRoaXMueCA9IHg7XHJcbiAgICAgICAgICAgIHRoaXMueSA9IHk7XHJcbiAgICAgICAgICAgIHRoaXMud2lkdGggPSB3aWR0aDtcclxuICAgICAgICAgICAgdGhpcy5oZWlnaHQgPSBoZWlnaHQ7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHB1YmxpYyB2b2lkIFNldChmbG9hdCB4ID0gMCwgZmxvYXQgeSA9IDAsIGZsb2F0IHdpZHRoID0gMCwgZmxvYXQgaGVpZ2h0ID0gMClcclxuICAgICAgICB7XHJcbiAgICAgICAgICAgIHRoaXMueCA9IHg7XHJcbiAgICAgICAgICAgIHRoaXMueSA9IHk7XHJcbiAgICAgICAgICAgIHRoaXMud2lkdGggPSB3aWR0aDtcclxuICAgICAgICAgICAgdGhpcy5oZWlnaHQgPSBoZWlnaHQ7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHB1YmxpYyBzdGF0aWMgUmVjdGFuZ2xlIG9wZXJhdG9yICsoUmVjdGFuZ2xlIEEsIFZlY3RvcjIgQilcclxuICAgICAgICB7XHJcbiAgICAgICAgICAgIHJldHVybiBuZXcgUmVjdGFuZ2xlKEEueCArIEIuWCwgQS55ICsgQi5ZLCBBLndpZHRoLCBBLmhlaWdodCk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHB1YmxpYyBzdGF0aWMgUmVjdGFuZ2xlIG9wZXJhdG9yIC0oUmVjdGFuZ2xlIEEsIFZlY3RvcjIgQilcclxuICAgICAgICB7XHJcbiAgICAgICAgICAgIHJldHVybiBuZXcgUmVjdGFuZ2xlKEEueCAtIEIuWCwgQS55IC0gQi5ZLCBBLndpZHRoLCBBLmhlaWdodCk7XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG59XHJcbiIsInVzaW5nIFN5c3RlbTtcclxudXNpbmcgU3lzdGVtLkNvbGxlY3Rpb25zLkdlbmVyaWM7XHJcbnVzaW5nIFN5c3RlbS5MaW5xO1xyXG51c2luZyBTeXN0ZW0uVGV4dDtcclxudXNpbmcgU3lzdGVtLlRocmVhZGluZy5UYXNrcztcclxuXHJcbm5hbWVzcGFjZSBDaXJub0dhbWVcclxue1xyXG4gICAgcHVibGljIGNsYXNzIFJlY3RhbmdsZUlcclxuICAgIHtcclxuICAgICAgICBwdWJsaWMgaW50IHggPSAwO1xyXG4gICAgICAgIHB1YmxpYyBpbnQgeSA9IDA7XHJcbiAgICAgICAgcHVibGljIGludCB3aWR0aCA9IDA7XHJcbiAgICAgICAgcHVibGljIGludCBoZWlnaHQgPSAwO1xyXG5cclxuXHJcbiAgICAgICAgcHVibGljIGludCBsZWZ0XHJcbiAgICAgICAge1xyXG4gICAgICAgICAgICBnZXRcclxuICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuIHg7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgc2V0XHJcbiAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgIHggPSB2YWx1ZTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuICAgICAgICBwdWJsaWMgaW50IHRvcFxyXG4gICAgICAgIHtcclxuICAgICAgICAgICAgZ2V0XHJcbiAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgIHJldHVybiB5O1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIHNldFxyXG4gICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICB5ID0gdmFsdWU7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcbiAgICAgICAgcHVibGljIGludCByaWdodFxyXG4gICAgICAgIHtcclxuICAgICAgICAgICAgZ2V0XHJcbiAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgIHJldHVybiB4ICsgd2lkdGg7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgc2V0XHJcbiAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgIHdpZHRoID0gdmFsdWUgLSB4O1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHB1YmxpYyBpbnQgYm90dG9tXHJcbiAgICAgICAge1xyXG4gICAgICAgICAgICBnZXRcclxuICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuIHkgKyBoZWlnaHQ7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgc2V0XHJcbiAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgIGhlaWdodCA9IHZhbHVlIC0geTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuICAgICAgICBwdWJsaWMgaW50W10gcG9pbnRzXHJcbiAgICAgICAge1xyXG4gICAgICAgICAgICBnZXRcclxuICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgaW50W10gcmV0ID0gbmV3IGludFs4XTtcclxuICAgICAgICAgICAgICAgIGludCBpID0gMDtcclxuICAgICAgICAgICAgICAgIHJldFtpKytdID0geDtcclxuICAgICAgICAgICAgICAgIHJldFtpKytdID0geTtcclxuXHJcbiAgICAgICAgICAgICAgICByZXRbaSsrXSA9IHJpZ2h0O1xyXG4gICAgICAgICAgICAgICAgcmV0W2krK10gPSB5O1xyXG5cclxuICAgICAgICAgICAgICAgIHJldFtpKytdID0gcmlnaHQ7XHJcbiAgICAgICAgICAgICAgICByZXRbaSsrXSA9IGJvdHRvbTtcclxuXHJcbiAgICAgICAgICAgICAgICByZXRbaSsrXSA9IHg7XHJcbiAgICAgICAgICAgICAgICByZXRbaSsrXSA9IGJvdHRvbTtcclxuXHJcbiAgICAgICAgICAgICAgICByZXR1cm4gcmV0O1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHB1YmxpYyBQb2ludCBDZW50ZXJcclxuICAgICAgICB7XHJcbiAgICAgICAgICAgIGdldFxyXG4gICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gbmV3IFBvaW50KGxlZnQgKyAod2lkdGggLyAyKSwgdG9wICsgKGhlaWdodCAvIDIpKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuICAgICAgICBwdWJsaWMgUG9pbnQgTWluXHJcbiAgICAgICAge1xyXG4gICAgICAgICAgICBnZXRcclxuICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuIG5ldyBQb2ludCh4LCB5KTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBzZXRcclxuICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgaWYgKHZhbHVlID09IG51bGwpXHJcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuO1xyXG4gICAgICAgICAgICAgICAgeCA9IHZhbHVlLlg7XHJcbiAgICAgICAgICAgICAgICB5ID0gdmFsdWUuWTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuICAgICAgICBwdWJsaWMgUG9pbnQgTWF4XHJcbiAgICAgICAge1xyXG4gICAgICAgICAgICBnZXRcclxuICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuIG5ldyBQb2ludChyaWdodCwgYm90dG9tKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBzZXRcclxuICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgaWYgKHZhbHVlID09IG51bGwpXHJcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuO1xyXG4gICAgICAgICAgICAgICAgcmlnaHQgPSB2YWx1ZS5YO1xyXG4gICAgICAgICAgICAgICAgYm90dG9tID0gdmFsdWUuWTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuICAgICAgICBwdWJsaWMgYm9vbCBjb250YWluc1BvaW50KGludCB4LCBpbnQgeSlcclxuICAgICAgICB7XHJcbiAgICAgICAgICAgIGlmICh4ID49IHRoaXMueCAmJiB5ID49IHRoaXMueSAmJiB4IDw9IHJpZ2h0ICYmIHkgPD0gYm90dG9tKVxyXG4gICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gdHJ1ZTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICByZXR1cm4gZmFsc2U7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHB1YmxpYyBib29sIGNvbnRhaW5zUG9pbnQoUG9pbnQgcG9pbnQpXHJcbiAgICAgICAge1xyXG4gICAgICAgICAgICBpZiAocG9pbnQuWCA+PSB0aGlzLnggJiYgcG9pbnQuWSA+PSB0aGlzLnkgJiYgcG9pbnQuWCA8PSByaWdodCAmJiBwb2ludC5ZIDw9IGJvdHRvbSlcclxuICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuIHRydWU7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xyXG4gICAgICAgIH1cclxuICAgICAgICBwdWJsaWMgYm9vbCBpbnRlcnNlY3RzKFJlY3RhbmdsZUkgUilcclxuICAgICAgICB7XHJcbiAgICAgICAgICAgIGludFtdIHAgPSBSLnBvaW50cztcclxuICAgICAgICAgICAgYm9vbCBjb250YWluID0gZmFsc2U7XHJcbiAgICAgICAgICAgIGJvb2wgb3V0c2lkZSA9IGZhbHNlO1xyXG4gICAgICAgICAgICBpbnQgaSA9IDA7XHJcbiAgICAgICAgICAgIHdoaWxlIChpIDwgcC5MZW5ndGgpXHJcbiAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgIGlmIChjb250YWluc1BvaW50KHBbaSsrXSwgcFtpKytdKSlcclxuICAgICAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgICAgICBjb250YWluID0gdHJ1ZTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIGVsc2VcclxuICAgICAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgICAgICBvdXRzaWRlID0gdHJ1ZTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBpZiAoY29udGFpbiAmJiBvdXRzaWRlKVxyXG4gICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gdHJ1ZTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBpZiAoUi5sZWZ0IDwgbGVmdCAmJiBSLnJpZ2h0ID4gcmlnaHQpXHJcbiAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgIC8vaWYgKCh0b3AgPD0gUi50b3AgJiYgYm90dG9tIDw9IFIudG9wKSB8fCAodG9wIDw9IFIuYm90dG9tICYmIGJvdHRvbSA8PSBSLmJvdHRvbSkpXHJcbiAgICAgICAgICAgICAgICBpZiAoKHRvcCA8PSBSLnRvcCAmJiBib3R0b20gPj0gUi50b3ApIHx8ICh0b3AgPD0gUi5ib3R0b20gJiYgYm90dG9tID49IFIuYm90dG9tKSlcclxuICAgICAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgICAgICByZXR1cm4gdHJ1ZTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBpZiAoUi50b3AgPCB0b3AgJiYgUi5ib3R0b20gPiBib3R0b20pXHJcbiAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgIGlmICgobGVmdCA8PSBSLmxlZnQgJiYgcmlnaHQgPj0gUi5sZWZ0KSB8fCAobGVmdCA8PSBSLnJpZ2h0ICYmIHJpZ2h0ID49IFIucmlnaHQpKVxyXG4gICAgICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgICAgIHJldHVybiB0cnVlO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIC8qaWYgKFIubGVmdCA8IGxlZnQgJiYgUi5yaWdodCA+IHJpZ2h0KVxyXG4gICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICBpZiAoKHRvcCA8PSBSLnRvcCAmJiBib3R0b20gPD0gUi50b3ApIHx8ICh0b3AgPD0gUi5ib3R0b20gJiYgYm90dG9tIDw9IFIuYm90dG9tKSlcclxuICAgICAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgICAgICByZXR1cm4gdHJ1ZTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBpZiAoUi50b3AgPCB0b3AgJiYgUi5ib3R0b20gPiBib3R0b20pXHJcbiAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgIGlmICgobGVmdCA8PSBSLmxlZnQgJiYgcmlnaHQgPD0gUi5sZWZ0KSB8fCAobGVmdCA8PSBSLnJpZ2h0ICYmIHJpZ2h0IDw9IFIucmlnaHQpKVxyXG4gICAgICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgICAgIHJldHVybiB0cnVlO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9Ki9cclxuICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xyXG4gICAgICAgIH1cclxuICAgICAgICBwdWJsaWMgYm9vbCBpc1RvdWNoaW5nKFJlY3RhbmdsZUkgUilcclxuICAgICAgICB7XHJcbiAgICAgICAgICAgIGlmIChSID09IG51bGwpXHJcbiAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBpbnRbXSBwID0gUi5wb2ludHM7XHJcbiAgICAgICAgICAgIGludCBpID0gMDtcclxuICAgICAgICAgICAgd2hpbGUgKGkgPCBwLkxlbmd0aClcclxuICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgaWYgKGNvbnRhaW5zUG9pbnQocFtpKytdLCBwW2krK10pKVxyXG4gICAgICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgICAgIHJldHVybiB0cnVlO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIGlmIChpbnRlcnNlY3RzKFIpKVxyXG4gICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gdHJ1ZTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICByZXR1cm4gZmFsc2U7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHB1YmxpYyBSZWN0YW5nbGVJKGludCB4ID0gMCwgaW50IHkgPSAwLCBpbnQgd2lkdGggPSAwLCBpbnQgaGVpZ2h0ID0gMClcclxuICAgICAgICB7XHJcbiAgICAgICAgICAgIHRoaXMueCA9IHg7XHJcbiAgICAgICAgICAgIHRoaXMueSA9IHk7XHJcbiAgICAgICAgICAgIHRoaXMud2lkdGggPSB3aWR0aDtcclxuICAgICAgICAgICAgdGhpcy5oZWlnaHQgPSBoZWlnaHQ7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHB1YmxpYyBzdGF0aWMgUmVjdGFuZ2xlSSBvcGVyYXRvciArKFJlY3RhbmdsZUkgQSwgUG9pbnQgQilcclxuICAgICAgICB7XHJcbiAgICAgICAgICAgIHJldHVybiBuZXcgUmVjdGFuZ2xlSShBLnggKyBCLlgsIEEueSArIEIuWSwgQS53aWR0aCwgQS5oZWlnaHQpO1xyXG4gICAgICAgIH1cclxuICAgICAgICBwdWJsaWMgc3RhdGljIFJlY3RhbmdsZUkgb3BlcmF0b3IgLShSZWN0YW5nbGVJIEEsIFBvaW50IEIpXHJcbiAgICAgICAge1xyXG4gICAgICAgICAgICByZXR1cm4gbmV3IFJlY3RhbmdsZUkoQS54IC0gQi5YLCBBLnkgLSBCLlksIEEud2lkdGgsIEEuaGVpZ2h0KTtcclxuICAgICAgICB9XHJcbiAgICB9XHJcbn1cclxuIiwidXNpbmcgU3lzdGVtO1xyXG51c2luZyBTeXN0ZW0uQ29sbGVjdGlvbnMuR2VuZXJpYztcclxudXNpbmcgU3lzdGVtLkxpbnE7XHJcbnVzaW5nIFN5c3RlbS5UZXh0O1xyXG51c2luZyBTeXN0ZW0uVGhyZWFkaW5nLlRhc2tzO1xyXG51c2luZyBCcmlkZ2U7XHJcbnVzaW5nIEJyaWRnZS5IdG1sNTtcclxuXHJcbm5hbWVzcGFjZSBDaXJub0dhbWVcclxue1xyXG4gICAgcHVibGljIGNsYXNzIFJlbmRlcmVyXHJcbiAgICB7XHJcbiAgICAgICAgcHVibGljIEhUTUxFbGVtZW50IHZpZXc7XHJcbiAgICAgICAgcHVibGljIFJlbmRlcmVyKGludCB3aWR0aCA9IDgwMCwgaW50IGhlaWdodCA9IDYwMCwgaW50IGJhY2tncm91bmRDb2xvciA9IDB4MTA5OWJiKVxyXG4gICAgICAgIHtcclxuICAgICAgICAgICAgLyp2YXIgd2lkdGggPSA4MDA7XHJcbiAgICAgICAgICAgIHZhciBoZWlnaHQgPSA2MDA7XHJcbiAgICAgICAgICAgIHZhciBiYWNrZ3JvdW5kQ29sb3IgPSAweDEwOTliYjsqL1xyXG4gICAgICAgICAgICB2aWV3ID0gU2NyaXB0LldyaXRlPGR5bmFtaWM+KFwibmV3IFBJWEkuQXBwbGljYXRpb24od2lkdGgsIGhlaWdodCwge2JhY2tncm91bmRDb2xvciA6IGJhY2tncm91bmRDb2xvcn0pXCIpO1xyXG4gICAgICAgIH1cclxuICAgIH1cclxufVxyXG4iLCJ1c2luZyBTeXN0ZW07XHJcbnVzaW5nIFN5c3RlbS5Db2xsZWN0aW9ucy5HZW5lcmljO1xyXG51c2luZyBTeXN0ZW0uTGlucTtcclxudXNpbmcgU3lzdGVtLlRleHQ7XHJcbnVzaW5nIFN5c3RlbS5UaHJlYWRpbmcuVGFza3M7XHJcbnVzaW5nIEJyaWRnZTtcclxudXNpbmcgQnJpZGdlLkh0bWw1O1xyXG5cclxubmFtZXNwYWNlIENpcm5vR2FtZVxyXG57XHJcbiAgICBwdWJsaWMgY2xhc3MgVGlsZURhdGFcclxuICAgIHtcclxuICAgICAgICBwdWJsaWMgaW50IHRleHR1cmU7XHJcbiAgICAgICAgcHVibGljIGludCByb3c7XHJcbiAgICAgICAgcHVibGljIGludCBjb2x1bW47XHJcbiAgICAgICAgcHVibGljIGJvb2wgZW5hYmxlZDtcclxuICAgICAgICBwdWJsaWMgVGlsZU1hcCBtYXA7XHJcbiAgICAgICAgcHVibGljIGJvb2wgdmlzaWJsZTtcclxuXHJcbiAgICAgICAgcHVibGljIGJvb2wgdG9wU29saWQ7XHJcbiAgICAgICAgcHVibGljIGJvb2wgcmlnaHRTb2xpZDtcclxuICAgICAgICBwdWJsaWMgYm9vbCBsZWZ0U29saWQ7XHJcbiAgICAgICAgcHVibGljIGJvb2wgYm90dG9tU29saWQ7XHJcblxyXG4gICAgICAgIHB1YmxpYyBib29sIENhblNsb3BlO1xyXG5cclxuICAgICAgICBwdWJsaWMgYm9vbCBCcmVha2FibGUgPSBmYWxzZTtcclxuICAgICAgICBwdWJsaWMgZmxvYXQgSFAgPSA0O1xyXG4gICAgICAgIHB1YmxpYyBmbG9hdCBtYXhIUCA9IDQ7XHJcbiAgICAgICAgcHVibGljIGJvb2wgb3BhcXVlID0gdHJ1ZTtcclxuXHJcbiAgICAgICAgcHJpdmF0ZSBSZWN0YW5nbGUgX2hpdGJveDtcclxuXHJcbiAgICAgICAgcHVibGljIEFjdGlvbjxQbGF0Zm9ybWVyRW50aXR5PiBTdGVwcGVkT247XHJcblxyXG4gICAgICAgIHB1YmxpYyBUaWxlRGF0YSBDbG9uZSgpXHJcbiAgICAgICAge1xyXG4gICAgICAgICAgICB2YXIgVCA9IG5ldyBUaWxlRGF0YSgpO1xyXG4gICAgICAgICAgICBULnRleHR1cmUgPSB0ZXh0dXJlO1xyXG4gICAgICAgICAgICBULmVuYWJsZWQgPSBlbmFibGVkO1xyXG4gICAgICAgICAgICBULm1hcCA9IG1hcDtcclxuICAgICAgICAgICAgVC52aXNpYmxlID0gdmlzaWJsZTtcclxuICAgICAgICAgICAgVC50b3BTb2xpZCA9IHRvcFNvbGlkO1xyXG4gICAgICAgICAgICBULnJpZ2h0U29saWQgPSByaWdodFNvbGlkO1xyXG4gICAgICAgICAgICBULmxlZnRTb2xpZCA9IGxlZnRTb2xpZDtcclxuICAgICAgICAgICAgVC5ib3R0b21Tb2xpZCA9IGJvdHRvbVNvbGlkO1xyXG4gICAgICAgICAgICBULkNhblNsb3BlID0gQ2FuU2xvcGU7XHJcbiAgICAgICAgICAgIHJldHVybiBUO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgcHVibGljIGJvb2wgRGFtYWdlKGZsb2F0IGRhbWFnZSlcclxuICAgICAgICB7XHJcbiAgICAgICAgICAgIEhQIC09IGRhbWFnZTtcclxuICAgICAgICAgICAgaWYgKEhQIDw9IDAgJiYgdG9wU29saWQpXHJcbiAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgIHNvbGlkID0gZmFsc2U7XHJcbiAgICAgICAgICAgICAgICB2aXNpYmxlID0gZmFsc2U7XHJcbiAgICAgICAgICAgICAgICBlbmFibGVkID0gZmFsc2U7XHJcbiAgICAgICAgICAgICAgICAvKmVuYWJsZWQgPSB0cnVlO1xyXG4gICAgICAgICAgICAgICAgdmlzaWJsZSA9IHRydWU7XHJcbiAgICAgICAgICAgICAgICB0ZXh0dXJlID0gMjsqL1xyXG4gICAgICAgICAgICAgICAgLyptYXAuRm9yY2VSZWRyYXcoKTsqL1xyXG4gICAgICAgICAgICAgICAgVXBkYXRlVGlsZSgpO1xyXG4gICAgICAgICAgICAgICAgU3Bhd25QYXJ0aWNsZXMoKTtcclxuICAgICAgICAgICAgICAgIHJldHVybiB0cnVlO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIGVsc2VcclxuICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgbWFwLlJlZHJhd1RpbGUoY29sdW1uLCByb3csIGZhbHNlKTtcclxuICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuICAgICAgICBwdWJsaWMgdm9pZCBVcGRhdGVUaWxlKClcclxuICAgICAgICB7XHJcbiAgICAgICAgICAgIG1hcC5SZWRyYXdUaWxlKGNvbHVtbiwgcm93KTtcclxuICAgICAgICB9XHJcbiAgICAgICAgcHJpdmF0ZSB2b2lkIFNwYXduUGFydGljbGVzKClcclxuICAgICAgICB7XHJcbiAgICAgICAgICAgIHZhciB0eCA9IChpbnQpTWF0aEhlbHBlci5DbGFtcCh0ZXh0dXJlLCAwLCBtYXAudGlsZXMuQ291bnQgLSAxKTtcclxuICAgICAgICAgICAgdmFyIFQgPSBtYXAudGlsZXNbdHhdO1xyXG5cclxuICAgICAgICAgICAgdmFyIHN6ID0gKGludCkobWFwLnRpbGVzaXplIC8gMik7XHJcbiAgICAgICAgICAgIHZhciBHID0gbWFwLmdhbWU7XHJcbiAgICAgICAgICAgIHZhciBIQiA9IEdldEhpdGJveCgpO1xyXG4gICAgICAgICAgICAvL3ZhciBzcGQgPSAxLjVmO1xyXG4gICAgICAgICAgICB2YXIgc3BkID0gMTtcclxuXHJcblxyXG4gICAgICAgICAgICB2YXIgQyA9IG5ldyBIVE1MQ2FudmFzRWxlbWVudCgpO1xyXG4gICAgICAgICAgICBDLldpZHRoID0gc3o7XHJcbiAgICAgICAgICAgIEMuSGVpZ2h0ID0gc3o7XHJcbiAgICAgICAgICAgIHZhciBnID0gSGVscGVyLkdldENvbnRleHQoQyk7XHJcblxyXG4gICAgICAgICAgICBnLkRyYXdJbWFnZShULCAwLCAwLCBzeiwgc3osIDAsIDAsIHN6LCBzeik7XHJcbiAgICAgICAgICAgIHZhciBQID0gbmV3IFBhcnRpY2xlKEcsIEMuQXM8SFRNTEltYWdlRWxlbWVudD4oKSk7XHJcbiAgICAgICAgICAgIFAuSHNwZWVkID0gLXNwZDtcclxuICAgICAgICAgICAgUC5Wc3BlZWQgPSAtc3BkO1xyXG4gICAgICAgICAgICBQLnggPSBIQi5sZWZ0O1xyXG4gICAgICAgICAgICBQLnkgPSBIQi50b3A7XHJcbiAgICAgICAgICAgIEcuQWRkRW50aXR5KFApO1xyXG5cclxuICAgICAgICAgICAgLy9cclxuICAgICAgICAgICAgQyA9IG5ldyBIVE1MQ2FudmFzRWxlbWVudCgpO1xyXG4gICAgICAgICAgICBDLldpZHRoID0gc3o7XHJcbiAgICAgICAgICAgIEMuSGVpZ2h0ID0gc3o7XHJcbiAgICAgICAgICAgIGcgPSBIZWxwZXIuR2V0Q29udGV4dChDKTtcclxuXHJcbiAgICAgICAgICAgIGcuRHJhd0ltYWdlKFQsIHN6LCAwLCBzeiwgc3osIDAsIDAsIHN6LCBzeik7XHJcbiAgICAgICAgICAgIFAgPSBuZXcgUGFydGljbGUoRywgQy5BczxIVE1MSW1hZ2VFbGVtZW50PigpKTtcclxuICAgICAgICAgICAgUC5Ic3BlZWQgPSBzcGQ7XHJcbiAgICAgICAgICAgIFAuVnNwZWVkID0gLXNwZDtcclxuICAgICAgICAgICAgUC54ID0gSEIubGVmdCArIHN6O1xyXG4gICAgICAgICAgICBQLnkgPSBIQi50b3A7XHJcbiAgICAgICAgICAgIEcuQWRkRW50aXR5KFApO1xyXG5cclxuICAgICAgICAgICAgLy9cclxuICAgICAgICAgICAgQyA9IG5ldyBIVE1MQ2FudmFzRWxlbWVudCgpO1xyXG4gICAgICAgICAgICBDLldpZHRoID0gc3o7XHJcbiAgICAgICAgICAgIEMuSGVpZ2h0ID0gc3o7XHJcbiAgICAgICAgICAgIGcgPSBIZWxwZXIuR2V0Q29udGV4dChDKTtcclxuXHJcbiAgICAgICAgICAgIGcuRHJhd0ltYWdlKFQsIDAsIHN6LCBzeiwgc3osIDAsIDAsIHN6LCBzeik7XHJcbiAgICAgICAgICAgIFAgPSBuZXcgUGFydGljbGUoRywgQy5BczxIVE1MSW1hZ2VFbGVtZW50PigpKTtcclxuICAgICAgICAgICAgUC5Ic3BlZWQgPSAtc3BkO1xyXG4gICAgICAgICAgICBQLlZzcGVlZCA9IHNwZDtcclxuICAgICAgICAgICAgUC54ID0gSEIubGVmdDtcclxuICAgICAgICAgICAgUC55ID0gSEIudG9wICsgc3o7XHJcbiAgICAgICAgICAgIEcuQWRkRW50aXR5KFApO1xyXG5cclxuICAgICAgICAgICAgLy9cclxuICAgICAgICAgICAgQyA9IG5ldyBIVE1MQ2FudmFzRWxlbWVudCgpO1xyXG4gICAgICAgICAgICBDLldpZHRoID0gc3o7XHJcbiAgICAgICAgICAgIEMuSGVpZ2h0ID0gc3o7XHJcbiAgICAgICAgICAgIGcgPSBIZWxwZXIuR2V0Q29udGV4dChDKTtcclxuXHJcbiAgICAgICAgICAgIGcuRHJhd0ltYWdlKFQsIHN6LCBzeiwgc3osIHN6LCAwLCAwLCBzeiwgc3opO1xyXG4gICAgICAgICAgICBQID0gbmV3IFBhcnRpY2xlKEcsIEMuQXM8SFRNTEltYWdlRWxlbWVudD4oKSk7XHJcbiAgICAgICAgICAgIFAuSHNwZWVkID0gc3BkO1xyXG4gICAgICAgICAgICBQLlZzcGVlZCA9IHNwZDtcclxuICAgICAgICAgICAgUC54ID0gSEIubGVmdCArIHN6O1xyXG4gICAgICAgICAgICBQLnkgPSBIQi50b3AgKyBzejtcclxuICAgICAgICAgICAgRy5BZGRFbnRpdHkoUCk7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBwdWJsaWMgYm9vbCBzb2xpZFxyXG4gICAgICAgIHtcclxuICAgICAgICAgICAgZ2V0XHJcbiAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgIHJldHVybiB0b3BTb2xpZCAmJiByaWdodFNvbGlkICYmIGxlZnRTb2xpZCAmJiBib3R0b21Tb2xpZDtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBzZXRcclxuICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgdG9wU29saWQgPSB2YWx1ZTtcclxuICAgICAgICAgICAgICAgIGxlZnRTb2xpZCA9IHZhbHVlO1xyXG4gICAgICAgICAgICAgICAgcmlnaHRTb2xpZCA9IHZhbHVlO1xyXG4gICAgICAgICAgICAgICAgYm90dG9tU29saWQgPSB2YWx1ZTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuICAgICAgICBSZWN0YW5nbGUgSFIgPSBuZXcgUmVjdGFuZ2xlKCk7XHJcbiAgICAgICAgcHVibGljIFJlY3RhbmdsZSBHZXRIaXRib3goKVxyXG4gICAgICAgIHtcclxuICAgICAgICAgICAgLyppZiAoX2hpdGJveCA9PSBudWxsKVxyXG4gICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICB2YXIgdHN6ID0gbWFwLnRpbGVzaXplO1xyXG4gICAgICAgICAgICAgICAgdmFyIHBvcyA9IG1hcC5wb3NpdGlvbjtcclxuICAgICAgICAgICAgICAgIF9oaXRib3ggPSBuZXcgUmVjdGFuZ2xlKHBvcy5YICsgKGNvbHVtbiAqIHRzeiksIHBvcy5ZICsgKHJvdyAqIHRzeiksIHRzeiwgdHN6KTtcclxuICAgICAgICAgICAgfSovXHJcbiAgICAgICAgICAgIHZhciB0c3ogPSBtYXAudGlsZXNpemU7XHJcbiAgICAgICAgICAgIHZhciBwb3MgPSBtYXAucG9zaXRpb247XHJcbiAgICAgICAgICAgIEhSLlNldChwb3MuWCArIChjb2x1bW4gKiB0c3opLCBwb3MuWSArIChyb3cgKiB0c3opLCB0c3osIHRzeik7XHJcbiAgICAgICAgICAgIHJldHVybiBIUjtcclxuICAgICAgICAgICAgLy9yZXR1cm4gbmV3IFJlY3RhbmdsZShwb3MuWCArIChjb2x1bW4gKiB0c3opLCBwb3MuWSArIChyb3cgKiB0c3opLCB0c3osIHRzeik7XHJcbiAgICAgICAgICAgIC8vcmV0dXJuIF9oaXRib3g7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHB1YmxpYyB2b2lkIEdldEhpdGJveDIoUmVjdGFuZ2xlIE9VVClcclxuICAgICAgICB7XHJcbiAgICAgICAgICAgIC8qaWYgKF9oaXRib3ggPT0gbnVsbClcclxuICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgdmFyIHRzeiA9IG1hcC50aWxlc2l6ZTtcclxuICAgICAgICAgICAgICAgIHZhciBwb3MgPSBtYXAucG9zaXRpb247XHJcbiAgICAgICAgICAgICAgICBfaGl0Ym94ID0gbmV3IFJlY3RhbmdsZShwb3MuWCArIChjb2x1bW4gKiB0c3opLCBwb3MuWSArIChyb3cgKiB0c3opLCB0c3osIHRzeik7XHJcbiAgICAgICAgICAgIH0qL1xyXG4gICAgICAgICAgICB2YXIgdHN6ID0gbWFwLnRpbGVzaXplO1xyXG4gICAgICAgICAgICB2YXIgcG9zID0gbWFwLnBvc2l0aW9uO1xyXG4gICAgICAgICAgICBPVVQueCA9IHBvcy5YICsgKGNvbHVtbiAqIHRzeik7XHJcbiAgICAgICAgICAgIE9VVC55ID0gcG9zLlkgKyAocm93ICogdHN6KTtcclxuICAgICAgICAgICAgT1VULndpZHRoID0gdHN6O1xyXG4gICAgICAgICAgICBPVVQuaGVpZ2h0ID0gdHN6O1xyXG4gICAgICAgICAgICAvL3JldHVybiBfaGl0Ym94O1xyXG4gICAgICAgIH1cclxuICAgICAgICBwdWJsaWMgYm9vbCBwbGF0Zm9ybVxyXG4gICAgICAgIHtcclxuICAgICAgICAgICAgZ2V0XHJcbiAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgIHJldHVybiB0b3BTb2xpZCAmJiAhcmlnaHRTb2xpZCAmJiAhbGVmdFNvbGlkICYmICFib3R0b21Tb2xpZDtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuICAgICAgICBwdWJsaWMgVGlsZURhdGEgR2V0VGlsZURhdGEoaW50IHJlbGF0aXZlWCwgaW50IHJlbGF0aXZlWSlcclxuICAgICAgICB7XHJcbiAgICAgICAgICAgIHJldHVybiBtYXAuR2V0VGlsZShjb2x1bW4gKyByZWxhdGl2ZVgsIHJvdyArIHJlbGF0aXZlWSk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHB1YmxpYyBib29sIHNvbGlkVG9TcGVlZChWZWN0b3IyIGFuZ2xlKVxyXG4gICAgICAgIHtcclxuICAgICAgICAgICAgaWYgKCFlbmFibGVkKVxyXG4gICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xyXG4gICAgICAgICAgICBpZiAoYW5nbGUuUm91Z2hMZW5ndGggPT0gMClcclxuICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuIHNvbGlkO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIGVsc2VcclxuICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgaWYgKChhbmdsZS5YID4gMCAmJiBsZWZ0U29saWQpIHx8IChhbmdsZS5YIDwgMCAmJiByaWdodFNvbGlkKSB8fCAoYW5nbGUuWSA+IDAgJiYgdG9wU29saWQpIHx8IChhbmdsZS5ZID4gMCAmJiBib3R0b21Tb2xpZCkpXHJcbiAgICAgICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHRydWU7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xyXG4gICAgICAgIH1cclxuICAgICAgICBwdWJsaWMgZmxvYXQgR2V0VG9wKFZlY3RvcjIgcG9zaXRpb24pXHJcbiAgICAgICAge1xyXG5cclxuICAgICAgICAgICAgLypUaWxlRGF0YSBMZWZ0ID0gR2V0VGlsZURhdGEoLTEsIDApO1xyXG4gICAgICAgICAgICBUaWxlRGF0YSBSaWdodCA9IEdldFRpbGVEYXRhKDEsIDApO1xyXG4gICAgICAgICAgICBib29sIExzb2xpZCA9IExlZnQgIT0gbnVsbCAmJiBMZWZ0LmVuYWJsZWQgJiYgTGVmdC5zb2xpZDtcclxuICAgICAgICAgICAgYm9vbCBSc29saWQgPSBSaWdodCAhPSBudWxsICYmIFJpZ2h0LmVuYWJsZWQgJiYgUmlnaHQuc29saWQ7Ki9cclxuICAgICAgICAgICAgaW50IGRpcmVjdGlvbiA9IFNsb3BlRGlyZWN0aW9uO1xyXG4gICAgICAgICAgICAvL2lmICghQ2FuU2xvcGUgfHwgIXNvbGlkIHx8IChMc29saWQgJiYgUnNvbGlkKSlcclxuICAgICAgICAgICAgdmFyIHRzeiA9IG1hcC50aWxlc2l6ZTtcclxuICAgICAgICAgICAgaWYgKGRpcmVjdGlvbiA9PSAwKVxyXG4gICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICAvL3JldHVybiBSLnRvcDtcclxuXHJcbiAgICAgICAgICAgICAgICB2YXIgcG9zID0gbWFwLnBvc2l0aW9uO1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuIHBvcy5ZICsgKHJvdyAqIHRzeik7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgZWxzZVxyXG4gICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICBSZWN0YW5nbGUgUiA9IEdldEhpdGJveCgpO1xyXG4gICAgICAgICAgICAgICAgZmxvYXQgWSA9ICgoUi5yaWdodCAtIHBvc2l0aW9uLlgpIC8gUi53aWR0aCkgKiB0c3o7XHJcbiAgICAgICAgICAgICAgICBpZiAoZGlyZWN0aW9uID4gMClcclxuICAgICAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgICAgICBZID0gKHRzeiAtIFkpO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgLy9ZICo9IDEuMGY7XHJcbiAgICAgICAgICAgICAgICBZID0gKGZsb2F0KU1hdGguTWluKHRzeiwgTWF0aC5NYXgoMCwgWSkpO1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuIFIuYm90dG9tIC0gWTtcclxuICAgICAgICAgICAgICAgIC8vcmV0dXJuIChmbG9hdClNYXRoLk1pbihSLnRvcCwgTWF0aC5NYXgoUi5ib3R0b20sKChSLnJpZ2h0IC0gcG9zaXRpb24uWCkgLyBSLndpZHRoKSAqIFIuaGVpZ2h0KSk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcbiAgICAgICAgcHVibGljIGJvb2wgSXNTbG9wZVxyXG4gICAgICAgIHtcclxuICAgICAgICAgICAgZ2V0XHJcbiAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgIHJldHVybiBTbG9wZURpcmVjdGlvbiAhPSAwO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHB1YmxpYyBpbnQgU2xvcGVEaXJlY3Rpb25cclxuICAgICAgICB7XHJcbiAgICAgICAgICAgIGdldFxyXG4gICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICBpZiAoIUNhblNsb3BlKVxyXG4gICAgICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgICAgIHJldHVybiAwO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgVGlsZURhdGEgQm90dG9tID0gR2V0VGlsZURhdGEoMCwgMSk7XHJcbiAgICAgICAgICAgICAgICBpZiAoIShCb3R0b20gIT0gbnVsbCAmJiBCb3R0b20uZW5hYmxlZCAmJiBCb3R0b20uc29saWQpKVxyXG4gICAgICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgICAgIHJldHVybiAwO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgVGlsZURhdGEgTGVmdCA9IEdldFRpbGVEYXRhKC0xLCAwKTtcclxuICAgICAgICAgICAgICAgIFRpbGVEYXRhIFJpZ2h0ID0gR2V0VGlsZURhdGEoMSwgMCk7XHJcbiAgICAgICAgICAgICAgICBib29sIExzb2xpZCA9IExlZnQgIT0gbnVsbCAmJiBMZWZ0LmVuYWJsZWQgJiYgTGVmdC5zb2xpZDtcclxuICAgICAgICAgICAgICAgIGJvb2wgUnNvbGlkID0gUmlnaHQgIT0gbnVsbCAmJiBSaWdodC5lbmFibGVkICYmIFJpZ2h0LnNvbGlkO1xyXG4gICAgICAgICAgICAgICAgaWYgKCFDYW5TbG9wZSB8fCAhc29saWQgfHwgKExzb2xpZCAmJiBSc29saWQpIHx8ICghUnNvbGlkICYmICFMc29saWQpKVxyXG4gICAgICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgICAgIHJldHVybiAwO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgVGlsZURhdGEgVG9wID0gR2V0VGlsZURhdGEoMCwgLTEpO1xyXG4gICAgICAgICAgICAgICAgYm9vbCBUc29saWQgPSBUb3AgIT0gbnVsbCAmJiBUb3AuZW5hYmxlZCAmJiBUb3Auc29saWQ7XHJcbiAgICAgICAgICAgICAgICBpZiAoVHNvbGlkKVxyXG4gICAgICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgICAgIHJldHVybiAwO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgaWYgKFJzb2xpZClcclxuICAgICAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgICAgICByZXR1cm4gMTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIGVsc2VcclxuICAgICAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgICAgICByZXR1cm4gLTE7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcbiAgICB9XHJcbn1cclxuIiwidXNpbmcgU3lzdGVtO1xyXG51c2luZyBTeXN0ZW0uQ29sbGVjdGlvbnMuR2VuZXJpYztcclxudXNpbmcgU3lzdGVtLkxpbnE7XHJcbnVzaW5nIFN5c3RlbS5UZXh0O1xyXG51c2luZyBTeXN0ZW0uVGhyZWFkaW5nLlRhc2tzO1xyXG51c2luZyBCcmlkZ2U7XHJcbnVzaW5nIEJyaWRnZS5IdG1sNTtcclxuXHJcbm5hbWVzcGFjZSBDaXJub0dhbWVcclxue1xyXG4gICAgcHVibGljIGNsYXNzIFRpbGVNYXBcclxuICAgIHtcclxuICAgICAgICBwdWJsaWMgVmVjdG9yMiBwb3NpdGlvbjtcclxuICAgICAgICBwdWJsaWMgZmxvYXQgdGlsZXNpemU7XHJcbiAgICAgICAgcHVibGljIGludCByb3dzO1xyXG4gICAgICAgIHB1YmxpYyBpbnQgY29sdW1ucztcclxuICAgICAgICBwdWJsaWMgVGlsZURhdGFbLF0gZGF0YTtcclxuICAgICAgICBwdWJsaWMgTGlzdDxIVE1MSW1hZ2VFbGVtZW50PiB0aWxlcztcclxuICAgICAgICBwdWJsaWMgTGlzdDxIVE1MSW1hZ2VFbGVtZW50PiBjcmFja3M7XHJcblxyXG4gICAgICAgIHB1YmxpYyBHYW1lIGdhbWU7XHJcblxyXG4gICAgICAgIHByb3RlY3RlZCBIVE1MQ2FudmFzRWxlbWVudCBidWZmZXI7XHJcbiAgICAgICAgcHVibGljIENhbnZhc1JlbmRlcmluZ0NvbnRleHQyRCBiZztcclxuXHJcbiAgICAgICAgLy8vIDxzdW1tYXJ5PlxyXG4gICAgICAgIC8vLyByZXR1cm5zIHRydWUgaWYgdGhlIHJlY3RhbmdsZSBoYXMgbm8gZW1wdHkgc3BhY2VzLlxyXG4gICAgICAgIC8vLyA8L3N1bW1hcnk+XHJcbiAgICAgICAgLy8vIDxwYXJhbSBuYW1lPVwic1hcIj48L3BhcmFtPlxyXG4gICAgICAgIC8vLyA8cGFyYW0gbmFtZT1cInNZXCI+PC9wYXJhbT5cclxuICAgICAgICAvLy8gPHBhcmFtIG5hbWU9XCJlWFwiPjwvcGFyYW0+XHJcbiAgICAgICAgLy8vIDxwYXJhbSBuYW1lPVwiZVlcIj48L3BhcmFtPlxyXG4gICAgICAgIC8vLyA8cmV0dXJucz48L3JldHVybnM+XHJcbiAgICAgICAgcHVibGljIGJvb2wgSXNSZWN0U29saWQoaW50IHNYLCBpbnQgc1ksIGludCBlWCwgaW50IGVZKVxyXG4gICAgICAgIHtcclxuICAgICAgICAgICAgdmFyIFggPSBzWDtcclxuICAgICAgICAgICAgdmFyIFkgPSBzWTtcclxuICAgICAgICAgICAgd2hpbGUgKFkgPCBlWSlcclxuICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgWCA9IHNZO1xyXG4gICAgICAgICAgICAgICAgd2hpbGUgKFggPCBlWClcclxuICAgICAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgICAgICB2YXIgVCA9IGRhdGFbWCwgWV07XHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKCEoVC5lbmFibGVkICYmIFQudG9wU29saWQpKVxyXG4gICAgICAgICAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICBYKys7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICBZKys7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgcmV0dXJuIHRydWU7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBwcm90ZWN0ZWQgUmFuZG9tIFJORDtcclxuICAgICAgICBwdWJsaWMgaW50IFNlZWQgPSAwO1xyXG5cclxuICAgICAgICBwdWJsaWMgdm9pZCBGb3JjZVJlZHJhdygpXHJcbiAgICAgICAge1xyXG4gICAgICAgICAgICBuZWVkUmVkcmF3ID0gdHJ1ZTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIHByb3RlY3RlZCBib29sIG5lZWRSZWRyYXc7XHJcbiAgICAgICAgcHVibGljIGJvb2wgQWxsb3dTa3lCcmlkZ2UgPSBmYWxzZTtcclxuICAgICAgICBwdWJsaWMgVGlsZU1hcChHYW1lIGdhbWUsIGludCBTZWVkID0gLTEpXHJcbiAgICAgICAge1xyXG4gICAgICAgICAgICBSTkQgPSBuZXcgUmFuZG9tKCk7XHJcbiAgICAgICAgICAgIC8vcG9zaXRpb24gPSBuZXcgVmVjdG9yMigtNTc2KTtcclxuICAgICAgICAgICAgLy8vcG9zaXRpb24gPSBuZXcgVmVjdG9yMigtMTI4KTtcclxuICAgICAgICAgICAgcG9zaXRpb24gPSBuZXcgVmVjdG9yMigpO1xyXG4gICAgICAgICAgICAvL3RpbGVzaXplID0gNDg7XHJcbiAgICAgICAgICAgIHRpbGVzaXplID0gMTY7XHJcbiAgICAgICAgICAgIC8vcm93cyA9IDE2O1xyXG4gICAgICAgICAgICAvKmNvbHVtbnMgPSA1MjsqL1xyXG4gICAgICAgICAgICByb3dzID0gKGludClNYXRoLkNlaWxpbmcoKCgtcG9zaXRpb24uWSAqIDIpICsgZ2FtZS5zdGFnZUJvdW5kcy5ib3R0b20pIC8gdGlsZXNpemUpO1xyXG4gICAgICAgICAgICBjb2x1bW5zID0gKGludClNYXRoLkNlaWxpbmcoKCgtcG9zaXRpb24uWCAqIDIpICsgZ2FtZS5zdGFnZUJvdW5kcy5yaWdodCkgLyB0aWxlc2l6ZSk7XHJcbiAgICAgICAgICAgIGRhdGEgPSBuZXcgVGlsZURhdGFbY29sdW1ucywgcm93c107XHJcbiAgICAgICAgICAgIHRpbGVzID0gQW5pbWF0aW9uTG9hZGVyLkdldChcImltYWdlcy9sYW5kL2JyaWNrXCIpO1xyXG4gICAgICAgICAgICBjcmFja3MgPSBBbmltYXRpb25Mb2FkZXIuR2V0KFwiaW1hZ2VzL2xhbmQvY3JhY2tzXCIpO1xyXG4gICAgICAgICAgICB0aGlzLmdhbWUgPSBnYW1lO1xyXG5cclxuICAgICAgICAgICAgYnVmZmVyID0gbmV3IEhUTUxDYW52YXNFbGVtZW50KCk7XHJcbiAgICAgICAgICAgIGJnID0gYnVmZmVyLkdldENvbnRleHQoQ2FudmFzVHlwZXMuQ2FudmFzQ29udGV4dDJEVHlwZS5DYW52YXNSZW5kZXJpbmdDb250ZXh0MkQpO1xyXG4gICAgICAgICAgICBpZiAoU2VlZCA8IDApXHJcbiAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgIHRoaXMuU2VlZCA9IFJORC5OZXh0KCk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgZWxzZVxyXG4gICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICB0aGlzLlNlZWQgPSBTZWVkO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIC8vUmFuZG9taXplKCk7XHJcbiAgICAgICAgICAgIEdlbmVyYXRlKCk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHByb3RlY3RlZCB2b2lkIFJhbmRvbWl6ZSgpXHJcbiAgICAgICAge1xyXG4gICAgICAgICAgICBpbnQgcm93ID0gMDtcclxuICAgICAgICAgICAgaW50IGNvbHVtbiA9IDA7XHJcbiAgICAgICAgICAgIHdoaWxlIChyb3cgPCByb3dzKVxyXG4gICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICB3aGlsZSAoY29sdW1uIDwgY29sdW1ucylcclxuICAgICAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgICAgICBUaWxlRGF0YSBUID0gbmV3IFRpbGVEYXRhKCk7XHJcbiAgICAgICAgICAgICAgICAgICAgVC5yb3cgPSByb3c7XHJcbiAgICAgICAgICAgICAgICAgICAgVC5jb2x1bW4gPSBjb2x1bW47XHJcbiAgICAgICAgICAgICAgICAgICAgVC50ZXh0dXJlID0gMTtcclxuICAgICAgICAgICAgICAgICAgICAvL1QuZW5hYmxlZCA9IChNYXRoLlJhbmRvbSgpIDwgMC4xNSkgfHwgKHJvdz49cm93cy0xKTtcclxuICAgICAgICAgICAgICAgICAgICBULmVuYWJsZWQgPSAoUk5ELk5leHREb3VibGUoKSA8IDAuMTUpIHx8IChyb3cgPj0gcm93cyAtIDEpO1xyXG4gICAgICAgICAgICAgICAgICAgIFQudG9wU29saWQgPSBULmVuYWJsZWQ7XHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKFQuZW5hYmxlZCAmJiAocm93ID49IHJvd3MgLSAxKSlcclxuICAgICAgICAgICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIFQudGV4dHVyZSA9IDI7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIFQuc29saWQgPSB0cnVlO1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICBlbHNlIGlmIChULmVuYWJsZWQpXHJcbiAgICAgICAgICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAoUk5ELk5leHREb3VibGUoKSA8IDAuMylcclxuICAgICAgICAgICAgICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgVC5zb2xpZCA9IHRydWU7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBULnRleHR1cmUgPSAwO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKFJORC5OZXh0RG91YmxlKCkgPCAwLjUpXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgVC50ZXh0dXJlID0gMztcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICBULnZpc2libGUgPSBULmVuYWJsZWQ7XHJcbiAgICAgICAgICAgICAgICAgICAgVC5tYXAgPSB0aGlzO1xyXG4gICAgICAgICAgICAgICAgICAgIGRhdGFbY29sdW1uLCByb3ddID0gVDtcclxuICAgICAgICAgICAgICAgICAgICBjb2x1bW4rKztcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIGNvbHVtbiA9IDA7XHJcbiAgICAgICAgICAgICAgICByb3crKztcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuICAgICAgICBwdWJsaWMgdm9pZCBHZW5lcmF0ZSgpXHJcbiAgICAgICAge1xyXG4gICAgICAgICAgICBSTkQgPSBuZXcgUmFuZG9tKFNlZWQpO1xyXG4gICAgICAgICAgICAvL1JhbmRvbWl6ZSgpO1xyXG4gICAgICAgICAgICBfR2VuKCk7XHJcbiAgICAgICAgICAgIG5lZWRSZWRyYXcgPSB0cnVlO1xyXG4gICAgICAgIH1cclxuICAgICAgICBwcm90ZWN0ZWQgdm9pZCBfR2VuKClcclxuICAgICAgICB7XHJcbiAgICAgICAgICAgIGludFtdIGhlaWdodG1hcCA9IG5ldyBpbnRbY29sdW1uc107XHJcbiAgICAgICAgICAgIC8vZmxvYXQgZW50cm9weSA9IDAuOGY7XHJcbiAgICAgICAgICAgIC8vZmxvYXQgZW50cm9weSA9IDAuNDVmO1xyXG4gICAgICAgICAgICBmbG9hdCBlbnRyb3B5ID0gMC42MGY7XHJcbiAgICAgICAgICAgIGludCBtYXggPSAoaW50KShyb3dzICogZW50cm9weSk7XHJcbiAgICAgICAgICAgIC8vaW50IHNtb290aG5lc3NTaXplID0gMTI7XHJcbiAgICAgICAgICAgIGludCBzbW9vdGhuZXNzU2l6ZSA9IDg7XHJcbiAgICAgICAgICAgIGludCBzbW9vdGhuZXNzU3RyZW5ndGggPSAyO1xyXG5cclxuICAgICAgICAgICAgaW50IFggPSAwO1xyXG4gICAgICAgICAgICAvL3JhbmRvbWl6ZXMgdGhlIGhlaWdodG1hcFxyXG4gICAgICAgICAgICB3aGlsZSAoWCA8IGNvbHVtbnMpXHJcbiAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgIGhlaWdodG1hcFtYXSA9IChpbnQpKFJORC5OZXh0RG91YmxlKCkgKiBtYXgpO1xyXG4gICAgICAgICAgICAgICAgWCArPSAxO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIGludCBzID0gMDtcclxuICAgICAgICAgICAgd2hpbGUgKHMgPCBzbW9vdGhuZXNzU3RyZW5ndGgpXHJcbiAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgIGludFtdIG9oZWlnaHRtYXAgPSBoZWlnaHRtYXA7XHJcbiAgICAgICAgICAgICAgICBoZWlnaHRtYXAgPSBuZXcgaW50W2NvbHVtbnNdO1xyXG4gICAgICAgICAgICAgICAgWCA9IDA7XHJcbiAgICAgICAgICAgICAgICB3aGlsZSAoWCA8IGNvbHVtbnMpXHJcbiAgICAgICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICAgICAgaGVpZ2h0bWFwW1hdID0gYmx1cihvaGVpZ2h0bWFwLCBYLCBzbW9vdGhuZXNzU2l6ZSk7XHJcbiAgICAgICAgICAgICAgICAgICAgWCArPSAxO1xyXG4gICAgICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgICAgIFggPSAxO1xyXG4gICAgICAgICAgICAgICAgcysrO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIC8vcmVtb3ZlcyBidW1wcyBmcm9tIGhlaWdodG1hcFxyXG4gICAgICAgICAgICB3aGlsZSAoWCA8IGNvbHVtbnMgLSAxKVxyXG4gICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICBpbnQgQSA9IGhlaWdodG1hcFtYIC0gMV07XHJcbiAgICAgICAgICAgICAgICBpbnQgQiA9IGhlaWdodG1hcFtYICsgMV07XHJcblxyXG4gICAgICAgICAgICAgICAgaW50IEggPSBoZWlnaHRtYXBbWF07XHJcbiAgICAgICAgICAgICAgICAvL2lmIChBID09IEIgJiYgTWF0aC5BYnMoQS0gSCk9PTEpXHJcbiAgICAgICAgICAgICAgICBpZiAoKEEgPiBIKSA9PSAoQiA+IEgpICYmIEggIT0gQSlcclxuICAgICAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgICAgICBoZWlnaHRtYXBbWF0gPSAoQSArIEIpIC8gMjtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIFggKz0gMTtcclxuICAgICAgICAgICAgfVxyXG5cclxuXHJcblxyXG4gICAgICAgICAgICBpbnQgcm93ID0gMDtcclxuICAgICAgICAgICAgaW50IGNvbHVtbiA9IDA7XHJcbiAgICAgICAgICAgIFRpbGVEYXRhIExUID0gbnVsbDtcclxuICAgICAgICAgICAgZmxvYXQgYnJpZGdlQ2hhbmNlID0gMC45MGY7XHJcbiAgICAgICAgICAgIGludCBSTkRicmlkZ2UgPSAwO1xyXG4gICAgICAgICAgICB3aGlsZSAocm93IDwgcm93cylcclxuICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgd2hpbGUgKGNvbHVtbiA8IGNvbHVtbnMpXHJcbiAgICAgICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICAgICAgaW50IEggPSByb3dzIC0gaGVpZ2h0bWFwW2NvbHVtbl07XHJcbiAgICAgICAgICAgICAgICAgICAgYm9vbCBmaWxsID0gcm93ID49IEg7XHJcbiAgICAgICAgICAgICAgICAgICAgVGlsZURhdGEgVCA9IG5ldyBUaWxlRGF0YSgpO1xyXG4gICAgICAgICAgICAgICAgICAgIFQucm93ID0gcm93O1xyXG4gICAgICAgICAgICAgICAgICAgIFQuY29sdW1uID0gY29sdW1uO1xyXG4gICAgICAgICAgICAgICAgICAgIFQudGV4dHVyZSA9IDE7XHJcbiAgICAgICAgICAgICAgICAgICAgLy9ULmVuYWJsZWQgPSAoTWF0aC5SYW5kb20oKSA8IDAuMTUpIHx8IChyb3cgPj0gcm93cyAtIDEpO1xyXG4gICAgICAgICAgICAgICAgICAgIFQuZW5hYmxlZCA9IChmaWxsKSB8fCAocm93ID49IHJvd3MgLSAxKTtcclxuICAgICAgICAgICAgICAgICAgICBULnRvcFNvbGlkID0gVC5lbmFibGVkO1xyXG4gICAgICAgICAgICAgICAgICAgIFQuYm90dG9tU29saWQgPSBULmVuYWJsZWQ7XHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKFQuZW5hYmxlZCAmJiAocm93ID49IHJvd3MgLSAxKSlcclxuICAgICAgICAgICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIFQudGV4dHVyZSA9IDI7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIFQuc29saWQgPSB0cnVlO1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICBlbHNlIGlmIChULmVuYWJsZWQpXHJcbiAgICAgICAgICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAvL2lmIChNYXRoLlJhbmRvbSgpIDwgMC4zKVxyXG4gICAgICAgICAgICAgICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBULnNvbGlkID0gdHJ1ZTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIFQudGV4dHVyZSA9IDQ7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBULkNhblNsb3BlID0gdHJ1ZTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChSTkQuTmV4dERvdWJsZSgpIDwgMC41KVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIFQudGV4dHVyZSA9IDU7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAocm93ID4gSCAmJiBSTkQuTmV4dERvdWJsZSgpIDwgMC4wMilcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBULnRleHR1cmUgPSA2O1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgIGlmICghVC5lbmFibGVkKVxyXG4gICAgICAgICAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKChBbGxvd1NreUJyaWRnZSAmJiByb3cgPT0gMjAgJiYgUk5ELk5leHREb3VibGUoKSA8IDAuOTMpIHx8IChyb3cgKyA0ID49IEggJiYgcm93ICsgMiA8IEggJiYgUk5ELk5leHREb3VibGUoKSA8IDAuMDI1KSB8fCAoTFQgIT0gbnVsbCAmJiBMVC5lbmFibGVkICYmIExULnRleHR1cmUgPT0gMSAmJiBSTkQuTmV4dERvdWJsZSgpIDwgYnJpZGdlQ2hhbmNlKSlcclxuICAgICAgICAgICAgICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgVC5lbmFibGVkID0gdHJ1ZTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIFQudG9wU29saWQgPSBULmVuYWJsZWQ7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBicmlkZ2VDaGFuY2UgLT0gMC4wNzVmO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGVsc2VcclxuICAgICAgICAgICAgICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKFJORGJyaWRnZSA8IDEgJiYgUk5ELk5leHREb3VibGUoKSA8IDAuMDE1KVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIFJORGJyaWRnZSA9IFJORC5OZXh0KDgpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKFJORGJyaWRnZSA+IDApXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgVC5lbmFibGVkID0gdHJ1ZTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBULnRvcFNvbGlkID0gVC5lbmFibGVkO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIFJORGJyaWRnZS0tO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vfWVsc2UgaWYgKFJORC5OZXh0RG91YmxlKCkgPCAwLjAyNSlcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVsc2UgaWYgKFJORC5OZXh0RG91YmxlKCkgPCAwLjAzNSlcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBULmVuYWJsZWQgPSB0cnVlO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIFQudG9wU29saWQgPSBULmVuYWJsZWQ7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBlbHNlIGlmICh0cnVlKS8vZGVidWcgZmlsbCB0aGluZ1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIFQuZW5hYmxlZCA9IHRydWU7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgVC50b3BTb2xpZCA9IFQuZW5hYmxlZDtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBULkNhblNsb3BlID0gTWF0aC5SYW5kb20oKSA8IDAuNTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICBpZiAoIVQuZW5hYmxlZCB8fCBULnRleHR1cmUgIT0gMSlcclxuICAgICAgICAgICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGJyaWRnZUNoYW5jZSA9IDAuOTBmO1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICBULnZpc2libGUgPSBULmVuYWJsZWQ7XHJcbiAgICAgICAgICAgICAgICAgICAgVC5tYXAgPSB0aGlzO1xyXG4gICAgICAgICAgICAgICAgICAgIFQuc29saWQgPSB0cnVlO1xyXG4gICAgICAgICAgICAgICAgICAgIGRhdGFbY29sdW1uLCByb3ddID0gVDtcclxuICAgICAgICAgICAgICAgICAgICBMVCA9IFQ7XHJcbiAgICAgICAgICAgICAgICAgICAgY29sdW1uKys7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICBjb2x1bW4gPSAwO1xyXG4gICAgICAgICAgICAgICAgcm93Kys7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcbiAgICAgICAgcHVibGljIHZvaWQgX0dlblJlY3QoaW50IFNYLCBpbnQgU1ksIGludCBFWCwgaW50IEVZKVxyXG4gICAgICAgIHtcclxuICAgICAgICAgICAgU1ggPSAoaW50KU1hdGhIZWxwZXIuQ2xhbXAoU1gsIDAsIGNvbHVtbnMgLSAxKTtcclxuICAgICAgICAgICAgU1kgPSAoaW50KU1hdGhIZWxwZXIuQ2xhbXAoU1ksIDAsIHJvd3MgLSAxKTtcclxuICAgICAgICAgICAgRVggPSAoaW50KU1hdGhIZWxwZXIuQ2xhbXAoRVgsIDAsIGNvbHVtbnMgLSAxKTtcclxuICAgICAgICAgICAgRVkgPSAoaW50KU1hdGhIZWxwZXIuQ2xhbXAoRVksIDAsIHJvd3MgLSAxKTtcclxuXHJcbiAgICAgICAgICAgIC8vZmxvYXQgZW50cm9weSA9IDAuOGY7XHJcbiAgICAgICAgICAgIC8vZmxvYXQgZW50cm9weSA9IDAuNDVmO1xyXG4gICAgICAgICAgICAvL2Zsb2F0IGVudHJvcHkgPSAwLjYwZjtcclxuICAgICAgICAgICAgLy8vZmxvYXQgZW50cm9weSA9IDAuNTBmO1xyXG4gICAgICAgICAgICAvLy8vaW50IG1heCA9IChpbnQpKHJvd3MgKiBlbnRyb3B5KTtcclxuICAgICAgICAgICAgLy9pbnQgc21vb3RobmVzc1NpemUgPSAxMjtcclxuXHJcbiAgICAgICAgICAgIGludCBYID0gMDtcclxuXHJcblxyXG5cclxuICAgICAgICAgICAgaW50IHJvdyA9IFNZO1xyXG4gICAgICAgICAgICBpbnQgY29sdW1uID0gU1g7XHJcbiAgICAgICAgICAgIFRpbGVEYXRhIExUID0gbnVsbDtcclxuICAgICAgICAgICAgLy9mbG9hdCBicmlkZ2VDaGFuY2UgPSAwLjkwZjtcclxuICAgICAgICAgICAgLy8vZmxvYXQgYnJpZGdlQ2hhbmNlID0gMC45NWY7XHJcbiAgICAgICAgICAgIGludCBSTkRicmlkZ2UgPSAwO1xyXG5cclxuICAgICAgICAgICAgd2hpbGUgKHJvdyA8IEVZKVxyXG4gICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICB3aGlsZSAoY29sdW1uIDwgRVgpXHJcbiAgICAgICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICAgICAgYm9vbCBmaWxsID0gZmFsc2U7XHJcbiAgICAgICAgICAgICAgICAgICAgVGlsZURhdGEgVCA9IG5ldyBUaWxlRGF0YSgpO1xyXG4gICAgICAgICAgICAgICAgICAgIFQucm93ID0gcm93O1xyXG4gICAgICAgICAgICAgICAgICAgIFQuY29sdW1uID0gY29sdW1uO1xyXG4gICAgICAgICAgICAgICAgICAgIFQudGV4dHVyZSA9IDE7XHJcbiAgICAgICAgICAgICAgICAgICAgLy9ULmVuYWJsZWQgPSAoTWF0aC5SYW5kb20oKSA8IDAuMTUpIHx8IChyb3cgPj0gcm93cyAtIDEpO1xyXG4gICAgICAgICAgICAgICAgICAgIFQuZW5hYmxlZCA9IChmaWxsKSB8fCAocm93ID49IHJvd3MgLSAxKTtcclxuICAgICAgICAgICAgICAgICAgICBULnRvcFNvbGlkID0gVC5lbmFibGVkO1xyXG4gICAgICAgICAgICAgICAgICAgIFQuYm90dG9tU29saWQgPSBULmVuYWJsZWQ7XHJcbiAgICAgICAgICAgICAgICAgICAgLyppZiAoVC5lbmFibGVkICYmIChyb3cgPj0gcm93cyAtIDEpKVxyXG4gICAgICAgICAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgVC50ZXh0dXJlID0gMjtcclxuICAgICAgICAgICAgICAgICAgICAgICAgVC5zb2xpZCA9IHRydWU7XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgIGVsc2UgaWYgKFQuZW5hYmxlZClcclxuICAgICAgICAgICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIC8vaWYgKE1hdGguUmFuZG9tKCkgPCAwLjMpXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIFQuc29saWQgPSB0cnVlO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgVC50ZXh0dXJlID0gNDtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIFQuQ2FuU2xvcGUgPSB0cnVlO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKFJORC5OZXh0RG91YmxlKCkgPCAwLjUpXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgVC50ZXh0dXJlID0gNTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChmYWxzZSAmJiBSTkQuTmV4dERvdWJsZSgpIDwgMC4wMilcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBULnRleHR1cmUgPSA2O1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgfSovXHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKCFULmVuYWJsZWQpXHJcbiAgICAgICAgICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAvKmlmICgoQWxsb3dTa3lCcmlkZ2UgJiYgcm93ID09IDIwICYmIFJORC5OZXh0RG91YmxlKCkgPCAwLjkzKSB8fCAoZmFsc2UgJiYgZmFsc2UgJiYgUk5ELk5leHREb3VibGUoKSA8IDAuMDI1KSB8fCAoTFQgIT0gbnVsbCAmJiBMVC5lbmFibGVkICYmIExULnRleHR1cmUgPT0gMSAmJiBSTkQuTmV4dERvdWJsZSgpIDwgYnJpZGdlQ2hhbmNlKSlcclxuICAgICAgICAgICAgICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgVC5lbmFibGVkID0gdHJ1ZTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIFQudG9wU29saWQgPSBULmVuYWJsZWQ7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBicmlkZ2VDaGFuY2UgLT0gMC4wNzVmO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGVsc2UqL1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoUk5EYnJpZGdlIDwgMSAmJiBSTkQuTmV4dERvdWJsZSgpIDwgMC4wMzApXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLy9STkRicmlkZ2UgPSBSTkQuTmV4dCg4KTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBSTkRicmlkZ2UgPSAyK1JORC5OZXh0KDQpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8qaWYgKE1hdGguUmFuZG9tKCkgPCAwLjkpXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBSTkRicmlkZ2UgKz0gMTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9Ki9cclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChSTkRicmlkZ2UgPiAwKVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIFQuZW5hYmxlZCA9IHRydWU7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgVC50b3BTb2xpZCA9IFQuZW5hYmxlZDtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBULkNhblNsb3BlID0gdHJ1ZTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBSTkRicmlkZ2UtLTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAvL31lbHNlIGlmIChSTkQuTmV4dERvdWJsZSgpIDwgMC4wMjUpXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAvL2Vsc2UgaWYgKFJORC5OZXh0RG91YmxlKCkgPCAwLjAzNSlcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vZWxzZSBpZiAoUk5ELk5leHREb3VibGUoKSA8IDAuMDQpXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAvL2Vsc2UgaWYgKFJORC5OZXh0RG91YmxlKCkgPCAwLjA0NSlcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVsc2UgaWYgKFJORC5OZXh0RG91YmxlKCkgPCAwLjAzMClcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBULmVuYWJsZWQgPSB0cnVlO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIFQudG9wU29saWQgPSBULmVuYWJsZWQ7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgVC5DYW5TbG9wZSA9IHRydWU7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgIC8qaWYgKCFULmVuYWJsZWQgfHwgVC50ZXh0dXJlICE9IDEpXHJcbiAgICAgICAgICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBicmlkZ2VDaGFuY2UgPSAwLjkwZjtcclxuICAgICAgICAgICAgICAgICAgICB9Ki9cclxuICAgICAgICAgICAgICAgICAgICBULnZpc2libGUgPSBULmVuYWJsZWQ7XHJcbiAgICAgICAgICAgICAgICAgICAgVC5tYXAgPSB0aGlzO1xyXG4gICAgICAgICAgICAgICAgICAgIFQuc29saWQgPSB0cnVlO1xyXG4gICAgICAgICAgICAgICAgICAgIGRhdGFbY29sdW1uLCByb3ddID0gVDtcclxuICAgICAgICAgICAgICAgICAgICBMVCA9IFQ7XHJcbiAgICAgICAgICAgICAgICAgICAgY29sdW1uKys7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICBjb2x1bW4gPSBTWDtcclxuICAgICAgICAgICAgICAgIHJvdysrO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHB1YmxpYyB2b2lkIFNldEJyZWFrYWJsZVJlY3QoaW50IGNvbHVtbiwgaW50IHJvdywgaW50IFdpZHRoLCBpbnQgSGVpZ2h0LGJvb2wgYnJlYWthYmxlKVxyXG4gICAgICAgIHtcclxuICAgICAgICAgICAgdmFyIFNYID0gKGludCkoY29sdW1uKTtcclxuICAgICAgICAgICAgdmFyIFNZID0gKGludCkocm93KTtcclxuICAgICAgICAgICAgdmFyIEVYID0gKGludCkoU1ggKyBXaWR0aCk7XHJcbiAgICAgICAgICAgIHZhciBFWSA9IChpbnQpKFNZICsgSGVpZ2h0KTtcclxuICAgICAgICAgICAgU1ggPSAoaW50KU1hdGhIZWxwZXIuQ2xhbXAoU1gsIDAsIGNvbHVtbnMgLSAxKTtcclxuICAgICAgICAgICAgU1kgPSAoaW50KU1hdGhIZWxwZXIuQ2xhbXAoU1ksIDAsIHJvd3MgLSAxKTtcclxuICAgICAgICAgICAgRVggPSAoaW50KU1hdGhIZWxwZXIuQ2xhbXAoRVgsIDAsIGNvbHVtbnMgLSAxKTtcclxuICAgICAgICAgICAgRVkgPSAoaW50KU1hdGhIZWxwZXIuQ2xhbXAoRVksIDAsIHJvd3MgLSAxKTtcclxuICAgICAgICAgICAgdmFyIFggPSBTWDtcclxuICAgICAgICAgICAgdmFyIFkgPSBTWTtcclxuICAgICAgICAgICAgVGlsZURhdGEgVCA9IG5ldyBUaWxlRGF0YSgpO1xyXG4gICAgICAgICAgICBULnJvdyA9IFk7XHJcbiAgICAgICAgICAgIFQuY29sdW1uID0gWDtcclxuICAgICAgICAgICAgVC50ZXh0dXJlID0gMTtcclxuICAgICAgICAgICAgVC5lbmFibGVkID0gdHJ1ZTtcclxuICAgICAgICAgICAgVC52aXNpYmxlID0gdHJ1ZTtcclxuICAgICAgICAgICAgVC5tYXAgPSB0aGlzO1xyXG4gICAgICAgICAgICBULnNvbGlkID0gdHJ1ZTtcclxuICAgICAgICAgICAgaWYgKGJyZWFrYWJsZSlcclxuICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgVC50ZXh0dXJlID0gMTtcclxuICAgICAgICAgICAgICAgIGlmIChNYXRoLlJhbmRvbSgpIDwgMC4wMilcclxuICAgICAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgICAgICBULnRleHR1cmUgPSBNYXRoLlJhbmRvbSgpIDwgMC41ID8gNSA6IDY7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICBULkJyZWFrYWJsZSA9IHRydWU7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgZWxzZVxyXG4gICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICBULnRleHR1cmUgPSAwO1xyXG4gICAgICAgICAgICAgICAgVC5CcmVha2FibGUgPSBmYWxzZTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB3aGlsZSAoWSA8IEVZKVxyXG4gICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICBYID0gU1g7XHJcbiAgICAgICAgICAgICAgICB3aGlsZSAoWCA8IEVYKVxyXG4gICAgICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgICAgIC8qdmFyIFRUID0gVC5DbG9uZSgpO1xyXG4gICAgICAgICAgICAgICAgICAgIFRULmNvbHVtbiA9IFg7XHJcbiAgICAgICAgICAgICAgICAgICAgVFQucm93ID0gWTtcclxuICAgICAgICAgICAgICAgICAgICBkYXRhW1gsIFldID0gVFQ7Ki9cclxuICAgICAgICAgICAgICAgICAgICB2YXIgVFQgPSBkYXRhW1gsIFldO1xyXG4gICAgICAgICAgICAgICAgICAgIGlmIChUVCA9PSBudWxsKVxyXG4gICAgICAgICAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgVFQgPSBULkNsb25lKCk7XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgIGlmIChULnNvbGlkKVxyXG4gICAgICAgICAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgVFQudGV4dHVyZSA9IFQudGV4dHVyZTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgVFQuQnJlYWthYmxlID0gVC5CcmVha2FibGU7XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgIFgrKztcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIFkrKztcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuICAgICAgICBwdWJsaWMgdm9pZCBGaWxsUmVjdChpbnQgY29sdW1uLCBpbnQgcm93LCBpbnQgV2lkdGgsIGludCBIZWlnaHQpXHJcbiAgICAgICAge1xyXG4gICAgICAgICAgICB2YXIgU1ggPSAoaW50KShjb2x1bW4pO1xyXG4gICAgICAgICAgICB2YXIgU1kgPSAoaW50KShyb3cpO1xyXG4gICAgICAgICAgICB2YXIgRVggPSAoaW50KShTWCArIFdpZHRoKTtcclxuICAgICAgICAgICAgdmFyIEVZID0gKGludCkoU1kgKyBIZWlnaHQpO1xyXG4gICAgICAgICAgICBTWCA9IChpbnQpTWF0aEhlbHBlci5DbGFtcChTWCwgMCwgY29sdW1ucyAtIDEpO1xyXG4gICAgICAgICAgICBTWSA9IChpbnQpTWF0aEhlbHBlci5DbGFtcChTWSwgMCwgcm93cyAtIDEpO1xyXG4gICAgICAgICAgICBFWCA9IChpbnQpTWF0aEhlbHBlci5DbGFtcChFWCwgMCwgY29sdW1ucyAtIDEpO1xyXG4gICAgICAgICAgICBFWSA9IChpbnQpTWF0aEhlbHBlci5DbGFtcChFWSwgMCwgcm93cyAtIDEpO1xyXG4gICAgICAgICAgICB2YXIgWCA9IFNYO1xyXG4gICAgICAgICAgICB2YXIgWSA9IFNZO1xyXG4gICAgICAgICAgICBUaWxlRGF0YSBUID0gbmV3IFRpbGVEYXRhKCk7XHJcbiAgICAgICAgICAgIFQucm93ID0gWTtcclxuICAgICAgICAgICAgVC5jb2x1bW4gPSBYO1xyXG4gICAgICAgICAgICBULnRleHR1cmUgPSAxO1xyXG4gICAgICAgICAgICBULmVuYWJsZWQgPSB0cnVlO1xyXG4gICAgICAgICAgICBULnZpc2libGUgPSB0cnVlO1xyXG4gICAgICAgICAgICBULm1hcCA9IHRoaXM7XHJcbiAgICAgICAgICAgIFQuc29saWQgPSB0cnVlO1xyXG4gICAgICAgICAgICB3aGlsZSAoWSA8IEVZKVxyXG4gICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICBYID0gU1g7XHJcbiAgICAgICAgICAgICAgICB3aGlsZSAoWCA8IEVYKVxyXG4gICAgICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgICAgIHZhciBUVCA9IFQuQ2xvbmUoKTtcclxuICAgICAgICAgICAgICAgICAgICBUVC5jb2x1bW4gPSBYO1xyXG4gICAgICAgICAgICAgICAgICAgIFRULnJvdyA9IFk7XHJcbiAgICAgICAgICAgICAgICAgICAgZGF0YVtYLCBZXSA9IFRUO1xyXG4gICAgICAgICAgICAgICAgICAgIFgrKztcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIFkrKztcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuICAgICAgICBwdWJsaWMgdm9pZCBEcmF3UmVjdChpbnQgY29sdW1uLCBpbnQgcm93LCBpbnQgV2lkdGgsIGludCBIZWlnaHQpXHJcbiAgICAgICAge1xyXG4gICAgICAgICAgICB2YXIgWCA9IGNvbHVtbjtcclxuICAgICAgICAgICAgdmFyIFkgPSByb3c7XHJcbiAgICAgICAgICAgIHZhciBUWCA9IFg7XHJcbiAgICAgICAgICAgIHZhciBUWSA9IFk7XHJcbiAgICAgICAgICAgIHZhciBFWCA9IFggKyBXaWR0aDtcclxuICAgICAgICAgICAgdmFyIEVZID0gWSArIEhlaWdodDtcclxuXHJcbiAgICAgICAgICAgIHdoaWxlIChUWCA8IEVYKVxyXG4gICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICBUaWxlRGF0YSBUID0gbmV3IFRpbGVEYXRhKCk7XHJcbiAgICAgICAgICAgICAgICBULnJvdyA9IFRZO1xyXG4gICAgICAgICAgICAgICAgVC5jb2x1bW4gPSBUWDtcclxuICAgICAgICAgICAgICAgIFQudGV4dHVyZSA9IDE7XHJcbiAgICAgICAgICAgICAgICBULmVuYWJsZWQgPSB0cnVlO1xyXG4gICAgICAgICAgICAgICAgVC52aXNpYmxlID0gdHJ1ZTtcclxuICAgICAgICAgICAgICAgIFQubWFwID0gdGhpcztcclxuICAgICAgICAgICAgICAgIFQuc29saWQgPSB0cnVlO1xyXG4gICAgICAgICAgICAgICAgU2V0VGlsZShUWCwgVFksIFQpO1xyXG4gICAgICAgICAgICAgICAgVFgrKztcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBUWCA9IFg7XHJcbiAgICAgICAgICAgIFRZID0gRVk7XHJcbiAgICAgICAgICAgIHdoaWxlIChUWCA8IEVYKVxyXG4gICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICBUaWxlRGF0YSBUID0gbmV3IFRpbGVEYXRhKCk7XHJcbiAgICAgICAgICAgICAgICBULnJvdyA9IFRZO1xyXG4gICAgICAgICAgICAgICAgVC5jb2x1bW4gPSBUWDtcclxuICAgICAgICAgICAgICAgIFQudGV4dHVyZSA9IDE7XHJcbiAgICAgICAgICAgICAgICBULmVuYWJsZWQgPSB0cnVlO1xyXG4gICAgICAgICAgICAgICAgVC52aXNpYmxlID0gdHJ1ZTtcclxuICAgICAgICAgICAgICAgIFQubWFwID0gdGhpcztcclxuICAgICAgICAgICAgICAgIFQuc29saWQgPSB0cnVlO1xyXG4gICAgICAgICAgICAgICAgU2V0VGlsZShUWCwgVFksIFQpO1xyXG4gICAgICAgICAgICAgICAgVFgrKztcclxuICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgVFggPSBYO1xyXG4gICAgICAgICAgICBUWSA9IFk7XHJcbiAgICAgICAgICAgIHdoaWxlIChUWSA8IEVZKVxyXG4gICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICBUaWxlRGF0YSBUID0gbmV3IFRpbGVEYXRhKCk7XHJcbiAgICAgICAgICAgICAgICBULnJvdyA9IFRZO1xyXG4gICAgICAgICAgICAgICAgVC5jb2x1bW4gPSBUWDtcclxuICAgICAgICAgICAgICAgIFQudGV4dHVyZSA9IDE7XHJcbiAgICAgICAgICAgICAgICBULmVuYWJsZWQgPSB0cnVlO1xyXG4gICAgICAgICAgICAgICAgVC52aXNpYmxlID0gdHJ1ZTtcclxuICAgICAgICAgICAgICAgIFQubWFwID0gdGhpcztcclxuICAgICAgICAgICAgICAgIFQuc29saWQgPSB0cnVlO1xyXG4gICAgICAgICAgICAgICAgU2V0VGlsZShUWCwgVFksIFQpO1xyXG4gICAgICAgICAgICAgICAgVFkrKztcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBUWCA9IEVYO1xyXG4gICAgICAgICAgICBUWSA9IFk7XHJcbiAgICAgICAgICAgIHdoaWxlIChUWSA8IEVZKVxyXG4gICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICBUaWxlRGF0YSBUID0gbmV3IFRpbGVEYXRhKCk7XHJcbiAgICAgICAgICAgICAgICBULnJvdyA9IFRZO1xyXG4gICAgICAgICAgICAgICAgVC5jb2x1bW4gPSBUWDtcclxuICAgICAgICAgICAgICAgIFQudGV4dHVyZSA9IDE7XHJcbiAgICAgICAgICAgICAgICBULmVuYWJsZWQgPSB0cnVlO1xyXG4gICAgICAgICAgICAgICAgVC52aXNpYmxlID0gdHJ1ZTtcclxuICAgICAgICAgICAgICAgIFQubWFwID0gdGhpcztcclxuICAgICAgICAgICAgICAgIFQuc29saWQgPSB0cnVlO1xyXG4gICAgICAgICAgICAgICAgU2V0VGlsZShUWCwgVFksIFQpO1xyXG4gICAgICAgICAgICAgICAgVFkrKztcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuICAgICAgICBwdWJsaWMgdm9pZCBEcmF3UmVjdChSZWN0YW5nbGUgcmVjdClcclxuICAgICAgICB7XHJcbiAgICAgICAgICAgIC8qdmFyIFBYID0gKGludCkoKHBvc2l0aW9uLlggLSBUUC5YKSAvIHRpbGVzaXplKTtcclxuICAgICAgICAgICAgdmFyIFBZID0gKGludCkoKHBvc2l0aW9uLlkgLSBUUC5ZKSAvIHRpbGVzaXplKTsqL1xyXG4gICAgICAgICAgICBEcmF3UmVjdCgoaW50KShyZWN0LmxlZnQgLyB0aWxlc2l6ZSksIChpbnQpKHJlY3QudG9wIC8gdGlsZXNpemUpLCAoaW50KShyZWN0LndpZHRoIC8gdGlsZXNpemUpLCAoaW50KShyZWN0LmhlaWdodCAvIHRpbGVzaXplKSk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHB1YmxpYyB2b2lkIFNldEFsbChUaWxlRGF0YSBUKVxyXG4gICAgICAgIHtcclxuICAgICAgICAgICAgdmFyIFggPSAwO1xyXG4gICAgICAgICAgICB2YXIgWSA9IDA7XHJcbiAgICAgICAgICAgIHdoaWxlIChZIDwgcm93cylcclxuICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgWCA9IDA7XHJcbiAgICAgICAgICAgICAgICB3aGlsZSAoWCA8IGNvbHVtbnMpXHJcbiAgICAgICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICAgICAgdmFyIFREID0gVC5DbG9uZSgpO1xyXG4gICAgICAgICAgICAgICAgICAgIFRELmNvbHVtbiA9IFg7XHJcbiAgICAgICAgICAgICAgICAgICAgVEQucm93ID0gWTtcclxuICAgICAgICAgICAgICAgICAgICBkYXRhW1gsIFldID0gVDtcclxuICAgICAgICAgICAgICAgICAgICBYKys7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICBZKys7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcbiAgICAgICAgcHVibGljIHZvaWQgQ2xlYXJPdXRlclJlY3QoaW50IGNvbHVtbiwgaW50IHJvdywgaW50IHdpZHRoLCBpbnQgaGVpZ2h0LGJvb2wgYm90dG9tPXRydWUpXHJcbiAgICAgICAge1xyXG4gICAgICAgICAgICB2YXIgU1ggPSAoaW50KShjb2x1bW4pO1xyXG4gICAgICAgICAgICB2YXIgU1kgPSAoaW50KShyb3cpO1xyXG4gICAgICAgICAgICB2YXIgRVggPSAoaW50KShTWCArIHdpZHRoKTtcclxuICAgICAgICAgICAgdmFyIEVZID0gKGludCkoU1kgKyBoZWlnaHQpO1xyXG4gICAgICAgICAgICBTWCA9IChpbnQpTWF0aEhlbHBlci5DbGFtcChTWCwgMCwgY29sdW1ucyAtIDEpO1xyXG4gICAgICAgICAgICBTWSA9IChpbnQpTWF0aEhlbHBlci5DbGFtcChTWSwgMCwgcm93cyAtIDEpO1xyXG4gICAgICAgICAgICBFWCA9IChpbnQpTWF0aEhlbHBlci5DbGFtcChFWCwgMCwgY29sdW1ucyAtIDEpO1xyXG4gICAgICAgICAgICBFWSA9IChpbnQpTWF0aEhlbHBlci5DbGFtcChFWSwgMCwgcm93cyAtIDEpO1xyXG4gICAgICAgICAgICB2YXIgWCA9IFNYO1xyXG4gICAgICAgICAgICB2YXIgWSA9IFNZO1xyXG4gICAgICAgICAgICB2YXIgVCA9IG5ldyBUaWxlRGF0YSgpO1xyXG4gICAgICAgICAgICBULm1hcCA9IHRoaXM7XHJcbiAgICAgICAgICAgIFQudmlzaWJsZSA9IGZhbHNlO1xyXG4gICAgICAgICAgICBULnNvbGlkID0gZmFsc2U7XHJcbiAgICAgICAgICAgIHZhciBUWCA9IFg7XHJcbiAgICAgICAgICAgIHZhciBUWSA9IFk7XHJcbiAgICAgICAgICAgIHdoaWxlIChUWCA8IEVYLTEpXHJcbiAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgIHZhciBUVCA9IFQuQ2xvbmUoKTtcclxuICAgICAgICAgICAgICAgIFRULmNvbHVtbiA9IFRYO1xyXG4gICAgICAgICAgICAgICAgVFQucm93ID0gVFk7XHJcbiAgICAgICAgICAgICAgICBTZXRUaWxlKFRYLCBUWSwgVFQpO1xyXG4gICAgICAgICAgICAgICAgVFgrKztcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBUWCA9IFg7XHJcbiAgICAgICAgICAgIFRZID0gRVk7XHJcbiAgICAgICAgICAgIGlmIChib3R0b20pXHJcbiAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgIHdoaWxlIChUWCA8IEVYKVxyXG4gICAgICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgICAgIHZhciBUVCA9IFQuQ2xvbmUoKTtcclxuICAgICAgICAgICAgICAgICAgICBUVC5jb2x1bW4gPSBUWDtcclxuICAgICAgICAgICAgICAgICAgICBUVC5yb3cgPSBUWTtcclxuICAgICAgICAgICAgICAgICAgICBTZXRUaWxlKFRYLCBUWSwgVFQpO1xyXG4gICAgICAgICAgICAgICAgICAgIFRYKys7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgIFRYID0gWDtcclxuICAgICAgICAgICAgVFkgPSBZO1xyXG4gICAgICAgICAgICB3aGlsZSAoVFkgPCBFWS0xKVxyXG4gICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICB2YXIgVFQgPSBULkNsb25lKCk7XHJcbiAgICAgICAgICAgICAgICBUVC5jb2x1bW4gPSBUWDtcclxuICAgICAgICAgICAgICAgIFRULnJvdyA9IFRZO1xyXG4gICAgICAgICAgICAgICAgU2V0VGlsZShUWCwgVFksIFRUKTtcclxuICAgICAgICAgICAgICAgIFRZKys7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgVFggPSBFWDtcclxuICAgICAgICAgICAgVFkgPSBZO1xyXG4gICAgICAgICAgICB3aGlsZSAoVFkgPCBFWS0xKVxyXG4gICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICB2YXIgVFQgPSBULkNsb25lKCk7XHJcbiAgICAgICAgICAgICAgICBUVC5jb2x1bW4gPSBUWDtcclxuICAgICAgICAgICAgICAgIFRULnJvdyA9IFRZO1xyXG4gICAgICAgICAgICAgICAgU2V0VGlsZShUWCwgVFksIFRUKTtcclxuICAgICAgICAgICAgICAgIFRZKys7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcbiAgICAgICAgcHVibGljIHZvaWQgQ2xlYXJSZWN0KGludCBjb2x1bW4sIGludCByb3csIGludCB3aWR0aCwgaW50IGhlaWdodClcclxuICAgICAgICB7XHJcbiAgICAgICAgICAgIHZhciBTWCA9IChpbnQpKGNvbHVtbik7XHJcbiAgICAgICAgICAgIHZhciBTWSA9IChpbnQpKHJvdyk7XHJcbiAgICAgICAgICAgIHZhciBFWCA9IChpbnQpKFNYICsgd2lkdGgpO1xyXG4gICAgICAgICAgICB2YXIgRVkgPSAoaW50KShTWSArIGhlaWdodCk7XHJcbiAgICAgICAgICAgIFNYID0gKGludClNYXRoSGVscGVyLkNsYW1wKFNYLCAwLCBjb2x1bW5zIC0gMSk7XHJcbiAgICAgICAgICAgIFNZID0gKGludClNYXRoSGVscGVyLkNsYW1wKFNZLCAwLCByb3dzIC0gMSk7XHJcbiAgICAgICAgICAgIEVYID0gKGludClNYXRoSGVscGVyLkNsYW1wKEVYLCAwLCBjb2x1bW5zIC0gMSk7XHJcbiAgICAgICAgICAgIEVZID0gKGludClNYXRoSGVscGVyLkNsYW1wKEVZLCAwLCByb3dzIC0gMSk7XHJcbiAgICAgICAgICAgIHZhciBYID0gU1g7XHJcbiAgICAgICAgICAgIHZhciBZID0gU1k7XHJcbiAgICAgICAgICAgIHZhciBUID0gbmV3IFRpbGVEYXRhKCk7XHJcbiAgICAgICAgICAgIFQubWFwID0gdGhpcztcclxuICAgICAgICAgICAgVC52aXNpYmxlID0gZmFsc2U7XHJcbiAgICAgICAgICAgIFQuc29saWQgPSBmYWxzZTtcclxuICAgICAgICAgICAgVC5lbmFibGVkID0gZmFsc2U7XHJcbiAgICAgICAgICAgIHdoaWxlIChZIDwgRVkpXHJcbiAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgIFggPSBTWDtcclxuICAgICAgICAgICAgICAgIHdoaWxlIChYIDwgRVgpXHJcbiAgICAgICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICAgICAgdmFyIFRUID0gVC5DbG9uZSgpO1xyXG4gICAgICAgICAgICAgICAgICAgIFRULmNvbHVtbiA9IFg7XHJcbiAgICAgICAgICAgICAgICAgICAgVFQucm93ID0gWTtcclxuICAgICAgICAgICAgICAgICAgICBkYXRhW1gsIFldID0gVFQ7XHJcbiAgICAgICAgICAgICAgICAgICAgWCsrO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgWSsrO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHB1YmxpYyB2b2lkIENsZWFyUmVjdChSZWN0YW5nbGUgcmVjdClcclxuICAgICAgICB7XHJcbiAgICAgICAgICAgIHZhciBTWCA9IChpbnQpKHJlY3QubGVmdCAvIHRpbGVzaXplKTtcclxuICAgICAgICAgICAgdmFyIFNZID0gKGludCkocmVjdC50b3AgLyB0aWxlc2l6ZSk7XHJcbiAgICAgICAgICAgIHZhciBFWCA9IChpbnQpKHJlY3QucmlnaHQgLyB0aWxlc2l6ZSk7XHJcbiAgICAgICAgICAgIHZhciBFWSA9IChpbnQpKHJlY3QuaGVpZ2h0IC8gdGlsZXNpemUpO1xyXG4gICAgICAgICAgICB2YXIgWCA9IFNYO1xyXG4gICAgICAgICAgICB2YXIgWSA9IFNZO1xyXG4gICAgICAgICAgICB2YXIgVCA9IG5ldyBUaWxlRGF0YSgpO1xyXG4gICAgICAgICAgICBULm1hcCA9IHRoaXM7XHJcbiAgICAgICAgICAgIFQudmlzaWJsZSA9IGZhbHNlO1xyXG4gICAgICAgICAgICBULnNvbGlkID0gZmFsc2U7XHJcbiAgICAgICAgICAgIHdoaWxlIChZIDwgRVkpXHJcbiAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgIFggPSBTWDtcclxuICAgICAgICAgICAgICAgIHdoaWxlIChYIDwgRVgpXHJcbiAgICAgICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICAgICAgdmFyIFRUID0gVC5DbG9uZSgpO1xyXG4gICAgICAgICAgICAgICAgICAgIFRULmNvbHVtbiA9IFg7XHJcbiAgICAgICAgICAgICAgICAgICAgVFQucm93ID0gWTtcclxuICAgICAgICAgICAgICAgICAgICBkYXRhW1gsIFldID0gVFQ7XHJcbiAgICAgICAgICAgICAgICAgICAgWCsrO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgWSsrO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHB1YmxpYyB2b2lkIFNldFRpbGUoaW50IGNvbHVtbiwgaW50IHJvdywgVGlsZURhdGEgVClcclxuICAgICAgICB7XHJcbiAgICAgICAgICAgIGlmIChjb2x1bW4gPj0gMCAmJiByb3cgPj0gMCAmJiBjb2x1bW4gPCBkYXRhLkdldExlbmd0aCgwKSAmJiByb3cgPCBkYXRhLkdldExlbmd0aCgxKSlcclxuICAgICAgICAgICAgICAgIGRhdGFbY29sdW1uLCByb3ddID0gVDtcclxuICAgICAgICB9XHJcbiAgICAgICAgcHJvdGVjdGVkIGludCBibHVyKGludFtdIGFycmF5LCBpbnQgaW5kZXgsIGludCBibHVyID0gMSlcclxuICAgICAgICB7XHJcbiAgICAgICAgICAgIGludCB0b3RhbCA9IDA7XHJcbiAgICAgICAgICAgIGludCByZXQgPSAwO1xyXG4gICAgICAgICAgICBpbnQgaSA9IDA7XHJcbiAgICAgICAgICAgIGludCBpbmQgPSBpbmRleDtcclxuICAgICAgICAgICAgaWYgKGluZCA+PSAwICYmIGluZCA8IGFycmF5Lkxlbmd0aClcclxuICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgdG90YWwrKztcclxuICAgICAgICAgICAgICAgIHJldCArPSBhcnJheVtpbmRdO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIHdoaWxlIChpIDwgYmx1cilcclxuICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgaW5kLS07XHJcbiAgICAgICAgICAgICAgICBpZiAoaW5kID49IDAgJiYgaW5kIDwgYXJyYXkuTGVuZ3RoKVxyXG4gICAgICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgICAgIHRvdGFsKys7XHJcbiAgICAgICAgICAgICAgICAgICAgcmV0ICs9IGFycmF5W2luZF07XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICBpKys7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgaSA9IDA7XHJcbiAgICAgICAgICAgIHdoaWxlIChpIDwgYmx1cilcclxuICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgaW5kKys7XHJcbiAgICAgICAgICAgICAgICBpZiAoaW5kID49IDAgJiYgaW5kIDwgYXJyYXkuTGVuZ3RoKVxyXG4gICAgICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgICAgIHRvdGFsKys7XHJcbiAgICAgICAgICAgICAgICAgICAgcmV0ICs9IGFycmF5W2luZF07XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICBpKys7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgcmV0dXJuIHJldCAvIHRvdGFsO1xyXG4gICAgICAgIH1cclxuICAgICAgICBwdWJsaWMgVGlsZURhdGEgQ2hlY2tGb3JUaWxlKFZlY3RvcjIgcG9zaXRpb24pXHJcbiAgICAgICAge1xyXG4gICAgICAgICAgICAvKnBvc2l0aW9uID0gcG9zaXRpb24gLSB0aGlzLnBvc2l0aW9uO1xyXG4gICAgICAgICAgICBwb3NpdGlvbiAvPSB0aWxlc2l6ZTtcclxuICAgICAgICAgICAgaWYgKHBvc2l0aW9uLlg+PTAgJiYgcG9zaXRpb24uWDxjb2x1bW5zICYmIHBvc2l0aW9uLlk+PTAgJiYgcG9zaXRpb24uWTxyb3dzKVxyXG4gICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gZGF0YVsoaW50KXBvc2l0aW9uLlgsIChpbnQpcG9zaXRpb24uWV07XHJcbiAgICAgICAgICAgIH0qL1xyXG4gICAgICAgICAgICB2YXIgVFAgPSB0aGlzLnBvc2l0aW9uO1xyXG4gICAgICAgICAgICB2YXIgUFggPSAoaW50KSgocG9zaXRpb24uWCAtIFRQLlgpIC8gdGlsZXNpemUpO1xyXG4gICAgICAgICAgICB2YXIgUFkgPSAoaW50KSgocG9zaXRpb24uWSAtIFRQLlkpIC8gdGlsZXNpemUpO1xyXG4gICAgICAgICAgICBpZiAoUFggPj0gMCAmJiBQWCA8IGNvbHVtbnMgJiYgUFkgPj0gMCAmJiBQWSA8IHJvd3MpXHJcbiAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgIHJldHVybiBkYXRhW1BYLCBQWV07XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgcmV0dXJuIG51bGw7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHB1YmxpYyBUaWxlRGF0YSBHZXRUaWxlKGludCBjb2x1bW4sIGludCByb3cpXHJcbiAgICAgICAge1xyXG4gICAgICAgICAgICBpZiAoY29sdW1uID49IDAgJiYgcm93ID49IDAgJiYgY29sdW1uIDwgY29sdW1ucyAmJiByb3cgPCByb3dzKVxyXG4gICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gZGF0YVtjb2x1bW4sIHJvd107XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgcmV0dXJuIG51bGw7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHByb3RlY3RlZCB2b2lkIF9EcmF3KClcclxuICAgICAgICB7XHJcbiAgICAgICAgICAgIGlmIChuZWVkUmVkcmF3LyogJiYgIUFuaW1hdGlvbkxvYWRlci5fdGhpcy5Jc0xvYWRpbmcoXCJUaWxlXCIpKi8pXHJcbiAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgIGludCBXID0gKGludClNYXRoLkNlaWxpbmcoY29sdW1ucyAqIHRpbGVzaXplKTtcclxuICAgICAgICAgICAgICAgIGludCBIID0gKGludClNYXRoLkNlaWxpbmcocm93cyAqIHRpbGVzaXplKTtcclxuXHJcbiAgICAgICAgICAgICAgICBpZiAoYnVmZmVyLldpZHRoICE9IFcgfHwgYnVmZmVyLkhlaWdodCAhPSBIKVxyXG4gICAgICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgICAgIGJ1ZmZlci5XaWR0aCA9IFc7XHJcbiAgICAgICAgICAgICAgICAgICAgYnVmZmVyLkhlaWdodCA9IEg7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICBlbHNlXHJcbiAgICAgICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICAgICAgYmcuQ2xlYXJSZWN0KDAsIDAsIGJ1ZmZlci5XaWR0aCwgYnVmZmVyLkhlaWdodCk7XHJcbiAgICAgICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICAgICAgUmVkcmF3KGJnKTtcclxuICAgICAgICAgICAgICAgIG5lZWRSZWRyYXcgPSBmYWxzZTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuICAgICAgICBwcml2YXRlIFJlY3RhbmdsZSBydG1wID0gbmV3IFJlY3RhbmdsZSgpO1xyXG4gICAgICAgIHB1YmxpYyB2b2lkIERyYXcoQ2FudmFzUmVuZGVyaW5nQ29udGV4dDJEIGcpXHJcbiAgICAgICAge1xyXG4gICAgICAgICAgICBfRHJhdygpO1xyXG4gICAgICAgICAgICAvL2cuRHJhd0ltYWdlKGJ1ZmZlciwgcG9zaXRpb24uWCwgcG9zaXRpb24uWSk7XHJcbiAgICAgICAgICAgIHJ0bXAuQ29weUZyb20oZ2FtZS5jYW1lcmEuQ2FtZXJhQm91bmRzKTtcclxuICAgICAgICAgICAgLy9oaWRlIGZsb2F0aW5nIHBvaW50IHNlYW1zLlxyXG4gICAgICAgICAgICBydG1wLnggLT0gMTtcclxuICAgICAgICAgICAgcnRtcC55IC09IDE7XHJcbiAgICAgICAgICAgIHJ0bXAud2lkdGggKz0gMjtcclxuICAgICAgICAgICAgcnRtcC5oZWlnaHQgKz0gMjtcclxuICAgICAgICAgICAgdmFyIENCID0gcnRtcDtcclxuICAgICAgICAgICAgLy92YXIgQ0IgPSBnYW1lLmNhbWVyYS5DYW1lcmFCb3VuZHM7XHJcbiAgICAgICAgICAgIC8vZy5EcmF3SW1hZ2UoYnVmZmVyLCBDQi5sZWZ0LXBvc2l0aW9uLlgsIENCLnRvcC1wb3NpdGlvbi5ZLCBDQi53aWR0aCwgQ0IuaGVpZ2h0LCBDQi5sZWZ0LCBDQi50b3AsIENCLndpZHRoLCBDQi5oZWlnaHQpOy8vZHJhdyBtYXAgY3JvcHBlZCB0byBjYW1lcmEgYm91bmRzXHJcbiAgICAgICAgICAgIGcuRHJhd0ltYWdlKGJ1ZmZlciwgQ0IubGVmdCAtIHBvc2l0aW9uLlgsIENCLnRvcCAtIHBvc2l0aW9uLlksIENCLndpZHRoLCBDQi5oZWlnaHQsIENCLmxlZnQsIENCLnRvcCwgQ0Iud2lkdGgsIENCLmhlaWdodCk7Ly9kcmF3IG1hcCBjcm9wcGVkIHRvIGNhbWVyYSBib3VuZHNcclxuICAgICAgICB9XHJcbiAgICAgICAgcHVibGljIHZvaWQgUmVkcmF3VGlsZShpbnQgWCwgaW50IFksIGJvb2wgdXBkYXRlTmVpZ2hib3JzID0gdHJ1ZSlcclxuICAgICAgICB7XHJcbiAgICAgICAgICAgIGlmICh1cGRhdGVOZWlnaGJvcnMpXHJcbiAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgIGludCBUWCA9IChYIC0gMSkgKiAoaW50KXRpbGVzaXplO1xyXG4gICAgICAgICAgICAgICAgaW50IFRZID0gKFkgLSAxKSAqIChpbnQpdGlsZXNpemU7XHJcbiAgICAgICAgICAgICAgICBiZy5DbGVhclJlY3QoVFgsIFRZLCAoaW50KXRpbGVzaXplICogMywgKGludCl0aWxlc2l6ZSAqIDMpO1xyXG5cclxuICAgICAgICAgICAgICAgIFJlZHJhdyhiZywgWCAtIDEsIFkgLSAxLCAzLCAzKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBlbHNlXHJcbiAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgIGludCBUWCA9IChYKSAqIChpbnQpdGlsZXNpemU7XHJcbiAgICAgICAgICAgICAgICBpbnQgVFkgPSAoWSkgKiAoaW50KXRpbGVzaXplO1xyXG4gICAgICAgICAgICAgICAgYmcuQ2xlYXJSZWN0KFRYLCBUWSwgKGludCl0aWxlc2l6ZSwgKGludCl0aWxlc2l6ZSk7XHJcblxyXG4gICAgICAgICAgICAgICAgUmVkcmF3KGJnLCBYLCBZLCAxLCAxKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgcHVibGljIHZvaWQgUmVkcmF3KENhbnZhc1JlbmRlcmluZ0NvbnRleHQyRCBnLCBpbnQgU1ggPSAtMSwgaW50IFNZID0gLTEsIGludCBXID0gLTEsIGludCBIID0gLTEpXHJcbiAgICAgICAge1xyXG4gICAgICAgICAgICBmbG9hdCBQWCA9IHBvc2l0aW9uLlg7XHJcbiAgICAgICAgICAgIGZsb2F0IFBZID0gcG9zaXRpb24uWTtcclxuICAgICAgICAgICAgUFggPSAwO1xyXG4gICAgICAgICAgICBQWSA9IDA7XHJcbiAgICAgICAgICAgIGlmIChTWCA9PSAtMSlcclxuICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgU1ggPSAwO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIGlmIChTWSA9PSAtMSlcclxuICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgU1kgPSAwO1xyXG4gICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICBpZiAoVyA9PSAtMSlcclxuICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgVyA9IGNvbHVtbnM7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgaWYgKEggPT0gLTEpXHJcbiAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgIEggPSByb3dzO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIHZhciBFWCA9IFNYICsgVztcclxuICAgICAgICAgICAgdmFyIEVZID0gU1kgKyBIO1xyXG4gICAgICAgICAgICBTWCA9IChpbnQpTWF0aEhlbHBlci5DbGFtcChTWCwgMCwgY29sdW1ucyk7XHJcbiAgICAgICAgICAgIFNZID0gKGludClNYXRoSGVscGVyLkNsYW1wKFNZLCAwLCByb3dzKTtcclxuXHJcbiAgICAgICAgICAgIEVYID0gKGludClNYXRoSGVscGVyLkNsYW1wKEVYLCAwLCBjb2x1bW5zKTtcclxuICAgICAgICAgICAgRVkgPSAoaW50KU1hdGhIZWxwZXIuQ2xhbXAoRVksIDAsIHJvd3MpO1xyXG5cclxuICAgICAgICAgICAgZmxvYXQgWCA9IFBYICsgKFNYICogdGlsZXNpemUpO1xyXG4gICAgICAgICAgICBmbG9hdCBZID0gUFkgKyAoU1kgKiB0aWxlc2l6ZSk7XHJcbiAgICAgICAgICAgIGludCByb3cgPSBTWTtcclxuICAgICAgICAgICAgaW50IGNvbHVtbiA9IFNYO1xyXG4gICAgICAgICAgICB2YXIgQkcgPSB0aWxlc1syXTtcclxuICAgICAgICAgICAgLy92YXIgQkcyID0gdGlsZXNbM107XHJcbiAgICAgICAgICAgIHZhciBCRzIgPSBuZXcgSFRNTEltYWdlRWxlbWVudFtdIHsgdGlsZXNbM10sIHRpbGVzWzldLCB0aWxlc1sxMF0gfTtcclxuICAgICAgICAgICAgdmFyIHRpbGVzQyA9IHRpbGVzLkNvdW50O1xyXG5cclxuICAgICAgICAgICAgUmVjdGFuZ2xlIFIgPSBuZXcgUmVjdGFuZ2xlKCk7XHJcbiAgICAgICAgICAgIHZhciBkb29ycm9vbSA9IE1hcEdlbmVyYXRvci5kb29ycm9vbTtcclxuICAgICAgICAgICAgdmFyIGtleXJvb20gPSBNYXBHZW5lcmF0b3Iua2V5cm9vbTtcclxuICAgICAgICAgICAgdmFyIGRvb3Jyb29tY29sb3IgPSBcIiMwMDAwMDBcIjtcclxuICAgICAgICAgICAgLy92YXIga2V5cm9vbWNvbG9yID0gXCIjQ0MwMDAwXCI7XHJcbiAgICAgICAgICAgIC8vdmFyIGtleXJvb21jb2xvciA9IFwiIzExODgyMlwiO1xyXG4gICAgICAgICAgICB2YXIga2V5cm9vbWNvbG9yID0gXCIjNTU4ODIyXCI7XHJcblxyXG4gICAgICAgICAgICB2YXIgZ3JhZGNvbG9yID0gXCIjMDAwMDc3XCI7XHJcbiAgICAgICAgICAgIC8vL3ZhciBBZ3JhZGNvbG9yID0gXCIjMTE4ODIyXCI7XHJcbiAgICAgICAgICAgIHZhciBBZ3JhZGNvbG9yID0gXCIjQ0MwMDAwXCI7XHJcblxyXG4gICAgICAgICAgICB2YXIgRFggPSAwO1xyXG4gICAgICAgICAgICB2YXIgRFkgPSAwO1xyXG5cclxuICAgICAgICAgICAgaWYgKGRvb3Jyb29tICE9IG51bGwpXHJcbiAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgIERYID0gKGRvb3Jyb29tLlNYICsgZG9vcnJvb20uRVgpIC8gMjtcclxuICAgICAgICAgICAgICAgIERZID0gKGRvb3Jyb29tLlNZICsgZG9vcnJvb20uRVkpIC8gMjtcclxuICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgd2hpbGUgKHJvdyA8IEVZKVxyXG4gICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICB3aGlsZSAoY29sdW1uIDwgRVgpXHJcbiAgICAgICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICAgICAgLy9pZiAoUi5pc1RvdWNoaW5nKG5ldyBSZWN0YW5nbGUoWCwgWSwgdGlsZXNpemUsIHRpbGVzaXplKSkpXHJcbiAgICAgICAgICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBUaWxlRGF0YSBUID0gZGF0YVtjb2x1bW4sIHJvd107XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHZhciB0ZXggPSBNYXRoLk1pbih0aWxlcy5Db3VudCAtIDEsIFQudGV4dHVyZSk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChULmVuYWJsZWQgJiYgdGV4ID49IDAgJiYgdGV4IDwgdGlsZXNDKVxyXG4gICAgICAgICAgICAgICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBnLkRyYXdJbWFnZSh0aWxlc1t0ZXhdLCBYLCBZKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChULkJyZWFrYWJsZSAmJiBULkhQIDwgVC5tYXhIUClcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpbnQgZG1nID0gKGludClNYXRoLk1heCgxLCBNYXRoLk1pbihNYXRoLlJvdW5kKFQubWF4SFAgLSBULkhQKSwgMykpIC0gMTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBnLkRyYXdJbWFnZShjcmFja3NbZG1nXSwgWCwgWSk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpbnQgc2QgPSBULlNsb3BlRGlyZWN0aW9uO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHNkICE9IDApXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLy9vYmplY3Qgc2cgPSBnO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vU2NyaXB0LldyaXRlKFwic2cuZ2xvYmFsQ29tcG9zaXRlT3BlcmF0aW9uID0gJ2Rlc3RpbmF0aW9uLW91dCdcIik7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZy5HbG9iYWxDb21wb3NpdGVPcGVyYXRpb24gPSBDYW52YXNUeXBlcy5DYW52YXNDb21wb3NpdGVPcGVyYXRpb25UeXBlLkRlc3RpbmF0aW9uT3V0O1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIFQuR2V0SGl0Ym94MihSKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBSLnggLT0gcG9zaXRpb24uWDtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBSLnkgLT0gcG9zaXRpb24uWTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBnLkJlZ2luUGF0aCgpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGcuTW92ZVRvKFIubGVmdCwgUi50b3ApO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIFZlY3RvcjIgUDtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBQID0gbmV3IFZlY3RvcjIoUi5sZWZ0ICsgKFIud2lkdGggLyAyZiksIFIudG9wICsgKFIuaGVpZ2h0IC8gMmYpKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoc2QgPiAwKVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZy5MaW5lVG8oUi5sZWZ0LCBSLmJvdHRvbSk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVsc2VcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGcuTGluZVRvKFIucmlnaHQsIFIuYm90dG9tKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGcuTGluZVRvKFIucmlnaHQsIFIudG9wKTtcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZy5MaW5lVG8oUi5sZWZ0LCBSLnRvcCk7XHJcblxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGcuRmlsbCgpO1xyXG5cclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBnLkdsb2JhbENvbXBvc2l0ZU9wZXJhdGlvbiA9IENhbnZhc1R5cGVzLkNhbnZhc0NvbXBvc2l0ZU9wZXJhdGlvblR5cGUuRGVzdGluYXRpb25PdmVyO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8qaWYgKGRvb3Jyb29tIT1udWxsICYmIGRvb3Jyb29tLkNvbnRhaW5zVGlsZShjb2x1bW4sIHJvdykpXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBnLkdsb2JhbEFscGhhID0gMC41NWY7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGcuRmlsbFN0eWxlID0gZG9vcnJvb21jb2xvcjtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLy9nLkZpbGxSZWN0KFIueC5Ub0R5bmFtaWMoKSwgUi55LlRvRHluYW1pYygpLCBSLndpZHRoLlRvRHluYW1pYygpLCBSLmhlaWdodC5Ub0R5bmFtaWMoKSk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGcuRmlsbFJlY3QoWC5Ub0R5bmFtaWMoKSwgWS5Ub0R5bmFtaWMoKSwgdGlsZXNpemUuVG9EeW5hbWljKCksIHRpbGVzaXplLlRvRHluYW1pYygpKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZy5HbG9iYWxBbHBoYSA9IDFmO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBlbHNlICovaWYgKGtleXJvb20gIT0gbnVsbCAmJiBrZXlyb29tLkNvbnRhaW5zVGlsZShjb2x1bW4sIHJvdykpXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBnLkdsb2JhbEFscGhhID0gMC4xN2Y7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGcuRmlsbFN0eWxlID0ga2V5cm9vbWNvbG9yO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAvL2cuRmlsbFJlY3QoUi54LlRvRHluYW1pYygpLCBSLnkuVG9EeW5hbWljKCksIFIud2lkdGguVG9EeW5hbWljKCksIFIuaGVpZ2h0LlRvRHluYW1pYygpKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZy5GaWxsUmVjdChYLlRvRHluYW1pYygpLCBZLlRvRHluYW1pYygpLCB0aWxlc2l6ZS5Ub0R5bmFtaWMoKSwgdGlsZXNpemUuVG9EeW5hbWljKCkpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBnLkdsb2JhbEFscGhhID0gMWY7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVsc2UgaWYgKGRvb3Jyb29tIT1udWxsKVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFyIERpc3QgPSBNYXRoLk1heChNYXRoLkFicyhjb2x1bW4gLSBEWCkgKyBNYXRoLkFicyhyb3cgLSBEWSkgLSA1LCAwKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFyIEEgPSAwLjVmIC0gKERpc3QgKiAwLjAzZik7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhciBHID0gZ3JhZGNvbG9yO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoQSA8IDApXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vQSA9IE1hdGguTWluKCgtQSAqIDAuNTBmKSAtIDAuMjJmLCAwLjMwZik7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBBID0gKC1BICogMC41MGYpIC0gMC4yMmY7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBHID0gQWdyYWRjb2xvcjtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChBID4gMC4zZilcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBBID0gMC42ZiAtIEE7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKEEgPCAwKVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLypBID0gLUE7Ki9cclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgRyA9IGdyYWRjb2xvcjtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgQSA9IDA7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoQSA+IDApXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGcuR2xvYmFsQWxwaGEgPSBBO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZy5GaWxsU3R5bGUgPSBHO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZy5GaWxsUmVjdChYLlRvRHluYW1pYygpLCBZLlRvRHluYW1pYygpLCB0aWxlc2l6ZS5Ub0R5bmFtaWMoKSwgdGlsZXNpemUuVG9EeW5hbWljKCkpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZy5HbG9iYWxBbHBoYSA9IDFmO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGcuRHJhd0ltYWdlKEJHLCBYLCBZKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBnLkdsb2JhbENvbXBvc2l0ZU9wZXJhdGlvbiA9IENhbnZhc1R5cGVzLkNhbnZhc0NvbXBvc2l0ZU9wZXJhdGlvblR5cGUuU291cmNlT3ZlcjtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVsc2UgaWYgKCFULm9wYXF1ZSlcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBnLkdsb2JhbENvbXBvc2l0ZU9wZXJhdGlvbiA9IENhbnZhc1R5cGVzLkNhbnZhc0NvbXBvc2l0ZU9wZXJhdGlvblR5cGUuRGVzdGluYXRpb25PdmVyO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8qaWYgKGRvb3Jyb29tIT1udWxsICYmIGRvb3Jyb29tLkNvbnRhaW5zVGlsZShjb2x1bW4sIHJvdykpXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBnLkdsb2JhbEFscGhhID0gMC41NWY7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGcuRmlsbFN0eWxlID0gZG9vcnJvb21jb2xvcjtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLy9nLkZpbGxSZWN0KFIueC5Ub0R5bmFtaWMoKSwgUi55LlRvRHluYW1pYygpLCBSLndpZHRoLlRvRHluYW1pYygpLCBSLmhlaWdodC5Ub0R5bmFtaWMoKSk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGcuRmlsbFJlY3QoWC5Ub0R5bmFtaWMoKSwgWS5Ub0R5bmFtaWMoKSwgdGlsZXNpemUuVG9EeW5hbWljKCksIHRpbGVzaXplLlRvRHluYW1pYygpKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZy5HbG9iYWxBbHBoYSA9IDFmO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBlbHNlICovXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGtleXJvb20gIT0gbnVsbCAmJiBrZXlyb29tLkNvbnRhaW5zVGlsZShjb2x1bW4sIHJvdykpXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBnLkdsb2JhbEFscGhhID0gMC4xN2Y7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGcuRmlsbFN0eWxlID0ga2V5cm9vbWNvbG9yO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAvL2cuRmlsbFJlY3QoUi54LlRvRHluYW1pYygpLCBSLnkuVG9EeW5hbWljKCksIFIud2lkdGguVG9EeW5hbWljKCksIFIuaGVpZ2h0LlRvRHluYW1pYygpKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZy5GaWxsUmVjdChYLlRvRHluYW1pYygpLCBZLlRvRHluYW1pYygpLCB0aWxlc2l6ZS5Ub0R5bmFtaWMoKSwgdGlsZXNpemUuVG9EeW5hbWljKCkpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBnLkdsb2JhbEFscGhhID0gMWY7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVsc2UgaWYgKGRvb3Jyb29tICE9IG51bGwpXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgRGlzdCA9IE1hdGguTWF4KE1hdGguQWJzKGNvbHVtbiAtIERYKSArIE1hdGguQWJzKHJvdyAtIERZKSAtIDUsIDApO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgQSA9IDAuNWYgLSAoRGlzdCAqIDAuMDNmKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFyIEcgPSBncmFkY29sb3I7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChBIDwgMClcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLy9BID0gTWF0aC5NaW4oKC1BICogMC41MGYpIC0gMC4yMmYsIDAuMzBmKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIEEgPSAoLUEgKiAwLjUwZikgLSAwLjIyZjtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIEcgPSBBZ3JhZGNvbG9yO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKEEgPiAwLjNmKVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIEEgPSAwLjZmIC0gQTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoQSA8IDApXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAvKkEgPSAtQTsqL1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBHID0gZ3JhZGNvbG9yO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBBID0gMDtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChBID4gMClcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZy5HbG9iYWxBbHBoYSA9IEE7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBnLkZpbGxTdHlsZSA9IEc7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBnLkZpbGxSZWN0KFguVG9EeW5hbWljKCksIFkuVG9EeW5hbWljKCksIHRpbGVzaXplLlRvRHluYW1pYygpLCB0aWxlc2l6ZS5Ub0R5bmFtaWMoKSk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBnLkdsb2JhbEFscGhhID0gMWY7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZy5EcmF3SW1hZ2UoQkcsIFgsIFkpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGcuR2xvYmFsQ29tcG9zaXRlT3BlcmF0aW9uID0gQ2FudmFzVHlwZXMuQ2FudmFzQ29tcG9zaXRlT3BlcmF0aW9uVHlwZS5Tb3VyY2VPdmVyO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgICAgICBlbHNlXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhciB0ZXh0dXJlID0gQkc7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAvL2lmIChNYXRoLlJhbmRvbSgpID49IDAuOTgpXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoTWF0aC5SYW5kb20oKSA+PSAwLjk3KVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRleHR1cmUgPSBDaXJub0dhbWUuSGVscGVyRXh0ZW5zaW9ucy5QaWNrPGdsb2JhbDo6QnJpZGdlLkh0bWw1LkhUTUxJbWFnZUVsZW1lbnQ+KEJHMik7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAvL2cuRHJhd0ltYWdlKE1hdGguUmFuZG9tKCkgPCAwLjk4ID8gQkcgOiBCRzIsIFgsIFkpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgZy5EcmF3SW1hZ2UodGV4dHVyZSwgWCwgWSk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAvKmlmIChkb29ycm9vbSAhPSBudWxsICYmIGRvb3Jyb29tLkNvbnRhaW5zVGlsZShjb2x1bW4sIHJvdykpXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZy5HbG9iYWxBbHBoYSA9IDAuNTVmO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGcuRmlsbFN0eWxlID0gZG9vcnJvb21jb2xvcjtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBnLkZpbGxSZWN0KFguVG9EeW5hbWljKCksIFkuVG9EeW5hbWljKCksIHRpbGVzaXplLlRvRHluYW1pYygpLCB0aWxlc2l6ZS5Ub0R5bmFtaWMoKSk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZy5HbG9iYWxBbHBoYSA9IDFmO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgZWxzZSAqL2lmIChrZXlyb29tICE9IG51bGwgJiYga2V5cm9vbS5Db250YWluc1RpbGUoY29sdW1uLCByb3cpKVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8qVC5HZXRIaXRib3gyKFIpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIFIueCAtPSBwb3NpdGlvbi5YO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIFIueSAtPSBwb3NpdGlvbi5ZOyovXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZy5HbG9iYWxBbHBoYSA9IDAuMTdmO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGcuRmlsbFN0eWxlID0ga2V5cm9vbWNvbG9yO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGcuRmlsbFJlY3QoWC5Ub0R5bmFtaWMoKSwgWS5Ub0R5bmFtaWMoKSwgdGlsZXNpemUuVG9EeW5hbWljKCksIHRpbGVzaXplLlRvRHluYW1pYygpKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBnLkdsb2JhbEFscGhhID0gMWY7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBlbHNlIGlmIChkb29ycm9vbSAhPSBudWxsKVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhciBEaXN0ID0gTWF0aC5NYXgoTWF0aC5BYnMoY29sdW1uIC0gRFgpICsgTWF0aC5BYnMocm93IC0gRFkpLTUsMCk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFyIEEgPSAwLjVmIC0gKERpc3QgKiAwLjAzZik7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFyIEcgPSBncmFkY29sb3I7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKEEgPCAwKVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLy9BID0gTWF0aC5NaW4oKC1BICogMC41MGYpIC0gMC4yMmYsIDAuMzBmKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgQSA9ICgtQSAqIDAuNTBmKSAtIDAuMjJmO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBHID0gQWdyYWRjb2xvcjtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKEEgPiAwLjNmKVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBBID0gMC42ZiAtIEE7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoQSA8IDApXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLypBID0gLUE7Ki9cclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBHID0gZ3JhZGNvbG9yO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIEEgPSAwO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoQSA+IDApXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBnLkdsb2JhbEFscGhhID0gQTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZy5GaWxsU3R5bGUgPSBHO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBnLkZpbGxSZWN0KFguVG9EeW5hbWljKCksIFkuVG9EeW5hbWljKCksIHRpbGVzaXplLlRvRHluYW1pYygpLCB0aWxlc2l6ZS5Ub0R5bmFtaWMoKSk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGcuR2xvYmFsQWxwaGEgPSAxZjtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgY29sdW1uKys7XHJcbiAgICAgICAgICAgICAgICAgICAgWCArPSB0aWxlc2l6ZTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIFggPSBQWCArIChTWCAqIHRpbGVzaXplKTtcclxuICAgICAgICAgICAgICAgIFkgKz0gdGlsZXNpemU7XHJcbiAgICAgICAgICAgICAgICBjb2x1bW4gPSBTWDtcclxuICAgICAgICAgICAgICAgIHJvdysrO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHB1YmxpYyBib29sIElzRXhwb3NlZChpbnQgWCwgaW50IFkpXHJcbiAgICAgICAge1xyXG4gICAgICAgICAgICBpbnQgcm93ID0gWSAtIDI7XHJcbiAgICAgICAgICAgIGludCBjb2x1bW4gPSBYIC0gMjtcclxuICAgICAgICAgICAgVGlsZURhdGFbXSBURFJhdyA9IGRhdGEuQXM8VGlsZURhdGFbXT4oKTtcclxuICAgICAgICAgICAgaW50IGluZCA9IDA7XHJcbiAgICAgICAgICAgIGludCBsaW5kID0gMDtcclxuXHJcbiAgICAgICAgICAgIGluZCA9IGNvbHVtbiAqIHJvd3M7XHJcbiAgICAgICAgICAgIGluZCArPSByb3c7XHJcblxyXG4gICAgICAgICAgICB3aGlsZSAocm93IDw9IFkgKyAyKVxyXG4gICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICBsaW5kID0gaW5kO1xyXG4gICAgICAgICAgICAgICAgd2hpbGUgKGNvbHVtbiA8PSBYICsgMilcclxuICAgICAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgICAgICAvKnZhciBUID0gZGF0YVtjb2x1bW4sIHJvd107XHJcbiAgICAgICAgICAgICAgICAgICAgVC50ZXh0dXJlID0gTWF0aC5SYW5kb20oKSA8IDAuNSA/IDAgOiAxOyovXHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKHJvdyA+PSAwICYmIGNvbHVtbiA+PSAwICYmIHJvdyA8IHJvd3MgJiYgY29sdW1uIDwgY29sdW1ucylcclxuICAgICAgICAgICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIC8vdmFyIFQgPSBkYXRhW2NvbHVtbiwgcm93XTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgdmFyIFQgPSBURFJhd1tpbmRdO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAoIVQuZW5hYmxlZCB8fCAhVC5zb2xpZClcclxuICAgICAgICAgICAgICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHRydWU7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgY29sdW1uKys7XHJcbiAgICAgICAgICAgICAgICAgICAgaW5kICs9IHJvd3M7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICBpbmQgPSBsaW5kO1xyXG4gICAgICAgICAgICAgICAgaW5kICs9IDE7XHJcbiAgICAgICAgICAgICAgICByb3crKztcclxuICAgICAgICAgICAgICAgIGNvbHVtbiA9IFggLSAyO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIHJldHVybiBmYWxzZTtcclxuICAgICAgICB9XHJcbiAgICAgICAgcHVibGljIHZvaWQgQXBwbHlCcmVha2FibGVSZWN0KGludCBTWCA9IC0xLCBpbnQgU1kgPSAtMSwgaW50IFcgPSAtMSwgaW50IEggPSAtMSlcclxuICAgICAgICB7XHJcbiAgICAgICAgICAgIGlmIChTWCA9PSAtMSlcclxuICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgU1ggPSAwO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIGlmIChTWSA9PSAtMSlcclxuICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgU1kgPSAwO1xyXG4gICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICBpZiAoVyA9PSAtMSlcclxuICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgVyA9IGNvbHVtbnM7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgaWYgKEggPT0gLTEpXHJcbiAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgIEggPSByb3dzO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIHZhciBFWCA9IFNYICsgVztcclxuICAgICAgICAgICAgdmFyIEVZID0gU1kgKyBIO1xyXG4gICAgICAgICAgICBTWCA9IChpbnQpTWF0aEhlbHBlci5DbGFtcChTWCwgMCwgY29sdW1ucyk7XHJcbiAgICAgICAgICAgIFNZID0gKGludClNYXRoSGVscGVyLkNsYW1wKFNZLCAwLCByb3dzKTtcclxuXHJcbiAgICAgICAgICAgIEVYID0gKGludClNYXRoSGVscGVyLkNsYW1wKEVYLCAwLCBjb2x1bW5zKTtcclxuICAgICAgICAgICAgRVkgPSAoaW50KU1hdGhIZWxwZXIuQ2xhbXAoRVksIDAsIHJvd3MpO1xyXG4gICAgICAgICAgICBpbnQgcm93ID0gU1g7XHJcbiAgICAgICAgICAgIGludCBjb2x1bW4gPSBTWTtcclxuXHJcbiAgICAgICAgICAgIHdoaWxlIChyb3cgPCBFWSlcclxuICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgd2hpbGUgKGNvbHVtbiA8IEVYKVxyXG4gICAgICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgICAgIC8qdmFyIFQgPSBkYXRhW2NvbHVtbiwgcm93XTtcclxuICAgICAgICAgICAgICAgICAgICBULnRleHR1cmUgPSBNYXRoLlJhbmRvbSgpIDwgMC41ID8gMCA6IDE7Ki9cclxuICAgICAgICAgICAgICAgICAgICB2YXIgVCA9IGRhdGFbY29sdW1uLCByb3ddO1xyXG4gICAgICAgICAgICAgICAgICAgIHZhciBUVCA9IFQuQ2xvbmUoKTtcclxuICAgICAgICAgICAgICAgICAgICBUVC5jb2x1bW4gPSBjb2x1bW47XHJcbiAgICAgICAgICAgICAgICAgICAgVFQucm93ID0gcm93O1xyXG4gICAgICAgICAgICAgICAgICAgIGRhdGFbY29sdW1uLCByb3ddID0gVFQ7XHJcbiAgICAgICAgICAgICAgICAgICAgVCA9IFRUO1xyXG4gICAgICAgICAgICAgICAgICAgIGlmIChJc0V4cG9zZWQoY29sdW1uLCByb3cpKVxyXG4gICAgICAgICAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgVC50ZXh0dXJlID0gMTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKE1hdGguUmFuZG9tKCkgPCAwLjAyKVxyXG4gICAgICAgICAgICAgICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBULnRleHR1cmUgPSBNYXRoLlJhbmRvbSgpIDwgMC41ID8gNSA6IDY7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICAgICAgVC5CcmVha2FibGUgPSB0cnVlO1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICBlbHNlXHJcbiAgICAgICAgICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBULnRleHR1cmUgPSAwO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBULkJyZWFrYWJsZSA9IGZhbHNlO1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICBjb2x1bW4rKztcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIHJvdysrO1xyXG4gICAgICAgICAgICAgICAgY29sdW1uID0gU1g7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgbmVlZFJlZHJhdyA9IHRydWU7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHB1YmxpYyB2b2lkIEFwcGx5QnJlYWthYmxlKClcclxuICAgICAgICB7XHJcbiAgICAgICAgICAgIGludCByb3cgPSAwO1xyXG4gICAgICAgICAgICBpbnQgY29sdW1uID0gMDtcclxuICAgICAgICAgICAgVGlsZURhdGFbXSBURFJhdyA9IGRhdGEuQXM8VGlsZURhdGFbXT4oKTtcclxuICAgICAgICAgICAgaW50IGluZCA9IDA7XHJcbiAgICAgICAgICAgIGludCBsaW5kID0gMDtcclxuXHJcbiAgICAgICAgICAgIHdoaWxlIChyb3cgPCByb3dzKVxyXG4gICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICBsaW5kID0gaW5kO1xyXG4gICAgICAgICAgICAgICAgd2hpbGUgKGNvbHVtbiA8IGNvbHVtbnMpXHJcbiAgICAgICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICAgICAgLyp2YXIgVCA9IGRhdGFbY29sdW1uLCByb3ddO1xyXG4gICAgICAgICAgICAgICAgICAgIFQudGV4dHVyZSA9IE1hdGguUmFuZG9tKCkgPCAwLjUgPyAwIDogMTsqL1xyXG5cclxuICAgICAgICAgICAgICAgICAgICB2YXIgVCA9IFREUmF3W2luZF07XHJcbiAgICAgICAgICAgICAgICAgICAgLy92YXIgVCA9IGRhdGFbY29sdW1uLCByb3ddO1xyXG4gICAgICAgICAgICAgICAgICAgIHZhciBUVCA9IFQuQ2xvbmUoKTtcclxuICAgICAgICAgICAgICAgICAgICBUVC5jb2x1bW4gPSBjb2x1bW47XHJcbiAgICAgICAgICAgICAgICAgICAgVFQucm93ID0gcm93O1xyXG4gICAgICAgICAgICAgICAgICAgIC8vZGF0YVtjb2x1bW4sIHJvd10gPSBUVDtcclxuICAgICAgICAgICAgICAgICAgICBURFJhd1tpbmRdID0gVFQ7XHJcbiAgICAgICAgICAgICAgICAgICAgVCA9IFRUO1xyXG4gICAgICAgICAgICAgICAgICAgIGlmIChJc0V4cG9zZWQoY29sdW1uLCByb3cpKVxyXG4gICAgICAgICAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgVC50ZXh0dXJlID0gMTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKE1hdGguUmFuZG9tKCkgPCAwLjAyKVxyXG4gICAgICAgICAgICAgICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBULnRleHR1cmUgPSBNYXRoLlJhbmRvbSgpIDwgMC41ID8gNSA6IDY7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICAgICAgVC5CcmVha2FibGUgPSB0cnVlO1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICBlbHNlXHJcbiAgICAgICAgICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBULnRleHR1cmUgPSAwO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBULkJyZWFrYWJsZSA9IGZhbHNlO1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICBjb2x1bW4rKztcclxuICAgICAgICAgICAgICAgICAgICBpbmQgKz0gcm93cztcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIGluZCA9IGxpbmQ7XHJcbiAgICAgICAgICAgICAgICByb3crKztcclxuICAgICAgICAgICAgICAgIC8vaW5kIC09IChjb2x1bW5zICogcm93cyk7XHJcbiAgICAgICAgICAgICAgICBjb2x1bW4gPSAwO1xyXG4gICAgICAgICAgICAgICAgXHJcbiAgICAgICAgICAgICAgICBpbmQgKz0gMTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBuZWVkUmVkcmF3ID0gdHJ1ZTtcclxuICAgICAgICB9XHJcbiAgICAgICAgcHVibGljIHZvaWQgdGVzdFRleHR1cmUoKVxyXG4gICAgICAgIHtcclxuICAgICAgICAgICAgaW50IHJvdyA9IDA7XHJcbiAgICAgICAgICAgIGludCBjb2x1bW4gPSAwO1xyXG5cclxuICAgICAgICAgICAgd2hpbGUgKHJvdyA8IHJvd3MpXHJcbiAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgIHdoaWxlIChjb2x1bW4gPCBjb2x1bW5zKVxyXG4gICAgICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgICAgIHZhciBUID0gZGF0YVtjb2x1bW4sIHJvd107XHJcbiAgICAgICAgICAgICAgICAgICAgVC50ZXh0dXJlID0gTWF0aC5SYW5kb20oKSA8IDAuNSA/IDAgOiAxO1xyXG4gICAgICAgICAgICAgICAgICAgIGNvbHVtbisrO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgcm93Kys7XHJcbiAgICAgICAgICAgICAgICBjb2x1bW4gPSAwO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIG5lZWRSZWRyYXcgPSB0cnVlO1xyXG4gICAgICAgIH1cclxuICAgIH1cclxufVxyXG4iLCJ1c2luZyBTeXN0ZW07XHJcbnVzaW5nIFN5c3RlbS5Db2xsZWN0aW9ucy5HZW5lcmljO1xyXG51c2luZyBTeXN0ZW0uTGlucTtcclxudXNpbmcgU3lzdGVtLlRleHQ7XHJcbnVzaW5nIFN5c3RlbS5UaHJlYWRpbmcuVGFza3M7XHJcblxyXG5uYW1lc3BhY2UgQ2lybm9HYW1lXHJcbntcclxuICAgIHB1YmxpYyBjbGFzcyBWZWN0b3IyXHJcbiAgICB7XHJcbiAgICAgICAgcHVibGljIGZsb2F0IFg7XHJcbiAgICAgICAgcHVibGljIGZsb2F0IFk7XHJcbiAgICAgICAgcHVibGljIGZsb2F0IExlbmd0aFxyXG4gICAgICAgIHtcclxuICAgICAgICAgICAgZ2V0XHJcbiAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgIHJldHVybiAoZmxvYXQpTWF0aC5TcXJ0KChYICogWCkgKyAoWSAqIFkpKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuICAgICAgICBwdWJsaWMgZmxvYXQgRGlzdGFuY2UoVmVjdG9yMiBQKVxyXG4gICAgICAgIHtcclxuICAgICAgICAgICAgdmFyIFhYID0gWCAtIFAuWDtcclxuICAgICAgICAgICAgdmFyIFlZID0gWSAtIFAuWTtcclxuICAgICAgICAgICAgcmV0dXJuIChmbG9hdClNYXRoLlNxcnQoKFhYICogWFgpICsgKFlZICogWVkpKTtcclxuICAgICAgICB9XHJcbiAgICAgICAgLy8vIDxzdW1tYXJ5PlxyXG4gICAgICAgIC8vLyBSZXR1cm5zIGEgcm91Z2ggZXN0aW1hdGUgb2YgdGhlIHZlY3RvcidzIGxlbmd0aC5cclxuICAgICAgICAvLy8gPC9zdW1tYXJ5PlxyXG4gICAgICAgIHB1YmxpYyBmbG9hdCBFc3RpbWF0ZWRMZW5ndGhcclxuICAgICAgICB7XHJcbiAgICAgICAgICAgIGdldFxyXG4gICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICB2YXIgQSA9IE1hdGguQWJzKFgpO1xyXG4gICAgICAgICAgICAgICAgdmFyIEIgPSBNYXRoLkFicyhZKTtcclxuICAgICAgICAgICAgICAgIGlmIChCID4gQSlcclxuICAgICAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgICAgICB2YXIgdG1wID0gQTtcclxuICAgICAgICAgICAgICAgICAgICBBID0gQjtcclxuICAgICAgICAgICAgICAgICAgICBCID0gdG1wO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgQiAqPSAwLjM0O1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuIChmbG9hdCkoQSArIEIpO1xyXG4gICAgICAgICAgICAgICAgLy9yZXR1cm4gKGZsb2F0KShNYXRoLkFicyhYKSArIE1hdGguQWJzKFkpKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuICAgICAgICAvLy8gPHN1bW1hcnk+XHJcbiAgICAgICAgLy8vIFJldHVybnMgYSByb3VnaCBlc3RpbWF0ZSBvZiB0aGUgdmVjdG9yJ3MgbGVuZ3RoLlxyXG4gICAgICAgIC8vLyA8L3N1bW1hcnk+XHJcbiAgICAgICAgcHVibGljIGZsb2F0IEVzdGltYXRlZERpc3RhbmNlKFZlY3RvcjIgUClcclxuICAgICAgICB7XHJcbiAgICAgICAgICAgIHZhciBBID0gTWF0aC5BYnMoWCAtIFAuWCk7XHJcbiAgICAgICAgICAgIHZhciBCID0gTWF0aC5BYnMoWSAtIFAuWSk7XHJcbiAgICAgICAgICAgIGlmIChCID4gQSlcclxuICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgdmFyIHRtcCA9IEE7XHJcbiAgICAgICAgICAgICAgICBBID0gQjtcclxuICAgICAgICAgICAgICAgIEIgPSB0bXA7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgQiAqPSAwLjM0O1xyXG4gICAgICAgICAgICByZXR1cm4gKGZsb2F0KShBICsgQik7XHJcbiAgICAgICAgICAgIC8vcmV0dXJuIChmbG9hdCkoTWF0aC5BYnMoWCkgKyBNYXRoLkFicyhZKSk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIC8vLyA8c3VtbWFyeT5cclxuICAgICAgICAvLy8gUmV0dXJucyB0aGUgc3VtIG9mIGl0cyBhYnNvbHV0ZSBwYXJ0cy5cclxuICAgICAgICAvLy8gPC9zdW1tYXJ5PlxyXG4gICAgICAgIHB1YmxpYyBmbG9hdCBSb3VnaExlbmd0aFxyXG4gICAgICAgIHtcclxuICAgICAgICAgICAgZ2V0XHJcbiAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgIHJldHVybiAoZmxvYXQpKE1hdGguQWJzKFgpICsgTWF0aC5BYnMoWSkpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHB1YmxpYyBWZWN0b3IyKGZsb2F0IHggPSAwLCBmbG9hdCB5ID0gMClcclxuICAgICAgICB7XHJcbiAgICAgICAgICAgIHRoaXMuWCA9IHg7XHJcbiAgICAgICAgICAgIHRoaXMuWSA9IHk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHB1YmxpYyB2b2lkIE11bHRpcGx5KGZsb2F0IGYpXHJcbiAgICAgICAge1xyXG4gICAgICAgICAgICBYICo9IGY7XHJcbiAgICAgICAgICAgIFkgKj0gZjtcclxuICAgICAgICB9XHJcbiAgICAgICAgcHVibGljIFZlY3RvcjIgUm91Z2hOb3JtYWxpemUoZmxvYXQgbGVuZ3RoID0gMSlcclxuICAgICAgICB7XHJcbiAgICAgICAgICAgIGZsb2F0IEQgPSBMZW5ndGggLyBsZW5ndGg7XHJcbiAgICAgICAgICAgIHJldHVybiBuZXcgVmVjdG9yMihYIC8gRCwgWSAvIEQpO1xyXG4gICAgICAgIH1cclxuICAgICAgICBwdWJsaWMgVmVjdG9yMiBOb3JtYWxpemUoZmxvYXQgbGVuZ3RoID0gMSlcclxuICAgICAgICB7XHJcbiAgICAgICAgICAgIGZsb2F0IGRpc3RhbmNlID0gTWF0aC5TcXJ0KFggKiBYICsgWSAqIFkpLkFzPGZsb2F0PigpO1xyXG4gICAgICAgICAgICBWZWN0b3IyIFYgPSBuZXcgVmVjdG9yMigpO1xyXG4gICAgICAgICAgICBWLlggPSBYIC8gZGlzdGFuY2U7XHJcbiAgICAgICAgICAgIFYuWSA9IFkgLyBkaXN0YW5jZTtcclxuICAgICAgICAgICAgVi5YICo9IGxlbmd0aDtcclxuICAgICAgICAgICAgVi5ZICo9IGxlbmd0aDtcclxuICAgICAgICAgICAgcmV0dXJuIFY7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHB1YmxpYyB2b2lkIFNldEFzTm9ybWFsaXplKGZsb2F0IGxlbmd0aCA9IDEpXHJcbiAgICAgICAge1xyXG4gICAgICAgICAgICBmbG9hdCBkaXN0YW5jZSA9IE1hdGguU3FydChYICogWCArIFkgKiBZKS5BczxmbG9hdD4oKTtcclxuICAgICAgICAgICAgWCA9IFggLyBkaXN0YW5jZTtcclxuICAgICAgICAgICAgWSA9IFkgLyBkaXN0YW5jZTtcclxuICAgICAgICAgICAgWCAqPSBsZW5ndGg7XHJcbiAgICAgICAgICAgIFkgKj0gbGVuZ3RoO1xyXG4gICAgICAgIH1cclxuICAgICAgICBwdWJsaWMgVmVjdG9yMiBUb0NhcmRpbmFsKClcclxuICAgICAgICB7XHJcbiAgICAgICAgICAgIHZhciB4ID0gWDtcclxuICAgICAgICAgICAgdmFyIHkgPSBZO1xyXG4gICAgICAgICAgICB2YXIgQSA9IE1hdGguQWJzKFgpO1xyXG4gICAgICAgICAgICB2YXIgQiA9IE1hdGguQWJzKFkpO1xyXG4gICAgICAgICAgICBpZiAoQiA+IEEpXHJcbiAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgIHggPSAwO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIGVsc2UgaWYgKEEgPiBCKVxyXG4gICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICB5ID0gMDtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICByZXR1cm4gbmV3IFZlY3RvcjIoeCwgeSk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHB1YmxpYyBib29sIEVxdWFscyhWZWN0b3IyIG8pXHJcbiAgICAgICAge1xyXG4gICAgICAgICAgICBWZWN0b3IyIEIgPSAoVmVjdG9yMilvO1xyXG4gICAgICAgICAgICBpZiAodGhpcyAhPSBCICYmIEIgPT0gbnVsbClcclxuICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIHJldHVybiBCLlggPT0gWCAmJiBCLlkgPT0gWTtcclxuICAgICAgICB9XHJcbiAgICAgICAgcHVibGljIG92ZXJyaWRlIGJvb2wgRXF1YWxzKG9iamVjdCBvKVxyXG4gICAgICAgIHtcclxuICAgICAgICAgICAgaWYgKG8gaXMgVmVjdG9yMilcclxuICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgVmVjdG9yMiBCID0gKFZlY3RvcjIpbztcclxuICAgICAgICAgICAgICAgIGlmICh0aGlzICE9IEIgJiYgQiA9PSBudWxsKVxyXG4gICAgICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIHJldHVybiBCLlggPT0gWCAmJiBCLlkgPT0gWTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICByZXR1cm4gYmFzZS5FcXVhbHMobyk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHB1YmxpYyBzdGF0aWMgYm9vbCBvcGVyYXRvciA9PShWZWN0b3IyIEEsIFZlY3RvcjIgQilcclxuICAgICAgICB7XHJcbiAgICAgICAgICAgIG9iamVjdCBPQSA9IEE7XHJcbiAgICAgICAgICAgIG9iamVjdCBPQiA9IEI7XHJcbiAgICAgICAgICAgIGlmICgoT0EgPT0gbnVsbCB8fCBPQiA9PSBudWxsKSAmJiAoT0EgIT0gbnVsbCB8fCBPQiAhPSBudWxsKSlcclxuICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIGlmIChPQSA9PSBudWxsICYmIE9CID09IG51bGwpXHJcbiAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgIHJldHVybiB0cnVlO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIHJldHVybiBBLlggPT0gQi5YICYmIEEuWSA9PSBCLlk7XHJcbiAgICAgICAgICAgIC8vcmV0dXJuIGZhbHNlO1xyXG4gICAgICAgICAgICBpZiAoKChPYmplY3QpQSkgIT0gKChPYmplY3QpQikgJiYgKEEgPT0gbnVsbCB8fCBCID09IG51bGwpKVxyXG4gICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgcmV0dXJuIChBLlggPT0gQi5YICYmIEEuWSA9PSBCLlkpO1xyXG4gICAgICAgICAgICByZXR1cm4gKCgoT2JqZWN0KUEpICE9ICgoT2JqZWN0KUIpKSB8fCAoQS5YID09IEIuWCAmJiBBLlkgPT0gQi5ZKTtcclxuICAgICAgICB9XHJcbiAgICAgICAgcHVibGljIHN0YXRpYyBib29sIG9wZXJhdG9yICE9KFZlY3RvcjIgQSwgVmVjdG9yMiBCKVxyXG4gICAgICAgIHtcclxuICAgICAgICAgICAgcmV0dXJuICEoQSA9PSBCKTtcclxuICAgICAgICAgICAgaWYgKCgoT2JqZWN0KUEpICE9ICgoT2JqZWN0KUIpICYmIChBID09IG51bGwgfHwgQiA9PSBudWxsKSlcclxuICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuIHRydWU7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgcmV0dXJuICEoQS5YID09IEIuWCAmJiBBLlkgPT0gQi5ZKTtcclxuICAgICAgICAgICAgcmV0dXJuICEoKCgoT2JqZWN0KUEpICE9ICgoT2JqZWN0KUIpKSB8fCAoQS5YID09IEIuWCAmJiBBLlkgPT0gQi5ZKSk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHB1YmxpYyBzdGF0aWMgVmVjdG9yMiBvcGVyYXRvciAqKFZlY3RvcjIgQSwgZmxvYXQgc2NhbGUpXHJcbiAgICAgICAge1xyXG4gICAgICAgICAgICByZXR1cm4gbmV3IFZlY3RvcjIoQS5YICogc2NhbGUsIEEuWSAqIHNjYWxlKTtcclxuICAgICAgICB9XHJcbiAgICAgICAgcHVibGljIHN0YXRpYyBWZWN0b3IyIG9wZXJhdG9yIC8oVmVjdG9yMiBBLCBmbG9hdCBzY2FsZSlcclxuICAgICAgICB7XHJcbiAgICAgICAgICAgIHJldHVybiBuZXcgVmVjdG9yMihBLlggLyBzY2FsZSwgQS5ZIC8gc2NhbGUpO1xyXG4gICAgICAgIH1cclxuICAgICAgICBwdWJsaWMgc3RhdGljIFZlY3RvcjIgb3BlcmF0b3IgKyhWZWN0b3IyIEEsIFZlY3RvcjIgQilcclxuICAgICAgICB7XHJcbiAgICAgICAgICAgIHJldHVybiBuZXcgVmVjdG9yMihBLlggKyBCLlgsIEEuWSArIEIuWSk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHB1YmxpYyBzdGF0aWMgVmVjdG9yMiBvcGVyYXRvciAtKFZlY3RvcjIgQSwgVmVjdG9yMiBCKVxyXG4gICAgICAgIHtcclxuICAgICAgICAgICAgcmV0dXJuIG5ldyBWZWN0b3IyKEEuWCAtIEIuWCwgQS5ZIC0gQi5ZKTtcclxuICAgICAgICB9XHJcbiAgICAgICAgcHVibGljIHN0YXRpYyBWZWN0b3IyIEVtcHR5XHJcbiAgICAgICAge1xyXG4gICAgICAgICAgICBnZXRcclxuICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuIG5ldyBWZWN0b3IyKCk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcbiAgICAgICAgcHVibGljIGZsb2F0IFRvQW5nbGUoKVxyXG4gICAgICAgIHtcclxuICAgICAgICAgICAgcmV0dXJuIE1hdGhIZWxwZXIuV3JhcFJhZGlhbnMoTWF0aEhlbHBlci5HZXRBbmdsZSh0aGlzKSk7XHJcbiAgICAgICAgICAgIC8vcmV0dXJuIE1hdGhIZWxwZXIuV3JhcFJhZGlhbnMoTWF0aEhlbHBlci5HZXRBbmdsZShuZXcgVmVjdG9yMigpLCB0aGlzKSk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHB1YmxpYyBzdGF0aWMgVmVjdG9yMiBGcm9tUmFkaWFuKGZsb2F0IHJhZGlhbilcclxuICAgICAgICB7XHJcbiAgICAgICAgICAgIHJldHVybiBNYXRoSGVscGVyLlJhZGlhblRvVmVjdG9yKHJhZGlhbik7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHB1YmxpYyBWZWN0b3IyIENsb25lKClcclxuICAgICAgICB7XHJcbiAgICAgICAgICAgIHJldHVybiBuZXcgVmVjdG9yMihYLCBZKTtcclxuICAgICAgICB9XHJcbiAgICAgICAgcHVibGljIHZvaWQgQ29weUZyb20oVmVjdG9yMiBWKVxyXG4gICAgICAgIHtcclxuICAgICAgICAgICAgaWYgKFYgPT0gbnVsbClcclxuICAgICAgICAgICAgICAgIHJldHVybjtcclxuICAgICAgICAgICAgWCA9IFYuWDtcclxuICAgICAgICAgICAgWSA9IFYuWTtcclxuICAgICAgICB9XHJcbiAgICAgICAgcHVibGljIFZlY3RvcjIgUm90YXRlKGZsb2F0IHJhZGlhbilcclxuICAgICAgICB7XHJcbiAgICAgICAgICAgIGZsb2F0IGFuZ2xlID0gVG9BbmdsZSgpICsgcmFkaWFuO1xyXG4gICAgICAgICAgICByZXR1cm4gRnJvbVJhZGlhbihhbmdsZSkuTm9ybWFsaXplKExlbmd0aCk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHB1YmxpYyBzdGF0aWMgVmVjdG9yMiBBZGQoVmVjdG9yMiBBLCBWZWN0b3IyIEIpXHJcbiAgICAgICAge1xyXG4gICAgICAgICAgICByZXR1cm4gbmV3IFZlY3RvcjIoQS5YICsgQi5YLCBBLlkgKyBCLlkpO1xyXG4gICAgICAgIH1cclxuICAgICAgICBwdWJsaWMgc3RhdGljIFZlY3RvcjIgQWRkKFZlY3RvcjIgQSwgZmxvYXQgWCwgZmxvYXQgWSlcclxuICAgICAgICB7XHJcbiAgICAgICAgICAgIHJldHVybiBuZXcgVmVjdG9yMihBLlggKyBYLCBBLlkgKyBZKTtcclxuICAgICAgICB9XHJcbiAgICAgICAgcHVibGljIHN0YXRpYyBWZWN0b3IyIFN1YnRyYWN0KFZlY3RvcjIgQSwgVmVjdG9yMiBCKVxyXG4gICAgICAgIHtcclxuICAgICAgICAgICAgcmV0dXJuIG5ldyBWZWN0b3IyKEEuWCAtIEIuWCwgQS5ZIC0gQi5ZKTtcclxuICAgICAgICB9XHJcbiAgICAgICAgcHVibGljIHN0YXRpYyBWZWN0b3IyIFN1YnRyYWN0KFZlY3RvcjIgQSwgZmxvYXQgWCwgZmxvYXQgWSlcclxuICAgICAgICB7XHJcbiAgICAgICAgICAgIHJldHVybiBuZXcgVmVjdG9yMihBLlggLSBYLCBBLlkgLSBZKTtcclxuICAgICAgICB9XHJcbiAgICAgICAgcHVibGljIHZvaWQgQWRkKFZlY3RvcjIgVilcclxuICAgICAgICB7XHJcbiAgICAgICAgICAgIFggKz0gVi5YO1xyXG4gICAgICAgICAgICBZICs9IFYuWTtcclxuICAgICAgICB9XHJcbiAgICAgICAgcHVibGljIHZvaWQgU3VidHJhY3QoVmVjdG9yMiBWKVxyXG4gICAgICAgIHtcclxuICAgICAgICAgICAgWCAtPSBWLlg7XHJcbiAgICAgICAgICAgIFkgLT0gVi5ZO1xyXG4gICAgICAgIH1cclxuICAgIH1cclxufVxyXG4iLCJ1c2luZyBTeXN0ZW07XHJcbnVzaW5nIFN5c3RlbS5Db2xsZWN0aW9ucy5HZW5lcmljO1xyXG51c2luZyBTeXN0ZW0uTGlucTtcclxudXNpbmcgU3lzdGVtLlRleHQ7XHJcbnVzaW5nIFN5c3RlbS5UaHJlYWRpbmcuVGFza3M7XHJcblxyXG5uYW1lc3BhY2UgQ2lybm9HYW1lXHJcbntcclxuICAgIHB1YmxpYyBjbGFzcyBBaW1lZFNob290ZXIgOiBFbnRpdHlCZWhhdmlvclxyXG4gICAge1xyXG4gICAgICAgIHByaXZhdGUgaW50IHRpbWUgPSAwO1xyXG4gICAgICAgIHB1YmxpYyBpbnQgbWF4dGltZSA9IDYwICogODtcclxuICAgICAgICBwdWJsaWMgRW50aXR5IFRhcmdldDtcclxuICAgICAgICAvL3B1YmxpYyBmbG9hdCBtYXhEaXN0YW5jZSA9IDEyMDtcclxuICAgICAgICBwdWJsaWMgZmxvYXQgbWF4RGlzdGFuY2UgPSAxMzA7XHJcbiAgICAgICAgcHVibGljIGZsb2F0IG1heFNoYWRvdyA9IDU7XHJcblxyXG4gICAgICAgIHB1YmxpYyBmbG9hdCBhdHRhY2twb3dlciA9IDE7XHJcbiAgICAgICAgcHVibGljIGZsb2F0IGJ1bGxldFNwZWVkID0gMC41ZjtcclxuICAgICAgICBwdWJsaWMgaW50IGJ1bGxldER1cmF0aW9uID0gNjAgKiAxNTtcclxuXHJcbiAgICAgICAgcHVibGljIGJvb2wgaWdub3Jlc3RlcnJhaW4gPSBmYWxzZTtcclxuICAgICAgICBwdWJsaWMgc3RyaW5nIGJ1bGxldGdyYXBoaWMgPSBcImVidWxsZXRcIjtcclxuICAgICAgICBwdWJsaWMgaW50IGF0dGFja1RlbGVncmFwaFRpbWUgPSA2MDtcclxuICAgICAgICBwdWJsaWMgQWltZWRTaG9vdGVyKEVudGl0eSBlbnRpdHkpIDogYmFzZShlbnRpdHkpXHJcbiAgICAgICAge1xyXG4gICAgICAgICAgICAvKmVudGl0eS5BbmkuSHVlQ29sb3IgPSBcIiNGRjAwMDBcIjtcclxuICAgICAgICAgICAgZW50aXR5LkFuaS5IdWVSZWNvbG9yU3RyZW5ndGggPSAyLjBmOyovXHJcbiAgICAgICAgICAgIGVudGl0eS5BbmkuU2hhZG93Y29sb3IgPSBcIiNGRjAwMDBcIjtcclxuICAgICAgICB9XHJcbiAgICAgICAgcHVibGljIG92ZXJyaWRlIHZvaWQgVXBkYXRlKClcclxuICAgICAgICB7XHJcbiAgICAgICAgICAgIGJhc2UuVXBkYXRlKCk7XHJcbiAgICAgICAgICAgIFVwZGF0ZVRhcmdldCgpO1xyXG4gICAgICAgICAgICB2YXIgQSA9IGVudGl0eS5Bbmk7XHJcblxyXG4gICAgICAgICAgICBcclxuXHJcbiAgICAgICAgICAgIGlmIChUYXJnZXQgIT0gbnVsbClcclxuICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgaWYgKHRpbWUgPCBhdHRhY2tUZWxlZ3JhcGhUaW1lKVxyXG4gICAgICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgICAgIC8vaWYgKCh0aW1lICYgNCkgPiAwKVxyXG4gICAgICAgICAgICAgICAgICAgIGlmICh0cnVlKVxyXG4gICAgICAgICAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgLy9BLlNoYWRvdyA9IDYtKHRpbWUgKiAwLjFmKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgQS5TaGFkb3cgPSBtYXhTaGFkb3c7XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgIGVsc2VcclxuICAgICAgICAgICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIEEuU2hhZG93ID0gMDtcclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICBlbHNlXHJcbiAgICAgICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICAgICAgQS5TaGFkb3cgPSAwO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgdGltZS0tO1xyXG4gICAgICAgICAgICAgICAgaWYgKHRpbWUgPD0gMClcclxuICAgICAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgICAgICBSZXNldFRpbWVyKCk7XHJcbiAgICAgICAgICAgICAgICAgICAgU2hvb3QoKTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfWVsc2VcclxuICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgQS5TaGFkb3cgPSAwO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIC8qQS5TaGFkb3djb2xvciA9IEEuSHVlQ29sb3I7XHJcbiAgICAgICAgICAgIEEuU2hhZG93ID0gQS5TaGFkb3djb2xvciAhPSBcIlwiID8gMCA6IDM7XHJcbiAgICAgICAgICAgIEEuSHVlQ29sb3IgPSBcIiNGRjAwMDBcIjtcclxuICAgICAgICAgICAgQS5IdWVSZWNvbG9yU3RyZW5ndGggPSAyLjBmOyovXHJcbiAgICAgICAgICAgIC8vQS5VcGRhdGUoKTtcclxuXHJcbiAgICAgICAgfVxyXG4gICAgICAgIHByaXZhdGUgdm9pZCBVcGRhdGVUYXJnZXQoKVxyXG4gICAgICAgIHtcclxuICAgICAgICAgICAgaWYgKFRhcmdldCAhPSBudWxsKVxyXG4gICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICBpZiAoVGFyZ2V0LlBvc2l0aW9uLkVzdGltYXRlZERpc3RhbmNlKGVudGl0eS5Qb3NpdGlvbikgPiBtYXhEaXN0YW5jZSlcclxuICAgICAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgICAgICBUYXJnZXQgPSBudWxsO1xyXG4gICAgICAgICAgICAgICAgfWVsc2VcclxuICAgICAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgICAgICByZXR1cm47XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgdmFyIFQgPSBlbnRpdHkuR2FtZS5wbGF5ZXI7XHJcbiAgICAgICAgICAgIGlmIChULlBvc2l0aW9uLkVzdGltYXRlZERpc3RhbmNlKGVudGl0eS5Qb3NpdGlvbik8bWF4RGlzdGFuY2Upe1xyXG4gICAgICAgICAgICAgICAgVGFyZ2V0ID0gVDtcclxuICAgICAgICAgICAgICAgIFJlc2V0VGltZXIoKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuICAgICAgICBwcml2YXRlIHZvaWQgUmVzZXRUaW1lcigpXHJcbiAgICAgICAge1xyXG4gICAgICAgICAgICB0aW1lID0gKG1heHRpbWUvMik7XHJcbiAgICAgICAgICAgIHRpbWUgKz0gKGludClNYXRoLlJvdW5kKHRpbWUgKiBNYXRoLlJhbmRvbSgpKTtcclxuICAgICAgICB9XHJcbiAgICAgICAgcHJpdmF0ZSB2b2lkIFNob290KClcclxuICAgICAgICB7XHJcbiAgICAgICAgICAgIGlmIChUYXJnZXQgPT0gbnVsbCB8fCAoKElDb21iYXRhbnQpVGFyZ2V0KS5IUDw9MClcclxuICAgICAgICAgICAgICAgIHJldHVybjtcclxuICAgICAgICAgICAgdmFyIFAgPSBuZXcgUGxheWVyQnVsbGV0KGVudGl0eS5HYW1lLCBlbnRpdHksIFwiaW1hZ2VzL21pc2MvXCIrYnVsbGV0Z3JhcGhpYyk7XHJcbiAgICAgICAgICAgIFAuUG9zaXRpb24uQ29weUZyb20oZW50aXR5LmdldENlbnRlcigpKTtcclxuICAgICAgICAgICAgXHJcbiAgICAgICAgICAgIHZhciBEID0gKFRhcmdldC5nZXRDZW50ZXIoKSAtIFAuUG9zaXRpb24pO1xyXG4gICAgICAgICAgICBELlNldEFzTm9ybWFsaXplKGJ1bGxldFNwZWVkKTtcclxuICAgICAgICAgICAgUC5Ic3BlZWQgPSBELlg7XHJcbiAgICAgICAgICAgIFAuVnNwZWVkID0gRC5ZO1xyXG4gICAgICAgICAgICBQLnRvdWNoRGFtYWdlID0gYXR0YWNrcG93ZXI7XHJcbiAgICAgICAgICAgIFAuaWdub3Jlc3RlcnJhaW4gPSBpZ25vcmVzdGVycmFpbjtcclxuICAgICAgICAgICAgUC5EdXJhdGlvbiA9IGJ1bGxldER1cmF0aW9uO1xyXG4gICAgICAgICAgICBlbnRpdHkuR2FtZS5BZGRFbnRpdHkoUCk7XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG59XHJcbiIsInVzaW5nIFN5c3RlbTtcclxudXNpbmcgU3lzdGVtLkNvbGxlY3Rpb25zLkdlbmVyaWM7XHJcbnVzaW5nIFN5c3RlbS5MaW5xO1xyXG51c2luZyBTeXN0ZW0uVGV4dDtcclxudXNpbmcgU3lzdGVtLlRocmVhZGluZy5UYXNrcztcclxuXHJcbm5hbWVzcGFjZSBDaXJub0dhbWVcclxue1xyXG4gICAgcHVibGljIGNsYXNzIENoZXN0IDogRW50aXR5XHJcbiAgICB7XHJcbiAgICAgICAgcHVibGljIENoZXN0KEdhbWUgZ2FtZSkgOiBiYXNlKGdhbWUpXHJcbiAgICAgICAge1xyXG4gICAgICAgICAgICBBbmkgPSBuZXcgQW5pbWF0aW9uKEFuaW1hdGlvbkxvYWRlci5fdGhpcy5HZXRBbmltYXRpb24oXCJpbWFnZXMvbWlzYy9jaGVzdFwiKSk7XHJcbiAgICAgICAgICAgIEFuaS5JbWFnZVNwZWVkID0gMDtcclxuICAgICAgICAgICAgaWYgKE1hdGguUmFuZG9tKCkgPCAwLjE1KVxyXG4gICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICBIZWFydGlmeSgpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHB1YmxpYyB2b2lkIEdvbGRpZnkoKVxyXG4gICAgICAgIHtcclxuICAgICAgICAgICAgdmFyIFAgPSBBbmkuUG9zaXRpb247XHJcbiAgICAgICAgICAgIEFuaSA9IG5ldyBBbmltYXRpb24oQW5pbWF0aW9uTG9hZGVyLl90aGlzLkdldEFuaW1hdGlvbihcImltYWdlcy9taXNjL2dvbGRjaGVzdFwiKSk7XHJcbiAgICAgICAgICAgIEFuaS5JbWFnZVNwZWVkID0gMDtcclxuICAgICAgICAgICAgQW5pLlBvc2l0aW9uLkNvcHlGcm9tKFApO1xyXG4gICAgICAgICAgICBHb2xkZW4gPSB0cnVlO1xyXG4gICAgICAgICAgICBIZWFydCA9IGZhbHNlO1xyXG4gICAgICAgIH1cclxuICAgICAgICBwdWJsaWMgdm9pZCBIZWFydGlmeSgpXHJcbiAgICAgICAge1xyXG4gICAgICAgICAgICB2YXIgUCA9IEFuaS5Qb3NpdGlvbjtcclxuICAgICAgICAgICAgQW5pID0gbmV3IEFuaW1hdGlvbihBbmltYXRpb25Mb2FkZXIuX3RoaXMuR2V0QW5pbWF0aW9uKFwiaW1hZ2VzL21pc2MvcGlua2NoZXN0XCIpKTtcclxuICAgICAgICAgICAgQW5pLkltYWdlU3BlZWQgPSAwO1xyXG4gICAgICAgICAgICBBbmkuUG9zaXRpb24uQ29weUZyb20oUCk7XHJcbiAgICAgICAgICAgIEhlYXJ0ID0gdHJ1ZTtcclxuICAgICAgICB9XHJcbiAgICAgICAgcHVibGljIGJvb2wgRm9yY2VMb2NrZWQgPSBmYWxzZTtcclxuICAgICAgICBwdWJsaWMgYm9vbCBHb2xkZW4geyBnZXQ7IHByaXZhdGUgc2V0OyB9XHJcbiAgICAgICAgcHVibGljIGJvb2wgT3BlbmVkIHsgZ2V0OyBwcml2YXRlIHNldDsgfVxyXG4gICAgICAgIHB1YmxpYyBib29sIEhlYXJ0IHsgZ2V0OyBwcml2YXRlIHNldDsgfVxyXG4gICAgICAgIHB1YmxpYyBvdmVycmlkZSB2b2lkIFVwZGF0ZSgpXHJcbiAgICAgICAge1xyXG4gICAgICAgICAgICBiYXNlLlVwZGF0ZSgpO1xyXG4gICAgICAgICAgICB2YXIgRiA9IEdldEZsb29yKCk7XHJcbiAgICAgICAgICAgIGlmIChGID09IG51bGwpXHJcbiAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgIFZzcGVlZCA9IDI7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgZWxzZVxyXG4gICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICBWc3BlZWQgPSAwO1xyXG4gICAgICAgICAgICAgICAgeSA9IEYuR2V0SGl0Ym94KCkudG9wIC0gQW5pLkN1cnJlbnRJbWFnZS5IZWlnaHQ7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgdmFyIFAgPSAoUGxheWVyQ2hhcmFjdGVyKUdhbWUucGxheWVyO1xyXG4gICAgICAgICAgICBpZiAoUC5Qb3NpdGlvbi5Fc3RpbWF0ZWREaXN0YW5jZShQb3NpdGlvbikgPCAxNilcclxuICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgaWYgKCFGb3JjZUxvY2tlZClcclxuICAgICAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgICAgICBpZiAoIU9wZW5lZCAmJiBQLkNvbnRyb2xsZXJbMl0gJiYgKFAua2V5cyA+IDAgfHwgR29sZGVuKSlcclxuICAgICAgICAgICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmICghR29sZGVuKVxyXG4gICAgICAgICAgICAgICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBQLmtleXMtLTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgICAgICBPcGVuKFApO1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIGVsc2UgaWYgKFAuQ29udHJvbGxlclsyXSlcclxuICAgICAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgICAgICBQLk1TRy5DaGFuZ2VUZXh0KFwiSXQncyBzZWFsZWQgd2l0aCBtYWdpYy4uLlwiKTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuICAgICAgICBzdHJpbmdbXSBUdXBsZU5hbWVzID0gbmV3IHN0cmluZ1tde1wiTnVsbFwiLFwiU2luZ2xlXCIsXCJEb3VibGVcIixcIlRyaXBsZVwiLFwiUXVhZHJ1cGxlXCIsXCJRdWludHVwbGVcIixcIlNleHR1cGxlXCIsXCJTZXB0dXBsZVwiLFwiT2N0dXBsZVwiLCBcIk5vbnVwbGVcIixcIkRlY3VwbGVcIn07XHJcbiAgICAgICAgcHJpdmF0ZSB2b2lkIE9wZW4oUGxheWVyQ2hhcmFjdGVyIHBsYXllcilcclxuICAgICAgICB7XHJcbiAgICAgICAgICAgIGlmICghT3BlbmVkKVxyXG4gICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICBQbGF5U291bmQoXCJjaGVzdG9wZW5cIik7XHJcbiAgICAgICAgICAgICAgICBBbmkuQ3VycmVudEZyYW1lID0gMTtcclxuICAgICAgICAgICAgICAgIEFuaS5TZXRJbWFnZSgpO1xyXG4gICAgICAgICAgICAgICAgQW5pLlVwZGF0ZSgpO1xyXG4gICAgICAgICAgICAgICAgT3BlbmVkID0gdHJ1ZTtcclxuICAgICAgICAgICAgICAgIC8vVE9ETzpnaXZlIHBsYXllciBhIHBlcm1hbmVudCB1cGdyYWRlLCBhbmQgZGlzcGxheSB0ZXh0IGFib3ZlIHRoZSBjaGVzdCB0ZWxsaW5nIHRoZSBwbGF5ZXIgd2hhdCB0aGV5IGp1c3QgZ290XHJcbiAgICAgICAgICAgICAgICB2YXIgTSA9IFwiXCI7XHJcbiAgICAgICAgICAgICAgICB2YXIgb2sgPSB0cnVlO1xyXG4gICAgICAgICAgICAgICAgdmFyIFMgPSBcIlwiO1xyXG4gICAgICAgICAgICAgICAgdmFyIGNvbG9yID0gXCIjRkZGRkZGXCI7XHJcbiAgICAgICAgICAgICAgICBzdHJpbmdbXSBwaWNrZXIgPSBudWxsO1xyXG4gICAgICAgICAgICAgICAgd2hpbGUgKG9rKVxyXG4gICAgICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgICAgIHZhciBjb21tb24gPSBuZXcgc3RyaW5nW10geyBcInBvaW50XCIsIFwicG9pbnRcIiwgXCJwb2ludFwiLCBcInBvaW50XCIsIFwicG9pbnRcIiwgXCJwb2ludFwiLCBcImhlYXJ0XCIsIFwiaGVhcnRcIiwgXCJ0cmlwbGVoZWFydFwiLCBcInNpbmdsZW9yYlwiIH07XHJcbiAgICAgICAgICAgICAgICAgICAgdmFyIHJhcmUgPSBuZXcgc3RyaW5nW10geyBcImF0dGFja3Bvd2VyXCIsIFwiZGVmZW5zZXBvd2VyXCIsIFwibWluaW5nXCIgfTtcclxuICAgICAgICAgICAgICAgICAgICB2YXIgbGVnZW5kYXJ5ID0gbmV3IHN0cmluZ1tdIHsgXCJ0cmlwbGVqdW1wXCIsIFwiY2hlYXBlcmJsb2Nrc1wiLCBcImludmluY2liaWxpdHlcIiwgXCJyZXBlYXRlclwiLFwibW92ZXNwZWVkXCIgfTtcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgdmFyIGhlYXJ0VGFibGUgPSBuZXcgc3RyaW5nW10geyBcInN1cGVydHJpcGxlaGVhcnRcIiB9O1xyXG5cclxuXHJcbiAgICAgICAgICAgICAgICAgICAgdmFyIFIgPSBNYXRoLlJhbmRvbSgpO1xyXG4gICAgICAgICAgICAgICAgICAgIHN0cmluZyBDO1xyXG4gICAgICAgICAgICAgICAgICAgIGlmIChIZWFydClcclxuICAgICAgICAgICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIEMgPSBDaXJub0dhbWUuSGVscGVyRXh0ZW5zaW9ucy5QaWNrPHN0cmluZz4oaGVhcnRUYWJsZSk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIFMgPSBcImNvbW1vblwiO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBjb2xvciA9IFwiI0ZGRkZGRlwiO1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICBlbHNlXHJcbiAgICAgICAgICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAocGlja2VyID09IG51bGwgfHwgTWF0aC5SYW5kb20oKSA8IDAuMjApXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChSIDwgMC42MCAmJiAhR29sZGVuKVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHBpY2tlciA9IGNvbW1vbjtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBTID0gXCJjb21tb25cIjtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb2xvciA9IFwiI0ZGRkZGRlwiO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgZWxzZVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIFIgPSBNYXRoLlJhbmRvbSgpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChSIDwgMC45MSlcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHBpY2tlciA9IHJhcmU7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIFMgPSBcInJhcmVcIjtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY29sb3IgPSBcIiNGRkJCMzNcIjtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZWxzZVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcGlja2VyID0gbGVnZW5kYXJ5O1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBTID0gXCJsZWdlbmRhcnlcIjtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY29sb3IgPSBcIiNGRjU1RkZcIjtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHRydWUpXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIEMgPSBDaXJub0dhbWUuSGVscGVyRXh0ZW5zaW9ucy5QaWNrPHN0cmluZz4ocGlja2VyKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgICAgICBlbHNlXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHBpY2tlciA9IGxlZ2VuZGFyeTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIFMgPSBcImxlZ2VuZGFyeVwiO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgY29sb3IgPSBcIiNGRjU1RkZcIjtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIEMgPSBcIm1vdmVzcGVlZFwiO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgIG9rID0gZmFsc2U7XHJcbiAgICAgICAgICAgICAgICAgICAgQ29sbGVjdGFibGVJdGVtIENJO1xyXG4gICAgICAgICAgICAgICAgICAgIHN3aXRjaCAoQylcclxuICAgICAgICAgICAgICAgICAgICB7XHJcblxyXG4gICAgICAgICAgICAgICAgICAgICAgICBjYXNlIFwicG9pbnRcIjpcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhciBQID0gbmV3IFBvaW50SXRlbShHYW1lKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIFAuUG9zaXRpb24uQ29weUZyb20oUG9zaXRpb24pO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgUC5Wc3BlZWQgPSAtMmY7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBQLkhzcGVlZCA9IC0yZjtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIFAuY29sbGVjdGlvbkRlbGF5ID0gMzA7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBHYW1lLkFkZEVudGl0eShQKTtcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBQID0gbmV3IFBvaW50SXRlbShHYW1lKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIFAuUG9zaXRpb24uQ29weUZyb20oUG9zaXRpb24pO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgUC5Wc3BlZWQgPSAtMmY7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBQLkhzcGVlZCA9IDJmO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgUC5jb2xsZWN0aW9uRGVsYXkgPSAzMDtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIEdhbWUuQWRkRW50aXR5KFApO1xyXG5cclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIE0gPSBcIlBvaW50c1wiO1xyXG5cclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBjYXNlIFwiaGVhcnRcIjpcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChwbGF5ZXIuSFAgPj0gcGxheWVyLm1heEhQKVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG9rID0gdHJ1ZTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBicmVhaztcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhciBIID0gbmV3IEhlYWxpbmdJdGVtKEdhbWUpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgSC5Qb3NpdGlvbi5Db3B5RnJvbShQb3NpdGlvbik7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBILlZzcGVlZCA9IC0yZjtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIEguY29sbGVjdGlvbkRlbGF5ID0gMzA7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBHYW1lLkFkZEVudGl0eShIKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIE0gPSBcIkhlYWxcIjtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBjYXNlIFwidHJpcGxlaGVhcnRcIjpcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmICgocGxheWVyLkhQID4gcGxheWVyLm1heEhQIC8gMykgJiYgIUhlYXJ0KVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG9rID0gdHJ1ZTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBicmVhaztcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhciBIMSA9IG5ldyBIZWFsaW5nSXRlbShHYW1lKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIEgxLlBvc2l0aW9uLkNvcHlGcm9tKFBvc2l0aW9uKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIEgxLlZzcGVlZCA9IC0yZjtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIEgxLkhzcGVlZCA9IC0yZjtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIEgxLmNvbGxlY3Rpb25EZWxheSA9IDMwO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgR2FtZS5BZGRFbnRpdHkoSDEpO1xyXG5cclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIEgxID0gbmV3IEhlYWxpbmdJdGVtKEdhbWUpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgSDEuUG9zaXRpb24uQ29weUZyb20oUG9zaXRpb24pO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgSDEuVnNwZWVkID0gLTJmO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgSDEuSHNwZWVkID0gMDtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIEgxLmNvbGxlY3Rpb25EZWxheSA9IDMwO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgR2FtZS5BZGRFbnRpdHkoSDEpO1xyXG5cclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIEgxID0gbmV3IEhlYWxpbmdJdGVtKEdhbWUpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgSDEuUG9zaXRpb24uQ29weUZyb20oUG9zaXRpb24pO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgSDEuVnNwZWVkID0gLTJmO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgSDEuSHNwZWVkID0gMmY7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBIMS5jb2xsZWN0aW9uRGVsYXkgPSAzMDtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIEdhbWUuQWRkRW50aXR5KEgxKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIE0gPSBcIkhlYWwgeDNcIjtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBjYXNlIFwic3VwZXJ0cmlwbGVoZWFydFwiOlxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKChwbGF5ZXIuSFAgPiBwbGF5ZXIubWF4SFAgLyAzKSAmJiAhSGVhcnQpXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgb2sgPSB0cnVlO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgSDEgPSBuZXcgSGVhbGluZ0l0ZW0oR2FtZSk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBIMS5Qb3NpdGlvbi5Db3B5RnJvbShQb3NpdGlvbik7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBIMS5Wc3BlZWQgPSAtMmY7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBIMS5Ic3BlZWQgPSAtMmY7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBIMS5oZWFsaW5nUG93ZXIgKj0gMS41ZjtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIEgxLmNvbGxlY3Rpb25EZWxheSA9IDMwO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgR2FtZS5BZGRFbnRpdHkoSDEpO1xyXG5cclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIEgxID0gbmV3IEhlYWxpbmdJdGVtKEdhbWUpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgSDEuUG9zaXRpb24uQ29weUZyb20oUG9zaXRpb24pO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgSDEuVnNwZWVkID0gLTJmO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgSDEuSHNwZWVkID0gMDtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIEgxLmhlYWxpbmdQb3dlciAqPSAxLjVmO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgSDEuY29sbGVjdGlvbkRlbGF5ID0gMzA7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBHYW1lLkFkZEVudGl0eShIMSk7XHJcblxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgSDEgPSBuZXcgSGVhbGluZ0l0ZW0oR2FtZSk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBIMS5Qb3NpdGlvbi5Db3B5RnJvbShQb3NpdGlvbik7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBIMS5Wc3BlZWQgPSAtMmY7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBIMS5Ic3BlZWQgPSAyZjtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIEgxLmhlYWxpbmdQb3dlciAqPSAxLjVmO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgSDEuY29sbGVjdGlvbkRlbGF5ID0gMzA7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBHYW1lLkFkZEVudGl0eShIMSk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBNID0gXCJIZWFsK1wiO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGNhc2UgXCJzaW5nbGVvcmJcIjpcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChHYW1lLnRpbWVSZW1haW5pbmcgPiAwKVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG9rID0gdHJ1ZTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBicmVhaztcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIENJID0gbmV3IE9yYihHYW1lKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIENJLlBvc2l0aW9uLkNvcHlGcm9tKFBvc2l0aW9uKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIENJLlZzcGVlZCA9IC0yZjtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIENJLkhzcGVlZCA9IC0yZjtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIENJLmNvbGxlY3Rpb25EZWxheSA9IDMwO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgR2FtZS5BZGRFbnRpdHkoQ0kpO1xyXG5cclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8qQ0kgPSBuZXcgT3JiKEdhbWUpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgQ0kuUG9zaXRpb24uQ29weUZyb20oUG9zaXRpb24pO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgQ0kuVnNwZWVkID0gLTJmO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgQ0kuSHNwZWVkID0gMmY7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBDSS5jb2xsZWN0aW9uRGVsYXkgPSAzMDtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIEdhbWUuQWRkRW50aXR5KENJKTsqL1xyXG5cclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIE0gPSBcIk9yYlwiO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGNhc2UgXCJtaW5pbmdcIjpcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChwbGF5ZXIuZGlncG93ZXIgPCAyLjBmKVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHBsYXllci5kaWdwb3dlciArPSAwLjVmO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgZWxzZVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG9rID0gdHJ1ZTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIE0gPSBcIk1pbmluZyBQb3dlciBcIiArIChwbGF5ZXIuZGlncG93ZXIpICsgXCJ4XCI7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBicmVhaztcclxuICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSBcInRyaXBsZWp1bXBcIjpcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhciBQQyA9IHBsYXllci5HZXRCZWhhdmlvcjxQbGF0Zm9ybWVyQ29udHJvbHM+KCk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoUEMubWF4QWlySnVtcHMgPCAyKVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIFBDLm1heEFpckp1bXBzID0gMjtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVsc2VcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBvayA9IHRydWU7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBNID0gXCJUcmlwbGUgSnVtcFwiO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGNhc2UgXCJjaGVhcGVyYmxvY2tzXCI6XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAocGxheWVyLmJsb2NrcHJpY2UgIT0gNClcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBvayA9IHRydWU7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBwbGF5ZXIuYmxvY2twcmljZSA9IDE7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBNID0gXCJCbG9ja3MgYXJlIGNoZWFwZXIgbm93XCI7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBicmVhaztcclxuICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSBcIm1vdmVzcGVlZFwiOlxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHBsYXllci5kYXRhLkNvbnRhaW5zS2V5KFwibW92ZXNwZWVkXCIpKVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG9rID0gdHJ1ZTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBicmVhaztcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHBsYXllci5kYXRhW1wibW92ZXNwZWVkXCJdID0gdHJ1ZTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhciBQbGF0ID0gcGxheWVyLkdldEJlaGF2aW9yPFBsYXRmb3JtZXJDb250cm9scz4oKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIFBsYXQubWF4U3BlZWQgKj0gMS4wN2Y7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBQbGF0LmFjY2VsICo9IDEuMDdmO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgTSA9IFwiTW92ZW1lbnQgc3BlZWQrXCI7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBicmVhaztcclxuICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSBcImludmluY2liaWxpdHlcIjpcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChwbGF5ZXIuaW52aW5jaWJpbGl0eW1vZCAhPSAxKVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG9rID0gdHJ1ZTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBicmVhaztcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHBsYXllci5pbnZpbmNpYmlsaXR5bW9kID0gMjtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIE0gPSBcIkludmluY2liaWxpdHkgZXh0ZW5kZWRcIjtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrO1xyXG5cclxuICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSBcImF0dGFja3Bvd2VyXCI6XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBwbGF5ZXIuYXR0YWNrcG93ZXIgKz0gMTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIE0gPSBcIkF0dGFjayBQb3dlciBcIiArIChpbnQpKHBsYXllci5hdHRhY2twb3dlcik7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBicmVhaztcclxuICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSBcImRlZmVuc2Vwb3dlclwiOlxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgcGxheWVyLmRlZmVuc2Vwb3dlciArPSAxO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgTSA9IFwiRGVmZW5zaXZlIFBvd2VyIFwiICsgKGludCkocGxheWVyLmRlZmVuc2Vwb3dlcik7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBicmVhaztcclxuICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSBcInJlcGVhdGVyXCI6XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAocGxheWVyLnRvdGFsc2hvdHMgPiAyKVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG9rID0gdHJ1ZTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBicmVhaztcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHBsYXllci50b3RhbHNob3RzICs9IDE7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBNID0gVHVwbGVOYW1lc1twbGF5ZXIudG90YWxzaG90c10rXCIgc2hvdFwiO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGRlZmF1bHQ6XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBvayA9IHRydWU7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBicmVhaztcclxuICAgICAgICAgICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgaWYgKCFvayAmJiBNICE9IFwiXCIpXHJcbiAgICAgICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICAgICAgRmxvYXRpbmdNZXNzYWdlIEZNID0gbmV3IEZsb2F0aW5nTWVzc2FnZShHYW1lLCBNKTtcclxuICAgICAgICAgICAgICAgICAgICBGTS5UZXh0LlRleHRDb2xvciA9IGNvbG9yO1xyXG4gICAgICAgICAgICAgICAgICAgIC8vRk0uUG9zaXRpb24gPSBuZXcgVmVjdG9yMih4IC0gOCwgeSAtIDIwKTtcclxuICAgICAgICAgICAgICAgICAgICBGTS5Qb3NpdGlvbiA9IG5ldyBWZWN0b3IyKHggKyA4LCB5IC0gMjApO1xyXG4gICAgICAgICAgICAgICAgICAgIEdhbWUuQWRkRW50aXR5KEZNKTtcclxuICAgICAgICAgICAgICAgICAgICBpZiAoUyAhPSBcIlwiICYmIFMgIT0gXCJjb21tb25cIilcclxuICAgICAgICAgICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIFBsYXlTb3VuZChcIm9rMkJcIik7XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgIGVsc2VcclxuICAgICAgICAgICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIFBsYXlTb3VuZChcImp1bXBcIik7XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHByb3RlY3RlZCBUaWxlRGF0YSBHZXRGbG9vcigpXHJcbiAgICAgICAge1xyXG4gICAgICAgICAgICBUaWxlRGF0YSBUID0gbnVsbDtcclxuICAgICAgICAgICAgZmxvYXQgVyA9IFdpZHRoIC8gMztcclxuICAgICAgICAgICAgZmxvYXQgWSA9IEhlaWdodDtcclxuICAgICAgICAgICAgaWYgKCEoVCAhPSBudWxsICYmIFQuZW5hYmxlZCAmJiBULnRvcFNvbGlkKSlcclxuICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgVCA9IEdhbWUuVE0uQ2hlY2tGb3JUaWxlKFZlY3RvcjIuQWRkKFBvc2l0aW9uLCBXaWR0aCAvIDIsIFkpKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBpZiAoIShUICE9IG51bGwgJiYgVC5lbmFibGVkICYmIFQudG9wU29saWQpKVxyXG4gICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICBUID0gR2FtZS5UTS5DaGVja0ZvclRpbGUoVmVjdG9yMi5BZGQoUG9zaXRpb24sIFcsIFkpKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBpZiAoIShUICE9IG51bGwgJiYgVC5lbmFibGVkICYmIFQudG9wU29saWQpKVxyXG4gICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICBUID0gR2FtZS5UTS5DaGVja0ZvclRpbGUoVmVjdG9yMi5BZGQoUG9zaXRpb24sIFdpZHRoIC0gVywgWSkpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIGlmICghKFQgIT0gbnVsbCAmJiBULmVuYWJsZWQgJiYgVC50b3BTb2xpZCkpXHJcbiAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgIFQgPSBudWxsO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIHJldHVybiBUO1xyXG4gICAgICAgIH1cclxuICAgIH1cclxufVxyXG4iLCJ1c2luZyBTeXN0ZW07XHJcbnVzaW5nIFN5c3RlbS5Db2xsZWN0aW9ucy5HZW5lcmljO1xyXG51c2luZyBTeXN0ZW0uTGlucTtcclxudXNpbmcgU3lzdGVtLlRleHQ7XHJcbnVzaW5nIFN5c3RlbS5UaHJlYWRpbmcuVGFza3M7XHJcblxyXG5uYW1lc3BhY2UgQ2lybm9HYW1lXHJcbntcclxuICAgIHB1YmxpYyBhYnN0cmFjdCBjbGFzcyBDb2xsZWN0YWJsZUl0ZW0gOiBFbnRpdHlcclxuICAgIHtcclxuICAgICAgICBwdWJsaWMgYm9vbCBmbG9hdHMgPSB0cnVlO1xyXG4gICAgICAgIHB1YmxpYyBmbG9hdCBtYWduZXREaXN0YW5jZSA9IDM1O1xyXG4gICAgICAgIHB1YmxpYyBmbG9hdCBtYWduZXRTcGVlZCA9IDg7XHJcbiAgICAgICAgcHVibGljIGZsb2F0IG1heEZhbGxTcGVlZCA9IDI7XHJcbiAgICAgICAgcHVibGljIGZsb2F0IGZhbGxhY2NlbCA9IDAuMWY7XHJcbiAgICAgICAgcHVibGljIHN0cmluZyBpdGVtTmFtZTtcclxuICAgICAgICBwdWJsaWMgaW50IGNvbGxlY3Rpb25EZWxheSA9IDEwO1xyXG4gICAgICAgIHB1YmxpYyBzdHJpbmcgc291bmQgPSBcInBvd2VydXBcIjtcclxuICAgICAgICBwdWJsaWMgQ29sbGVjdGFibGVJdGVtKEdhbWUgZ2FtZSwgc3RyaW5nIGl0ZW1OYW1lKSA6IGJhc2UoZ2FtZSlcclxuICAgICAgICB7XHJcbiAgICAgICAgICAgIEFuaSA9IG5ldyBBbmltYXRpb24oQW5pbWF0aW9uTG9hZGVyLkdldChcImltYWdlcy9pdGVtcy9cIiArIGl0ZW1OYW1lKSk7XHJcbiAgICAgICAgICAgIEFuaS5TZXRJbWFnZSgpO1xyXG4gICAgICAgICAgICB0aGlzLml0ZW1OYW1lID0gaXRlbU5hbWU7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBwdWJsaWMgdmlydHVhbCBib29sIENhbkNvbGxlY3QoUGxheWVyQ2hhcmFjdGVyIHBsYXllcilcclxuICAgICAgICB7XHJcbiAgICAgICAgICAgIHJldHVybiB0cnVlO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgcHVibGljIG92ZXJyaWRlIHZvaWQgVXBkYXRlKClcclxuICAgICAgICB7XHJcbiAgICAgICAgICAgIGlmIChjb2xsZWN0aW9uRGVsYXkgPiAwKVxyXG4gICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICBjb2xsZWN0aW9uRGVsYXktLTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBWZWN0b3IyIEM7XHJcbiAgICAgICAgICAgIHZhciBwbGF5ZXIgPSBHYW1lLnBsYXllcjtcclxuXHJcbiAgICAgICAgICAgIGlmIChjb2xsZWN0aW9uRGVsYXkgPD0gMCAmJiBDYW5Db2xsZWN0KHBsYXllcikgJiYgKChDID0gcGxheWVyLmdldENlbnRlcigpKS5Fc3RpbWF0ZWREaXN0YW5jZShQb3NpdGlvbikgPCBtYWduZXREaXN0YW5jZSkpXHJcbiAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgIHZhciBDMiA9IGdldENlbnRlcigpO1xyXG4gICAgICAgICAgICAgICAgdmFyIFAgPSBDIC0gQzI7XHJcbiAgICAgICAgICAgICAgICB2YXIgbG4gPSBQLkxlbmd0aDtcclxuICAgICAgICAgICAgICAgIHZhciBzcGQgPSBtYWduZXRTcGVlZDtcclxuICAgICAgICAgICAgICAgIHZhciBmc3BkID0gc3BkIC8gTWF0aC5NYXgoMSwgbG4pO1xyXG4gICAgICAgICAgICAgICAgaWYgKGxuIDw9IGZzcGQvKiAmJiBDYW5Db2xsZWN0KEdhbWUucGxheWVyKSovKVxyXG4gICAgICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgICAgIC8vKChQbGF5ZXJDaGFyYWN0ZXIpR2FtZS5wbGF5ZXIpLm9uQ29sbGVjdEl0ZW0odGhpcyk7XHJcbiAgICAgICAgICAgICAgICAgICAgQWxpdmUgPSBmYWxzZTtcclxuICAgICAgICAgICAgICAgICAgICBIc3BlZWQgPSAwO1xyXG4gICAgICAgICAgICAgICAgICAgIFZzcGVlZCA9IDA7XHJcbiAgICAgICAgICAgICAgICAgICAgUG9zaXRpb24uQ29weUZyb20oR2FtZS5wbGF5ZXIuUG9zaXRpb24pO1xyXG4gICAgICAgICAgICAgICAgICAgIG9uQ29sbGVjdGVkKCgoUGxheWVyQ2hhcmFjdGVyKUdhbWUucGxheWVyKSk7XHJcbiAgICAgICAgICAgICAgICAgICAgUGxheVNvdW5kKHNvdW5kKTtcclxuICAgICAgICAgICAgICAgICAgICByZXR1cm47XHJcblxyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgUCA9IFAuTm9ybWFsaXplKGZzcGQpO1xyXG4gICAgICAgICAgICAgICAgLyp4ICs9IFAuWDtcclxuICAgICAgICAgICAgICAgIHkgKz0gUC5ZOyovXHJcbiAgICAgICAgICAgICAgICBIc3BlZWQgPSBQLlg7XHJcbiAgICAgICAgICAgICAgICBWc3BlZWQgPSBQLlk7XHJcblxyXG4gICAgICAgICAgICAgICAgLy9Wc3BlZWQgPSAwO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIGVsc2UgaWYgKCFmbG9hdHMpXHJcbiAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgIHZhciBGID0gR2V0Rmxvb3IoKTtcclxuICAgICAgICAgICAgICAgIGlmIChGID09IG51bGwpXHJcbiAgICAgICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKFZzcGVlZCA8IG1heEZhbGxTcGVlZClcclxuICAgICAgICAgICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIFZzcGVlZCA9IE1hdGguTWluKFZzcGVlZCArIGZhbGxhY2NlbCwgbWF4RmFsbFNwZWVkKTtcclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgZWxzZVxyXG4gICAgICAgICAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgVnNwZWVkID0gbWF4RmFsbFNwZWVkO1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIGVsc2VcclxuICAgICAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgICAgICBWc3BlZWQgPSAwO1xyXG4gICAgICAgICAgICAgICAgICAgIHkgPSBGLkdldEhpdGJveCgpLnRvcCAtIEFuaS5DdXJyZW50SW1hZ2UuSGVpZ2h0O1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgLy9Ic3BlZWQgPSAwO1xyXG4gICAgICAgICAgICAgICAgSHNwZWVkID0gKGZsb2F0KU1hdGhIZWxwZXIuRGVjZWxlcmF0ZShIc3BlZWQsIDAuMSk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgZWxzZVxyXG4gICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICAvL0hzcGVlZCA9IDA7XHJcbiAgICAgICAgICAgICAgICAvL1ZzcGVlZCA9IDA7XHJcbiAgICAgICAgICAgICAgICBIc3BlZWQgPSAoZmxvYXQpTWF0aEhlbHBlci5EZWNlbGVyYXRlKEhzcGVlZCwgMC4xKTtcclxuICAgICAgICAgICAgICAgIFZzcGVlZCA9IChmbG9hdClNYXRoSGVscGVyLkRlY2VsZXJhdGUoVnNwZWVkLCAwLjEpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIGJhc2UuVXBkYXRlKCk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHByb3RlY3RlZCBUaWxlRGF0YSBHZXRGbG9vcigpXHJcbiAgICAgICAge1xyXG4gICAgICAgICAgICBUaWxlRGF0YSBUID0gbnVsbDtcclxuICAgICAgICAgICAgZmxvYXQgVyA9IFdpZHRoIC8gMztcclxuICAgICAgICAgICAgZmxvYXQgWSA9IEhlaWdodDtcclxuICAgICAgICAgICAgaWYgKCEoVCAhPSBudWxsICYmIFQuZW5hYmxlZCAmJiBULnRvcFNvbGlkKSlcclxuICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgVCA9IEdhbWUuVE0uQ2hlY2tGb3JUaWxlKFZlY3RvcjIuQWRkKFBvc2l0aW9uLCBXaWR0aCAvIDIsIFkpKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBpZiAoIShUICE9IG51bGwgJiYgVC5lbmFibGVkICYmIFQudG9wU29saWQpKVxyXG4gICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICBUID0gR2FtZS5UTS5DaGVja0ZvclRpbGUoVmVjdG9yMi5BZGQoUG9zaXRpb24sIFcsIFkpKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBpZiAoIShUICE9IG51bGwgJiYgVC5lbmFibGVkICYmIFQudG9wU29saWQpKVxyXG4gICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICBUID0gR2FtZS5UTS5DaGVja0ZvclRpbGUoVmVjdG9yMi5BZGQoUG9zaXRpb24sIFdpZHRoIC0gVywgWSkpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIGlmICghKFQgIT0gbnVsbCAmJiBULmVuYWJsZWQgJiYgVC50b3BTb2xpZCkpXHJcbiAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgIFQgPSBudWxsO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIHJldHVybiBUO1xyXG4gICAgICAgIH1cclxuICAgICAgICBhYnN0cmFjdCBwdWJsaWMgdm9pZCBvbkNvbGxlY3RlZChQbGF5ZXJDaGFyYWN0ZXIgcGxheWVyKTtcclxuICAgICAgICAvKnB1YmxpYyB2aXJ0dWFsIHZvaWQgb25Db2xsZWN0ZWQoUGxheWVyQ2hhcmFjdGVyIHBsYXllcilcclxuICAgICAgICB7XHJcblxyXG4gICAgICAgIH0qL1xyXG4gICAgfVxyXG59XHJcbiIsInVzaW5nIFN5c3RlbTtcclxudXNpbmcgU3lzdGVtLkNvbGxlY3Rpb25zLkdlbmVyaWM7XHJcbnVzaW5nIFN5c3RlbS5MaW5xO1xyXG51c2luZyBTeXN0ZW0uVGV4dDtcclxudXNpbmcgU3lzdGVtLlRocmVhZGluZy5UYXNrcztcclxuXHJcbm5hbWVzcGFjZSBDaXJub0dhbWVcclxue1xyXG4gICAgcHVibGljIGNsYXNzIENvbnRyb2xsYWJsZUVudGl0eSA6IEVudGl0eVxyXG4gICAge1xyXG4gICAgICAgIHB1YmxpYyBib29sW10gQ29udHJvbGxlcjtcclxuICAgICAgICBwdWJsaWMgYm9vbFtdIExDb250cm9sbGVyO1xyXG4gICAgICAgIHB1YmxpYyBDb250cm9sbGFibGVFbnRpdHkoR2FtZSBnYW1lKSA6IGJhc2UoZ2FtZSlcclxuICAgICAgICB7XHJcbiAgICAgICAgICAgIENvbnRyb2xsZXIgPSBuZXcgYm9vbFs3XTtcclxuICAgICAgICAgICAgTENvbnRyb2xsZXIgPSBuZXcgYm9vbFtDb250cm9sbGVyLkxlbmd0aF07XHJcbiAgICAgICAgfVxyXG4gICAgICAgIC8vLyA8c3VtbWFyeT5cclxuICAgICAgICAvLy8gcmV0dXJucyB0cnVlIGlmIHRoZSBidXR0b24gd2FzIGp1c3QgcHJlc3NlZC5cclxuICAgICAgICAvLy8gPC9zdW1tYXJ5PlxyXG4gICAgICAgIC8vLyA8cGFyYW0gbmFtZT1cImJ1dHRvblwiPjwvcGFyYW0+XHJcbiAgICAgICAgLy8vIDxyZXR1cm5zPjwvcmV0dXJucz5cclxuICAgICAgICBwdWJsaWMgYm9vbCBQcmVzc2VkKGludCBidXR0b24pXHJcbiAgICAgICAge1xyXG4gICAgICAgICAgICByZXR1cm4gKENvbnRyb2xsZXJbYnV0dG9uXSAhPSBMQ29udHJvbGxlcltidXR0b25dICYmIENvbnRyb2xsZXJbYnV0dG9uXSk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIC8vLyA8c3VtbWFyeT5cclxuICAgICAgICAvLy8gcmV0dXJucyB0cnVlIGlmIGp1c3QgcmVsZWFzZWQuXHJcbiAgICAgICAgLy8vIDwvc3VtbWFyeT5cclxuICAgICAgICAvLy8gPHBhcmFtIG5hbWU9XCJidXR0b25cIj48L3BhcmFtPlxyXG4gICAgICAgIC8vLyA8cmV0dXJucz48L3JldHVybnM+XHJcbiAgICAgICAgcHVibGljIGJvb2wgUmVsZWFzZWQoaW50IGJ1dHRvbilcclxuICAgICAgICB7XHJcbiAgICAgICAgICAgIHJldHVybiAoQ29udHJvbGxlcltidXR0b25dICE9IExDb250cm9sbGVyW2J1dHRvbl0gJiYgIUNvbnRyb2xsZXJbYnV0dG9uXSk7XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG59XHJcbiIsInVzaW5nIFN5c3RlbTtcclxudXNpbmcgU3lzdGVtLkNvbGxlY3Rpb25zLkdlbmVyaWM7XHJcbnVzaW5nIFN5c3RlbS5MaW5xO1xyXG51c2luZyBTeXN0ZW0uVGV4dDtcclxudXNpbmcgU3lzdGVtLlRocmVhZGluZy5UYXNrcztcclxuXHJcbm5hbWVzcGFjZSBDaXJub0dhbWVcclxue1xyXG4gICAgcHVibGljIGNsYXNzIEV4aXREb29yIDogRW50aXR5XHJcbiAgICB7XHJcbiAgICAgICAgcHJpdmF0ZSBpbnQgcmVzZXQgPSAwO1xyXG4gICAgICAgIHByaXZhdGUgVGlsZURhdGEgUlQ7XHJcbiAgICAgICAgcHJpdmF0ZSBib29sIF9PcGVuZWQgPSBmYWxzZTtcclxuICAgICAgICBwdWJsaWMgYm9vbCBPcGVuZWRcclxuICAgICAgICB7XHJcbiAgICAgICAgICAgIGdldFxyXG4gICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gX09wZW5lZDtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBzZXRcclxuICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgX09wZW5lZCA9IHZhbHVlO1xyXG4gICAgICAgICAgICAgICAgaWYgKF9PcGVuZWQpXHJcbiAgICAgICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICAgICAgQW5pLkN1cnJlbnRGcmFtZSA9IDE7XHJcbiAgICAgICAgICAgICAgICAgICAgQW5pLlNldEltYWdlKCk7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICBlbHNlXHJcbiAgICAgICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICAgICAgQW5pLkN1cnJlbnRGcmFtZSA9IDA7XHJcbiAgICAgICAgICAgICAgICAgICAgQW5pLlNldEltYWdlKCk7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcbiAgICAgICAgcHVibGljIEV4aXREb29yKEdhbWUgZ2FtZSkgOiBiYXNlKGdhbWUpXHJcbiAgICAgICAge1xyXG4gICAgICAgICAgICBBbmkgPSBuZXcgQW5pbWF0aW9uKEFuaW1hdGlvbkxvYWRlci5HZXQoXCJpbWFnZXMvbWlzYy9kb29yXCIpKTtcclxuICAgICAgICAgICAgQW5pLkltYWdlU3BlZWQgPSAwO1xyXG4gICAgICAgICAgICBBbmkuU2V0SW1hZ2UoKTtcclxuICAgICAgICAgICAgUmVtb3ZlZE9uTGV2ZWxFbmQgPSBmYWxzZTtcclxuICAgICAgICB9XHJcbiAgICAgICAgcHVibGljIHZvaWQgRHJvcFRvR3JvdW5kKClcclxuICAgICAgICB7XHJcbiAgICAgICAgICAgIHdoaWxlIChHZXRGbG9vcigpID09IG51bGwpXHJcbiAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgIHkgKz0gMTY7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgdmFyIEYgPSBHZXRGbG9vcigpO1xyXG4gICAgICAgICAgICAvL0YuQnJlYWthYmxlID0gZmFsc2U7XHJcbiAgICAgICAgICAgIHZhciBGQiA9IEYuR2V0SGl0Ym94KCk7XHJcbiAgICAgICAgICAgIHggPSBGQi5sZWZ0O1xyXG4gICAgICAgICAgICB5ID0gRkIudG9wIC0gMzI7XHJcbiAgICAgICAgICAgIHZhciBUID0gR2FtZS5UTS5HZXRUaWxlKEYuY29sdW1uLCBGLnJvdyAtIDEpO1xyXG4gICAgICAgICAgICBpZiAoVCAhPSBudWxsICYmIFQuZW5hYmxlZCAmJiBULnRvcFNvbGlkKVxyXG4gICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICB5IC09IDE2O1xyXG4gICAgICAgICAgICAgICAgRiA9IFQ7XHJcbiAgICAgICAgICAgICAgICBIZWxwZXIuTG9nKFwiZHVnIGRvb3Igb3V0IG9mIHRoZSBncm91bmRcIik7XHJcblxyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIFJUID0gRjtcclxuICAgICAgICAgICAgLypGLkJyZWFrYWJsZSA9IGZhbHNlO1xyXG4gICAgICAgICAgICBGLnRleHR1cmUgPSAwO1xyXG5cclxuICAgICAgICAgICAgR2FtZS5UTS5SZWRyYXdUaWxlKEYuY29sdW1uLCBGLnJvdyk7Ki9cclxuICAgICAgICAgICAgcmVzZXQgPSAwO1xyXG5cclxuICAgICAgICB9XHJcbiAgICAgICAgcHVibGljIG92ZXJyaWRlIHZvaWQgVXBkYXRlKClcclxuICAgICAgICB7XHJcbiAgICAgICAgICAgIGJhc2UuVXBkYXRlKCk7XHJcbiAgICAgICAgICAgIGlmICghX09wZW5lZClcclxuICAgICAgICAgICAgICAgIHJldHVybjtcclxuICAgICAgICAgICAgLyp2YXIgRiA9IEdldEZsb29yKCk7XHJcbiAgICAgICAgICAgIGlmIChGID09IG51bGwpXHJcbiAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgIFZzcGVlZCA9IDE7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgZWxzZVxyXG4gICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICBWc3BlZWQgPSAwO1xyXG4gICAgICAgICAgICAgICAgeSA9IEYuR2V0SGl0Ym94KCkudG9wIC0gQW5pLkN1cnJlbnRJbWFnZS5IZWlnaHQ7XHJcbiAgICAgICAgICAgIH0qL1xyXG4gICAgICAgICAgICB2YXIgUCA9IChQbGF5ZXJDaGFyYWN0ZXIpR2FtZS5wbGF5ZXI7XHJcbiAgICAgICAgICAgIGlmIChQLlBvc2l0aW9uLkVzdGltYXRlZERpc3RhbmNlKFBvc2l0aW9uKSA8IDIwICYmIFAuQ29udHJvbGxlclsyXSlcclxuICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgT3BlbmVkID0gZmFsc2U7XHJcbiAgICAgICAgICAgICAgICBQLnNjb3JlICs9IChHYW1lLmxldmVsICogMTApO1xyXG5cclxuICAgICAgICAgICAgICAgIHZhciB0aW1lID0gKDEwMDApICogMTM7XHJcbiAgICAgICAgICAgICAgICBpZiAoR2FtZS50aW1lUmVtYWluaW5nID4gMClcclxuICAgICAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgICAgICBHYW1lLnRpbWVSZW1haW5pbmcgKz0gdGltZTtcclxuICAgICAgICAgICAgICAgICAgICBHYW1lLnRpbWVSZW1haW5pbmcgPSBNYXRoLk1pbihHYW1lLmRlZmF1bHRUaW1lUmVtYWluaW5nLCBHYW1lLnRpbWVSZW1haW5pbmcpO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgZWxzZVxyXG4gICAgICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgICAgIEdhbWUudGltZVJlbWFpbmluZyArPSB0aW1lO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgR2FtZS5TdGFydE5leHRMZXZlbCgpO1xyXG5cclxuICAgICAgICAgICAgICAgIC8qUC5rZXlzLS07XHJcbiAgICAgICAgICAgICAgICBPcGVuKFApOyovXHJcbiAgICAgICAgICAgICAgICAvKkFuaS5DdXJyZW50RnJhbWUgPSAxO1xyXG4gICAgICAgICAgICAgICAgQW5pLlNldEltYWdlKCk7XHJcbiAgICAgICAgICAgICAgICBBbmkuVXBkYXRlKCk7Ki9cclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBpZiAocmVzZXQgPCAyKVxyXG4gICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICByZXNldCsrO1xyXG4gICAgICAgICAgICAgICAgLy9yZXNldCA9IGZhbHNlO1xyXG4gICAgICAgICAgICAgICAgLy92YXIgRiA9IEdldEZsb29yKCk7XHJcbiAgICAgICAgICAgICAgICB2YXIgRiA9IFJUO1xyXG4gICAgICAgICAgICAgICAgaWYgKEYgIT0gbnVsbCAmJiByZXNldCA9PSAyKVxyXG4gICAgICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgICAgIEYuQnJlYWthYmxlID0gZmFsc2U7XHJcbiAgICAgICAgICAgICAgICAgICAgRi50ZXh0dXJlID0gMDtcclxuICAgICAgICAgICAgICAgICAgICBHYW1lLlRNLlJlZHJhd1RpbGUoRi5jb2x1bW4sIEYucm93KTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuICAgICAgICBwcm90ZWN0ZWQgVGlsZURhdGEgR2V0Rmxvb3IoKVxyXG4gICAgICAgIHtcclxuICAgICAgICAgICAgVGlsZURhdGEgVCA9IG51bGw7XHJcbiAgICAgICAgICAgIGZsb2F0IFcgPSBXaWR0aCAvIDM7XHJcbiAgICAgICAgICAgIGZsb2F0IFkgPSBIZWlnaHQ7XHJcbiAgICAgICAgICAgIGlmICghKFQgIT0gbnVsbCAmJiBULmVuYWJsZWQgJiYgVC50b3BTb2xpZCkpXHJcbiAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgIFQgPSBHYW1lLlRNLkNoZWNrRm9yVGlsZShWZWN0b3IyLkFkZChQb3NpdGlvbiwgV2lkdGggLyAyLCBZKSk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgaWYgKCEoVCAhPSBudWxsICYmIFQuZW5hYmxlZCAmJiBULnRvcFNvbGlkKSlcclxuICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgVCA9IEdhbWUuVE0uQ2hlY2tGb3JUaWxlKFZlY3RvcjIuQWRkKFBvc2l0aW9uLCBXLCBZKSk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgaWYgKCEoVCAhPSBudWxsICYmIFQuZW5hYmxlZCAmJiBULnRvcFNvbGlkKSlcclxuICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgVCA9IEdhbWUuVE0uQ2hlY2tGb3JUaWxlKFZlY3RvcjIuQWRkKFBvc2l0aW9uLCBXaWR0aCAtIFcsIFkpKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBpZiAoIShUICE9IG51bGwgJiYgVC5lbmFibGVkICYmIFQudG9wU29saWQpKVxyXG4gICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICBUID0gbnVsbDtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICByZXR1cm4gVDtcclxuICAgICAgICB9XHJcbiAgICB9XHJcbn1cclxuIiwidXNpbmcgU3lzdGVtO1xyXG51c2luZyBTeXN0ZW0uQ29sbGVjdGlvbnMuR2VuZXJpYztcclxudXNpbmcgU3lzdGVtLkxpbnE7XHJcbnVzaW5nIFN5c3RlbS5UZXh0O1xyXG51c2luZyBTeXN0ZW0uVGhyZWFkaW5nLlRhc2tzO1xyXG5cclxubmFtZXNwYWNlIENpcm5vR2FtZVxyXG57XHJcbiAgICBwdWJsaWMgY2xhc3MgRmxpZ2h0Q29udHJvbHMgOiBFbnRpdHlCZWhhdmlvclxyXG4gICAge1xyXG4gICAgICAgIHB1YmxpYyBmbG9hdCBhY2NlbCA9IDAuMzVmO1xyXG4gICAgICAgIHB1YmxpYyBmbG9hdCBtYXhTcGVlZCA9IDEuNWY7XHJcbiAgICAgICAgUGxhdGZvcm1lckVudGl0eSBfcGxhdGZvcm1lcjtcclxuXHJcbiAgICAgICAgcHVibGljIEZsaWdodENvbnRyb2xzKFBsYXRmb3JtZXJFbnRpdHkgZW50aXR5KSA6IGJhc2UoZW50aXR5KVxyXG4gICAgICAgIHtcclxuICAgICAgICAgICAgX3BsYXRmb3JtZXIgPSBlbnRpdHk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHB1YmxpYyBvdmVycmlkZSB2b2lkIFVwZGF0ZSgpXHJcbiAgICAgICAge1xyXG4gICAgICAgICAgICBib29sW10gY29udHJvbGxlciA9IF9wbGF0Zm9ybWVyLkNvbnRyb2xsZXI7XHJcbiAgICAgICAgICAgIGlmIChjb250cm9sbGVyWzBdICYmIF9wbGF0Zm9ybWVyLkhzcGVlZCA+IC1tYXhTcGVlZClcclxuICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgX3BsYXRmb3JtZXIuSHNwZWVkID0gKGZsb2F0KU1hdGguTWF4KF9wbGF0Zm9ybWVyLkhzcGVlZCAtIChhY2NlbCArIF9wbGF0Zm9ybWVyLmZyaWN0aW9uKSwgLW1heFNwZWVkKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBpZiAoY29udHJvbGxlclsxXSAmJiBfcGxhdGZvcm1lci5Ic3BlZWQgPCBtYXhTcGVlZClcclxuICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgX3BsYXRmb3JtZXIuSHNwZWVkID0gKGZsb2F0KU1hdGguTWluKF9wbGF0Zm9ybWVyLkhzcGVlZCArIChhY2NlbCArIF9wbGF0Zm9ybWVyLmZyaWN0aW9uKSwgbWF4U3BlZWQpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIGlmIChjb250cm9sbGVyWzJdICYmIF9wbGF0Zm9ybWVyLlZzcGVlZCA+IC1tYXhTcGVlZClcclxuICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgX3BsYXRmb3JtZXIuVnNwZWVkID0gKGZsb2F0KU1hdGguTWF4KF9wbGF0Zm9ybWVyLlZzcGVlZCAtIChhY2NlbCArIF9wbGF0Zm9ybWVyLmZyaWN0aW9uKSwgLW1heFNwZWVkKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBpZiAoY29udHJvbGxlclszXSAmJiBfcGxhdGZvcm1lci5Wc3BlZWQgPCBtYXhTcGVlZClcclxuICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgX3BsYXRmb3JtZXIuVnNwZWVkID0gKGZsb2F0KU1hdGguTWluKF9wbGF0Zm9ybWVyLlZzcGVlZCArIChhY2NlbCArIF9wbGF0Zm9ybWVyLmZyaWN0aW9uKSwgbWF4U3BlZWQpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIC8qdmFyIGp1bXBidXR0b24gPSA1O1xyXG4gICAgICAgICAgICBpZiAoX3BsYXRmb3JtZXIuVnNwZWVkID49IDAgJiYgX3BsYXRmb3JtZXIub25Hcm91bmQpXHJcbiAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgIGlmIChfcGxhdGZvcm1lci5QcmVzc2VkKGp1bXBidXR0b24pICYmIF9wbGF0Zm9ybWVyLm9uR3JvdW5kICYmIF9wbGF0Zm9ybWVyLkNlaWxpbmcgPT0gbnVsbClcclxuICAgICAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgICAgICBfcGxhdGZvcm1lci5Wc3BlZWQgPSAtanVtcFNwZWVkO1xyXG4gICAgICAgICAgICAgICAgICAgIC8vL2VudGl0eS5QbGF5U291bmQoXCJqdW1wXCIpO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIGVsc2UgaWYgKGFpckp1bXBzIDwgbWF4QWlySnVtcHMgJiYgX3BsYXRmb3JtZXIuUHJlc3NlZChqdW1wYnV0dG9uKSAmJiBfcGxhdGZvcm1lci5DZWlsaW5nID09IG51bGwpXHJcbiAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgIF9wbGF0Zm9ybWVyLlZzcGVlZCA9IC0oanVtcFNwZWVkICogYWlyanVtcHBvd2VyKTtcclxuICAgICAgICAgICAgICAgIGFpckp1bXBzKys7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgaWYgKF9wbGF0Zm9ybWVyLlZzcGVlZCA8IDAgJiYgIWNvbnRyb2xsZXJbanVtcGJ1dHRvbl0pXHJcbiAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgIF9wbGF0Zm9ybWVyLlZzcGVlZCArPSAoX3BsYXRmb3JtZXIuZ3Jhdml0eSAqIDIpO1xyXG4gICAgICAgICAgICB9Ki9cclxuICAgICAgICAgICAgYmFzZS5VcGRhdGUoKTtcclxuICAgICAgICB9XHJcbiAgICB9XHJcbn1cclxuIiwidXNpbmcgU3lzdGVtO1xyXG51c2luZyBTeXN0ZW0uQ29sbGVjdGlvbnMuR2VuZXJpYztcclxudXNpbmcgU3lzdGVtLkxpbnE7XHJcbnVzaW5nIFN5c3RlbS5UZXh0O1xyXG51c2luZyBTeXN0ZW0uVGhyZWFkaW5nLlRhc2tzO1xyXG51c2luZyBCcmlkZ2UuSHRtbDU7XHJcblxyXG5uYW1lc3BhY2UgQ2lybm9HYW1lXHJcbntcclxuICAgIHB1YmxpYyBjbGFzcyBGbG9hdGluZ01lc3NhZ2UgOiBFbnRpdHlcclxuICAgIHtcclxuICAgICAgICBwdWJsaWMgaW50IHRpbWUgPSAzMDtcclxuICAgICAgICBwdWJsaWMgVGV4dFNwcml0ZSBUZXh0O1xyXG4gICAgICAgIGZsb2F0IGFscGhhID0gMTtcclxuICAgICAgICBwdWJsaWMgYm9vbCBhdXRva2lsbCA9IHRydWU7XHJcbiAgICAgICAgcHVibGljIEZsb2F0aW5nTWVzc2FnZShHYW1lIGdhbWUsIHN0cmluZyB0ZXh0KSA6IGJhc2UoZ2FtZSlcclxuICAgICAgICB7XHJcbiAgICAgICAgICAgIEFuaSA9IG5ldyBBbmltYXRpb24obnVsbCk7XHJcbiAgICAgICAgICAgIFRleHQgPSBuZXcgVGV4dFNwcml0ZSgpO1xyXG4gICAgICAgICAgICBUZXh0LlRleHQgPSB0ZXh0O1xyXG4gICAgICAgICAgICBUZXh0LlRleHRDb2xvciA9IFwiI0ZGRkZGRlwiO1xyXG4gICAgICAgICAgICBUZXh0LlNoYWRvd0NvbG9yID0gXCIjMDAwMDAwXCI7XHJcbiAgICAgICAgICAgIFRleHQuU2hhZG93T2Zmc2V0ID0gbmV3IFZlY3RvcjIoMiwgMik7XHJcbiAgICAgICAgICAgIFRleHQuU2hhZG93Qmx1ciA9IDE7XHJcbiAgICAgICAgICAgIFRleHQuRm9udFNpemUgPSAxNDtcclxuICAgICAgICAgICAgdGltZSA9IDMwICsgKHRleHQuTGVuZ3RoICogMjApO1xyXG4gICAgICAgIH1cclxuICAgICAgICBwdWJsaWMgdm9pZCBDaGFuZ2VUZXh0KHN0cmluZyB0ZXh0LHN0cmluZyBjb2xvcj1udWxsKVxyXG4gICAgICAgIHtcclxuICAgICAgICAgICAgVGV4dC5UZXh0ID0gdGV4dDtcclxuICAgICAgICAgICAgdGltZSA9IDMwICsgKHRleHQuTGVuZ3RoICogMjApO1xyXG4gICAgICAgICAgICBhbHBoYSA9IDE7XHJcbiAgICAgICAgICAgIGlmIChjb2xvciAhPSBudWxsKVxyXG4gICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICBUZXh0LlRleHRDb2xvciA9IGNvbG9yO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHB1YmxpYyBvdmVycmlkZSB2b2lkIFVwZGF0ZSgpXHJcbiAgICAgICAge1xyXG4gICAgICAgICAgICBiYXNlLlVwZGF0ZSgpO1xyXG4gICAgICAgICAgICBpZiAodGltZSA+IDApXHJcbiAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgIHRpbWUtLTtcclxuICAgICAgICAgICAgICAgIGlmICh0aW1lIDwgMSAmJiBhbHBoYT4wKVxyXG4gICAgICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgICAgIC8vQWxpdmUgPSBmYWxzZTtcclxuICAgICAgICAgICAgICAgICAgICBhbHBoYSAtPSAwLjA1ZjtcclxuICAgICAgICAgICAgICAgICAgICBpZiAoYWxwaGEgPD0gMClcclxuICAgICAgICAgICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGFscGhhID0gMDtcclxuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGF1dG9raWxsKVxyXG4gICAgICAgICAgICAgICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBBbGl2ZSA9IGZhbHNlO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgIHRpbWUgPSAxO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHB1YmxpYyBvdmVycmlkZSB2b2lkIERyYXcoQ2FudmFzUmVuZGVyaW5nQ29udGV4dDJEIGcpXHJcbiAgICAgICAge1xyXG4gICAgICAgICAgICAvL2Jhc2UuRHJhdyhnKTtcclxuICAgICAgICAgICAgaWYgKGFscGhhIDwgMSlcclxuICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgaWYgKGFscGhhIDw9IDApXHJcbiAgICAgICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgZy5HbG9iYWxBbHBoYSA9IGFscGhhO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIC8vVGV4dC5Qb3NpdGlvbi5Db3B5RnJvbShQb3NpdGlvbik7XHJcbiAgICAgICAgICAgIFRleHQuRm9yY2VVcGRhdGUoKTtcclxuICAgICAgICAgICAgVGV4dC5Qb3NpdGlvbi5YID0gKGludClQb3NpdGlvbi5YIC0gKFRleHQuc3ByaXRlQnVmZmVyLldpZHRoIC8gMik7XHJcbiAgICAgICAgICAgIFRleHQuUG9zaXRpb24uWSA9IChpbnQpUG9zaXRpb24uWSAtIChUZXh0LnNwcml0ZUJ1ZmZlci5IZWlnaHQgLyAyKTtcclxuICAgICAgICAgICAgVGV4dC5EcmF3KGcpO1xyXG4gICAgICAgICAgICBnLkdsb2JhbEFscGhhID0gMWY7XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG59XHJcbiIsInVzaW5nIFN5c3RlbTtcclxudXNpbmcgU3lzdGVtLkNvbGxlY3Rpb25zLkdlbmVyaWM7XHJcbnVzaW5nIFN5c3RlbS5MaW5xO1xyXG51c2luZyBTeXN0ZW0uVGV4dDtcclxudXNpbmcgU3lzdGVtLlRocmVhZGluZy5UYXNrcztcclxudXNpbmcgQnJpZGdlO1xyXG51c2luZyBCcmlkZ2UuSHRtbDU7XHJcblxyXG5uYW1lc3BhY2UgQ2lybm9HYW1lXHJcbntcclxuICAgIHB1YmxpYyBjbGFzcyBQYXJ0aWNsZSA6IEVudGl0eVxyXG4gICAge1xyXG4gICAgICAgIHB1YmxpYyBpbnQgSFAgPSAxMjtcclxuICAgICAgICBwdWJsaWMgZmxvYXQgYWxwaGF0aW1lID0gMC4yZjtcclxuXHJcbiAgICAgICAgcHVibGljIFBhcnRpY2xlKEdhbWUgZ2FtZSwgSFRNTEltYWdlRWxlbWVudCBpbWFnZSkgOiBiYXNlKGdhbWUpXHJcbiAgICAgICAge1xyXG4gICAgICAgICAgICBBbmkgPSBuZXcgQW5pbWF0aW9uKG5ldyBMaXN0PEhUTUxJbWFnZUVsZW1lbnQ+KG5ldyBIVE1MSW1hZ2VFbGVtZW50W10geyBpbWFnZSB9KSk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHB1YmxpYyBvdmVycmlkZSB2b2lkIFVwZGF0ZSgpXHJcbiAgICAgICAge1xyXG4gICAgICAgICAgICBIUC0tO1xyXG4gICAgICAgICAgICBpZiAoSFAgPD0gMClcclxuICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgaWYgKChBbmkuQWxwaGEgLT0gYWxwaGF0aW1lKSA8PSAwKVxyXG4gICAgICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgICAgIEFsaXZlID0gZmFsc2U7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAvKmlmIChhbHBoYXRpbWUgPiAwKVxyXG4gICAgICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgICAgIGFscGhhIC09IGFscGhhdGltZTtcclxuICAgICAgICAgICAgICAgICAgICBBbmkuQWxwaGEgPSBhbHBoYTtcclxuICAgICAgICAgICAgICAgICAgICBpZiAoYWxwaGEgPD0gMClcclxuICAgICAgICAgICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIEFsaXZlID0gZmFsc2U7XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgZWxzZVxyXG4gICAgICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgICAgIEFsaXZlID0gZmFsc2U7XHJcbiAgICAgICAgICAgICAgICB9Ki9cclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBiYXNlLlVwZGF0ZSgpO1xyXG4gICAgICAgIH1cclxuICAgIH1cclxufVxyXG4iLCJ1c2luZyBTeXN0ZW07XHJcbnVzaW5nIFN5c3RlbS5Db2xsZWN0aW9ucy5HZW5lcmljO1xyXG51c2luZyBTeXN0ZW0uTGlucTtcclxudXNpbmcgU3lzdGVtLlRleHQ7XHJcbnVzaW5nIFN5c3RlbS5UaHJlYWRpbmcuVGFza3M7XHJcblxyXG5uYW1lc3BhY2UgQ2lybm9HYW1lXHJcbntcclxuICAgIHB1YmxpYyBjbGFzcyBQbGF0Zm9ybWVyQ29udHJvbHMgOiBFbnRpdHlCZWhhdmlvclxyXG4gICAge1xyXG4gICAgICAgIFBsYXRmb3JtZXJFbnRpdHkgX3BsYXRmb3JtZXI7XHJcbiAgICAgICAgcHVibGljIGZsb2F0IGFjY2VsID0gMC4zNWY7XHJcbiAgICAgICAgLy9wdWJsaWMgZmxvYXQganVtcFNwZWVkID0gMThmO1xyXG4gICAgICAgIHB1YmxpYyBmbG9hdCBqdW1wU3BlZWQgPSAyLjI1ZjtcclxuICAgICAgICBwdWJsaWMgZmxvYXQgbWF4U3BlZWQgPSAxLjVmO1xyXG4gICAgICAgIHB1YmxpYyBpbnQgbWF4QWlySnVtcHMgPSAxO1xyXG4gICAgICAgIHB1YmxpYyBpbnQgYWlySnVtcHMgPSAwO1xyXG4gICAgICAgIHB1YmxpYyBmbG9hdCBhaXJqdW1wcG93ZXIgPSAwLjgxNWY7XHJcbiAgICAgICAgcHVibGljIFBsYXRmb3JtZXJDb250cm9scyhQbGF0Zm9ybWVyRW50aXR5IGVudGl0eSkgOiBiYXNlKGVudGl0eSlcclxuICAgICAgICB7XHJcbiAgICAgICAgICAgIF9wbGF0Zm9ybWVyID0gZW50aXR5O1xyXG4gICAgICAgIH1cclxuICAgICAgICBwdWJsaWMgb3ZlcnJpZGUgdm9pZCBVcGRhdGUoKVxyXG4gICAgICAgIHtcclxuICAgICAgICAgICAgdmFyIGFnYWluc3R3YWxsID0gZmFsc2U7XHJcbiAgICAgICAgICAgIGJvb2xbXSBjb250cm9sbGVyID0gX3BsYXRmb3JtZXIuQ29udHJvbGxlcjtcclxuICAgICAgICAgICAgdmFyIFggPSAwO1xyXG4gICAgICAgICAgICBpZiAoY29udHJvbGxlclswXSAmJiAhY29udHJvbGxlclsxXSAmJiBfcGxhdGZvcm1lci5Ic3BlZWQgPiAtbWF4U3BlZWQpXHJcbiAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgIF9wbGF0Zm9ybWVyLkhzcGVlZCA9IChmbG9hdClNYXRoLk1heChfcGxhdGZvcm1lci5Ic3BlZWQgLSAoYWNjZWwgKyBfcGxhdGZvcm1lci5mcmljdGlvbiksIC1tYXhTcGVlZCk7XHJcbiAgICAgICAgICAgICAgICBYID0gLTE7XHJcbiAgICAgICAgICAgICAgICBpZiAoX3BsYXRmb3JtZXIuUmlnaHRXYWxsICE9IG51bGwpXHJcbiAgICAgICAgICAgICAgICAgICAgYWdhaW5zdHdhbGwgPSB0cnVlO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIGlmIChjb250cm9sbGVyWzFdICYmICFjb250cm9sbGVyWzBdICYmIF9wbGF0Zm9ybWVyLkhzcGVlZCA8IG1heFNwZWVkKVxyXG4gICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICBfcGxhdGZvcm1lci5Ic3BlZWQgPSAoZmxvYXQpTWF0aC5NaW4oX3BsYXRmb3JtZXIuSHNwZWVkICsgKGFjY2VsICsgX3BsYXRmb3JtZXIuZnJpY3Rpb24pLCBtYXhTcGVlZCk7XHJcbiAgICAgICAgICAgICAgICBYID0gMTtcclxuICAgICAgICAgICAgICAgIGlmIChfcGxhdGZvcm1lci5MZWZ0V2FsbCAhPSBudWxsKVxyXG4gICAgICAgICAgICAgICAgICAgIGFnYWluc3R3YWxsID0gdHJ1ZTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB2YXIganVtcGJ1dHRvbiA9IDU7XHJcbiAgICAgICAgICAgIGlmIChfcGxhdGZvcm1lci5vbkdyb3VuZClcclxuICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgYWlySnVtcHMgPSAwO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIGlmIChfcGxhdGZvcm1lci5Wc3BlZWQgPj0gMCAmJiBfcGxhdGZvcm1lci5vbkdyb3VuZClcclxuICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgaWYgKF9wbGF0Zm9ybWVyLlByZXNzZWQoanVtcGJ1dHRvbikgJiYgX3BsYXRmb3JtZXIub25Hcm91bmQgJiYgX3BsYXRmb3JtZXIuQ2VpbGluZyA9PSBudWxsKVxyXG4gICAgICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgICAgIF9wbGF0Zm9ybWVyLlZzcGVlZCA9IC1qdW1wU3BlZWQ7XHJcbiAgICAgICAgICAgICAgICAgICAgZW50aXR5LlBsYXlTb3VuZChcImp1bXBcIik7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgLyplbHNlIGlmIChfcGxhdGZvcm1lci5QcmVzc2VkKGp1bXBidXR0b24pICYmIF9wbGF0Zm9ybWVyLkNlaWxpbmcgPT0gbnVsbCAmJiBhZ2FpbnN0d2FsbCAmJiBfcGxhdGZvcm1lci5Wc3BlZWQgPj0gMClcclxuICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgLy9wZXJmb3JtIHdhbGwganVtcFxyXG4gICAgICAgICAgICAgICAgX3BsYXRmb3JtZXIuSHNwZWVkID0gWCAqIG1heFNwZWVkO1xyXG4gICAgICAgICAgICAgICAgX3BsYXRmb3JtZXIuVnNwZWVkID0gLShqdW1wU3BlZWQgKiAoKDEgKyBhaXJqdW1wcG93ZXIpIC8gMmYpKTtcclxuICAgICAgICAgICAgfSovXHJcbiAgICAgICAgICAgIGVsc2UgaWYgKGFpckp1bXBzIDwgbWF4QWlySnVtcHMgJiYgX3BsYXRmb3JtZXIuUHJlc3NlZChqdW1wYnV0dG9uKSAmJiBfcGxhdGZvcm1lci5DZWlsaW5nID09IG51bGwpXHJcbiAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgIF9wbGF0Zm9ybWVyLlZzcGVlZCA9IC0oanVtcFNwZWVkICogYWlyanVtcHBvd2VyKTtcclxuICAgICAgICAgICAgICAgIGFpckp1bXBzKys7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgaWYgKF9wbGF0Zm9ybWVyLlZzcGVlZCA8IDAgJiYgIWNvbnRyb2xsZXJbanVtcGJ1dHRvbl0pXHJcbiAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgIF9wbGF0Zm9ybWVyLlZzcGVlZCArPSAoX3BsYXRmb3JtZXIuZ3Jhdml0eSAqIDIpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIGJhc2UuVXBkYXRlKCk7XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG59XHJcbiIsInVzaW5nIFN5c3RlbTtcclxudXNpbmcgU3lzdGVtLkNvbGxlY3Rpb25zLkdlbmVyaWM7XHJcbnVzaW5nIFN5c3RlbS5MaW5xO1xyXG51c2luZyBTeXN0ZW0uVGV4dDtcclxudXNpbmcgU3lzdGVtLlRocmVhZGluZy5UYXNrcztcclxudXNpbmcgQnJpZGdlO1xyXG51c2luZyBCcmlkZ2UuSHRtbDU7XHJcblxyXG5uYW1lc3BhY2UgQ2lybm9HYW1lXHJcbntcclxuICAgIHB1YmxpYyBjbGFzcyBQbGF5ZXJCdWxsZXQgOiBFbnRpdHksIElIYXJtZnVsRW50aXR5LCBJTGlnaHRTb3VyY2VcclxuICAgIHtcclxuICAgICAgICBwdWJsaWMgRW50aXR5IHNob290ZXI7XHJcbiAgICAgICAgcHVibGljIGludCBEdXJhdGlvbiA9IDA7XHJcbiAgICAgICAgcHJvdGVjdGVkIExpc3Q8RW50aXR5PiBoaXRFbnRpdGllcztcclxuICAgICAgICBwdWJsaWMgYm9vbCBwaWVyY2luZztcclxuICAgICAgICBwdWJsaWMgZmxvYXQgc3BpbnJhdGUgPSAwO1xyXG4gICAgICAgIHB1YmxpYyBWZWN0b3IyIEdyYXZpdHkgPSBuZXcgVmVjdG9yMigpO1xyXG4gICAgICAgIHB1YmxpYyBib29sIEJvdW5jZXM7XHJcbiAgICAgICAgcHVibGljIGJvb2wgYXR0YWNrc3RlcnJhaW4gPSBmYWxzZTtcclxuICAgICAgICBwdWJsaWMgZmxvYXQgZGlncG93ZXIgPSAwLjVmO1xyXG4gICAgICAgIHB1YmxpYyBib29sIGlnbm9yZXN0ZXJyYWluID0gZmFsc2U7XHJcbiAgICAgICAgcHVibGljIFBsYXllckJ1bGxldChHYW1lIGdhbWUsIEVudGl0eSBzaG9vdGVyLCBzdHJpbmcgZ3JhcGhpYyA9IFwiUmVpc2VuYnVsbGV0XCIpIDogYmFzZShnYW1lKVxyXG4gICAgICAgIHtcclxuICAgICAgICAgICAgQW5pID0gbmV3IEFuaW1hdGlvbihBbmltYXRpb25Mb2FkZXIuX3RoaXMuR2V0QW5pbWF0aW9uKGdyYXBoaWMpKTtcclxuICAgICAgICAgICAgdGhpcy5zaG9vdGVyID0gc2hvb3RlcjtcclxuXHJcbiAgICAgICAgICAgIC8vQW5pLkh1ZUNvbG9yID0gR2FtZS5HZXRUZWFtQ29sb3IoKChJQ29tYmF0YW50KXNob290ZXIpLlRlYW0pO1xyXG4gICAgICAgICAgICAvLy9BbmkuSHVlQ29sb3IgPSBzaG9vdGVyLkdldFRlYW1Db2xvcigpO1xyXG4gICAgICAgICAgICAvLy9BbmkuSHVlUmVjb2xvclN0cmVuZ3RoID0gMTtcclxuICAgICAgICAgICAgcGllcmNpbmcgPSBmYWxzZTtcclxuXHJcbiAgICAgICAgICAgIGhpdEVudGl0aWVzID0gbmV3IExpc3Q8RW50aXR5PigpO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgcHVibGljIEVudGl0eSBBdHRhY2tlclxyXG4gICAgICAgIHtcclxuICAgICAgICAgICAgZ2V0XHJcbiAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgIHJldHVybiBzaG9vdGVyO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBwdWJsaWMgYm9vbCBJc0hhcm1mdWxcclxuICAgICAgICB7XHJcbiAgICAgICAgICAgIGdldFxyXG4gICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gdHJ1ZTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgcHVibGljIGJvb2wgbGlnaHRGbGlja2VyXHJcbiAgICAgICAge1xyXG4gICAgICAgICAgICBnZXRcclxuICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBwdWJsaWMgVmVjdG9yMiBsaWdodFBvc2l0aW9uXHJcbiAgICAgICAge1xyXG4gICAgICAgICAgICBnZXRcclxuICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuIGdldENlbnRlcigpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBwcm90ZWN0ZWQgZmxvYXQgX21heExpZ2h0UmFkaXVzID0gMS41ZjtcclxuICAgICAgICBwdWJsaWMgZmxvYXQgbWF4TGlnaHRSYWRpdXNcclxuICAgICAgICB7XHJcbiAgICAgICAgICAgIGdldFxyXG4gICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gQW5pLkFscGhhID49IDEgPyBfbWF4TGlnaHRSYWRpdXMgOiAwZjtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBzZXRcclxuICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgX21heExpZ2h0UmFkaXVzID0gdmFsdWU7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcbiAgICAgICAgcHVibGljIG92ZXJyaWRlIFJlY3RhbmdsZSBHZXRIaXRib3goKVxyXG4gICAgICAgIHtcclxuICAgICAgICAgICAgaWYgKEFuaSAhPSBudWxsICYmIEFuaS5DdXJyZW50SW1hZ2UgIT0gbnVsbClcclxuICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgLy9mbG9hdCBzID0gTWF0aC5NYXgoQW5pLkN1cnJlbnRJbWFnZS5XaWR0aCwgQW5pLkN1cnJlbnRJbWFnZS5IZWlnaHQpO1xyXG4gICAgICAgICAgICAgICAgLy9mbG9hdCBzID0gQW5pLkN1cnJlbnRJbWFnZS5IZWlnaHQ7XHJcbiAgICAgICAgICAgICAgICBmbG9hdCBzID0gQW5pLkN1cnJlbnRJbWFnZS5IZWlnaHQgKiAxLjVmO1xyXG4gICAgICAgICAgICAgICAgLy9mbG9hdCBzMiA9IHMgLyAyZjtcclxuICAgICAgICAgICAgICAgIC8vVmVjdG9yMiBWID0gQW5pLlBvc2l0aW9uO1xyXG4gICAgICAgICAgICAgICAgZmxvYXQgc28yID0gcyAvIDI7XHJcbiAgICAgICAgICAgICAgICAvL1ZlY3RvcjIgViA9IGdldENlbnRlcigpIC0gbmV3IFZlY3RvcjIoc28yLHNvMik7XHJcbiAgICAgICAgICAgICAgICBWZWN0b3IyIFYgPSBWZWN0b3IyLlN1YnRyYWN0KGdldENlbnRlcigpLCBzbzIsIHNvMik7XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gbmV3IFJlY3RhbmdsZShWLlgsIFYuWSwgcywgcyk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgcmV0dXJuIG51bGw7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBwcm90ZWN0ZWQgZmxvYXQgX3RvdWNoRGFtYWdlID0gMWY7XHJcbiAgICAgICAgcHVibGljIGZsb2F0IHRvdWNoRGFtYWdlXHJcbiAgICAgICAge1xyXG4gICAgICAgICAgICBnZXRcclxuICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuIF90b3VjaERhbWFnZTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBzZXRcclxuICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgX3RvdWNoRGFtYWdlID0gdmFsdWU7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIHB1YmxpYyBib29sIG9udG91Y2hEYW1hZ2UoSUNvbWJhdGFudCB0YXJnZXQpXHJcbiAgICAgICAge1xyXG4gICAgICAgICAgICBpZiAoIXBpZXJjaW5nKVxyXG4gICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICBBbGl2ZSA9IGZhbHNlO1xyXG4gICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICBib29sIG9rID0gIWhpdEVudGl0aWVzLkNvbnRhaW5zKChFbnRpdHkpdGFyZ2V0KTtcclxuICAgICAgICAgICAgaWYgKG9rKVxyXG4gICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICBoaXRFbnRpdGllcy5BZGQoKEVudGl0eSl0YXJnZXQpO1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuIHRydWU7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgcHVibGljIG92ZXJyaWRlIHZvaWQgVXBkYXRlKClcclxuICAgICAgICB7XHJcbiAgICAgICAgICAgIGJhc2UuVXBkYXRlKCk7XHJcbiAgICAgICAgICAgIGlmIChzcGlucmF0ZSAhPSAwKVxyXG4gICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICBBbmkuUm90YXRpb24gKz0gc3BpbnJhdGU7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgaWYgKEdyYXZpdHkuUm91Z2hMZW5ndGggIT0gMClcclxuICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgU3BlZWQgKz0gR3Jhdml0eTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAvL2lmICghQXBwLnNjcmVlbmJvdW5kcy5pc1RvdWNoaW5nKEdldEhpdGJveCgpKSlcclxuXHJcbiAgICAgICAgICAgIC8vaWYgKCFHYW1lLnN0YWdlQm91bmRzLmlzVG91Y2hpbmcoR2V0SGl0Ym94KCkpKVxyXG4gICAgICAgICAgICBpZiAoIUdhbWUuc3RhZ2VCb3VuZHMuY29udGFpbnNQb2ludChQb3NpdGlvbikpXHJcbiAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgIGlmICgoQW5pLlggPiAwID09IEhzcGVlZCA+IDAgfHwgQW5pLlggPCAwID09IEhzcGVlZCA8IDApIHx8IChBbmkuWSA+IDAgPT0gVnNwZWVkID4gMCB8fCBBbmkuWSA8IDAgPT0gVnNwZWVkIDwgMCkpXHJcbiAgICAgICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICAgICAgQWxpdmUgPSBmYWxzZTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAvL1ZlY3RvcjIgY2VudGVyID0gZ2V0Q2VudGVyKCk7XHJcbiAgICAgICAgICAgIFZlY3RvcjIgY2VudGVyID0gVmVjdG9yMi5BZGQoUG9zaXRpb24sIDgsIDApO1xyXG4gICAgICAgICAgICBpZiAoIWlnbm9yZXN0ZXJyYWluKVxyXG4gICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICBUaWxlRGF0YSBUID0gbnVsbDtcclxuICAgICAgICAgICAgICAgIGlmICghQm91bmNlcylcclxuICAgICAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgICAgICBUID0gR2FtZS5UTS5DaGVja0ZvclRpbGUobmV3IFZlY3RvcjIoY2VudGVyLlgsIHkpKTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIGlmIChUICE9IG51bGwgJiYgVC5lbmFibGVkICYmIFQuc29saWQpXHJcbiAgICAgICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKGF0dGFja3N0ZXJyYWluKVxyXG4gICAgICAgICAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKFQuQnJlYWthYmxlKVxyXG4gICAgICAgICAgICAgICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAvL1QuRGFtYWdlKF90b3VjaERhbWFnZSAqIGRpZ3Bvd2VyKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChULkRhbWFnZShkaWdwb3dlcikpXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgUGxheVNvdW5kKFwidGh1bms0XCIpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgZWxzZVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIFBsYXlTb3VuZChcInRodW5rXCIpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGVsc2VcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIFBsYXlTb3VuZChcInBsaW5rXCIpO1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICBBbGl2ZSA9IGZhbHNlO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgZWxzZSBpZiAoQm91bmNlcylcclxuICAgICAgICAgICAgICAgIHtcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgVCA9IEdhbWUuVE0uQ2hlY2tGb3JUaWxlKGNlbnRlciArIG5ldyBWZWN0b3IyKFNwZWVkLlgpKTtcclxuICAgICAgICAgICAgICAgICAgICBpZiAoVCAhPSBudWxsICYmIFQuZW5hYmxlZCAmJiBULnNvbGlkVG9TcGVlZChTcGVlZC5Ub0NhcmRpbmFsKCkpKVxyXG4gICAgICAgICAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgU3BlZWQuWCA9IC1TcGVlZC5YO1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgICAgICAgICAgVCA9IEdhbWUuVE0uQ2hlY2tGb3JUaWxlKGNlbnRlciArIG5ldyBWZWN0b3IyKDAsIFNwZWVkLlkpKTtcclxuICAgICAgICAgICAgICAgICAgICBpZiAoVCAhPSBudWxsICYmIFQuZW5hYmxlZCAmJiBULnNvbGlkVG9TcGVlZChTcGVlZC5Ub0NhcmRpbmFsKCkpKVxyXG4gICAgICAgICAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgU3BlZWQuWSA9IC1TcGVlZC5ZO1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgICAgICAgICAgVCA9IEdhbWUuVE0uQ2hlY2tGb3JUaWxlKGNlbnRlciArIFNwZWVkKTtcclxuICAgICAgICAgICAgICAgICAgICBpZiAoVCAhPSBudWxsICYmIFQuZW5hYmxlZCAmJiBULnNvbGlkVG9TcGVlZChTcGVlZC5Ub0NhcmRpbmFsKCkpKVxyXG4gICAgICAgICAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgU3BlZWQuWCA9IC1TcGVlZC5YO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBTcGVlZC5ZID0gLVNwZWVkLlk7XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIGlmIChEdXJhdGlvbiA+IDApXHJcbiAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgIER1cmF0aW9uLS07XHJcbiAgICAgICAgICAgICAgICBpZiAoRHVyYXRpb24gPD0gMClcclxuICAgICAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgICAgICBEdXJhdGlvbiA9IDE7XHJcbiAgICAgICAgICAgICAgICAgICAgQW5pLkFscGhhIC09IDAuMmY7XHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKEFuaS5BbHBoYSA8PSAwKVxyXG4gICAgICAgICAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgQWxpdmUgPSBmYWxzZTtcclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcbiAgICB9XHJcbn1cclxuIiwidXNpbmcgU3lzdGVtO1xyXG51c2luZyBTeXN0ZW0uQ29sbGVjdGlvbnMuR2VuZXJpYztcclxudXNpbmcgU3lzdGVtLkxpbnE7XHJcbnVzaW5nIFN5c3RlbS5UZXh0O1xyXG51c2luZyBTeXN0ZW0uVGhyZWFkaW5nLlRhc2tzO1xyXG5cclxubmFtZXNwYWNlIENpcm5vR2FtZVxyXG57XHJcbiAgICBwdWJsaWMgY2xhc3MgUmFuZG9tQUkgOiBFbnRpdHlCZWhhdmlvclxyXG4gICAge1xyXG4gICAgICAgIENvbnRyb2xsYWJsZUVudGl0eSBDRTtcclxuICAgICAgICBwdWJsaWMgUmFuZG9tQUkoQ29udHJvbGxhYmxlRW50aXR5IGVudGl0eSkgOiBiYXNlKGVudGl0eSlcclxuICAgICAgICB7XHJcbiAgICAgICAgICAgIENFID0gZW50aXR5O1xyXG4gICAgICAgICAgICB0aGlzLkZyYW1lc1BlclRpY2sgPSAxNTtcclxuICAgICAgICB9XHJcbiAgICAgICAgcHVibGljIG92ZXJyaWRlIHZvaWQgVXBkYXRlKClcclxuICAgICAgICB7XHJcbiAgICAgICAgICAgIGJhc2UuVXBkYXRlKCk7XHJcbiAgICAgICAgICAgIGlmIChNYXRoLlJhbmRvbSgpIDwgMC4xKVxyXG4gICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICB2YXIgQ29udHJvbGxlciA9IENFLkNvbnRyb2xsZXI7XHJcbiAgICAgICAgICAgICAgICBDb250cm9sbGVyWzBdID0gZmFsc2U7XHJcbiAgICAgICAgICAgICAgICBDb250cm9sbGVyWzFdID0gZmFsc2U7XHJcbiAgICAgICAgICAgICAgICBDb250cm9sbGVyWzJdID0gZmFsc2U7XHJcbiAgICAgICAgICAgICAgICBDb250cm9sbGVyWzNdID0gZmFsc2U7XHJcblxyXG4gICAgICAgICAgICAgICAgaWYgKE1hdGguUmFuZG9tKCkgPCAwLjUpXHJcbiAgICAgICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICAgICAgQ29udHJvbGxlclswXSA9IE1hdGguUmFuZG9tKCkgPCAwLjU7XHJcbiAgICAgICAgICAgICAgICAgICAgQ29udHJvbGxlclsxXSA9ICFDb250cm9sbGVyWzBdO1xyXG4gICAgICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgICAgIGlmIChNYXRoLlJhbmRvbSgpIDwgMC41KVxyXG4gICAgICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgICAgIENvbnRyb2xsZXJbMl0gPSBNYXRoLlJhbmRvbSgpIDwgMC41O1xyXG4gICAgICAgICAgICAgICAgICAgIENvbnRyb2xsZXJbM10gPSAhQ29udHJvbGxlclsyXTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuICAgIH1cclxufVxyXG4iLCJ1c2luZyBTeXN0ZW07XHJcbnVzaW5nIFN5c3RlbS5Db2xsZWN0aW9ucy5HZW5lcmljO1xyXG51c2luZyBTeXN0ZW0uTGlucTtcclxudXNpbmcgU3lzdGVtLlRleHQ7XHJcbnVzaW5nIFN5c3RlbS5UaHJlYWRpbmcuVGFza3M7XHJcblxyXG5uYW1lc3BhY2UgQ2lybm9HYW1lXHJcbntcclxuICAgIHB1YmxpYyBjbGFzcyBSb29tT3BlbmluZ0xldmVyIDogRW50aXR5XHJcbiAgICB7XHJcbiAgICAgICAgcHVibGljIHN0YXRpYyBSb29tT3BlbmluZ0xldmVyIFRFU1Q7XHJcbiAgICAgICAgcHVibGljIFJvb21PcGVuaW5nTGV2ZXIoR2FtZSBnYW1lLCBQb2ludCBUaWxlLCBNYXBSb29tIFRhcmdldCwgYm9vbCBmbGlwcGVkPWZhbHNlKSA6IGJhc2UoZ2FtZSlcclxuICAgICAgICB7XHJcbiAgICAgICAgICAgIEFuaSA9IG5ldyBBbmltYXRpb24oQW5pbWF0aW9uTG9hZGVyLl90aGlzLkdldEFuaW1hdGlvbihcImltYWdlcy9taXNjL2xldmVyXCIpKTtcclxuICAgICAgICAgICAgQW5pLkltYWdlU3BlZWQgPSAwO1xyXG4gICAgICAgICAgICBCbG9jayA9IFRpbGU7XHJcbiAgICAgICAgICAgIHZhciBUID0gZ2FtZS5UTS5HZXRUaWxlKFRpbGUuWCwgVGlsZS5ZKTtcclxuICAgICAgICAgICAgVEVTVCA9IHRoaXM7XHJcbiAgICAgICAgICAgIGlmIChUICE9IG51bGwgJiYgVC5zb2xpZClcclxuICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgaWYgKFRhcmdldCAhPSBudWxsKVxyXG4gICAgICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgICAgIHRoaXMuUm9vbSA9IFRhcmdldDtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIFQuQnJlYWthYmxlID0gZmFsc2U7XHJcbiAgICAgICAgICAgICAgICBULkNhblNsb3BlID0gZmFsc2U7XHJcbiAgICAgICAgICAgICAgICB2YXIgUiA9IFQuR2V0SGl0Ym94KCk7XHJcbiAgICAgICAgICAgICAgICBpZiAoZmxpcHBlZClcclxuICAgICAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgICAgICBBbmkuUG9zaXRpb24uWCA9IFIubGVmdCAtIDE2O1xyXG4gICAgICAgICAgICAgICAgICAgIEFuaS5GbGlwcGVkID0gdHJ1ZTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIGVsc2VcclxuICAgICAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgICAgICBBbmkuUG9zaXRpb24uWCA9IFIucmlnaHQ7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICBBbmkuUG9zaXRpb24uWSA9IFIudG9wO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIGVsc2VcclxuICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgQWxpdmUgPSBmYWxzZTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuICAgICAgICBwdWJsaWMgTWFwUm9vbSBSb29tO1xyXG4gICAgICAgIHB1YmxpYyBQb2ludCBCbG9jaztcclxuICAgICAgICBwdWJsaWMgYm9vbCBBY3RpdmF0ZWQgeyBnZXQ7IHByaXZhdGUgc2V0OyB9XHJcbiAgICAgICAgcHVibGljIG92ZXJyaWRlIHZvaWQgVXBkYXRlKClcclxuICAgICAgICB7XHJcbiAgICAgICAgICAgIGJhc2UuVXBkYXRlKCk7XHJcbiAgICAgICAgICAgIHZhciBUID0gR2FtZS5UTS5HZXRUaWxlKEJsb2NrLlgsIEJsb2NrLlgpO1xyXG4gICAgICAgICAgICBpZiAoVCAhPSBudWxsICYmIFQuZW5hYmxlZCAmJiBULnNvbGlkKVxyXG4gICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICBULkJyZWFrYWJsZSA9IGZhbHNlO1xyXG4gICAgICAgICAgICAgICAgVC5DYW5TbG9wZSA9IGZhbHNlO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIGVsc2VcclxuICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgQWxpdmUgPSBmYWxzZTtcclxuICAgICAgICAgICAgICAgIGlmIChSb29tICE9IG51bGwpXHJcbiAgICAgICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICAgICAgUm9vbS5DbGVhclJvb20oKTtcclxuICAgICAgICAgICAgICAgICAgICBSb29tLkdlbmVyYXRlUGxhdGZvcm1zKCk7XHJcbiAgICAgICAgICAgICAgICAgICAgUm9vbS5BcHBseUJyZWFrYWJsZSgpOy8vYXR0ZW1wdCB0byByZW1vdmUgc2VhbXNcclxuICAgICAgICAgICAgICAgICAgICBSb29tLkZvcmNlUmVkcmF3KCk7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAvL0hlbHBlci5Mb2coXCJSZW1vdmluZyBicm9rZW4gbGV2ZXIuLi5cIik7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgdmFyIFAgPSAoUGxheWVyQ2hhcmFjdGVyKUdhbWUucGxheWVyO1xyXG4gICAgICAgICAgICBpZiAoIUFjdGl2YXRlZCAmJiBQLlBvc2l0aW9uLkVzdGltYXRlZERpc3RhbmNlKFBvc2l0aW9uKSA8IDE2ICYmIFAuQ29udHJvbGxlclsyXSlcclxuICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgQWN0aXZhdGUoKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuICAgICAgICBwdWJsaWMgdm9pZCBBY3RpdmF0ZSgpXHJcbiAgICAgICAge1xyXG4gICAgICAgICAgICBpZiAoIUFjdGl2YXRlZClcclxuICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgQWN0aXZhdGVkID0gdHJ1ZTtcclxuICAgICAgICAgICAgICAgIFBsYXlTb3VuZChcIm9wZW4yXCIpOy8vc291bmRzIGJldHRlciB0aGFuIHRoZSBlbGVjdHJvbmljIHN3aXRjaC5cclxuICAgICAgICAgICAgICAgIEFuaS5DdXJyZW50RnJhbWUgPSAxO1xyXG4gICAgICAgICAgICAgICAgQW5pLlNldEltYWdlKCk7XHJcbiAgICAgICAgICAgICAgICBBbmkuVXBkYXRlKCk7XHJcbiAgICAgICAgICAgICAgICBSb29tLlVubGVhc2hTZWNyZXQoKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuICAgICAgICBwdWJsaWMgc3RhdGljIFJvb21PcGVuaW5nTGV2ZXIgRmluZEFuZFBsYWNlT25XYWxsKEdhbWUgZ2FtZSxWZWN0b3IyIFAsIE1hcFJvb20gVGFyZ2V0KVxyXG4gICAgICAgIHtcclxuICAgICAgICAgICAgdmFyIFQgPSBnYW1lLlRNLkNoZWNrRm9yVGlsZShQKTtcclxuICAgICAgICAgICAgaWYgKFQgIT0gbnVsbClcclxuICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgdmFyIFggPSBULmNvbHVtbjtcclxuICAgICAgICAgICAgICAgIHZhciBZID0gVC5yb3c7XHJcblxyXG4gICAgICAgICAgICAgICAgdmFyIFhEID0gTWF0aC5SYW5kb20oKSA8IDAuNSA/IC0xIDogMTtcclxuICAgICAgICAgICAgICAgIHdoaWxlICh0cnVlKVxyXG4gICAgICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgICAgIFggKz0gWEQ7XHJcbiAgICAgICAgICAgICAgICAgICAgdmFyIFQyID0gZ2FtZS5UTS5HZXRUaWxlKFgsIFkpO1xyXG4gICAgICAgICAgICAgICAgICAgIGlmIChUMiAhPSBudWxsKVxyXG4gICAgICAgICAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKFQyLmVuYWJsZWQgJiYgVDIuc29saWQpXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhciBUMyA9IGdhbWUuVE0uR2V0VGlsZShYLVhELCBZKzEpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKCEoVDMgIT0gbnVsbCAmJiBUMy5lbmFibGVkICYmIFQzLnNvbGlkKSkvL3RvbyBjbG9zZSB0byB0aGUgZmxvb3IsIHRoZSBsZXZlciBjb3VsZCBiZWNvbWUgb2JzY3VyZWQuLi5cclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgcmV0ID0gbmV3IFJvb21PcGVuaW5nTGV2ZXIoZ2FtZSwgbmV3IFBvaW50KFgsIFkpLCBUYXJnZXQsIFhEID09IDEpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiByZXQuQWxpdmUgPyByZXQgOiBudWxsO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgZWxzZVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBudWxsO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgIGVsc2VcclxuICAgICAgICAgICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBudWxsO1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICByZXR1cm4gbnVsbDtcclxuICAgICAgICB9XHJcbiAgICB9XHJcbn1cclxuIiwidXNpbmcgU3lzdGVtO1xyXG51c2luZyBTeXN0ZW0uQ29sbGVjdGlvbnMuR2VuZXJpYztcclxudXNpbmcgU3lzdGVtLkxpbnE7XHJcbnVzaW5nIFN5c3RlbS5UZXh0O1xyXG51c2luZyBTeXN0ZW0uVGhyZWFkaW5nLlRhc2tzO1xyXG51c2luZyBCcmlkZ2U7XHJcbnVzaW5nIEJyaWRnZS5IdG1sNTtcclxuXHJcbm5hbWVzcGFjZSBDaXJub0dhbWVcclxue1xyXG4gICAgcHVibGljIGNsYXNzIFRleHRTcHJpdGUgOiBTcHJpdGVcclxuICAgIHtcclxuICAgICAgICBwcm90ZWN0ZWQgc3RyaW5nIF9UZXh0O1xyXG4gICAgICAgIHB1YmxpYyBzdHJpbmcgVGV4dFxyXG4gICAgICAgIHtcclxuICAgICAgICAgICAgZ2V0XHJcbiAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgIHJldHVybiBfVGV4dDtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBzZXRcclxuICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgaWYgKF9UZXh0ICE9IHZhbHVlKVxyXG4gICAgICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgICAgIF9UZXh0ID0gdmFsdWU7XHJcbiAgICAgICAgICAgICAgICAgICAgLypSZWRyYXdCYXNlVGV4dEltYWdlKCk7XHJcbiAgICAgICAgICAgICAgICAgICAgUmVuZGVyVGV4dEltYWdlKCk7Ki9cclxuICAgICAgICAgICAgICAgICAgICB0ZXh0SW52YWxsaWRhdGVkID0gdHJ1ZTtcclxuICAgICAgICAgICAgICAgICAgICAvL2ltYWdlSW52YWxsaWRhdGVkID0gdHJ1ZTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuICAgICAgICBwcm90ZWN0ZWQgYm9vbCB0ZXh0SW52YWxsaWRhdGVkO1xyXG4gICAgICAgIHByb3RlY3RlZCBib29sIGltYWdlSW52YWxsaWRhdGVkO1xyXG5cclxuICAgICAgICBwcm90ZWN0ZWQgSFRNTENhbnZhc0VsZW1lbnQgVGV4dEltYWdlO1xyXG4gICAgICAgIHByb3RlY3RlZCBDYW52YXNSZW5kZXJpbmdDb250ZXh0MkQgVGV4dEdyYXBoaWM7XHJcbiAgICAgICAgcHJvdGVjdGVkIHN0cmluZyBfVGV4dENvbG9yO1xyXG4gICAgICAgIHB1YmxpYyBzdHJpbmcgVGV4dENvbG9yXHJcbiAgICAgICAge1xyXG4gICAgICAgICAgICBnZXRcclxuICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuIF9UZXh0Q29sb3I7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgc2V0XHJcbiAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgIGlmIChfVGV4dENvbG9yICE9IHZhbHVlKVxyXG4gICAgICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgICAgIF9UZXh0Q29sb3IgPSB2YWx1ZTtcclxuICAgICAgICAgICAgICAgICAgICAvL1JlbmRlclRleHRJbWFnZSgpO1xyXG4gICAgICAgICAgICAgICAgICAgIHRleHRJbnZhbGxpZGF0ZWQgPSB0cnVlO1xyXG5cclxuICAgICAgICAgICAgICAgICAgICAvL2ltYWdlSW52YWxsaWRhdGVkID0gdHJ1ZTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgcHJvdGVjdGVkIHN0cmluZyBfRm9udFdlaWdodCA9IFwibm9ybWFsXCI7XHJcbiAgICAgICAgcHVibGljIHN0cmluZyBGb250V2VpZ2h0XHJcbiAgICAgICAge1xyXG4gICAgICAgICAgICBnZXRcclxuICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuIF9Gb250V2VpZ2h0O1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIHNldFxyXG4gICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICBpZiAoX0ZvbnRXZWlnaHQgIT0gdmFsdWUpXHJcbiAgICAgICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICAgICAgX0ZvbnRXZWlnaHQgPSB2YWx1ZTtcclxuICAgICAgICAgICAgICAgICAgICBVcGRhdGVGb250KCk7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIHByb3RlY3RlZCBzdHJpbmcgX0ZvbnRGYW1pbHkgPSBcInNhbnMtc2VyaWZcIjtcclxuICAgICAgICBwdWJsaWMgc3RyaW5nIEZvbnRGYW1pbHlcclxuICAgICAgICB7XHJcbiAgICAgICAgICAgIGdldFxyXG4gICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gX0ZvbnRGYW1pbHk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgc2V0XHJcbiAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgIGlmIChfRm9udEZhbWlseSAhPSB2YWx1ZSlcclxuICAgICAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgICAgICBfRm9udEZhbWlseSA9IHZhbHVlO1xyXG4gICAgICAgICAgICAgICAgICAgIFVwZGF0ZUZvbnQoKTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgcHJvdGVjdGVkIGludCBfRm9udFNpemUgPSAxMDtcclxuICAgICAgICBwdWJsaWMgaW50IEZvbnRTaXplXHJcbiAgICAgICAge1xyXG4gICAgICAgICAgICBnZXRcclxuICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuIF9Gb250U2l6ZTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBzZXRcclxuICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgaWYgKF9Gb250U2l6ZSAhPSB2YWx1ZSlcclxuICAgICAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgICAgICBfRm9udFNpemUgPSB2YWx1ZTtcclxuICAgICAgICAgICAgICAgICAgICBVcGRhdGVGb250KCk7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIHByb3RlY3RlZCBmbG9hdCBfc2hhZG93Qmx1ciA9IDBmO1xyXG4gICAgICAgIHB1YmxpYyBmbG9hdCBTaGFkb3dCbHVyXHJcbiAgICAgICAge1xyXG4gICAgICAgICAgICBnZXRcclxuICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuIF9zaGFkb3dCbHVyO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIHNldFxyXG4gICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICBpZiAoX3NoYWRvd0JsdXIgIT0gdmFsdWUpXHJcbiAgICAgICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICAgICAgX3NoYWRvd0JsdXIgPSB2YWx1ZTtcclxuICAgICAgICAgICAgICAgICAgICBpbWFnZUludmFsbGlkYXRlZCA9IHRydWU7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcbiAgICAgICAgcHJvdGVjdGVkIFZlY3RvcjIgX3NoYWRvd09mZnNldCA9IG5ldyBWZWN0b3IyKCk7XHJcbiAgICAgICAgcHVibGljIFZlY3RvcjIgU2hhZG93T2Zmc2V0XHJcbiAgICAgICAge1xyXG4gICAgICAgICAgICBnZXRcclxuICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuIF9zaGFkb3dPZmZzZXQuQ2xvbmUoKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBzZXRcclxuICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgaWYgKF9zaGFkb3dPZmZzZXQgIT0gdmFsdWUgJiYgdmFsdWUuWCAhPSBfc2hhZG93T2Zmc2V0LlggJiYgdmFsdWUuWSAhPSBfc2hhZG93T2Zmc2V0LlkpXHJcbiAgICAgICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICAgICAgX3NoYWRvd09mZnNldCA9IHZhbHVlLkNsb25lKCk7XHJcbiAgICAgICAgICAgICAgICAgICAgaW1hZ2VJbnZhbGxpZGF0ZWQgPSB0cnVlO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHByb3RlY3RlZCBzdHJpbmcgX3NoYWRvd0NvbG9yID0gXCIjMDAwMDAwXCI7XHJcbiAgICAgICAgcHVibGljIHN0cmluZyBTaGFkb3dDb2xvclxyXG4gICAgICAgIHtcclxuICAgICAgICAgICAgZ2V0XHJcbiAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgIHJldHVybiBfc2hhZG93Q29sb3I7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgc2V0XHJcbiAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgIGlmIChfc2hhZG93Q29sb3IgIT0gdmFsdWUpXHJcbiAgICAgICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICAgICAgX3NoYWRvd0NvbG9yID0gdmFsdWU7XHJcbiAgICAgICAgICAgICAgICAgICAgaW1hZ2VJbnZhbGxpZGF0ZWQgPSB0cnVlO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBwcm90ZWN0ZWQgdm9pZCBVcGRhdGVGb250KClcclxuICAgICAgICB7XHJcbiAgICAgICAgICAgIFRleHRHcmFwaGljLkZvbnQgPSBfRm9udFdlaWdodCArIFwiIFwiICsgX0ZvbnRTaXplICsgXCJweCBcIiArIF9Gb250RmFtaWx5O1xyXG4gICAgICAgICAgICB0ZXh0SW52YWxsaWRhdGVkID0gdHJ1ZTtcclxuICAgICAgICAgICAgaW1hZ2VJbnZhbGxpZGF0ZWQgPSB0cnVlO1xyXG4gICAgICAgICAgICBUZXh0R3JhcGhpYy5GaWxsU3R5bGUgPSBfVGV4dENvbG9yO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgLypwcm90ZWN0ZWQgc3RyaW5nIEZvbnRcclxuICAgICAgICB7XHJcbiAgICAgICAgICAgIGdldFxyXG4gICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gVGV4dEdyYXBoaWMuRm9udDtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBzZXRcclxuICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgaWYgKFRleHRHcmFwaGljLkZvbnQgIT0gdmFsdWUpXHJcbiAgICAgICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICAgICAgVGV4dEdyYXBoaWMuRm9udCA9IHZhbHVlO1xyXG4gICAgICAgICAgICAgICAgICAgIHRleHRJbnZhbGxpZGF0ZWQgPSB0cnVlO1xyXG4gICAgICAgICAgICAgICAgICAgIGltYWdlSW52YWxsaWRhdGVkID0gdHJ1ZTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIFxyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfSovXHJcbiAgICAgICAgcHVibGljIFRleHRTcHJpdGUoKVxyXG4gICAgICAgIHtcclxuICAgICAgICAgICAgVGV4dEltYWdlID0gbmV3IEhUTUxDYW52YXNFbGVtZW50KCk7XHJcbiAgICAgICAgICAgIFRleHRHcmFwaGljID0gVGV4dEltYWdlLkdldENvbnRleHQoQ2FudmFzVHlwZXMuQ2FudmFzQ29udGV4dDJEVHlwZS5DYW52YXNSZW5kZXJpbmdDb250ZXh0MkQpO1xyXG4gICAgICAgICAgICBUZXh0R3JhcGhpYy5JbWFnZVNtb290aGluZ0VuYWJsZWQgPSBmYWxzZTtcclxuICAgICAgICAgICAgLy9UZXh0R3JhcGhpYy5Gb250LlxyXG4gICAgICAgICAgICBUZXh0SW1hZ2UuU3R5bGUuSW1hZ2VSZW5kZXJpbmcgPSBJbWFnZVJlbmRlcmluZy5QaXhlbGF0ZWQ7XHJcbiAgICAgICAgICAgIFRleHRHcmFwaGljLkZpbGxTdHlsZSA9IFwiI0ZGRkZGRlwiO1xyXG4gICAgICAgIH1cclxuICAgICAgICBwcm90ZWN0ZWQgdm9pZCBSZWRyYXdCYXNlVGV4dEltYWdlKClcclxuICAgICAgICB7XHJcbiAgICAgICAgICAgIFVwZGF0ZUZvbnQoKTtcclxuICAgICAgICAgICAgc3RyaW5nW10gbGluZXMgPSBfVGV4dC5TcGxpdCgnXFxuJyk7XHJcbiAgICAgICAgICAgIGZsb2F0IEggPSBGb250U2l6ZSAqIDFmO1xyXG5cclxuXHJcbiAgICAgICAgICAgIGludCBXID0gMDtcclxuICAgICAgICAgICAgaW50IGkgPSAwO1xyXG4gICAgICAgICAgICB3aGlsZSAoaSA8IGxpbmVzLkxlbmd0aClcclxuICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgVGV4dE1ldHJpY3MgVE0gPSBUZXh0R3JhcGhpYy5NZWFzdXJlVGV4dChsaW5lc1tpXSk7XHJcbiAgICAgICAgICAgICAgICBXID0gTWF0aC5NYXgoVywgKGludClNYXRoLkNlaWxpbmcoVE0uV2lkdGgpKTtcclxuICAgICAgICAgICAgICAgIGkrKztcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAvL1RleHRJbWFnZS5IZWlnaHQgPSAoaW50KShIICogKGxpbmVzLkxlbmd0aCswLjVmKSk7XHJcbiAgICAgICAgICAgIFRleHRJbWFnZS5IZWlnaHQgPSAoaW50KShIICogKGxpbmVzLkxlbmd0aCArIDAuMjVmKSk7XHJcbiAgICAgICAgICAgIFRleHRJbWFnZS5XaWR0aCA9IFc7XHJcbiAgICAgICAgICAgIFVwZGF0ZUZvbnQoKTtcclxuXHJcbiAgICAgICAgICAgIGZsb2F0IFkgPSAwO1xyXG4gICAgICAgICAgICBpID0gMDtcclxuICAgICAgICAgICAgd2hpbGUgKGkgPCBsaW5lcy5MZW5ndGgpXHJcbiAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgIFRleHRHcmFwaGljLkZpbGxUZXh0KGxpbmVzW2ldLCAwLCAoaW50KShGb250U2l6ZSArIFkpKTtcclxuICAgICAgICAgICAgICAgIFkgKz0gSDtcclxuICAgICAgICAgICAgICAgIGkrKztcclxuICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgdGV4dEludmFsbGlkYXRlZCA9IGZhbHNlO1xyXG4gICAgICAgICAgICBpbWFnZUludmFsbGlkYXRlZCA9IHRydWU7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHByb3RlY3RlZCB2b2lkIFJlbmRlclRleHRJbWFnZSgpXHJcbiAgICAgICAge1xyXG5cclxuICAgICAgICAgICAgaWYgKF9zaGFkb3dCbHVyIDw9IDApXHJcbiAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgIHNwcml0ZUJ1ZmZlci5XaWR0aCA9IFRleHRJbWFnZS5XaWR0aDtcclxuICAgICAgICAgICAgICAgIHNwcml0ZUJ1ZmZlci5IZWlnaHQgPSBUZXh0SW1hZ2UuSGVpZ2h0O1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIGVsc2VcclxuICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgaW50IFMgPSAoaW50KU1hdGguQ2VpbGluZyhfc2hhZG93Qmx1ciArIF9zaGFkb3dCbHVyKTtcclxuICAgICAgICAgICAgICAgIHNwcml0ZUJ1ZmZlci5XaWR0aCA9IFRleHRJbWFnZS5XaWR0aCArIFM7XHJcbiAgICAgICAgICAgICAgICBzcHJpdGVCdWZmZXIuSGVpZ2h0ID0gVGV4dEltYWdlLkhlaWdodCArIFM7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgc3ByaXRlR3JhcGhpY3MuU2hhZG93Qmx1ciA9IDA7XHJcblxyXG4gICAgICAgICAgICBzcHJpdGVHcmFwaGljcy5HbG9iYWxDb21wb3NpdGVPcGVyYXRpb24gPSBDYW52YXNUeXBlcy5DYW52YXNDb21wb3NpdGVPcGVyYXRpb25UeXBlLlNvdXJjZU92ZXI7XHJcbiAgICAgICAgICAgIC8qc3ByaXRlR3JhcGhpY3MuRmlsbFN0eWxlID0gX1RleHRDb2xvcjtcclxuICAgICAgICAgICAgc3ByaXRlR3JhcGhpY3MuRmlsbFJlY3QoMCwgMCwgc3ByaXRlQnVmZmVyLldpZHRoLCBzcHJpdGVCdWZmZXIuSGVpZ2h0KTtcclxuICAgICAgICAgICAgU2NyaXB0LldyaXRlKFwidGhpcy5zcHJpdGVHcmFwaGljcy5nbG9iYWxDb21wb3NpdGVPcGVyYXRpb24gPSAnZGVzdGluYXRpb24taW4nXCIpOyovXHJcbiAgICAgICAgICAgIGlmIChUZXh0SW1hZ2UuV2lkdGggPD0gMClcclxuICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgaW1hZ2VJbnZhbGxpZGF0ZWQgPSBmYWxzZTtcclxuICAgICAgICAgICAgICAgIHJldHVybjtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBpZiAoX3NoYWRvd0JsdXIgPD0gMClcclxuICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgc3ByaXRlR3JhcGhpY3MuRHJhd0ltYWdlKFRleHRJbWFnZSwgMGYsIDBmKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBlbHNlXHJcbiAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgIHNwcml0ZUdyYXBoaWNzLkRyYXdJbWFnZShUZXh0SW1hZ2UsIF9zaGFkb3dCbHVyLCBfc2hhZG93Qmx1cik7XHJcbiAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgIGlmIChfc2hhZG93Qmx1ciA+IDApXHJcbiAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgIC8vL3Nwcml0ZUdyYXBoaWNzLkdsb2JhbENvbXBvc2l0ZU9wZXJhdGlvbiA9IENhbnZhc1R5cGVzLkNhbnZhc0NvbXBvc2l0ZU9wZXJhdGlvblR5cGUuU291cmNlT3ZlcjtcclxuICAgICAgICAgICAgICAgIHNwcml0ZUdyYXBoaWNzLlNoYWRvd0JsdXIgPSBfc2hhZG93Qmx1cjtcclxuICAgICAgICAgICAgICAgIHNwcml0ZUdyYXBoaWNzLlNoYWRvd0NvbG9yID0gX3NoYWRvd0NvbG9yO1xyXG4gICAgICAgICAgICAgICAgc3ByaXRlR3JhcGhpY3MuU2hhZG93T2Zmc2V0WCA9IF9zaGFkb3dPZmZzZXQuWDtcclxuICAgICAgICAgICAgICAgIHNwcml0ZUdyYXBoaWNzLlNoYWRvd09mZnNldFkgPSBfc2hhZG93T2Zmc2V0Llk7XHJcbiAgICAgICAgICAgICAgICBzcHJpdGVHcmFwaGljcy5EcmF3SW1hZ2Uoc3ByaXRlQnVmZmVyLCAwZiwgMGYpO1xyXG4gICAgICAgICAgICB9XHJcblxyXG5cclxuXHJcbiAgICAgICAgICAgIGltYWdlSW52YWxsaWRhdGVkID0gZmFsc2U7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHB1YmxpYyB2b2lkIEZvcmNlVXBkYXRlKClcclxuICAgICAgICB7XHJcbiAgICAgICAgICAgIGlmICh0ZXh0SW52YWxsaWRhdGVkKVxyXG4gICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICBSZWRyYXdCYXNlVGV4dEltYWdlKCk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgaWYgKGltYWdlSW52YWxsaWRhdGVkKVxyXG4gICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICBSZW5kZXJUZXh0SW1hZ2UoKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuICAgICAgICBwdWJsaWMgb3ZlcnJpZGUgdm9pZCBEcmF3KENhbnZhc1JlbmRlcmluZ0NvbnRleHQyRCBnKVxyXG4gICAgICAgIHtcclxuICAgICAgICAgICAgRm9yY2VVcGRhdGUoKTtcclxuICAgICAgICAgICAgYmFzZS5EcmF3KGcpO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICB9XHJcbn1cclxuIiwidXNpbmcgU3lzdGVtO1xyXG51c2luZyBTeXN0ZW0uQ29sbGVjdGlvbnMuR2VuZXJpYztcclxudXNpbmcgU3lzdGVtLkxpbnE7XHJcbnVzaW5nIFN5c3RlbS5UZXh0O1xyXG51c2luZyBTeXN0ZW0uVGhyZWFkaW5nLlRhc2tzO1xyXG51c2luZyBCcmlkZ2UuSHRtbDU7XHJcblxyXG5uYW1lc3BhY2UgQ2lybm9HYW1lXHJcbntcclxuICAgIHB1YmxpYyBjbGFzcyBUaWxlIDogRW50aXR5XHJcbiAgICB7XHJcbiAgICAgICAgcHVibGljIGludCB0aWxlO1xyXG4gICAgICAgIHB1YmxpYyBUaWxlKEdhbWUgZ2FtZSwgaW50IHRpbGUpIDogYmFzZShnYW1lKVxyXG4gICAgICAgIHtcclxuICAgICAgICAgICAgdGhpcy50aWxlID0gdGlsZTtcclxuICAgICAgICAgICAgQW5pID0gbmV3IEFuaW1hdGlvbihBbmltYXRpb25Mb2FkZXIuR2V0KFwiaW1hZ2VzL2xhbmQvYnJpY2tcIikpO1xyXG4gICAgICAgICAgICBBbmkuQ3VycmVudEZyYW1lID0gdGlsZTtcclxuICAgICAgICAgICAgQW5pLkltYWdlU3BlZWQgPSAwO1xyXG4gICAgICAgIH1cclxuICAgICAgICBwdWJsaWMgb3ZlcnJpZGUgdm9pZCBEcmF3KENhbnZhc1JlbmRlcmluZ0NvbnRleHQyRCBnKVxyXG4gICAgICAgIHtcclxuICAgICAgICAgICAgLyppZiAodGlsZT49MCAmJiB0aWxlIDwgYW5pLmltYWdlcy5Db3VudClcclxuICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgYW5pLmN1cnJlbnRGcmFtZSA9IHRpbGU7XHJcbiAgICAgICAgICAgIH0qL1xyXG4gICAgICAgICAgICBiYXNlLkRyYXcoZyk7XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG59XHJcbiIsInVzaW5nIFN5c3RlbTtcclxudXNpbmcgU3lzdGVtLkNvbGxlY3Rpb25zLkdlbmVyaWM7XHJcbnVzaW5nIFN5c3RlbS5MaW5xO1xyXG51c2luZyBTeXN0ZW0uVGV4dDtcclxudXNpbmcgU3lzdGVtLlRocmVhZGluZy5UYXNrcztcclxudXNpbmcgQnJpZGdlO1xyXG51c2luZyBCcmlkZ2UuSHRtbDU7XHJcblxyXG5uYW1lc3BhY2UgQ2lybm9HYW1lXHJcbntcclxuICAgIHB1YmxpYyBjbGFzcyBUaXRsZVNjcmVlbiA6IFNwcml0ZVxyXG4gICAge1xyXG4gICAgICAgIHB1YmxpYyBUZXh0U3ByaXRlIFRpdGxlO1xyXG5cclxuICAgICAgICBwdWJsaWMgVGV4dFNwcml0ZSBWZXJzaW9uO1xyXG5cclxuICAgICAgICBwdWJsaWMgVGV4dFNwcml0ZSBEZXNjO1xyXG5cclxuICAgICAgICBwdWJsaWMgVGV4dFNwcml0ZSBDb250cm9scztcclxuXHJcbiAgICAgICAgcHVibGljIFRleHRTcHJpdGUgQ3JlZGl0cztcclxuXHJcbiAgICAgICAgcHVibGljIEJ1dHRvbk1lbnUgbWVudTtcclxuICAgICAgICBCdXR0b25TcHJpdGUgQ29udHJvbGxlcjtcclxuICAgICAgICBwdWJsaWMgR2FtZSBnYW1lO1xyXG4gICAgICAgIHB1YmxpYyBUaXRsZVNjcmVlbigpXHJcbiAgICAgICAge1xyXG4gICAgICAgICAgICBzcHJpdGVCdWZmZXIuV2lkdGggPSBBcHAuQ2FudmFzLldpZHRoO1xyXG4gICAgICAgICAgICBzcHJpdGVCdWZmZXIuSGVpZ2h0ID0gKGludCkoc3ByaXRlQnVmZmVyLldpZHRoICogQXBwLlRhcmdldEFzcGVjdCk7XHJcbiAgICAgICAgICAgIFRpdGxlID0gbmV3IFRleHRTcHJpdGUoKTtcclxuICAgICAgICAgICAgVGl0bGUuRm9udFNpemUgPSAoaW50KShzcHJpdGVCdWZmZXIuV2lkdGggKiAwLjA2Zik7XHJcbiAgICAgICAgICAgIC8vVGl0bGUuVGV4dCA9IFwiQ2lybm8gYW5kIHRoZSBteXN0ZXJpb3VzIHRvd2VyXCI7XHJcbiAgICAgICAgICAgIFRpdGxlLlRleHQgPSBBcHAuR2FtZU5hbWU7XHJcbiAgICAgICAgICAgIFRpdGxlLlRleHRDb2xvciA9IFwiIzc3RkZGRlwiO1xyXG4gICAgICAgICAgICBUaXRsZS5TaGFkb3dDb2xvciA9IFwiIzAwMDAwMFwiO1xyXG4gICAgICAgICAgICBUaXRsZS5TaGFkb3dPZmZzZXQgPSBuZXcgVmVjdG9yMigyLCAyKTtcclxuICAgICAgICAgICAgVGl0bGUuU2hhZG93Qmx1ciA9IDI7XHJcblxyXG4gICAgICAgICAgICBDZW50ZXJUZXh0V2l0aEZsb2F0cyhUaXRsZSwgMC41ZiwgMC4wNmYpO1xyXG5cclxuICAgICAgICAgICAgVmVyc2lvbiA9IG5ldyBUZXh0U3ByaXRlKCk7XHJcbiAgICAgICAgICAgIFZlcnNpb24uRm9udFNpemUgPSAoaW50KShzcHJpdGVCdWZmZXIuV2lkdGggKiAwLjAxNmYpO1xyXG4gICAgICAgICAgICBWZXJzaW9uLlRleHQgPSBcIlZlcnNpb246XCIgKyBBcHAuR2FtZVZlcnNpb247XHJcbiAgICAgICAgICAgIFZlcnNpb24uVGV4dENvbG9yID0gXCIjRkZGRkZGXCI7XHJcbiAgICAgICAgICAgIFZlcnNpb24uU2hhZG93Q29sb3IgPSBcIiMwMDAwMDBcIjtcclxuICAgICAgICAgICAgVmVyc2lvbi5TaGFkb3dPZmZzZXQgPSBuZXcgVmVjdG9yMigyLCAyKTtcclxuICAgICAgICAgICAgVmVyc2lvbi5TaGFkb3dCbHVyID0gMjtcclxuXHJcbiAgICAgICAgICAgIENlbnRlclRleHRXaXRoRmxvYXRzKFZlcnNpb24sIDAuNzVmLCAwLjExZik7XHJcblxyXG4gICAgICAgICAgICAvKlRpdGxlLkZvcmNlVXBkYXRlKCk7XHJcbiAgICAgICAgICAgIFRpdGxlLlBvc2l0aW9uLlkgPSBzcHJpdGVCdWZmZXIuSGVpZ2h0ICogMC4wMWY7XHJcbiAgICAgICAgICAgIFRpdGxlLlBvc2l0aW9uLlggPSAoc3ByaXRlQnVmZmVyLldpZHRoIC8gMikgLSAoVGl0bGUuc3ByaXRlQnVmZmVyLldpZHRoIC8gMik7Ki9cclxuXHJcblxyXG5cclxuICAgICAgICAgICAgRGVzYyA9IG5ldyBUZXh0U3ByaXRlKCk7XHJcbiAgICAgICAgICAgIERlc2MuRm9udFNpemUgPSAoaW50KShzcHJpdGVCdWZmZXIuV2lkdGggKiAwLjAzMGYpO1xyXG4gICAgICAgICAgICBEZXNjLlRleHRDb2xvciA9IFwiI0ZGRkZGRlwiO1xyXG4gICAgICAgICAgICAvL0Rlc2MuVGV4dCA9IFwiQ2lybm8gaGFzIGZvdW5kIGhlcnNlbGYgaW4gYSBzdHJhbmdlIGR1bmdlb24gZmlsbGVkIHdpdGggZ2hvc3RzIVxcbkhlciBlbmVyZ3kgaGFzIGJlZW4gc3RvbGVuLCByZWNsYWltIHRoZSBlbmVyZ3kgb3JicyB0byBleHRlbmQgeW91ciB0aW1lLlxcbkZpbmQgdGhlIGJpZyBrZXkgdG8gdW5sb2NrIHRoZSBkb29yLlwiO1xyXG4gICAgICAgICAgICAvL0Rlc2MuVGV4dCA9IFwiQ2lybm8gaGFzIGZvdW5kIGhlcnNlbGYgaW4gYSBzdHJhbmdlIGR1bmdlb24gZmlsbGVkIHdpdGggZ2hvc3RzIVxcblJlY2xhaW0geW91ciBzdG9sZW4gZW5lcmd5IHNlYWxlZCBpbnNpZGUgdGhlIG9yYnMgdG8gZXh0ZW5kIHlvdXIgdGltZS5cXG5GaW5kIHRoZSBnb2xkIGtleSB0byB1bmxvY2sgdGhlIGRvb3IuXCI7XHJcbiAgICAgICAgICAgIERlc2MuVGV4dCA9IFwiQ2lybm8gaGFzIGZvdW5kIGhlcnNlbGYgaW4gYSBzdHJhbmdlIHRvd2VyIGZpbGxlZCB3aXRoIGdob3N0cyFcXG5SZWNsYWltIHlvdXIgc3RvbGVuIGVuZXJneSBzZWFsZWQgaW5zaWRlIHRoZSBvcmJzIHRvIGV4dGVuZCB5b3VyIHRpbWUuXFxuUmVtZW1iZXIgdGhlIGRvb3IncyBsb2NhdGlvbiBhbmQgc2VhcmNoIGZvciB0aGUgZ29sZCBrZXkuXCI7XHJcbiAgICAgICAgICAgIERlc2MuU2hhZG93Q29sb3IgPSBcIiMwMDAwMDBcIjtcclxuICAgICAgICAgICAgRGVzYy5TaGFkb3dPZmZzZXQgPSBuZXcgVmVjdG9yMigyLCAyKTtcclxuICAgICAgICAgICAgRGVzYy5TaGFkb3dCbHVyID0gMjtcclxuICAgICAgICAgICAgQ2VudGVyVGV4dFdpdGhGbG9hdHMoRGVzYywgMC41ZiwgMC4yZik7XHJcblxyXG4gICAgICAgICAgICBDb250cm9scyA9IG5ldyBUZXh0U3ByaXRlKCk7XHJcbiAgICAgICAgICAgIENvbnRyb2xzLkZvbnRTaXplID0gKGludCkoc3ByaXRlQnVmZmVyLldpZHRoICogMC4wMjVmKTtcclxuICAgICAgICAgICAgQ29udHJvbHMuVGV4dENvbG9yID0gXCIjRkZGRkZGXCI7XHJcbiAgICAgICAgICAgIENvbnRyb2xzLlRleHQgPSBcIktleWJvYXJkIENvbnRyb2xzOlxcbkxlZnQvUmlnaHQ9TW92ZVxcblVwL0Rvd249QWltKFVwIGFjdGl2YXRlcyBjaGVzdHMvZG9vcnMpXFxuWj1TaG9vdFxcblg9SnVtcC9NaWQtYWlyIGp1bXBcXG5BPVBsYWNlIGJsb2NrIGJlbG93IHlvdShjb3N0cyB0aW1lKVxcbkVudGVyPVBhdXNlXFxuTT1Ub2dnbGUgbXV0ZVwiO1xyXG4gICAgICAgICAgICBDb250cm9scy5TaGFkb3dDb2xvciA9IFwiIzAwMDAwMFwiO1xyXG4gICAgICAgICAgICBDb250cm9scy5TaGFkb3dPZmZzZXQgPSBuZXcgVmVjdG9yMigyLCAyKTtcclxuICAgICAgICAgICAgQ29udHJvbHMuU2hhZG93Qmx1ciA9IDI7XHJcbiAgICAgICAgICAgIENlbnRlclRleHRXaXRoRmxvYXRzKENvbnRyb2xzLCAwLjVmLCAwLjRmKTtcclxuICAgICAgICAgICAgQ29udHJvbHMuUG9zaXRpb24uWCA9IERlc2MuUG9zaXRpb24uWDtcclxuXHJcbiAgICAgICAgICAgIG1lbnUgPSBuZXcgQnV0dG9uTWVudShzcHJpdGVCdWZmZXIuV2lkdGggKiAwLjhmLCBzcHJpdGVCdWZmZXIuSGVpZ2h0ICogMC41ZiwgKGludCkoc3ByaXRlQnVmZmVyLldpZHRoICogMC4wNWYpKTtcclxuICAgICAgICAgICAgdmFyIEIgPSBtZW51LkFkZEJ1dHRvbihcIlN0YXJ0IEdhbWVcIik7XHJcbiAgICAgICAgICAgIEIuT25DbGljayA9ICgpID0+IHtcclxuICAgICAgICAgICAgICAgIGdhbWUuU3RhcnQoKTtcclxuICAgICAgICAgICAgfTtcclxuICAgICAgICAgICAgLy9tZW51LkZpbmlzaCgpO1xyXG4gICAgICAgICAgICBCLlBvc2l0aW9uLlggKz0gc3ByaXRlQnVmZmVyLldpZHRoICogMC4zOGY7XHJcbiAgICAgICAgICAgIEIuUG9zaXRpb24uWSA9IHNwcml0ZUJ1ZmZlci5IZWlnaHQgKiAwLjdmO1xyXG5cclxuICAgICAgICAgICAgLy92YXIgQ0IgPSBtZW51LkFkZEJ1dHRvbihcIkNvbnRyb2xsZXI6XCIrSW5wdXRDb250cm9sbGVyTWFuYWdlci5fdGhpcy5Db250cm9sbGVyc1swXS5pZCk7XHJcbiAgICAgICAgICAgIHZhciBDQiA9IG1lbnUuQWRkQnV0dG9uKFwiQ29udHJvbGxlcjpcIiArIEFwcC5JQy5pZCk7XHJcbiAgICAgICAgICAgIENvbnRyb2xsZXIgPSBDQjtcclxuICAgICAgICAgICAgQ0IuT25DbGljayA9ICgpID0+IHtcclxuICAgICAgICAgICAgICAgIHZhciBpbmQgPSBJbnB1dENvbnRyb2xsZXJNYW5hZ2VyLl90aGlzLkNvbnRyb2xsZXJzLkluZGV4T2YoQXBwLklDKTtcclxuICAgICAgICAgICAgICAgIGluZCsrO1xyXG4gICAgICAgICAgICAgICAgaWYgKGluZD49IElucHV0Q29udHJvbGxlck1hbmFnZXIuX3RoaXMuQ29udHJvbGxlcnMuQ291bnQpXHJcbiAgICAgICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICAgICAgaW5kIC09IElucHV0Q29udHJvbGxlck1hbmFnZXIuX3RoaXMuQ29udHJvbGxlcnMuQ291bnQ7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICBBcHAuSUMgPSBJbnB1dENvbnRyb2xsZXJNYW5hZ2VyLl90aGlzLkNvbnRyb2xsZXJzW2luZF07XHJcbiAgICAgICAgICAgICAgICB2YXIgVFMgPSBDQi5Db250ZW50cy5BczxUZXh0U3ByaXRlPigpO1xyXG4gICAgICAgICAgICAgICAgdmFyIFcgPSBUUy5zcHJpdGVCdWZmZXIuV2lkdGg7XHJcbiAgICAgICAgICAgICAgICBUUy5UZXh0ID0gXCJDb250cm9sbGVyOlwiICsgQXBwLklDLmlkO1xyXG4gICAgICAgICAgICAgICAgVFMuRm9yY2VVcGRhdGUoKTtcclxuICAgICAgICAgICAgICAgIENCLlBvc2l0aW9uLlggLT0gKChUUy5zcHJpdGVCdWZmZXIuV2lkdGggLSBXKSAvIDIpO1xyXG4gICAgICAgICAgICB9O1xyXG4gICAgICAgICAgICBDQi5Qb3NpdGlvbi5YICs9IHNwcml0ZUJ1ZmZlci5XaWR0aCAqIDAuMzhmOyA7XHJcbiAgICAgICAgICAgIENCLlBvc2l0aW9uLlkgPSBCLlBvc2l0aW9uLlkgKyAoc3ByaXRlQnVmZmVyLkhlaWdodCAqIDAuMTVmKTtcclxuICAgICAgICAgICAgLy9DQi5WaXNpYmxlID0gZmFsc2U7XHJcbiAgICAgICAgICAgIENCLkxvY2soKTtcclxuXHJcbiAgICAgICAgICAgIENyZWRpdHMgPSBuZXcgVGV4dFNwcml0ZSgpO1xyXG4gICAgICAgICAgICBDcmVkaXRzLkZvbnRTaXplID0gKGludCkoc3ByaXRlQnVmZmVyLldpZHRoICogMC4wMTVmKTtcclxuICAgICAgICAgICAgQ3JlZGl0cy5UZXh0Q29sb3IgPSBcIiM3N0ZGRkZcIjtcclxuICAgICAgICAgICAgLy9DcmVkaXRzLlRleHQgPSBcIk1hZGUgYnk6UlNHbWFrZXIgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBUb3Vob3UgUHJvamVjdCBhbmQgaXQncyBjaGFyYWN0ZXJzIGFyZSBvd25lZCBieSBaVU5cIjtcclxuICAgICAgICAgICAgQ3JlZGl0cy5UZXh0ID0gXCJNYWRlIGJ5OlJTR21ha2VyICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBUb3Vob3UgUHJvamVjdCBhbmQgaXQncyBjaGFyYWN0ZXJzIGFyZSBvd25lZCBieSBaVU5cIjtcclxuICAgICAgICAgICAgQ3JlZGl0cy5TaGFkb3dDb2xvciA9IFwiIzAwMDAwMFwiO1xyXG4gICAgICAgICAgICBDcmVkaXRzLlNoYWRvd09mZnNldCA9IG5ldyBWZWN0b3IyKDIsIDIpO1xyXG4gICAgICAgICAgICBDcmVkaXRzLlNoYWRvd0JsdXIgPSAyO1xyXG4gICAgICAgICAgICBDZW50ZXJUZXh0V2l0aEZsb2F0cyhDcmVkaXRzLCAwLjVmLCAwLjk4Zik7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHB1YmxpYyB2b2lkIENlbnRlclRleHRXaXRoRmxvYXRzKFRleHRTcHJpdGUgVCwgZmxvYXQgWCwgZmxvYXQgWSlcclxuICAgICAgICB7XHJcbiAgICAgICAgICAgIENlbnRlclRleHQoVCwgbmV3IFZlY3RvcjIoc3ByaXRlQnVmZmVyLldpZHRoICogWCwgc3ByaXRlQnVmZmVyLkhlaWdodCAqIFkpKTtcclxuICAgICAgICB9XHJcbiAgICAgICAgcHVibGljIHZvaWQgQ2VudGVyVGV4dChUZXh0U3ByaXRlIFQsIFZlY3RvcjIgTG9jYXRpb24pXHJcbiAgICAgICAge1xyXG4gICAgICAgICAgICBULkZvcmNlVXBkYXRlKCk7XHJcbiAgICAgICAgICAgIFQuUG9zaXRpb24uWCA9IExvY2F0aW9uLlggLSAoVC5zcHJpdGVCdWZmZXIuV2lkdGggLyAyKTtcclxuICAgICAgICAgICAgVC5Qb3NpdGlvbi5ZID0gTG9jYXRpb24uWSAtIChULnNwcml0ZUJ1ZmZlci5IZWlnaHQgLyAyKTtcclxuICAgICAgICB9XHJcbiAgICAgICAgcHVibGljIG92ZXJyaWRlIHZvaWQgRHJhdyhDYW52YXNSZW5kZXJpbmdDb250ZXh0MkQgZylcclxuICAgICAgICB7XHJcbiAgICAgICAgICAgIGJhc2UuRHJhdyhnKTtcclxuICAgICAgICAgICAgaWYgKENvbnRyb2xsZXIubG9ja2VkICYmIElucHV0Q29udHJvbGxlck1hbmFnZXIuX3RoaXMuQ29udHJvbGxlcnMuQ291bnQgPiAxKVxyXG4gICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICBDb250cm9sbGVyLlVubG9jaygpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIFxyXG4gICAgICAgICAgICBUaXRsZS5EcmF3KGcpO1xyXG4gICAgICAgICAgICBWZXJzaW9uLkRyYXcoZyk7XHJcbiAgICAgICAgICAgIERlc2MuRHJhdyhnKTtcclxuICAgICAgICAgICAgQ29udHJvbHMuRHJhdyhnKTtcclxuICAgICAgICAgICAgbWVudS5EcmF3KGcpO1xyXG4gICAgICAgICAgICBtZW51LlVwZGF0ZSgpO1xyXG4gICAgICAgICAgICBDcmVkaXRzLkRyYXcoZyk7XHJcblxyXG4gICAgICAgICAgICAvL3ZhciBNID0gS2V5Ym9hcmRNYW5hZ2VyLl90aGlzLk1vdXNlUG9zaXRpb24uQ2xvbmUoKTtcclxuICAgICAgICAgICAgdmFyIE0gPSBLZXlib2FyZE1hbmFnZXIuX3RoaXMuQ01vdXNlLkNsb25lKCk7XHJcbiAgICAgICAgICAgIGlmICghQXBwLkRpdi5TdHlsZS5MZWZ0LkNvbnRhaW5zKFwicHhcIikpXHJcbiAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgIHJldHVybjtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAvKk0uWCAtPSBmbG9hdC5QYXJzZShBcHAuRGl2LlN0eWxlLkxlZnQuUmVwbGFjZShcInB4XCIsIFwiXCIpKTsqL1xyXG4gICAgICAgICAgICAvL0NyZWRpdHMuVGV4dCA9IFwiWDpcIiArIE0uWCtcIi9cIisoc3ByaXRlQnVmZmVyLldpZHRoICogMC4xKSArXCIgWTpcIitNLlkrXCIvXCIrKHNwcml0ZUJ1ZmZlci5IZWlnaHQgKiAwLjk2KTtcclxuICAgICAgICAgICAgaWYgKE0uWCA8IHNwcml0ZUJ1ZmZlci5XaWR0aCAqIDAuMTcgJiYgTS5ZID49IHNwcml0ZUJ1ZmZlci5IZWlnaHQgKiAwLjk2KVxyXG4gICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICBBcHAuRGl2LlN0eWxlLkN1cnNvciA9IEN1cnNvci5Qb2ludGVyO1xyXG4gICAgICAgICAgICAgICAgaWYgKEtleWJvYXJkTWFuYWdlci5fdGhpcy5UYXBwZWRNb3VzZUJ1dHRvbnMuQ29udGFpbnMoMCkpXHJcbiAgICAgICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICAgICAgR2xvYmFsLkxvY2F0aW9uLkhyZWYgPSBcImh0dHBzOi8vcnNnbWFrZXIuZGV2aWFudGFydC5jb21cIjtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBlbHNlXHJcbiAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgIEFwcC5EaXYuU3R5bGUuQ3Vyc29yID0gbnVsbDtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuICAgIH1cclxufVxyXG4iLCJ1c2luZyBTeXN0ZW07XHJcbnVzaW5nIFN5c3RlbS5Db2xsZWN0aW9ucy5HZW5lcmljO1xyXG51c2luZyBTeXN0ZW0uTGlucTtcclxudXNpbmcgU3lzdGVtLlRleHQ7XHJcbnVzaW5nIFN5c3RlbS5UaHJlYWRpbmcuVGFza3M7XHJcblxyXG5uYW1lc3BhY2UgQ2lybm9HYW1lXHJcbntcclxuICAgIHB1YmxpYyBjbGFzcyBUdXJyZXQgOiBFbnRpdHksIElDb21iYXRhbnRcclxuICAgIHtcclxuICAgICAgICBwdWJsaWMgZmxvYXQgYXR0YWNrcG93ZXIgPSAxO1xyXG4gICAgICAgIC8vcHVibGljIGZsb2F0IGRlZmVuc2Vwb3dlciA9IDE7XHJcbiAgICAgICAgcHVibGljIFR1cnJldChHYW1lIGdhbWUpIDogYmFzZShnYW1lKVxyXG4gICAgICAgIHtcclxuICAgICAgICAgICAgQW5pID0gbmV3IEFuaW1hdGlvbihBbmltYXRpb25Mb2FkZXIuX3RoaXMuR2V0QW5pbWF0aW9uKFwiaW1hZ2VzL2VuZW1pZXMvdHVycmV0XCIpKTtcclxuICAgICAgICAgICAgQW5pLkltYWdlU3BlZWQgPSAwO1xyXG5cclxuICAgICAgICAgICAgYXR0YWNrcG93ZXIgPSAxICsgKEdhbWUubGV2ZWwgKiAwLjVmKTtcclxuICAgICAgICAgICAgYXR0YWNrcG93ZXIgKj0gMjtcclxuICAgICAgICAgICAgSFAgPSAwO1xyXG4gICAgICAgICAgICBUZWFtID0gMjtcclxuICAgICAgICAgICAgLy9kZWZlbnNlcG93ZXIgPSAxICsgKEdhbWUubGV2ZWwgKiAwLjVmKTtcclxuICAgICAgICAgICAgaWYgKEdhbWUucGxheWluZylcclxuICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgdmFyIEEgPSBBZGRCZWhhdmlvcjxBaW1lZFNob290ZXI+KCk7XHJcbiAgICAgICAgICAgICAgICBBLmF0dGFja3Bvd2VyID0gYXR0YWNrcG93ZXI7XHJcbiAgICAgICAgICAgICAgICBBLm1heHRpbWUgPSBNYXRoLk1heCg0ODAgLSAoR2FtZS5sZXZlbCAqIDEwKSwgMzgwKTtcclxuICAgICAgICAgICAgICAgIC8vQS5tYXh0aW1lID0gKGludCkoQS5tYXh0aW1lKjEuNzVmKTtcclxuICAgICAgICAgICAgICAgIEEubWF4dGltZSA9IChpbnQpKEEubWF4dGltZSAqIDEuMjVmKTtcclxuICAgICAgICAgICAgICAgIEEuaWdub3Jlc3RlcnJhaW4gPSB0cnVlO1xyXG4gICAgICAgICAgICAgICAgQS5tYXhEaXN0YW5jZSAqPSAxLjNmO1xyXG4gICAgICAgICAgICAgICAgQS5tYXhTaGFkb3cgPSAxO1xyXG4gICAgICAgICAgICAgICAgQS5idWxsZXRTcGVlZCAqPSAwLjgwZjtcclxuICAgICAgICAgICAgICAgIEEuYnVsbGV0RHVyYXRpb24gPSA2MCAqIDk7XHJcbiAgICAgICAgICAgICAgICBBLmJ1bGxldGdyYXBoaWMgPSBcInR1cnJldGJ1bGxldFwiO1xyXG4gICAgICAgICAgICAgICAgQS5hdHRhY2tUZWxlZ3JhcGhUaW1lICs9IEEuYXR0YWNrVGVsZWdyYXBoVGltZTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgcHVibGljIGludCBUZWFtIHsgZ2V0OyBzZXQ7IH1cclxuXHJcbiAgICAgICAgcHVibGljIGZsb2F0IEhQIHsgZ2V0OyBzZXQ7IH1cclxuXHJcbiAgICAgICAgcHVibGljIGludCBQb2ludHNGb3JLaWxsaW5nXHJcbiAgICAgICAge1xyXG4gICAgICAgICAgICBnZXRcclxuICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuIDE7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIHB1YmxpYyBmbG9hdCBUYXJnZXRQcmlvcml0eVxyXG4gICAgICAgIHtcclxuICAgICAgICAgICAgZ2V0XHJcbiAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgIHJldHVybiAwLjVmO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBwdWJsaWMgb3ZlcnJpZGUgVmVjdG9yMiBnZXRDZW50ZXIoKVxyXG4gICAgICAgIHtcclxuICAgICAgICAgICAgcmV0dXJuIFZlY3RvcjIuQWRkKFBvc2l0aW9uLCA1LCA1KTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIHB1YmxpYyB2b2lkIG9uRGFtYWdlZChJSGFybWZ1bEVudGl0eSBzb3VyY2UsIGZsb2F0IGFtb3VudClcclxuICAgICAgICB7XHJcbiAgICAgICAgICAgIC8vdGhyb3cgbmV3IE5vdEltcGxlbWVudGVkRXhjZXB0aW9uKCk7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBwdWJsaWMgdm9pZCBvbkRlYXRoKElIYXJtZnVsRW50aXR5IHNvdXJjZSlcclxuICAgICAgICB7XHJcbiAgICAgICAgICAgIC8vdGhyb3cgbmV3IE5vdEltcGxlbWVudGVkRXhjZXB0aW9uKCk7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBwdWJsaWMgdm9pZCBvbktpbGwoSUNvbWJhdGFudCBjb21iYXRhbnQpXHJcbiAgICAgICAge1xyXG4gICAgICAgICAgICAvL3Rocm93IG5ldyBOb3RJbXBsZW1lbnRlZEV4Y2VwdGlvbigpO1xyXG4gICAgICAgIH1cclxuICAgICAgICBwdWJsaWMgVGlsZURhdGEgVFREO1xyXG5cclxuICAgICAgICBwdWJsaWMgdm9pZCBTZXREb3duKGJvb2wgZm9yY2Vkb3duID0gZmFsc2UpXHJcbiAgICAgICAge1xyXG4gICAgICAgICAgICB2YXIgVFogPSBHYW1lLlRNLnRpbGVzaXplO1xyXG4gICAgICAgICAgICB2YXIgVEQgPSBHYW1lLlRNLkNoZWNrRm9yVGlsZShQb3NpdGlvbik7XHJcbiAgICAgICAgICAgIHZhciBhdHRlbXB0cyA9IDA7XHJcbiAgICAgICAgICAgIHZhciBkaXJlY3Rpb24gPSBNYXRoLlJhbmRvbSgpIDwgMC41ID8gVFogOiAtVFo7XHJcbiAgICAgICAgICAgIGlmIChmb3JjZWRvd24pXHJcbiAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgIGRpcmVjdGlvbiA9IFRaO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIHdoaWxlICghKFREICE9IG51bGwgJiYgVEQuc29saWQgJiYgVEQudmlzaWJsZSkgJiYgYXR0ZW1wdHM8MjApXHJcbiAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgIHkgKz0gZGlyZWN0aW9uO1xyXG4gICAgICAgICAgICAgICAgVEQgPSBHYW1lLlRNLkNoZWNrRm9yVGlsZShQb3NpdGlvbik7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgaWYgKGF0dGVtcHRzID49IDIwKVxyXG4gICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICBBbGl2ZSA9IGZhbHNlO1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIGVsc2VcclxuICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgeCA9IChURC5jb2x1bW4gKiBUWikgKyBHYW1lLlRNLnBvc2l0aW9uLlg7XHJcbiAgICAgICAgICAgICAgICB5ID0gKFRELnJvdyAqIFRaKSArIEdhbWUuVE0ucG9zaXRpb24uWTtcclxuICAgICAgICAgICAgICAgIC8vVEQuSFAgPSBURC5tYXhIUCAqIDI7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgVFREID0gVEQ7XHJcblxyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgcHVibGljIG92ZXJyaWRlIHZvaWQgVXBkYXRlKClcclxuICAgICAgICB7XHJcbiAgICAgICAgICAgIHZhciBURCA9IEdhbWUuVE0uQ2hlY2tGb3JUaWxlKFBvc2l0aW9uKTtcclxuICAgICAgICAgICAgaWYgKFREIT1udWxsICYmIFRELnNvbGlkICYmIFRELnZpc2libGUgJiYgVEQub3BhcXVlKVxyXG4gICAgICAgICAgICB7XHJcblxyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIGVsc2UgaWYgKEFsaXZlKVxyXG4gICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICBBbGl2ZSA9IGZhbHNlO1xyXG4gICAgICAgICAgICAgICAgQ29sbGVjdGFibGVJdGVtIFAgPSBuZXcgUG9pbnRJdGVtKEdhbWUpO1xyXG4gICAgICAgICAgICAgICAgUC5Qb3NpdGlvbi5Db3B5RnJvbShQb3NpdGlvbik7XHJcbiAgICAgICAgICAgICAgICBQLmNvbGxlY3Rpb25EZWxheSAvPSAyO1xyXG4gICAgICAgICAgICAgICAgR2FtZS5BZGRFbnRpdHkoUCk7XHJcbiAgICAgICAgICAgICAgICBpZiAoTWF0aC5SYW5kb20oKSA8IDAuMTUpXHJcbiAgICAgICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICAgICAgUCA9IG5ldyBIZWFsaW5nSXRlbShHYW1lKTtcclxuICAgICAgICAgICAgICAgICAgICBQLlBvc2l0aW9uLkNvcHlGcm9tKFBvc2l0aW9uKTtcclxuICAgICAgICAgICAgICAgICAgICBQLlZzcGVlZCA9IC0yO1xyXG4gICAgICAgICAgICAgICAgICAgIFAuY29sbGVjdGlvbkRlbGF5IC89IDI7XHJcbiAgICAgICAgICAgICAgICAgICAgR2FtZS5BZGRFbnRpdHkoUCk7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICByZXR1cm47XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgaWYgKFRELkNhblNsb3BlKVxyXG4gICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICB2YXIgcmVkcmF3ID0gZmFsc2U7XHJcbiAgICAgICAgICAgICAgICBpZiAoVEQuU2xvcGVEaXJlY3Rpb24gIT0gMClcclxuICAgICAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgICAgICByZWRyYXcgPSB0cnVlO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgVEQuQ2FuU2xvcGUgPSBmYWxzZTtcclxuICAgICAgICAgICAgICAgIGlmIChyZWRyYXcpXHJcbiAgICAgICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICAgICAgVEQuVXBkYXRlVGlsZSgpO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIGlmIChBbmkuU2hhZG93ID4gMClcclxuICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgQW5pLkltYWdlU3BlZWQgPSAwLjI1ZjtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBlbHNlIGlmIChBbmkuSW1hZ2VTcGVlZCA+IDApXHJcbiAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgIEFuaS5JbWFnZVNwZWVkID0gMDtcclxuICAgICAgICAgICAgICAgIEFuaS5DdXJyZW50RnJhbWUgPSAwO1xyXG4gICAgICAgICAgICAgICAgQW5pLlNldEltYWdlKCk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgYmFzZS5VcGRhdGUoKTtcclxuICAgICAgICAgICAgXHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG59XHJcbiIsInVzaW5nIFN5c3RlbTtcclxudXNpbmcgU3lzdGVtLkNvbGxlY3Rpb25zLkdlbmVyaWM7XHJcbnVzaW5nIFN5c3RlbS5MaW5xO1xyXG51c2luZyBTeXN0ZW0uVGV4dDtcclxudXNpbmcgU3lzdGVtLlRocmVhZGluZy5UYXNrcztcclxuXHJcbm5hbWVzcGFjZSBDaXJub0dhbWVcclxue1xyXG4gICAgcHVibGljIGNsYXNzIERvb3JLZXkgOiBDb2xsZWN0YWJsZUl0ZW1cclxuICAgIHtcclxuICAgICAgICBwdWJsaWMgRG9vcktleShHYW1lIGdhbWUpIDogYmFzZShnYW1lLCBcImJpZ2tleVwiKVxyXG4gICAgICAgIHtcclxuICAgICAgICAgICAgZmxvYXRzID0gZmFsc2U7XHJcbiAgICAgICAgICAgIG1hZ25ldERpc3RhbmNlID0gMjA7XHJcbiAgICAgICAgICAgIHNvdW5kID0gXCJrZXlcIjtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIHB1YmxpYyBvdmVycmlkZSB2b2lkIG9uQ29sbGVjdGVkKFBsYXllckNoYXJhY3RlciBwbGF5ZXIpXHJcbiAgICAgICAge1xyXG4gICAgICAgICAgICAvL3Rocm93IG5ldyBOb3RJbXBsZW1lbnRlZEV4Y2VwdGlvbigpO1xyXG4gICAgICAgICAgICBHYW1lLkRvb3IuT3BlbmVkID0gdHJ1ZTtcclxuXHJcbiAgICAgICAgICAgIEZsb2F0aW5nTWVzc2FnZSBGTSA9IG5ldyBGbG9hdGluZ01lc3NhZ2UoR2FtZSwgXCJEb29yIFVubG9ja2VkIVwiKTtcclxuICAgICAgICAgICAgRk0uVGV4dC5UZXh0Q29sb3IgPSBcIiM3N0ZGRkZcIjtcclxuICAgICAgICAgICAgRk0uUG9zaXRpb24gPSBuZXcgVmVjdG9yMih4ICsgOCwgeSAtIDIwKTtcclxuICAgICAgICAgICAgR2FtZS5BZGRFbnRpdHkoRk0pO1xyXG4gICAgICAgIH1cclxuICAgICAgICBwdWJsaWMgb3ZlcnJpZGUgdm9pZCBVcGRhdGUoKVxyXG4gICAgICAgIHtcclxuICAgICAgICAgICAgYmFzZS5VcGRhdGUoKTtcclxuICAgICAgICAgICAgaWYgKHkgPD0gMClcclxuICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgR2FtZS5MZXZlbFJlc3RhcnQoKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuICAgIH1cclxufVxyXG4iLCJ1c2luZyBTeXN0ZW07XHJcbnVzaW5nIFN5c3RlbS5Db2xsZWN0aW9ucy5HZW5lcmljO1xyXG51c2luZyBTeXN0ZW0uTGlucTtcclxudXNpbmcgU3lzdGVtLlRleHQ7XHJcbnVzaW5nIFN5c3RlbS5UaHJlYWRpbmcuVGFza3M7XHJcbnVzaW5nIEJyaWRnZTtcclxudXNpbmcgQnJpZGdlLkh0bWw1O1xyXG5cclxubmFtZXNwYWNlIENpcm5vR2FtZVxyXG57XHJcbiAgICBwdWJsaWMgY2xhc3MgR2FtZSA6IEdhbWVTcHJpdGVcclxuICAgIHtcclxuICAgICAgICBwdWJsaWMgUGxheWVyQ2hhcmFjdGVyIHBsYXllcjtcclxuICAgICAgICBwdWJsaWMgTGlzdDxFbnRpdHk+IGVudGl0aWVzO1xyXG4gICAgICAgIHB1YmxpYyBMaXN0PEVudGl0eT4gaGFybWZ1bDtcclxuICAgICAgICBwdWJsaWMgTGlzdDxFbnRpdHk+IGNvbWJhdGFudHM7XHJcbiAgICAgICAgcHVibGljIENhbWVyYSBjYW1lcmE7XHJcbiAgICAgICAgcHVibGljIFJlY3RhbmdsZSBzdGFnZUJvdW5kcztcclxuICAgICAgICBwdWJsaWMgVGlsZU1hcCBUTTtcclxuICAgICAgICBwdWJsaWMgR2FtZVBsYXlTZXR0aW5ncyBHYW1lUGxheVNldHRpbmdzO1xyXG5cclxuICAgICAgICBwdWJsaWMgVGV4dFNwcml0ZSBUaW1lclNwcml0ZTtcclxuXHJcbiAgICAgICAgcHVibGljIGZsb2F0IGRlZmF1bHRUaW1lUmVtYWluaW5nID0gMTAwMCAqIDYwICogMzsvLzMgbWludXRlc1xyXG4gICAgICAgIC8vcHVibGljIGZsb2F0IG1heFRpbWVSZW1haW5pbmcgPSAxMDAwICogNjAgKiA1Oy8vMyBtaW51dGVzXHJcbiAgICAgICAgcHVibGljIGZsb2F0IGxhc3RTdGFuZCA9IDEwMDAgKiAzMDtcclxuICAgICAgICBwdWJsaWMgZmxvYXQgYmFzZUxpZmVDb3N0ID0gMTAwMCAqIDE1O1xyXG4gICAgICAgIHB1YmxpYyBmbG9hdCB0aW1lUmVtYWluaW5nO1xyXG4gICAgICAgIHB1YmxpYyBmbG9hdCB0b3RhbFRpbWUgPSAwO1xyXG4gICAgICAgIHB1YmxpYyBpbnQgbGV2ZWwgPSAwO1xyXG4gICAgICAgIHB1YmxpYyBib29sIHBsYXlpbmcgPSBmYWxzZTtcclxuICAgICAgICBwdWJsaWMgYm9vbCBwYXVzZWQgPSBmYWxzZTtcclxuICAgICAgICBwdWJsaWMgVmVjdG9yMiBjYW1lcmFXYW5kZXJQb2ludDtcclxuICAgICAgICBwdWJsaWMgVGl0bGVTY3JlZW4gVFM7XHJcbiAgICAgICAgcHVibGljIGJvb2wgVGVhbXMgPSB0cnVlO1xyXG5cclxuICAgICAgICBwdWJsaWMgYm9vbCBydW5uaW5nXHJcbiAgICAgICAge1xyXG4gICAgICAgICAgICBnZXRcclxuICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuIHBsYXlpbmcgJiYgIXBhdXNlZDtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuICAgICAgICBwdWJsaWMgYm9vbCBza2lwcmVuZGVyID0gdHJ1ZTtcclxuXHJcbiAgICAgICAgcHVibGljIFRleHRTcHJpdGUgU2NvcmVTcHJpdGU7XHJcblxyXG4gICAgICAgIHB1YmxpYyBDYW52YXNSZW5kZXJpbmdDb250ZXh0MkQgRUc7XHJcblxyXG4gICAgICAgIHB1YmxpYyBFeGl0RG9vciBEb29yO1xyXG5cclxuICAgICAgICBwdWJsaWMgSFRNTEltYWdlRWxlbWVudCBLZXk7XHJcbiAgICAgICAgcHVibGljIEhUTUxJbWFnZUVsZW1lbnQgQmlnS2V5O1xyXG4gICAgICAgIHB1YmxpYyBHYW1lKClcclxuICAgICAgICB7XHJcbiAgICAgICAgICAgIEdhbWVQbGF5U2V0dGluZ3MgPSBuZXcgR2FtZVBsYXlTZXR0aW5ncygpO1xyXG4gICAgICAgICAgICBEb29yID0gbmV3IEV4aXREb29yKHRoaXMpO1xyXG4gICAgICAgICAgICBlbnRpdGllcyA9IG5ldyBMaXN0PEVudGl0eT4oKTtcclxuICAgICAgICAgICAgY29tYmF0YW50cyA9IG5ldyBMaXN0PEVudGl0eT4oKTtcclxuICAgICAgICAgICAgaGFybWZ1bCA9IG5ldyBMaXN0PEVudGl0eT4oKTtcclxuXHJcbiAgICAgICAgICAgIHBsYXllciA9IG5ldyBQbGF5ZXJDaGFyYWN0ZXIodGhpcyk7XHJcbiAgICAgICAgICAgIHBsYXllci5IUCA9IDA7XHJcbiAgICAgICAgICAgIHRpbWVSZW1haW5pbmcgPSBkZWZhdWx0VGltZVJlbWFpbmluZztcclxuICAgICAgICAgICAgLy90aW1lUmVtYWluaW5nICo9IDAuMzMzNGYgKiAwLjI1ZjtcclxuXHJcbiAgICAgICAgICAgIC8qdGVzdC5BbmkgPSBuZXcgQW5pbWF0aW9uKEFuaW1hdGlvbkxvYWRlci5fdGhpcy5HZXQoXCJpbWFnZXMvY2lybm8vd2Fsa1wiKSk7XHJcbiAgICAgICAgICAgIHRlc3QuQW5pLkltYWdlU3BlZWQgPSAwLjFmOyovXHJcbiAgICAgICAgICAgIFxyXG4gICAgICAgICAgICAvL3N0YWdlQm91bmRzID0gbmV3IFJlY3RhbmdsZSgwLCAwLCA4MDAwLCAzMDAwKTtcclxuICAgICAgICAgICAgLy9zdGFnZUJvdW5kcyA9IG5ldyBSZWN0YW5nbGUoMCwgMCwgNjAwMCwgNDAwMCk7XHJcbiAgICAgICAgICAgIC8vc3RhZ2VCb3VuZHMgPSBuZXcgUmVjdGFuZ2xlKDAsIDAsIDIwMDAsIDE1MDApO1xyXG4gICAgICAgICAgICAvL3N0YWdlQm91bmRzID0gbmV3IFJlY3RhbmdsZSgwLCAwLCAxMDAwLCA3NTApO1xyXG4gICAgICAgICAgICAvL3N0YWdlQm91bmRzID0gbmV3IFJlY3RhbmdsZSgwLCAwLCAyMDAwLCAxMDAwKTtcclxuICAgICAgICAgICAgc3RhZ2VCb3VuZHMgPSBuZXcgUmVjdGFuZ2xlKDAsIDAsIDQwMDAsIDIwMDApO1xyXG4gICAgICAgICAgICBUTSA9IG5ldyBUaWxlTWFwKHRoaXMpO1xyXG4gICAgICAgICAgICBUTS5TZWVkID0gKGludCkoTWF0aC5SYW5kb20oKSAqIDk5OTk5OTk5OTkpO1xyXG4gICAgICAgICAgICAvLy9UTS5HZW5lcmF0ZSgpO1xyXG4gICAgICAgICAgICBUTS5wb3NpdGlvbi5ZID0gMDtcclxuICAgICAgICAgICAgdmFyIFIgPSBzdGFnZUJvdW5kcyAtIFRNLnBvc2l0aW9uO1xyXG4gICAgICAgICAgICBSLndpZHRoIC09IFRNLnRpbGVzaXplO1xyXG4gICAgICAgICAgICBSLmhlaWdodCAtPSBUTS50aWxlc2l6ZTtcclxuICAgICAgICAgICAgLy9UTS5EcmF3UmVjdChSKTtcclxuXHJcblxyXG5cclxuICAgICAgICAgICAgcGxheWVyLlBvc2l0aW9uLlkgPSBzdGFnZUJvdW5kcy5oZWlnaHQgLyAzO1xyXG4gICAgICAgICAgICBwbGF5ZXIuUG9zaXRpb24uWCA9IHN0YWdlQm91bmRzLndpZHRoIC8gMjtcclxuXHJcbiAgICAgICAgICAgIEVHID0gSGVscGVyLkdldENvbnRleHQobmV3IEhUTUxDYW52YXNFbGVtZW50KCkpO1xyXG4gICAgICAgICAgICAvL01hcEdlbmVyYXRvci5HZW5lcmF0ZSh0aGlzKTtcclxuICAgICAgICAgICAgLypNYXBHZW5lcmF0b3IuQm94eUdlbmVyYXRlKHRoaXMpOyAgICAgICAgICAgIFxyXG4gICAgICAgICAgICBUTS5EcmF3UmVjdChSKTtcclxuICAgICAgICAgICAgLy9UTS50ZXN0VGV4dHVyZSgpO1xyXG4gICAgICAgICAgICBUTS5BcHBseUJyZWFrYWJsZSgpOyovXHJcbiAgICAgICAgICAgIC8qdmFyIEUgPSBuZXcgRW50aXR5KHRoaXMpO1xyXG4gICAgICAgICAgICBFLkFuaSA9IG5ldyBBbmltYXRpb24oQW5pbWF0aW9uTG9hZGVyLkdldChcIkltYWdlcy9sYW5kL2JyaWNrXCIpKTtcclxuICAgICAgICAgICAgRS55ICs9IDI0O1xyXG4gICAgICAgICAgICBlbnRpdGllcy5BZGQoRSk7XHJcbiAgICAgICAgICAgIHZhciBsbiA9IDEwO1xyXG4gICAgICAgICAgICB2YXIgaSA9IDA7XHJcbiAgICAgICAgICAgIHdoaWxlIChpIDwgbG4pXHJcbiAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgIEUgPSBuZXcgRW50aXR5KHRoaXMpO1xyXG4gICAgICAgICAgICAgICAgRS5BbmkgPSBuZXcgQW5pbWF0aW9uKEFuaW1hdGlvbkxvYWRlci5HZXQoXCJJbWFnZXMvbGFuZC9icmlja1wiKSk7XHJcbiAgICAgICAgICAgICAgICBFLnkgKz0gMjQ7XHJcbiAgICAgICAgICAgICAgICBFLnggKz0gMTYgKiAoaSsxKTtcclxuICAgICAgICAgICAgICAgIGVudGl0aWVzLkFkZChFKTtcclxuICAgICAgICAgICAgICAgIGkrKztcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBpID0gMDtcclxuICAgICAgICAgICAgd2hpbGUgKGkgPCBsbilcclxuICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgRSA9IG5ldyBFbnRpdHkodGhpcyk7XHJcbiAgICAgICAgICAgICAgICBFLkFuaSA9IG5ldyBBbmltYXRpb24oQW5pbWF0aW9uTG9hZGVyLkdldChcIkltYWdlcy9sYW5kL2JyaWNrXCIpKTtcclxuICAgICAgICAgICAgICAgIEUueSArPSAyNDtcclxuICAgICAgICAgICAgICAgIEUueCArPSAxNiAqIC0oaSArIDEpO1xyXG4gICAgICAgICAgICAgICAgZW50aXRpZXMuQWRkKEUpO1xyXG4gICAgICAgICAgICAgICAgaSsrO1xyXG4gICAgICAgICAgICB9Ki9cclxuXHJcblxyXG4gICAgICAgICAgICAvL2VudGl0aWVzLkFkZCh0ZXN0KTtcclxuICAgICAgICAgICAgQWRkRW50aXR5KERvb3IpO1xyXG4gICAgICAgICAgICAvLy9BZGRFbnRpdHkocGxheWVyKTtcclxuXHJcblxyXG4gICAgICAgICAgICAvL3Nwcml0ZUJ1ZmZlci5XaWR0aCA9IDIwMDtcclxuICAgICAgICAgICAgc3ByaXRlQnVmZmVyLldpZHRoID0gQXBwLkNhbnZhcy5XaWR0aDtcclxuICAgICAgICAgICAgc3ByaXRlQnVmZmVyLkhlaWdodCA9IChpbnQpKHNwcml0ZUJ1ZmZlci5XaWR0aCAqIEFwcC5UYXJnZXRBc3BlY3QpO1xyXG4gICAgICAgICAgICAvKmNhbWVyYS52aWV3cG9ydF93aWR0aCA9IHNwcml0ZUJ1ZmZlci5XaWR0aDtcclxuICAgICAgICAgICAgY2FtZXJhLnZpZXdwb3J0X2hlaWdodCA9IHNwcml0ZUJ1ZmZlci5IZWlnaHQ7Ki9cclxuICAgICAgICAgICAgY2FtZXJhID0gbmV3IENhbWVyYShzcHJpdGVCdWZmZXIuV2lkdGgsIHNwcml0ZUJ1ZmZlci5IZWlnaHQpO1xyXG4gICAgICAgICAgICAvL2NhbWVyYS5TY2FsZSA9IDY7XHJcbiAgICAgICAgICAgIC8vL2NhbWVyYS5TY2FsZSA9IDU7XHJcbiAgICAgICAgICAgIC8vY2FtZXJhLlNjYWxlID0gNDtcclxuICAgICAgICAgICAgLy9jYW1lcmEuU2NhbGUgPSAzLjVmO1xyXG4gICAgICAgICAgICBjYW1lcmEuU2NhbGUgPSAzLjc1ZjtcclxuXHJcbiAgICAgICAgICAgIC8vY2FtZXJhLlNjYWxlID0gMWY7XHJcbiAgICAgICAgICAgIGNhbWVyYS5TdGFnZUJvdW5kcyA9IHN0YWdlQm91bmRzO1xyXG4gICAgICAgICAgICBjYW1lcmEuVXBkYXRlKCk7XHJcbiAgICAgICAgICAgIGNhbWVyYS5pbnN0YXdhcnAgPSB0cnVlO1xyXG4gICAgICAgICAgICAvKnNwcml0ZUJ1ZmZlci5XaWR0aCA9IEFwcC5DYW52YXMuV2lkdGg7XHJcbiAgICAgICAgICAgIHNwcml0ZUJ1ZmZlci5IZWlnaHQgPSBBcHAuQ2FudmFzLkhlaWdodDsqL1xyXG4gICAgICAgICAgICBzcHJpdGVHcmFwaGljcy5JbWFnZVNtb290aGluZ0VuYWJsZWQgPSBmYWxzZTtcclxuXHJcbiAgICAgICAgICAgIC8qUGxhY2VBbmRBZGRFbnRpdHkobmV3IERvb3JLZXkodGhpcykpO1xyXG5cclxuICAgICAgICAgICAgdmFyIGkgPSAwO1xyXG4gICAgICAgICAgICAvL3doaWxlIChpIDwgMTEwKVxyXG4gICAgICAgICAgICB3aGlsZSAoaSA8IDI0KVxyXG4gICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICBQbGFjZUFuZEFkZEVudGl0eShuZXcgTVJHaG9zdHkodGhpcykpO1xyXG4gICAgICAgICAgICAgICAgaSsrO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIGkgPSAwO1xyXG4gICAgICAgICAgICB3aGlsZSAoaSsrIDw9IDYpXHJcbiAgICAgICAgICAgICAgICBQbGFjZUFuZEFkZEVudGl0eShuZXcgT3JiKHRoaXMpKTtcclxuICAgICAgICAgICAgaSA9IDA7XHJcbiAgICAgICAgICAgIHdoaWxlIChpKysgPD0gMylcclxuICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgUGxhY2VBbmRBZGRFbnRpdHkobmV3IENoZXN0KHRoaXMpKTtcclxuICAgICAgICAgICAgICAgIFBsYWNlQW5kQWRkRW50aXR5KG5ldyBLZXlJdGVtKHRoaXMpKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBpID0gMDtcclxuICAgICAgICAgICAgd2hpbGUgKGkrKyA8PSAyKVxyXG4gICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICBQbGFjZUFuZEFkZEVudGl0eShuZXcgSGVhbGluZ0l0ZW0odGhpcykpO1xyXG4gICAgICAgICAgICB9Ki9cclxuICAgICAgICAgICAgU3RhcnROZXh0TGV2ZWwoKTtcclxuXHJcblxyXG4gICAgICAgICAgICBUaW1lclNwcml0ZSA9IG5ldyBUZXh0U3ByaXRlKCk7XHJcbiAgICAgICAgICAgIFRpbWVyU3ByaXRlLkZvbnRTaXplID0gc3ByaXRlQnVmZmVyLkhlaWdodCAvIDI0O1xyXG4gICAgICAgICAgICBUaW1lclNwcml0ZS5UZXh0ID0gXCIzOjAwXCI7XHJcbiAgICAgICAgICAgIFRpbWVyU3ByaXRlLlRleHRDb2xvciA9IFwiI0ZGRkZGRlwiO1xyXG4gICAgICAgICAgICBUaW1lclNwcml0ZS5TaGFkb3dDb2xvciA9IFwiIzAwMDAwMFwiO1xyXG4gICAgICAgICAgICBUaW1lclNwcml0ZS5TaGFkb3dPZmZzZXQgPSBuZXcgVmVjdG9yMigzLCAzKTtcclxuICAgICAgICAgICAgVGltZXJTcHJpdGUuU2hhZG93Qmx1ciA9IDE7XHJcblxyXG4gICAgICAgICAgICBUaW1lclNwcml0ZS5Qb3NpdGlvbi5YID0gc3ByaXRlQnVmZmVyLldpZHRoICogMC40N2Y7XHJcbiAgICAgICAgICAgIFRpbWVyU3ByaXRlLlBvc2l0aW9uLlkgPSAtVGltZXJTcHJpdGUuRm9udFNpemUgLyA4O1xyXG5cclxuICAgICAgICAgICAgU2NvcmVTcHJpdGUgPSBuZXcgVGV4dFNwcml0ZSgpO1xyXG4gICAgICAgICAgICAvL1Njb3JlU3ByaXRlLkZvbnRTaXplID0gc3ByaXRlQnVmZmVyLkhlaWdodCAvIDI0O1xyXG4gICAgICAgICAgICBTY29yZVNwcml0ZS5Gb250U2l6ZSA9IHNwcml0ZUJ1ZmZlci5IZWlnaHQgLyAyODtcclxuICAgICAgICAgICAgU2NvcmVTcHJpdGUuVGV4dCA9IFwiTGV2ZWw6MSBTY29yZTowXCI7XHJcbiAgICAgICAgICAgIFNjb3JlU3ByaXRlLlRleHRDb2xvciA9IFwiI0ZGRkZGRlwiO1xyXG4gICAgICAgICAgICBTY29yZVNwcml0ZS5TaGFkb3dDb2xvciA9IFwiIzAwMDAwMFwiO1xyXG4gICAgICAgICAgICBTY29yZVNwcml0ZS5TaGFkb3dPZmZzZXQgPSBuZXcgVmVjdG9yMigzLCAzKTtcclxuICAgICAgICAgICAgU2NvcmVTcHJpdGUuU2hhZG93Qmx1ciA9IDE7XHJcblxyXG4gICAgICAgICAgICAvL1Njb3JlU3ByaXRlLlBvc2l0aW9uLlggPSBzcHJpdGVCdWZmZXIuV2lkdGggKiAwLjdmO1xyXG4gICAgICAgICAgICBTY29yZVNwcml0ZS5Gb3JjZVVwZGF0ZSgpO1xyXG4gICAgICAgICAgICBTY29yZVNwcml0ZS5Qb3NpdGlvbi5YID0gKHNwcml0ZUJ1ZmZlci5XaWR0aCAqIDAuOThmKSAtIFNjb3JlU3ByaXRlLnNwcml0ZUJ1ZmZlci5XaWR0aDtcclxuICAgICAgICAgICAgU2NvcmVTcHJpdGUuUG9zaXRpb24uWSA9IC1TY29yZVNwcml0ZS5Gb250U2l6ZSAvIDg7XHJcblxyXG4gICAgICAgICAgICBLZXkgPSBBbmltYXRpb25Mb2FkZXIuR2V0KFwiaW1hZ2VzL2l0ZW1zL2tleVwiKVswXTtcclxuICAgICAgICAgICAgQmlnS2V5ID0gQW5pbWF0aW9uTG9hZGVyLkdldChcImltYWdlcy9pdGVtcy9iaWdrZXlcIilbMF07XHJcblxyXG4gICAgICAgICAgICBUUyA9IG5ldyBUaXRsZVNjcmVlbigpO1xyXG4gICAgICAgICAgICBUUy5nYW1lID0gdGhpcztcclxuXHJcbiAgICAgICAgICAgIC8vUGxheU11c2ljKFwidGhlbWUyXCIpO1xyXG4gICAgICAgICAgICBTZXRNdXNpYygpO1xyXG4gICAgICAgIH1cclxuICAgICAgICBwdWJsaWMgdm9pZCBDbGVhckVudGl0aWVzKClcclxuICAgICAgICB7XHJcbiAgICAgICAgICAgIHZhciBMID0gZW50aXRpZXMuVG9BcnJheSgpO1xyXG4gICAgICAgICAgICB2YXIgaSA9IDA7XHJcbiAgICAgICAgICAgIHdoaWxlIChpIDwgTC5MZW5ndGgpXHJcbiAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgIHZhciBFID0gTFtpXTtcclxuICAgICAgICAgICAgICAgIC8vaWYgKCEoRSA9PSBwbGF5ZXIgfHwgRSBpcyBFeGl0RG9vcikpXHJcbiAgICAgICAgICAgICAgICBpZiAoRS5SZW1vdmVkT25MZXZlbEVuZClcclxuICAgICAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgICAgICBFLkFsaXZlID0gZmFsc2U7XHJcbiAgICAgICAgICAgICAgICAgICAgUmVtb3ZlRW50aXR5KEUpO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgaSsrO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHB1YmxpYyB2b2lkIFN0YXJ0TmV4dExldmVsKClcclxuICAgICAgICB7XHJcbiAgICAgICAgICAgIENsZWFyRW50aXRpZXMoKTtcclxuICAgICAgICAgICAgUm9vbU9wZW5pbmdMZXZlci5URVNUID0gbnVsbDtcclxuICAgICAgICAgICAgbGV2ZWwgKz0gMTtcclxuICAgICAgICAgICAgdmFyIFIgPSBzdGFnZUJvdW5kcyAtIFRNLnBvc2l0aW9uO1xyXG4gICAgICAgICAgICBSLndpZHRoIC09IFRNLnRpbGVzaXplO1xyXG4gICAgICAgICAgICBSLmhlaWdodCAtPSBUTS50aWxlc2l6ZTtcclxuICAgICAgICAgICAgVE0uR2VuZXJhdGUoKTtcclxuICAgICAgICAgICAgTWFwR2VuZXJhdG9yLkJveHlHZW5lcmF0ZSh0aGlzKTtcclxuICAgICAgICAgICAgLy9UTS5EcmF3UmVjdChSKTtcclxuICAgICAgICAgICAgLy9UTS5BcHBseUJyZWFrYWJsZSgpO1xyXG5cclxuXHJcbiAgICAgICAgICAgIC8vdmFyIGdob3N0cyA9IChpbnQpKE1hdGguTWluKDE4ICsgbGV2ZWwgKiAyLCAyOCkgKiAwLjg1KTtcclxuICAgICAgICAgICAgdmFyIGdob3N0cyA9IChpbnQpKE1hdGguTWluKDE4ICsgbGV2ZWwgKiAyLCAyOCkgKiAxLjApO1xyXG4gICAgICAgICAgICB2YXIgaSA9IDA7XHJcbiAgICAgICAgICAgIC8vd2hpbGUgKGkgPCAxMTApXHJcbiAgICAgICAgICAgIHdoaWxlIChpIDwgZ2hvc3RzKVxyXG4gICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICAvL2lmIChNYXRoLlJhbmRvbSgpIDwgMC42NylcclxuICAgICAgICAgICAgICAgIGlmIChNYXRoLlJhbmRvbSgpIDwgMC41KVxyXG4gICAgICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgICAgIFBsYWNlQW5kQWRkRW5lbXkobmV3IE1SR2hvc3R5KHRoaXMpKTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIGVsc2VcclxuICAgICAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgICAgICB2YXIgc3Bpa2UgPSBNYXRoLlJhbmRvbSgpIDwgMC4yNTtcclxuICAgICAgICAgICAgICAgICAgICB2YXIgVCA9IG5ldyBUdXJyZXQodGhpcyk7XHJcbiAgICAgICAgICAgICAgICAgICAgUGxhY2VBbmRBZGRFbmVteShUKTtcclxuICAgICAgICAgICAgICAgICAgICBULlNldERvd24oc3Bpa2UpO1xyXG4gICAgICAgICAgICAgICAgICAgIGlmIChzcGlrZSlcclxuICAgICAgICAgICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHZhciBURCA9IFQuVFREO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAoVEQgIT0gbnVsbCAmJiBUTS5yb3dzPlRELnJvdysxKVxyXG4gICAgICAgICAgICAgICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgVEREID0gVE0uZGF0YVtURC5jb2x1bW4sIFRELnJvdyArIDFdO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKFRERC5lbmFibGVkICYmIFRERC5zb2xpZClcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBULkFsaXZlID0gZmFsc2U7XHJcblxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIFRELnRleHR1cmUgPSA3O1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIFRELkJyZWFrYWJsZSA9IGZhbHNlO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIFRELkNhblNsb3BlID0gZmFsc2U7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgVEQub3BhcXVlID0gZmFsc2U7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgVEQuU3RlcHBlZE9uID0gRSA9PlxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFyIElDID0gRS5BczxQbGF5ZXJDaGFyYWN0ZXI+KCk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChJQy5ibG9ja3ByaWNlID4gMCAmJiBJQy5pbnZpbmNpYmlsaXR5dGltZSA8PSAwKVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBJQy5vbkRhbWFnZWQobnVsbCwgMS41ZisobGV2ZWwqMS41ZikpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgSUMuUGxheVNvdW5kKFwiZGFtYWdlZFwiKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChJQy5IUCA8PSAwKVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIElDLm9uRGVhdGgobnVsbCk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9O1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgaSsrO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIGkgPSAwO1xyXG4gICAgICAgICAgICAvL3doaWxlIChpKysgPD0gNilcclxuICAgICAgICAgICAgd2hpbGUgKGkrKyA8PSA0KVxyXG4gICAgICAgICAgICAgICAgUGxhY2VBbmRBZGRFbnRpdHkobmV3IE9yYih0aGlzKSk7XHJcbiAgICAgICAgICAgIGkgPSAwO1xyXG4gICAgICAgICAgICB3aGlsZSAoaSsrIDw9IDMpXHJcbiAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgIFBsYWNlQW5kQWRkRW50aXR5KG5ldyBDaGVzdCh0aGlzKSk7XHJcbiAgICAgICAgICAgICAgICBQbGFjZUFuZEFkZEVudGl0eShuZXcgS2V5SXRlbSh0aGlzKSk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgaSA9IDA7XHJcbiAgICAgICAgICAgIHdoaWxlIChpKysgPD0gMSlcclxuICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgUGxhY2VBbmRBZGRFbnRpdHkobmV3IEhlYWxpbmdJdGVtKHRoaXMpKTtcclxuICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgdmFyIGtleSA9IG5ldyBDaXJub0dhbWUuRG9vcktleSh0aGlzKTtcclxuICAgICAgICAgICAgdmFyIGF0dGVtcHRzID0gMDtcclxuXHJcbiAgICAgICAgICAgIHRoaXMuUGxhY2VBbmRBZGRFbnRpdHkoa2V5KTtcclxuICAgICAgICAgICAgd2hpbGUgKE1hdGguQWJzKGtleS54IC0gcGxheWVyLngpIDwgNzAgJiYgYXR0ZW1wdHMgPCA1KVxyXG4gICAgICAgICAgICB7Ly9hdHRlbXB0IHRvIHByZXZlbnQga2V5IGZyb20gc3Bhd25pbmcgdG9vIGNsb3NlXHJcbiAgICAgICAgICAgICAgICBIZWxwZXIuTG9nKFwiRG9vciBrZXkgaXMgdG9vIGNsb3NlLCByZXBvc2l0aW9uaW5nIGtleS4uLlwiKTtcclxuXHJcbiAgICAgICAgICAgICAgIGtleS5Qb3NpdGlvbi5Db3B5RnJvbShNYXBSb29tLkZpbmRBbnlFbXB0eVNwb3QoKSk7XHJcbiAgICAgICAgICAgICAgICBhdHRlbXB0cyArPSAxO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIE1hcEdlbmVyYXRvci5rZXlyb29tID0gTWFwUm9vbS5GaW5kUm9vbShrZXkuUG9zaXRpb24pO1xyXG4gICAgICAgICAgICAvLy9QbGFjZUFuZEFkZEVudGl0eShuZXcgRG9vcktleSh0aGlzKSk7XHJcbiAgICAgICAgICAgIC8qUGxhY2VBbmRBZGRFbnRpdHkobmV3IERvb3JLZXkodGhpcykpO1xyXG4gICAgICAgICAgICBQbGFjZUFuZEFkZEVudGl0eShuZXcgRG9vcktleSh0aGlzKSk7XHJcbiAgICAgICAgICAgIFBsYWNlQW5kQWRkRW50aXR5KG5ldyBEb29yS2V5KHRoaXMpKTtcclxuICAgICAgICAgICAgUGxhY2VBbmRBZGRFbnRpdHkobmV3IERvb3JLZXkodGhpcykpOyovXHJcblxyXG4gICAgICAgICAgICBwbGF5ZXIuaW52aW5jaWJpbGl0eXRpbWUgPSAxODA7XHJcbiAgICAgICAgICAgIGNhbWVyYS5pbnN0YXdhcnAgPSB0cnVlO1xyXG4gICAgICAgICAgICBza2lwcmVuZGVyID0gdHJ1ZTtcclxuICAgICAgICAgICAgaWYgKHBsYXlpbmcpXHJcbiAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgIFNldE11c2ljKCk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcbiAgICAgICAgcHVibGljIHZvaWQgU2V0TXVzaWMoKVxyXG4gICAgICAgIHtcclxuICAgICAgICAgICAgaWYgKCFwbGF5aW5nKVxyXG4gICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICBQbGF5TXVzaWMoXCJ0aGVtZTNcIik7XHJcbiAgICAgICAgICAgICAgICByZXR1cm47XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgdmFyIHNvbmdzID0gMztcclxuICAgICAgICAgICAgdmFyIGxldmVsc3BlcnNvbmcgPSA1O1xyXG4gICAgICAgICAgICB2YXIgUyA9IChpbnQpKGxldmVsIC8gbGV2ZWxzcGVyc29uZyk7XHJcbiAgICAgICAgICAgIFMgPSBTICUgc29uZ3M7XHJcbiAgICAgICAgICAgIFBsYXlNdXNpYyhcInRoZW1lXCIgKyAoUyArIDEpKTtcclxuICAgICAgICB9XHJcbiAgICAgICAgcHVibGljIHZvaWQgUGxhY2VBbmRBZGRFbnRpdHkoRW50aXR5IEUpXHJcbiAgICAgICAge1xyXG4gICAgICAgICAgICBFLlBvc2l0aW9uLkNvcHlGcm9tKE1hcFJvb20uRmluZEFueUVtcHR5U3BvdCgpKTtcclxuICAgICAgICAgICAgQWRkRW50aXR5KEUpO1xyXG4gICAgICAgIH1cclxuICAgICAgICBwdWJsaWMgdm9pZCBQbGFjZUFuZEFkZEVuZW15KEVudGl0eSBFKVxyXG4gICAgICAgIHtcclxuICAgICAgICAgICAgRS5Qb3NpdGlvbi5Db3B5RnJvbShNYXBSb29tLkZpbmRBbnlFbXB0eVNwb3QoKSk7XHJcbiAgICAgICAgICAgIHZhciBhdHRlbXB0cyA9IDE7XHJcbiAgICAgICAgICAgIHdoaWxlIChFLlBvc2l0aW9uLkVzdGltYXRlZERpc3RhbmNlKHRoaXMucGxheWVyLlBvc2l0aW9uKSA8IDEyOCAmJiBhdHRlbXB0cyA8IDUpXHJcbiAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgIEhlbHBlci5Mb2coXCJFbmVteSBzcGF3bmVkIHRvbyBjbG9zZSwgcmVwb3NpdGlvbmluZyBlbmVteS4uLlwiKTtcclxuXHJcbiAgICAgICAgICAgICAgICAgRS5Qb3NpdGlvbi5Db3B5RnJvbShNYXBSb29tLkZpbmRBbnlFbXB0eVNwb3QoKSk7XHJcbiAgICAgICAgICAgICAgICBhdHRlbXB0cyArPSAxO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIHRoaXMuQWRkRW50aXR5KEUpO1xyXG4gICAgICAgICAgICBBZGRFbnRpdHkoRSk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHB1YmxpYyBzdGF0aWMgc3RyaW5nIEdldFRlYW1Db2xvcihpbnQgdGVhbSlcclxuICAgICAgICB7XHJcbiAgICAgICAgICAgIGlmICh0ZWFtID09IDEpXHJcbiAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgIHJldHVybiBcIiNGRjAwMDBcIjtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBlbHNlIGlmICh0ZWFtID09IDIgfHwgdGVhbSA9PSAwKVxyXG4gICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gXCIjMDAwMEZGXCI7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgZWxzZSBpZiAodGVhbSA9PSAzKVxyXG4gICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gXCIjRkZGRjAwXCI7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgcmV0dXJuIFwiIzAwMDAwMFwiO1xyXG4gICAgICAgIH1cclxuICAgICAgICBwdWJsaWMgYm9vbCBtdXRlZCA9IGZhbHNlO1xyXG4gICAgICAgIGJvb2wgbGFzdFBhdXNlQnV0dG9uU3RhdGUgPSBmYWxzZTtcclxuICAgICAgICBwdWJsaWMgb3ZlcnJpZGUgdm9pZCBVcGRhdGUoKVxyXG4gICAgICAgIHtcclxuICAgICAgICAgICAgYmFzZS5VcGRhdGUoKTtcclxuICAgICAgICAgICAgVGVhbXMgPSBHYW1lUGxheVNldHRpbmdzLkdhbWVNb2RlLlRlYW1zO1xyXG4gICAgICAgICAgICAvL2lmIChwbGF5aW5nICYmIEtleWJvYXJkTWFuYWdlci5fdGhpcy5UYXBwZWRCdXR0b25zLkNvbnRhaW5zKDEzKSlcclxuICAgICAgICAgICAgaWYgKHBsYXlpbmcgJiYgQXBwLklDLmdldFByZXNzZWQoNSkgJiYgIWxhc3RQYXVzZUJ1dHRvblN0YXRlKVxyXG4gICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICBwYXVzZWQgPSAhcGF1c2VkO1xyXG4gICAgICAgICAgICAgICAgLy8vS2V5Ym9hcmRNYW5hZ2VyLl90aGlzLlRhcHBlZEJ1dHRvbnMuUmVtb3ZlKDEzKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBsYXN0UGF1c2VCdXR0b25TdGF0ZSA9IEFwcC5JQy5nZXRQcmVzc2VkKDUpO1xyXG4gICAgICAgICAgICBpZiAocGxheWluZyAmJiBLZXlib2FyZE1hbmFnZXIuX3RoaXMuVGFwcGVkQnV0dG9ucy5Db250YWlucyg3NykpXHJcbiAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgIEF1ZGlvTWFuYWdlci5fdGhpcy5TdG9wQWxsKCk7XHJcbiAgICAgICAgICAgICAgICBtdXRlZCA9ICFtdXRlZDtcclxuICAgICAgICAgICAgICAgIGlmICghbXV0ZWQpXHJcbiAgICAgICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICAgICAgU2V0TXVzaWMoKTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIEtleWJvYXJkTWFuYWdlci5fdGhpcy5UYXBwZWRCdXR0b25zLlJlbW92ZSg3Nyk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgaWYgKCFwYXVzZWQpXHJcbiAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgIFVwZGF0ZUNvbnRyb2xzKCk7XHJcblxyXG4gICAgICAgICAgICAgICAgdmFyIGkgPSAwO1xyXG4gICAgICAgICAgICAgICAgd2hpbGUgKGkgPCBlbnRpdGllcy5Db3VudClcclxuICAgICAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgICAgICB2YXIgRSA9IGVudGl0aWVzW2ldO1xyXG4gICAgICAgICAgICAgICAgICAgIGlmIChFLkFsaXZlKVxyXG4gICAgICAgICAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgRS5VcGRhdGUoKTtcclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKCFFLkFsaXZlKVxyXG4gICAgICAgICAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgUmVtb3ZlRW50aXR5KEUpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBpLS07XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgIGkrKztcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIFVwZGF0ZUNvbGxpc2lvbnMoKTtcclxuICAgICAgICAgICAgICAgIFVwZGF0ZVRpbWUoKTtcclxuICAgICAgICAgICAgICAgIGlmIChwbGF5aW5nICYmIHBsYXllci55IDwgMClcclxuICAgICAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgICAgICAvL3BsYXllciBnbGl0Y2hlZCBvdXQgc29tZWhvdyBtYWtlIGEgbmV3IGxldmVsLlxyXG4gICAgICAgICAgICAgICAgICAgIExldmVsUmVzdGFydCgpO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIGVsc2VcclxuICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgVGltZXJTcHJpdGUuVGV4dCA9IFwiUGF1c2VkXCI7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcbiAgICAgICAgcHVibGljIHZvaWQgTGV2ZWxSZXN0YXJ0KClcclxuICAgICAgICB7XHJcbiAgICAgICAgICAgIGxldmVsLS07XHJcbiAgICAgICAgICAgIFN0YXJ0TmV4dExldmVsKCk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHB1YmxpYyB2b2lkIERvR2FtZU92ZXIoKVxyXG4gICAgICAgIHtcclxuICAgICAgICAgICAgaWYgKCFwbGF5aW5nKVxyXG4gICAgICAgICAgICAgICAgcmV0dXJuO1xyXG4gICAgICAgICAgICBpZiAoZW50aXRpZXMuQ29udGFpbnMocGxheWVyKSlcclxuICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgUmVtb3ZlRW50aXR5KHBsYXllcik7XHJcbiAgICAgICAgICAgICAgICAvL0RvR2FtZU92ZXIoKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBwbGF5aW5nID0gZmFsc2U7XHJcbiAgICAgICAgICAgIFN0YXJ0TmV4dExldmVsKCk7XHJcblxyXG4gICAgICAgIH1cclxuICAgICAgICBwdWJsaWMgdm9pZCBVcGRhdGVUaW1lKClcclxuICAgICAgICB7XHJcbiAgICAgICAgICAgIC8vdGltZVJlbWFpbmluZyAtPSAxNi42NjY2N2Y7XHJcbiAgICAgICAgICAgIGlmIChwYXVzZWQpXHJcbiAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgIFRpbWVyU3ByaXRlLlRleHQgPSBcIlBhdXNlZFwiO1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIGlmICh0aW1lUmVtYWluaW5nIDw9IDApXHJcbiAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgIHRpbWVSZW1haW5pbmcgPSAwO1xyXG4gICAgICAgICAgICAgICAgVGltZXJTcHJpdGUuVGV4dCA9IFwiMFwiO1xyXG4gICAgICAgICAgICAgICAgVGltZXJTcHJpdGUuVGV4dENvbG9yID0gXCIjRkYwMDAwXCI7XHJcbiAgICAgICAgICAgICAgICBpZiAocGxheWVyLkhQID4gMClcclxuICAgICAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgICAgICBwbGF5ZXIuSFAgLT0gMC4wMDZmO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgZWxzZVxyXG4gICAgICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgICAgIERvR2FtZU92ZXIoKTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIHJldHVybjtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBlbHNlIGlmICh0aW1lUmVtYWluaW5nIDwgYmFzZUxpZmVDb3N0KVxyXG4gICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICBUaW1lclNwcml0ZS5UZXh0Q29sb3IgPSBcIiNGRjAwMDBcIjtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBlbHNlIGlmICh0aW1lUmVtYWluaW5nIDwgbGFzdFN0YW5kKVxyXG4gICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICBUaW1lclNwcml0ZS5UZXh0Q29sb3IgPSBcIiNGRkZGMDBcIjtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBlbHNlXHJcbiAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgIFRpbWVyU3ByaXRlLlRleHRDb2xvciA9IFwiI0ZGRkZGRlwiO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIHZhciB0b3RhbHNlY29uZHMgPSB0aW1lUmVtYWluaW5nIC8gMTAwMGY7XHJcbiAgICAgICAgICAgIHZhciB0b3RhbG1pbnV0ZXMgPSB0b3RhbHNlY29uZHMgLyA2MDtcclxuXHJcbiAgICAgICAgICAgIHZhciBtaW51dGVzID0gKGludClNYXRoLkZsb29yKHRvdGFsbWludXRlcyk7XHJcbiAgICAgICAgICAgIHZhciBzZWNvbmRzID0gKHRvdGFsc2Vjb25kcyAtIChtaW51dGVzICogNjApKTtcclxuXHJcbiAgICAgICAgICAgIHZhciBTID0gXCJcIjtcclxuICAgICAgICAgICAgaWYgKG1pbnV0ZXMgPiAwKVxyXG4gICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICBTID0gXCJcIiArIG1pbnV0ZXMgKyBcIjpcIjtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB2YXIgcHJlZml4ID0gXCJcIjtcclxuICAgICAgICAgICAgaWYgKHNlY29uZHMgPCAxMClcclxuICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgcHJlZml4ID0gXCIwXCI7XHJcbiAgICAgICAgICAgICAgICBpZiAodG90YWxzZWNvbmRzIDwgMTApXHJcbiAgICAgICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICAgICAgcHJlZml4ID0gXCIgXCI7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgUyA9IFMgKyBSZXN0cmljdExlbmd0aChwcmVmaXggKyBNYXRoLk1heCgwLCBzZWNvbmRzKSwgNCk7XHJcbiAgICAgICAgICAgIGlmICh0b3RhbHNlY29uZHMgPj0gNjApXHJcbiAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgIGlmIChTLkluZGV4T2YoXCIuXCIpID49IDApXHJcbiAgICAgICAgICAgICAgICAgICAgUyA9IFMuU3BsaXQoXCIuXCIpWzBdO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIFRpbWVyU3ByaXRlLlRleHQgPSBTO1xyXG4gICAgICAgIH1cclxuICAgICAgICBwdWJsaWMgc3RyaW5nIFJlc3RyaWN0TGVuZ3RoKHN0cmluZyBzLCBpbnQgbGVuZ3RoKVxyXG4gICAgICAgIHtcclxuICAgICAgICAgICAgaWYgKHMuTGVuZ3RoID4gbGVuZ3RoKVxyXG4gICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gcy5TdWJzdHIoMCwgbGVuZ3RoKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICByZXR1cm4gcztcclxuICAgICAgICB9XHJcbiAgICAgICAgcHVibGljIHZvaWQgVXBkYXRlQ29sbGlzaW9ucygpXHJcbiAgICAgICAge1xyXG4gICAgICAgICAgICAvL0xpc3Q8RW50aXR5PiBjb21iYXRhbnRzID0gbmV3IExpc3Q8RW50aXR5PihTeXN0ZW0uTGlucS5FbnVtZXJhYmxlLldoZXJlPGdsb2JhbDo6Q2lybm9HYW1lLkVudGl0eT4oZW50aXRpZXMsIChnbG9iYWw6OlN5c3RlbS5GdW5jPGdsb2JhbDo6Q2lybm9HYW1lLkVudGl0eSwgYm9vbD4pKGVudGl0eSA9PiBlbnRpdHkgaXMgSUNvbWJhdGFudCAmJiBlbnRpdHkuQW5pLkN1cnJlbnRJbWFnZSAhPSBudWxsICYmICgoSUNvbWJhdGFudCllbnRpdHkpLkhQID4gMCkpKTtcclxuICAgICAgICAgICAgLy9MaXN0PEVudGl0eT4gaGFybWZ1bEVudGl0eSA9IG5ldyBMaXN0PEVudGl0eT4oU3lzdGVtLkxpbnEuRW51bWVyYWJsZS5XaGVyZTxnbG9iYWw6OkNpcm5vR2FtZS5FbnRpdHk+KGVudGl0aWVzLCAoZ2xvYmFsOjpTeXN0ZW0uRnVuYzxnbG9iYWw6OkNpcm5vR2FtZS5FbnRpdHksIGJvb2w+KShlbnRpdHkgPT4gZW50aXR5IGlzIElIYXJtZnVsRW50aXR5ICYmIGVudGl0eS5BbmkuQ3VycmVudEltYWdlICE9IG51bGwpKSk7XHJcbiAgICAgICAgICAgIC8vL0xpc3Q8RW50aXR5PiBjb21iYXRhbnRzID0gbmV3IExpc3Q8RW50aXR5PihlbnRpdGllcy5XaGVyZShlbnRpdHkgPT4gZW50aXR5IGlzIElDb21iYXRhbnQgJiYgZW50aXR5LkFuaS5DdXJyZW50SW1hZ2UgIT0gbnVsbCAmJiAoKElDb21iYXRhbnQpZW50aXR5KS5IUCA+IDApKTtcclxuICAgICAgICAgICAgLy8vTGlzdDxFbnRpdHk+IGhhcm1mdWxFbnRpdHkgPSBuZXcgTGlzdDxFbnRpdHk+KGVudGl0aWVzLldoZXJlKGVudGl0eSA9PiBlbnRpdHkgaXMgSUhhcm1mdWxFbnRpdHkgJiYgZW50aXR5LkFuaS5DdXJyZW50SW1hZ2UgIT0gbnVsbCkpO1xyXG4gICAgICAgICAgICBMaXN0PEVudGl0eT4gY29tYmF0YW50cyA9IG5ldyBMaXN0PEVudGl0eT4oU3lzdGVtLkxpbnEuRW51bWVyYWJsZS5XaGVyZTxnbG9iYWw6OkNpcm5vR2FtZS5FbnRpdHk+KHRoaXMuY29tYmF0YW50cywoZ2xvYmFsOjpTeXN0ZW0uRnVuYzxnbG9iYWw6OkNpcm5vR2FtZS5FbnRpdHksIGJvb2w+KShlbnRpdHkgPT4gZW50aXR5LkFuaS5DdXJyZW50SW1hZ2UgIT0gbnVsbCAmJiAoZW50aXR5LkFzPElDb21iYXRhbnQ+KCkpLkhQID4gMCkpKTtcclxuICAgICAgICAgICAgTGlzdDxFbnRpdHk+IGhhcm1mdWxFbnRpdHkgPSBuZXcgTGlzdDxFbnRpdHk+KFN5c3RlbS5MaW5xLkVudW1lcmFibGUuV2hlcmU8Z2xvYmFsOjpDaXJub0dhbWUuRW50aXR5PihoYXJtZnVsLChnbG9iYWw6OlN5c3RlbS5GdW5jPGdsb2JhbDo6Q2lybm9HYW1lLkVudGl0eSwgYm9vbD4pKGVudGl0eSA9PiBlbnRpdHkuQW5pLkN1cnJlbnRJbWFnZSAhPSBudWxsKSkpO1xyXG4gICAgICAgICAgICB2YXIgUjIgPSBuZXcgUmVjdGFuZ2xlKCk7XHJcbiAgICAgICAgICAgIHZhciBPUjIgPSBuZXcgUmVjdGFuZ2xlKCk7XHJcbiAgICAgICAgICAgIGludCBpID0gMDtcclxuICAgICAgICAgICAgdmFyIGNvdW50ID0gY29tYmF0YW50cy5Db3VudDtcclxuICAgICAgICAgICAgVmVjdG9yMiBzcGQgPSBuZXcgVmVjdG9yMigpO1xyXG4gICAgICAgICAgICBWZWN0b3IyIHNwZDIgPSBuZXcgVmVjdG9yMigpO1xyXG4gICAgICAgICAgICB3aGlsZSAoaSA8IGNvdW50KVxyXG4gICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICBFbnRpdHkgRSA9IGNvbWJhdGFudHNbaV07XHJcbiAgICAgICAgICAgICAgICAvL2lmIChFIGlzIElDb21iYXRhbnQpXHJcbiAgICAgICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICAgICAgSUNvbWJhdGFudCBFSSA9IChJQ29tYmF0YW50KUUuQXM8SUNvbWJhdGFudD4oKTtcclxuICAgICAgICAgICAgICAgICAgICBSZWN0YW5nbGUgUiA9IEUuR2V0SGl0Ym94KCk7XHJcbiAgICAgICAgICAgICAgICAgICAgc3BkLkNvcHlGcm9tKEUuU3BlZWQpO1xyXG4gICAgICAgICAgICAgICAgICAgIHNwZC5NdWx0aXBseSgwLjVmKTtcclxuICAgICAgICAgICAgICAgICAgICAvL1ZlY3RvcjIgc3BkID0gRS5TcGVlZCAqIDAuNWY7XHJcbiAgICAgICAgICAgICAgICAgICAgLy9zcGQuQ29weUZyb20oKVxyXG4gICAgICAgICAgICAgICAgICAgIC8vUmVjdGFuZ2xlIFIyID0gbmV3IFJlY3RhbmdsZShSLnggLSAoc3BkLlgpLCBSLnkgLSAoc3BkLlkpLCBSLndpZHRoLCBSLmhlaWdodCk7XHJcbiAgICAgICAgICAgICAgICAgICAgUjIuU2V0KFIueCAtIChzcGQuWCksIFIueSAtIChzcGQuWSksIFIud2lkdGgsIFIuaGVpZ2h0KTtcclxuICAgICAgICAgICAgICAgICAgICAvL0xpc3Q8RW50aXR5PiBMID0gbmV3IExpc3Q8RW50aXR5PihoYXJtZnVsRW50aXR5LldoZXJlKGVudGl0eSA9PiBlbnRpdHkgIT0gRSAmJiBlbnRpdHkuR2V0SGl0Ym94KCkuaXNUb3VjaGluZyhSKSkpO1xyXG4gICAgICAgICAgICAgICAgICAgIC8vTGlzdDxFbnRpdHk+IEwgPSBuZXcgTGlzdDxFbnRpdHk+KGhhcm1mdWxFbnRpdHkuV2hlcmUoZW50aXR5ID0+IGVudGl0eSAhPSBFICYmICgoSUNvbWJhdGFudCkoKElIYXJtZnVsRW50aXR5KWVudGl0eSkuQXR0YWNrZXIpLlRlYW0gIT0gRUkuVGVhbSkpO1xyXG4gICAgICAgICAgICAgICAgICAgIC8vTGlzdDxFbnRpdHk+IEwgPSBuZXcgTGlzdDxFbnRpdHk+KFN5c3RlbS5MaW5xLkVudW1lcmFibGUuV2hlcmU8Z2xvYmFsOjpDaXJub0dhbWUuRW50aXR5PihoYXJtZnVsRW50aXR5LCAoZ2xvYmFsOjpTeXN0ZW0uRnVuYzxnbG9iYWw6OkNpcm5vR2FtZS5FbnRpdHksIGJvb2w+KShlbnRpdHkgPT4gZW50aXR5ICE9IEUgJiYgISgoSUhhcm1mdWxFbnRpdHkpZW50aXR5KS5BdHRhY2tlci5TYW1lVGVhbSgoRW50aXR5KUVJKSkpKTtcclxuICAgICAgICAgICAgICAgICAgICBMaXN0PEVudGl0eT4gTCA9IG5ldyBMaXN0PEVudGl0eT4oU3lzdGVtLkxpbnEuRW51bWVyYWJsZS5XaGVyZTxnbG9iYWw6OkNpcm5vR2FtZS5FbnRpdHk+KGhhcm1mdWxFbnRpdHksKGdsb2JhbDo6U3lzdGVtLkZ1bmM8Z2xvYmFsOjpDaXJub0dhbWUuRW50aXR5LCBib29sPikoZW50aXR5ID0+IGVudGl0eSAhPSBFICYmICEoZW50aXR5LkFzPElIYXJtZnVsRW50aXR5PigpKS5BdHRhY2tlci5TYW1lVGVhbShFSS5BczxFbnRpdHk+KCkpKSkpO1xyXG4gICAgICAgICAgICAgICAgICAgIGludCBqID0gMDtcclxuICAgICAgICAgICAgICAgICAgICB2YXIgbG4gPSBMLkNvdW50O1xyXG4gICAgICAgICAgICAgICAgICAgIHdoaWxlIChqIDwgbG4pXHJcbiAgICAgICAgICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBFbnRpdHkgdG1wID0gTFtqXTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgSUhhcm1mdWxFbnRpdHkgSEUgPSB0bXAuQXM8SUhhcm1mdWxFbnRpdHk+KCk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIFJlY3RhbmdsZSBPUiA9IHRtcC5HZXRIaXRib3goKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgLy9WZWN0b3IyIHNwZDIgPSB0bXAuU3BlZWQgKiAwLjVmO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBzcGQyLkNvcHlGcm9tKHRtcC5TcGVlZCk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHNwZDIuTXVsdGlwbHkoMC41Zik7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIC8vUmVjdGFuZ2xlIE9SMiA9IG5ldyBSZWN0YW5nbGUoT1IueCAtIChzcGQyLlgpLCBPUi55IC0gKHNwZDIuWSksIE9SLndpZHRoLCBPUi5oZWlnaHQpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBPUjIuU2V0KE9SLnggLSAoc3BkMi5YKSwgT1IueSAtIChzcGQyLlkpLCBPUi53aWR0aCwgT1IuaGVpZ2h0KTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgLy9pZiAoRUkuVGVhbSAhPSAoKElDb21iYXRhbnQpSEUuQXR0YWNrZXIpLlRlYW0pXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmICgoUi5pc1RvdWNoaW5nKE9SKSB8fCBSMi5pc1RvdWNoaW5nKE9SMikpKVxyXG4gICAgICAgICAgICAgICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoSEUub250b3VjaERhbWFnZShFSSkpXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFyIExIUCA9IEVJLkhQO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIEVJLm9uRGFtYWdlZChIRSwgSEUudG91Y2hEYW1hZ2UpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhciBkYW1hZ2VkID0gTEhQID4gRUkuSFA7XHJcblxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChkYW1hZ2VkKVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKEVJID09IHBsYXllcilcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgRUkuQXM8RW50aXR5PigpLlBsYXlTb3VuZChcImRhbWFnZWRcIik7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZWxzZVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBFSS5BczxFbnRpdHk+KCkuUGxheVNvdW5kKFwiaGl0XCIpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoRUkuSFAgPD0gMClcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChFSS5BczxFbnRpdHk+KCkuSGFuZGxlZExvY2FsbHkpXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGR5bmFtaWMgRCA9IG5ldyBvYmplY3QoKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIEQuSSA9IEVJLkFzPEVudGl0eT4oKS5JRDtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIEQuQSA9IEhFLkF0dGFja2VyLklEO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgRC5TID0gSEUuQXM8RW50aXR5PigpLklEO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgU2VuZEV2ZW50KFwiS2lsbFwiLCBEKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAvKmlmIChkYW1hZ2VkKVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBFSS5BczxFbnRpdHk+KCkuUGxheVNvdW5kKFwia2lsbFwiKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfSovXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVsc2VcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8qaWYgKGRhbWFnZWQpXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIEVJLkFzPEVudGl0eT4oKS5QbGF5U291bmQoXCJoaXRcIik7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0qL1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIEF0dGFjayhFSS5BczxJQ29tYmF0YW50PigpLCBIRS5BczxJSGFybWZ1bEVudGl0eT4oKSk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICAgICAgaisrO1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICAvKkxpc3Q8RW50aXR5PiBMID0gbmV3IExpc3Q8RW50aXR5Pihjb21iYXRhbnRzLldoZXJlKGVudGl0eSA9PiBlbnRpdHkgIT0gRSAmJiBlbnRpdHkgaXMgSUNvbWJhdGFudCAmJiBlbnRpdHkuR2V0SGl0Ym94KCkuaW50ZXJzZWN0cyhSKSkpO1xyXG4gICAgICAgICAgICAgICAgICAgIGludCBqID0gMDtcclxuICAgICAgICAgICAgICAgICAgICB3aGlsZSAoaiA8IEwuQ291bnQpXHJcbiAgICAgICAgICAgICAgICAgICAge1xyXG5cclxuICAgICAgICAgICAgICAgICAgICAgICAgaisrO1xyXG4gICAgICAgICAgICAgICAgICAgIH0qL1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgaSsrO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHB1YmxpYyB2b2lkIEF0dGFjayhJQ29tYmF0YW50IHRhcmdldCwgSUhhcm1mdWxFbnRpdHkgc291cmNlKVxyXG4gICAgICAgIHtcclxuICAgICAgICAgICAgaWYgKHRhcmdldC5IUCA+IDAgJiYgc291cmNlLm9udG91Y2hEYW1hZ2UodGFyZ2V0KSlcclxuICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgdGFyZ2V0Lm9uRGFtYWdlZChzb3VyY2UsIHNvdXJjZS50b3VjaERhbWFnZSk7XHJcbiAgICAgICAgICAgICAgICAvLygoRW50aXR5KXRhcmdldCkuUGxheVNvdW5kKFwiaGl0XCIpO1xyXG4gICAgICAgICAgICAgICAgaWYgKHRhcmdldC5IUCA8PSAwKVxyXG4gICAgICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgICAgIGlmICgoKEVudGl0eSl0YXJnZXQpLkhhbmRsZWRMb2NhbGx5KVxyXG4gICAgICAgICAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgZHluYW1pYyBEID0gbmV3IG9iamVjdCgpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBELkkgPSAoKEVudGl0eSl0YXJnZXQpLklEO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBELkEgPSAoKEVudGl0eSlzb3VyY2UuQXR0YWNrZXIpLklEO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBELlMgPSAoKEVudGl0eSlzb3VyY2UpLklEO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBTZW5kRXZlbnQoXCJLaWxsXCIsIEQpO1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuICAgICAgICBwdWJsaWMgdm9pZCBQbGF5U291bmRFZmZlY3QoVmVjdG9yMiBzb3VyY2UsIHN0cmluZyBzb3VuZClcclxuICAgICAgICB7XHJcbiAgICAgICAgICAgIGlmIChtdXRlZClcclxuICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIGZsb2F0IHZvbCA9IDFmO1xyXG4gICAgICAgICAgICAvKmZsb2F0IG1pbiA9IDY0MDtcclxuICAgICAgICAgICAgZmxvYXQgbWF4TGVuZ3RoID0gMzIwOyovXHJcbiAgICAgICAgICAgIC8vZmxvYXQgbWluID0gNzAwO1xyXG4gICAgICAgICAgICBmbG9hdCBtaW4gPSA1MDtcclxuICAgICAgICAgICAgZmxvYXQgbWF4TGVuZ3RoID0gMjAwO1xyXG4gICAgICAgICAgICBpZiAoc291cmNlICE9IG51bGwpXHJcbiAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgIC8vZmxvYXQgZGlzdCA9IChjYW1lcmEuQ2VudGVyIC0gc291cmNlKS5Sb3VnaExlbmd0aDtcclxuICAgICAgICAgICAgICAgIC8vZmxvYXQgZGlzdCA9IChjYW1lcmEuQ2VudGVyIC0gc291cmNlKS5MZW5ndGg7XHJcbiAgICAgICAgICAgICAgICBmbG9hdCBkaXN0ID0gY2FtZXJhLkNlbnRlci5Fc3RpbWF0ZWREaXN0YW5jZShzb3VyY2UpO1xyXG4gICAgICAgICAgICAgICAgZGlzdCAtPSBtaW47XHJcbiAgICAgICAgICAgICAgICBpZiAoZGlzdCA+IDApXHJcbiAgICAgICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKGRpc3QgPj0gbWF4TGVuZ3RoKVxyXG4gICAgICAgICAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgLy92b2x1bWUgb2YgMCwganVzdCBkb24ndCBwbGF5IGl0LlxyXG4gICAgICAgICAgICAgICAgICAgICAgICByZXR1cm47XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgIGVsc2VcclxuICAgICAgICAgICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHZvbCA9IDFmIC0gKGRpc3QgLyBtYXhMZW5ndGgpO1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBBdWRpb01hbmFnZXIuX3RoaXMuQmxhc3QoXCJTRlgvXCIgKyBzb3VuZCArIFwiLm9nZ1wiLCB2b2wpO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgcHVibGljIHZvaWQgQWRkRW50aXR5KEVudGl0eSBFKVxyXG4gICAgICAgIHtcclxuICAgICAgICAgICAgZW50aXRpZXMuQWRkKEUpO1xyXG4gICAgICAgICAgICBpZiAoRSBpcyBJQ29tYmF0YW50KVxyXG4gICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICBjb21iYXRhbnRzLkFkZChFLlRvRHluYW1pYygpKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBpZiAoRSBpcyBJSGFybWZ1bEVudGl0eSlcclxuICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgaGFybWZ1bC5BZGQoRS5Ub0R5bmFtaWMoKSk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcbiAgICAgICAgcHVibGljIHZvaWQgUmVtb3ZlRW50aXR5KEVudGl0eSBFKVxyXG4gICAgICAgIHtcclxuICAgICAgICAgICAgRS5vblJlbW92ZSgpO1xyXG4gICAgICAgICAgICBlbnRpdGllcy5SZW1vdmUoRSk7XHJcbiAgICAgICAgICAgIGlmIChFIGlzIElDb21iYXRhbnQpXHJcbiAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgIGNvbWJhdGFudHMuUmVtb3ZlKEUuVG9EeW5hbWljKCkpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIGlmIChFIGlzIElIYXJtZnVsRW50aXR5KVxyXG4gICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICBoYXJtZnVsLlJlbW92ZShFLlRvRHluYW1pYygpKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuICAgICAgICBwdWJsaWMgb3ZlcnJpZGUgdm9pZCBSZW5kZXIoKVxyXG4gICAgICAgIHtcclxuICAgICAgICAgICAgYmFzZS5SZW5kZXIoKTtcclxuXHJcbiAgICAgICAgICAgIENhbnZhc1JlbmRlcmluZ0NvbnRleHQyRCBnID0gc3ByaXRlR3JhcGhpY3M7XHJcbiAgICAgICAgICAgIGlmIChza2lwcmVuZGVyKVxyXG4gICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICBnID0gRUc7XHJcbiAgICAgICAgICAgICAgICBza2lwcmVuZGVyID0gZmFsc2U7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgVXBkYXRlQ2FtZXJhKCk7XHJcbiAgICAgICAgICAgIERyYXdCYWNrZ3JvdW5kKGcpO1xyXG5cclxuICAgICAgICAgICAgZy5TYXZlKCk7XHJcblxyXG4gICAgICAgICAgICBjYW1lcmEuQXBwbHkoZyk7XHJcbiAgICAgICAgICAgIC8vVE0ucG9zaXRpb24uWSA9IC0yMDA7XHJcbiAgICAgICAgICAgIFRNLkRyYXcoZyk7XHJcbiAgICAgICAgICAgIGVudGl0aWVzLkZvckVhY2goKGdsb2JhbDo6U3lzdGVtLkFjdGlvbjxnbG9iYWw6OkNpcm5vR2FtZS5FbnRpdHk+KShFID0+IHsgaWYgKEUuQWxpdmUgJiYgRS5WaXNpYmxlKSB7IEUuRHJhdyhnKTsgfSB9KSk7XHJcblxyXG4gICAgICAgICAgICBnLlJlc3RvcmUoKTtcclxuXHJcbiAgICAgICAgICAgIGlmIChwbGF5aW5nKVxyXG4gICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICBSZW5kZXJHVUkoZyk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgZWxzZVxyXG4gICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICBnLkdsb2JhbEFscGhhID0gMC4zZjtcclxuICAgICAgICAgICAgICAgIGcuRmlsbFN0eWxlID0gXCIjMDAwMDAwXCI7XHJcbiAgICAgICAgICAgICAgICBnLkZpbGxSZWN0KDAsIDAsIHNwcml0ZUJ1ZmZlci5XaWR0aCwgc3ByaXRlQnVmZmVyLkhlaWdodCk7XHJcbiAgICAgICAgICAgICAgICBnLkdsb2JhbEFscGhhID0gMWY7XHJcbiAgICAgICAgICAgICAgICBUUy5EcmF3KGcpO1xyXG4gICAgICAgICAgICAgICAgaWYgKHBsYXllci5zY29yZSA+IDApXHJcbiAgICAgICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICAgICAgU2NvcmVTcHJpdGUuVGV4dCA9IFwiTGV2ZWw6XCIgKyBsZXZlbCArIFwiIFNjb3JlOlwiICsgcGxheWVyLnNjb3JlO1xyXG4gICAgICAgICAgICAgICAgICAgIFNjb3JlU3ByaXRlLkZvcmNlVXBkYXRlKCk7XHJcbiAgICAgICAgICAgICAgICAgICAgU2NvcmVTcHJpdGUuUG9zaXRpb24uWCA9IChzcHJpdGVCdWZmZXIuV2lkdGggKiAwLjk4ZikgLSBTY29yZVNwcml0ZS5zcHJpdGVCdWZmZXIuV2lkdGg7XHJcbiAgICAgICAgICAgICAgICAgICAgU2NvcmVTcHJpdGUuRHJhdyhnKTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICB9XHJcbiAgICAgICAgcHVibGljIHZvaWQgU3RhcnQoKVxyXG4gICAgICAgIHtcclxuICAgICAgICAgICAgaWYgKGVudGl0aWVzLkNvbnRhaW5zKHBsYXllcikpXHJcbiAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgIFJlbW92ZUVudGl0eShwbGF5ZXIpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIHBsYXllciA9IG5ldyBQbGF5ZXJDaGFyYWN0ZXIodGhpcyk7XHJcbiAgICAgICAgICAgIEFkZEVudGl0eShwbGF5ZXIpO1xyXG4gICAgICAgICAgICBwbGF5aW5nID0gdHJ1ZTtcclxuICAgICAgICAgICAgbGV2ZWwgPSAwO1xyXG4gICAgICAgICAgICBTdGFydE5leHRMZXZlbCgpO1xyXG4gICAgICAgICAgICBBcHAuRGl2LlN0eWxlLkN1cnNvciA9IG51bGw7XHJcblxyXG4gICAgICAgICAgICB0b3RhbFRpbWUgPSAwO1xyXG4gICAgICAgICAgICB0aW1lUmVtYWluaW5nID0gZGVmYXVsdFRpbWVSZW1haW5pbmc7XHJcbiAgICAgICAgICAgIC8vdGltZVJlbWFpbmluZyAqPSAwLjMzMzRmICogMC4yNWY7XHJcbiAgICAgICAgICAgIC8qdGltZVJlbWFpbmluZyAqPSAwLjMzMzRmICogMC4wNWY7XHJcbiAgICAgICAgICAgIHBsYXllci5IUCA9IDU7Ki9cclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIHB1YmxpYyB2b2lkIFBsYXlNdXNpYyhzdHJpbmcgc29uZylcclxuICAgICAgICB7XHJcbiAgICAgICAgICAgIGlmIChtdXRlZClcclxuICAgICAgICAgICAgICAgIHJldHVybjtcclxuICAgICAgICAgICAgQXVkaW8gTSA9IEF1ZGlvTWFuYWdlci5fdGhpcy5HZXQoXCJCR00vXCIgKyBzb25nICsgXCIub2dnXCIpO1xyXG4gICAgICAgICAgICBpZiAoIU0uSXNQbGF5aW5nKVxyXG4gICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICBBdWRpb01hbmFnZXIuX3RoaXMuU3RvcEFsbEZyb21EaXJlY3RvcnkoXCJCR00vXCIpO1xyXG4gICAgICAgICAgICAgICAgLy9NLlZvbHVtZSA9IDAuMzU7XHJcbiAgICAgICAgICAgICAgICBNLlZvbHVtZSA9IDAuMzU7XHJcbiAgICAgICAgICAgICAgICBNLkxvb3AgPSB0cnVlO1xyXG4gICAgICAgICAgICAgICAgTS5QbGF5KCk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcbiAgICAgICAgcHVibGljIHZvaWQgUmVuZGVyR1VJKENhbnZhc1JlbmRlcmluZ0NvbnRleHQyRCBnKVxyXG4gICAgICAgIHtcclxuICAgICAgICAgICAgdmFyIFBDID0gKFBsYXllckNoYXJhY3RlcilwbGF5ZXI7XHJcbiAgICAgICAgICAgIHZhciBjb2xvciA9IFwiIzAwREQwMFwiO1xyXG4gICAgICAgICAgICBpZiAodGltZVJlbWFpbmluZyA8IGJhc2VMaWZlQ29zdClcclxuICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgaWYgKHRpbWVSZW1haW5pbmcgPD0gMClcclxuICAgICAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgICAgICBjb2xvciA9IFwiI0NDMDA4OFwiO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgZWxzZVxyXG4gICAgICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgICAgIGNvbG9yID0gXCIjRkYwMDAwXCI7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgIGcuR2xvYmFsQWxwaGEgPSAwLjhmO1xyXG4gICAgICAgICAgICBEcmF3R2F1Z2UoZywgbmV3IFZlY3RvcjIoMCwgMCksIG5ldyBWZWN0b3IyKHNwcml0ZUJ1ZmZlci5XaWR0aCAvIDQsIHNwcml0ZUJ1ZmZlci5IZWlnaHQgLyAyMCksIDUsIFBDLkhQIC8gUEMubWF4SFAsIGNvbG9yKTtcclxuICAgICAgICAgICAgZy5HbG9iYWxBbHBoYSA9IDE7XHJcblxyXG4gICAgICAgICAgICBUaW1lclNwcml0ZS5EcmF3KGcpO1xyXG4gICAgICAgICAgICBTY29yZVNwcml0ZS5UZXh0ID0gXCJMZXZlbDpcIiArIGxldmVsICsgXCIgU2NvcmU6XCIgKyBwbGF5ZXIuc2NvcmU7XHJcbiAgICAgICAgICAgIFNjb3JlU3ByaXRlLkZvcmNlVXBkYXRlKCk7XHJcbiAgICAgICAgICAgIFNjb3JlU3ByaXRlLlBvc2l0aW9uLlggPSAoc3ByaXRlQnVmZmVyLldpZHRoICogMC45OGYpIC0gU2NvcmVTcHJpdGUuc3ByaXRlQnVmZmVyLldpZHRoO1xyXG4gICAgICAgICAgICBTY29yZVNwcml0ZS5EcmF3KGcpO1xyXG4gICAgICAgICAgICBSZW5kZXJJY29ucyhnKTtcclxuICAgICAgICB9XHJcbiAgICAgICAgcHVibGljIHZvaWQgUmVuZGVySWNvbnMoQ2FudmFzUmVuZGVyaW5nQ29udGV4dDJEIGcpXHJcbiAgICAgICAge1xyXG4gICAgICAgICAgICB2YXIgUiA9IEtleS5IZWlnaHQgLyBLZXkuV2lkdGg7XHJcbiAgICAgICAgICAgIHZhciBXID0gc3ByaXRlQnVmZmVyLldpZHRoICogMC4wMmY7XHJcbiAgICAgICAgICAgIHZhciBIID0gc3ByaXRlQnVmZmVyLkhlaWdodCAqIDAuMDU1ZjtcclxuXHJcbiAgICAgICAgICAgIHZhciBZID0gSDtcclxuICAgICAgICAgICAgdmFyIFggPSBXIC8gMjtcclxuICAgICAgICAgICAgdmFyIGkgPSAwO1xyXG4gICAgICAgICAgICBcclxuICAgICAgICAgICAgLy92YXIgc3ogPSBzcHJpdGVCdWZmZXIuV2lkdGggKiAwLjAxNWY7XHJcbiAgICAgICAgICAgIHZhciBzeiA9IHNwcml0ZUJ1ZmZlci5XaWR0aCAqIDAuMDExNWY7XHJcbiAgICAgICAgICAgIGcuR2xvYmFsQWxwaGEgPSAwLjhmO1xyXG4gICAgICAgICAgICBpZiAoRG9vci5PcGVuZWQpXHJcbiAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgIHZhciBEQSA9IEJpZ0tleTtcclxuICAgICAgICAgICAgICAgIC8vdmFyIERzeiA9IHNwcml0ZUJ1ZmZlci5XaWR0aCAqIDAuMDE4ZjtcclxuICAgICAgICAgICAgICAgIHZhciBEc3ogPSBzeiAqIDEuNWY7XHJcbiAgICAgICAgICAgICAgICB2YXIgRFIgPSBEQS5IZWlnaHQgLyBEQS5XaWR0aDtcclxuXHJcbiAgICAgICAgICAgICAgICBnLkRyYXdJbWFnZShEQSwgWCwgWSwgRHN6LCBEc3ogKiBSKTtcclxuICAgICAgICAgICAgICAgIFggKz0gVztcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB3aGlsZSAoaSA8IHBsYXllci5rZXlzKVxyXG4gICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICBnLkRyYXdJbWFnZShLZXksIFgsIFksIHN6LCBzeiAqIFIpO1xyXG4gICAgICAgICAgICAgICAgWCArPSBXO1xyXG4gICAgICAgICAgICAgICAgaSsrO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIGcuR2xvYmFsQWxwaGEgPSAxZjtcclxuICAgICAgICB9XHJcbiAgICAgICAgcHVibGljIHZvaWQgRHJhd0dhdWdlKENhbnZhc1JlbmRlcmluZ0NvbnRleHQyRCBnLCBWZWN0b3IyIHBvc2l0aW9uLCBWZWN0b3IyIHNpemUsIGludCBib3JkZXIsIGZsb2F0IHByb2dyZXNzLCBzdHJpbmcgY29sb3IsIGJvb2wgZHJhd2JvcmRlciA9IHRydWUpXHJcbiAgICAgICAge1xyXG4gICAgICAgICAgICB2YXIgYWxwaGEgPSBnLkdsb2JhbEFscGhhO1xyXG4gICAgICAgICAgICBpZiAoZHJhd2JvcmRlcilcclxuICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgZy5HbG9iYWxBbHBoYSA9IDAuNmYgKiBhbHBoYTtcclxuICAgICAgICAgICAgICAgIGcuRmlsbFN0eWxlID0gXCIjMDAwMDAwXCI7XHJcblxyXG4gICAgICAgICAgICAgICAgZy5GaWxsUmVjdCgoaW50KXBvc2l0aW9uLlgsIChpbnQpcG9zaXRpb24uWSwgKGludClzaXplLlgsIChpbnQpc2l6ZS5ZKTtcclxuICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgZy5GaWxsU3R5bGUgPSBjb2xvcjtcclxuICAgICAgICAgICAgZy5HbG9iYWxBbHBoYSA9IDEuMGYgKiBhbHBoYTtcclxuICAgICAgICAgICAgZy5GaWxsUmVjdCgoaW50KXBvc2l0aW9uLlggKyBib3JkZXIsIChpbnQpcG9zaXRpb24uWSArIGJvcmRlciwgKGludCkoKHNpemUuWCAtIChib3JkZXIgKyBib3JkZXIpKSAqIHByb2dyZXNzKSwgKGludClzaXplLlkgLSAoYm9yZGVyICsgYm9yZGVyKSk7XHJcblxyXG4gICAgICAgICAgICBnLkdsb2JhbEFscGhhID0gMC41ZiAqIGFscGhhO1xyXG4gICAgICAgICAgICAvL1NjcmlwdC5Xcml0ZShcInZhciBncmQgPSBnLmNyZWF0ZUxpbmVhckdyYWRpZW50KDAsIDAsIDAsIHNpemUueSk7Z3JkLmFkZENvbG9yU3RvcCgwLCBjb2xvcik7Z3JkLmFkZENvbG9yU3RvcCgwLjQsIFxcXCJ3aGl0ZVxcXCIpO2dyZC5hZGRDb2xvclN0b3AoMSwgY29sb3IpO2cuZmlsbFN0eWxlID0gZ3JkO1wiKTtcclxuICAgICAgICAgICAgdmFyIGdyZCA9IGcuQ3JlYXRlTGluZWFyR3JhZGllbnQoMCwgMCwgMCwgc2l6ZS5ZKTtcclxuICAgICAgICAgICAgZ3JkLkFkZENvbG9yU3RvcCgwLCBjb2xvcik7XHJcbiAgICAgICAgICAgIGdyZC5BZGRDb2xvclN0b3AoMC40LCBcIndoaXRlXCIpO1xyXG4gICAgICAgICAgICBncmQuQWRkQ29sb3JTdG9wKDEsIGNvbG9yKTtcclxuICAgICAgICAgICAgZy5GaWxsU3R5bGUgPSBncmQ7XHJcblxyXG5cclxuICAgICAgICAgICAgZy5GaWxsUmVjdCgoaW50KXBvc2l0aW9uLlggKyBib3JkZXIsIChpbnQpcG9zaXRpb24uWSArIGJvcmRlciwgKGludCkoKHNpemUuWCAtIChib3JkZXIgKyBib3JkZXIpKSAqIHByb2dyZXNzKSwgKGludClzaXplLlkgLSAoYm9yZGVyICsgYm9yZGVyKSk7XHJcbiAgICAgICAgICAgIGcuR2xvYmFsQWxwaGEgPSBhbHBoYTtcclxuICAgICAgICB9XHJcbiAgICAgICAgcHVibGljIGJvb2wgU2hvd0hpdGJveCA9IGZhbHNlO1xyXG4gICAgICAgIHB1YmxpYyB2b2lkIFNlbmRFdmVudChzdHJpbmcgZXZlbnROYW1lLCBkeW5hbWljIGRhdGEsIGJvb2wgdHJpZ2dlcmZsdXNoID0gZmFsc2UpXHJcbiAgICAgICAge1xyXG4gICAgICAgICAgICBkeW5hbWljIEQgPSBuZXcgb2JqZWN0KCk7XHJcbiAgICAgICAgICAgIEQuRSA9IGV2ZW50TmFtZTtcclxuICAgICAgICAgICAgRC5EID0gZGF0YTtcclxuICAgICAgICAgICAgLypOZXRQbGF5VXNlciBOVSA9IG51bGw7XHJcbiAgICAgICAgICAgIGlmIChPbmxpbmUpXHJcbiAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgIE5QLlNlbmQoRCk7XHJcbiAgICAgICAgICAgICAgICBOVSA9IE5QLk1lO1xyXG4gICAgICAgICAgICB9Ki9cclxuICAgICAgICAgICAgLy9Qcm9jZXNzRXZlbnQoRCwgTlUsIDApO1xyXG4gICAgICAgICAgICBQcm9jZXNzRXZlbnQoRCk7XHJcbiAgICAgICAgICAgIC8qaWYgKHRyaWdnZXJmbHVzaClcclxuICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgTmV0UGxheU5lZWRzRmx1c2ggPSB0cnVlO1xyXG4gICAgICAgICAgICB9Ki9cclxuICAgICAgICB9XHJcbiAgICAgICAgcHVibGljIHZvaWQgUHJvY2Vzc0V2ZW50KGR5bmFtaWMgbXNnLCAvKk5ldFBsYXlVc2VyKi9vYmplY3QgdXNlciA9IG51bGwsIGZsb2F0IGxhdGVuY3kgPSAwKVxyXG4gICAgICAgIHtcclxuICAgICAgICAgICAgZHluYW1pYyBEID0gbXNnLkQ7XHJcbiAgICAgICAgICAgIC8qTGlzdDxQbGF5ZXI+IExQID0gbmV3IExpc3Q8UGxheWVyPihwbGF5ZXJzLldoZXJlKHBsYXllciA9PiB1c2VyICE9IG51bGwgJiYgcGxheWVyLk5ldHdvcmtJRCA9PSB1c2VyLnVzZXJJRCkpO1xyXG4gICAgICAgICAgICBQbGF5ZXIgUCA9IG51bGw7XHJcbiAgICAgICAgICAgIFxyXG4gICAgICAgICAgICBib29sIGhhc2NoYXJhY3RlciA9IHRydWU7XHJcbiAgICAgICAgICAgIGlmIChMUC5Db3VudCA8PSAwKVxyXG4gICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICBpZiAoUCA9PSBudWxsICYmIHVzZXIgPT0gbnVsbCAmJiAhT25saW5lKVxyXG4gICAgICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgICAgIFAgPSBsb2NhbHBsYXllcjtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIGVsc2VcclxuICAgICAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgICAgICBpZiAodXNlci5Jc01lKVxyXG4gICAgICAgICAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgbG9jYWxwbGF5ZXIuTmV0d29ya0lEID0gdXNlci51c2VySUQ7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIFAgPSBsb2NhbHBsYXllcjtcclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgZWxzZVxyXG4gICAgICAgICAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgaGFzY2hhcmFjdGVyID0gZmFsc2U7XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIGVsc2VcclxuICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgUCA9IExQWzBdO1xyXG4gICAgICAgICAgICB9Ki9cclxuICAgICAgICAgICAgc3RyaW5nIGV2dCA9IG1zZy5FO1xyXG4gICAgICAgICAgICAvKmlmICh1c2VyICE9IG51bGwgJiYgIXVzZXIuSXNNZSlcclxuICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgRGxhdGVuY3kgKz0gbGF0ZW5jeTtcclxuICAgICAgICAgICAgICAgIC8vbGF0ZW5jeSAqPSAwLjk5ZjtcclxuICAgICAgICAgICAgICAgIERsYXRlbmN5ICo9ICgxIC0gKDEgLyBsYXRlbmN5TSkpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIC8vaWYgKG1zZy5FID09IFwiSW5pdFwiICYmICFQLmxvY2FsKVxyXG4gICAgICAgICAgICBpZiAoZXZ0ID09IFwiSW5pdFwiICYmIFAgPT0gbnVsbClcclxuICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgaWYgKCFoYXNjaGFyYWN0ZXIpXHJcbiAgICAgICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICAgICAgUCA9IG5ldyBQbGF5ZXIoZmFsc2UsIGZhbHNlKTtcclxuICAgICAgICAgICAgICAgICAgICBQLk5ldHdvcmtJRCA9IHVzZXIudXNlcklEO1xyXG4gICAgICAgICAgICAgICAgICAgIC8vUGxheWVyQ2hhcmFjdGVyIFBDID0gbmV3IFBsYXllckNoYXJhY3Rlcih0aGlzLCBQLCBcIlJlaXNlblwiKTtcclxuICAgICAgICAgICAgICAgICAgICBQbGF5ZXJDaGFyYWN0ZXIgUEMgPSBuZXcgUGxheWVyQ2hhcmFjdGVyKHRoaXMsIFAsIEQuQyk7XHJcbiAgICAgICAgICAgICAgICAgICAgLy9QQy5UZWFtID0gMTtcclxuICAgICAgICAgICAgICAgICAgICBQQy5UZWFtID0gRC5UO1xyXG4gICAgICAgICAgICAgICAgICAgIFBDLnggPSA3MDA7XHJcbiAgICAgICAgICAgICAgICAgICAgUEMueSA9IDI0MDtcclxuICAgICAgICAgICAgICAgICAgICBQQy5JRCA9IEQuSTtcclxuICAgICAgICAgICAgICAgICAgICBwbGF5ZXJzLkFkZChQKTtcclxuICAgICAgICAgICAgICAgICAgICBBZGRFbnRpdHkoUEMpO1xyXG4gICAgICAgICAgICAgICAgICAgIGlmIChIb3N0ZXIpXHJcbiAgICAgICAgICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBTZW5kRXZlbnQoXCJNYXBTZWVkXCIsIFRNLlNlZWQpO1xyXG5cclxuICAgICAgICAgICAgICAgICAgICAgICAgTGlzdDxFbnRpdHk+IEwgPSBuZXcgTGlzdDxFbnRpdHk+KGVudGl0aWVzLldoZXJlKEUgPT4gRSBpcyBNYWRuZXNzT3JiIHx8IChFIGlzIFBsYXllckNoYXJhY3RlciAmJiAoKFBsYXllckNoYXJhY3RlcilFKS5wbGF5ZXIuQ1BVKSkpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBpbnQgaSA9IDA7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHdoaWxlIChpIDwgTC5Db3VudClcclxuICAgICAgICAgICAgICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgU2VuZEVudGl0eVNwYXduQ2hlY2soTFtpXSk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpKys7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgQ29uc29sZS5Xcml0ZUxpbmUoXCJVc2VyOlwiICsgUC5OZXR3b3JrSUQgKyBcIiBoYXMgam9pbmVkIVwiKTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBpZiAoZXZ0ID09IFwiU3Bhd25cIilcclxuICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgRW50aXR5IEUgPSBFbnRpdHlGcm9tSUQoRC5JKTtcclxuICAgICAgICAgICAgICAgIGlmIChFID09IG51bGwpXHJcbiAgICAgICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICAgICAgVHlwZSBUID0gSGVscGVyLkdldFR5cGUoRC5UKTtcclxuICAgICAgICAgICAgICAgICAgICBFID0gQWN0aXZhdG9yLkNyZWF0ZUluc3RhbmNlKFQsIHRoaXMpLlRvRHluYW1pYygpO1xyXG4gICAgICAgICAgICAgICAgICAgIEUuSUQgPSBELkk7XHJcbiAgICAgICAgICAgICAgICAgICAgRS54ID0gRC5YO1xyXG4gICAgICAgICAgICAgICAgICAgIEUueSA9IEQuWTtcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKEQuRClcclxuICAgICAgICAgICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIEhlbHBlci5Db3B5RmllbGRzKEQuRCwgRSk7XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgIEFkZEVudGl0eShFKTtcclxuICAgICAgICAgICAgICAgICAgICBDYXRjaHVwRW50aXR5KEUsIGxhdGVuY3kpO1xyXG4gICAgICAgICAgICAgICAgICAgIC8vQWN0aXZhdG9yLkNyZWF0ZUluc3RhbmNlKClcclxuICAgICAgICAgICAgICAgICAgICAvL1N5c3RlbS5SZWZsZWN0aW9uLlxyXG4gICAgICAgICAgICAgICAgICAgIC8vVHlwZSBUID0gVHlwZS5HZXRUeXBlKFwiXCIpO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIGlmIChldnQgPT0gXCJVbnBhdXNlXCIpXHJcbiAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgIHBhdXNlZCA9IGZhbHNlO1xyXG4gICAgICAgICAgICAgICAgQ29uc29sZS5Xcml0ZUxpbmUoXCJHYW1lIHVucGF1c2VkXCIpO1xyXG4gICAgICAgICAgICAgICAgU2VuZEluaXQoKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBpZiAoZXZ0ID09IFwiTWFwU2VlZFwiICYmICFIb3N0ZXIpXHJcbiAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgIGlmIChUTS5TZWVkICE9IEQpXHJcbiAgICAgICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICAgICAgVE0uU2VlZCA9IEQ7XHJcbiAgICAgICAgICAgICAgICAgICAgVE0uR2VuZXJhdGUoKTtcclxuICAgICAgICAgICAgICAgICAgICAvL2NsZWFuIHVwIGxvY2FsIGNsaWVudCBlbnRpdGllcy5cclxuICAgICAgICAgICAgICAgICAgICBpZiAoIWNvbm5lY3RlZClcclxuICAgICAgICAgICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGludCBpID0gMDtcclxuICAgICAgICAgICAgICAgICAgICAgICAgd2hpbGUgKGkgPCBlbnRpdGllcy5Db3VudClcclxuICAgICAgICAgICAgICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGVudGl0aWVzW2ldIGlzIE1hZG5lc3NPcmIgfHwgKGVudGl0aWVzW2ldIGlzIFBsYXllckNoYXJhY3RlciAmJiAoKFBsYXllckNoYXJhY3RlcillbnRpdGllc1tpXSkucGxheWVyLkNQVSkpXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgUmVtb3ZlRW50aXR5KGVudGl0aWVzW2ldKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpLS07XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpKys7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICAgICAgY29ubmVjdGVkID0gdHJ1ZTtcclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIGlmIChldnQgPT0gXCJDRVwiKVxyXG4gICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICBFbnRpdHkgZW50aXR5ID0gRW50aXR5RnJvbUlEKEQuSSk7XHJcbiAgICAgICAgICAgICAgICBpZiAoZW50aXR5ICE9IG51bGwpXHJcbiAgICAgICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICAgICAgZW50aXR5LkN1c3RvbUV2ZW50KEQuRCk7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgaWYgKGV2dCA9PSBcIkNCRVwiKVxyXG4gICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICBFbnRpdHkgZW50aXR5ID0gRW50aXR5RnJvbUlEKEQuSSk7XHJcbiAgICAgICAgICAgICAgICBpZiAoZW50aXR5ICE9IG51bGwpXHJcbiAgICAgICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICAgICAgRW50aXR5QmVoYXZpb3IgYiA9IGVudGl0eS5HZXRCZWhhdmlvckZyb21OYW1lKEQuVCk7XHJcbiAgICAgICAgICAgICAgICAgICAgYi5DdXN0b21FdmVudChELkQpO1xyXG4gICAgICAgICAgICAgICAgICAgIC8vZW50aXR5LkN1c3RvbUV2ZW50KEQuRCk7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH0qL1xyXG4gICAgICAgICAgICBpZiAoZXZ0ID09IFwiS2lsbFwiKVxyXG4gICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICBFbnRpdHkgZW50aXR5ID0gRW50aXR5RnJvbUlEKEQuSSk7XHJcbiAgICAgICAgICAgICAgICBpZiAoZW50aXR5ICE9IG51bGwpXHJcbiAgICAgICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICAgICAgRW50aXR5IGF0dGFja2VyID0gRW50aXR5RnJvbUlEKEQuQSk7XHJcbiAgICAgICAgICAgICAgICAgICAgKChJQ29tYmF0YW50KWVudGl0eSkub25EZWF0aChFbnRpdHlGcm9tSUQoRC5TKSk7XHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKGF0dGFja2VyICE9IG51bGwgJiYgYXR0YWNrZXIgaXMgUGxheWVyQ2hhcmFjdGVyKVxyXG4gICAgICAgICAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgUGxheWVyQ2hhcmFjdGVyIFBDID0gKFBsYXllckNoYXJhY3RlcilhdHRhY2tlcjtcclxuICAgICAgICAgICAgICAgICAgICAgICAgLy9QQy5wbGF5ZXIuU2NvcmUgKz0gKChJQ29tYmF0YW50KWVudGl0eSkuUG9pbnRzRm9yS2lsbGluZztcclxuICAgICAgICAgICAgICAgICAgICAgICAgUEMuc2NvcmUgKz0gKChJQ29tYmF0YW50KWVudGl0eSkuUG9pbnRzRm9yS2lsbGluZztcclxuICAgICAgICAgICAgICAgICAgICAgICAgUEMub25LaWxsKCgoSUNvbWJhdGFudCllbnRpdHkpKTtcclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcbiAgICAgICAgcHVibGljIEVudGl0eSBFbnRpdHlGcm9tSUQoc3RyaW5nIElEKVxyXG4gICAgICAgIHtcclxuICAgICAgICAgICAgaW50IGkgPSAwO1xyXG4gICAgICAgICAgICB3aGlsZSAoaSA8IGVudGl0aWVzLkNvdW50KVxyXG4gICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICBFbnRpdHkgRSA9IGVudGl0aWVzW2ldO1xyXG4gICAgICAgICAgICAgICAgaWYgKEUuSUQgPT0gSUQpXHJcbiAgICAgICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIEU7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICBpKys7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgcmV0dXJuIG51bGw7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHB1YmxpYyBib29sIGZyZWVjYW0gPSBmYWxzZTtcclxuICAgICAgICBwdWJsaWMgdm9pZCBVcGRhdGVDYW1lcmEoKVxyXG4gICAgICAgIHtcclxuICAgICAgICAgICAgLy9mbG9hdCBEID0gdGVzdC5Ic3BlZWQgKiAxODtcclxuICAgICAgICAgICAgLy9mbG9hdCBEID0gKGZsb2F0KU1hdGguQWJzKHRlc3QuSHNwZWVkKSAqIDk7XHJcbiAgICAgICAgICAgIC8vdmFyIGZyZWVjYW0gPSB0cnVlO1xyXG4gICAgICAgICAgICBjYW1lcmEuc3BlZWRtb2QgPSAxZjtcclxuXHJcbiAgICAgICAgICAgIC8qaWYgKEtleWJvYXJkTWFuYWdlci5fdGhpcy5UYXBwZWRCdXR0b25zLkNvbnRhaW5zQig2NykgJiYgQXBwLkRFQlVHKVxyXG4gICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICBmcmVlY2FtID0gIWZyZWVjYW07XHJcbiAgICAgICAgICAgIH0qL1xyXG4gICAgICAgICAgICBpZiAoZnJlZWNhbSlcclxuICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgdmFyIHNwZCA9IDE2IC8gY2FtZXJhLlNjYWxlO1xyXG4gICAgICAgICAgICAgICAgdmFyIFBCID0gS2V5Ym9hcmRNYW5hZ2VyLl90aGlzLlByZXNzZWRCdXR0b25zO1xyXG4gICAgICAgICAgICAgICAgLy9udW1wYWQgcGFubmluZ1xyXG4gICAgICAgICAgICAgICAgaWYgKENpcm5vR2FtZS5IZWxwZXJFeHRlbnNpb25zLkNvbnRhaW5zQjxpbnQ+KFBCLCAxMDApKVxyXG4gICAgICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgICAgIGNhbWVyYS5UYXJnZXRQb3NpdGlvbi5YIC09IHNwZDtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIGlmIChDaXJub0dhbWUuSGVscGVyRXh0ZW5zaW9ucy5Db250YWluc0I8aW50PihQQiwgMTAyKSlcclxuICAgICAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgICAgICBjYW1lcmEuVGFyZ2V0UG9zaXRpb24uWCArPSBzcGQ7XHJcbiAgICAgICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICAgICAgaWYgKENpcm5vR2FtZS5IZWxwZXJFeHRlbnNpb25zLkNvbnRhaW5zQjxpbnQ+KFBCLCAxMDQpKVxyXG4gICAgICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgICAgIGNhbWVyYS5UYXJnZXRQb3NpdGlvbi5ZIC09IHNwZDtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIGlmIChDaXJub0dhbWUuSGVscGVyRXh0ZW5zaW9ucy5Db250YWluc0I8aW50PihQQiwgOTgpKVxyXG4gICAgICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgICAgIGNhbWVyYS5UYXJnZXRQb3NpdGlvbi5ZICs9IHNwZDtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIGlmIChDaXJub0dhbWUuSGVscGVyRXh0ZW5zaW9ucy5Db250YWluc0I8aW50PihQQiwgMTA3KSkvL251bXBhZCtcclxuICAgICAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgICAgICB2YXIgQ0MgPSBjYW1lcmEuQ2VudGVyO1xyXG4gICAgICAgICAgICAgICAgICAgIGNhbWVyYS5TY2FsZSAqPSAxLjAxZjtcclxuICAgICAgICAgICAgICAgICAgICBjYW1lcmEuQ2VudGVyID0gQ0M7XHJcbiAgICAgICAgICAgICAgICAgICAgY2FtZXJhLlRhcmdldFBvc2l0aW9uLlggPSBjYW1lcmEuUG9zaXRpb24uWDtcclxuICAgICAgICAgICAgICAgICAgICBjYW1lcmEuVGFyZ2V0UG9zaXRpb24uWSA9IGNhbWVyYS5Qb3NpdGlvbi5ZO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgaWYgKENpcm5vR2FtZS5IZWxwZXJFeHRlbnNpb25zLkNvbnRhaW5zQjxpbnQ+KFBCLCAxMDkpKS8vbnVtcGFkLVxyXG4gICAgICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgICAgIHZhciBDQyA9IGNhbWVyYS5DZW50ZXI7XHJcbiAgICAgICAgICAgICAgICAgICAgY2FtZXJhLlNjYWxlICo9IDAuOTlmO1xyXG4gICAgICAgICAgICAgICAgICAgIGNhbWVyYS5DZW50ZXIgPSBDQztcclxuICAgICAgICAgICAgICAgICAgICBjYW1lcmEuVGFyZ2V0UG9zaXRpb24uWCA9IGNhbWVyYS5Qb3NpdGlvbi5YO1xyXG4gICAgICAgICAgICAgICAgICAgIGNhbWVyYS5UYXJnZXRQb3NpdGlvbi5ZID0gY2FtZXJhLlBvc2l0aW9uLlk7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICBpZiAoQ2lybm9HYW1lLkhlbHBlckV4dGVuc2lvbnMuQ29udGFpbnNCPGludD4oUEIsIDM2KSkvL2hvbWVcclxuICAgICAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgICAgICBjYW1lcmEuQ2VudGVyZWRUYXJnZXRQb3NpdGlvbiA9IHBsYXllci5Qb3NpdGlvbjtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIGlmIChDaXJub0dhbWUuSGVscGVyRXh0ZW5zaW9ucy5Db250YWluc0I8aW50PihQQiwgMTMpKS8vZW50ZXJcclxuICAgICAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgICAgICBwbGF5ZXIuUG9zaXRpb24uWCA9IGNhbWVyYS5DZW50ZXIuWDtcclxuICAgICAgICAgICAgICAgICAgICBwbGF5ZXIuUG9zaXRpb24uWSA9IGNhbWVyYS5DZW50ZXIuWTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIGNhbWVyYS5VcGRhdGUoKTtcclxuICAgICAgICAgICAgICAgIHJldHVybjtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBpZiAoIXBsYXlpbmcpXHJcbiAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgIGNhbWVyYS5zcGVlZG1vZCA9IDAuMDVmO1xyXG4gICAgICAgICAgICAgICAgaWYgKGNhbWVyYS5UYXJnZXRQb3NpdGlvbiA9PSBudWxsIHx8IGNhbWVyYS5Qb3NpdGlvbi5Fc3RpbWF0ZWREaXN0YW5jZShjYW1lcmEuVGFyZ2V0UG9zaXRpb24pIDwgNDApXHJcbiAgICAgICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKE1hdGguUmFuZG9tKCkgPCAwLjAwMzUgfHwgY2FtZXJhLmluc3Rhd2FycClcclxuICAgICAgICAgICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGNhbWVyYS5DZW50ZXJlZFRhcmdldFBvc2l0aW9uID0gTWFwUm9vbS5GaW5kQW55RW1wdHlTcG90KCk7XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgLypjYW1lcmEuVGFyZ2V0UG9zaXRpb24gPSBudWxsO1xyXG4gICAgICAgICAgICAgICAgaWYgKGNhbWVyYVdhbmRlclBvaW50ID09IG51bGwpXHJcbiAgICAgICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICAgICAgY2FtZXJhV2FuZGVyUG9pbnQgPSBNYXBSb29tLkZpbmRBbnlFbXB0eVNwb3QoKTtcclxuICAgICAgICAgICAgICAgIH0qL1xyXG4gICAgICAgICAgICAgICAgY2FtZXJhLlVwZGF0ZSgpO1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuO1xyXG4gICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICBpZiAoZnJlZWNhbSlcclxuICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgaWYgKEtleWJvYXJkTWFuYWdlci5fdGhpcy5QcmVzc2VkQnV0dG9ucy5Db250YWlucygxMDEpIHx8IEtleWJvYXJkTWFuYWdlci5fdGhpcy5QcmVzc2VkQnV0dG9ucy5Db250YWlucygxMTEpKVxyXG4gICAgICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgICAgIHZhciBURVNUID0gUm9vbU9wZW5pbmdMZXZlci5URVNUO1xyXG4gICAgICAgICAgICAgICAgICAgIGlmIChLZXlib2FyZE1hbmFnZXIuX3RoaXMuUHJlc3NlZEJ1dHRvbnMuQ29udGFpbnMoMTA2KSAmJiAhVEVTVC5BY3RpdmF0ZWQpXHJcbiAgICAgICAgICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBURVNULkFjdGl2YXRlKCk7XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgIGlmIChURVNUICE9IG51bGwpXHJcbiAgICAgICAgICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAoIVRFU1QuQWN0aXZhdGVkICYmICFLZXlib2FyZE1hbmFnZXIuX3RoaXMuUHJlc3NlZEJ1dHRvbnMuQ29udGFpbnMoMTExKSlcclxuICAgICAgICAgICAgICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgY2FtZXJhLkNlbnRlcmVkVGFyZ2V0UG9zaXRpb24gPSBURVNULlBvc2l0aW9uO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGVsc2VcclxuICAgICAgICAgICAgICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFyIFQgPSBUTS5HZXRUaWxlKFRFU1QuUm9vbS5TWCwgVEVTVC5Sb29tLlNZKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhciBIQiA9IFQuR2V0SGl0Ym94KCk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjYW1lcmEuQ2VudGVyZWRUYXJnZXRQb3NpdGlvbiA9IG5ldyBWZWN0b3IyKEhCLmxlZnQsIEhCLnRvcCk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKEtleWJvYXJkTWFuYWdlci5fdGhpcy5UYXBwZWRCdXR0b25zLkNvbnRhaW5zKDMyKSlcclxuICAgICAgICAgICAgICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgcGxheWVyLlBvc2l0aW9uLlggPSBjYW1lcmEuQ2VudGVyLlg7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBwbGF5ZXIuUG9zaXRpb24uWSA9IGNhbWVyYS5DZW50ZXIuWTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgICAgICBjYW1lcmEuVXBkYXRlKCk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybjtcclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgZWxzZVxyXG4gICAgICAgICAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgcGxheWVyLk1TRy5DaGFuZ2VUZXh0KFwiTm8gbGV2ZXIgb24gbWFwXCIpO1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBpZiAocGxheWVyLkhQIDwgMClcclxuICAgICAgICAgICAgICAgIHJldHVybjtcclxuICAgICAgICAgICAgZmxvYXQgRCA9IChmbG9hdClwbGF5ZXIuSHNwZWVkICogMzI7XHJcbiAgICAgICAgICAgIGZsb2F0IGxvb2tBaGVhZFJhdGUgPSAwLjNmO1xyXG4gICAgICAgICAgICB2YXIgSCA9IGNhbWVyYS5DYW1lcmFCb3VuZHMud2lkdGggLyA4O1xyXG4gICAgICAgICAgICBEICs9ICFwbGF5ZXIuQW5pLkZsaXBwZWQgPyBIIDogLUg7XHJcbiAgICAgICAgICAgIHZhciBDID0gQXBwLkNhbnZhcztcclxuICAgICAgICAgICAgdmFyIElTID0gY2FtZXJhLkludlNjYWxlO1xyXG4gICAgICAgICAgICBmbG9hdCBWID0gTWF0aC5NYXgoMCwgcGxheWVyLlZzcGVlZCAqIDMwKTtcclxuICAgICAgICAgICAgaWYgKHBsYXllci5Db250cm9sbGVyWzJdKVxyXG4gICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICAvL1YgLT0gY2FtZXJhLkNhbWVyYUJvdW5kcy5oZWlnaHQgLyA0O1xyXG4gICAgICAgICAgICAgICAgViAtPSBjYW1lcmEuQ2FtZXJhQm91bmRzLmhlaWdodCAvIDM7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgZWxzZSBpZiAocGxheWVyLkNvbnRyb2xsZXJbM10pXHJcbiAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgIC8vViArPSBjYW1lcmEuQ2FtZXJhQm91bmRzLmhlaWdodCAvIDQ7XHJcbiAgICAgICAgICAgICAgICBWICs9IGNhbWVyYS5DYW1lcmFCb3VuZHMuaGVpZ2h0IC8gMztcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBlbHNlIGlmIChwbGF5ZXIub25Hcm91bmQpXHJcbiAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgIC8vViAtPSBjYW1lcmEuQ2FtZXJhQm91bmRzLmhlaWdodCAvIDg7XHJcbiAgICAgICAgICAgICAgICBWIC09IGNhbWVyYS5DYW1lcmFCb3VuZHMuaGVpZ2h0IC8gMTA7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgZWxzZVxyXG4gICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICBWICs9IGNhbWVyYS5DYW1lcmFCb3VuZHMuaGVpZ2h0IC8gMTI7XHJcbiAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgIHZhciBUUCA9IGNhbWVyYS5UYXJnZXRQb3NpdGlvbjtcclxuICAgICAgICAgICAgLypUUC5YID0gKHRlc3QueCArIEQpIC0gKChDLldpZHRoIC8gMikgKiBJUyk7XHJcbiAgICAgICAgICAgIFRQLlkgPSAoZmxvYXQpTWF0aC5NYXgoMCwgKHRlc3QueSArIFYpIC0gKChDLkhlaWdodCAvIDIpICogSVMpKTsqL1xyXG4gICAgICAgICAgICAvKlRQLlggPSB0ZXN0Lng7XHJcbiAgICAgICAgICAgIFRQLlkgPSB0ZXN0Lnk7Ki9cclxuICAgICAgICAgICAgdmFyIFggPSBwbGF5ZXIueCArIChwbGF5ZXIuV2lkdGggLyAyKSArIChEICogbG9va0FoZWFkUmF0ZSk7XHJcbiAgICAgICAgICAgIHZhciBZID0gcGxheWVyLnkgKyAocGxheWVyLkhlaWdodCAvIDIpICsgKFYgKiBsb29rQWhlYWRSYXRlKTtcclxuICAgICAgICAgICAgY2FtZXJhLkNlbnRlcmVkVGFyZ2V0UG9zaXRpb24gPSBuZXcgVmVjdG9yMihYLCBZKTtcclxuICAgICAgICAgICAgY2FtZXJhLlVwZGF0ZSgpO1xyXG4gICAgICAgIH1cclxuICAgICAgICBwdWJsaWMgdm9pZCBEcmF3QmFja2dyb3VuZChDYW52YXNSZW5kZXJpbmdDb250ZXh0MkQgZylcclxuICAgICAgICB7XHJcbiAgICAgICAgICAgIGcuRmlsbFN0eWxlID0gXCIjNzdBQUZGXCI7XHJcbiAgICAgICAgICAgIGcuRmlsbFJlY3QoMCwgMCwgQXBwLkNhbnZhcy5XaWR0aCwgQXBwLkNhbnZhcy5IZWlnaHQpO1xyXG4gICAgICAgICAgICAvKmlmIChCRyA8IDAgfHwgQkcgPj0gQkdzLkNvdW50KVxyXG4gICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICBnLkZpbGxTdHlsZSA9IFwiIzc3QUFGRlwiO1xyXG4gICAgICAgICAgICAgICAgZy5GaWxsUmVjdCgwLCAwLCBBcHAuQ2FudmFzLldpZHRoLCBBcHAuQ2FudmFzLkhlaWdodCk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgZWxzZVxyXG4gICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICBnLkRyYXdJbWFnZShCR3NbQkddLCAoZmxvYXQpMCwgKGZsb2F0KTApO1xyXG4gICAgICAgICAgICB9Ki9cclxuICAgICAgICB9XHJcbiAgICAgICAgcHVibGljIHZvaWQgVXBkYXRlQ29udHJvbHMoKVxyXG4gICAgICAgIHtcclxuXHJcbiAgICAgICAgICAgIHZhciBQQyA9IHBsYXllcjtcclxuICAgICAgICAgICAgZmxvYXQgdGhyZXNoaG9sZCA9IDAuN2Y7XHJcbiAgICAgICAgICAgIGJvb2xbXSBDID0gUEMuQ29udHJvbGxlcjtcclxuICAgICAgICAgICAgdmFyIElDID0gQXBwLklDO1xyXG5cclxuICAgICAgICAgICAgaWYgKElDID09IG51bGwpXHJcbiAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgIHJldHVybjtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBmbG9hdCB4ID0gSUMuZ2V0U3RhdGUoMCk7XHJcbiAgICAgICAgICAgIGZsb2F0IHkgPSBJQy5nZXRTdGF0ZSgxKTtcclxuICAgICAgICAgICAgQ1swXSA9IHggPD0gLXRocmVzaGhvbGQ7XHJcbiAgICAgICAgICAgIENbMV0gPSB4ID49IHRocmVzaGhvbGQ7XHJcbiAgICAgICAgICAgIENbMl0gPSB5IDw9IC10aHJlc2hob2xkO1xyXG4gICAgICAgICAgICBDWzNdID0geSA+PSB0aHJlc2hob2xkO1xyXG5cclxuICAgICAgICAgICAgc3RyaW5nIGNpZCA9IElDLmdldE1hcENvbnRyb2xsZXJJRCg1KTtcclxuICAgICAgICAgICAgaWYgKGNpZCA9PSBcIktleWJvYXJkXCIgfHwgY2lkID09IFwiTW91c2VcIilcclxuICAgICAgICAgICAgLy9pZiAoSUMuaWQgPT0gXCJLZXlib2FyZFwiKVxyXG4gICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICAvLy8vUEMuQWltQXQoR2V0TW91c2UoKSk7XHJcbiAgICAgICAgICAgICAgICAvKkNbNF0gPSBLZXlib2FyZE1hbmFnZXIuX3RoaXMuUHJlc3NlZE1vdXNlQnV0dG9ucy5Db250YWlucygwKTtcclxuICAgICAgICAgICAgICAgIENbNV0gPSBLZXlib2FyZE1hbmFnZXIuX3RoaXMuUHJlc3NlZE1vdXNlQnV0dG9ucy5Db250YWlucygyKTsqL1xyXG4gICAgICAgICAgICAgICAgQ1s0XSA9IElDLmdldFByZXNzZWQoMik7XHJcbiAgICAgICAgICAgICAgICBDWzVdID0gSUMuZ2V0UHJlc3NlZCgzKTtcclxuICAgICAgICAgICAgICAgIENbNl0gPSBJQy5nZXRQcmVzc2VkKDQpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIGVsc2VcclxuICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgLypHYW1lUGFkIFAgPSBHYW1lUGFkTWFuYWdlci5fdGhpcy5HZXRQYWQoSUMuaWQpO1xyXG4gICAgICAgICAgICAgICAgUEMuYWltQW5nbGUgPSBuZXcgVmVjdG9yMigoZmxvYXQpUC5heGVzWzJdLCAoZmxvYXQpUC5heGVzWzNdKS5Ub0FuZ2xlKCk7Ki9cclxuICAgICAgICAgICAgICAgIFZlY3RvcjIgYWltID0gbmV3IFZlY3RvcjIoSUMuZ2V0U3RhdGUoNCksIElDLmdldFN0YXRlKDUpKTtcclxuICAgICAgICAgICAgICAgIGlmIChhaW0uUm91Z2hMZW5ndGggPiAwLjUpXHJcbiAgICAgICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICAgICAgLy8vL1BDLmFpbUFuZ2xlID0gYWltLlRvQW5nbGUoKTtcclxuICAgICAgICAgICAgICAgIH1cclxuXHJcblxyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIENbNF0gPSBJQy5nZXRQcmVzc2VkKDIpO1xyXG4gICAgICAgICAgICBDWzVdID0gSUMuZ2V0UHJlc3NlZCgzKTtcclxuICAgICAgICAgICAgQ1s2XSA9IElDLmdldFByZXNzZWQoNCk7XHJcbiAgICAgICAgICAgIC8qQ1s0XSA9IElDLmdldFByZXNzZWQoMyk7XHJcbiAgICAgICAgICAgIENbNV0gPSBJQy5nZXRQcmVzc2VkKDQpOyovXHJcblxyXG4gICAgICAgICAgICBvYmplY3QgbyA9IG5ldyBvYmplY3QoKTtcclxuICAgICAgICB9XHJcbiAgICB9XHJcbn1cclxuIiwidXNpbmcgU3lzdGVtO1xyXG51c2luZyBTeXN0ZW0uQ29sbGVjdGlvbnMuR2VuZXJpYztcclxudXNpbmcgU3lzdGVtLkxpbnE7XHJcbnVzaW5nIFN5c3RlbS5UZXh0O1xyXG51c2luZyBTeXN0ZW0uVGhyZWFkaW5nLlRhc2tzO1xyXG5cclxubmFtZXNwYWNlIENpcm5vR2FtZVxyXG57XHJcbiAgICBjbGFzcyBIZWFsaW5nSXRlbSA6IENvbGxlY3RhYmxlSXRlbVxyXG4gICAge1xyXG4gICAgICAgIHB1YmxpYyBmbG9hdCBoZWFsaW5nUG93ZXIgPSAxLjVmO1xyXG4gICAgICAgIHB1YmxpYyBIZWFsaW5nSXRlbShHYW1lIGdhbWUpIDogYmFzZShnYW1lLCBcImhlYXJ0XCIpXHJcbiAgICAgICAge1xyXG4gICAgICAgICAgICBmbG9hdHMgPSBmYWxzZTtcclxuICAgICAgICAgICAgbWFnbmV0RGlzdGFuY2UgPSAyMDtcclxuICAgICAgICAgICAgc291bmQgPSBcIm9rXCI7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHB1YmxpYyBvdmVycmlkZSBib29sIENhbkNvbGxlY3QoUGxheWVyQ2hhcmFjdGVyIHBsYXllcilcclxuICAgICAgICB7XHJcbiAgICAgICAgICAgIHJldHVybiBwbGF5ZXIuSFAgPCBwbGF5ZXIubWF4SFA7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBwdWJsaWMgb3ZlcnJpZGUgdm9pZCBvbkNvbGxlY3RlZChQbGF5ZXJDaGFyYWN0ZXIgcGxheWVyKVxyXG4gICAgICAgIHtcclxuICAgICAgICAgICAgcGxheWVyLkhQID0gTWF0aC5NaW4ocGxheWVyLkhQICsgaGVhbGluZ1Bvd2VyLCBwbGF5ZXIubWF4SFApO1xyXG4gICAgICAgIH1cclxuICAgIH1cclxufVxyXG4iLCJ1c2luZyBTeXN0ZW07XHJcbnVzaW5nIFN5c3RlbS5Db2xsZWN0aW9ucy5HZW5lcmljO1xyXG51c2luZyBTeXN0ZW0uTGlucTtcclxudXNpbmcgU3lzdGVtLlRleHQ7XHJcbnVzaW5nIFN5c3RlbS5UaHJlYWRpbmcuVGFza3M7XHJcblxyXG5uYW1lc3BhY2UgQ2lybm9HYW1lXHJcbntcclxuICAgIHB1YmxpYyBjbGFzcyBLZXlJdGVtIDogQ29sbGVjdGFibGVJdGVtXHJcbiAgICB7XHJcbiAgICAgICAgcHVibGljIEtleUl0ZW0oR2FtZSBnYW1lKSA6IGJhc2UoZ2FtZSwgXCJrZXlcIilcclxuICAgICAgICB7XHJcbiAgICAgICAgICAgIGZsb2F0cyA9IGZhbHNlO1xyXG4gICAgICAgICAgICBtYWduZXREaXN0YW5jZSA9IDIwO1xyXG4gICAgICAgIH1cclxuICAgICAgICBwdWJsaWMgb3ZlcnJpZGUgYm9vbCBDYW5Db2xsZWN0KFBsYXllckNoYXJhY3RlciBwbGF5ZXIpXHJcbiAgICAgICAge1xyXG4gICAgICAgICAgICByZXR1cm4gcGxheWVyLmtleXMgPCA1O1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgcHVibGljIG92ZXJyaWRlIHZvaWQgb25Db2xsZWN0ZWQoUGxheWVyQ2hhcmFjdGVyIHBsYXllcilcclxuICAgICAgICB7XHJcbiAgICAgICAgICAgIHBsYXllci5rZXlzKys7XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG59XHJcbiIsInVzaW5nIFN5c3RlbTtcclxudXNpbmcgU3lzdGVtLkNvbGxlY3Rpb25zLkdlbmVyaWM7XHJcbnVzaW5nIFN5c3RlbS5MaW5xO1xyXG51c2luZyBTeXN0ZW0uVGV4dDtcclxudXNpbmcgU3lzdGVtLlRocmVhZGluZy5UYXNrcztcclxuXHJcbm5hbWVzcGFjZSBDaXJub0dhbWVcclxue1xyXG4gICAgcHVibGljIGNsYXNzIFBsYXRmb3JtZXJFbnRpdHkgOiBDb250cm9sbGFibGVFbnRpdHlcclxuICAgIHtcclxuICAgICAgICBwdWJsaWMgZmxvYXQgZnJpY3Rpb24gPSAwLjVmO1xyXG4gICAgICAgIHB1YmxpYyBib29sIG9uR3JvdW5kO1xyXG4gICAgICAgIHB1YmxpYyBib29sIEdyYXZpdHlFbmFibGVkID0gdHJ1ZTtcclxuICAgICAgICAvL3B1YmxpYyBmbG9hdCBncmF2aXR5ID0gMS42ZjtcclxuICAgICAgICAvL3B1YmxpYyBmbG9hdCBncmF2aXR5ID0gMC45ZjtcclxuICAgICAgICAvL3B1YmxpYyBmbG9hdCBncmF2aXR5ID0gMC4wMTc1ZjtcclxuICAgICAgICBwdWJsaWMgZmxvYXQgZ3Jhdml0eSA9IDAuMDJmO1xyXG4gICAgICAgIHB1YmxpYyBmbG9hdCBtYXhGYWxsU3BlZWQgPSAyLjBmO1xyXG4gICAgICAgIHB1YmxpYyBmbG9hdCBmZWV0cG9zaXRpb24gPSAyMztcclxuICAgICAgICAvL3B1YmxpYyBmbG9hdCBoZWFkcG9zaXRpb24gPSA0O1xyXG4gICAgICAgIHB1YmxpYyBmbG9hdCBoZWFkcG9zaXRpb24gPSA3O1xyXG5cclxuICAgICAgICBwdWJsaWMgVGlsZURhdGEgRmxvb3I7XHJcbiAgICAgICAgcHVibGljIFRpbGVEYXRhIENlaWxpbmc7XHJcblxyXG4gICAgICAgIHB1YmxpYyBUaWxlRGF0YSBMZWZ0V2FsbDtcclxuICAgICAgICBwdWJsaWMgVGlsZURhdGEgUmlnaHRXYWxsO1xyXG5cclxuXHJcbiAgICAgICAgcHVibGljIFBsYXRmb3JtZXJFbnRpdHkoR2FtZSBnYW1lKSA6IGJhc2UoZ2FtZSlcclxuICAgICAgICB7XHJcblxyXG4gICAgICAgIH1cclxuICAgICAgICBwdWJsaWMgb3ZlcnJpZGUgdm9pZCBVcGRhdGUoKVxyXG4gICAgICAgIHtcclxuICAgICAgICAgICAgYmFzZS5VcGRhdGUoKTtcclxuICAgICAgICAgICAgaWYgKEdyYXZpdHlFbmFibGVkKVxyXG4gICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICBpZiAoVnNwZWVkIDwgbWF4RmFsbFNwZWVkICYmIEdyYXZpdHlFbmFibGVkKVxyXG4gICAgICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgICAgIFZzcGVlZCA9IChmbG9hdClNYXRoLk1pbihWc3BlZWQgKyBncmF2aXR5LCBtYXhGYWxsU3BlZWQpO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIC8qaWYgKHkgPiAwICYmIFZzcGVlZD49MClcclxuICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgeSA9IDA7XHJcbiAgICAgICAgICAgICAgICBWc3BlZWQgPSAwO1xyXG4gICAgICAgICAgICAgICAgb25Hcm91bmQgPSB0cnVlO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIGlmICh5IDwgMClcclxuICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgb25Hcm91bmQgPSBmYWxzZTtcclxuICAgICAgICAgICAgfSovXHJcbiAgICAgICAgICAgIEFwcGx5RnJpY3Rpb24oKTtcclxuICAgICAgICAgICAgVXBkYXRlVGVycmFpbkNvbGxpc2lvbigpO1xyXG5cclxuICAgICAgICAgICAgb25Hcm91bmQgPSAoRmxvb3IgIT0gbnVsbCAmJiBWc3BlZWQgPj0gMCk7XHJcblxyXG4gICAgICAgICAgICBpZiAob25Hcm91bmQpXHJcbiAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgIGZsb2F0IFkgPSBGbG9vci5HZXRUb3AoZ2V0Q2VudGVyKCkpIC0gZmVldHBvc2l0aW9uO1xyXG4gICAgICAgICAgICAgICAgLyppZiAoeSA8IFkpXHJcbiAgICAgICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICAgICAgb25Hcm91bmQgPSBmYWxzZTtcclxuICAgICAgICAgICAgICAgICAgICBGbG9vciA9IG51bGw7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICBlbHNlKi9cclxuICAgICAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgICAgICAvL3kgPSAoKEZsb29yLnJvdyAqIEdhbWUuVE0udGlsZXNpemUpICsgR2FtZS5UTS5wb3NpdGlvbi5ZKSAtIGZlZXRwb3NpdGlvbjtcclxuICAgICAgICAgICAgICAgICAgICB5ID0gWTtcclxuICAgICAgICAgICAgICAgICAgICBWc3BlZWQgPSAwO1xyXG4gICAgICAgICAgICAgICAgICAgIG9uR3JvdW5kID0gdHJ1ZTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBpZiAoQ2VpbGluZyAhPSBudWxsICYmIFZzcGVlZCA8IDAvKiAmJiAhQ2VpbGluZy5wbGF0Zm9ybSovKVxyXG4gICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICBWc3BlZWQgPSAwO1xyXG4gICAgICAgICAgICAgICAgeSA9ICgoQ2VpbGluZy5yb3cgKiBHYW1lLlRNLnRpbGVzaXplKSArIEdhbWUuVE0ucG9zaXRpb24uWSkgKyBHYW1lLlRNLnRpbGVzaXplIC0gaGVhZHBvc2l0aW9uO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIGlmIChMZWZ0V2FsbCAhPSBudWxsKVxyXG4gICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICBIc3BlZWQgPSBNYXRoLk1heCgwLCBIc3BlZWQpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIGlmIChSaWdodFdhbGwgIT0gbnVsbClcclxuICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgSHNwZWVkID0gTWF0aC5NaW4oMCwgSHNwZWVkKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuICAgICAgICBwdWJsaWMgdm9pZCBBcHBseUZyaWN0aW9uKClcclxuICAgICAgICB7XHJcbiAgICAgICAgICAgIEhzcGVlZCA9IChmbG9hdClNYXRoSGVscGVyLkRlY2VsZXJhdGUoSHNwZWVkLCBmcmljdGlvbik7XHJcbiAgICAgICAgICAgIGlmICghR3Jhdml0eUVuYWJsZWQpXHJcbiAgICAgICAgICAgICAgICBWc3BlZWQgPSAoZmxvYXQpTWF0aEhlbHBlci5EZWNlbGVyYXRlKFZzcGVlZCwgZnJpY3Rpb24pO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgcHJvdGVjdGVkIFRpbGVEYXRhIEdldEZsb29yKClcclxuICAgICAgICB7XHJcbiAgICAgICAgICAgIFRpbGVEYXRhIFQgPSBudWxsO1xyXG4gICAgICAgICAgICBmbG9hdCBXID0gV2lkdGggLyAzO1xyXG4gICAgICAgICAgICBmbG9hdCBZID0gSGVpZ2h0O1xyXG4gICAgICAgICAgICBpZiAoIShUICE9IG51bGwgJiYgVC5lbmFibGVkICYmIFQudG9wU29saWQpKVxyXG4gICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICBUID0gR2FtZS5UTS5DaGVja0ZvclRpbGUoVmVjdG9yMi5BZGQoUG9zaXRpb24sIFdpZHRoIC8gMiwgWSkpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIGlmICghKFQgIT0gbnVsbCAmJiBULmVuYWJsZWQgJiYgVC50b3BTb2xpZCkpXHJcbiAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgIFQgPSBHYW1lLlRNLkNoZWNrRm9yVGlsZShWZWN0b3IyLkFkZChQb3NpdGlvbiwgVywgWSkpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIGlmICghKFQgIT0gbnVsbCAmJiBULmVuYWJsZWQgJiYgVC50b3BTb2xpZCkpXHJcbiAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgIFQgPSBHYW1lLlRNLkNoZWNrRm9yVGlsZShWZWN0b3IyLkFkZChQb3NpdGlvbiwgV2lkdGggLSBXLCBZKSk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgaWYgKCEoVCAhPSBudWxsICYmIFQuZW5hYmxlZCAmJiBULnRvcFNvbGlkKSlcclxuICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgVCA9IG51bGw7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgcmV0dXJuIFQ7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHByb3RlY3RlZCBUaWxlRGF0YSBHZXRDZWlsaW5nKClcclxuICAgICAgICB7XHJcbiAgICAgICAgICAgIFRpbGVEYXRhIFQgPSBudWxsO1xyXG4gICAgICAgICAgICBmbG9hdCBXID0gV2lkdGggLyAzO1xyXG4gICAgICAgICAgICAvL2Zsb2F0IFkgPSAxNjtcclxuICAgICAgICAgICAgZmxvYXQgWSA9IDAgKyBoZWFkcG9zaXRpb247XHJcbiAgICAgICAgICAgIGlmICghKFQgIT0gbnVsbCAmJiBULmVuYWJsZWQgJiYgVC5ib3R0b21Tb2xpZCkpXHJcbiAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgIFQgPSBHYW1lLlRNLkNoZWNrRm9yVGlsZShWZWN0b3IyLkFkZChQb3NpdGlvbiwgVywgWSkpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIGlmICghKFQgIT0gbnVsbCAmJiBULmVuYWJsZWQgJiYgVC5ib3R0b21Tb2xpZCkpXHJcbiAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgIFQgPSBHYW1lLlRNLkNoZWNrRm9yVGlsZShWZWN0b3IyLkFkZChQb3NpdGlvbiwgV2lkdGggLSBXLCBZKSk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgaWYgKCEoVCAhPSBudWxsICYmIFQuZW5hYmxlZCAmJiBULmJvdHRvbVNvbGlkKSlcclxuICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgVCA9IG51bGw7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgcmV0dXJuIFQ7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHByb3RlY3RlZCBUaWxlRGF0YSBDaGVja1dhbGwoZmxvYXQgWClcclxuICAgICAgICB7XHJcbiAgICAgICAgICAgIFRpbGVEYXRhIFQgPSBudWxsO1xyXG4gICAgICAgICAgICAvKmlmICghKFQgIT0gbnVsbCAmJiBULmVuYWJsZWQgJiYgKChULmxlZnRTb2xpZCAmJiBYID4gMCkgfHwgKFQucmlnaHRTb2xpZCAmJiBYIDwgMCkpKSlcclxuICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgVCA9IEdhbWUuVE0uQ2hlY2tGb3JUaWxlKFBvc2l0aW9uICsgbmV3IFZlY3RvcjIoWCwgKEhlaWdodCAvIDIpLTIpKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBpZiAoIShUICE9IG51bGwgJiYgVC5lbmFibGVkICYmICgoVC5sZWZ0U29saWQgJiYgWCA+IDApIHx8IChULnJpZ2h0U29saWQgJiYgWCA8IDApKSkpXHJcbiAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgIFQgPSBHYW1lLlRNLkNoZWNrRm9yVGlsZShQb3NpdGlvbiArIG5ldyBWZWN0b3IyKFgsIEhlaWdodC0yKSk7XHJcbiAgICAgICAgICAgICAgICBpZiAoVCAhPSBudWxsICYmIFQuSXNTbG9wZSlcclxuICAgICAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgICAgICBUID0gbnVsbDtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBpZiAoIShUICE9IG51bGwgJiYgVC5lbmFibGVkICYmICgoVC5sZWZ0U29saWQgJiYgWCA+IDApIHx8IChULnJpZ2h0U29saWQgJiYgWCA8IDApKSkpXHJcbiAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgIFQgPSBudWxsO1xyXG4gICAgICAgICAgICB9Ki9cclxuICAgICAgICAgICAgaWYgKCFJc1RpbGVPYnN0YWNsZShULCBYKSlcclxuICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgVCA9IEdhbWUuVE0uQ2hlY2tGb3JUaWxlKFZlY3RvcjIuQWRkKFBvc2l0aW9uLCBYLCAoSGVpZ2h0IC8gMikgLSAyKSk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgaWYgKCFJc1RpbGVPYnN0YWNsZShULCBYKSlcclxuICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgVCA9IEdhbWUuVE0uQ2hlY2tGb3JUaWxlKFZlY3RvcjIuQWRkKFBvc2l0aW9uLCBYLCBIZWlnaHQgLSAyKSk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgaWYgKCFJc1RpbGVPYnN0YWNsZShULCBYKSlcclxuICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgVCA9IG51bGw7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgcmV0dXJuIFQ7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHByb3RlY3RlZCBib29sIElzVGlsZU9ic3RhY2xlKFRpbGVEYXRhIFQsIGZsb2F0IFgpXHJcbiAgICAgICAge1xyXG4gICAgICAgICAgICBpZiAoVCAhPSBudWxsICYmIFQuZW5hYmxlZCAmJiAoKFQubGVmdFNvbGlkICYmIFggPiAwKSB8fCAoVC5yaWdodFNvbGlkICYmIFggPCAwKSkgJiYgKEZsb29yID09IG51bGwgfHwgVC5yb3cgPCBGbG9vci5yb3cpKVxyXG4gICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICBmbG9hdCBZID0geSArIEhlaWdodDtcclxuICAgICAgICAgICAgICAgIC8vaWYgKFQuR2V0SGl0Ym94KCkueSA8IFktMjgpXHJcbiAgICAgICAgICAgICAgICAvL2lmIChULkdldEhpdGJveCgpLnkgPCBZIC0gOClcclxuICAgICAgICAgICAgICAgIC8vaWYgKFQuR2V0SGl0Ym94KCkueSA8IFkgLSA0KVxyXG4gICAgICAgICAgICAgICAgaWYgKFQuR2V0SGl0Ym94KCkueSA8IFkgLSAwKVxyXG4gICAgICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgICAgIHJldHVybiAhVC5Jc1Nsb3BlO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIHJldHVybiBmYWxzZTtcclxuICAgICAgICB9XHJcbiAgICAgICAgcHJvdGVjdGVkIHZvaWQgVXBkYXRlVGVycmFpbkNvbGxpc2lvbigpXHJcbiAgICAgICAge1xyXG4gICAgICAgICAgICBGbG9vciA9IEdldEZsb29yKCk7XHJcbiAgICAgICAgICAgIENlaWxpbmcgPSBHZXRDZWlsaW5nKCk7XHJcbiAgICAgICAgICAgIGlmIChGbG9vciAhPSBudWxsICYmIEZsb29yLlN0ZXBwZWRPbi5BczxkeW5hbWljPigpKVxyXG4gICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICBGbG9vci5TdGVwcGVkT24odGhpcyk7XHJcbiAgICAgICAgICAgIH1cclxuXHJcblxyXG4gICAgICAgICAgICBpZiAoVnNwZWVkIDwgbWF4RmFsbFNwZWVkICYmIEdyYXZpdHlFbmFibGVkKVxyXG4gICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICBWc3BlZWQgPSAoZmxvYXQpTWF0aC5NaW4oVnNwZWVkICsgZ3Jhdml0eSwgbWF4RmFsbFNwZWVkKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBib29sIHN0dWNrID0gZmFsc2U7XHJcbiAgICAgICAgICAgIGlmIChGbG9vciAhPSBudWxsKVxyXG4gICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICBib29sIGMgPSB0cnVlO1xyXG4gICAgICAgICAgICAgICAgd2hpbGUgKGMpXHJcbiAgICAgICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICAgICAgVGlsZURhdGEgVCA9IEZsb29yLkdldFRpbGVEYXRhKDAsIC0xKTtcclxuICAgICAgICAgICAgICAgICAgICBpZiAoVCAhPSBudWxsICYmIFQuZW5hYmxlZCAmJiBULnNvbGlkKVxyXG4gICAgICAgICAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgRmxvb3IgPSBUO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBzdHVjayA9IHRydWU7XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgIGVsc2VcclxuICAgICAgICAgICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGMgPSBmYWxzZTtcclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgc3R1Y2sgPSBmYWxzZTtcclxuICAgICAgICAgICAgb25Hcm91bmQgPSBmYWxzZTtcclxuICAgICAgICAgICAgaWYgKEZsb29yICE9IG51bGwgJiYgVnNwZWVkID49IDApXHJcbiAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgIC8vZmxvYXQgWSA9IEZsb29yLkdldEhpdGJveCgpLnRvcCAtIEhlaWdodDtcclxuICAgICAgICAgICAgICAgIGZsb2F0IFkgPSBGbG9vci5HZXRUb3AoZ2V0Q2VudGVyKCkpIC0gSGVpZ2h0O1xyXG4gICAgICAgICAgICAgICAgLy9pZiAoIUZsb29yLnBsYXRmb3JtIHx8IHkgPD0gWSArIFZzcGVlZClcclxuICAgICAgICAgICAgICAgIC8vaWYgKCFGbG9vci5wbGF0Zm9ybSB8fCB5K1ZzcGVlZD49WSlcclxuICAgICAgICAgICAgICAgIGlmICgoIUZsb29yLnBsYXRmb3JtIHx8IHkgPD0gWSArIFZzcGVlZCkgJiYgeSArIChWc3BlZWQgKyAxMCkgPj0gWSlcclxuICAgICAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgICAgICBpZiAoVnNwZWVkID4gMClcclxuICAgICAgICAgICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIFZzcGVlZCA9IDA7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIG9uR3JvdW5kID0gdHJ1ZTtcclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgeSA9IFk7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgaWYgKEhzcGVlZCAhPSAwKVxyXG4gICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICBUaWxlRGF0YSB3YWxsID0gSHNwZWVkID4gMCA/IFJpZ2h0V2FsbCA6IExlZnRXYWxsO1xyXG4gICAgICAgICAgICAgICAgaWYgKHdhbGwgIT0gbnVsbClcclxuICAgICAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgICAgICBIc3BlZWQgPSAwO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIGZsb2F0IFcgPSBXaWR0aCAvIDM7XHJcbiAgICAgICAgICAgIGZsb2F0IFggPSAoZmxvYXQpTWF0aC5BYnMoSHNwZWVkKTtcclxuICAgICAgICAgICAgaWYgKEhzcGVlZCA8IDApXHJcbiAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgIFggLT0gMiAtIFc7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgZWxzZVxyXG4gICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICBYICs9IChXaWR0aCAtIFcpICsgMjtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBSaWdodFdhbGwgPSBDaGVja1dhbGwoWCk7XHJcblxyXG4gICAgICAgICAgICBYID0gKGZsb2F0KS1NYXRoLkFicyhIc3BlZWQpO1xyXG4gICAgICAgICAgICBpZiAoSHNwZWVkIDwgMClcclxuICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgWCAtPSAyIC0gVztcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBlbHNlXHJcbiAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgIFggKz0gKFdpZHRoIC0gVykgKyAyO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIExlZnRXYWxsID0gQ2hlY2tXYWxsKFgpO1xyXG4gICAgICAgICAgICBpZiAoTGVmdFdhbGwgIT0gbnVsbCAmJiBMZWZ0V2FsbCA9PSBSaWdodFdhbGwpXHJcbiAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgIFJlY3RhbmdsZSBSID0gTGVmdFdhbGwuR2V0SGl0Ym94KCk7XHJcbiAgICAgICAgICAgICAgICBWZWN0b3IyIFYgPSBSLkNlbnRlcjtcclxuICAgICAgICAgICAgICAgIGlmICgoViAtIFBvc2l0aW9uKS5YID4gMClcclxuICAgICAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgICAgICB4ICs9IDE7XHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKEhzcGVlZCA8IDApXHJcbiAgICAgICAgICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBIc3BlZWQgPSAwO1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIGVsc2VcclxuICAgICAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgICAgICB4IC09IDE7XHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKEhzcGVlZCA+IDApXHJcbiAgICAgICAgICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBIc3BlZWQgPSAwO1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBpZiAoc3R1Y2spXHJcbiAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgIFVwZGF0ZVRlcnJhaW5Db2xsaXNpb24oKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuICAgIH1cclxufVxyXG4iLCJ1c2luZyBTeXN0ZW07XHJcbnVzaW5nIFN5c3RlbS5Db2xsZWN0aW9ucy5HZW5lcmljO1xyXG51c2luZyBTeXN0ZW0uTGlucTtcclxudXNpbmcgU3lzdGVtLlRleHQ7XHJcbnVzaW5nIFN5c3RlbS5UaHJlYWRpbmcuVGFza3M7XHJcblxyXG5uYW1lc3BhY2UgQ2lybm9HYW1lXHJcbntcclxuICAgIHB1YmxpYyBjbGFzcyBPcmIgOiBDb2xsZWN0YWJsZUl0ZW1cclxuICAgIHtcclxuICAgICAgICBwdWJsaWMgT3JiKEdhbWUgZ2FtZSkgOiBiYXNlKGdhbWUsIFwib3JiXCIpXHJcbiAgICAgICAge1xyXG4gICAgICAgICAgICAvL0FuaSA9IG5ldyBBbmltYXRpb24oQW5pbWF0aW9uTG9hZGVyLkdldChcImltYWdlcy9taXNjL29yYlwiKSk7XHJcbiAgICAgICAgICAgIG1hZ25ldERpc3RhbmNlID0gNTU7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHB1YmxpYyBvdmVycmlkZSB2b2lkIG9uQ29sbGVjdGVkKFBsYXllckNoYXJhY3RlciBwbGF5ZXIpXHJcbiAgICAgICAge1xyXG4gICAgICAgICAgICAvL3Rocm93IG5ldyBOb3RJbXBsZW1lbnRlZEV4Y2VwdGlvbigpO1xyXG4gICAgICAgICAgICB2YXIgdGltZSA9ICgxMDAwKSAqICgxMyAtIE1hdGguTWluKEdhbWUubGV2ZWwtMSAqIDAuMTVmLDcpKTtcclxuICAgICAgICAgICAgaWYgKEdhbWUudGltZVJlbWFpbmluZyA+IDApXHJcbiAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgIEdhbWUudGltZVJlbWFpbmluZyArPSB0aW1lO1xyXG4gICAgICAgICAgICAgICAgR2FtZS50aW1lUmVtYWluaW5nID0gTWF0aC5NaW4oR2FtZS5kZWZhdWx0VGltZVJlbWFpbmluZywgR2FtZS50aW1lUmVtYWluaW5nKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBlbHNlXHJcbiAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgIEdhbWUudGltZVJlbWFpbmluZyArPSB0aW1lO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG4gICAgICAgIC8qcHVibGljIG92ZXJyaWRlIHZvaWQgVXBkYXRlKClcclxuICAgICAgICB7XHJcbiAgICAgICAgICAgIGlmIChHYW1lLnBsYXllci5Qb3NpdGlvbi5Fc3RpbWF0ZWREaXN0YW5jZShQb3NpdGlvbikgPCAzNSlcclxuICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgdmFyIFAgPSBHYW1lLnBsYXllci5Qb3NpdGlvbiAtIFBvc2l0aW9uO1xyXG4gICAgICAgICAgICAgICAgdmFyIGxuID0gUC5MZW5ndGg7XHJcbiAgICAgICAgICAgICAgICB2YXIgc3BkID0gODtcclxuICAgICAgICAgICAgICAgIFAgPSBQLk5vcm1hbGl6ZShzcGQgLyBNYXRoLk1heCgxLGxuKSk7XHJcbiAgICAgICAgICAgICAgICB4ICs9IFAuWDtcclxuICAgICAgICAgICAgICAgIHkgKz0gUC5ZO1xyXG4gICAgICAgICAgICAgICAgaWYgKGxuIDw9IHNwZClcclxuICAgICAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgICAgICBBbGl2ZSA9IGZhbHNlO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIGJhc2UuVXBkYXRlKCk7XHJcbiAgICAgICAgfSovXHJcbiAgICB9XHJcbn1cclxuIiwidXNpbmcgU3lzdGVtO1xyXG51c2luZyBTeXN0ZW0uQ29sbGVjdGlvbnMuR2VuZXJpYztcclxudXNpbmcgU3lzdGVtLkxpbnE7XHJcbnVzaW5nIFN5c3RlbS5UZXh0O1xyXG51c2luZyBTeXN0ZW0uVGhyZWFkaW5nLlRhc2tzO1xyXG5cclxubmFtZXNwYWNlIENpcm5vR2FtZVxyXG57XHJcbiAgICBwdWJsaWMgY2xhc3MgUG9pbnRJdGVtIDogQ29sbGVjdGFibGVJdGVtXHJcbiAgICB7XHJcbiAgICAgICAgcHVibGljIFBvaW50SXRlbShHYW1lIGdhbWUpIDogYmFzZShnYW1lLCBcInBvaW50XCIpXHJcbiAgICAgICAge1xyXG4gICAgICAgICAgICBmbG9hdHMgPSBmYWxzZTtcclxuICAgICAgICAgICAgLy9tYWduZXREaXN0YW5jZSA9IDEwMDtcclxuICAgICAgICAgICAgbWFnbmV0RGlzdGFuY2UgPSA3MDtcclxuICAgICAgICAgICAgbWFnbmV0U3BlZWQgKj0gODtcclxuICAgICAgICB9XHJcbiAgICAgICAgcHVibGljIG92ZXJyaWRlIHZvaWQgb25Db2xsZWN0ZWQoUGxheWVyQ2hhcmFjdGVyIHBsYXllcilcclxuICAgICAgICB7XHJcbiAgICAgICAgICAgIHBsYXllci5zY29yZSArPSA1O1xyXG4gICAgICAgIH1cclxuICAgIH1cclxufVxyXG4iLCJ1c2luZyBTeXN0ZW07XHJcbnVzaW5nIFN5c3RlbS5Db2xsZWN0aW9ucy5HZW5lcmljO1xyXG51c2luZyBTeXN0ZW0uTGlucTtcclxudXNpbmcgU3lzdGVtLlRleHQ7XHJcbnVzaW5nIFN5c3RlbS5UaHJlYWRpbmcuVGFza3M7XHJcblxyXG5uYW1lc3BhY2UgQ2lybm9HYW1lXHJcbntcclxuICAgIHB1YmxpYyBjbGFzcyBNUkdob3N0eSA6IFBsYXRmb3JtZXJFbnRpdHksIElDb21iYXRhbnQsIElIYXJtZnVsRW50aXR5XHJcbiAgICB7XHJcbiAgICAgICAgcHVibGljIHN0cmluZyBhbmltYXRpb24gPSBcIj8/P1wiO1xyXG5cclxuICAgICAgICBwdWJsaWMgaW50IFRlYW0geyBnZXQ7IHNldDsgfVxyXG5cclxuICAgICAgICBwdWJsaWMgZmxvYXQgSFAgeyBnZXQ7IHNldDsgfVxyXG5cclxuICAgICAgICBwdWJsaWMgaW50IFBvaW50c0ZvcktpbGxpbmdcclxuICAgICAgICB7XHJcbiAgICAgICAgICAgIGdldFxyXG4gICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gMTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgcHVibGljIGZsb2F0IFRhcmdldFByaW9yaXR5XHJcbiAgICAgICAge1xyXG4gICAgICAgICAgICBnZXRcclxuICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuIDAuNWY7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIHB1YmxpYyBib29sIElzSGFybWZ1bFxyXG4gICAgICAgIHtcclxuICAgICAgICAgICAgZ2V0XHJcbiAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgIHJldHVybiB0cnVlO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBwdWJsaWMgRW50aXR5IEF0dGFja2VyXHJcbiAgICAgICAge1xyXG4gICAgICAgICAgICBnZXRcclxuICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuIHRoaXM7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIHB1YmxpYyBmbG9hdCB0b3VjaERhbWFnZVxyXG4gICAgICAgIHtcclxuICAgICAgICAgICAgZ2V0XHJcbiAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgIHJldHVybiBhdHRhY2twb3dlcioxLjVmO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHB1YmxpYyBmbG9hdCBhdHRhY2twb3dlciA9IDE7XHJcbiAgICAgICAgcHVibGljIGZsb2F0IGRlZmVuc2Vwb3dlciA9IDE7XHJcblxyXG4gICAgICAgIHB1YmxpYyBNUkdob3N0eShHYW1lIGdhbWUpIDogYmFzZShnYW1lKVxyXG4gICAgICAgIHtcclxuICAgICAgICAgICAgQ2hhbmdlQW5pKFwiXCIpO1xyXG4gICAgICAgICAgICBBZGRCZWhhdmlvcihuZXcgRmxpZ2h0Q29udHJvbHModGhpcykpO1xyXG4gICAgICAgICAgICBBZGRCZWhhdmlvcihuZXcgUmFuZG9tQUkodGhpcykpO1xyXG4gICAgICAgICAgICBhdHRhY2twb3dlciA9IDEgKyAoR2FtZS5sZXZlbCAqIDAuNWYpO1xyXG4gICAgICAgICAgICBkZWZlbnNlcG93ZXIgPSAxICsgKEdhbWUubGV2ZWwgKiAwLjVmKTtcclxuICAgICAgICAgICAgaWYgKEdhbWUucGxheWluZylcclxuICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgQWRkQmVoYXZpb3I8QWltZWRTaG9vdGVyPigpO1xyXG4gICAgICAgICAgICAgICAgR2V0QmVoYXZpb3I8QWltZWRTaG9vdGVyPigpLmF0dGFja3Bvd2VyID0gYXR0YWNrcG93ZXI7XHJcbiAgICAgICAgICAgICAgICBHZXRCZWhhdmlvcjxBaW1lZFNob290ZXI+KCkubWF4dGltZSA9IE1hdGguTWF4KDQ4MCAtIChHYW1lLmxldmVsICogMTApLCAzODApO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIEdldEJlaGF2aW9yPEZsaWdodENvbnRyb2xzPigpLm1heFNwZWVkICo9IDAuNWY7XHJcblxyXG4gICAgICAgICAgICBHcmF2aXR5RW5hYmxlZCA9IGZhbHNlO1xyXG4gICAgICAgICAgICBUZWFtID0gMjtcclxuICAgICAgICAgICAgSFAgPSAyO1xyXG4gICAgICAgIH1cclxuICAgICAgICBwdWJsaWMgb3ZlcnJpZGUgdm9pZCBVcGRhdGUoKVxyXG4gICAgICAgIHtcclxuICAgICAgICAgICAgYmFzZS5VcGRhdGUoKTtcclxuICAgICAgICAgICAgQW5pLkZsaXBwZWQgPSAoSHNwZWVkIDwgMCk7XHJcbiAgICAgICAgICAgIEFuaS5JbWFnZVNwZWVkID0gKGZsb2F0KSgoTWF0aC5BYnMoSHNwZWVkKSArIE1hdGguQWJzKFZzcGVlZCkpICogMC4xMjUpO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgcHVibGljIHZvaWQgQ2hhbmdlQW5pKHN0cmluZyBhbmltYXRpb24sIGJvb2wgcmVzZXQgPSBmYWxzZSlcclxuICAgICAgICB7XHJcbiAgICAgICAgICAgIGlmICh0aGlzLmFuaW1hdGlvbiA9PSBhbmltYXRpb24pXHJcbiAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgIHJldHVybjtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBpZiAoQW5pID09IG51bGwpXHJcbiAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgIEFuaSA9IG5ldyBBbmltYXRpb24oQW5pbWF0aW9uTG9hZGVyLkdldChcImltYWdlcy9lbmVtaWVzL21yZ2hvc3RcIiArIGFuaW1hdGlvbikpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIGVsc2VcclxuICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgQW5pLkNoYW5nZUFuaW1hdGlvbihBbmltYXRpb25Mb2FkZXIuR2V0KFwiaW1hZ2VzL2VuZW1pZXMvbXJnaG9zdFwiICsgYW5pbWF0aW9uKSwgcmVzZXQpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIHRoaXMuYW5pbWF0aW9uID0gYW5pbWF0aW9uO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgcHVibGljIHZvaWQgb25EYW1hZ2VkKElIYXJtZnVsRW50aXR5IHNvdXJjZSwgZmxvYXQgYW1vdW50KVxyXG4gICAgICAgIHtcclxuICAgICAgICAgICAgLy90aHJvdyBuZXcgTm90SW1wbGVtZW50ZWRFeGNlcHRpb24oKTtcclxuICAgICAgICAgICAgLy9pZiAoIShzb3VyY2UgaXMgTVJHaG9zdHkpKVxyXG4gICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICBIUCAtPSAoYW1vdW50IC8gZGVmZW5zZXBvd2VyKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAvKmVsc2VcclxuICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgSGVscGVyLkxvZyhcImdob3N0cyBhcmUgYWxsZXJnaWMgdG8gdGhlbXNlbHZlcz8/P1wiKTtcclxuICAgICAgICAgICAgfSovXHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBwdWJsaWMgdm9pZCBvbkRlYXRoKElIYXJtZnVsRW50aXR5IHNvdXJjZSlcclxuICAgICAgICB7XHJcbiAgICAgICAgICAgIC8vdGhyb3cgbmV3IE5vdEltcGxlbWVudGVkRXhjZXB0aW9uKCk7XHJcbiAgICAgICAgICAgIEFsaXZlID0gZmFsc2U7XHJcbiAgICAgICAgICAgIENvbGxlY3RhYmxlSXRlbSBQID0gbmV3IFBvaW50SXRlbShHYW1lKTtcclxuICAgICAgICAgICAgUC5Qb3NpdGlvbi5Db3B5RnJvbShQb3NpdGlvbik7XHJcbiAgICAgICAgICAgIFAuY29sbGVjdGlvbkRlbGF5IC89IDI7XHJcbiAgICAgICAgICAgIEdhbWUuQWRkRW50aXR5KFApO1xyXG4gICAgICAgICAgICBpZiAoTWF0aC5SYW5kb20oKSA8IDAuMTUpXHJcbiAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgIFAgPSBuZXcgSGVhbGluZ0l0ZW0oR2FtZSk7XHJcbiAgICAgICAgICAgICAgICBQLlBvc2l0aW9uLkNvcHlGcm9tKFBvc2l0aW9uKTtcclxuICAgICAgICAgICAgICAgIFAuVnNwZWVkID0gLTI7XHJcbiAgICAgICAgICAgICAgICBQLmNvbGxlY3Rpb25EZWxheSAvPSAyO1xyXG4gICAgICAgICAgICAgICAgdGhpcy5HYW1lLkFkZEVudGl0eShQKTtcclxuICAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIHB1YmxpYyB2b2lkIG9uS2lsbChJQ29tYmF0YW50IGNvbWJhdGFudClcclxuICAgICAgICB7XHJcbiAgICAgICAgICAgIC8vdGhyb3cgbmV3IE5vdEltcGxlbWVudGVkRXhjZXB0aW9uKCk7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBwdWJsaWMgYm9vbCBvbnRvdWNoRGFtYWdlKElDb21iYXRhbnQgdGFyZ2V0KVxyXG4gICAgICAgIHtcclxuICAgICAgICAgICAgLy90aHJvdyBuZXcgTm90SW1wbGVtZW50ZWRFeGNlcHRpb24oKTtcclxuICAgICAgICAgICAgcmV0dXJuIHRydWU7XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG59XHJcbiIsInVzaW5nIFN5c3RlbTtcclxudXNpbmcgU3lzdGVtLkNvbGxlY3Rpb25zLkdlbmVyaWM7XHJcbnVzaW5nIFN5c3RlbS5MaW5xO1xyXG51c2luZyBTeXN0ZW0uVGV4dDtcclxudXNpbmcgU3lzdGVtLlRocmVhZGluZy5UYXNrcztcclxuXHJcbm5hbWVzcGFjZSBDaXJub0dhbWVcclxue1xyXG4gICAgcHVibGljIGNsYXNzIFBsYXllckNoYXJhY3RlciA6IFBsYXRmb3JtZXJFbnRpdHksIElDb21iYXRhbnRcclxuICAgIHtcclxuICAgICAgICBwdWJsaWMgc3RyaW5nIGFuaW1hdGlvbiA9IFwiPz8/XCI7XHJcbiAgICAgICAgcHVibGljIGludCBzaG9vdHRpbWUgPSAwO1xyXG4gICAgICAgIHB1YmxpYyBzdHJpbmcgcHJlZml4ID0gXCJcIjtcclxuICAgICAgICBwcml2YXRlIGJvb2wgbmV3SW5wdXQ7XHJcbiAgICAgICAgcHVibGljIGludFtdIHRhcFRpbWVyO1xyXG4gICAgICAgIHB1YmxpYyBpbnQgc2hvb3RSZWNoYXJnZSA9IDA7XHJcbiAgICAgICAgcHVibGljIGludCB0dXJudGltZSA9IDA7Ly90aGUgYW1vdW50IG9mIHRpbWUgdGhlIHVzZXIgaGFzIGJlZW4gbW92aW5nIG5vcm1hbGx5L3N0YW5kaW5nIHN0aWxsLCBpZiBsb25nIGVub3VnaCB0aGUgY2hhcmFjdGVyIHdpbGwgdHVybiBub3JtYWxseS5cclxuICAgICAgICBwdWJsaWMgaW50IHNjb3JlID0gMDtcclxuICAgICAgICBwdWJsaWMgaW50IG9yYnMgPSAwO1xyXG4gICAgICAgIHB1YmxpYyBpbnQga2V5cyA9IDA7XHJcbiAgICAgICAgcHVibGljIGZsb2F0IGVuZXJneVJlY2hhcmdlID0gMC4wMjJmO1xyXG4gICAgICAgIHB1YmxpYyBmbG9hdCBtYXhFbmVyZ3kgPSA0O1xyXG4gICAgICAgIHB1YmxpYyBmbG9hdCBlbmVyZ3kgPSA0O1xyXG5cclxuICAgICAgICBwdWJsaWMgaW50IFRlYW0geyBnZXQ7IHNldDsgfVxyXG5cclxuICAgICAgICBwdWJsaWMgZmxvYXQgbWF4SFAgPSAyMDtcclxuICAgICAgICBwdWJsaWMgZmxvYXQgSFAgeyBnZXQ7IHNldDsgfVxyXG4gICAgICAgIHB1YmxpYyBmbG9hdCByZWdlblJhdGUgPSAxZjtcclxuICAgICAgICBwdWJsaWMgVmVjdG9yMiBTcGF3bkxvY2F0aW9uID0gbmV3IFZlY3RvcjIoKTtcclxuICAgICAgICBwdWJsaWMgaW50IGxpdmVzID0gMztcclxuICAgICAgICBwdWJsaWMgaW50IGZyYW1lID0gMDtcclxuXHJcbiAgICAgICAgcHVibGljIGZsb2F0IGRpZ3Bvd2VyID0gMS4wZjtcclxuICAgICAgICBwdWJsaWMgZmxvYXQgYXR0YWNrcG93ZXIgPSAxZjtcclxuICAgICAgICBwdWJsaWMgZmxvYXQgZGVmZW5zZXBvd2VyID0gMWY7XHJcblxyXG4gICAgICAgIHB1YmxpYyBmbG9hdCBpbnZpbmNpYmlsaXR5dGltZSA9IDA7XHJcbiAgICAgICAgcHVibGljIGZsb2F0IGJsb2NrcHJpY2UgPSA0ZjtcclxuXHJcbiAgICAgICAgcHVibGljIGZsb2F0IGludmluY2liaWxpdHltb2QgPSAxZjtcclxuXHJcbiAgICAgICAgcHVibGljIGludCBjdXJyZW50c2hvdCA9IDA7XHJcbiAgICAgICAgcHVibGljIGludCBzaG90ZGVsYXkgPSA1O1xyXG4gICAgICAgIHB1YmxpYyBpbnQgY3VycmVudHNob3RkZWxheSA9IDA7XHJcbiAgICAgICAgcHVibGljIGludCB0b3RhbHNob3RzID0gMTsvL251bWJlciBvZiBzaG90cyBwZXIgY29tbWFuZFxyXG5cclxuICAgICAgICBwdWJsaWMgRmxvYXRpbmdNZXNzYWdlIE1TRztcclxuXHJcblxyXG4gICAgICAgIHB1YmxpYyBpbnQgUG9pbnRzRm9yS2lsbGluZ1xyXG4gICAgICAgIHtcclxuICAgICAgICAgICAgZ2V0XHJcbiAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgIHJldHVybiAzMDA7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIHB1YmxpYyBmbG9hdCBUYXJnZXRQcmlvcml0eVxyXG4gICAgICAgIHtcclxuICAgICAgICAgICAgZ2V0XHJcbiAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgIHJldHVybiAwLjdmO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHB1YmxpYyB2b2lkIE1vdmVUb05ld1NwYXduKFZlY3RvcjIgTmV3U3Bhd25Mb2NhdGlvbilcclxuICAgICAgICB7XHJcbiAgICAgICAgICAgIFNwYXduTG9jYXRpb24uQ29weUZyb20oTmV3U3Bhd25Mb2NhdGlvbik7XHJcbiAgICAgICAgICAgIFBvc2l0aW9uLkNvcHlGcm9tKFNwYXduTG9jYXRpb24pO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgcHVibGljIHZvaWQgc2hvb3QoKVxyXG4gICAgICAgIHtcclxuICAgICAgICAgICAgaWYgKGVuZXJneSA8IDEpXHJcbiAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgIHJldHVybjtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBpZiAoc2hvb3R0aW1lIDwgMSlcclxuICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgcHJlZml4ID0gXCJzXCI7XHJcbiAgICAgICAgICAgICAgICBDaGFuZ2VBbmkocHJlZml4ICsgYW5pbWF0aW9uKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBpZiAoc2hvb3RSZWNoYXJnZSA8PSAwKVxyXG4gICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICBjdXJyZW50c2hvdCA9IDE7XHJcbiAgICAgICAgICAgICAgICBEb1Nob3QoKTtcclxuICAgICAgICAgICAgICAgIGVuZXJneSAtPSAxO1xyXG4gICAgICAgICAgICAgICAgLy9zaG9vdFJlY2hhcmdlID0gMTI7XHJcbiAgICAgICAgICAgICAgICBcclxuICAgICAgICAgICAgICAgIGN1cnJlbnRzaG90ZGVsYXkgPSAwO1xyXG4gICAgICAgICAgICAgICAgLy9zaG9vdFJlY2hhcmdlID0gMjA7XHJcbiAgICAgICAgICAgICAgICBzaG9vdFJlY2hhcmdlID0gMTY7XHJcblxyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIHNob290dGltZSA9IDUwO1xyXG4gICAgICAgICAgICAvL3Nob290dGltZSA9IDQwO1xyXG4gICAgICAgICAgICB0dXJudGltZSA9IDA7XHJcblxyXG4gICAgICAgIH1cclxuICAgICAgICB2b2lkIERvU2hvdCgpXHJcbiAgICAgICAge1xyXG4gICAgICAgICAgICB2YXIgUEIgPSBuZXcgUGxheWVyQnVsbGV0KEdhbWUsIHRoaXMsIFwiSW1hZ2VzL21pc2MvY3J5c3RhbFwiKTtcclxuICAgICAgICAgICAgUEIuSHNwZWVkID0gQW5pLkZsaXBwZWQgPyAtMi41ZiA6IDIuNWY7XHJcbiAgICAgICAgICAgIFBCLnggPSB4ICsgKEFuaS5GbGlwcGVkID8gLTQgOiAxMik7XHJcbiAgICAgICAgICAgIFBCLnkgPSB5ICsgMTA7XHJcbiAgICAgICAgICAgIGlmICghQ29udHJvbGxlclswXSAmJiAhQ29udHJvbGxlclsxXSlcclxuICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgaWYgKENvbnRyb2xsZXJbMl0pXHJcbiAgICAgICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICAgICAgUEIuSHNwZWVkICo9IDAuOGY7XHJcbiAgICAgICAgICAgICAgICAgICAgUEIuVnNwZWVkID0gLShmbG9hdClNYXRoLkFicyhQQi5Ic3BlZWQpO1xyXG4gICAgICAgICAgICAgICAgICAgIFBCLkhzcGVlZCAqPSAwLjZmO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgZWxzZSBpZiAoQ29udHJvbGxlclszXSlcclxuICAgICAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgICAgICBQQi5Ic3BlZWQgKj0gMC44ZjtcclxuICAgICAgICAgICAgICAgICAgICBQQi5Wc3BlZWQgPSAoZmxvYXQpTWF0aC5BYnMoUEIuSHNwZWVkKTtcclxuICAgICAgICAgICAgICAgICAgICBQQi5Ic3BlZWQgKj0gMC42ZjtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBlbHNlXHJcbiAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgIGlmIChDb250cm9sbGVyWzJdKVxyXG4gICAgICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgICAgIFBCLkhzcGVlZCAqPSAwLjlmO1xyXG4gICAgICAgICAgICAgICAgICAgIFBCLlZzcGVlZCA9IC0oZmxvYXQpTWF0aC5BYnMoUEIuSHNwZWVkICogMC43KTtcclxuXHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICBlbHNlIGlmIChDb250cm9sbGVyWzNdKVxyXG4gICAgICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgICAgIFBCLkhzcGVlZCAqPSAwLjlmO1xyXG4gICAgICAgICAgICAgICAgICAgIFBCLlZzcGVlZCA9IChmbG9hdClNYXRoLkFicyhQQi5Ic3BlZWQgKiAwLjcpO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIFBCLnggLT0gUEIuSHNwZWVkO1xyXG4gICAgICAgICAgICBQQi55IC09IFBCLlZzcGVlZDtcclxuICAgICAgICAgICAgUEIuYXR0YWNrc3RlcnJhaW4gPSBjdXJyZW50c2hvdD09MTtcclxuICAgICAgICAgICAgUEIuZGlncG93ZXIgPSAoZGlncG93ZXIpICogMC42NjY3ZjtcclxuICAgICAgICAgICAgUEIudG91Y2hEYW1hZ2UgPSBhdHRhY2twb3dlciAvICgoKHRvdGFsc2hvdHMtMWYpLzJmKSsxZik7XHJcbiAgICAgICAgICAgIEdhbWUuQWRkRW50aXR5KFBCKTtcclxuICAgICAgICB9XHJcbiAgICAgICAgcHVibGljIFBsYXllckNoYXJhY3RlcihHYW1lIGdhbWUpIDogYmFzZShnYW1lKVxyXG4gICAgICAgIHtcclxuICAgICAgICAgICAgQ2hhbmdlQW5pKFwic3RhbmRcIik7XHJcbiAgICAgICAgICAgIEFkZEJlaGF2aW9yPFBsYXRmb3JtZXJDb250cm9scz4oKTtcclxuICAgICAgICAgICAgLy9BZGRCZWhhdmlvcihuZXcgUGxhdGZvcm1lckNvbnRyb2xzKHRoaXMpKTtcclxuICAgICAgICAgICAgdGFwVGltZXIgPSBuZXcgaW50W0NvbnRyb2xsZXIuTGVuZ3RoXTtcclxuICAgICAgICAgICAgVGVhbSA9IDA7XHJcbiAgICAgICAgICAgIEhQID0gbWF4SFA7XHJcbiAgICAgICAgICAgIE1TRyA9IG5ldyBGbG9hdGluZ01lc3NhZ2UoZ2FtZSwgXCJcIik7XHJcbiAgICAgICAgICAgIE1TRy5UZXh0LlRleHRDb2xvciA9IFwiI0ZGRkZGRlwiO1xyXG4gICAgICAgICAgICAvL01TRy5DaGFuZ2VUZXh0KFwiaGVsbG8gd29ybGRcIik7XHJcbiAgICAgICAgICAgIE1TRy5hdXRva2lsbCA9IGZhbHNlO1xyXG4gICAgICAgICAgICBnYW1lLkFkZEVudGl0eShNU0cpO1xyXG4gICAgICAgICAgICBNU0cuUmVtb3ZlZE9uTGV2ZWxFbmQgPSBmYWxzZTtcclxuICAgICAgICAgICAgUmVtb3ZlZE9uTGV2ZWxFbmQgPSBmYWxzZTtcclxuICAgICAgICB9XHJcbiAgICAgICAgcHVibGljIG92ZXJyaWRlIHZvaWQgVXBkYXRlKClcclxuICAgICAgICB7XHJcbiAgICAgICAgICAgIGJhc2UuVXBkYXRlKCk7XHJcbiAgICAgICAgICAgIE1TRy5Qb3NpdGlvbi5YID0gUG9zaXRpb24uWDtcclxuICAgICAgICAgICAgTVNHLlBvc2l0aW9uLlkgPSBQb3NpdGlvbi5ZLTEwO1xyXG5cclxuICAgICAgICAgICAgaWYgKHNob290dGltZSA+IDApXHJcbiAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgIHNob290dGltZS0tO1xyXG4gICAgICAgICAgICAgICAgaWYgKHNob290dGltZSA8IDEpXHJcbiAgICAgICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKFwiXCIgKyBhbmltYXRpb25bMF0gPT0gcHJlZml4KVxyXG4gICAgICAgICAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgQ2hhbmdlQW5pKGFuaW1hdGlvbi5TdWJzdHJpbmcoMSkpO1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICBwcmVmaXggPSBcIlwiO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIFxyXG4gICAgICAgICAgICBpZiAob25Hcm91bmQpXHJcbiAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgIGlmIChIc3BlZWQgIT0gMClcclxuICAgICAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgICAgICBDaGFuZ2VBbmkocHJlZml4ICsgXCJ3YWxrXCIpO1xyXG4gICAgICAgICAgICAgICAgICAgIC8vL0FuaS5GbGlwcGVkID0gSHNwZWVkIDwgMDtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIGVsc2VcclxuICAgICAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgICAgICBDaGFuZ2VBbmkocHJlZml4ICsgXCJzdGFuZFwiKTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIEFuaS5JbWFnZVNwZWVkID0gKGZsb2F0KU1hdGguQWJzKEhzcGVlZCAqIDAuMTI1KTtcclxuICAgICAgICAgICAgICAgIC8vQW5pLkltYWdlU3BlZWQgPSBBbmkuRmxpcHBlZCA/IEhzcGVlZCAqIDAuMTI1ZiA6IC1Ic3BlZWQgKiAwLjEyNWY7XHJcbiAgICAgICAgICAgICAgICAvL0FuaS5JbWFnZVNwZWVkID0gKEFuaS5GbGlwcGVkID8gLUhzcGVlZCA6IEhzcGVlZCkgKiAwLjEyNWY7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgZWxzZVxyXG4gICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICBDaGFuZ2VBbmkocHJlZml4ICsgXCJqdW1wXCIpO1xyXG4gICAgICAgICAgICAgICAgLy9BbmkuSW1hZ2VTcGVlZCA9IChmbG9hdClNYXRoLkFicyhWc3BlZWQgKiAwLjEyNSk7XHJcbiAgICAgICAgICAgICAgICBBbmkuSW1hZ2VTcGVlZCA9IDAuMTVmICsgKGZsb2F0KSgoTWF0aC5BYnMoSHNwZWVkKSArIE1hdGguQWJzKFZzcGVlZCkpICogMC43KTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBpZiAoQW5pLkZsaXBwZWQgIT0gSHNwZWVkIDwgMCB8fCAoSHNwZWVkID09IDAgJiYgb25Hcm91bmQpKVxyXG4gICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICB0dXJudGltZSsrO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIGVsc2VcclxuICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgdHVybnRpbWUgPSAwO1xyXG4gICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICAvL2lmIChMQ29udHJvbGxlclszXSAhPSBDb250cm9sbGVyWzNdICYmIENvbnRyb2xsZXJbM10pXHJcbiAgICAgICAgICAgIC8qaWYgKFByZXNzZWQoMykgfHwgUHJlc3NlZCg0KSB8fCBQcmVzc2VkKDUpIHx8IFByZXNzZWQoNikpXHJcbiAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgIHNob290KCk7XHJcbiAgICAgICAgICAgIH0qL1xyXG4gICAgICAgICAgICBpZiAoY3VycmVudHNob3QgPCB0b3RhbHNob3RzKVxyXG4gICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICBjdXJyZW50c2hvdGRlbGF5Kys7XHJcbiAgICAgICAgICAgICAgICBpZiAoY3VycmVudHNob3RkZWxheSA+PSBzaG90ZGVsYXkpXHJcbiAgICAgICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICAgICAgY3VycmVudHNob3RkZWxheSA9IDA7XHJcbiAgICAgICAgICAgICAgICAgICAgY3VycmVudHNob3QrKztcclxuICAgICAgICAgICAgICAgICAgICBEb1Nob3QoKTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBlbHNlXHJcbiAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgIGlmIChzaG9vdFJlY2hhcmdlID4gMClcclxuICAgICAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgICAgICBzaG9vdFJlY2hhcmdlLS07XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICBlbmVyZ3kgPSBNYXRoLk1pbihlbmVyZ3kgKyBlbmVyZ3lSZWNoYXJnZSwgbWF4RW5lcmd5KTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBpZiAoQ29udHJvbGxlcls0XSlcclxuICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgdHVybnRpbWUgPSAwO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIC8vaWYgKFByZXNzZWQoNCkpXHJcbiAgICAgICAgICAgIGlmIChDb250cm9sbGVyWzRdKVxyXG4gICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICBzaG9vdCgpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIGlmIChQcmVzc2VkKDYpKVxyXG4gICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICBQbGFjZUJsb2NrKCk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgXHJcbiAgICAgICAgICAgIFVwZGF0ZUNvbnRyb2xsZXIoKTtcclxuICAgICAgICAgICAgLy9pZiAodHVybnRpbWUgPiAyMiAmJiBIc3BlZWQgIT0gMClcclxuICAgICAgICAgICAgLy9pZiAodHVybnRpbWUgPiAxOCAmJiBIc3BlZWQgIT0gMClcclxuICAgICAgICAgICAgLy9pZiAodHVybnRpbWUgPiAxNCAmJiBIc3BlZWQgIT0gMClcclxuICAgICAgICAgICAgaWYgKHR1cm50aW1lID4gOCAmJiBIc3BlZWQgIT0gMClcclxuICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgQW5pLkZsaXBwZWQgPSBIc3BlZWQgPCAwO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIGlmIChpbnZpbmNpYmlsaXR5dGltZSA+IDApXHJcbiAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgIC8vQW5pLkFscGhhID0gQW5pLkFscGhhID09IDAgPyAxIDogMDtcclxuICAgICAgICAgICAgICAgIGlmICgoZnJhbWUgJiAxKSA+IDApXHJcbiAgICAgICAgICAgICAgICAgICAgVmlzaWJsZSA9ICFWaXNpYmxlO1xyXG4gICAgICAgICAgICAgICAgaW52aW5jaWJpbGl0eXRpbWUgLT0gMTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBlbHNlXHJcbiAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgIFZpc2libGUgPSB0cnVlO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIC8vaWYgKEdhbWUudGltZVJlbWFpbmluZyA+IDAgJiYgSFA+MCAmJiBpbnZpbmNpYmlsaXR5dGltZTw9MCAmJiBIUDxtYXhIUCAmJiBHYW1lLnRpbWVSZW1haW5pbmcgPCBHYW1lLmRlZmF1bHRUaW1lUmVtYWluaW5nKVxyXG4gICAgICAgICAgICAvKmlmIChHYW1lLnRpbWVSZW1haW5pbmcgPiAwICYmIEhQID4gMCAmJiBpbnZpbmNpYmlsaXR5dGltZSA8PSAwICYmIEhQIDwgbWF4SFAgJiYgR2FtZS50aW1lUmVtYWluaW5nIDwgR2FtZS5sYXN0U3RhbmQpXHJcbiAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgIHZhciBzdGF0aWNNb2QgPSAwLjAwNWY7XHJcbiAgICAgICAgICAgICAgICB2YXIgSFBSYXRlID0gMS0oSFAgLyBtYXhIUCk7XHJcbiAgICAgICAgICAgICAgICB2YXIgVGltZVJhdGUgPSAxLShHYW1lLnRpbWVSZW1haW5pbmcgLyBHYW1lLmRlZmF1bHRUaW1lUmVtYWluaW5nKTtcclxuICAgICAgICAgICAgICAgIHZhciByYXRlID0gKEhQUmF0ZSAqIFRpbWVSYXRlICogcmVnZW5SYXRlKTtcclxuICAgICAgICAgICAgICAgIEhQICs9IChyYXRlICogc3RhdGljTW9kKTtcclxuICAgICAgICAgICAgICAgIGlmIChIUCA+IG1heEhQKVxyXG4gICAgICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgICAgIEhQID0gbWF4SFA7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH0qL1xyXG5cclxuICAgICAgICAgICAgXHJcbiAgICAgICAgICAgIGZyYW1lKys7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHB1YmxpYyB2b2lkIFBsYWNlQmxvY2soKVxyXG4gICAgICAgIHtcclxuICAgICAgICAgICAgdmFyIHByaWNlID0gMTAwMCAqIGJsb2NrcHJpY2U7XHJcbiAgICAgICAgICAgIGlmIChHYW1lLnRpbWVSZW1haW5pbmcgPCBibG9ja3ByaWNlKVxyXG4gICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICByZXR1cm47XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgZmxvYXQgVyA9IFdpZHRoIC8gMztcclxuICAgICAgICAgICAgZmxvYXQgWSA9IEhlaWdodDtcclxuICAgICAgICAgICAgdmFyIFQgPSBHYW1lLlRNLkNoZWNrRm9yVGlsZShWZWN0b3IyLkFkZChQb3NpdGlvbiwgV2lkdGggLyAyLCBZKSk7XHJcbiAgICAgICAgICAgIGlmIChUICE9IG51bGwgJiYgKCFULmVuYWJsZWQgfHwgIVQuc29saWQpKVxyXG4gICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICBULnNvbGlkID0gdHJ1ZTtcclxuICAgICAgICAgICAgICAgIFQuQnJlYWthYmxlID0gdHJ1ZTtcclxuICAgICAgICAgICAgICAgIFQuZW5hYmxlZCA9IHRydWU7XHJcbiAgICAgICAgICAgICAgICBULnRleHR1cmUgPSA0O1xyXG4gICAgICAgICAgICAgICAgVC5VcGRhdGVUaWxlKCk7XHJcbiAgICAgICAgICAgICAgICBULkhQID0gVC5tYXhIUCAqIDI7XHJcbiAgICAgICAgICAgICAgICBHYW1lLnRpbWVSZW1haW5pbmcgLT0gcHJpY2U7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcbiAgICAgICAgcHVibGljIHZvaWQgQ2hhbmdlQW5pKHN0cmluZyBhbmltYXRpb24sIGJvb2wgcmVzZXQgPSBmYWxzZSlcclxuICAgICAgICB7XHJcbiAgICAgICAgICAgIGlmICh0aGlzLmFuaW1hdGlvbiA9PSBhbmltYXRpb24pXHJcbiAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgIHJldHVybjtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBpZiAoQW5pID09IG51bGwpXHJcbiAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgIEFuaSA9IG5ldyBBbmltYXRpb24oQW5pbWF0aW9uTG9hZGVyLkdldChcImltYWdlcy9jaXJuby9cIiArIGFuaW1hdGlvbikpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIGVsc2VcclxuICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgQW5pLkNoYW5nZUFuaW1hdGlvbihBbmltYXRpb25Mb2FkZXIuR2V0KFwiaW1hZ2VzL2Npcm5vL1wiICsgYW5pbWF0aW9uKSwgcmVzZXQpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIGlmICh0aGlzLmFuaW1hdGlvbiAhPSBcInN0YW5kXCIpXHJcbiAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgIHR1cm50aW1lID0gMDtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB0aGlzLmFuaW1hdGlvbiA9IGFuaW1hdGlvbjtcclxuICAgICAgICB9XHJcbiAgICAgICAgcHVibGljIHZvaWQgVXBkYXRlQ29udHJvbGxlcigpXHJcbiAgICAgICAge1xyXG4gICAgICAgICAgICBuZXdJbnB1dCA9IGZhbHNlO1xyXG4gICAgICAgICAgICBpbnQgaSA9IDA7XHJcbiAgICAgICAgICAgIHdoaWxlIChpIDwgQ29udHJvbGxlci5MZW5ndGgpXHJcbiAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgIHRhcFRpbWVyW2ldKys7XHJcbiAgICAgICAgICAgICAgICBpZiAoQ29udHJvbGxlcltpXSAmJiAhTENvbnRyb2xsZXJbaV0pXHJcbiAgICAgICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICAgICAgdGFwVGltZXJbaV0gPSAwO1xyXG4gICAgICAgICAgICAgICAgICAgIG5ld0lucHV0ID0gdHJ1ZTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIExDb250cm9sbGVyW2ldID0gQ29udHJvbGxlcltpXTtcclxuICAgICAgICAgICAgICAgIGkrKztcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAvKmlmIChfbEFpbUFuZ2xlICE9IF9haW1BbmdsZSlcclxuICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgbmV3SW5wdXQgPSB0cnVlO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIF9sQWltQW5nbGUgPSBfYWltQW5nbGU7Ki9cclxuICAgICAgICAgICAgaWYgKG5ld0lucHV0KVxyXG4gICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICAvL0dldEJlaGF2aW9yPE5ldHdvcmtTeW5jPigpLlN5bmMoKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgcHVibGljIHZvaWQgb25EYW1hZ2VkKElIYXJtZnVsRW50aXR5IHNvdXJjZSwgZmxvYXQgYW1vdW50KVxyXG4gICAgICAgIHtcclxuICAgICAgICAgICAgLy90aHJvdyBuZXcgTm90SW1wbGVtZW50ZWRFeGNlcHRpb24oKTtcclxuICAgICAgICAgICAgaWYgKGludmluY2liaWxpdHl0aW1lIDw9IDApXHJcbiAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgIEhQIC09IChhbW91bnQgLyBkZWZlbnNlcG93ZXIpO1xyXG4gICAgICAgICAgICAgICAgaW52aW5jaWJpbGl0eXRpbWUgPSA1MCppbnZpbmNpYmlsaXR5bW9kO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHB1YmxpYyBvdmVycmlkZSB2b2lkIG9uUmVtb3ZlKClcclxuICAgICAgICB7XHJcbiAgICAgICAgICAgIGJhc2Uub25SZW1vdmUoKTtcclxuICAgICAgICAgICAgR2FtZS5SZW1vdmVFbnRpdHkoTVNHKTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIHB1YmxpYyB2b2lkIG9uRGVhdGgoSUhhcm1mdWxFbnRpdHkgc291cmNlKVxyXG4gICAgICAgIHtcclxuICAgICAgICAgICAgLy90aHJvdyBuZXcgTm90SW1wbGVtZW50ZWRFeGNlcHRpb24oKTtcclxuICAgICAgICAgICAgaW52aW5jaWJpbGl0eXRpbWUgKj0gM2Y7XHJcblxyXG4gICAgICAgICAgICBpZiAoR2FtZS5wbGF5ZXIgPT0gdGhpcylcclxuICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgLy9pZiAoR2FtZS50aW1lUmVtYWluaW5nID4gMClcclxuICAgICAgICAgICAgICAgIGlmIChHYW1lLnRpbWVSZW1haW5pbmc+PUdhbWUuYmFzZUxpZmVDb3N0KVxyXG4gICAgICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgICAgIFBvc2l0aW9uLkNvcHlGcm9tKFNwYXduTG9jYXRpb24pO1xyXG4gICAgICAgICAgICAgICAgICAgIEhQID0gbWF4SFA7XHJcbiAgICAgICAgICAgICAgICAgICAgR2FtZS50aW1lUmVtYWluaW5nIC09IEdhbWUuYmFzZUxpZmVDb3N0O1xyXG4gICAgICAgICAgICAgICAgICAgIC8vR2FtZS50aW1lUmVtYWluaW5nICo9IDAuODVmO1xyXG4gICAgICAgICAgICAgICAgICAgIC8vR2FtZS50aW1lUmVtYWluaW5nICo9IDAuNjY2N2Y7XHJcbiAgICAgICAgICAgICAgICAgICAgR2FtZS5jYW1lcmEuaW5zdGF3YXJwID0gdHJ1ZTtcclxuICAgICAgICAgICAgICAgICAgICBHYW1lLnNraXByZW5kZXIgPSB0cnVlO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgZWxzZVxyXG4gICAgICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgICAgIEdhbWUuRG9HYW1lT3ZlcigpO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIGVsc2VcclxuICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgUG9zaXRpb24uQ29weUZyb20oU3Bhd25Mb2NhdGlvbik7XHJcbiAgICAgICAgICAgICAgICBIUCA9IG1heEhQO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBwdWJsaWMgdm9pZCBvbktpbGwoSUNvbWJhdGFudCBjb21iYXRhbnQpXHJcbiAgICAgICAge1xyXG4gICAgICAgICAgICAvL3Rocm93IG5ldyBOb3RJbXBsZW1lbnRlZEV4Y2VwdGlvbigpO1xyXG4gICAgICAgIH1cclxuICAgICAgICBwdWJsaWMgb3ZlcnJpZGUgUmVjdGFuZ2xlIEdldEhpdGJveCgpXHJcbiAgICAgICAge1xyXG4gICAgICAgICAgICAvL3JldHVybiBiYXNlLkdldEhpdGJveCgpO1xyXG4gICAgICAgICAgICBpZiAoQW5pICE9IG51bGwgJiYgQW5pLkN1cnJlbnRJbWFnZSAhPSBudWxsKVxyXG4gICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICAvKnZhciBzaXplID0gNDtcclxuICAgICAgICAgICAgICAgIHZhciBXID0gQW5pLkN1cnJlbnRJbWFnZS5XaWR0aCAvIHNpemU7XHJcbiAgICAgICAgICAgICAgICB2YXIgSCA9IEFuaS5DdXJyZW50SW1hZ2UuSGVpZ2h0IC8gc2l6ZTtcclxuICAgICAgICAgICAgICAgIHZhciBXNCA9IChBbmkuQ3VycmVudEltYWdlLldpZHRoIC8gMikgLSAoVyAvIDIpO1xyXG4gICAgICAgICAgICAgICAgdmFyIEg0ID0gKEFuaS5DdXJyZW50SW1hZ2UuSGVpZ2h0IC8gMikgLSAoSCAvIDIpO1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuIG5ldyBSZWN0YW5nbGUoQW5pLlgrVzQsIEFuaS5ZK0g0LCBXLCBIKTsqL1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuIG5ldyBSZWN0YW5nbGUoQW5pLlggKyAoQW5pLkN1cnJlbnRJbWFnZS5XaWR0aCAvIDJmKSwgQW5pLlkgKyAoQW5pLkN1cnJlbnRJbWFnZS5IZWlnaHQgLyAyZiksIDEsIDEpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIHJldHVybiBudWxsO1xyXG4gICAgICAgIH1cclxuICAgIH1cclxufVxyXG4iXQp9Cg==
