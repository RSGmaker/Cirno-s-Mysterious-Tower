/**
 * @version 1.0.0.0
 * @copyright Copyright Â©  2017
 * @compiler Bridge.NET 16.3.0
 */
Bridge.assembly("CirnoGame", function ($asm, globals) {
    "use strict";

    Bridge.define("CirnoGame.GameMode", {
        statics: {
            fields: {
                TeamBattle: null,
                DeathMatch: null,
                gameModes: null
            },
            ctors: {
                init: function () {
                    Bridge.ready(this.init);
                }
            },
            methods: {
                GetGameModesOfType: function (type) {
                    return new (System.Collections.Generic.List$1(CirnoGame.GameMode)).$ctor1(System.Linq.Enumerable.from(CirnoGame.GameMode.gameModes).where(function (G) {
                            return G.ModeType === type;
                        }));
                },
                GetGameModeByName: function (name) {
                    var ret = new (System.Collections.Generic.List$1(CirnoGame.GameMode)).$ctor1(System.Linq.Enumerable.from(CirnoGame.GameMode.gameModes).where(function (G) {
                            return Bridge.referenceEquals(G.Name, name);
                        }));
                    if (ret.Count > 0) {
                        return ret.getItem(0);
                    }
                    return null;
                },
                init: function () {
                    if (CirnoGame.GameMode.TeamBattle == null) {
                        CirnoGame.GameMode.gameModes = new (System.Collections.Generic.List$1(CirnoGame.GameMode)).ctor();
                        CirnoGame.GameMode.TeamBattle = new CirnoGame.GameMode("Team Battle");
                        CirnoGame.GameMode.TeamBattle.Description = "2 teams battle with limited lives\nuntil only 1 team remains.";
                        CirnoGame.GameMode.DeathMatch = new CirnoGame.GameMode("Death Match");
                        CirnoGame.GameMode.DeathMatch.Description = "A free for all match with\nlimited lives.";
                        CirnoGame.GameMode.DeathMatch.Teams = false;
                    }
                }
            }
        },
        $entryPoint: true,
        props: {
            Teams: false,
            StartingLives: 0,
            Survival: false,
            AllowOnlinePlay: false,
            AllowCharacterSelect: false,
            NumberOfPlayers: 0,
            RespawnTime: 0,
            Name: null,
            ModeType: 0,
            unlocked: false,
            Description: null
        },
        ctors: {
            ctor: function (name) {
                this.$initialize();
                this.Teams = true;
                this.StartingLives = 3;
                this.Survival = true;
                this.AllowOnlinePlay = true;
                this.AllowCharacterSelect = true;
                this.NumberOfPlayers = 6;
                this.RespawnTime = 390;
                this.Name = name;
                this.ModeType = CirnoGame.GameMode.ModeTypes.Skirmish;
                this.Description = System.String.concat("Missing description for ", name);
                this.unlocked = true;
                CirnoGame.GameMode.gameModes.add(this);
            }
        }
    });

    Bridge.define("CirnoGame.EntityBehavior", {
        fields: {
            enabled: false,
            FramesPerTick: 0,
            entity: null
        },
        props: {
            BehaviorName: null
        },
        ctors: {
            init: function () {
                this.enabled = true;
                this.FramesPerTick = 0;
            },
            ctor: function (entity) {
                this.$initialize();
                this.entity = entity;
                if (Bridge.referenceEquals(this.BehaviorName, "") || this.BehaviorName == null) {
                    var test = Bridge.getType(this);
                    var FN = test["$$fullname"];
                    //Helper.Log("FN:" + FN);
                    var s = FN.split(".");
                    this.BehaviorName = s[System.Array.index(((s.length - 1) | 0), s)];
                    //BehaviorName = GetType().FullName;
                    //GetType().GetClassName

                }
            }
        },
        methods: {
            Update: function () {

            },
            Draw: function (g) { },
            SendCustomEvent: function (evt, triggerflush) {
                if (triggerflush === void 0) { triggerflush = false; }
                var D = { };
                D.I = this.entity.ID;
                D.D = evt;
                //D.T = this.GetType().FullName;
                D.T = this.BehaviorName;
                this.entity.Game.SendEvent("CBE", D, triggerflush);
            },
            CustomEvent: function (evt) {

            }
        }
    });

    Bridge.define("CirnoGame.Animation", {
        fields: {
            Images: null,
            _currentImage: null,
            CurrentFrame: 0,
            ImageSpeed: 0,
            Position: null,
            AnimationTimeElapsed: 0,
            StretchWidth: 0,
            StretchHeight: 0,
            Rotation: 0,
            Alpha: 0,
            Looping: false,
            Looped: false,
            FrameChanged: false,
            Flipped: false,
            _transformed: false,
            _shadow: 0,
            _shadowColor: null,
            BufferNeedsRedraw: false,
            _hueColor: null,
            _hueRecolorStrength: 0,
            _buffer: null,
            _bg: null
        },
        props: {
            CurrentImage: {
                get: function () {
                    return this._currentImage;
                },
                set: function (value) {
                    if (!Bridge.referenceEquals(this._currentImage, value)) {
                        this.BufferNeedsRedraw = true;
                    }
                    this._currentImage = value;

                }
            },
            X: {
                get: function () {
                    return this.Position.X;
                },
                set: function (value) {
                    this.Position.X = value;
                }
            },
            Y: {
                get: function () {
                    return this.Position.Y;
                },
                set: function (value) {
                    this.Position.Y = value;
                }
            },
            Shadow: {
                get: function () {
                    return this._shadow;
                },
                set: function (value) {
                    if (this._shadow !== value) {
                        this._shadow = value;
                        this.BufferNeedsRedraw = true;
                    }
                }
            },
            Shadowcolor: {
                get: function () {
                    return this._shadowColor;
                },
                set: function (value) {
                    if (!Bridge.referenceEquals(this._shadowColor, value)) {
                        this._shadowColor = value;
                        this.BufferNeedsRedraw = true;
                    }
                }
            },
            HueColor: {
                get: function () {
                    return this._hueColor;
                },
                set: function (value) {
                    if (!Bridge.referenceEquals(this._hueColor, value)) {
                        this.BufferNeedsRedraw = true;
                    }
                    this._hueColor = value;

                }
            },
            HueRecolorStrength: {
                get: function () {
                    return this._hueRecolorStrength;
                },
                set: function (value) {
                    if (this._hueRecolorStrength !== value) {
                        this.BufferNeedsRedraw = true;
                    }
                    this._hueRecolorStrength = value;
                }
            }
        },
        ctors: {
            init: function () {
                this.StretchWidth = 0;
                this.StretchHeight = 0;
                this.Rotation = 0;
                this.Alpha = 1;
                this.Looping = true;
                this.Looped = false;
                this.FrameChanged = false;
                this.Flipped = false;
                this._transformed = false;
                this.BufferNeedsRedraw = true;
            },
            ctor: function (data) {
                this.$initialize();
                this.Images = data;
                if (this.Images == null) {
                    this.Images = new (System.Collections.Generic.List$1(HTMLImageElement)).ctor();
                }
                this.ImageSpeed = 1.0;
                this.Position = new CirnoGame.Vector2();
                this.AnimationTimeElapsed = 0;
                this.Shadow = 0;
                this.Shadowcolor = "#FFFFFF";
                this.HueColor = "";
                this.HueRecolorStrength = 0.6;
                this._buffer = document.createElement("canvas");
                this._bg = this._buffer.getContext("2d");
                if (this.Images.Count > 0) {
                    this.SetImage();
                }
            }
        },
        methods: {
            Update: function () {
                var LI = this.CurrentImage;
                var last = Bridge.Int.clip32(this.CurrentFrame);
                this.CurrentFrame += this.ImageSpeed;
                var current = Bridge.Int.clip32(this.CurrentFrame);
                if (current !== last) {
                    if (this.Images.Count > 0) {
                        while (current >= this.Images.Count && current > 0) {
                            if (this.Looping) {
                                current = (current - this.Images.Count) | 0;
                                this.CurrentFrame -= this.Images.Count;
                            } else {
                                this.CurrentFrame -= this.ImageSpeed;
                            }
                        }
                        while (current < 0) {
                            current = (current + this.Images.Count) | 0;
                            this.CurrentFrame += this.Images.Count;
                        }
                    }
                    this.SetImage();
                }

                this.Looped = false;
                if (!Bridge.referenceEquals(LI, this.CurrentImage)) {
                    this.FrameChanged = true;
                    if ((this.ImageSpeed > 0 && current === 0) || ((this.ImageSpeed < 0 && current === ((this.Images.Count - 1) | 0)))) {
                        this.Looped = true;
                    }
                } else {
                    this.FrameChanged = false;
                }
                this.AnimationTimeElapsed = (this.AnimationTimeElapsed + 1) | 0;
            },
            ChangeAnimation: function (ani, reset) {
                if (reset === void 0) { reset = true; }
                if (reset) {
                    this.CurrentFrame = 0;
                    this.AnimationTimeElapsed = 0;
                }
                this.Images = ani;
                //CurrentImage = Images[(int)CurrentFrame];
                this.SetImage();
            },
            SetImage: function () {
                if (this.Images.Count < 2) {
                    this.CurrentFrame = 0;
                } else {
                    var ln = this.Images.Count;
                    while (this.CurrentFrame < 0) {
                        this.CurrentFrame += ln;
                    }
                    while (this.CurrentFrame >= ln) {
                        this.CurrentFrame -= ln;
                    }
                }
                var current = Bridge.Int.clip32(this.CurrentFrame);
                if (current >= 0 && current < this.Images.Count) {
                    this.CurrentImage = this.Images.getItem(current);
                }
            },
            Draw: function (g) {
                this.Draw$1(g, this.Position);
            },
            Draw$1: function (g, position) {
                var x = position.X;
                var y = position.Y;
                if (this.CurrentImage == null) {
                    var current = Bridge.Int.clip32(this.CurrentFrame);
                    if (current >= 0 && current < this.Images.Count) {
                        this.CurrentImage = this.Images.getItem(current);
                    }
                    if (this.CurrentImage == null) {
                        return;
                    }
                }
                var X = x;
                var Y = y;
                var lastalpha = g.globalAlpha;
                var centered = false;
                var useBuffer = false;
                if (!Bridge.referenceEquals(this.HueColor, "")) {
                    if (this.BufferNeedsRedraw) {
                        var adv = true;
                        this._bg.globalCompositeOperation = "source-over";
                        this._buffer.width = this.CurrentImage.width;
                        this._buffer.height = this.CurrentImage.height;
                        this._bg.drawImage(this.CurrentImage, 0.0, 0.0);
                        this._bg.globalAlpha = this.HueRecolorStrength;
                        this._bg.globalCompositeOperation = "hue";
                        this._bg.fillStyle = this.HueColor;
                        this._bg.fillRect(0, 0, this._buffer.width, this._buffer.height);

                        if (adv) {
                            this._bg.globalAlpha = (1 + this.HueRecolorStrength) / 2.0;
                            this._bg.globalCompositeOperation = "source-over";
                            this._bg.fillRect(0, 0, this._buffer.width, this._buffer.height);
                        }

                        this._bg.globalAlpha = 1;
                        if (adv) {
                            this._bg.globalCompositeOperation = "luminosity";
                            this._bg.drawImage(this.CurrentImage, 0.0, 0.0);
                        }
                        this._bg.globalCompositeOperation = 'destination-in';
                        this._bg.drawImage(this.CurrentImage, 0.0, 0.0);
                        if (adv) {
                            this._bg.globalCompositeOperation = "hue";
                            this._bg.globalAlpha = this.HueRecolorStrength * 0.4;
                            this._bg.drawImage(this.CurrentImage, 0.0, 0.0);
                        }

                    }
                    useBuffer = true;
                }
                if (this.Alpha < 1) {
                    if (this.Alpha <= 0) {
                        return;
                    }
                    g.globalAlpha = g.globalAlpha * this.Alpha;
                }
                //if (rotation != 0)
                {
                    var x2 = this.CurrentImage.width / 2.0;
                    var y2 = this.CurrentImage.height / 2.0;

                    X = -x2;
                    Y = -y2;
                    if (!this._transformed) {
                        g.save();
                        this._transformed = true;
                    }
                    g.translate(x + x2, y + y2);
                    centered = true;
                    g.rotate(this.Rotation);
                }
                if (this.Flipped) {
                    if (!this._transformed) {
                        g.save();
                        this._transformed = true;
                    }
                    g.scale(-1, 1);
                    //don't translate if it's centered.
                    if (!centered) {
                        g.translate(this.CurrentImage.width, 0);
                    }
                }
                if (this.Shadow > 0) {
                    g.shadowBlur = this.Shadow;
                    g.shadowColor = this.Shadowcolor;
                    if (!useBuffer && this.BufferNeedsRedraw) {
                        this._bg.shadowBlur = 0;
                        this._buffer.width = this.CurrentImage.width;
                        this._buffer.height = this.CurrentImage.height;
                        this._bg.drawImage(this.CurrentImage, 0.0, 0.0);
                        useBuffer = true;
                        //BufferNeedsRedraw = true;
                    }
                    useBuffer = true;
                    //if ((useBuffer && BufferNeedsRedraw) || Rotation!=0 || true)
                    if (this.BufferNeedsRedraw) {
                        var C = CirnoGame.Helper.CloneCanvas(this._buffer);
                        var CG = CirnoGame.Helper.GetContext(C);
                        this._buffer.width = (this._buffer.width + Bridge.Int.clip32(this.Shadow * 2)) | 0;
                        this._buffer.height = (this._buffer.height + Bridge.Int.clip32(this.Shadow * 2)) | 0;
                        this._bg.shadowBlur = this.Shadow;
                        this._bg.shadowColor = this.Shadowcolor;
                        this.drawWithShadows(this._bg, C, this.Shadow, this.Shadow, 0, 0, this.Shadow / 3.0);
                        useBuffer = true;
                    }
                    X -= this.Shadow;
                    Y -= this.Shadow;
                    g.shadowBlur = 0;
                }

                if (this.StretchWidth === 0 && this.StretchHeight === 0) {
                    if (this.Shadow > 0 && false) {
                        var I = this.CurrentImage;
                        if (useBuffer) {
                            I = this._buffer;
                        }
                        this.drawWithShadows(g, I, X, Y, 0, 0, this.Shadow / 3);
                    } else {
                        if (!useBuffer) {
                            g.drawImage(this.CurrentImage, X, Y);
                        } else {
                            g.drawImage(this._buffer, X, Y);
                        }
                    }
                } else {
                    if (this.Shadow > 0 && false) {
                        var I1 = this.CurrentImage;
                        if (useBuffer) {
                            I1 = this._buffer;
                        }
                        this.drawWithShadows(g, I1, X, Y, this.StretchWidth, this.StretchHeight, this.Shadow / 3);
                    } else {
                        if (!useBuffer) {
                            g.drawImage(this.CurrentImage, X, Y, this.StretchWidth, this.StretchHeight);
                        } else {
                            g.drawImage(this._buffer, X, Y, this.StretchWidth, this.StretchHeight);
                        }
                    }
                }
                if (this._transformed) {
                    g.restore();
                    this._transformed = false;
                }
                if (this.Shadow > 0) {
                    g.shadowBlur = 0;
                }
                if (this.Alpha < 1) {
                    g.globalAlpha = lastalpha;
                }
                this.BufferNeedsRedraw = false;
            },
            drawWithShadows: function (g, I, X, Y, W, H, size) {
                if (W === 0) {
                    W = I.width;
                    H = I.height;
                }
                g.shadowOffsetX = -size;
                g.drawImage(I, X, Y, W, H);
                g.shadowOffsetX = size;
                g.drawImage(I, X, Y, W, H);
                g.shadowOffsetX = 0;
                g.shadowOffsetY = -size;
                g.drawImage(I, X, Y, W, H);
                g.shadowOffsetY = size;
                g.drawImage(I, X, Y, W, H);

                g.shadowOffsetY = 0;
            }
        }
    });

    Bridge.define("CirnoGame.AnimationLoader", {
        statics: {
            fields: {
                __this: null
            },
            props: {
                _this: {
                    get: function () {
                        if (CirnoGame.AnimationLoader.__this == null) {
                            CirnoGame.AnimationLoader.__this = new CirnoGame.AnimationLoader();
                            throw new System.Exception("Animation loader not initiated.");
                        }
                        return CirnoGame.AnimationLoader.__this;
                    }
                }
            },
            methods: {
                Init: function (Archive) {
                    CirnoGame.AnimationLoader.__this = new CirnoGame.AnimationLoader();
                    CirnoGame.AnimationLoader.__this.Archive = Archive;
                },
                Get: function (ani) {
                    return CirnoGame.AnimationLoader._this.GetAnimation(ani);
                }
            }
        },
        fields: {
            _data: null,
            Archive: null
        },
        ctors: {
            ctor: function () {
                this.$initialize();
                this._data = new (System.Collections.Generic.Dictionary$2(System.String,System.Collections.Generic.List$1(HTMLImageElement)))();
            }
        },
        methods: {
            GetAnimation: function (ani) {
                if (this._data.containsKey(ani)) {
                    return this._data.get(ani);
                }
                var A = new (System.Collections.Generic.List$1(HTMLImageElement)).ctor();
                var I = this.Archive.GetImage(System.String.concat(ani, ".png"));
                if (I != null) {
                    A.add(I);
                } else {
                    var j = 0;
                    var Sani = System.String.concat(ani, "_");
                    while (true) {
                        I = this.Archive.GetImage(System.String.concat(Sani, (Bridge.identity(j, (j = (j + 1) | 0))), ".png"));
                        if (I == null) {
                            break;
                        } else {
                            A.add(I);
                        }
                    }
                    /* do
                    {
                       I = Archive.GetImage(ani + "_" + j + ".png");
                       if (I != null)
                       {
                           A.Add(I);
                       }
                    } while (I != null);*/
                }
                this._data.set(ani, A);
                return A;
            }
        }
    });

    Bridge.define("CirnoGame.App", {
        main: function Main () {
            //USE THE JSON ZIP ARCHIVE FEATURE FROM BNTEST FOR LOADING IMAGES AND FILES.

            document.body.style.cssText = "overflow: hidden;margin: 0;padding: 0;";
            CirnoGame.GamePadManager._this = new CirnoGame.GamePadManager();
            CirnoGame.GamePadManager._this.Update();
            Bridge.global.setTimeout(function () {
                CirnoGame.GamePadManager._this.Update();

                CirnoGame.App.IC = CirnoGame.InputControllerManager._this.Controllers.getItem(0);
                var IM = CirnoGame.InputControllerManager._this.Controllers.getItem(0).InputMapping.getItem(2);

            }, 5);

            var ok = false;
            var uptest = true;
            CirnoGame.JSONArchive.Open("Assets/Images.JSON", function (json) {
                CirnoGame.App.JSON = json;

                CirnoGame.App.JSON.PreloadImages(function () {
                    ok = true;
                    CirnoGame.App.Finish();
                });
            });

            // After building (Ctrl + Shift + B) this project, 
            // browse to the /bin/Debug or /bin/Release folder.

            // A new bridge/ folder is created and contains
            // your projects JavaScript files. 

            // Open the bridge/index.html file in a brower by
            // Right-Click > Open With..., then choose a
            // web browser from the list

            // This application will then run in a browser.


        },
        statics: {
            fields: {
                Frame: 0,
                Div: null,
                Canvas: null,
                ScreenBounds: null,
                JSON: null,
                G: null,
                TargetAspect: 0,
                _lSize: 0,
                _missingTime: 0,
                _lTime: 0,
                totalTime: 0,
                _frameRendered: false,
                _gameRendered: false,
                IC: null,
                CurrentView: null,
                GameName: null,
                GameVersion: null,
                DEBUG: false
            },
            ctors: {
                init: function () {
                    this.Frame = 0;
                    this._lSize = -1;
                    this._missingTime = 0;
                    this._lTime = -1;
                    this._frameRendered = false;
                    this._gameRendered = false;
                    this.GameName = "Cirno's Mysterious Tower";
                    this.GameVersion = "0.3";
                    this.DEBUG = false;
                }
            },
            methods: {
                Finish: function () {
                    CirnoGame.AnimationLoader.Init(CirnoGame.App.JSON);
                    var LT = document.getElementById("loadtext");
                    LT.textContent = "";
                    document.body.style.cursor = "auto";
                    document.title = System.String.concat(CirnoGame.App.GameName, " ", CirnoGame.App.GameVersion, " by:RSGmaker");
                    //var R = new Renderer();
                    //Document.Body.AppendChild(R.view);

                    CirnoGame.App.Div = document.createElement("div");
                    var Canv = document.createElement("canvas");
                    CirnoGame.App.Canvas = Canv;
                    CirnoGame.App.TargetAspect = 0.75;
                    Canv.width = 1024;
                    Canv.height = Bridge.Int.clip32(Canv.width * CirnoGame.App.TargetAspect);
                    CirnoGame.App.ScreenBounds = new CirnoGame.Rectangle(0, 0, Canv.width, Canv.height);

                    CirnoGame.App.Div.appendChild(Canv);
                    document.body.appendChild(CirnoGame.App.Div);
                    //Document.Body.AppendChild(Canv);
                    CirnoGame.App.G = CirnoGame.App.Canvas.getContext("2d");

                    CirnoGame.App.G.imageSmoothingEnabled = false;
                    CirnoGame.App.Canvas.style.imageRendering = "pixelated";
                    var gg = CirnoGame.App.G;
                    gg.webkitImageSmoothingEnabled = false;
                    gg.mozImageSmoothingEnabled = false;


                    CirnoGame.KeyboardManager.Init();

                    CirnoGame.App.CurrentView = new CirnoGame.Game();

                    var OnF = CirnoGame.App.RAF;
                    requestAnimationFrame(OnF);
                },
                updateWindow: function () {
                    var size = Math.ceil(window.innerHeight * (1 / CirnoGame.App.TargetAspect));
                    if (size !== CirnoGame.App._lSize) {
                        CirnoGame.App.Canvas.style.width = "100%";
                        CirnoGame.App.Div.style.width = System.Double.format(size) + "px";

                        CirnoGame.App.Div.style.position = "relative";
                        CirnoGame.App.Div.style.left = System.Double.format(((((Bridge.Int.div(window.innerWidth, 2)) | 0)) - (size / 2))) + "px";
                        size = CirnoGame.App._lSize;
                    }
                },
                UpdateInputs: function () {
                    if (CirnoGame.App.IC != null) {
                        var L = CirnoGame.InputControllerManager._this.Controllers;
                        if (L.Count > 1) {
                            /* List<int> keys = KeyboardManager._this.TappedButtons;
                            if (keys.Contains(107))
                            {
                               int index = L.IndexOf(IC);
                               index++;
                               if (index >= L.Count)
                               {
                                   index -= L.Count;
                               }
                               IC = L[index];
                            }
                            if (keys.Contains(109))
                            {
                               int index = L.IndexOf(IC);
                               index--;
                               if (index < 0)
                               {
                                   index += L.Count;
                               }
                               IC = L[index];
                            }*/
                        }
                    }
                    CirnoGame.KeyboardManager.Update();
                },
                Update: function (time) {
                    var delta = 0;
                    CirnoGame.App.totalTime = time;
                    if (time >= 0) {
                        if (CirnoGame.App._lTime < 0) {
                            CirnoGame.App._lTime = time;
                        } else {
                            //missingTime -= 16.666666666666666666666666666667;
                        }
                        delta = (time - CirnoGame.App._lTime);
                        CirnoGame.App._missingTime += (delta);
                        if (Bridge.is(CirnoGame.App.CurrentView, CirnoGame.Game)) {
                            var G = Bridge.cast(CirnoGame.App.CurrentView, CirnoGame.Game);
                            if (G.running) {
                                G.totalTime += delta;
                                if (G.timeRemaining > 0) {
                                    G.timeRemaining -= delta;
                                }
                                if (G.timeRemaining <= 0) {
                                    G.timeRemaining = 0;
                                }
                            }
                        }
                    }
                    CirnoGame.App.updateWindow();
                    /* if (delta > 22)
                    {
                       Lagging = true;
                    }*/

                    if (CirnoGame.App._missingTime > 12) {
                        if (CirnoGame.App.CurrentView != null) {
                            CirnoGame.App.CurrentView.Update();
                        }

                        CirnoGame.App._missingTime -= 16.666666666666668;
                        CirnoGame.App._frameRendered = false;
                        CirnoGame.App._gameRendered = false;

                    } else {
                        CirnoGame.App._lTime = time;
                        return;
                    }
                    if (time >= 0) {
                        if (CirnoGame.App._missingTime >= 3000) {
                            CirnoGame.App._missingTime = 0;
                        }
                        if (CirnoGame.App._missingTime >= 10000) {
                            //Game is lagging too much to properly play multiplayer.
                        }
                        var T = 16.666666666666668;
                        if (true) {
                            T += 8;
                        }
                        while (CirnoGame.App._missingTime >= T) {
                            if (CirnoGame.App.CurrentView != null) {
                                CirnoGame.App.CurrentView.Update();
                            }
                            CirnoGame.App._missingTime -= 16.666666666666668;
                        }
                    }
                    //game.Draw(g);
                    CirnoGame.App._lTime = time;
                    CirnoGame.App.Frame = (CirnoGame.App.Frame + 1) | 0;
                    CirnoGame.HelperExtensions.Clear(CirnoGame.App.G);
                    CirnoGame.GamePadManager._this.Update();
                    if (CirnoGame.App.CurrentView != null) {

                        CirnoGame.App.CurrentView.Update();
                        CirnoGame.App.CurrentView.Render();
                        CirnoGame.App.G.drawImage(CirnoGame.App.CurrentView.spriteBuffer, 0.0, 0.0, CirnoGame.App.Canvas.width, CirnoGame.App.Canvas.height);
                    }
                    //G.FillStyle = ""+Convert. Frame;
                    //G.FillStyle = "#" + Frame.ToString("X6");
                    /* G.FillStyle = "#" + ColorFromAhsb(1,(Frame/2) % 360,0.8f,0.7f).ToString("X6");
                    G.FillRect(0, 0, G.Canvas.Width, G.Canvas.Height);

                    G.FillStyle = "red";
                    var x = ((0 + Frame * 3) % (G.Canvas.Width + 100)) - 100;
                    var y = ((0 + Frame) % (G.Canvas.Height + 100)) - 100;
                    //G.FillRect(x, y, 100, 100);

                    var V = JSON.Images.Values.ToArray();

                    var img = V[(Frame/10) % V.Length];
                    G.DrawImage(img, x, y,img.Width*4,img.Height * 4);*/
                    CirnoGame.App.UpdateInputs();
                },
                RAF: function () {

                    var OnF = CirnoGame.App.RAF;
                    requestAnimationFrame(OnF);
                    var time = Bridge.global.performance.now();
                    CirnoGame.App.Update(time);
                },
                ColorFromAhsb: function (a, h, s, b) {

                    /* if (0 > a || 255 < a)
                    {
                       throw new ArgumentOutOfRangeException("a", a,
                         Properties.Resources.InvalidAlpha);
                    }
                    if (0f > h || 360f < h)
                    {
                       throw new ArgumentOutOfRangeException("h", h,
                         Properties.Resources.InvalidHue);
                    }
                    if (0f > s || 1f < s)
                    {
                       throw new ArgumentOutOfRangeException("s", s,
                         Properties.Resources.InvalidSaturation);
                    }
                    if (0f > b || 1f < b)
                    {
                       throw new ArgumentOutOfRangeException("b", b,
                         Properties.Resources.InvalidBrightness);
                    }*/

                    if (0 === s) {
                        //return CreateShade(b / 255.0);
                        //return 0x808080;
                        var shade = Bridge.Int.clip32(b / 255.0);
                        return CirnoGame.App.RGBToInt(shade, shade, shade);
                    }

                    var fMax, fMid, fMin;
                    var iSextant, iMax, iMid, iMin;

                    if (0.5 < b) {
                        fMax = b - (b * s) + s;
                        fMin = b + (b * s) - s;
                    } else {
                        fMax = b + (b * s);
                        fMin = b - (b * s);
                    }

                    iSextant = Bridge.Int.clip32(Math.floor(h / 60.0));
                    if (300.0 <= h) {
                        h -= 360.0;
                    }
                    h /= 60.0;
                    h -= 2.0 * Math.floor(((iSextant + 1.0) % 6.0) / 2.0);
                    if (0 === iSextant % 2) {
                        fMid = h * (fMax - fMin) + fMin;
                    } else {
                        fMid = fMin - h * (fMax - fMin);
                    }

                    iMax = System.Convert.toInt32(Bridge.box(fMax * 255, System.Single, System.Single.format, System.Single.getHashCode));
                    iMid = System.Convert.toInt32(Bridge.box(fMid * 255, System.Single, System.Single.format, System.Single.getHashCode));
                    iMin = System.Convert.toInt32(Bridge.box(fMin * 255, System.Single, System.Single.format, System.Single.getHashCode));

                    switch (iSextant) {
                        case 1: 
                            return CirnoGame.App.RGBToInt(iMid, iMax, iMin);
                        case 2: 
                            return CirnoGame.App.RGBToInt(iMin, iMax, iMid);
                        case 3: 
                            return CirnoGame.App.RGBToInt(iMin, iMid, iMax);
                        case 4: 
                            return CirnoGame.App.RGBToInt(iMid, iMin, iMax);
                        case 5: 
                            return CirnoGame.App.RGBToInt(iMax, iMin, iMid);
                        default: 
                            return CirnoGame.App.RGBToInt(iMax, iMid, iMin);
                    }
                },
                RGBToInt: function (R, G, B) {
                    return ((((R + (G << 8)) | 0) + (B << 16)) | 0);
                }
            }
        }
    });

    Bridge.define("CirnoGame.Audio", {
        fields: {
            _AM: null,
            _audio: null,
            _hasPlayed: false,
            _blast: null,
            lastplayed: 0,
            _loop: false,
            OnPlay: null,
            OnStop: null,
            lasttime: 0
        },
        props: {
            ID: null,
            IsPlaying: {
                get: function () {
                    return !(!this._hasPlayed || this._audio.paused || this._audio.currentTime === 0.0);
                },
                set: function (value) {
                    if (value) {
                        this.Play();
                    } else {
                        this.Pause();
                    }
                }
            },
            Loop: {
                get: function () {
                    //return _audio.Loop;
                    return this._loop;
                },
                set: function (value) {
                    //_audio.Loop = value;
                    this._loop = value;
                    //_audio.Loop = value;
                }
            },
            CurrentTime: {
                get: function () {
                    return this._audio.currentTime;
                },
                set: function (value) {
                    this._audio.currentTime = value;
                }
            },
            Volume: {
                get: function () {
                    return this._audio.volume;
                },
                set: function (value) {
                    this._audio.volume = value;
                }
            }
        },
        ctors: {
            init: function () {
                this.lastplayed = Number.NEGATIVE_INFINITY;
                this.lasttime = 0;
            },
            ctor: function (audio, ID, AudioManager) {
                this.$initialize();
                this._audio = audio;
                this.ID = ID;
                var self = this;
                this._AM = AudioManager;
                //object A = (() => self._OnPlay);
                //Action A = new Action(() => self._OnPlay());

                this._audio.onplay = function () {
                    self._OnPlay();
                };
                this._audio.onpause = function () {
                    self._OnStop();
                };
                //_audio.OnEnded = new Action(() => self._OnStop()).ToDynamic();
                this._audio.onended = function () {
                    self._OnEnd();
                };
                this._audio.ontimeupdate = function () {
                    self._OnUpdate();
                };

                this._blast = new (System.Collections.Generic.List$1(HTMLAudioElement)).ctor();
                var maxvoices = 6;
                var voices = 1;
                while (voices < maxvoices) {
                    this._blast.add(Bridge.cast(this._audio.cloneNode(), HTMLAudioElement));
                    voices = (voices + 1) | 0;
                }
                /* _blast.Add((AudioElement)_audio.CloneNode());
                _blast.Add((AudioElement)_audio.CloneNode());
                _blast.Add((AudioElement)_audio.CloneNode());
                _blast.Add((AudioElement)_audio.CloneNode());*/
                /* _audio.OnPlay = "self._OnPlay()".ToDynamic();
                _audio.OnPause = "self._OnStop()".ToDynamic();
                _audio.OnEnded = "self._OnStop()".ToDynamic();*/
            }
        },
        methods: {
            Play: function () {
                if (!this.IsPlaying) {
                    this.lasttime = this.CurrentTime;
                    this._audio.play();
                    this._hasPlayed = true;
                    return true;
                }
                return false;
            },
            Pause: function () {
                if (this.IsPlaying) {
                    this._audio.pause();
                    return true;
                }
                return false;
            },
            Stop: function () {
                if (this.IsPlaying) {
                    this._audio.pause();
                    this._audio.currentTime = 0;
                    return true;
                }
                return false;
            },
            Blast: function (volume) {
                if (volume === void 0) { volume = 1.0; }
                var T = CirnoGame.App.totalTime;
                if (T - this.lasttime < 150) {
                    return; //prevent audio spam.
                }
                if (!this.IsPlaying) {
                    this.Volume = volume;
                    this.Play();
                    this.lasttime = T;
                } else {
                    //((AudioElement)_audio.CloneNode()).Play();
                    var i = 0;
                    while (i < this._blast.Count) {
                        var A = this._blast.getItem(i);
                        //if (A.Paused || A.CurrentTime<0.15f || A.Played.Length==0)
                        if (A.paused || A.currentTime < 0.1 || A.played.length === 0) {
                            if (A.paused || A.currentTime === 0.0 || A.played.length === 0) {
                                A.volume = volume;
                                A.play();
                                i = this._blast.Count;
                                this.lasttime = T;
                            }
                        }
                        i = (i + 1) | 0;
                    }
                }
            },
            _OnPlay: function () {
                this._AM.OnPlay(this);
                if (this.OnPlay) {
                    this.OnPlay(this);
                }
            },
            _OnStop: function () {
                this._AM.OnStop(this);
                if (this.OnStop) {
                    this.OnStop(this);
                }
            },
            _OnEnd: function () {
                /* if (_loop)
                {
                   CurrentTime = 0;
                   Play();
                }
                else*/
                {
                    this._OnStop();
                }
            },
            _OnUpdate: function () {
                if (this._loop) {
                    //if ((CurrentTime+0.35) >= _audio.Duration)
                    if ((this.CurrentTime + ((this.CurrentTime - this.lasttime) * 0.8)) >= this._audio.duration) {
                        this.CurrentTime = 0;
                        this.Play();
                    }
                    this.lasttime = this.CurrentTime;
                }
            }
        }
    });

    Bridge.define("CirnoGame.AudioManager", {
        statics: {
            fields: {
                Directory: null,
                __this: null
            },
            props: {
                _this: {
                    get: function () {
                        if (CirnoGame.AudioManager.__this == null) {
                            CirnoGame.AudioManager.__this = new CirnoGame.AudioManager();
                        }
                        return CirnoGame.AudioManager.__this;
                    }
                }
            },
            ctors: {
                init: function () {
                    this.Directory = "";
                }
            },
            methods: {
                Init: function () {
                    if (CirnoGame.AudioManager.__this == null) {
                        CirnoGame.AudioManager.__this = new CirnoGame.AudioManager();
                    }
                }
            }
        },
        fields: {
            data: null,
            playing: null
        },
        ctors: {
            ctor: function () {
                this.$initialize();
                this.data = new (System.Collections.Generic.Dictionary$2(System.String,CirnoGame.Audio))();
                this.playing = new (System.Collections.Generic.List$1(CirnoGame.Audio)).ctor();
            }
        },
        methods: {
            Get: function (path) {
                path = System.String.concat(CirnoGame.AudioManager.Directory, path);
                if (this.data.containsKey(path)) {
                    return this.data.get(path);
                } else {
                    var AE = new Audio(path);
                    var A = new CirnoGame.Audio(AE, path, this);
                    this.data.add(path, A);
                    return A;
                }
            },
            Play: function (path, loop) {
                if (loop === void 0) { loop = false; }
                var A = this.Get(path);
                A.Loop = loop;
                A.Play();
                return A;
            },
            Blast: function (path, volume) {
                if (volume === void 0) { volume = 1.0; }
                var A = this.Get(path);
                A.Blast(volume);
            },
            Stop: function (path) {
                var A = this.Get(path);
                A.Stop();
            },
            Pause: function (path) {
                var A = this.Get(path);
                A.Pause();
            },
            OnPlay: function (audio) {
                if (!this.playing.contains(audio)) {
                    this.playing.add(audio);
                }
            },
            OnStop: function (audio) {
                if (this.playing.contains(audio)) {
                    this.playing.remove(audio);
                }
            },
            StopAllFromDirectory: function (directory) {
                directory = System.String.concat(CirnoGame.AudioManager.Directory, directory);
                CirnoGame.HelperExtensions.ForEach(Bridge.global.CirnoGame.Audio, this.data.getValues(), function (A) {
                    if (System.String.startsWith(A.ID, directory)) {
                        A.Stop();
                    }
                });
            },
            StopAll: function () {
                CirnoGame.HelperExtensions.ForEach(Bridge.global.CirnoGame.Audio, this.data.getValues(), function (A) {
                    A.Stop();
                });
            }
        }
    });

    Bridge.define("CirnoGame.ButtonMenu", {
        fields: {
            rows: null,
            MenuWidth: 0,
            MenuHeight: 0,
            FontSize: 0,
            SelectionMenu: false,
            Selected: null,
            Self: null,
            OnChoose: null,
            Position: null
        },
        props: {
            SelectedData: {
                get: function () {
                    if (this.Self.Selected != null) {
                        return this.Self.Selected.Data;
                    }
                    return null;
                }
            },
            SelectedText: {
                get: function () {
                    if (this.Self.Selected != null) {
                        if (Bridge.is(this.Self.Selected.Contents, CirnoGame.TextSprite)) {
                            return Bridge.cast(this.Self.Selected.Contents, CirnoGame.TextSprite).Text;
                        }
                    }
                    return null;
                }
            }
        },
        ctors: {
            init: function () {
                this.Position = new CirnoGame.Vector2();
            },
            ctor: function (menuWidth, menuHeight, FontSize, selectionMenu) {
                if (selectionMenu === void 0) { selectionMenu = false; }

                this.$initialize();
                this.rows = new (System.Collections.Generic.List$1(System.Collections.Generic.List$1(CirnoGame.ButtonSprite))).ctor();
                this.MenuWidth = menuWidth;
                this.MenuHeight = menuHeight;
                this.FontSize = FontSize;
                this.SelectionMenu = selectionMenu;
                this.Self = this;
            }
        },
        methods: {
            GetAllButtons: function () {
                var all = new (System.Collections.Generic.List$1(CirnoGame.ButtonSprite)).ctor();
                this.rows.forEach(function (R) {
                    all.addRange(R);
                });
                return all;
            },
            GetSpriteByData: function (data) {
                var all = new (System.Collections.Generic.List$1(CirnoGame.ButtonSprite)).$ctor1(System.Linq.Enumerable.from(this.GetAllButtons()).where(function (B) {
                        return Bridge.referenceEquals(B.Data, data);
                    }));
                if (all.Count > 0) {
                    return all.getItem(0);
                }
                return null;
            },
            AddButtons: function (buttonText) {
                CirnoGame.HelperExtensions.ForEach(System.String, buttonText, Bridge.fn.bind(this, function (T) {
                    this.AddButton(T);
                }));
            },
            AddButton: function (buttonText, row, data) {
                if (row === void 0) { row = -1; }
                if (data === void 0) { data = null; }
                var T = new CirnoGame.TextSprite();
                T.Text = buttonText;
                T.FontSize = this.FontSize;
                //ButtonSprite B = new ButtonSprite(T, (int)(FontSize * 0.05));
                var B = new CirnoGame.ButtonSprite(T, Bridge.Int.clip32(this.FontSize * 0.1));
                if (data != null) {
                    B.Data = data;
                }
                this.AddButton$1(B, row);
                return B;
            },
            AddButton$1: function (button, row) {
                if (row === void 0) { row = -1; }
                if (this.rows.Count === 0) {
                    this.rows.add(new (System.Collections.Generic.List$1(CirnoGame.ButtonSprite)).ctor());
                }
                if (row === -1) {
                    row = (this.rows.Count - 1) | 0;
                }
                if (button != null) {
                    button.OnClick = Bridge.fn.bind(this, function () {
                        this.Self.Select(button);
                    });
                }
                this.rows.getItem(row).add(button);
            },
            Select: function (button) {
                if (!Bridge.referenceEquals(this.Selected, button) || !this.SelectionMenu) {
                    if (this.Selected != null && this.SelectionMenu) {
                        //Selected.BorderColor = "#00AA33";
                        //Selected.ButtonColor = "#11CC55";
                        this.Selected.SetColorScheme$1(0);
                    }
                    this.Selected = button;
                    var OSC = this.OnChoose;
                    var self = this;
                    if (this.SelectionMenu && this.Selected != null) {
                        //Selected.BorderColor = "#FFFFFF";
                        //Selected.ButtonColor = "#FF0000";
                        this.Selected.SetColorScheme$1(1);
                    }
                    if (this.Selected != null && OSC) {
                        self.OnChoose();
                    }
                }
            },
            CombineRows: function () {
                var all = new (System.Collections.Generic.List$1(CirnoGame.ButtonSprite)).ctor();
                this.rows.forEach(function (R) {
                    all.addRange(R);
                });

                this.rows = new (System.Collections.Generic.List$1(System.Collections.Generic.List$1(CirnoGame.ButtonSprite))).ctor();
                this.rows.add(all);
            },
            addRow: function () {
                var ret = new (System.Collections.Generic.List$1(CirnoGame.ButtonSprite)).ctor();
                this.rows.add(ret);
                return ret;
            },
            BreakUp: function (totalRows) {
                this.CombineRows();
                var all = this.rows.getItem(0);
                this.rows = new (System.Collections.Generic.List$1(System.Collections.Generic.List$1(CirnoGame.ButtonSprite))).ctor();
                var C = Math.ceil(all.Count / totalRows);
                var row = this.addRow();
                var i = 0;
                while (i < all.Count) {
                    if (row.Count >= C) {
                        row = this.addRow();
                    }
                    this.AddButton$1(all.getItem(i));
                    i = (i + 1) | 0;
                }
            },
            CenterOn: function (sprite, Center) {
                sprite.Draw(null);
                var S = sprite.Size;
                var S2 = CirnoGame.Vector2.op_Division(S, 2.0);
                sprite.Position = CirnoGame.Vector2.op_Subtraction(Center, S2);
            },
            UpdateRow: function (index, y) {
                var row = this.rows.getItem(index);
                var X = (this.MenuWidth / (row.Count + 1.0));
                var i = 0;
                var CX = X;

                CX += this.Position.X;
                while (i < row.Count) {
                    var B = row.getItem(i);
                    if (B != null) {
                        this.CenterOn(B, new CirnoGame.Vector2(CX, y));
                    }
                    CX += X;
                    i = (i + 1) | 0;
                }
            },
            Finish: function (totalRows) {
                if (totalRows === void 0) { totalRows = -1; }
                if (totalRows > 0) {
                    this.BreakUp(totalRows);
                }
                var y = 0;
                var CY = 0;
                if (totalRows > 0 && this.rows.Count < totalRows) {
                    y = (this.MenuHeight / (((this.rows.Count + 1) | 0)));
                    CY = y;
                } else {
                    y = (this.MenuHeight / (this.rows.Count));
                    CY = 0;
                }

                CY += this.Position.Y;
                var i = 0;
                while (i < this.rows.Count) {
                    this.UpdateRow(i, CY);
                    CY += y;
                    i = (i + 1) | 0;
                }
            },
            Update: function (mousePosition, clicked) {
                if (mousePosition === void 0) { mousePosition = null; }
                if (clicked === void 0) { clicked = true; }
                if (CirnoGame.Vector2.op_Equality(mousePosition, null)) {
                    mousePosition = CirnoGame.KeyboardManager._this.CMouse;
                    clicked = CirnoGame.KeyboardManager._this.TappedMouseButtons.contains(0);
                }
                if (clicked) {
                    this.rows.forEach(function (R) {
                        R.forEach(function (B) {
                            if (B != null) {
                                B.CheckClick(mousePosition);
                            }
                        });
                    });
                }
            },
            Draw: function (g) {
                this.rows.forEach(function (R) {
                    R.forEach(function (B) {
                        if (B != null) {
                            B.Draw(g);
                        }
                    });
                });
            }
        }
    });

    Bridge.define("CirnoGame.Sprite", {
        fields: {
            Position: null,
            spriteBuffer: null,
            Visible: false,
            spriteGraphics: null
        },
        props: {
            Size: {
                get: function () {
                    return new CirnoGame.Vector2(this.spriteBuffer.width, this.spriteBuffer.height);
                },
                set: function (value) {
                    if (CirnoGame.Vector2.op_Equality(value, null)) {
                        value = new CirnoGame.Vector2();
                    }
                    this.spriteBuffer.width = Bridge.Int.clip32(value.X);
                    this.spriteBuffer.height = Bridge.Int.clip32(value.Y);
                }
            }
        },
        ctors: {
            init: function () {
                this.Visible = true;
            },
            ctor: function () {
                this.$initialize();
                this.spriteBuffer = document.createElement("canvas");
                this.spriteGraphics = this.spriteBuffer.getContext("2d");
                this.spriteGraphics.imageSmoothingEnabled = false;
                this.Position = new CirnoGame.Vector2();
            }
        },
        methods: {
            GetGraphics: function () {
                return this.spriteGraphics;
            },
            OnFrame: function () {

            },
            Draw: function (g) {
                if (!this.Visible) {
                    return;
                }
                g.drawImage(this.spriteBuffer, this.Position.X, this.Position.Y);
            },
            GetBounds: function () {
                return new CirnoGame.Rectangle(this.Position.X, this.Position.Y, this.spriteBuffer.width, this.spriteBuffer.height);
            }
        }
    });

    Bridge.define("CirnoGame.ButtonSprite.ColorScheme", {
        fields: {
            BorderColor: null,
            ButtonColor: null
        },
        ctors: {
            ctor: function (borderColor, buttonColor) {
                if (borderColor === void 0) { borderColor = "#00AA33"; }
                if (buttonColor === void 0) { buttonColor = "#11CC55"; }

                this.$initialize();
                this.BorderColor = borderColor;
                this.ButtonColor = buttonColor;
            }
        }
    });

    Bridge.define("CirnoGame.Camera", {
        fields: {
            instawarp: false,
            Position: null,
            TargetPosition: null,
            /**
             * @instance
             * @public
             * @memberof CirnoGame.Camera
             * @default 0.8
             * @type number
             */
            LinearPanSpeed: 0,
            /**
             * @instance
             * @public
             * @memberof CirnoGame.Camera
             * @default 0.07
             * @type number
             */
            LerpPanSpeed: 0,
            _scale: 0,
            speedmod: 0,
            _invscale: 0,
            _center: null,
            viewport_width: 0,
            viewport_height: 0,
            CameraBounds: null,
            StageBounds: null,
            tmp: null
        },
        props: {
            CenteredTargetPosition: {
                set: function (value) {
                    this.TargetPosition = new CirnoGame.Vector2(value.X - (this.CameraBounds.width / 2), value.Y - (this.CameraBounds.height / 2));
                }
            },
            Scale: {
                get: function () {
                    return this._scale;
                },
                set: function (value) {
                    this._scale = value;
                    this._invscale = 1 / this._scale;
                    this.UpdateCameraBounds();
                }
            },
            InvScale: {
                get: function () {
                    return this._invscale;
                },
                set: function (value) {
                    this._invscale = value;
                    this._scale = 1 / this._invscale;
                    this.UpdateCameraBounds();
                }
            },
            Center: {
                get: function () {
                    var R = this.CameraBounds;
                    //return R.Center;
                    R.GetCenter(this._center);
                    return this._center;
                },
                set: function (value) {
                    this.Position.X = value.X - (this.CameraBounds.width / 2);
                    this.Position.Y = value.Y - (this.CameraBounds.height / 2);
                }
            }
        },
        ctors: {
            init: function () {
                this.instawarp = false;
                this.LinearPanSpeed = 0.8;
                this.LerpPanSpeed = 0.07;
                this._scale = 1.0;
                this.speedmod = 1;
                this._invscale = 1.0;
                this._center = new CirnoGame.Vector2();
                this.viewport_width = 1;
                this.viewport_height = 1;
                this.tmp = new CirnoGame.Vector2();
            },
            ctor: function (viewport_width, viewport_height) {
                if (viewport_width === void 0) { viewport_width = -1.0; }
                if (viewport_height === void 0) { viewport_height = -1.0; }

                this.$initialize();
                this.Position = new CirnoGame.Vector2();
                this.TargetPosition = new CirnoGame.Vector2();
                this.viewport_width = viewport_width;
                this.viewport_height = viewport_height;
                this.CameraBounds = new CirnoGame.Rectangle(0, 0, viewport_width, viewport_height);
                this._invscale = 1.0 / this._scale;
                this.UpdateCameraBounds();
            }
        },
        methods: {
            ScaleToSize: function (sizeInPixels) {
                this.Scale = sizeInPixels / CirnoGame.App.Canvas.width;
            },
            UpdateCameraBounds: function () {
                //CameraBounds.width = App.Canvas.Width * _invscale;
                //CameraBounds.height = App.Canvas.Height * _invscale;
                this.CameraBounds.width = this.viewport_width * this._invscale;
                this.CameraBounds.height = this.viewport_height * this._invscale;
            },
            Update: function () {
                if (this.Position.X !== this.TargetPosition.X || this.Position.Y !== this.TargetPosition.Y) {
                    //float dist = (Position - TargetPosition).Length;
                    var dist = this.Position.Distance(this.TargetPosition);
                    var spd = this.LinearPanSpeed + (dist * this.LerpPanSpeed);
                    spd *= this.speedmod;

                    if (dist <= spd || this.instawarp) {
                        this.Position.X = this.TargetPosition.X;
                        this.Position.Y = this.TargetPosition.Y;
                        this.instawarp = false;
                        return;
                    } else {
                        this.tmp.CopyFrom(this.Position);
                        this.tmp.Subtract(this.TargetPosition);
                        this.tmp.SetAsNormalize(spd);
                        //Vector2 V = (Position - TargetPosition).Normalize(spd);
                        this.Position.Subtract(this.tmp);
                    }
                    if (this.StageBounds != null) {
                        this.Position.X = CirnoGame.MathHelper.Clamp$1(this.Position.X, this.StageBounds.left, this.StageBounds.right - this.CameraBounds.width);
                        this.Position.Y = CirnoGame.MathHelper.Clamp$1(this.Position.Y, this.StageBounds.top, this.StageBounds.bottom - this.CameraBounds.height);

                        this.TargetPosition.X = CirnoGame.MathHelper.Clamp$1(this.TargetPosition.X, this.StageBounds.left, this.StageBounds.right - this.CameraBounds.width);
                        this.TargetPosition.Y = CirnoGame.MathHelper.Clamp$1(this.TargetPosition.Y, this.StageBounds.top, this.StageBounds.bottom - this.CameraBounds.height);
                    }

                }
                this.CameraBounds.x = this.Position.X;
                this.CameraBounds.y = this.Position.Y;
            },
            Apply: function (g) {
                g.scale(this.Scale, this.Scale);
                g.translate(-this.Position.X, -this.Position.Y);
            }
        }
    });

    Bridge.define("CirnoGame.Entity", {
        fields: {
            Ani: null,
            Alive: false,
            Visible: false,
            Speed: null,
            Game: null,
            _behaviors: null,
            _behaviorTicks: null,
            data: null,
            ZOrder: 0,
            ID: null,
            HideHitbox: false,
            HandledLocally: false,
            RemovedOnLevelEnd: false,
            HitboxBuffer: null
        },
        props: {
            Hspeed: {
                get: function () {
                    return this.Speed.X;
                },
                set: function (value) {
                    this.Speed.X = value;
                }
            },
            Vspeed: {
                get: function () {
                    return this.Speed.Y;
                },
                set: function (value) {
                    this.Speed.Y = value;
                }
            },
            Position: {
                get: function () {
                    return this.Ani.Position;
                },
                set: function (value) {
                    this.Ani.Position = value;
                }
            },
            x: {
                get: function () {
                    return this.Ani.Position.X;
                },
                set: function (value) {
                    this.Ani.Position.X = value;
                }
            },
            y: {
                get: function () {
                    return this.Ani.Position.Y;
                },
                set: function (value) {
                    this.Ani.Position.Y = value;
                }
            },
            Width: {
                get: function () {
                    if (this.Ani.CurrentImage != null) {
                        return this.Ani.CurrentImage.width;
                    }
                    return 0;
                }
            },
            Height: {
                get: function () {
                    if (this.Ani.CurrentImage != null) {
                        return this.Ani.CurrentImage.height;
                    }
                    return 0;
                }
            }
        },
        ctors: {
            init: function () {
                this.Alive = true;
                this.Visible = true;
                this.Speed = new CirnoGame.Vector2();
                this.data = new (System.Collections.Generic.Dictionary$2(System.String,System.Object))();
                this.ZOrder = 0;
                this.HandledLocally = true;
                this.RemovedOnLevelEnd = true;
                this.HitboxBuffer = new CirnoGame.Rectangle();
            },
            ctor: function (game) {
                this.$initialize();
                //ID = Math.Random();
                this.ID = CirnoGame.Helper.GetRandomString();
                this.Game = game;
            }
        },
        methods: {
            AddBehavior$1: function (behavior) {
                if (this._behaviors == null) {
                    this._behaviors = new (System.Collections.Generic.List$1(CirnoGame.EntityBehavior)).ctor();
                    this._behaviorTicks = new (System.Collections.Generic.List$1(System.Int32)).ctor();
                }
                this._behaviors.add(behavior);
                this._behaviorTicks.add(0);
            },
            AddBehavior: function (T) {
                if (this._behaviors == null) {
                    this._behaviors = new (System.Collections.Generic.List$1(CirnoGame.EntityBehavior)).ctor();
                    this._behaviorTicks = new (System.Collections.Generic.List$1(System.Int32)).ctor();
                }
                var B = Bridge.createInstance(T, [this]);
                this._behaviors.add(Bridge.cast(B, CirnoGame.EntityBehavior));
                this._behaviorTicks.add(0);
                return Bridge.unbox(B);
                /* if (B is EntityBehavior)
                {
                   _behaviors.Add((EntityBehavior)B);
                   _behaviorTicks.Add(0);
                }else
                {
                   throw new Exception("Attempted to add an invalid behavior");
                }*/
            },
            RemoveBehavior: function (behavior) {
                if (this._behaviors == null) {
                    this._behaviors = new (System.Collections.Generic.List$1(CirnoGame.EntityBehavior)).ctor();
                    this._behaviorTicks = new (System.Collections.Generic.List$1(System.Int32)).ctor();
                }
                if (this._behaviors.contains(behavior)) {
                    this._behaviorTicks.removeAt(this._behaviors.indexOf(behavior));
                    this._behaviors.remove(behavior);
                }
            },
            RemoveBehavior$1: function (T) {
                var $t;
                if (this._behaviors == null) {
                    return;
                }
                var L = new (System.Collections.Generic.List$1(CirnoGame.EntityBehavior)).$ctor1(System.Linq.Enumerable.from(this._behaviors).where(function (behavior) {
                        return Bridge.is(behavior, T);
                    }));
                /* if (L.Count > 0)
                {
                   RemoveBehavior(L[0]);
                }*/
                $t = Bridge.getEnumerator(L);
                try {
                    while ($t.moveNext()) {
                        var behavior = $t.Current;
                        this.RemoveBehavior(behavior);
                    }
                } finally {
                    if (Bridge.is($t, System.IDisposable)) {
                        $t.System$IDisposable$dispose();
                    }
                }return;
            },
            GetBehavior: function (T) {
                if (this._behaviors == null) {
                    return Bridge.getDefaultValue(T);
                }
                /* List<EntityBehavior> L = new List<EntityBehavior>(_behaviors.Where(behavior => behavior is T));
                if (L.Count>0)
                {
                   return (dynamic)L[0];
                }*/
                return Bridge.cast(System.Linq.Enumerable.from(this._behaviors).first(function (behavior) {
                        return Bridge.is(behavior, T);
                    }), T);
            },
            GetBehavior$1: function (T, func) {
                var L = new (System.Collections.Generic.List$1(CirnoGame.EntityBehavior)).$ctor1(System.Linq.Enumerable.from(this._behaviors).where(function (behavior) {
                        return Bridge.is(behavior, T);
                    }));
                var F = func;
                return Bridge.cast(System.Linq.Enumerable.from(L).first(F), T);
                //return L.First(func).Cast<T>();
            },
            GetTeamColor: function () {
                if (Bridge.is(this, CirnoGame.ICombatant)) {
                    if (this.Game.GamePlaySettings.GameMode.Teams) {
                        return CirnoGame.Game.GetTeamColor(Bridge.cast(this, CirnoGame.ICombatant).CirnoGame$ICombatant$Team);
                    } else {
                        if (Bridge.referenceEquals(this, this.Game.player)) {
                            return CirnoGame.Game.GetTeamColor(1);
                        } else {
                            return CirnoGame.Game.GetTeamColor(2);
                        }
                    }
                }
                return "";
            },
            SameTeam: function (combatant) {
                if (this == combatant) {
                    return true;
                }
                var A = this;
                var B = combatant;

                if (A.PointsForKilling && B.PointsForKilling) {
                    var AA = A;
                    var BB = B;
                    if (AA.Team == BB.Team) {
                        if (this.Game.Teams) {
                            //return ((ICombatant)this).Team != 0;
                            return true;
                        } else {
                            return AA.Team == 0;
                        }
                    }
                }
                return false;
            },
            GetBehaviorFromName: function (Name) {
                if (this._behaviors == null) {
                    return null;
                }
                //List<EntityBehavior> L = new List<EntityBehavior>(_behaviors.Where(behavior => behavior.GetType().FullName==typeFullName));
                /* List<EntityBehavior> L = new List<EntityBehavior>(_behaviors.Where(behavior => behavior.BehaviorName == Name));
                if (L.Count > 0)
                {
                   return (dynamic)L[0];
                }*/
                try {
                    return System.Linq.Enumerable.from(this._behaviors).first(function (behavior) {
                            return Bridge.referenceEquals(behavior.BehaviorName, Name);
                        });
                }
                catch ($e1) {
                    $e1 = System.Exception.create($e1);
                    System.Console.WriteLine(System.String.concat("Behavior ", Name, " was not found."));
                }
                return null;
            },
            CustomEvent: function (evt) {

            },
            PlaySound: function (sound) {
                this.Game.PlaySoundEffect(this.getCenter(), sound);
            },
            getCenter: function () {
                //return Position + new Vector2(Width / 2, Height / 2);
                return CirnoGame.Vector2.Add$1(this.Position, this.Width / 2, this.Height / 2);
            },
            GetHitbox: function () {
                if (this.Ani != null && this.Ani.CurrentImage != null) {
                    //return new Rectangle(Ani.X, Ani.Y, Ani.CurrentImage.Width, Ani.CurrentImage.Height);
                    var CI = this.Ani.CurrentImage;
                    this.HitboxBuffer.Set(this.Ani.X, this.Ani.Y, CI.width, CI.height);
                    return this.HitboxBuffer;
                }
                return null;
            },
            Update: function () {
                var $t;
                this.Ani.Position = CirnoGame.Vector2.op_Addition(this.Ani.Position, this.Speed);
                this.Ani.Update();
                if (this._behaviors != null) {
                    var i = 0;
                    while (i < this._behaviors.Count) {
                        var behavior = this._behaviors.getItem(i);
                        if (behavior.enabled && Bridge.identity(this._behaviorTicks.getItem(i), ($t = (this._behaviorTicks.getItem(i) + 1) | 0, this._behaviorTicks.setItem(i, $t), $t)) >= behavior.FramesPerTick) {
                            this._behaviorTicks.setItem(i, 0);
                            behavior.Update();
                        }
                        i = (i + 1) | 0;
                    }
                }
            },
            RefreshBehaviorTick: function (T) {
                var B = this.GetBehavior(T);
                if (B != null) {
                    this._behaviorTicks.setItem(this._behaviors.indexOf(B), B.FramesPerTick);
                }
            },
            Draw: function (g) {
                var $t;
                this.Ani.Draw(g);
                if (!this.HideHitbox && this.Game.ShowHitbox) {
                    this.DrawHitbox(g);
                }
                if (this._behaviors != null) {
                    $t = Bridge.getEnumerator(this._behaviors);
                    try {
                        while ($t.moveNext()) {
                            var behavior = $t.Current;
                            behavior.Draw(g);
                        }
                    } finally {
                        if (Bridge.is($t, System.IDisposable)) {
                            $t.System$IDisposable$dispose();
                        }
                    }}
            },
            DrawHitbox: function (g) {
                var R = this.GetHitbox();
                if (R != null) {
                    g.strokeStyle = "#FFFF00";
                    g.strokeRect(R.x, R.y, R.width, R.height);
                }
            },
            onRemove: function () {

            }
        }
    });

    Bridge.define("CirnoGame.GameMode.ModeTypes", {
        $kind: "enum",
        statics: {
            fields: {
                
                Skirmish: 0,
                /**
                 * Singleplayer, gameplay is changed up with a mode specific task.
                 *
                 * @static
                 * @public
                 * @memberof number
                 * @constant
                 * @default 1
                 * @type number
                 */
                Challenge: 1,
                /**
                 * Like challenge, but is designed for multiple human players.
                 *
                 * @static
                 * @public
                 * @memberof number
                 * @constant
                 * @default 2
                 * @type number
                 */
                CallengeCoop: 2
            }
        }
    });

    Bridge.define("CirnoGame.GamePad", {
        fields: {
            connected: false,
            axes: null,
            buttons: null,
            id: null,
            index: System.Int64(0)
        },
        ctors: {
            ctor: function (pad) {
                this.$initialize();
                this.id = pad.id;
                this.index = System.Int64(pad.index);
                this.connected = pad.connected;
                this.axes = pad.axes;

                var length = pad.buttons.length;

                this.buttons = System.Array.init(length, null, CirnoGame.GamePadButton);
                var i = 0;
                while (i < length) {
                    this.buttons[System.Array.index(i, this.buttons)] = pad.buttons[i];
                    i = (i + 1) | 0;
                }
            }
        },
        methods: {
            Update: function () {
                var i = 0;
                while (i < this.buttons.length) {
                    this.buttons[System.Array.index(i, this.buttons)].tapped = false;
                    i = (i + 1) | 0;
                }
            },
            CombineData: function (pad) {
                if (Bridge.referenceEquals(this.id, pad.id)) {
                    this.connected = pad.connected;
                    this.axes = pad.axes;
                    //buttons = pad.buttons;
                    this.CombineButtonData(pad.buttons);
                }
            },
            CombineButtonData: function (buttons) {
                var Lb = buttons;
                this.buttons = buttons;
                var i = 0;
                while (i < buttons.length) {
                    if (buttons[System.Array.index(i, buttons)].pressed && !Lb[System.Array.index(i, Lb)].pressed) {
                        buttons[System.Array.index(i, buttons)].tapped = true;
                    }
                    i = (i + 1) | 0;
                }
            }
        }
    });

    Bridge.define("CirnoGame.GamePadButton", {
        fields: {
            tapped: false,
            pressed: false,
            value: 0
        },
        ctors: {
            ctor: function (button) {
                this.$initialize();
                this.pressed = button.pressed;
                this.value = button.value;
                this.tapped = false;
            }
        }
    });

    Bridge.define("CirnoGame.GamePadManager", {
        statics: {
            fields: {
                _this: null
            }
        },
        fields: {
            keyboard: null,
            gamepads: null,
            tempgamepads: null
        },
        props: {
            activeGamepads: {
                get: function () {
                    return new (System.Collections.Generic.List$1(CirnoGame.GamePad)).$ctor1(System.Linq.Enumerable.from(this.gamepads).where(function (gamepad) {
                            return gamepad.connected;
                        }));
                }
            }
        },
        ctors: {
            ctor: function () {
                this.$initialize();
                this.gamepads = new (System.Collections.Generic.List$1(CirnoGame.GamePad)).ctor();
                this.Update();
            }
        },
        methods: {
            CallBackTest: function () {
                Bridge.global.alert("Callback!");
            },
            GetPad: function (id) {
                var L = new (System.Collections.Generic.List$1(CirnoGame.GamePad)).$ctor1(System.Linq.Enumerable.from(this.gamepads).where(function (gamepad) {
                        return Bridge.referenceEquals(gamepad.id, id);
                    }));
                if (L.Count > 0) {
                    return L.getItem(0);
                }
                return null;
            },
            Update: function () {
                var i = 0;
                while (i < this.gamepads.Count) {
                    this.gamepads.getItem(i).Update();
                    i = (i + 1) | 0;
                }
                i = 0;
                this.tempgamepads = (navigator.getGamepads() || navigator.webkitGetGamepads() || []);
                var pads = new (System.Collections.Generic.List$1(CirnoGame.GamePad)).ctor();
                while (i < this.tempgamepads.length) {
                    if (this.tempgamepads[i] != null) {
                        var pad = new CirnoGame.GamePad(this.tempgamepads[i]);
                        this._Update(pad);
                        pads.add(pad);
                    }
                    i = (i + 1) | 0;
                }
                i = 0;
                //Adds any newly found gamepads.
                while (i < pads.Count) {
                    var id = pads.getItem(i).id;
                    var j = 0;
                    var ok = true;
                    while (j < this.gamepads.Count) {
                        if (Bridge.referenceEquals(this.gamepads.getItem(j).id, id)) {
                            ok = false;
                        }
                        j = (j + 1) | 0;
                    }
                    if (ok) {
                        this.gamepads.add(pads.getItem(i));
                    }
                    i = (i + 1) | 0;
                }

                /* Action F = CallBackTest;
                Script.Write("setTimeout(F, 3000);");*/
                //Global.SetTimeout()
            },
            _Update: function (pad) {
                var i = 0;
                while (i < this.gamepads.Count) {
                    var P = this.gamepads.getItem(i);
                    if (Bridge.referenceEquals(P.id, pad.id)) {
                        P.CombineData(pad);
                    }
                    i = (i + 1) | 0;
                }
            }
        }
    });

    Bridge.define("CirnoGame.GamePlaySettings", {
        fields: {
            Online: false,
            MyCharacter: null,
            GameMode: null,
            MyTeam: 0,
            BlueNPCs: 0,
            RedNPCs: 0,
            RoomID: null,
            /**
             * @instance
             * @public
             * @memberof CirnoGame.GamePlaySettings
             * @default 1.0
             * @type number
             */
            ComputerAIModifier: 0
        },
        ctors: {
            init: function () {
                this.Online = false;
                this.MyCharacter = "Reisen";
                this.MyTeam = 1;
                this.BlueNPCs = 3;
                this.RedNPCs = 2;
                this.RoomID = "";
                this.ComputerAIModifier = 1.0;
            },
            ctor: function () {
                this.$initialize();
                //GameMode = new GameMode();
                //GameMode = GameMode.DeathMatch;
                this.GameMode = CirnoGame.GameMode.TeamBattle;
            }
        }
    });

    Bridge.define("CirnoGame.Helper", {
        statics: {
            fields: {
                _namespaces: null
            },
            ctors: {
                init: function () {
                    this._namespaces = new (System.Collections.Generic.Dictionary$2(System.String,System.Object))();
                }
            },
            methods: {
                GetRandomString: function () {
                    //return (Math.Random() * new Date().GetTime()).ToString(36).Replace("/\\./ g, '-'",null);
                    //return (Math.Random() * new Date().GetTime()).ToString(36).Replace(new Bridge.Text.RegularExpressions.Regex("", null);
                    //return Script.Write<string>("(Math.random() * new Date().getTime()).toString(36).replace(/\\./ g, '-')");
                    return (Math.random() * new Date().getTime()).toString(36);
                },
                GetType: function (FullName) {
                    var name = FullName;
                    if (Bridge.referenceEquals(name, "") || name == null || !System.String.contains(name,".")) {
                        return null;
                    }
                    var s = name.split(".");
                    //string nm = GetType().FullName.Split(".")[0];
                    var i = 1;
                    /* if (s[0] != nm)
                       return null;*/

                    //dynamic obj = Script.Write<object>(nm);

                    //Get namespace
                    var obj;
                    if (CirnoGame.Helper._namespaces.containsKey(s[System.Array.index(0, s)])) {
                        obj = CirnoGame.Helper._namespaces.get(s[System.Array.index(0, s)]);
                    } else {
                        obj = eval(s[System.Array.index(0, s)]);
                        CirnoGame.Helper._namespaces.set(s[System.Array.index(0, s)], obj);
                    }

                    while (i < s.length) {
                        //Parse through object hierarchy.
                        if (!obj) {
                            return null;
                        }
                        obj = obj[s[System.Array.index(i, s)]];
                        i = (i + 1) | 0;
                    }
                    return obj;
                },
                AddMultiple: function (T, array, item, number) {
                    while (number > 0) {
                        array.push(item);
                        number = (number - 1) | 0;
                    }
                },
                Repeat: function (s, number) {
                    if (number < 1) {
                        return "";
                    }
                    var ret = s;
                    var i = (number - 1) | 0;
                    while (i > 0) {
                        ret = System.String.concat(ret, s);
                        i = (i - 1) | 0;
                    }
                    return ret;
                },
                CloneCanvas: function (C) {
                    var ret = document.createElement("canvas");
                    ret.width = C.width;
                    ret.height = C.height;
                    var g = ret.getContext("2d");
                    g.drawImage(C, 0.0, 0.0);
                    return ret;
                },
                GetContext: function (C) {
                    return C.getContext("2d");
                },
                GetField: function (target, fieldName) {
                    var O = target;
                    //if (O[fieldName])
                    if (CirnoGame.Helper.Has(O, fieldName)) {
                        return O[fieldName];
                    }
                    if (O[System.String.concat("get", fieldName)]) {
                        return O[System.String.concat("get", fieldName)]();
                    }
                    var s = "";
                    try {
                        s = System.String.concat("Helper get field: Field \"", fieldName, "\" was not in " + target.GetType().FullName, ".");
                    }
                    catch ($e1) {
                        $e1 = System.Exception.create($e1);
                        s = System.String.concat("Helper get field: Field \"", fieldName, "\" was not in " + target, ".");
                    }

                    //Console.WriteLine(s);
                    console.log(s);
                    return null;
                },
                Has: function (target, fieldName) {
                    /* if (O[fieldName] || ((string)O) == "false")
                    {
                       return true;
                    }*/
                    return typeof target[fieldName] != 'undefined';
                },
                ReloadPage: function () {
                    window.location.href = window.location.href;
                },
                SetField: function (target, fieldName, data) {
                    var O = target;
                    //if (O[fieldName])
                    if (CirnoGame.Helper.Has(O, fieldName)) {
                        O[fieldName] = data;
                        return;
                    }
                    if (O[System.String.concat("set", fieldName)]) {
                        O[System.String.concat("set", fieldName)](data);
                        return;
                    }
                    var s = "";
                    try {
                        s = System.String.concat("Helper set field: Field \"", fieldName, "\" was not in " + target.GetType().FullName, ".");
                    }
                    catch ($e1) {
                        $e1 = System.Exception.create($e1);
                        s = System.String.concat("Helper set field: Field \"", fieldName, "\" was not in " + target, ".");
                    }
                    //Console.WriteLine(s);
                    console.log(s);
                },
                CopyFields: function (source, target, Fields) {
                    if (Fields === void 0) { Fields = null; }
                    if (Fields == null) {
                        Fields = Object.keys(source);
                    }
                    var i = 0;
                    while (i < Fields.length) {
                        var f = Fields[System.Array.index(i, Fields)];
                        CirnoGame.Helper.SetField(target, f, CirnoGame.Helper.GetField(source, f));
                        i = (i + 1) | 0;
                    }
                },
                KeyCodeToString: function (keycode) {
                    var codenames = System.Array.init(["", "", "", "CANCEL", "", "", "HELP", "", "BACK_SPACE", "TAB", "", "", "CLEAR", "ENTER", "ENTER_SPECIAL", "", "SHIFT", "CONTROL", "ALT", "PAUSE", "CAPS_LOCK", "KANA", "EISU", "JUNJA", "FINAL", "HANJA", "", "ESCAPE", "CONVERT", "NONCONVERT", "ACCEPT", "MODECHANGE", "SPACE", "PAGE_UP", "PAGE_DOWN", "END", "HOME", "LEFT", "UP", "RIGHT", "DOWN", "SELECT", "PRINT", "EXECUTE", "PRINTSCREEN", "INSERT", "DELETE", "", "0", "1", "2", "3", "4", "5", "6", "7", "8", "9", "COLON", "SEMICOLON", "LESS_THAN", "EQUALS", "GREATER_THAN", "QUESTION_MARK", "AT", "A", "B", "C", "D", "E", "F", "G", "H", "I", "J", "K", "L", "M", "N", "O", "P", "Q", "R", "S", "T", "U", "V", "W", "X", "Y", "Z", "OS_KEY", "", "CONTEXT_MENU", "", "SLEEP", "NUMPAD0", "NUMPAD1", "NUMPAD2", "NUMPAD3", "NUMPAD4", "NUMPAD5", "NUMPAD6", "NUMPAD7", "NUMPAD8", "NUMPAD9", "MULTIPLY", "ADD", "SEPARATOR", "SUBTRACT", "DECIMAL", "DIVIDE", "F1", "F2", "F3", "F4", "F5", "F6", "F7", "F8", "F9", "F10", "F11", "F12", "F13", "F14", "F15", "F16", "F17", "F18", "F19", "F20", "F21", "F22", "F23", "F24", "", "", "", "", "", "", "", "", "NUM_LOCK", "SCROLL_LOCK", "WIN_OEM_FJ_JISHO", "WIN_OEM_FJ_MASSHOU", "WIN_OEM_FJ_TOUROKU", "WIN_OEM_FJ_LOYA", "WIN_OEM_FJ_ROYA", "", "", "", "", "", "", "", "", "", "CIRCUMFLEX", "EXCLAMATION", "DOUBLE_QUOTE", "HASH", "DOLLAR", "PERCENT", "AMPERSAND", "UNDERSCORE", "OPEN_PAREN", "CLOSE_PAREN", "ASTERISK", "PLUS", "PIPE", "HYPHEN_MINUS", "OPEN_CURLY_BRACKET", "CLOSE_CURLY_BRACKET", "TILDE", "", "", "", "", "VOLUME_MUTE", "VOLUME_DOWN", "VOLUME_UP", "", "", "SEMICOLON", "EQUALS", "COMMA", "MINUS", "PERIOD", "SLASH", "BACK_QUOTE", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "OPEN_BRACKET", "BACK_SLASH", "CLOSE_BRACKET", "QUOTE", "", "META", "ALTGR", "", "WIN_ICO_HELP", "WIN_ICO_00", "", "WIN_ICO_CLEAR", "", "", "WIN_OEM_RESET", "WIN_OEM_JUMP", "WIN_OEM_PA1", "WIN_OEM_PA2", "WIN_OEM_PA3", "WIN_OEM_WSCTRL", "WIN_OEM_CUSEL", "WIN_OEM_ATTN", "WIN_OEM_FINISH", "WIN_OEM_COPY", "WIN_OEM_AUTO", "WIN_OEM_ENLW", "WIN_OEM_BACKTAB", "ATTN", "CRSEL", "EXSEL", "EREOF", "PLAY", "ZOOM", "", "PA1", "WIN_OEM_CLEAR", ""], System.String);
                    if (keycode >= 0 && keycode < codenames.length) {
                        return codenames[System.Array.index(keycode, codenames)];
                    }
                    var kc = keycode;
                    return String.FromCharCode(kc);
                },
                MakeShallowCopy: function (source, fieldNames) {
                    if (fieldNames === void 0) { fieldNames = null; }
                    var target = { };
                    var Fields = fieldNames;
                    if (Fields == null) {
                        Fields = Object.keys(source);
                    }
                    var i = 0;
                    while (i < Fields.length) {
                        var f = Fields[System.Array.index(i, Fields)];
                        target[f] = CirnoGame.Helper.GetField(source, f);
                        i = (i + 1) | 0;
                    }
                    return target;
                }
            }
        }
    });

    Bridge.define("CirnoGame.HelperExtensions", {
        statics: {
            methods: {
                Pick: function (T, list, RND) {
                    var $t;
                    if (RND === void 0) { RND = null; }
                    if (RND == null) {
                        RND = new System.Random.ctor();
                    }
                    var L = new (System.Collections.Generic.List$1(T)).ctor();
                    $t = Bridge.getEnumerator(list, T);
                    try {
                        while ($t.moveNext()) {
                            var item = $t.Current;
                            L.add(item);
                        }
                    } finally {
                        if (Bridge.is($t, System.IDisposable)) {
                            $t.System$IDisposable$dispose();
                        }
                    }return L.getItem(RND.next$1(L.Count));
                },
                ForEach: function (T, list, action) {
                    var $t;
                    $t = Bridge.getEnumerator(list, T);
                    try {
                        while ($t.moveNext()) {
                            var item = $t.Current;
                            action(item);
                        }
                    } finally {
                        if (Bridge.is($t, System.IDisposable)) {
                            $t.System$IDisposable$dispose();
                        }
                    }},
                ForEach$1: function (T, list, methodName) {
                    var $t;
                    $t = Bridge.getEnumerator(list, T);
                    try {
                        while ($t.moveNext()) {
                            var item = $t.Current;
                            var A = Bridge.unbox(item[methodName]);
                            A();
                        }
                    } finally {
                        if (Bridge.is($t, System.IDisposable)) {
                            $t.System$IDisposable$dispose();
                        }
                    }},
                AddIfNew: function (T, list, item) {
                    var i = 0;
                    var ln = list.Count;
                    var A = item;
                    while (i < ln) {
                        var B = list.getItem(i);
                        if (A == B) {
                            return;
                        }
                        i = (i + 1) | 0;
                    }
                    list.add(item);
                    /* if (!list.Contains(item))
                    {
                       list.Add(item);
                    }*/
                },
                RemoveAll: function (T, list, predicate) {

                    //foreach (var item in list)
                    var i = 0;
                    while (i < list.Count) {
                        var item = list.getItem(i);
                        //action(item);
                        if (predicate(item)) {
                            //list.rem
                            list.remove(item);
                            i = (i - 1) | 0;
                        }
                        i = (i + 1) | 0;
                    }
                },
                PushIfNew: function (T, list, val) {
                    if (!CirnoGame.HelperExtensions.ContainsB(T, list, val)) {
                        list.push(val);
                    }
                },
                PushRange: function (T, list, val) {
                    if (val === void 0) { val = []; }
                    var i = 0;
                    while (i < val.length) {
                        list.push(val[System.Array.index(i, val)]);
                        i = (i + 1) | 0;
                    }
                },
                Clear$1: function (T, list) {
                    var i = list.length;
                    while (Bridge.identity(i, (i = (i - 1) | 0)) > 0) {
                        list.pop();
                    }
                },
                Clear: function (G) {
                    var C = G.canvas;
                    G.clearRect(0, 0, C.width, C.height);
                },
                ReplaceAll: function (T, list, Source, Destination) {
                    var i = -1;
                    i = CirnoGame.HelperExtensions.IndexOf(T, list, Source, ((i + 1) | 0), 3);
                    var ln = Source.length;
                    while (i >= 0) {
                        var j = 0;

                        while (j < ln) {
                            list[System.Array.index(((i + j) | 0), list)] = Destination[System.Array.index(j, Destination)];
                            j = (j + 1) | 0;
                        }
                        i = CirnoGame.HelperExtensions.IndexOf(T, list, Source, ((i + 1) | 0), 3);
                    }
                },
                WhereB: function (T, list, predicate) {
                    var ret = System.Array.init(0, null, System.Object);
                    var i = 0;
                    var ln = list.length;
                    while (i < ln) {
                        var item = list[System.Array.index(i, list)];
                        if (predicate(item)) {
                            ret.push(item);
                        }
                        i = (i + 1) | 0;
                    }

                    return Bridge.unbox(ret);
                },
                ContainsB$1: function (T, list, Value) {
                    var L = Bridge.unbox(list.items);
                    return CirnoGame.HelperExtensions.ContainsB(T, L, Value);
                },
                ContainsB: function (T, list, Value) {
                    var i = 0;
                    var ln = list.length;
                    while (i < ln) {
                        var O = list[System.Array.index(i, list)];
                        if (O == Value) {
                            return true;
                        }
                        i = (i + 1) | 0;
                    }
                    return false;
                },
                IndexOf: function (T, list, Value, index, structureSize) {
                    if (index === void 0) { index = 0; }
                    if (structureSize === void 0) { structureSize = 1; }
                    var i = index;
                    var ln = list.length;
                    var vln = Value.length;
                    var O = Value[System.Array.index(0, Value)];
                    var A;
                    var B;
                    while (i < ln && i >= 0) {
                        /* var c = i+1;
                        i = -1;
                        B = Value[0];
                        while (c < list.Length && i==-1)
                        {
                           A = list[c];
                           if (A == B)
                           {
                               i = c;
                           }
                           c++;
                        }
                        if (i == -1)
                        {
                           return -1;
                        }*/
                        i = list.indexOf(Bridge.unbox(O), ((i + 1) | 0));
                        while (i >= 0 && i % structureSize > 0) {
                            i = list.indexOf(Bridge.unbox(O), ((i + 1) | 0));
                        }
                        if (i === -1) {
                            return -1;
                        }
                        var k = 1;
                        var l = (i + 1) | 0;

                        if (i < ln && i >= 0) {
                            var ok = true;
                            while (ok && k < vln) {
                                A = list[System.Array.index(l, list)];
                                B = Value[System.Array.index(k, Value)];
                                if (!Bridge.referenceEquals(A, B)) {
                                    ok = false;
                                }
                                k = (k + 1) | 0;
                                l = (l + 1) | 0;
                            }
                            if (ok) {
                                return i;
                            }
                        }
                    }
                    return -1;
                },
                Identical: function (T, list, list2) {
                    if (Bridge.referenceEquals(list, list2)) {
                        return true;
                    }
                    if (list == null || list2 == null) {
                        return false;
                    }
                    var ln = list.length;
                    if (ln === list2.length) {
                        var i = 0;

                        while (i < ln) {
                            var A = list[System.Array.index(i, list)];
                            var B = list2[System.Array.index(i, list2)];
                            if (!Bridge.referenceEquals(A, B)) {
                                return false;
                            }
                            i = (i + 1) | 0;
                        }
                        return true;
                    }
                    return false;
                },
                ReverseOrderWithStructure: function (T, list, size) {
                    //T[] ret = new T[0];
                    var ret = new (System.Collections.Generic.List$1(T)).ctor();
                    var i = 0;
                    var ln = list.length;
                    while (i < ln) {
                        var j = 0;
                        while (j < size) {
                            //ret.Push(list[j]);
                            ret.insert(0, list[System.Array.index((((((size - 1) | 0)) - j) | 0), list)]);
                            j = (j + 1) | 0;
                        }
                        i = (i + size) | 0;
                    }
                },
                /**
                 * not yet tested with deep inheritence...
                 *
                 * @static
                 * @public
                 * @this CirnoGame.HelperExtensions
                 * @memberof CirnoGame.HelperExtensions
                 * @param   {Function}         T           
                 * @param   {System.Object}    instance
                 * @return  {boolean}
                 */
                IsInstanceOfTypeFast: function (T, instance) {
                    var C = Bridge.unbox(instance).ctor;
                    var A = Bridge.unbox(T.$$inheritors); //list of all types that inherit from this type
                    return (Bridge.referenceEquals(C, T) || (A != null && A.indexOf(C) >= 0));
                }
            }
        }
    });

    Bridge.define("CirnoGame.ICombatant", {
        $kind: "interface"
    });

    Bridge.define("CirnoGame.IHarmfulEntity", {
        $kind: "interface"
    });

    Bridge.define("CirnoGame.ILightProducer", {
        $kind: "interface"
    });

    Bridge.define("CirnoGame.ILightSource", {
        $kind: "interface"
    });

    Bridge.define("CirnoGame.InputController", {
        statics: {
            fields: {
                NumberOfActions: 0,
                GM: null
            },
            ctors: {
                init: function () {
                    this.NumberOfActions = 8;
                }
            }
        },
        fields: {
            InputMapping: null
        },
        props: {
            id: null
        },
        ctors: {
            ctor: function (id) {
                if (id === void 0) { id = "Keyboard"; }

                this.$initialize();
                this.id = id;
                this.InputMapping = new (System.Collections.Generic.List$1(CirnoGame.InputMap)).ctor();

                if (Bridge.referenceEquals(id, "Keyboard")) {
                    this.initkeyboard();
                } else {
                    this.initgamepad();
                }
                if (CirnoGame.InputController.GM == null) {
                    if (CirnoGame.GamePadManager._this == null) {
                        CirnoGame.GamePadManager._this = new CirnoGame.GamePadManager();
                    }
                    CirnoGame.InputController.GM = CirnoGame.GamePadManager._this;
                }
            }
        },
        methods: {
            CopyMap: function () {
                /* dynamic D = new object();
                return D;*/
                var fields = System.Array.init(["map", "antimap", "name", "axis", "controllerID"], System.String);
                var ret = System.Array.init(this.InputMapping.Count, null, System.Object);
                var i = 0;
                while (i < ret.length) {
                    ret[System.Array.index(i, ret)] = CirnoGame.Helper.MakeShallowCopy(this.InputMapping.getItem(i), fields);
                    i = (i + 1) | 0;
                }
                return ret;
            },
            CopyFromMap: function (Map) {
                var fields = System.Array.init(["map", "antimap", "name", "axis", "controllerID"], System.String);

                var i = 0;
                while (i < Map.length) {
                    if (i >= this.InputMapping.Count) {
                        this.InputMapping.add(new CirnoGame.InputMap.ctor());
                    }
                    var IM = this.InputMapping.getItem(i);
                    CirnoGame.Helper.CopyFields(Map[System.Array.index(i, Map)], IM, fields);
                    //ret[i] = Helper.MakeShallowCopy(InputMapping[i], fields);
                    i = (i + 1) | 0;
                }
            },
            initkeyboard: function () {
                var i = 0;
                while (i < CirnoGame.InputController.NumberOfActions) {
                    var map = new CirnoGame.InputMap.$ctor1(-1);
                    if (i === 0) {
                        map.map = 39;
                        map.antimap = 37;

                        /* map.map = 68;
                        map.antimap= 65;*/
                    }
                    if (i === 1) {
                        map.map = 40;
                        map.antimap = 38;

                        /* map.map = 83;
                        map.antimap = 87;*/
                    }

                    if (i === 2) {
                        //map.map = 32;
                        map.map = 90;
                    }
                    if (i === 3) {
                        map.map = 88;
                    }
                    if (i === 4) {
                        map.map = 65; //a
                    }
                    if (i === 5) {
                        map.map = 13; //enter
                    }
                    this.InputMapping.add(map);
                    i = (i + 1) | 0;
                }
            },
            initgamepad: function () {
                var i = 0;
                while (i < CirnoGame.InputController.NumberOfActions) {
                    var map = new CirnoGame.InputMap.$ctor1(-1);
                    if (i === 0) {
                        map.map = 0;
                        map.axis = true;
                    }
                    if (i === 1) {
                        map.map = 1;
                        map.axis = true;
                    }

                    if (i > 1) {
                        map.map = (i - 2) | 0;
                    }
                    this.InputMapping.add(map);
                    i = (i + 1) | 0;
                }
            },
            getState: function (action, map) {
                if (map === void 0) { map = null; }
                if (map == null) {
                    map = this.InputMapping.getItem(action);
                }
                /* InputController IC = this;
                if (map.controller != null)
                {
                   IC = map.controller;
                }*/
                var TID = this.id;
                if (!Bridge.referenceEquals(map.controllerID, "")) {
                    TID = map.controllerID;
                }

                if (Bridge.referenceEquals(TID, "Keyboard")) {
                    return this.getKeyboardMapState(map);
                } else if (Bridge.referenceEquals(TID, "Mouse")) {
                    return this.getMouseMapState(map);
                } else {
                    return this.getGamepadMapState(map);
                }
            },
            getPressed: function (action, map) {
                if (map === void 0) { map = null; }
                return this.getState(action, map) >= 0.7;
            },
            FindAnyPressedGamePadInput: function () {
                var ret = new CirnoGame.InputMap.ctor();
                var L = CirnoGame.GamePadManager._this.activeGamepads;
                L.forEach(function (G) {
                    if (ret.map === -1) {
                        ret.controllerID = G.id;
                        var GB = System.Linq.Enumerable.from(G.buttons).where(function (B) {
                                return B.pressed;
                            }).toArray(CirnoGame.GamePadButton);
                        if (GB.length > 0) {
                            ret.axis = false;
                            var tmp = GB[System.Array.index(0, GB)];
                            ret.map = new (System.Collections.Generic.List$1(CirnoGame.GamePadButton)).$ctor1(G.buttons).indexOf(tmp);
                        } else {
                            var i = 0;
                            while (i < G.axes.length && ret.map === -1) {
                                if (Math.abs(G.axes[System.Array.index(i, G.axes)]) > 0.7 && Math.abs(G.axes[System.Array.index(i, G.axes)]) < 2.0) {
                                    ret.axis = true;
                                    ret.map = i;
                                    if (G.axes[System.Array.index(i, G.axes)] < 0) {
                                        ret.name = "anti";
                                        ret.antimap = i;
                                    }
                                }
                                i = (i + 1) | 0;
                            }
                        }
                    }
                });
                if (ret.map !== -1) {
                    return ret;
                }
                return null;
            },
            getMapControllerID: function (map) {
                if (!Bridge.referenceEquals(map.controllerID, "")) {
                    return map.controllerID;
                } else {
                    return this.id;
                }
            },
            getMapControllerID$1: function (action) {
                return this.getMapControllerID(this.InputMapping.getItem(action));
            },
            getGamepadMapState: function (map) {
                var TID = this.id;
                if (!Bridge.referenceEquals(map.controllerID, "")) {
                    TID = map.controllerID;
                }
                var P = CirnoGame.GamePadManager._this.GetPad(TID);
                if (P == null || !P.connected) {
                    return 0;
                }
                if (!map.axis) {
                    if (P.buttons[System.Array.index(map.map, P.buttons)].pressed) {
                        return 1;
                    } else if (map.antimap >= 0 && P.buttons[System.Array.index(map.antimap, P.buttons)].pressed) {
                        return -1;
                    }
                    return 0;
                } else {
                    return P.axes[System.Array.index(map.map, P.axes)];
                }
            },
            getKeyboardMapState: function (map) {
                var L = CirnoGame.KeyboardManager._this.PressedButtons;
                if (L.contains(map.map)) {
                    return 1.0;
                } else if (L.contains(map.antimap)) {
                    return -1.0;
                }
                return 0;
            },
            getMouseMapState: function (map) {
                var L = CirnoGame.KeyboardManager._this.PressedMouseButtons;
                if (L.contains(map.map)) {
                    return 1.0;
                } else if (L.contains(map.antimap)) {
                    return -1.0;
                }
                return 0;
            }
        }
    });

    Bridge.define("CirnoGame.InputControllerManager", {
        statics: {
            fields: {
                __this: null
            },
            props: {
                _this: {
                    get: function () {
                        if (CirnoGame.InputControllerManager.__this == null) {
                            CirnoGame.InputControllerManager.__this = new CirnoGame.InputControllerManager();
                        }
                        return CirnoGame.InputControllerManager.__this;
                    }
                }
            },
            methods: {
                Init: function () {
                    if (CirnoGame.InputControllerManager.__this == null) {
                        CirnoGame.InputControllerManager.__this = new CirnoGame.InputControllerManager();
                    }
                }
            }
        },
        fields: {
            Controllers: null
        },
        ctors: {
            ctor: function () {
                this.$initialize();
                this.Controllers = new (System.Collections.Generic.List$1(CirnoGame.InputController)).ctor();

                this.Controllers.add(new CirnoGame.InputController());
                var gamepads = CirnoGame.GamePadManager._this.activeGamepads;
                var i = 0;
                while (i < gamepads.Count) {
                    this.Controllers.add(new CirnoGame.InputController(gamepads.getItem(i).id));
                    i = (i + 1) | 0;
                }
            }
        }
    });

    Bridge.define("CirnoGame.InputMap", {
        fields: {
            map: 0,
            antimap: 0,
            name: null,
            axis: false,
            controllerID: null
        },
        ctors: {
            init: function () {
                this.map = -1;
                this.antimap = -1;
                this.name = "";
                this.axis = false;
                this.controllerID = "";
            },
            ctor: function () {
                this.$initialize();
                this.axis = false;
            },
            $ctor1: function (map, antimap, axis) {
                if (antimap === void 0) { antimap = -1; }
                if (axis === void 0) { axis = false; }

                this.$initialize();
                this.map = map;
                this.antimap = antimap;
                this.axis = axis;
            }
        }
    });

    Bridge.define("CirnoGame.JSONArchive", {
        statics: {
            methods: {
                Open: function (ArchiveFile, action) {
                    var XHR = new XMLHttpRequest();
                    //XHR.ResponseType = XMLHttpRequestResponseType.Blob;
                    XHR.onload = function (Evt) {
                        action(new CirnoGame.JSONArchive(XHR.responseText));
                    };
                    XHR.open("GET", ArchiveFile, false);
                    XHR.send();
                    //if (XHR.Status)

                }
            }
        },
        fields: {
            Data: null,
            Images: null
        },
        ctors: {
            init: function () {
                this.Data = new (System.Collections.Generic.Dictionary$2(System.String,System.String))();
                this.Images = new (System.Collections.Generic.Dictionary$2(System.String,HTMLImageElement))();
            },
            ctor: function (Archive) {
                this.$initialize();
                //this.Archive = Archive;
                var D = JSON.parse(Archive);
                var i = 0;
                var ln = D.length;
                while (i < ln) {
                    var A = D[System.Array.index(Bridge.identity(i, (i = (i + 1) | 0)), D)];
                    this.Data.set(A[System.Array.index(0, A)].toLowerCase(), A[System.Array.index(1, A)]);
                }
            }
        },
        methods: {
            PreloadImages: function (action, delay) {
                if (delay === void 0) { delay = 100; }
                var K = System.Linq.Enumerable.from(this.Data.getKeys()).toArray();
                var i = 0;
                while (i < this.Data.count) {
                    var A = K[System.Array.index(i, K)];
                    this.GetImage(A);
                    i = (i + 1) | 0;
                }
                Bridge.global.setTimeout(action, delay);
            },
            GetData: function (file) {
                var f = file.toLowerCase();
                if (this.Data.containsKey(f)) {
                    return this.Data.get(f);
                }
                return null;
            },
            GetImage: function (file) {
                var f = file.toLowerCase();
                if (this.Images.containsKey(f)) {
                    return this.Images.get(f);
                }
                var D = this.GetData(f);
                if (D == null) {
                    return null;
                }
                var ret = new Image();
                ret.onload = function (E) {
                    console.log(System.String.concat("loaded ", f, " from JSON!"));
                };
                ret.src = System.String.concat("data:image/png;base64,", D);
                this.Images.set(f, ret);
                return ret;
            }
        }
    });

    Bridge.define("CirnoGame.KeyboardManager", {
        statics: {
            fields: {
                __this: null
            },
            props: {
                _this: {
                    get: function () {
                        if (CirnoGame.KeyboardManager.__this == null) {
                            CirnoGame.KeyboardManager.__this = new CirnoGame.KeyboardManager();
                        }
                        return CirnoGame.KeyboardManager.__this;
                    }
                }
            },
            methods: {
                Init: function () {
                    if (CirnoGame.KeyboardManager.__this == null) {
                        CirnoGame.KeyboardManager.__this = new CirnoGame.KeyboardManager();
                    }
                },
                Update: function () {
                    CirnoGame.KeyboardManager.__this.TappedButtons.clear();
                    CirnoGame.KeyboardManager.__this.TappedMouseButtons.clear();
                },
                NeverinBounds: function (evt) {
                    return !CirnoGame.App.ScreenBounds.containsPoint$1(CirnoGame.KeyboardManager._this.CMouse.X, CirnoGame.KeyboardManager._this.CMouse.Y);
                },
                onKeyDown: function (evt) {
                    var keyCode = evt.keyCode;

                    if (!CirnoGame.KeyboardManager.__this.PressedButtons.contains(keyCode)) {
                        CirnoGame.KeyboardManager.__this.PressedButtons.add(keyCode);
                        CirnoGame.KeyboardManager.__this.TappedButtons.add(keyCode);
                    }
                    if ((keyCode >= 37 && keyCode <= 40) || keyCode === 32 || keyCode === 112) {
                        return false;
                    }
                    return true;
                },
                onKeyUp: function (evt) {
                    var keyCode = evt.keyCode;

                    if (CirnoGame.KeyboardManager.__this.PressedButtons.contains(keyCode)) {
                        CirnoGame.KeyboardManager.__this.PressedButtons.remove(keyCode);
                    }
                },
                onMouseDown: function (evt) {
                    var btn = evt.button;
                    if (!CirnoGame.KeyboardManager.__this.PressedMouseButtons.contains(btn)) {
                        CirnoGame.KeyboardManager.__this.PressedMouseButtons.add(btn);
                        CirnoGame.KeyboardManager.__this.TappedMouseButtons.add(btn);
                    }
                    return btn < 1;
                },
                onMouseUp: function (evt) {
                    var btn = evt.button;
                    if (CirnoGame.KeyboardManager.__this.PressedMouseButtons.contains(btn)) {
                        CirnoGame.KeyboardManager.__this.PressedMouseButtons.remove(btn);
                    }
                    return btn < 1;
                },
                onMouseMove: function (evt) {
                    CirnoGame.KeyboardManager._this.MousePosition = new CirnoGame.Vector2(evt.clientX, evt.clientY);

                    //float left = float.Parse(App.Canvas.Style.Left.Replace("px", ""));
                    if (System.String.indexOf(CirnoGame.App.Div.style.left, "px") < 0) {
                        return;
                    }
                    var left = System.Single.parse(System.String.replaceAll(CirnoGame.App.Div.style.left, "px", ""));
                    var x = evt.clientX - left;
                    var y = evt.clientY;

                    //float scale = (App.Canvas.Width * 1.25f) / float.Parse(App.Canvas.Style.Width.Replace("px", ""));

                    //float scale = (App.Canvas.Width) / float.Parse(App.Canvas.Style.Width.Replace("px", ""));
                    var scale = (CirnoGame.App.Canvas.width) / System.Single.parse(System.String.replaceAll(CirnoGame.App.Div.style.width, "px", ""));
                    CirnoGame.KeyboardManager._this.CMouse = new CirnoGame.Vector2(x * scale, y * scale);
                    //Console.WriteLine("mx:"+_this.CMouse.x + " my:" + _this.CMouse.y);
                }
            }
        },
        fields: {
            PressedButtons: null,
            TappedButtons: null,
            PressedMouseButtons: null,
            TappedMouseButtons: null,
            MousePosition: null,
            CMouse: null
        },
        ctors: {
            init: function () {
                this.MousePosition = new CirnoGame.Vector2();
                this.CMouse = new CirnoGame.Vector2();
            },
            ctor: function () {
                this.$initialize();
                this.PressedButtons = new (System.Collections.Generic.List$1(System.Int32)).ctor();
                this.TappedButtons = new (System.Collections.Generic.List$1(System.Int32)).ctor();
                this.PressedMouseButtons = new (System.Collections.Generic.List$1(System.Int32)).ctor();
                this.TappedMouseButtons = new (System.Collections.Generic.List$1(System.Int32)).ctor();

                var KD = CirnoGame.KeyboardManager.onKeyDown;
                document.onkeydown = KD;

                var KU = CirnoGame.KeyboardManager.onKeyUp;
                document.onkeyup = KU;

                var MM = CirnoGame.KeyboardManager.onMouseMove;
                document.onmousemove = MM;

                var MD = CirnoGame.KeyboardManager.onMouseDown;
                document.onmousedown = MD;

                var MU = CirnoGame.KeyboardManager.onMouseUp;
                document.onmouseup = MU;

                var NB = CirnoGame.KeyboardManager.NeverinBounds;
                document.oncontextmenu = NB;
            }
        }
    });

    Bridge.define("CirnoGame.MapGenerator", {
        statics: {
            fields: {
                rootroom: null,
                doorroom: null,
                keyroom: null,
                blank: null
            },
            ctors: {
                init: function () {
                    this.blank = new CirnoGame.TileData();
                }
            },
            methods: {
                Generate: function (game) {
                    var player = game.player; //player character
                    var map = game.TM; //the tilemap to generate
                    var bounds = game.stageBounds; //the bounds to stay within

                    //List<Rectangle> rooms = new List<Rectangle>();

                    var X = 0;
                    var Y = 0;
                    if (Math.random() < 0.5) {
                        X = Math.random() < 0.5 ? -1 : 1;
                    } else {
                        Y = Math.random() < 0.5 ? -1 : 1;
                    }
                    var T = new CirnoGame.TileData();
                    T.texture = 1;
                    T.enabled = true;
                    T.visible = true;
                    T.map = map;
                    T.solid = true;
                    T.topSolid = true;
                    //map.SetAll(T);
                    player.x = (bounds.left + bounds.right) / 2;
                    player.y = (bounds.top + bounds.bottom) / 2;
                    //pathMiner(game,map.columns/2,map.rows/2,X,Y,20);
                    CirnoGame.MapGenerator.pathMiner(game, ((Bridge.Int.div(map.columns, 2)) | 0), ((Bridge.Int.div(map.rows, 4)) | 0), X, Y, 30);

                    var V = CirnoGame.MapGenerator.FindEmptySpace(game);
                    if (CirnoGame.Vector2.op_Inequality(V, null)) {
                        player.x = V.X;
                        player.y = V.Y;
                        console.log("spawning at:" + Bridge.Int.clip32(V.X) + "," + Bridge.Int.clip32(V.Y));
                    } else {
                        console.log("cannot locate a spawn point...");
                    }
                },
                BoxyGenerate: function (game) {
                    console.log("boxy generate");
                    var player = game.player; //player character
                    var map = game.TM; //the tilemap to generate
                    var bounds = game.stageBounds; //the bounds to stay within
                    CirnoGame.MapRoom.PlacedRooms = new (System.Collections.Generic.List$1(CirnoGame.MapRoom)).ctor();
                    CirnoGame.MapRoom.OpenRooms = new (System.Collections.Generic.List$1(CirnoGame.MapRoom)).ctor();

                    var SX = (Bridge.Int.div(map.columns, 2)) | 0;
                    var SY = (Bridge.Int.div(map.rows, 3)) | 0;
                    var root = new CirnoGame.MapRoom();
                    root.SX = SX;
                    root.SY = SY;
                    root.EX = (((SX + 6) | 0) + Bridge.Int.clip32((Math.random() * 10))) | 0;
                    root.EY = (((SY + 6) | 0) + Bridge.Int.clip32((Math.random() * 10))) | 0;

                    root.game = game;
                    CirnoGame.MapGenerator.rootroom = root;

                    //var roomtotal = 12+(int)(Math.Random() * 10);
                    //var roomtotal = 16 + (int)(Math.Random() * 16);

                    //var roomMinimum = 16;
                    var roomMinimum = (10 + Math.min(game.level, 4)) | 0;
                    var roomtotal = (roomMinimum + Bridge.Int.clip32((Math.random() * (roomMinimum)))) | 0;
                    //var rooms = 0;

                    var attempts = 400;
                    var R = root;
                    if (!root.PlaceAndExpand()) {
                        console.log("Couldn't generate root room.");
                        return;
                    }
                    while (CirnoGame.MapRoom.OpenRooms.Count < roomtotal && attempts > 0) {
                        var L = CirnoGame.HelperExtensions.Pick(Bridge.global.CirnoGame.MapRoom, CirnoGame.MapRoom.FindValidUnplacedRooms());
                        if (L.PlaceAndExpand()) {
                            //rooms++;
                        }
                        attempts = (attempts - 1) | 0;
                    }
                    var RR = CirnoGame.Rectangle.op_Subtraction(game.stageBounds, game.TM.position);
                    RR.width -= game.TM.tilesize;
                    RR.height -= game.TM.tilesize;
                    game.TM.DrawRect(RR);
                    game.TM.ApplyBreakable();
                    var secrets = Math.random() < 0.3 ? 1 : 0;
                    if (secrets > 0 && Math.random() < 0.3) {
                        secrets = (secrets + 1) | 0;
                    }
                    while (secrets > 0) {
                        var L1 = CirnoGame.HelperExtensions.Pick(Bridge.global.CirnoGame.MapRoom, CirnoGame.MapRoom.FindValidUnplacedRooms());
                        if (L1.PlaceAndExpand()) {
                            L1.MakeSecret();
                            var lever = CirnoGame.MapGenerator.AttemptCreateLever(game, L1);
                            game.AddEntity(lever);
                            console.log("Placed secret room at:" + L1.SX + "," + L1.SY);
                        }
                        secrets = (secrets - 1) | 0;
                    }
                    var V = CirnoGame.MapGenerator.FindEmptySpace(game);
                    CirnoGame.MapGenerator.keyroom = null;
                    if (CirnoGame.Vector2.op_Inequality(V, null)) {
                        /* player.x = V.X;
                        player.y = V.Y;*/
                        game.Door.Position.CopyFrom(V);
                        game.Door.DropToGround();
                        CirnoGame.MapGenerator.doorroom = CirnoGame.MapRoom.FindRoom(game.Door.Position);
                        if (CirnoGame.MapGenerator.doorroom == null) {
                            console.log("Door room could not be determined...");
                        }

                        var PC = player;
                        //PC.MoveToNewSpawn(V);
                        PC.MoveToNewSpawn(game.Door.Position);
                        console.log("spawning at:" + Bridge.Int.clip32(V.X) + "," + Bridge.Int.clip32(V.Y));
                    } else {
                        console.log("cannot locate a spawn point...");
                    }

                },
                AttemptCreateLever: function (game, Target) {
                    var i = 0;
                    while (i < 20) {
                        var lever = CirnoGame.RoomOpeningLever.FindAndPlaceOnWall(game, CirnoGame.MapRoom.FindAnyEmptySpot(), Target);
                        if (lever != null) {
                            return lever;
                        }
                    }
                    return null;
                },
                FindEmptySpace: function (game) {
                    var map = game.TM;
                    var bounds = game.stageBounds; //the bounds to stay within
                    var i = 0;
                    var ret = new CirnoGame.Vector2();
                    var tmp = new CirnoGame.Vector2();
                    while (i < 2000) {
                        ret.X = bounds.left + (Math.random() * (bounds.width - map.tilesize));
                        ret.Y = bounds.top + (Math.random() * (bounds.bottom - map.tilesize));
                        if (!map.CheckForTile(ret).visible) {
                            tmp.X = ret.X;
                            tmp.Y = ret.Y - map.tilesize;
                            if (!map.CheckForTile(ret).visible) {
                                return ret;
                            }
                        }
                        i = (i + 1) | 0;
                    }
                    //return ret;
                    return null;
                },
                pathMiner: function (game, X, Y, Xdir, YDir, limit) {
                    if (limit <= 0) {
                        return;
                    }
                    var player = game.player; //player character
                    var map = game.TM; //the tilemap to generate
                    var bounds = game.stageBounds; //the bounds to stay within

                    var dist = 0;
                    var pow = 1;
                    if (YDir !== 0) {
                        pow = 2;
                    }
                    while (dist < 7 && Math.random() < (Math.pow(0.95, pow))) {
                        X = (X + Xdir) | 0;
                        Y = (Y + YDir) | 0;
                        CirnoGame.MapGenerator.Erase(map, X, Y, 3);
                        if (Math.random() < (0.2 * pow)) {
                            if (Xdir === 0) {
                                X = (X + (Math.random() < 0.5 ? 1 : -1)) | 0;
                            } else {
                                Y = (Y + (Math.random() < 0.5 ? 1 : -1)) | 0;
                            }
                        } else if (Math.random() < (0.02 * pow) && limit > 4) {
                            limit = (Bridge.Int.div(limit, 2)) | 0;
                            var XD = Math.random() < 0.5 ? YDir : ((-YDir) | 0);
                            var YD = Math.random() < 0.5 ? Xdir : ((-Xdir) | 0);
                            CirnoGame.MapGenerator.pathMiner(game, X, Y, XD, YD, limit);
                        }
                    }
                    limit = (limit - 1) | 0;
                    if (limit > 1) {
                        CirnoGame.MapGenerator.roomMiner(game, X, Y, Xdir, YDir, limit);
                    }

                },
                roomMiner: function (game, X, Y, Xdir, YDir, limit) {
                    if (limit <= 0) {
                        return;
                    }

                    var SZ = Bridge.Int.clip32(4 + (Math.random() * 4));
                    X = (X + (Bridge.Int.mul(Xdir, (((Bridge.Int.div(SZ, 2)) | 0))))) | 0;
                    Y = (Y + (Bridge.Int.mul(YDir, (((Bridge.Int.div(SZ, 2)) | 0))))) | 0;

                    //Erase(game.TM, X, Y, (SZ * 2)+2);
                    CirnoGame.MapGenerator.EraseAndRando(game.TM, X, Y, (((Bridge.Int.mul(SZ, 2)) + 2) | 0));

                    var XD = Xdir;
                    var YD = YDir;
                    if (Math.random() < 0.2 || (YD !== 0 && Math.random() < 0.65) || YD < 0) {
                        XD = Math.random() < 0.5 ? YDir : ((-YDir) | 0);
                        YD = Math.random() < 0.5 ? Xdir : ((-Xdir) | 0);
                        if (YD < 0) {
                            YD = (-YD) | 0;
                        }
                    }
                    Xdir = XD;
                    YDir = YD;

                    X = (X + (Bridge.Int.mul(Xdir, (((Bridge.Int.div(SZ, 2)) | 0))))) | 0;
                    Y = (Y + (Bridge.Int.mul(YDir, (((Bridge.Int.div(SZ, 2)) | 0))))) | 0;

                    limit = (limit - 1) | 0;
                    CirnoGame.MapGenerator.pathMiner(game, X, Y, Xdir, YDir, limit);
                },
                Erase: function (TM, column, row, size) {
                    TM.ClearRect$1(((column - (((Bridge.Int.div(size, 2)) | 0))) | 0), ((row - (((Bridge.Int.div(size, 2)) | 0))) | 0), (size), (size));
                },
                EraseAndRando: function (TM, column, row, size) {
                    var SX = (column - (((Bridge.Int.div(size, 2)) | 0))) | 0;
                    var SY = (row - (((Bridge.Int.div(size, 2)) | 0))) | 0;
                    TM.ClearRect$1(SX, SY, (size), (size));
                    TM._GenRect(SX, SY, ((SX + (size)) | 0), ((SY + (size)) | 0));
                }
            }
        }
    });

    Bridge.define("CirnoGame.MapRoom", {
        statics: {
            fields: {
                PlacedRooms: null,
                OpenRooms: null,
                RNG: null
            },
            ctors: {
                init: function () {
                    this.PlacedRooms = new (System.Collections.Generic.List$1(CirnoGame.MapRoom)).ctor();
                    this.OpenRooms = new (System.Collections.Generic.List$1(CirnoGame.MapRoom)).ctor();
                    this.RNG = new System.Random.ctor();
                }
            },
            methods: {
                FindValidUnplacedRooms: function () {
                    var L = new (System.Collections.Generic.List$1(CirnoGame.MapRoom)).ctor();
                    var i = 0;
                    var ln = CirnoGame.MapRoom.OpenRooms.Count;
                    while (i < ln) {
                        var P = CirnoGame.MapRoom.OpenRooms.getItem(i);
                        L.addRange(System.Linq.Enumerable.from(P.ExitRooms).where(function (F) {
                                return F.CanBePlaced() && !F.placed;
                            }));
                        i = (i + 1) | 0;
                    }
                    return L;
                },
                FindRoom: function (V) {
                    var L = System.Linq.Enumerable.from(CirnoGame.MapRoom.OpenRooms).where(function (R) {
                            return R.ContainsPosition(V);
                        }).toArray(CirnoGame.MapRoom);
                    if (L.length > 0) {
                        return L[System.Array.index(0, L)];
                    }
                    return null;
                },
                FindAnyEmptySpot: function () {
                    if (CirnoGame.MapRoom.OpenRooms.Count < 1) {
                        return null;
                    }
                    var i = 0;
                    while (i < 10) {
                        var ret = CirnoGame.HelperExtensions.Pick(Bridge.global.CirnoGame.MapRoom, CirnoGame.MapRoom.OpenRooms, CirnoGame.MapRoom.RNG).FindEmptySpot();
                        if (CirnoGame.Vector2.op_Inequality(ret, null)) {
                            return ret;
                        }
                        i = (i + 1) | 0;
                    }
                    return null;
                }
            }
        },
        fields: {
            SX: 0,
            SY: 0,
            EX: 0,
            EY: 0,
            placed: false,
            secret: false,
            ExitRooms: null,
            parent: null,
            goldchests: null,
            game: null
        },
        ctors: {
            init: function () {
                this.placed = false;
                this.secret = false;
                this.ExitRooms = new (System.Collections.Generic.List$1(CirnoGame.MapRoom)).ctor();
                this.goldchests = System.Array.init(0, null, CirnoGame.Chest);
            }
        },
        methods: {
            IsValid: function () {
                var map = this.game.TM;
                if (this.SX >= 0 && this.SY >= 0 && this.EX < map.columns && this.EY < map.rows) {
                    //in bounds
                    return true;
                }
                return false;
            },
            CanBePlaced: function () {
                var map = this.game.TM;
                if (this.IsValid()) {
                    if (map.IsRectSolid(this.SX, this.SY, this.EX, this.EY)) {
                        return true;
                    }
                }
                return false;
            },
            GenerateAdjacentRooms: function () {
                var M = this.GenerateAdjacentRoom(-1, 0);
                if (M != null) {
                    this.ExitRooms.add(M);
                }
                M = this.GenerateAdjacentRoom(1, 0);
                if (M != null) {
                    this.ExitRooms.add(M);
                }
                if (Math.random() < 0.5) {
                    M = this.GenerateAdjacentRoom(0, -1);
                    if (M != null) {
                        this.ExitRooms.add(M);
                    }
                    M = this.GenerateAdjacentRoom(0, 1);
                    if (M != null) {
                        this.ExitRooms.add(M);
                    }
                }
            },
            GenerateAdjacentRoom: function (Xdir, Ydir) {
                /* var min = 6;
                var max = 18;*/
                var min = 5;
                var max = 13;
                var dif = (((max - min) | 0));
                var W = Bridge.Int.clip32(min + (Math.random() * dif));

                //min += 1;
                min = (min - 1) | 0;
                max = (max - 3) | 0;
                dif = (((max - min) | 0));
                var H = Bridge.Int.clip32(min + (Math.random() * dif));

                var X = -1;
                var Y = -1;
                if (Xdir !== 0) {
                    Y = Bridge.Int.clip32(this.SY + (Math.random() * (((this.EY - this.SY) | 0))));
                    if (Xdir < 0) {
                        X = (this.SX - W) | 0;
                    } else {
                        X = this.EX;
                    }
                } else if (Ydir !== 0) {
                    X = Bridge.Int.clip32(this.SX + Math.random() * ((((this.EX - this.SX) | 0))));
                    if (Ydir < 0) {
                        Y = (this.SY - H) | 0;
                    } else {
                        Y = this.EY;
                    }
                }

                if (X >= 0 && Y >= 0) {
                    var M = new CirnoGame.MapRoom();
                    M.SX = X;
                    M.SY = Y;
                    M.EX = (X + W) | 0;
                    M.EY = (Y + H) | 0;
                    M.parent = this;
                    M.game = this.game;
                    if (M.CanBePlaced()) {
                        return M;
                    }
                }
                return null;
            },
            ContainsTile: function (X, Y) {
                return X >= this.SX && Y >= this.SY && X < this.EX && Y < this.EY;
            },
            ContainsPosition: function (V) {
                var X = Bridge.Int.clip32((V.X - this.game.TM.position.X) / this.game.TM.tilesize);
                var Y = Bridge.Int.clip32((V.Y - this.game.TM.position.Y) / this.game.TM.tilesize);
                return X >= this.SX && Y >= this.SY && X < this.EX && Y < this.EY;
            },
            /**
             * clears out the room's area, and attempts to generate exitrooms.
             If the room is invalid it does nothing, and removes itself from it's parent list.
             *
             * @instance
             * @public
             * @this CirnoGame.MapRoom
             * @memberof CirnoGame.MapRoom
             * @return  {boolean}        returns true if it was valid and was placed.
             */
            PlaceAndExpand: function () {
                if (this.ExitRooms.Count < 1 && !this.placed && this.CanBePlaced()) {
                    this.Place();
                    if (this.placed) {
                        this.GenerateAdjacentRooms();
                    }
                    return this.placed;
                } else if (!this.placed) {
                    if (this.parent != null) {
                        if (CirnoGame.HelperExtensions.ContainsB$1(Bridge.global.CirnoGame.MapRoom, this.parent.ExitRooms, this)) {
                            this.parent.ExitRooms.remove(this);
                        }
                    }
                }
                return false;
            },
            GenerateGoldChests: function () {
                var locked = !CirnoGame.MapRoom.OpenRooms.contains(this);

                var V = this.FindEmptySpot();
                var chest = new CirnoGame.Chest(this.game);
                this.goldchests.push(chest);
                chest.ForceLocked = locked;
                chest.Position.CopyFrom(V);
                chest.Goldify();
                this.game.AddEntity(chest);

                var V2 = this.FindEmptySpot();
                var attempts = 0;
                while (Bridge.identity(attempts, (attempts = (attempts + 1) | 0)) < 5 && (CirnoGame.Vector2.op_Equality(V2, null) || Math.abs(V2.X - V.X) < 16)) {
                    V2 = this.FindEmptySpot();
                }

                if (CirnoGame.Vector2.op_Inequality(V2, null) && Math.abs(V2.X - V.X) > 16) {
                    chest = new CirnoGame.Chest(this.game);
                    this.goldchests.push(chest);
                    chest.Position.CopyFrom(V2);
                    chest.ForceLocked = locked;
                    chest.Goldify();
                    this.game.AddEntity(chest);
                }
            },
            NMakeSecret: function () {
                var TM = this.game.TM;
                var W = (this.EX - this.SX) | 0;
                var H = (this.EY - this.SY) | 0;
                //TM.FillRect(SX, SY, W, H);
                //ClearRoom();
                TM.DrawRect$1(this.SX, this.SY, W, H);
                TM.SetBreakableRect(this.SX, this.SY, W, H, false);
                TM.ClearRect$1(((this.SX + 1) | 0), ((this.SY + 1) | 0), ((W - 2) | 0), ((H - 2) | 0));

                if (CirnoGame.MapRoom.OpenRooms.contains(this)) {
                    CirnoGame.MapRoom.OpenRooms.remove(this);
                }
                this.secret = true;

                this.GenerateGoldChests();

                this.ForceRedraw();
            },
            MakeSecret: function () {
                var TM = this.game.TM;
                var W = (this.EX - this.SX) | 0;
                var H = (this.EY - this.SY) | 0;
                TM.FillRect(this.SX, this.SY, W, H);
                TM.SetBreakableRect(this.SX, this.SY, W, H, false);
                TM.SetBreakableRect(((this.SX + 1) | 0), ((this.SY + 1) | 0), ((W - 2) | 0), ((H - 2) | 0), true);
                if (CirnoGame.MapRoom.OpenRooms.contains(this)) {
                    CirnoGame.MapRoom.OpenRooms.remove(this);
                }
                this.secret = true;
            },
            NUnleashSecret: function () {
                var TM = this.game.TM;

                TM.ClearOuterRect(this.SX, this.SY, (((this.EX - this.SX) | 0)), (((this.EY - this.SY) | 0)), false);
                //TM.ClearRect(SX+1, SY+1, (EX - SX)-2, (EY - SY)-2);
                //TM._GenRect(SX, SY, EX, EY);

                CirnoGame.MapRoom.OpenRooms.add(this);
                CirnoGame.HelperExtensions.ForEach(Bridge.global.CirnoGame.Chest, this.goldchests, function (C) {
                    C.ForceLocked = false;
                });

                this.ForceRedraw();
            },
            UnleashSecret: function () {
                var TM = this.game.TM;

                TM.ClearRect$1(((this.SX + 1) | 0), ((this.SY + 1) | 0), (((((this.EX - this.SX) | 0)) - 2) | 0), (((((this.EY - this.SY) | 0)) - 2) | 0));
                TM._GenRect(this.SX, this.SY, this.EX, this.EY);

                CirnoGame.MapRoom.OpenRooms.add(this);

                this.GenerateGoldChests();
                this.ForceRedraw();
            },
            ClearRoom: function () {
                var TM = this.game.TM;

                TM.ClearRect$1(this.SX, this.SY, ((this.EX - this.SX) | 0), ((this.EY - this.SY) | 0));
            },
            GeneratePlatforms: function () {
                var TM = this.game.TM;
                TM._GenRect(this.SX, this.SY, this.EX, this.EY);
            },
            Place: function () {
                var TM = this.game.TM;
                TM.ClearRect$1(this.SX, this.SY, ((this.EX - this.SX) | 0), ((this.EY - this.SY) | 0));
                TM._GenRect(this.SX, this.SY, this.EX, this.EY);

                CirnoGame.MapRoom.PlacedRooms.add(this);
                CirnoGame.MapRoom.OpenRooms.add(this);
                this.placed = true;
            },
            ApplyBreakable: function () {
                var TM = this.game.TM;
                TM.ApplyBreakableRect(((this.SX - 2) | 0), ((this.SY - 2) | 0), (((((this.EX - this.SX) | 0)) + 4) | 0), (((((this.EY - this.SY) | 0)) + 4) | 0));
            },
            ForceRedraw: function () {
                var TM = this.game.TM;
                var X = (this.SX - 2) | 0;
                var Y = (this.SY - 2) | 0;
                var W = ((((this.EX - this.SX) | 0)) + 4) | 0;
                var H = ((((this.EY - this.SY) | 0)) + 4) | 0;
                TM.bg.clearRect(Bridge.Int.mul(Bridge.Int.clip32(TM.tilesize), X), Bridge.Int.mul(Bridge.Int.clip32(TM.tilesize), Y), Bridge.Int.mul(Bridge.Int.clip32(TM.tilesize), W), Bridge.Int.mul(Bridge.Int.clip32(TM.tilesize), H));

                TM.Redraw(TM.bg, X, Y, W, H);
            },
            FindEmptySpot: function () {
                var W = (this.EX - this.SX) | 0;
                var H = (this.EY - this.SY) | 0;
                var i = 0;
                var map = this.game.TM;
                while (i < 50) {
                    var X = Bridge.Int.clip32(this.SX + Math.random() * W);
                    var Y = Bridge.Int.clip32(this.SY + Math.random() * H);
                    var T = map.GetTile(X, Y);
                    if (T != null && (!T.enabled || !T.solid)) {
                        T = map.GetTile(X, ((Y - 1) | 0));
                        if (T != null && (!T.enabled || !T.solid)) {
                            return new CirnoGame.Vector2(map.position.X + (X * map.tilesize), map.position.Y + (Y * map.tilesize));
                        }
                    }
                    i = (i + 1) | 0;
                }
                return null;
            }
        }
    });

    Bridge.define("CirnoGame.MathHelper", {
        statics: {
            fields: {
                PI: 0,
                PI2: 0,
                PIOver2: 0
            },
            ctors: {
                init: function () {
                    this.PI = 3.14159274;
                    this.PI2 = 6.28318548;
                    this.PIOver2 = 1.57079637;
                }
            },
            methods: {
                DistanceBetweenPoints: function (A, B) {
                    return CirnoGame.MathHelper.DistanceBetweenPoints$1(A.X, A.Y, B.X, B.Y);
                },
                DistanceBetweenPoints$1: function (x1, y1, x2, y2) {
                    return Math.sqrt((Math.pow(x1 - x2, 2) + Math.pow(y1 - y2, 2)));
                },
                Clamp$1: function (value, min, max) {
                    return Math.min(max, Math.max(min, value));
                },
                Clamp: function (value, min, max) {
                    if (min === void 0) { min = 0.0; }
                    if (max === void 0) { max = 1.0; }
                    return Math.min(max, Math.max(min, value));
                },
                Lerp$1: function (value1, value2, amount) {
                    return value1 + ((value2 - value1) * amount);
                },
                Lerp: function (D1, D2, lerp) {
                    lerp = CirnoGame.MathHelper.Clamp(lerp);
                    return (D1 * (1 - lerp)) + (D2 * lerp);
                },
                DegreesToRadians: function (degrees) {
                    return degrees * 0.0174532924;
                },
                RadiansToDegrees: function (radians) {
                    return radians * 57.29578;
                },
                GetAngle$1: function (a, b) {
                    var angle = Math.atan2(b.Y - a.Y, b.X - a.X);
                    return angle;
                },
                GetAngle: function (a) {
                    var angle = Math.atan2(a.Y, a.X);
                    return angle;
                },
                RoughDistanceBetweenPoints: function (a, b) {
                    //return (float)(Math.Abs(a.x - b.x) + Math.Abs(a.y - b.y));
                    return (CirnoGame.Vector2.op_Subtraction(a, b)).RoughLength;
                },
                MagnitudeOfRectangle: function (R) {
                    return R.width + R.height;
                },
                WrapRadians: function (radian) {
                    while (radian < -3.14159274) {
                        radian += CirnoGame.MathHelper.PI2;
                    }
                    while (radian >= CirnoGame.MathHelper.PI) {
                        radian -= CirnoGame.MathHelper.PI2;
                    }
                    return radian;
                    //return radian % PI2;
                },
                incrementTowards: function (current, destination, speed) {
                    if (current < destination) {
                        current += speed;
                        if (current > destination) {
                            current = destination;
                        }
                    }
                    if (current > destination) {
                        current -= speed;
                        if (current < destination) {
                            current = destination;
                        }
                    }
                    return current;
                },
                incrementTowards$1: function (current, destination, incspeed, decspeed) {
                    if (current < destination) {
                        current += incspeed;
                        if (current > destination) {
                            current = destination;
                        }
                    }
                    if (current > destination) {
                        current -= decspeed;
                        if (current < destination) {
                            current = destination;
                        }
                    }
                    return current;
                },
                RadianToVector: function (radian) {
                    return new CirnoGame.Vector2(Math.cos(radian), Math.sin(radian));
                },
                Within: function (val, min, max) {
                    return val >= min && val <= max;
                },
                Mean: function (val) {
                    if (val === void 0) { val = []; }
                    var ret = 0;
                    var i = 0;
                    while (i < val.length) {
                        ret += val[System.Array.index(i, val)];
                        i = (i + 1) | 0;
                    }
                    ret /= val.length;
                    return ret;
                },
                Decelerate: function (momentum, deceleration) {
                    var dir = momentum >= 0;
                    momentum = (dir ? momentum : -momentum) - deceleration;
                    if (momentum < 0) {
                        return 0;
                    }
                    return dir ? momentum : -momentum;
                }
            }
        }
    });

    Bridge.define("CirnoGame.Point", {
        fields: {
            X: 0,
            Y: 0
        },
        ctors: {
            ctor: function (x, y) {
                if (x === void 0) { x = 0; }
                if (y === void 0) { y = 0; }

                this.$initialize();
                this.X = x;
                this.Y = y;
            }
        }
    });

    Bridge.define("CirnoGame.Rectangle", {
        statics: {
            methods: {
                op_Addition: function (A, B) {
                    return new CirnoGame.Rectangle(A.x + B.X, A.y + B.Y, A.width, A.height);
                },
                op_Subtraction: function (A, B) {
                    return new CirnoGame.Rectangle(A.x - B.X, A.y - B.Y, A.width, A.height);
                }
            }
        },
        fields: {
            x: 0,
            y: 0,
            width: 0,
            height: 0
        },
        props: {
            left: {
                get: function () {
                    return this.x;
                },
                set: function (value) {
                    this.x = value;
                }
            },
            top: {
                get: function () {
                    return this.y;
                },
                set: function (value) {
                    this.y = value;
                }
            },
            right: {
                get: function () {
                    return this.x + this.width;
                },
                set: function (value) {
                    this.width = value - this.x;
                }
            },
            bottom: {
                get: function () {
                    return this.y + this.height;
                },
                set: function (value) {
                    this.height = value - this.y;
                }
            },
            points: {
                get: function () {
                    var ret = System.Array.init(8, 0, System.Single);
                    var i = 0;
                    ret[System.Array.index(Bridge.identity(i, (i = (i + 1) | 0)), ret)] = this.x;
                    ret[System.Array.index(Bridge.identity(i, (i = (i + 1) | 0)), ret)] = this.y;

                    ret[System.Array.index(Bridge.identity(i, (i = (i + 1) | 0)), ret)] = this.right;
                    ret[System.Array.index(Bridge.identity(i, (i = (i + 1) | 0)), ret)] = this.y;

                    ret[System.Array.index(Bridge.identity(i, (i = (i + 1) | 0)), ret)] = this.right;
                    ret[System.Array.index(Bridge.identity(i, (i = (i + 1) | 0)), ret)] = this.bottom;

                    ret[System.Array.index(Bridge.identity(i, (i = (i + 1) | 0)), ret)] = this.x;
                    ret[System.Array.index(Bridge.identity(i, (i = (i + 1) | 0)), ret)] = this.bottom;

                    return ret;
                }
            },
            Center: {
                get: function () {
                    return new CirnoGame.Vector2(this.left + (this.width / 2), this.top + (this.height / 2));
                }
            },
            Min: {
                get: function () {
                    return new CirnoGame.Vector2(this.x, this.y);
                },
                set: function (value) {
                    if (CirnoGame.Vector2.op_Equality(value, null)) {
                        return;
                    }
                    this.x = value.X;
                    this.y = value.Y;
                }
            },
            Max: {
                get: function () {
                    return new CirnoGame.Vector2(this.right, this.bottom);
                },
                set: function (value) {
                    if (CirnoGame.Vector2.op_Equality(value, null)) {
                        return;
                    }
                    this.right = value.X;
                    this.bottom = value.Y;
                }
            }
        },
        ctors: {
            init: function () {
                this.x = 0;
                this.y = 0;
                this.width = 0;
                this.height = 0;
            },
            ctor: function (x, y, width, height) {
                if (x === void 0) { x = 0.0; }
                if (y === void 0) { y = 0.0; }
                if (width === void 0) { width = 0.0; }
                if (height === void 0) { height = 0.0; }

                this.$initialize();
                this.x = x;
                this.y = y;
                this.width = width;
                this.height = height;
            }
        },
        methods: {
            CopyFrom: function (R) {
                this.x = R.x;
                this.y = R.y;
                this.width = R.width;
                this.height = R.height;
            },
            GetCenter: function (OUT) {
                OUT.X = this.left + (this.width / 2);
                OUT.Y = this.top + (this.height / 2);
            },
            containsPoint$1: function (x, y) {
                if (x >= this.x && y >= this.y && x <= this.right && y <= this.bottom) {
                    return true;
                }
                return false;
            },
            containsPoint: function (point) {
                if (point.X >= this.x && point.Y >= this.y && point.X <= this.right && point.Y <= this.bottom) {
                    return true;
                }
                return false;
            },
            intersects: function (R) {
                var p = R.points;
                var contain = false;
                var outside = false;
                var i = 0;
                while (i < p.length) {
                    if (this.containsPoint$1(p[System.Array.index(Bridge.identity(i, (i = (i + 1) | 0)), p)], p[System.Array.index(Bridge.identity(i, (i = (i + 1) | 0)), p)])) {
                        contain = true;
                    } else {
                        outside = true;
                    }
                }
                if (contain && outside) {
                    return true;
                }
                if (R.left < this.left && R.right > this.right) {
                    //if ((top <= R.top && bottom <= R.top) || (top <= R.bottom && bottom <= R.bottom))
                    if ((this.top <= R.top && this.bottom >= R.top) || (this.top <= R.bottom && this.bottom >= R.bottom)) {
                        return true;
                    }
                }
                if (R.top < this.top && R.bottom > this.bottom) {
                    if ((this.left <= R.left && this.right >= R.left) || (this.left <= R.right && this.right >= R.right)) {
                        return true;
                    }
                }
                /* if (R.left < left && R.right > right)
                {
                   if ((top <= R.top && bottom <= R.top) || (top <= R.bottom && bottom <= R.bottom))
                   {
                       return true;
                   }
                }
                if (R.top < top && R.bottom > bottom)
                {
                   if ((left <= R.left && right <= R.left) || (left <= R.right && right <= R.right))
                   {
                       return true;
                   }
                }*/
                return false;
            },
            isTouching: function (R) {
                if (R == null) {
                    return false;
                }
                var p = R.points;
                var i = 0;
                while (i < p.length) {
                    if (this.containsPoint$1(p[System.Array.index(Bridge.identity(i, (i = (i + 1) | 0)), p)], p[System.Array.index(Bridge.identity(i, (i = (i + 1) | 0)), p)])) {
                        return true;
                    }
                }
                if (this.intersects(R)) {
                    return true;
                }
                /* if (R.left < left && R.right > right)
                {
                   if ((top<=R.top && bottom<=R.top) || (top <= R.bottom && bottom <= R.bottom))
                   {
                       return true;
                   }
                }
                if (R.top < top && R.bottom > bottom)
                {
                   if ((left <= R.left && right <= R.left) || (left <= R.right && right <= R.right))
                   {
                       return true;
                   }
                }*/
                return false;
            },
            Set: function (x, y, width, height) {
                if (x === void 0) { x = 0.0; }
                if (y === void 0) { y = 0.0; }
                if (width === void 0) { width = 0.0; }
                if (height === void 0) { height = 0.0; }
                this.x = x;
                this.y = y;
                this.width = width;
                this.height = height;
            }
        }
    });

    Bridge.define("CirnoGame.RectangleI", {
        statics: {
            methods: {
                op_Addition: function (A, B) {
                    return new CirnoGame.RectangleI(((A.x + B.X) | 0), ((A.y + B.Y) | 0), A.width, A.height);
                },
                op_Subtraction: function (A, B) {
                    return new CirnoGame.RectangleI(((A.x - B.X) | 0), ((A.y - B.Y) | 0), A.width, A.height);
                }
            }
        },
        fields: {
            x: 0,
            y: 0,
            width: 0,
            height: 0
        },
        props: {
            left: {
                get: function () {
                    return this.x;
                },
                set: function (value) {
                    this.x = value;
                }
            },
            top: {
                get: function () {
                    return this.y;
                },
                set: function (value) {
                    this.y = value;
                }
            },
            right: {
                get: function () {
                    return ((this.x + this.width) | 0);
                },
                set: function (value) {
                    this.width = (value - this.x) | 0;
                }
            },
            bottom: {
                get: function () {
                    return ((this.y + this.height) | 0);
                },
                set: function (value) {
                    this.height = (value - this.y) | 0;
                }
            },
            points: {
                get: function () {
                    var ret = System.Array.init(8, 0, System.Int32);
                    var i = 0;
                    ret[System.Array.index(Bridge.identity(i, (i = (i + 1) | 0)), ret)] = this.x;
                    ret[System.Array.index(Bridge.identity(i, (i = (i + 1) | 0)), ret)] = this.y;

                    ret[System.Array.index(Bridge.identity(i, (i = (i + 1) | 0)), ret)] = this.right;
                    ret[System.Array.index(Bridge.identity(i, (i = (i + 1) | 0)), ret)] = this.y;

                    ret[System.Array.index(Bridge.identity(i, (i = (i + 1) | 0)), ret)] = this.right;
                    ret[System.Array.index(Bridge.identity(i, (i = (i + 1) | 0)), ret)] = this.bottom;

                    ret[System.Array.index(Bridge.identity(i, (i = (i + 1) | 0)), ret)] = this.x;
                    ret[System.Array.index(Bridge.identity(i, (i = (i + 1) | 0)), ret)] = this.bottom;

                    return ret;
                }
            },
            Center: {
                get: function () {
                    return new CirnoGame.Point(((this.left + (((Bridge.Int.div(this.width, 2)) | 0))) | 0), ((this.top + (((Bridge.Int.div(this.height, 2)) | 0))) | 0));
                }
            },
            Min: {
                get: function () {
                    return new CirnoGame.Point(this.x, this.y);
                },
                set: function (value) {
                    if (value == null) {
                        return;
                    }
                    this.x = value.X;
                    this.y = value.Y;
                }
            },
            Max: {
                get: function () {
                    return new CirnoGame.Point(this.right, this.bottom);
                },
                set: function (value) {
                    if (value == null) {
                        return;
                    }
                    this.right = value.X;
                    this.bottom = value.Y;
                }
            }
        },
        ctors: {
            init: function () {
                this.x = 0;
                this.y = 0;
                this.width = 0;
                this.height = 0;
            },
            ctor: function (x, y, width, height) {
                if (x === void 0) { x = 0; }
                if (y === void 0) { y = 0; }
                if (width === void 0) { width = 0; }
                if (height === void 0) { height = 0; }

                this.$initialize();
                this.x = x;
                this.y = y;
                this.width = width;
                this.height = height;
            }
        },
        methods: {
            containsPoint$1: function (x, y) {
                if (x >= this.x && y >= this.y && x <= this.right && y <= this.bottom) {
                    return true;
                }
                return false;
            },
            containsPoint: function (point) {
                if (point.X >= this.x && point.Y >= this.y && point.X <= this.right && point.Y <= this.bottom) {
                    return true;
                }
                return false;
            },
            intersects: function (R) {
                var p = R.points;
                var contain = false;
                var outside = false;
                var i = 0;
                while (i < p.length) {
                    if (this.containsPoint$1(p[System.Array.index(Bridge.identity(i, (i = (i + 1) | 0)), p)], p[System.Array.index(Bridge.identity(i, (i = (i + 1) | 0)), p)])) {
                        contain = true;
                    } else {
                        outside = true;
                    }
                }
                if (contain && outside) {
                    return true;
                }
                if (R.left < this.left && R.right > this.right) {
                    //if ((top <= R.top && bottom <= R.top) || (top <= R.bottom && bottom <= R.bottom))
                    if ((this.top <= R.top && this.bottom >= R.top) || (this.top <= R.bottom && this.bottom >= R.bottom)) {
                        return true;
                    }
                }
                if (R.top < this.top && R.bottom > this.bottom) {
                    if ((this.left <= R.left && this.right >= R.left) || (this.left <= R.right && this.right >= R.right)) {
                        return true;
                    }
                }
                /* if (R.left < left && R.right > right)
                {
                   if ((top <= R.top && bottom <= R.top) || (top <= R.bottom && bottom <= R.bottom))
                   {
                       return true;
                   }
                }
                if (R.top < top && R.bottom > bottom)
                {
                   if ((left <= R.left && right <= R.left) || (left <= R.right && right <= R.right))
                   {
                       return true;
                   }
                }*/
                return false;
            },
            isTouching: function (R) {
                if (R == null) {
                    return false;
                }
                var p = R.points;
                var i = 0;
                while (i < p.length) {
                    if (this.containsPoint$1(p[System.Array.index(Bridge.identity(i, (i = (i + 1) | 0)), p)], p[System.Array.index(Bridge.identity(i, (i = (i + 1) | 0)), p)])) {
                        return true;
                    }
                }
                if (this.intersects(R)) {
                    return true;
                }
                return false;
            }
        }
    });

    Bridge.define("CirnoGame.Renderer", {
        fields: {
            view: null
        },
        ctors: {
            ctor: function (width, height, backgroundColor) {
                if (width === void 0) { width = 800; }
                if (height === void 0) { height = 600; }
                if (backgroundColor === void 0) { backgroundColor = 1087931; }

                this.$initialize();
                /* var width = 800;
                var height = 600;
                var backgroundColor = 0x1099bb;*/
                this.view = new PIXI.Application(width, height, {backgroundColor : backgroundColor});
            }
        }
    });

    Bridge.define("CirnoGame.TileData", {
        fields: {
            texture: 0,
            row: 0,
            column: 0,
            enabled: false,
            map: null,
            visible: false,
            topSolid: false,
            rightSolid: false,
            leftSolid: false,
            bottomSolid: false,
            CanSlope: false,
            Breakable: false,
            HP: 0,
            maxHP: 0,
            opaque: false,
            _hitbox: null,
            SteppedOn: null,
            HR: null
        },
        props: {
            solid: {
                get: function () {
                    return this.topSolid && this.rightSolid && this.leftSolid && this.bottomSolid;
                },
                set: function (value) {
                    this.topSolid = value;
                    this.leftSolid = value;
                    this.rightSolid = value;
                    this.bottomSolid = value;
                }
            },
            platform: {
                get: function () {
                    return this.topSolid && !this.rightSolid && !this.leftSolid && !this.bottomSolid;
                }
            },
            IsSlope: {
                get: function () {
                    return this.SlopeDirection !== 0;
                }
            },
            SlopeDirection: {
                get: function () {
                    if (!this.CanSlope) {
                        return 0;
                    }
                    var Bottom = this.GetTileData(0, 1);
                    if (!(Bottom != null && Bottom.enabled && Bottom.solid)) {
                        return 0;
                    }
                    var Left = this.GetTileData(-1, 0);
                    var Right = this.GetTileData(1, 0);
                    var Lsolid = Left != null && Left.enabled && Left.solid;
                    var Rsolid = Right != null && Right.enabled && Right.solid;
                    if (!this.CanSlope || !this.solid || (Lsolid && Rsolid) || (!Rsolid && !Lsolid)) {
                        return 0;
                    }
                    var Top = this.GetTileData(0, -1);
                    var Tsolid = Top != null && Top.enabled && Top.solid;
                    if (Tsolid) {
                        return 0;
                    }
                    if (Rsolid) {
                        return 1;
                    } else {
                        return -1;
                    }
                }
            }
        },
        ctors: {
            init: function () {
                this.Breakable = false;
                this.HP = 4;
                this.maxHP = 4;
                this.opaque = true;
                this.HR = new CirnoGame.Rectangle();
            }
        },
        methods: {
            Clone: function () {
                var T = new CirnoGame.TileData();
                T.texture = this.texture;
                T.enabled = this.enabled;
                T.map = this.map;
                T.visible = this.visible;
                T.topSolid = this.topSolid;
                T.rightSolid = this.rightSolid;
                T.leftSolid = this.leftSolid;
                T.bottomSolid = this.bottomSolid;
                T.CanSlope = this.CanSlope;
                return T;
            },
            Damage: function (damage) {
                this.HP -= damage;
                if (this.HP <= 0 && this.topSolid) {
                    this.solid = false;
                    this.visible = false;
                    this.enabled = false;
                    /* enabled = true;
                    visible = true;
                    texture = 2;*/
                    /* map.ForceRedraw();*/
                    this.UpdateTile();
                    this.SpawnParticles();
                    return true;
                } else {
                    this.map.RedrawTile(this.column, this.row, false);
                    return false;
                }
            },
            UpdateTile: function () {
                this.map.RedrawTile(this.column, this.row);
            },
            SpawnParticles: function () {
                var tx = Bridge.Int.clip32(CirnoGame.MathHelper.Clamp$1(this.texture, 0, ((this.map.tiles.Count - 1) | 0)));
                var T = this.map.tiles.getItem(tx);

                var sz = Bridge.Int.clip32(this.map.tilesize / 2);
                var G = this.map.game;
                var HB = this.GetHitbox();
                //var spd = 1.5f;
                var spd = 1;


                var C = document.createElement("canvas");
                C.width = sz;
                C.height = sz;
                var g = CirnoGame.Helper.GetContext(C);

                g.drawImage(T, 0, 0, sz, sz, 0, 0, sz, sz);
                var P = new CirnoGame.Particle(G, C);
                P.Hspeed = (-spd) | 0;
                P.Vspeed = (-spd) | 0;
                P.x = HB.left;
                P.y = HB.top;
                G.AddEntity(P);

                //
                C = document.createElement("canvas");
                C.width = sz;
                C.height = sz;
                g = CirnoGame.Helper.GetContext(C);

                g.drawImage(T, sz, 0, sz, sz, 0, 0, sz, sz);
                P = new CirnoGame.Particle(G, C);
                P.Hspeed = spd;
                P.Vspeed = (-spd) | 0;
                P.x = HB.left + sz;
                P.y = HB.top;
                G.AddEntity(P);

                //
                C = document.createElement("canvas");
                C.width = sz;
                C.height = sz;
                g = CirnoGame.Helper.GetContext(C);

                g.drawImage(T, 0, sz, sz, sz, 0, 0, sz, sz);
                P = new CirnoGame.Particle(G, C);
                P.Hspeed = (-spd) | 0;
                P.Vspeed = spd;
                P.x = HB.left;
                P.y = HB.top + sz;
                G.AddEntity(P);

                //
                C = document.createElement("canvas");
                C.width = sz;
                C.height = sz;
                g = CirnoGame.Helper.GetContext(C);

                g.drawImage(T, sz, sz, sz, sz, 0, 0, sz, sz);
                P = new CirnoGame.Particle(G, C);
                P.Hspeed = spd;
                P.Vspeed = spd;
                P.x = HB.left + sz;
                P.y = HB.top + sz;
                G.AddEntity(P);
            },
            GetHitbox: function () {
                /* if (_hitbox == null)
                {
                   var tsz = map.tilesize;
                   var pos = map.position;
                   _hitbox = new Rectangle(pos.X + (column * tsz), pos.Y + (row * tsz), tsz, tsz);
                }*/
                var tsz = this.map.tilesize;
                var pos = this.map.position;
                this.HR.Set(pos.X + (this.column * tsz), pos.Y + (this.row * tsz), tsz, tsz);
                return this.HR;
                //return new Rectangle(pos.X + (column * tsz), pos.Y + (row * tsz), tsz, tsz);
                //return _hitbox;
            },
            GetHitbox2: function (OUT) {
                /* if (_hitbox == null)
                {
                   var tsz = map.tilesize;
                   var pos = map.position;
                   _hitbox = new Rectangle(pos.X + (column * tsz), pos.Y + (row * tsz), tsz, tsz);
                }*/
                var tsz = this.map.tilesize;
                var pos = this.map.position;
                OUT.x = pos.X + (this.column * tsz);
                OUT.y = pos.Y + (this.row * tsz);
                OUT.width = tsz;
                OUT.height = tsz;
                //return _hitbox;
            },
            GetTileData: function (relativeX, relativeY) {
                return this.map.GetTile(((this.column + relativeX) | 0), ((this.row + relativeY) | 0));
            },
            solidToSpeed: function (angle) {
                if (!this.enabled) {
                    return false;
                }
                if (angle.RoughLength === 0) {
                    return this.solid;
                } else {
                    if ((angle.X > 0 && this.leftSolid) || (angle.X < 0 && this.rightSolid) || (angle.Y > 0 && this.topSolid) || (angle.Y > 0 && this.bottomSolid)) {
                        return true;
                    }
                }
                return false;
            },
            GetTop: function (position) {

                /* TileData Left = GetTileData(-1, 0);
                TileData Right = GetTileData(1, 0);
                bool Lsolid = Left != null && Left.enabled && Left.solid;
                bool Rsolid = Right != null && Right.enabled && Right.solid;*/
                var direction = this.SlopeDirection;
                //if (!CanSlope || !solid || (Lsolid && Rsolid))
                var tsz = this.map.tilesize;
                if (direction === 0) {
                    //return R.top;

                    var pos = this.map.position;
                    return pos.Y + (this.row * tsz);
                } else {
                    var R = this.GetHitbox();
                    var Y = ((R.right - position.X) / R.width) * tsz;
                    if (direction > 0) {
                        Y = (tsz - Y);
                    }
                    //Y *= 1.0f;
                    Y = Math.min(tsz, Math.max(0, Y));
                    return R.bottom - Y;
                    //return (float)Math.Min(R.top, Math.Max(R.bottom,((R.right - position.X) / R.width) * R.height));
                }
            }
        }
    });

    Bridge.define("CirnoGame.TileMap", {
        fields: {
            position: null,
            tilesize: 0,
            rows: 0,
            columns: 0,
            data: null,
            tiles: null,
            cracks: null,
            game: null,
            buffer: null,
            bg: null,
            RND: null,
            Seed: 0,
            needRedraw: false,
            AllowSkyBridge: false,
            rtmp: null
        },
        ctors: {
            init: function () {
                this.Seed = 0;
                this.AllowSkyBridge = false;
                this.rtmp = new CirnoGame.Rectangle();
            },
            ctor: function (game, Seed) {
                if (Seed === void 0) { Seed = -1; }

                this.$initialize();
                this.RND = new System.Random.ctor();
                //position = new Vector2(-576);
                this.position = new CirnoGame.Vector2();
                //tilesize = 48;
                this.tilesize = 16;
                //rows = 16;
                /* columns = 52;*/
                this.rows = Bridge.Int.clip32(Math.ceil(((-this.position.Y * 2) + game.stageBounds.bottom) / this.tilesize));
                this.columns = Bridge.Int.clip32(Math.ceil(((-this.position.X * 2) + game.stageBounds.right) / this.tilesize));
                this.data = System.Array.create(null, null, CirnoGame.TileData, this.columns, this.rows);
                this.tiles = CirnoGame.AnimationLoader.Get("images/land/brick");
                this.cracks = CirnoGame.AnimationLoader.Get("images/land/cracks");
                this.game = game;

                this.buffer = document.createElement("canvas");
                this.bg = this.buffer.getContext("2d");
                if (Seed < 0) {
                    this.Seed = this.RND.next();
                } else {
                    this.Seed = Seed;
                }
                //Randomize();
                this.Generate();
            }
        },
        methods: {
            /**
             * returns true if the rectangle has no empty spaces.
             *
             * @instance
             * @public
             * @this CirnoGame.TileMap
             * @memberof CirnoGame.TileMap
             * @param   {number}     sX    
             * @param   {number}     sY    
             * @param   {number}     eX    
             * @param   {number}     eY
             * @return  {boolean}
             */
            IsRectSolid: function (sX, sY, eX, eY) {
                var X = sX;
                var Y = sY;
                while (Y < eY) {
                    X = sY;
                    while (X < eX) {
                        var T = this.data.get([X, Y]);
                        if (!(T.enabled && T.topSolid)) {
                            return false;
                        }
                        X = (X + 1) | 0;
                    }
                    Y = (Y + 1) | 0;
                }
                return true;
            },
            ForceRedraw: function () {
                this.needRedraw = true;
            },
            Randomize: function () {
                var row = 0;
                var column = 0;
                while (row < this.rows) {
                    while (column < this.columns) {
                        var T = new CirnoGame.TileData();
                        T.row = row;
                        T.column = column;
                        T.texture = 1;
                        //T.enabled = (Math.Random() < 0.15) || (row>=rows-1);
                        T.enabled = (this.RND.nextDouble() < 0.15) || (row >= ((this.rows - 1) | 0));
                        T.topSolid = T.enabled;
                        if (T.enabled && (row >= ((this.rows - 1) | 0))) {
                            T.texture = 2;
                            T.solid = true;
                        } else if (T.enabled) {
                            if (this.RND.nextDouble() < 0.3) {
                                T.solid = true;
                                T.texture = 0;
                                if (this.RND.nextDouble() < 0.5) {
                                    T.texture = 3;
                                }
                            }
                        }
                        T.visible = T.enabled;
                        T.map = this;
                        this.data.set([column, row], T);
                        column = (column + 1) | 0;
                    }
                    column = 0;
                    row = (row + 1) | 0;
                }
            },
            Generate: function () {
                this.RND = new System.Random.$ctor1(this.Seed);
                //Randomize();
                this._Gen();
                this.needRedraw = true;
            },
            _Gen: function () {
                var heightmap = System.Array.init(this.columns, 0, System.Int32);
                //float entropy = 0.8f;
                //float entropy = 0.45f;
                var entropy = 0.6;
                var max = Bridge.Int.clip32(this.rows * entropy);
                //int smoothnessSize = 12;
                var smoothnessSize = 8;
                var smoothnessStrength = 2;

                var X = 0;
                //randomizes the heightmap
                while (X < this.columns) {
                    heightmap[System.Array.index(X, heightmap)] = Bridge.Int.clip32(this.RND.nextDouble() * max);
                    X = (X + 1) | 0;
                }
                var s = 0;
                while (s < smoothnessStrength) {
                    var oheightmap = heightmap;
                    heightmap = System.Array.init(this.columns, 0, System.Int32);
                    X = 0;
                    while (X < this.columns) {
                        heightmap[System.Array.index(X, heightmap)] = this.blur(oheightmap, X, smoothnessSize);
                        X = (X + 1) | 0;
                    }

                    X = 1;
                    s = (s + 1) | 0;
                }
                //removes bumps from heightmap
                while (X < ((this.columns - 1) | 0)) {
                    var A = heightmap[System.Array.index(((X - 1) | 0), heightmap)];
                    var B = heightmap[System.Array.index(((X + 1) | 0), heightmap)];

                    var H = heightmap[System.Array.index(X, heightmap)];
                    //if (A == B && Math.Abs(A- H)==1)
                    if ((A > H) === (B > H) && H !== A) {
                        heightmap[System.Array.index(X, heightmap)] = (Bridge.Int.div((((A + B) | 0)), 2)) | 0;
                    }
                    X = (X + 1) | 0;
                }



                var row = 0;
                var column = 0;
                var LT = null;
                var bridgeChance = 0.9;
                var RNDbridge = 0;
                while (row < this.rows) {
                    while (column < this.columns) {
                        var H1 = (this.rows - heightmap[System.Array.index(column, heightmap)]) | 0;
                        var fill = row >= H1;
                        var T = new CirnoGame.TileData();
                        T.row = row;
                        T.column = column;
                        T.texture = 1;
                        //T.enabled = (Math.Random() < 0.15) || (row >= rows - 1);
                        T.enabled = (fill) || (row >= ((this.rows - 1) | 0));
                        T.topSolid = T.enabled;
                        T.bottomSolid = T.enabled;
                        if (T.enabled && (row >= ((this.rows - 1) | 0))) {
                            T.texture = 2;
                            T.solid = true;
                        } else if (T.enabled) {
                            //if (Math.Random() < 0.3)
                            {
                                T.solid = true;
                                T.texture = 4;
                                T.CanSlope = true;
                                if (this.RND.nextDouble() < 0.5) {
                                    T.texture = 5;
                                }
                                if (row > H1 && this.RND.nextDouble() < 0.02) {
                                    T.texture = 6;
                                }
                            }
                        }
                        if (!T.enabled) {
                            if ((this.AllowSkyBridge && row === 20 && this.RND.nextDouble() < 0.93) || (((row + 4) | 0) >= H1 && ((row + 2) | 0) < H1 && this.RND.nextDouble() < 0.025) || (LT != null && LT.enabled && LT.texture === 1 && this.RND.nextDouble() < bridgeChance)) {
                                T.enabled = true;
                                T.topSolid = T.enabled;
                                bridgeChance -= 0.075;
                            } else {
                                if (RNDbridge < 1 && this.RND.nextDouble() < 0.015) {
                                    RNDbridge = this.RND.next$1(8);
                                }
                                if (RNDbridge > 0) {
                                    T.enabled = true;
                                    T.topSolid = T.enabled;
                                    RNDbridge = (RNDbridge - 1) | 0;
                                    //}else if (RND.NextDouble() < 0.025)
                                } else if (this.RND.nextDouble() < 0.035) {
                                    T.enabled = true;
                                    T.topSolid = T.enabled;
                                } else if (true) {
                                    T.enabled = true;
                                    T.topSolid = T.enabled;
                                    T.CanSlope = Math.random() < 0.5;
                                }
                            }
                        }
                        if (!T.enabled || T.texture !== 1) {
                            bridgeChance = 0.9;
                        }
                        T.visible = T.enabled;
                        T.map = this;
                        T.solid = true;
                        this.data.set([column, row], T);
                        LT = T;
                        column = (column + 1) | 0;
                    }
                    column = 0;
                    row = (row + 1) | 0;
                }
            },
            _GenRect: function (SX, SY, EX, EY) {
                SX = Bridge.Int.clip32(CirnoGame.MathHelper.Clamp$1(SX, 0, ((this.columns - 1) | 0)));
                SY = Bridge.Int.clip32(CirnoGame.MathHelper.Clamp$1(SY, 0, ((this.rows - 1) | 0)));
                EX = Bridge.Int.clip32(CirnoGame.MathHelper.Clamp$1(EX, 0, ((this.columns - 1) | 0)));
                EY = Bridge.Int.clip32(CirnoGame.MathHelper.Clamp$1(EY, 0, ((this.rows - 1) | 0)));

                //float entropy = 0.8f;
                //float entropy = 0.45f;
                //float entropy = 0.60f;
                //int smoothnessSize = 12;

                var X = 0;



                var row = SY;
                var column = SX;
                var LT = null;
                //float bridgeChance = 0.90f;
                var RNDbridge = 0;

                while (row < EY) {
                    while (column < EX) {
                        var fill = false;
                        var T = new CirnoGame.TileData();
                        T.row = row;
                        T.column = column;
                        T.texture = 1;
                        //T.enabled = (Math.Random() < 0.15) || (row >= rows - 1);
                        T.enabled = (fill) || (row >= ((this.rows - 1) | 0));
                        T.topSolid = T.enabled;
                        T.bottomSolid = T.enabled;
                        /* if (T.enabled && (row >= rows - 1))
                        {
                           T.texture = 2;
                           T.solid = true;
                        }
                        else if (T.enabled)
                        {
                           //if (Math.Random() < 0.3)
                           {
                               T.solid = true;
                               T.texture = 4;
                               T.CanSlope = true;
                               if (RND.NextDouble() < 0.5)
                               {
                                   T.texture = 5;
                               }
                               if (false && RND.NextDouble() < 0.02)
                               {
                                   T.texture = 6;
                               }
                           }
                        }*/
                        if (!T.enabled) {
                            /* if ((AllowSkyBridge && row == 20 && RND.NextDouble() < 0.93) || (false && false && RND.NextDouble() < 0.025) || (LT != null && LT.enabled && LT.texture == 1 && RND.NextDouble() < bridgeChance))
                            {
                               T.enabled = true;
                               T.topSolid = T.enabled;
                               bridgeChance -= 0.075f;
                            }
                            else*/
                            {
                                if (RNDbridge < 1 && this.RND.nextDouble() < 0.03) {
                                    //RNDbridge = RND.Next(8);
                                    RNDbridge = (2 + this.RND.next$1(4)) | 0;
                                    /* if (Math.Random() < 0.9)
                                    {
                                       RNDbridge += 1;
                                    }*/
                                }
                                if (RNDbridge > 0) {
                                    T.enabled = true;
                                    T.topSolid = T.enabled;
                                    T.CanSlope = true;
                                    RNDbridge = (RNDbridge - 1) | 0;
                                    //}else if (RND.NextDouble() < 0.025)
                                } else if (this.RND.nextDouble() < 0.03) {
                                    T.enabled = true;
                                    T.topSolid = T.enabled;
                                    T.CanSlope = true;
                                }

                            }
                        }
                        /* if (!T.enabled || T.texture != 1)
                        {
                           bridgeChance = 0.90f;
                        }*/
                        T.visible = T.enabled;
                        T.map = this;
                        T.solid = true;
                        this.data.set([column, row], T);
                        LT = T;
                        column = (column + 1) | 0;
                    }
                    column = SX;
                    row = (row + 1) | 0;
                }
            },
            SetBreakableRect: function (column, row, Width, Height, breakable) {
                var SX = column;
                var SY = row;
                var EX = ((SX + Width) | 0);
                var EY = ((SY + Height) | 0);
                SX = Bridge.Int.clip32(CirnoGame.MathHelper.Clamp$1(SX, 0, ((this.columns - 1) | 0)));
                SY = Bridge.Int.clip32(CirnoGame.MathHelper.Clamp$1(SY, 0, ((this.rows - 1) | 0)));
                EX = Bridge.Int.clip32(CirnoGame.MathHelper.Clamp$1(EX, 0, ((this.columns - 1) | 0)));
                EY = Bridge.Int.clip32(CirnoGame.MathHelper.Clamp$1(EY, 0, ((this.rows - 1) | 0)));
                var X = SX;
                var Y = SY;
                var T = new CirnoGame.TileData();
                T.row = Y;
                T.column = X;
                T.texture = 1;
                T.enabled = true;
                T.visible = true;
                T.map = this;
                T.solid = true;
                if (breakable) {
                    T.texture = 1;
                    if (Math.random() < 0.02) {
                        T.texture = Math.random() < 0.5 ? 5 : 6;
                    }
                    T.Breakable = true;
                } else {
                    T.texture = 0;
                    T.Breakable = false;
                }
                while (Y < EY) {
                    X = SX;
                    while (X < EX) {
                        /* var TT = T.Clone();
                        TT.column = X;
                        TT.row = Y;
                        data[X, Y] = TT;*/
                        var TT = this.data.get([X, Y]);
                        if (TT == null) {
                            TT = T.Clone();
                        }
                        if (T.solid) {
                            TT.texture = T.texture;
                            TT.Breakable = T.Breakable;
                        }
                        X = (X + 1) | 0;
                    }
                    Y = (Y + 1) | 0;
                }
            },
            FillRect: function (column, row, Width, Height) {
                var SX = column;
                var SY = row;
                var EX = ((SX + Width) | 0);
                var EY = ((SY + Height) | 0);
                SX = Bridge.Int.clip32(CirnoGame.MathHelper.Clamp$1(SX, 0, ((this.columns - 1) | 0)));
                SY = Bridge.Int.clip32(CirnoGame.MathHelper.Clamp$1(SY, 0, ((this.rows - 1) | 0)));
                EX = Bridge.Int.clip32(CirnoGame.MathHelper.Clamp$1(EX, 0, ((this.columns - 1) | 0)));
                EY = Bridge.Int.clip32(CirnoGame.MathHelper.Clamp$1(EY, 0, ((this.rows - 1) | 0)));
                var X = SX;
                var Y = SY;
                var T = new CirnoGame.TileData();
                T.row = Y;
                T.column = X;
                T.texture = 1;
                T.enabled = true;
                T.visible = true;
                T.map = this;
                T.solid = true;
                while (Y < EY) {
                    X = SX;
                    while (X < EX) {
                        var TT = T.Clone();
                        TT.column = X;
                        TT.row = Y;
                        this.data.set([X, Y], TT);
                        X = (X + 1) | 0;
                    }
                    Y = (Y + 1) | 0;
                }
            },
            DrawRect$1: function (column, row, Width, Height) {
                var X = column;
                var Y = row;
                var TX = X;
                var TY = Y;
                var EX = (X + Width) | 0;
                var EY = (Y + Height) | 0;

                while (TX < EX) {
                    var T = new CirnoGame.TileData();
                    T.row = TY;
                    T.column = TX;
                    T.texture = 1;
                    T.enabled = true;
                    T.visible = true;
                    T.map = this;
                    T.solid = true;
                    this.SetTile(TX, TY, T);
                    TX = (TX + 1) | 0;
                }
                TX = X;
                TY = EY;
                while (TX < EX) {
                    var T1 = new CirnoGame.TileData();
                    T1.row = TY;
                    T1.column = TX;
                    T1.texture = 1;
                    T1.enabled = true;
                    T1.visible = true;
                    T1.map = this;
                    T1.solid = true;
                    this.SetTile(TX, TY, T1);
                    TX = (TX + 1) | 0;
                }

                TX = X;
                TY = Y;
                while (TY < EY) {
                    var T2 = new CirnoGame.TileData();
                    T2.row = TY;
                    T2.column = TX;
                    T2.texture = 1;
                    T2.enabled = true;
                    T2.visible = true;
                    T2.map = this;
                    T2.solid = true;
                    this.SetTile(TX, TY, T2);
                    TY = (TY + 1) | 0;
                }
                TX = EX;
                TY = Y;
                while (TY < EY) {
                    var T3 = new CirnoGame.TileData();
                    T3.row = TY;
                    T3.column = TX;
                    T3.texture = 1;
                    T3.enabled = true;
                    T3.visible = true;
                    T3.map = this;
                    T3.solid = true;
                    this.SetTile(TX, TY, T3);
                    TY = (TY + 1) | 0;
                }
            },
            DrawRect: function (rect) {
                /* var PX = (int)((position.X - TP.X) / tilesize);
                var PY = (int)((position.Y - TP.Y) / tilesize);*/
                this.DrawRect$1(Bridge.Int.clip32(rect.left / this.tilesize), Bridge.Int.clip32(rect.top / this.tilesize), Bridge.Int.clip32(rect.width / this.tilesize), Bridge.Int.clip32(rect.height / this.tilesize));
            },
            SetAll: function (T) {
                var X = 0;
                var Y = 0;
                while (Y < this.rows) {
                    X = 0;
                    while (X < this.columns) {
                        var TD = T.Clone();
                        TD.column = X;
                        TD.row = Y;
                        this.data.set([X, Y], T);
                        X = (X + 1) | 0;
                    }
                    Y = (Y + 1) | 0;
                }
            },
            ClearOuterRect: function (column, row, width, height, bottom) {
                if (bottom === void 0) { bottom = true; }
                var SX = column;
                var SY = row;
                var EX = ((SX + width) | 0);
                var EY = ((SY + height) | 0);
                SX = Bridge.Int.clip32(CirnoGame.MathHelper.Clamp$1(SX, 0, ((this.columns - 1) | 0)));
                SY = Bridge.Int.clip32(CirnoGame.MathHelper.Clamp$1(SY, 0, ((this.rows - 1) | 0)));
                EX = Bridge.Int.clip32(CirnoGame.MathHelper.Clamp$1(EX, 0, ((this.columns - 1) | 0)));
                EY = Bridge.Int.clip32(CirnoGame.MathHelper.Clamp$1(EY, 0, ((this.rows - 1) | 0)));
                var X = SX;
                var Y = SY;
                var T = new CirnoGame.TileData();
                T.map = this;
                T.visible = false;
                T.solid = false;
                var TX = X;
                var TY = Y;
                while (TX < ((EX - 1) | 0)) {
                    var TT = T.Clone();
                    TT.column = TX;
                    TT.row = TY;
                    this.SetTile(TX, TY, TT);
                    TX = (TX + 1) | 0;
                }
                TX = X;
                TY = EY;
                if (bottom) {
                    while (TX < EX) {
                        var TT1 = T.Clone();
                        TT1.column = TX;
                        TT1.row = TY;
                        this.SetTile(TX, TY, TT1);
                        TX = (TX + 1) | 0;
                    }
                }

                TX = X;
                TY = Y;
                while (TY < ((EY - 1) | 0)) {
                    var TT2 = T.Clone();
                    TT2.column = TX;
                    TT2.row = TY;
                    this.SetTile(TX, TY, TT2);
                    TY = (TY + 1) | 0;
                }
                TX = EX;
                TY = Y;
                while (TY < ((EY - 1) | 0)) {
                    var TT3 = T.Clone();
                    TT3.column = TX;
                    TT3.row = TY;
                    this.SetTile(TX, TY, TT3);
                    TY = (TY + 1) | 0;
                }
            },
            ClearRect$1: function (column, row, width, height) {
                var SX = column;
                var SY = row;
                var EX = ((SX + width) | 0);
                var EY = ((SY + height) | 0);
                SX = Bridge.Int.clip32(CirnoGame.MathHelper.Clamp$1(SX, 0, ((this.columns - 1) | 0)));
                SY = Bridge.Int.clip32(CirnoGame.MathHelper.Clamp$1(SY, 0, ((this.rows - 1) | 0)));
                EX = Bridge.Int.clip32(CirnoGame.MathHelper.Clamp$1(EX, 0, ((this.columns - 1) | 0)));
                EY = Bridge.Int.clip32(CirnoGame.MathHelper.Clamp$1(EY, 0, ((this.rows - 1) | 0)));
                var X = SX;
                var Y = SY;
                var T = new CirnoGame.TileData();
                T.map = this;
                T.visible = false;
                T.solid = false;
                T.enabled = false;
                while (Y < EY) {
                    X = SX;
                    while (X < EX) {
                        var TT = T.Clone();
                        TT.column = X;
                        TT.row = Y;
                        this.data.set([X, Y], TT);
                        X = (X + 1) | 0;
                    }
                    Y = (Y + 1) | 0;
                }
            },
            ClearRect: function (rect) {
                var SX = Bridge.Int.clip32(rect.left / this.tilesize);
                var SY = Bridge.Int.clip32(rect.top / this.tilesize);
                var EX = Bridge.Int.clip32(rect.right / this.tilesize);
                var EY = Bridge.Int.clip32(rect.height / this.tilesize);
                var X = SX;
                var Y = SY;
                var T = new CirnoGame.TileData();
                T.map = this;
                T.visible = false;
                T.solid = false;
                while (Y < EY) {
                    X = SX;
                    while (X < EX) {
                        var TT = T.Clone();
                        TT.column = X;
                        TT.row = Y;
                        this.data.set([X, Y], TT);
                        X = (X + 1) | 0;
                    }
                    Y = (Y + 1) | 0;
                }
            },
            SetTile: function (column, row, T) {
                if (column >= 0 && row >= 0 && column < System.Array.getLength(this.data, 0) && row < System.Array.getLength(this.data, 1)) {
                    this.data.set([column, row], T);
                }
            },
            blur: function (array, index, blur) {
                if (blur === void 0) { blur = 1; }
                var total = 0;
                var ret = 0;
                var i = 0;
                var ind = index;
                if (ind >= 0 && ind < array.length) {
                    total = (total + 1) | 0;
                    ret = (ret + array[System.Array.index(ind, array)]) | 0;
                }
                while (i < blur) {
                    ind = (ind - 1) | 0;
                    if (ind >= 0 && ind < array.length) {
                        total = (total + 1) | 0;
                        ret = (ret + array[System.Array.index(ind, array)]) | 0;
                    }
                    i = (i + 1) | 0;
                }
                i = 0;
                while (i < blur) {
                    ind = (ind + 1) | 0;
                    if (ind >= 0 && ind < array.length) {
                        total = (total + 1) | 0;
                        ret = (ret + array[System.Array.index(ind, array)]) | 0;
                    }
                    i = (i + 1) | 0;
                }
                return ((Bridge.Int.div(ret, total)) | 0);
            },
            CheckForTile: function (position) {
                /* position = position - this.position;
                position /= tilesize;
                if (position.X>=0 && position.X<columns && position.Y>=0 && position.Y<rows)
                {
                   return data[(int)position.X, (int)position.Y];
                }*/
                var TP = this.position;
                var PX = Bridge.Int.clip32((position.X - TP.X) / this.tilesize);
                var PY = Bridge.Int.clip32((position.Y - TP.Y) / this.tilesize);
                if (PX >= 0 && PX < this.columns && PY >= 0 && PY < this.rows) {
                    return this.data.get([PX, PY]);
                }
                return null;
            },
            GetTile: function (column, row) {
                if (column >= 0 && row >= 0 && column < this.columns && row < this.rows) {
                    return this.data.get([column, row]);
                }
                return null;
            },
            _Draw: function () {
                if (this.needRedraw) {
                    var W = Bridge.Int.clip32(Math.ceil(this.columns * this.tilesize));
                    var H = Bridge.Int.clip32(Math.ceil(this.rows * this.tilesize));

                    if (this.buffer.width !== W || this.buffer.height !== H) {
                        this.buffer.width = W;
                        this.buffer.height = H;
                    } else {
                        this.bg.clearRect(0, 0, this.buffer.width, this.buffer.height);
                    }

                    this.Redraw(this.bg);
                    this.needRedraw = false;
                }
            },
            Draw: function (g) {
                this._Draw();
                //g.DrawImage(buffer, position.X, position.Y);
                this.rtmp.CopyFrom(this.game.camera.CameraBounds);
                //hide floating point seams.
                this.rtmp.x -= 1;
                this.rtmp.y -= 1;
                this.rtmp.width += 2;
                this.rtmp.height += 2;
                var CB = this.rtmp;
                //var CB = game.camera.CameraBounds;
                //g.DrawImage(buffer, CB.left-position.X, CB.top-position.Y, CB.width, CB.height, CB.left, CB.top, CB.width, CB.height);//draw map cropped to camera bounds
                g.drawImage(this.buffer, CB.left - this.position.X, CB.top - this.position.Y, CB.width, CB.height, CB.left, CB.top, CB.width, CB.height); //draw map cropped to camera bounds
            },
            RedrawTile: function (X, Y, updateNeighbors) {
                if (updateNeighbors === void 0) { updateNeighbors = true; }
                if (updateNeighbors) {
                    var TX = Bridge.Int.mul((((X - 1) | 0)), Bridge.Int.clip32(this.tilesize));
                    var TY = Bridge.Int.mul((((Y - 1) | 0)), Bridge.Int.clip32(this.tilesize));
                    this.bg.clearRect(TX, TY, Bridge.Int.mul(Bridge.Int.clip32(this.tilesize), 3), Bridge.Int.mul(Bridge.Int.clip32(this.tilesize), 3));

                    this.Redraw(this.bg, ((X - 1) | 0), ((Y - 1) | 0), 3, 3);
                } else {
                    var TX1 = Bridge.Int.mul((X), Bridge.Int.clip32(this.tilesize));
                    var TY1 = Bridge.Int.mul((Y), Bridge.Int.clip32(this.tilesize));
                    this.bg.clearRect(TX1, TY1, this.tilesize, this.tilesize);

                    this.Redraw(this.bg, X, Y, 1, 1);
                }
            },
            Redraw: function (g, SX, SY, W, H) {
                if (SX === void 0) { SX = -1; }
                if (SY === void 0) { SY = -1; }
                if (W === void 0) { W = -1; }
                if (H === void 0) { H = -1; }
                var PX = this.position.X;
                var PY = this.position.Y;
                PX = 0;
                PY = 0;
                if (SX === -1) {
                    SX = 0;
                }
                if (SY === -1) {
                    SY = 0;
                }

                if (W === -1) {
                    W = this.columns;
                }
                if (H === -1) {
                    H = this.rows;
                }
                var EX = (SX + W) | 0;
                var EY = (SY + H) | 0;
                SX = Bridge.Int.clip32(CirnoGame.MathHelper.Clamp$1(SX, 0, this.columns));
                SY = Bridge.Int.clip32(CirnoGame.MathHelper.Clamp$1(SY, 0, this.rows));

                EX = Bridge.Int.clip32(CirnoGame.MathHelper.Clamp$1(EX, 0, this.columns));
                EY = Bridge.Int.clip32(CirnoGame.MathHelper.Clamp$1(EY, 0, this.rows));

                var X = PX + (SX * this.tilesize);
                var Y = PY + (SY * this.tilesize);
                var row = SY;
                var column = SX;
                var BG = this.tiles.getItem(2);
                //var BG2 = tiles[3];
                var BG2 = System.Array.init([this.tiles.getItem(3), this.tiles.getItem(9), this.tiles.getItem(10)], HTMLImageElement);
                var tilesC = this.tiles.Count;

                var R = new CirnoGame.Rectangle();
                var doorroom = CirnoGame.MapGenerator.doorroom;
                var keyroom = CirnoGame.MapGenerator.keyroom;
                var doorroomcolor = "#000000";
                //var keyroomcolor = "#CC0000";
                //var keyroomcolor = "#118822";
                var keyroomcolor = "#558822";

                var gradcolor = "#000077";
                var Agradcolor = "#CC0000";

                var DX = 0;
                var DY = 0;

                if (doorroom != null) {
                    DX = (Bridge.Int.div((((doorroom.SX + doorroom.EX) | 0)), 2)) | 0;
                    DY = (Bridge.Int.div((((doorroom.SY + doorroom.EY) | 0)), 2)) | 0;
                }

                while (row < EY) {
                    while (column < EX) {
                        //if (R.isTouching(new Rectangle(X, Y, tilesize, tilesize)))
                        {
                            var T = this.data.get([column, row]);
                            var tex = Math.min(((this.tiles.Count - 1) | 0), T.texture);
                            if (T.enabled && tex >= 0 && tex < tilesC) {
                                g.drawImage(this.tiles.getItem(tex), X, Y);
                                if (T.Breakable && T.HP < T.maxHP) {
                                    var dmg = (Bridge.Int.clip32(Math.max(1, Math.min(Bridge.Math.round(T.maxHP - T.HP, 0, 6), 3))) - 1) | 0;
                                    g.drawImage(this.cracks.getItem(dmg), X, Y);
                                }
                                var sd = T.SlopeDirection;
                                if (sd !== 0) {
                                    //object sg = g;
                                    //Script.Write("sg.globalCompositeOperation = 'destination-out'");
                                    g.globalCompositeOperation = "destination-out";
                                    T.GetHitbox2(R);
                                    R.x -= this.position.X;
                                    R.y -= this.position.Y;
                                    g.beginPath();
                                    g.moveTo(R.left, R.top);
                                    var P;
                                    P = new CirnoGame.Vector2(R.left + (R.width / 2.0), R.top + (R.height / 2.0));
                                    if (sd > 0) {
                                        g.lineTo(R.left, R.bottom);
                                    } else {
                                        g.lineTo(R.right, R.bottom);
                                    }

                                    g.lineTo(R.right, R.top);

                                    g.lineTo(R.left, R.top);

                                    g.fill();

                                    g.globalCompositeOperation = "destination-over";
                                    /* if (doorroom!=null && doorroom.ContainsTile(column, row))
                                    {
                                       g.GlobalAlpha = 0.55f;
                                       g.FillStyle = doorroomcolor;
                                       //g.FillRect(R.x.ToDynamic(), R.y.ToDynamic(), R.width.ToDynamic(), R.height.ToDynamic());
                                       g.FillRect(X.ToDynamic(), Y.ToDynamic(), tilesize.ToDynamic(), tilesize.ToDynamic());
                                       g.GlobalAlpha = 1f;
                                    }
                                    else */
                                    if (keyroom != null && keyroom.ContainsTile(column, row)) {
                                        g.globalAlpha = 0.17;
                                        g.fillStyle = keyroomcolor;
                                        //g.FillRect(R.x.ToDynamic(), R.y.ToDynamic(), R.width.ToDynamic(), R.height.ToDynamic());
                                        g.fillRect(X, Y, this.tilesize, this.tilesize);
                                        g.globalAlpha = 1.0;
                                    } else if (doorroom != null) {
                                        var Dist = Math.max(((((Math.abs(((column - DX) | 0)) + Math.abs(((row - DY) | 0))) | 0) - 5) | 0), 0);
                                        var A = 0.5 - (Dist * 0.03);
                                        var G = gradcolor;
                                        if (A < 0) {
                                            //A = Math.Min((-A * 0.50f) - 0.22f, 0.30f);
                                            A = (-A * 0.5) - 0.22;
                                            G = Agradcolor;
                                            if (A > 0.3) {
                                                A = 0.6 - A;
                                                if (A < 0) {
                                                    /* A = -A;*/
                                                    G = gradcolor;
                                                    A = 0;
                                                }
                                            }

                                        }
                                        if (A > 0) {
                                            g.globalAlpha = A;
                                            g.fillStyle = G;
                                            g.fillRect(X, Y, this.tilesize, this.tilesize);
                                            g.globalAlpha = 1.0;
                                        }
                                    }
                                    g.drawImage(BG, X, Y);
                                    g.globalCompositeOperation = "source-over";

                                } else if (!T.opaque) {
                                    g.globalCompositeOperation = "destination-over";
                                    /* if (doorroom!=null && doorroom.ContainsTile(column, row))
                                    {
                                       g.GlobalAlpha = 0.55f;
                                       g.FillStyle = doorroomcolor;
                                       //g.FillRect(R.x.ToDynamic(), R.y.ToDynamic(), R.width.ToDynamic(), R.height.ToDynamic());
                                       g.FillRect(X.ToDynamic(), Y.ToDynamic(), tilesize.ToDynamic(), tilesize.ToDynamic());
                                       g.GlobalAlpha = 1f;
                                    }
                                    else */
                                    if (keyroom != null && keyroom.ContainsTile(column, row)) {
                                        g.globalAlpha = 0.17;
                                        g.fillStyle = keyroomcolor;
                                        //g.FillRect(R.x.ToDynamic(), R.y.ToDynamic(), R.width.ToDynamic(), R.height.ToDynamic());
                                        g.fillRect(X, Y, this.tilesize, this.tilesize);
                                        g.globalAlpha = 1.0;
                                    } else if (doorroom != null) {
                                        var Dist1 = Math.max(((((Math.abs(((column - DX) | 0)) + Math.abs(((row - DY) | 0))) | 0) - 5) | 0), 0);
                                        var A1 = 0.5 - (Dist1 * 0.03);
                                        var G1 = gradcolor;
                                        if (A1 < 0) {
                                            //A = Math.Min((-A * 0.50f) - 0.22f, 0.30f);
                                            A1 = (-A1 * 0.5) - 0.22;
                                            G1 = Agradcolor;
                                            if (A1 > 0.3) {
                                                A1 = 0.6 - A1;
                                                if (A1 < 0) {
                                                    /* A = -A;*/
                                                    G1 = gradcolor;
                                                    A1 = 0;
                                                }
                                            }

                                        }
                                        if (A1 > 0) {
                                            g.globalAlpha = A1;
                                            g.fillStyle = G1;
                                            g.fillRect(X, Y, this.tilesize, this.tilesize);
                                            g.globalAlpha = 1.0;
                                        }
                                    }

                                    g.drawImage(BG, X, Y);
                                    g.globalCompositeOperation = "source-over";
                                }

                            } else {
                                var texture = BG;
                                //if (Math.Random() >= 0.98)
                                if (Math.random() >= 0.97) {
                                    texture = CirnoGame.HelperExtensions.Pick(Bridge.global.HTMLImageElement, BG2);
                                }
                                //g.DrawImage(Math.Random() < 0.98 ? BG : BG2, X, Y);
                                g.drawImage(texture, X, Y);
                                /* if (doorroom != null && doorroom.ContainsTile(column, row))
                                {
                                   g.GlobalAlpha = 0.55f;
                                   g.FillStyle = doorroomcolor;
                                   g.FillRect(X.ToDynamic(), Y.ToDynamic(), tilesize.ToDynamic(), tilesize.ToDynamic());
                                   g.GlobalAlpha = 1f;
                                }
                                else */
                                if (keyroom != null && keyroom.ContainsTile(column, row)) {
                                    /* T.GetHitbox2(R);
                                    R.x -= position.X;
                                    R.y -= position.Y;*/
                                    g.globalAlpha = 0.17;
                                    g.fillStyle = keyroomcolor;
                                    g.fillRect(X, Y, this.tilesize, this.tilesize);
                                    g.globalAlpha = 1.0;
                                } else if (doorroom != null) {
                                    var Dist2 = Math.max(((((Math.abs(((column - DX) | 0)) + Math.abs(((row - DY) | 0))) | 0) - 5) | 0), 0);
                                    var A2 = 0.5 - (Dist2 * 0.03);
                                    var G2 = gradcolor;
                                    if (A2 < 0) {
                                        //A = Math.Min((-A * 0.50f) - 0.22f, 0.30f);
                                        A2 = (-A2 * 0.5) - 0.22;
                                        G2 = Agradcolor;
                                        if (A2 > 0.3) {
                                            A2 = 0.6 - A2;
                                            if (A2 < 0) {
                                                /* A = -A;*/
                                                G2 = gradcolor;
                                                A2 = 0;
                                            }
                                        }

                                    }
                                    if (A2 > 0) {
                                        g.globalAlpha = A2;
                                        g.fillStyle = G2;
                                        g.fillRect(X, Y, this.tilesize, this.tilesize);
                                        g.globalAlpha = 1.0;
                                    }
                                }
                            }
                        }
                        column = (column + 1) | 0;
                        X += this.tilesize;
                    }
                    X = PX + (SX * this.tilesize);
                    Y += this.tilesize;
                    column = SX;
                    row = (row + 1) | 0;
                }
            },
            IsExposed: function (X, Y) {
                var row = (Y - 2) | 0;
                var column = (X - 2) | 0;
                var TDRaw = this.data;
                var ind = 0;
                var lind = 0;

                ind = Bridge.Int.mul(column, this.rows);
                ind = (ind + row) | 0;

                while (row <= ((Y + 2) | 0)) {
                    lind = ind;
                    while (column <= ((X + 2) | 0)) {
                        /* var T = data[column, row];
                        T.texture = Math.Random() < 0.5 ? 0 : 1;*/
                        if (row >= 0 && column >= 0 && row < this.rows && column < this.columns) {
                            //var T = data[column, row];
                            var T = TDRaw[System.Array.index(ind, TDRaw)];
                            if (!T.enabled || !T.solid) {
                                return true;
                            }
                        }
                        column = (column + 1) | 0;
                        ind = (ind + this.rows) | 0;
                    }
                    ind = lind;
                    ind = (ind + 1) | 0;
                    row = (row + 1) | 0;
                    column = (X - 2) | 0;
                }
                return false;
            },
            ApplyBreakableRect: function (SX, SY, W, H) {
                if (SX === void 0) { SX = -1; }
                if (SY === void 0) { SY = -1; }
                if (W === void 0) { W = -1; }
                if (H === void 0) { H = -1; }
                if (SX === -1) {
                    SX = 0;
                }
                if (SY === -1) {
                    SY = 0;
                }

                if (W === -1) {
                    W = this.columns;
                }
                if (H === -1) {
                    H = this.rows;
                }
                var EX = (SX + W) | 0;
                var EY = (SY + H) | 0;
                SX = Bridge.Int.clip32(CirnoGame.MathHelper.Clamp$1(SX, 0, this.columns));
                SY = Bridge.Int.clip32(CirnoGame.MathHelper.Clamp$1(SY, 0, this.rows));

                EX = Bridge.Int.clip32(CirnoGame.MathHelper.Clamp$1(EX, 0, this.columns));
                EY = Bridge.Int.clip32(CirnoGame.MathHelper.Clamp$1(EY, 0, this.rows));
                var row = SX;
                var column = SY;

                while (row < EY) {
                    while (column < EX) {
                        /* var T = data[column, row];
                        T.texture = Math.Random() < 0.5 ? 0 : 1;*/
                        var T = this.data.get([column, row]);
                        var TT = T.Clone();
                        TT.column = column;
                        TT.row = row;
                        this.data.set([column, row], TT);
                        T = TT;
                        if (this.IsExposed(column, row)) {
                            T.texture = 1;
                            if (Math.random() < 0.02) {
                                T.texture = Math.random() < 0.5 ? 5 : 6;
                            }
                            T.Breakable = true;
                        } else {
                            T.texture = 0;
                            T.Breakable = false;
                        }
                        column = (column + 1) | 0;
                    }
                    row = (row + 1) | 0;
                    column = SX;
                }
                this.needRedraw = true;
            },
            ApplyBreakable: function () {
                var row = 0;
                var column = 0;
                var TDRaw = this.data;
                var ind = 0;
                var lind = 0;

                while (row < this.rows) {
                    lind = ind;
                    while (column < this.columns) {
                        /* var T = data[column, row];
                        T.texture = Math.Random() < 0.5 ? 0 : 1;*/

                        var T = TDRaw[System.Array.index(ind, TDRaw)];
                        //var T = data[column, row];
                        var TT = T.Clone();
                        TT.column = column;
                        TT.row = row;
                        //data[column, row] = TT;
                        TDRaw[System.Array.index(ind, TDRaw)] = TT;
                        T = TT;
                        if (this.IsExposed(column, row)) {
                            T.texture = 1;
                            if (Math.random() < 0.02) {
                                T.texture = Math.random() < 0.5 ? 5 : 6;
                            }
                            T.Breakable = true;
                        } else {
                            T.texture = 0;
                            T.Breakable = false;
                        }
                        column = (column + 1) | 0;
                        ind = (ind + this.rows) | 0;
                    }
                    ind = lind;
                    row = (row + 1) | 0;
                    //ind -= (columns * rows);
                    column = 0;

                    ind = (ind + 1) | 0;
                }
                this.needRedraw = true;
            },
            testTexture: function () {
                var row = 0;
                var column = 0;

                while (row < this.rows) {
                    while (column < this.columns) {
                        var T = this.data.get([column, row]);
                        T.texture = Math.random() < 0.5 ? 0 : 1;
                        column = (column + 1) | 0;
                    }
                    row = (row + 1) | 0;
                    column = 0;
                }
                this.needRedraw = true;
            }
        }
    });

    Bridge.define("CirnoGame.Vector2", {
        statics: {
            props: {
                Empty: {
                    get: function () {
                        return new CirnoGame.Vector2();
                    }
                }
            },
            methods: {
                FromRadian: function (radian) {
                    return CirnoGame.MathHelper.RadianToVector(radian);
                },
                Add: function (A, B) {
                    return new CirnoGame.Vector2(A.X + B.X, A.Y + B.Y);
                },
                Add$1: function (A, X, Y) {
                    return new CirnoGame.Vector2(A.X + X, A.Y + Y);
                },
                Subtract: function (A, B) {
                    return new CirnoGame.Vector2(A.X - B.X, A.Y - B.Y);
                },
                Subtract$1: function (A, X, Y) {
                    return new CirnoGame.Vector2(A.X - X, A.Y - Y);
                },
                op_Equality: function (A, B) {
                    var OA = A;
                    var OB = B;
                    if ((OA == null || OB == null) && (OA != null || OB != null)) {
                        return false;
                    }
                    if (OA == null && OB == null) {
                        return true;
                    }
                    return A.X === B.X && A.Y === B.Y;
                    //return false;
                },
                op_Inequality: function (A, B) {
                    return !(CirnoGame.Vector2.op_Equality(A, B));
                },
                op_Multiply: function (A, scale) {
                    return new CirnoGame.Vector2(A.X * scale, A.Y * scale);
                },
                op_Division: function (A, scale) {
                    return new CirnoGame.Vector2(A.X / scale, A.Y / scale);
                },
                op_Addition: function (A, B) {
                    return new CirnoGame.Vector2(A.X + B.X, A.Y + B.Y);
                },
                op_Subtraction: function (A, B) {
                    return new CirnoGame.Vector2(A.X - B.X, A.Y - B.Y);
                }
            }
        },
        fields: {
            X: 0,
            Y: 0
        },
        props: {
            Length: {
                get: function () {
                    return Math.sqrt((this.X * this.X) + (this.Y * this.Y));
                }
            },
            /**
             * Returns a rough estimate of the vector's length.
             *
             * @instance
             * @public
             * @readonly
             * @memberof CirnoGame.Vector2
             * @function EstimatedLength
             * @type number
             */
            EstimatedLength: {
                get: function () {
                    var A = Math.abs(this.X);
                    var B = Math.abs(this.Y);
                    if (B > A) {
                        var tmp = A;
                        A = B;
                        B = tmp;
                    }
                    B *= 0.34;
                    return A + B;
                    //return (float)(Math.Abs(X) + Math.Abs(Y));
                }
            },
            /**
             * Returns the sum of its absolute parts.
             *
             * @instance
             * @public
             * @readonly
             * @memberof CirnoGame.Vector2
             * @function RoughLength
             * @type number
             */
            RoughLength: {
                get: function () {
                    return Math.abs(this.X) + Math.abs(this.Y);
                }
            }
        },
        ctors: {
            ctor: function (x, y) {
                if (x === void 0) { x = 0.0; }
                if (y === void 0) { y = 0.0; }

                this.$initialize();
                this.X = x;
                this.Y = y;
            }
        },
        methods: {
            Distance: function (P) {
                var XX = this.X - P.X;
                var YY = this.Y - P.Y;
                return Math.sqrt((XX * XX) + (YY * YY));
            },
            /**
             * Returns a rough estimate of the vector's length.
             *
             * @instance
             * @public
             * @this CirnoGame.Vector2
             * @memberof CirnoGame.Vector2
             * @param   {CirnoGame.Vector2}    P
             * @return  {number}
             */
            EstimatedDistance: function (P) {
                var A = Math.abs(this.X - P.X);
                var B = Math.abs(this.Y - P.Y);
                if (B > A) {
                    var tmp = A;
                    A = B;
                    B = tmp;
                }
                B *= 0.34;
                return A + B;
                //return (float)(Math.Abs(X) + Math.Abs(Y));
            },
            Multiply: function (f) {
                this.X *= f;
                this.Y *= f;
            },
            RoughNormalize: function (length) {
                if (length === void 0) { length = 1.0; }
                var D = this.Length / length;
                return new CirnoGame.Vector2(this.X / D, this.Y / D);
            },
            Normalize: function (length) {
                if (length === void 0) { length = 1.0; }
                var distance = Math.sqrt(this.X * this.X + this.Y * this.Y);
                var V = new CirnoGame.Vector2();
                V.X = this.X / distance;
                V.Y = this.Y / distance;
                V.X *= length;
                V.Y *= length;
                return V;
            },
            SetAsNormalize: function (length) {
                if (length === void 0) { length = 1.0; }
                var distance = Math.sqrt(this.X * this.X + this.Y * this.Y);
                this.X = this.X / distance;
                this.Y = this.Y / distance;
                this.X *= length;
                this.Y *= length;
            },
            ToCardinal: function () {
                var x = this.X;
                var y = this.Y;
                var A = Math.abs(this.X);
                var B = Math.abs(this.Y);
                if (B > A) {
                    x = 0;
                } else if (A > B) {
                    y = 0;
                }
                return new CirnoGame.Vector2(x, y);
            },
            Equals: function (o) {
                var B = o;
                if (CirnoGame.Vector2.op_Inequality(this, B) && CirnoGame.Vector2.op_Equality(B, null)) {
                    return false;
                }
                return B.X === this.X && B.Y === this.Y;
            },
            equals: function (o) {
                if (Bridge.is(o, CirnoGame.Vector2)) {
                    var B = Bridge.cast(o, CirnoGame.Vector2);
                    if (CirnoGame.Vector2.op_Inequality(this, B) && CirnoGame.Vector2.op_Equality(B, null)) {
                        return false;
                    }
                    return B.X === this.X && B.Y === this.Y;
                }
                return Bridge.equals(this, o);
            },
            ToAngle: function () {
                return CirnoGame.MathHelper.WrapRadians(CirnoGame.MathHelper.GetAngle(this));
                //return MathHelper.WrapRadians(MathHelper.GetAngle(new Vector2(), this));
            },
            Clone: function () {
                return new CirnoGame.Vector2(this.X, this.Y);
            },
            CopyFrom: function (V) {
                if (CirnoGame.Vector2.op_Equality(V, null)) {
                    return;
                }
                this.X = V.X;
                this.Y = V.Y;
            },
            Rotate: function (radian) {
                var angle = this.ToAngle() + radian;
                return CirnoGame.Vector2.FromRadian(angle).Normalize(this.Length);
            },
            Add: function (V) {
                this.X += V.X;
                this.Y += V.Y;
            },
            Subtract: function (V) {
                this.X -= V.X;
                this.Y -= V.Y;
            }
        }
    });

    Bridge.define("CirnoGame.AimedShooter", {
        inherits: [CirnoGame.EntityBehavior],
        fields: {
            time: 0,
            maxtime: 0,
            Target: null,
            maxDistance: 0,
            maxShadow: 0,
            attackpower: 0,
            bulletSpeed: 0,
            bulletDuration: 0,
            ignoresterrain: false,
            bulletgraphic: null,
            attackTelegraphTime: 0
        },
        ctors: {
            init: function () {
                this.time = 0;
                this.maxtime = 480;
                this.maxDistance = 130;
                this.maxShadow = 5;
                this.attackpower = 1;
                this.bulletSpeed = 0.5;
                this.bulletDuration = 900;
                this.ignoresterrain = false;
                this.bulletgraphic = "ebullet";
                this.attackTelegraphTime = 60;
            },
            ctor: function (entity) {
                this.$initialize();
                CirnoGame.EntityBehavior.ctor.call(this, entity);
                /* entity.Ani.HueColor = "#FF0000";
                entity.Ani.HueRecolorStrength = 2.0f;*/
                entity.Ani.Shadowcolor = "#FF0000";
            }
        },
        methods: {
            Update: function () {
                CirnoGame.EntityBehavior.prototype.Update.call(this);
                this.UpdateTarget();
                var A = this.entity.Ani;



                if (this.Target != null) {
                    if (this.time < this.attackTelegraphTime) {
                        //if ((time & 4) > 0)
                        if (true) {
                            //A.Shadow = 6-(time * 0.1f);
                            A.Shadow = this.maxShadow;
                        } else {
                            A.Shadow = 0;
                        }
                    } else {
                        A.Shadow = 0;
                    }
                    this.time = (this.time - 1) | 0;
                    if (this.time <= 0) {
                        this.ResetTimer();
                        this.Shoot();
                    }
                } else {
                    A.Shadow = 0;
                }
                /* A.Shadowcolor = A.HueColor;
                A.Shadow = A.Shadowcolor != "" ? 0 : 3;
                A.HueColor = "#FF0000";
                A.HueRecolorStrength = 2.0f;*/
                //A.Update();

            },
            UpdateTarget: function () {
                if (this.Target != null) {
                    if (this.Target.Position.EstimatedDistance(this.entity.Position) > this.maxDistance) {
                        this.Target = null;
                    } else {
                        return;
                    }
                }
                var T = this.entity.Game.player;
                if (T.Position.EstimatedDistance(this.entity.Position) < this.maxDistance) {
                    this.Target = T;
                    this.ResetTimer();
                }
            },
            ResetTimer: function () {
                this.time = (((Bridge.Int.div(this.maxtime, 2)) | 0));
                this.time = (this.time + Bridge.Int.clip32(Bridge.Math.round(this.time * Math.random(), 0, 6))) | 0;
            },
            Shoot: function () {
                if (this.Target == null || Bridge.cast(this.Target, CirnoGame.ICombatant).CirnoGame$ICombatant$HP <= 0) {
                    return;
                }
                var P = new CirnoGame.PlayerBullet(this.entity.Game, this.entity, System.String.concat("images/misc/", this.bulletgraphic));
                P.Position.CopyFrom(this.entity.getCenter());

                var D = (CirnoGame.Vector2.op_Subtraction(this.Target.getCenter(), P.Position));
                D.SetAsNormalize(this.bulletSpeed);
                P.Hspeed = D.X;
                P.Vspeed = D.Y;
                P.touchDamage = this.attackpower;
                P.ignoresterrain = this.ignoresterrain;
                P.Duration = this.bulletDuration;
                this.entity.Game.AddEntity(P);
            }
        }
    });

    Bridge.define("CirnoGame.ButtonSprite", {
        inherits: [CirnoGame.Sprite],
        fields: {
            _buttonNeedsRerender: false,
            _buttonBuffer: null,
            _buttonGraphic: null,
            Data: null,
            _contents: null,
            _borderSize: 0,
            _borderColor: null,
            LockedClickSound: null,
            ClickSound: null,
            _buttonColor: null,
            ColorSchemes: null,
            locked: false,
            OnClick: null,
            LContentSize: null
        },
        props: {
            Contents: {
                get: function () {
                    return this._contents;
                },
                set: function (value) {
                    if (!Bridge.referenceEquals(this._contents, value)) {
                        this._contents = value;
                        this._buttonNeedsRerender = true;
                    }
                }
            },
            BorderSize: {
                get: function () {
                    return this._borderSize;
                },
                set: function (value) {
                    if (this._borderSize !== value) {
                        this._borderSize = value;
                        this._buttonNeedsRerender = true;
                    }
                }
            },
            BorderColor: {
                get: function () {
                    return this._borderColor;
                },
                set: function (value) {
                    if (!Bridge.referenceEquals(this._borderColor, value)) {
                        this._borderColor = value;
                        this._buttonNeedsRerender = true;
                    }
                }
            },
            ButtonColor: {
                get: function () {
                    return this._buttonColor;
                },
                set: function (value) {
                    if (!Bridge.referenceEquals(this._buttonColor, value)) {
                        this._buttonColor = value;
                        this._buttonNeedsRerender = true;
                    }
                }
            }
        },
        ctors: {
            init: function () {
                this.LockedClickSound = "hit";
                this.ClickSound = "select";
                this.locked = false;
                this.LContentSize = new CirnoGame.Vector2();
            },
            ctor: function (contents, borderSize, borderColor, buttonColor, data) {
                if (borderSize === void 0) { borderSize = 2; }
                if (borderColor === void 0) { borderColor = "#00AA33"; }
                if (buttonColor === void 0) { buttonColor = "#11CC55"; }
                if (data === void 0) { data = null; }

                this.$initialize();
                CirnoGame.Sprite.ctor.call(this);
                this.Contents = contents;
                this.BorderSize = borderSize;
                this.BorderColor = borderColor;
                this.ButtonColor = buttonColor;

                this._buttonBuffer = new CirnoGame.Sprite();
                this._buttonBuffer.Size = contents.Size;
                this._buttonGraphic = this._buttonBuffer.GetGraphics();
                this._buttonNeedsRerender = true;
                this.ColorSchemes = new (System.Collections.Generic.List$1(CirnoGame.ButtonSprite.ColorScheme)).ctor();
                this.ColorSchemes.add(new CirnoGame.ButtonSprite.ColorScheme(borderColor, buttonColor));
                this.ColorSchemes.add(new CirnoGame.ButtonSprite.ColorScheme("#FFFFFF", "#FF0000"));
                this.ColorSchemes.add(new CirnoGame.ButtonSprite.ColorScheme("#777777", "#CCCCCC"));

                this.Data = data;
                if (data == null && Bridge.is(contents, CirnoGame.TextSprite)) {
                    this.Data = Bridge.cast(contents, CirnoGame.TextSprite).Text;
                }

                this.Draw(null);
            }
        },
        methods: {
            SetColorScheme: function (scheme) {
                this.BorderColor = scheme.BorderColor;
                this.ButtonColor = scheme.ButtonColor;
            },
            SetColorScheme$1: function (index) {
                var C = this.ColorSchemes.getItem(index);
                this.SetColorScheme(C);
            },
            drawButton: function () {
                var g = this._buttonGraphic;
                var sz = (this._borderSize + this._borderSize) | 0;
                this._buttonBuffer.Size = CirnoGame.Vector2.op_Addition(this.Contents.Size, new CirnoGame.Vector2(sz, sz));
                var size = this._buttonBuffer.Size;

                g.fillStyle = this._borderColor;
                g.fillRect(0, 0, size.X, size.Y);

                g.fillStyle = this.ButtonColor;
                g.fillRect(this._borderSize, this._borderSize, ((Bridge.Int.clip32(size.X) - sz) | 0), ((Bridge.Int.clip32(size.Y) - sz) | 0));

                var color = "rgba(255,255,255,0)";

                var wht = "rgba(255,255,255,0.7)";


                var grd = g.createLinearGradient(0, 0, 0, size.Y);
                grd.addColorStop(0, color);
                grd.addColorStop(0.4, wht);
                grd.addColorStop(1, color);
                g.fillStyle = grd;
                g.fillRect(0, 0, this._buttonBuffer.Size.X, this._buttonBuffer.Size.Y);
            },
            Lock: function (setcolorscheme) {
                if (setcolorscheme === void 0) { setcolorscheme = true; }
                if (this.locked) {
                    return;
                }
                this.locked = true;
                if (setcolorscheme) {
                    this.SetColorScheme$1(2);
                }
            },
            Unlock: function (setcolorscheme) {
                if (setcolorscheme === void 0) { setcolorscheme = true; }
                if (!this.locked) {
                    return;
                }
                this.locked = false;
                if (setcolorscheme) {
                    this.SetColorScheme$1(0);
                }
            },
            CheckClick: function (mousePosition) {
                if (this.Visible && this.GetBounds().containsPoint(mousePosition)) {
                    if (this.locked) {
                        if (!Bridge.referenceEquals(this.LockedClickSound, "") && this.LockedClickSound != null) {
                            CirnoGame.AudioManager._this.Blast(System.String.concat("SFX/", this.LockedClickSound, ".ogg"));
                        }
                        return false;
                    }

                    if (!Bridge.referenceEquals(this.ClickSound, "") && this.ClickSound != null) {
                        //AudioManager._this.Get("SFX/" + ClickSound);
                        CirnoGame.AudioManager._this.Blast(System.String.concat("SFX/", this.ClickSound, ".ogg"));

                    }
                    var tmp = this.OnClick;
                    if (tmp) {
                        this.OnClick();
                    }
                    return true;
                }
                return false;
            },
            Draw: function (g) {
                //if (_contents.Size != LContentSize)
                if (this._contents.Size.X !== this.LContentSize.X || this._contents.Size.Y !== this.LContentSize.Y) {
                    this._buttonNeedsRerender = true;
                    this.LContentSize = this._contents.Size.Clone();
                }
                if (this._buttonNeedsRerender) {
                    this.drawButton();
                    this._buttonNeedsRerender = false;
                }
                this.Size = this._buttonBuffer.Size.Clone();
                //spriteGraphics.DrawImage(_bu)
                this._buttonBuffer.Draw(this.spriteGraphics);
                this.Contents.Position = new CirnoGame.Vector2(this._borderSize, this._borderSize);
                this.Contents.Draw(this.spriteGraphics);

                if (g != null) {
                    CirnoGame.Sprite.prototype.Draw.call(this, g);
                }
            }
        }
    });

    Bridge.define("CirnoGame.Chest", {
        inherits: [CirnoGame.Entity],
        fields: {
            ForceLocked: false,
            TupleNames: null
        },
        props: {
            Golden: false,
            Opened: false,
            Heart: false
        },
        ctors: {
            init: function () {
                this.ForceLocked = false;
                this.TupleNames = System.Array.init(["Null", "Single", "Double", "Triple", "Quadruple", "Quintuple", "Sextuple", "Septuple", "Octuple", "Nonuple", "Decuple"], System.String);
            },
            ctor: function (game) {
                this.$initialize();
                CirnoGame.Entity.ctor.call(this, game);
                this.Ani = new CirnoGame.Animation(CirnoGame.AnimationLoader._this.GetAnimation("images/misc/chest"));
                this.Ani.ImageSpeed = 0;
                if (Math.random() < 0.15) {
                    this.Heartify();
                }
            }
        },
        methods: {
            Goldify: function () {
                var P = this.Ani.Position;
                this.Ani = new CirnoGame.Animation(CirnoGame.AnimationLoader._this.GetAnimation("images/misc/goldchest"));
                this.Ani.ImageSpeed = 0;
                this.Ani.Position.CopyFrom(P);
                this.Golden = true;
                this.Heart = false;
            },
            Heartify: function () {
                var P = this.Ani.Position;
                this.Ani = new CirnoGame.Animation(CirnoGame.AnimationLoader._this.GetAnimation("images/misc/pinkchest"));
                this.Ani.ImageSpeed = 0;
                this.Ani.Position.CopyFrom(P);
                this.Heart = true;
            },
            Update: function () {
                CirnoGame.Entity.prototype.Update.call(this);
                var F = this.GetFloor();
                if (F == null) {
                    this.Vspeed = 2;
                } else {
                    this.Vspeed = 0;
                    this.y = F.GetHitbox().top - this.Ani.CurrentImage.height;
                }
                var P = this.Game.player;
                if (P.Position.EstimatedDistance(this.Position) < 16) {
                    if (!this.ForceLocked) {
                        if (!this.Opened && P.Controller[System.Array.index(2, P.Controller)] && (P.keys > 0 || this.Golden)) {
                            if (!this.Golden) {
                                P.keys = (P.keys - 1) | 0;
                            }
                            this.Open(P);
                        }
                    } else if (P.Controller[System.Array.index(2, P.Controller)]) {
                        P.MSG.ChangeText("It's sealed with magic...");
                    }
                }
            },
            Open: function (player) {
                if (!this.Opened) {
                    this.PlaySound("chestopen");
                    this.Ani.CurrentFrame = 1;
                    this.Ani.SetImage();
                    this.Ani.Update();
                    this.Opened = true;
                    //TODO:give player a permanent upgrade, and display text above the chest telling the player what they just got
                    var M = "";
                    var ok = true;
                    var S = "";
                    var color = "#FFFFFF";
                    var picker = null;
                    while (ok) {
                        var common = System.Array.init(["point", "point", "point", "point", "point", "point", "heart", "heart", "tripleheart", "singleorb"], System.String);
                        var rare = System.Array.init(["attackpower", "defensepower", "mining"], System.String);
                        var legendary = System.Array.init(["triplejump", "cheaperblocks", "invincibility", "repeater", "movespeed"], System.String);

                        var heartTable = System.Array.init(["supertripleheart"], System.String);


                        var R = Math.random();
                        var C;
                        if (this.Heart) {
                            C = CirnoGame.HelperExtensions.Pick(System.String, heartTable);
                            S = "common";
                            color = "#FFFFFF";
                        } else {
                            if (picker == null || Math.random() < 0.2) {
                                if (R < 0.6 && !this.Golden) {
                                    picker = common;
                                    S = "common";
                                    color = "#FFFFFF";
                                } else {
                                    R = Math.random();
                                    if (R < 0.91) {
                                        picker = rare;
                                        S = "rare";
                                        color = "#FFBB33";
                                    } else {
                                        picker = legendary;
                                        S = "legendary";
                                        color = "#FF55FF";
                                    }
                                }
                            }
                            if (true) {
                                C = CirnoGame.HelperExtensions.Pick(System.String, picker);
                            } else {
                                picker = legendary;
                                S = "legendary";
                                color = "#FF55FF";
                                C = "movespeed";
                            }
                        }
                        ok = false;
                        var CI;
                        switch (C) {
                            case "point": 
                                var P = new CirnoGame.PointItem(this.Game);
                                P.Position.CopyFrom(this.Position);
                                P.Vspeed = -2.0;
                                P.Hspeed = -2.0;
                                P.collectionDelay = 30;
                                this.Game.AddEntity(P);
                                P = new CirnoGame.PointItem(this.Game);
                                P.Position.CopyFrom(this.Position);
                                P.Vspeed = -2.0;
                                P.Hspeed = 2.0;
                                P.collectionDelay = 30;
                                this.Game.AddEntity(P);
                                M = "Points";
                                break;
                            case "heart": 
                                if (player.HP >= player.maxHP) {
                                    ok = true;
                                    break;
                                }
                                var H = new CirnoGame.HealingItem(this.Game);
                                H.Position.CopyFrom(this.Position);
                                H.Vspeed = -2.0;
                                H.collectionDelay = 30;
                                this.Game.AddEntity(H);
                                M = "Heal";
                                break;
                            case "tripleheart": 
                                if ((player.HP > player.maxHP / 3) && !this.Heart) {
                                    ok = true;
                                    break;
                                }
                                var H1 = new CirnoGame.HealingItem(this.Game);
                                H1.Position.CopyFrom(this.Position);
                                H1.Vspeed = -2.0;
                                H1.Hspeed = -2.0;
                                H1.collectionDelay = 30;
                                this.Game.AddEntity(H1);
                                H1 = new CirnoGame.HealingItem(this.Game);
                                H1.Position.CopyFrom(this.Position);
                                H1.Vspeed = -2.0;
                                H1.Hspeed = 0;
                                H1.collectionDelay = 30;
                                this.Game.AddEntity(H1);
                                H1 = new CirnoGame.HealingItem(this.Game);
                                H1.Position.CopyFrom(this.Position);
                                H1.Vspeed = -2.0;
                                H1.Hspeed = 2.0;
                                H1.collectionDelay = 30;
                                this.Game.AddEntity(H1);
                                M = "Heal x3";
                                break;
                            case "supertripleheart": 
                                if ((player.HP > player.maxHP / 3) && !this.Heart) {
                                    ok = true;
                                    break;
                                }
                                H1 = new CirnoGame.HealingItem(this.Game);
                                H1.Position.CopyFrom(this.Position);
                                H1.Vspeed = -2.0;
                                H1.Hspeed = -2.0;
                                H1.healingPower *= 1.5;
                                H1.collectionDelay = 30;
                                this.Game.AddEntity(H1);
                                H1 = new CirnoGame.HealingItem(this.Game);
                                H1.Position.CopyFrom(this.Position);
                                H1.Vspeed = -2.0;
                                H1.Hspeed = 0;
                                H1.healingPower *= 1.5;
                                H1.collectionDelay = 30;
                                this.Game.AddEntity(H1);
                                H1 = new CirnoGame.HealingItem(this.Game);
                                H1.Position.CopyFrom(this.Position);
                                H1.Vspeed = -2.0;
                                H1.Hspeed = 2.0;
                                H1.healingPower *= 1.5;
                                H1.collectionDelay = 30;
                                this.Game.AddEntity(H1);
                                M = "Heal+";
                                break;
                            case "singleorb": 
                                if (this.Game.timeRemaining > 0) {
                                    ok = true;
                                    break;
                                }
                                CI = new CirnoGame.Orb(this.Game);
                                CI.Position.CopyFrom(this.Position);
                                CI.Vspeed = -2.0;
                                CI.Hspeed = -2.0;
                                CI.collectionDelay = 30;
                                this.Game.AddEntity(CI);
                                /* CI = new Orb(Game);
                                CI.Position.CopyFrom(Position);
                                CI.Vspeed = -2f;
                                CI.Hspeed = 2f;
                                CI.collectionDelay = 30;
                                Game.AddEntity(CI);*/
                                M = "Orb";
                                break;
                            case "mining": 
                                if (player.digpower < 2.0) {
                                    player.digpower += 0.5;
                                } else {
                                    ok = true;
                                }
                                M = "Mining Power " + System.Single.format((player.digpower)) + "x";
                                break;
                            case "triplejump": 
                                var PC = player.GetBehavior(CirnoGame.PlatformerControls);
                                if (PC.maxAirJumps < 2) {
                                    PC.maxAirJumps = 2;
                                } else {
                                    ok = true;
                                }
                                M = "Triple Jump";
                                break;
                            case "cheaperblocks": 
                                if (player.blockprice !== 4) {
                                    ok = true;
                                    break;
                                }
                                player.blockprice = 1;
                                M = "Blocks are cheaper now";
                                break;
                            case "movespeed": 
                                if (player.data.containsKey("movespeed")) {
                                    ok = true;
                                    break;
                                }
                                player.data.set("movespeed", true);
                                var Plat = player.GetBehavior(CirnoGame.PlatformerControls);
                                Plat.maxSpeed *= 1.07;
                                Plat.accel *= 1.07;
                                M = "Movement speed+";
                                break;
                            case "invincibility": 
                                if (player.invincibilitymod !== 1) {
                                    ok = true;
                                    break;
                                }
                                player.invincibilitymod = 2;
                                M = "Invincibility extended";
                                break;
                            case "attackpower": 
                                player.attackpower += 1;
                                M = "Attack Power " + Bridge.Int.clip32((player.attackpower));
                                break;
                            case "defensepower": 
                                player.defensepower += 1;
                                M = "Defensive Power " + Bridge.Int.clip32((player.defensepower));
                                break;
                            case "repeater": 
                                if (player.totalshots > 2) {
                                    ok = true;
                                    break;
                                }
                                player.totalshots = (player.totalshots + 1) | 0;
                                M = System.String.concat(this.TupleNames[System.Array.index(player.totalshots, this.TupleNames)], " shot");
                                break;
                            default: 
                                ok = true;
                                break;
                        }

                    }
                    if (!ok && !Bridge.referenceEquals(M, "")) {
                        var FM = new CirnoGame.FloatingMessage(this.Game, M);
                        FM.Text.TextColor = color;
                        //FM.Position = new Vector2(x - 8, y - 20);
                        FM.Position = new CirnoGame.Vector2(this.x + 8, this.y - 20);
                        this.Game.AddEntity(FM);
                        if (!Bridge.referenceEquals(S, "") && !Bridge.referenceEquals(S, "common")) {
                            this.PlaySound("ok2B");
                        } else {
                            this.PlaySound("jump");
                        }
                    }
                }
            },
            GetFloor: function () {
                var T = null;
                var W = this.Width / 3;
                var Y = this.Height;
                if (!(T != null && T.enabled && T.topSolid)) {
                    T = this.Game.TM.CheckForTile(CirnoGame.Vector2.Add$1(this.Position, this.Width / 2, Y));
                }
                if (!(T != null && T.enabled && T.topSolid)) {
                    T = this.Game.TM.CheckForTile(CirnoGame.Vector2.Add$1(this.Position, W, Y));
                }
                if (!(T != null && T.enabled && T.topSolid)) {
                    T = this.Game.TM.CheckForTile(CirnoGame.Vector2.Add$1(this.Position, this.Width - W, Y));
                }
                if (!(T != null && T.enabled && T.topSolid)) {
                    T = null;
                }
                return T;
            }
        }
    });

    Bridge.define("CirnoGame.CollectableItem", {
        inherits: [CirnoGame.Entity],
        fields: {
            floats: false,
            magnetDistance: 0,
            magnetSpeed: 0,
            maxFallSpeed: 0,
            fallaccel: 0,
            itemName: null,
            collectionDelay: 0,
            sound: null
        },
        ctors: {
            init: function () {
                this.floats = true;
                this.magnetDistance = 35;
                this.magnetSpeed = 8;
                this.maxFallSpeed = 2;
                this.fallaccel = 0.1;
                this.collectionDelay = 10;
                this.sound = "powerup";
            },
            ctor: function (game, itemName) {
                this.$initialize();
                CirnoGame.Entity.ctor.call(this, game);
                this.Ani = new CirnoGame.Animation(CirnoGame.AnimationLoader.Get(System.String.concat("images/items/", itemName)));
                this.Ani.SetImage();
                this.itemName = itemName;
            }
        },
        methods: {
            CanCollect: function (player) {
                return true;
            },
            Update: function () {
                if (this.collectionDelay > 0) {
                    this.collectionDelay = (this.collectionDelay - 1) | 0;
                }
                var C;
                var player = this.Game.player;

                if (this.collectionDelay <= 0 && this.CanCollect(player) && (((C = player.getCenter())).EstimatedDistance(this.Position) < this.magnetDistance)) {
                    var C2 = this.getCenter();
                    var P = CirnoGame.Vector2.op_Subtraction(C, C2);
                    var ln = P.Length;
                    var spd = this.magnetSpeed;
                    var fspd = spd / Math.max(1, ln);
                    if (ln <= fspd) {
                        //((PlayerCharacter)Game.player).onCollectItem(this);
                        this.Alive = false;
                        this.Hspeed = 0;
                        this.Vspeed = 0;
                        this.Position.CopyFrom(this.Game.player.Position);
                        this.onCollected(this.Game.player);
                        this.PlaySound(this.sound);
                        return;

                    }
                    P = P.Normalize(fspd);
                    /* x += P.X;
                    y += P.Y;*/
                    this.Hspeed = P.X;
                    this.Vspeed = P.Y;

                    //Vspeed = 0;
                } else if (!this.floats) {
                    var F = this.GetFloor();
                    if (F == null) {
                        if (this.Vspeed < this.maxFallSpeed) {
                            this.Vspeed = Math.min(this.Vspeed + this.fallaccel, this.maxFallSpeed);
                        } else {
                            this.Vspeed = this.maxFallSpeed;
                        }
                    } else {
                        this.Vspeed = 0;
                        this.y = F.GetHitbox().top - this.Ani.CurrentImage.height;
                    }
                    //Hspeed = 0;
                    this.Hspeed = CirnoGame.MathHelper.Decelerate(this.Hspeed, 0.1);
                } else {
                    //Hspeed = 0;
                    //Vspeed = 0;
                    this.Hspeed = CirnoGame.MathHelper.Decelerate(this.Hspeed, 0.1);
                    this.Vspeed = CirnoGame.MathHelper.Decelerate(this.Vspeed, 0.1);
                }
                CirnoGame.Entity.prototype.Update.call(this);
            },
            GetFloor: function () {
                var T = null;
                var W = this.Width / 3;
                var Y = this.Height;
                if (!(T != null && T.enabled && T.topSolid)) {
                    T = this.Game.TM.CheckForTile(CirnoGame.Vector2.Add$1(this.Position, this.Width / 2, Y));
                }
                if (!(T != null && T.enabled && T.topSolid)) {
                    T = this.Game.TM.CheckForTile(CirnoGame.Vector2.Add$1(this.Position, W, Y));
                }
                if (!(T != null && T.enabled && T.topSolid)) {
                    T = this.Game.TM.CheckForTile(CirnoGame.Vector2.Add$1(this.Position, this.Width - W, Y));
                }
                if (!(T != null && T.enabled && T.topSolid)) {
                    T = null;
                }
                return T;
            }
        }
    });

    Bridge.define("CirnoGame.ControllableEntity", {
        inherits: [CirnoGame.Entity],
        fields: {
            Controller: null,
            LController: null
        },
        ctors: {
            ctor: function (game) {
                this.$initialize();
                CirnoGame.Entity.ctor.call(this, game);
                this.Controller = System.Array.init(7, false, System.Boolean);
                this.LController = System.Array.init(this.Controller.length, false, System.Boolean);
            }
        },
        methods: {
            /**
             * returns true if the button was just pressed.
             *
             * @instance
             * @public
             * @this CirnoGame.ControllableEntity
             * @memberof CirnoGame.ControllableEntity
             * @param   {number}     button
             * @return  {boolean}
             */
            Pressed: function (button) {
                return (this.Controller[System.Array.index(button, this.Controller)] !== this.LController[System.Array.index(button, this.LController)] && this.Controller[System.Array.index(button, this.Controller)]);
            },
            /**
             * returns true if just released.
             *
             * @instance
             * @public
             * @this CirnoGame.ControllableEntity
             * @memberof CirnoGame.ControllableEntity
             * @param   {number}     button
             * @return  {boolean}
             */
            Released: function (button) {
                return (this.Controller[System.Array.index(button, this.Controller)] !== this.LController[System.Array.index(button, this.LController)] && !this.Controller[System.Array.index(button, this.Controller)]);
            }
        }
    });

    Bridge.define("CirnoGame.ExitDoor", {
        inherits: [CirnoGame.Entity],
        fields: {
            reset: 0,
            RT: null,
            _Opened: false
        },
        props: {
            Opened: {
                get: function () {
                    return this._Opened;
                },
                set: function (value) {
                    this._Opened = value;
                    if (this._Opened) {
                        this.Ani.CurrentFrame = 1;
                        this.Ani.SetImage();
                    } else {
                        this.Ani.CurrentFrame = 0;
                        this.Ani.SetImage();
                    }
                }
            }
        },
        ctors: {
            init: function () {
                this.reset = 0;
                this._Opened = false;
            },
            ctor: function (game) {
                this.$initialize();
                CirnoGame.Entity.ctor.call(this, game);
                this.Ani = new CirnoGame.Animation(CirnoGame.AnimationLoader.Get("images/misc/door"));
                this.Ani.ImageSpeed = 0;
                this.Ani.SetImage();
                this.RemovedOnLevelEnd = false;
            }
        },
        methods: {
            DropToGround: function () {
                while (this.GetFloor() == null) {
                    this.y += 16;
                }
                var F = this.GetFloor();
                //F.Breakable = false;
                var FB = F.GetHitbox();
                this.x = FB.left;
                this.y = FB.top - 32;
                var T = this.Game.TM.GetTile(F.column, ((F.row - 1) | 0));
                if (T != null && T.enabled && T.topSolid) {
                    this.y -= 16;
                    F = T;
                    console.log("dug door out of the ground");

                }
                this.RT = F;
                /* F.Breakable = false;
                F.texture = 0;

                Game.TM.RedrawTile(F.column, F.row);*/
                this.reset = 0;

            },
            Update: function () {
                CirnoGame.Entity.prototype.Update.call(this);
                if (!this._Opened) {
                    return;
                }
                /* var F = GetFloor();
                if (F == null)
                {
                   Vspeed = 1;
                }
                else
                {
                   Vspeed = 0;
                   y = F.GetHitbox().top - Ani.CurrentImage.Height;
                }*/
                var P = this.Game.player;
                if (P.Position.EstimatedDistance(this.Position) < 20 && P.Controller[System.Array.index(2, P.Controller)]) {
                    this.Opened = false;
                    P.score = (P.score + (Bridge.Int.mul(this.Game.level, 10))) | 0;

                    var time = 13000;
                    if (this.Game.timeRemaining > 0) {
                        this.Game.timeRemaining += time;
                        this.Game.timeRemaining = Math.min(this.Game.defaultTimeRemaining, this.Game.timeRemaining);
                    } else {
                        this.Game.timeRemaining += time;
                    }
                    this.Game.StartNextLevel();

                    /* P.keys--;
                    Open(P);*/
                    /* Ani.CurrentFrame = 1;
                    Ani.SetImage();
                    Ani.Update();*/
                }
                if (this.reset < 2) {
                    this.reset = (this.reset + 1) | 0;
                    //reset = false;
                    //var F = GetFloor();
                    var F = this.RT;
                    if (F != null && this.reset === 2) {
                        F.Breakable = false;
                        F.texture = 0;
                        this.Game.TM.RedrawTile(F.column, F.row);
                    }
                }
            },
            GetFloor: function () {
                var T = null;
                var W = this.Width / 3;
                var Y = this.Height;
                if (!(T != null && T.enabled && T.topSolid)) {
                    T = this.Game.TM.CheckForTile(CirnoGame.Vector2.Add$1(this.Position, this.Width / 2, Y));
                }
                if (!(T != null && T.enabled && T.topSolid)) {
                    T = this.Game.TM.CheckForTile(CirnoGame.Vector2.Add$1(this.Position, W, Y));
                }
                if (!(T != null && T.enabled && T.topSolid)) {
                    T = this.Game.TM.CheckForTile(CirnoGame.Vector2.Add$1(this.Position, this.Width - W, Y));
                }
                if (!(T != null && T.enabled && T.topSolid)) {
                    T = null;
                }
                return T;
            }
        }
    });

    Bridge.define("CirnoGame.FlightControls", {
        inherits: [CirnoGame.EntityBehavior],
        fields: {
            accel: 0,
            maxSpeed: 0,
            _platformer: null
        },
        ctors: {
            init: function () {
                this.accel = 0.35;
                this.maxSpeed = 1.5;
            },
            ctor: function (entity) {
                this.$initialize();
                CirnoGame.EntityBehavior.ctor.call(this, entity);
                this._platformer = entity;
            }
        },
        methods: {
            Update: function () {
                var controller = this._platformer.Controller;
                if (controller[System.Array.index(0, controller)] && this._platformer.Hspeed > -this.maxSpeed) {
                    this._platformer.Hspeed = Math.max(this._platformer.Hspeed - (this.accel + this._platformer.friction), -this.maxSpeed);
                }
                if (controller[System.Array.index(1, controller)] && this._platformer.Hspeed < this.maxSpeed) {
                    this._platformer.Hspeed = Math.min(this._platformer.Hspeed + (this.accel + this._platformer.friction), this.maxSpeed);
                }
                if (controller[System.Array.index(2, controller)] && this._platformer.Vspeed > -this.maxSpeed) {
                    this._platformer.Vspeed = Math.max(this._platformer.Vspeed - (this.accel + this._platformer.friction), -this.maxSpeed);
                }
                if (controller[System.Array.index(3, controller)] && this._platformer.Vspeed < this.maxSpeed) {
                    this._platformer.Vspeed = Math.min(this._platformer.Vspeed + (this.accel + this._platformer.friction), this.maxSpeed);
                }
                /* var jumpbutton = 5;
                if (_platformer.Vspeed >= 0 && _platformer.onGround)
                {
                   if (_platformer.Pressed(jumpbutton) && _platformer.onGround && _platformer.Ceiling == null)
                   {
                       _platformer.Vspeed = -jumpSpeed;
                       ///entity.PlaySound("jump");
                   }
                }
                else if (airJumps < maxAirJumps && _platformer.Pressed(jumpbutton) && _platformer.Ceiling == null)
                {
                   _platformer.Vspeed = -(jumpSpeed * airjumppower);
                   airJumps++;
                }
                if (_platformer.Vspeed < 0 && !controller[jumpbutton])
                {
                   _platformer.Vspeed += (_platformer.gravity * 2);
                }*/
                CirnoGame.EntityBehavior.prototype.Update.call(this);
            }
        }
    });

    Bridge.define("CirnoGame.FloatingMessage", {
        inherits: [CirnoGame.Entity],
        fields: {
            time: 0,
            Text: null,
            alpha: 0,
            autokill: false
        },
        ctors: {
            init: function () {
                this.time = 30;
                this.alpha = 1;
                this.autokill = true;
            },
            ctor: function (game, text) {
                this.$initialize();
                CirnoGame.Entity.ctor.call(this, game);
                this.Ani = new CirnoGame.Animation(null);
                this.Text = new CirnoGame.TextSprite();
                this.Text.Text = text;
                this.Text.TextColor = "#FFFFFF";
                this.Text.ShadowColor = "#000000";
                this.Text.ShadowOffset = new CirnoGame.Vector2(2, 2);
                this.Text.ShadowBlur = 1;
                this.Text.FontSize = 14;
                this.time = (30 + (Bridge.Int.mul(text.length, 20))) | 0;
            }
        },
        methods: {
            ChangeText: function (text, color) {
                if (color === void 0) { color = null; }
                this.Text.Text = text;
                this.time = (30 + (Bridge.Int.mul(text.length, 20))) | 0;
                this.alpha = 1;
                if (color != null) {
                    this.Text.TextColor = color;
                }
            },
            Update: function () {
                CirnoGame.Entity.prototype.Update.call(this);
                if (this.time > 0) {
                    this.time = (this.time - 1) | 0;
                    if (this.time < 1 && this.alpha > 0) {
                        //Alive = false;
                        this.alpha -= 0.05;
                        if (this.alpha <= 0) {
                            this.alpha = 0;
                            if (this.autokill) {
                                this.Alive = false;
                            }
                        }
                        this.time = 1;
                    }
                }
            },
            Draw: function (g) {
                //base.Draw(g);
                if (this.alpha < 1) {
                    if (this.alpha <= 0) {
                        return;
                    }
                    g.globalAlpha = this.alpha;
                }
                //Text.Position.CopyFrom(Position);
                this.Text.ForceUpdate();
                this.Text.Position.X = (Bridge.Int.clip32(this.Position.X) - (((Bridge.Int.div(this.Text.spriteBuffer.width, 2)) | 0))) | 0;
                this.Text.Position.Y = (Bridge.Int.clip32(this.Position.Y) - (((Bridge.Int.div(this.Text.spriteBuffer.height, 2)) | 0))) | 0;
                this.Text.Draw(g);
                g.globalAlpha = 1.0;
            }
        }
    });

    Bridge.define("CirnoGame.GameSprite", {
        inherits: [CirnoGame.Sprite],
        ctors: {
            ctor: function () {
                this.$initialize();
                CirnoGame.Sprite.ctor.call(this);

            }
        },
        methods: {
            Update: function () {

            },
            Render: function () {

            }
        }
    });

    Bridge.define("CirnoGame.Particle", {
        inherits: [CirnoGame.Entity],
        fields: {
            HP: 0,
            alphatime: 0
        },
        ctors: {
            init: function () {
                this.HP = 12;
                this.alphatime = 0.2;
            },
            ctor: function (game, image) {
                this.$initialize();
                CirnoGame.Entity.ctor.call(this, game);
                this.Ani = new CirnoGame.Animation(new (System.Collections.Generic.List$1(HTMLImageElement)).$ctor1(System.Array.init([image], HTMLImageElement)));
            }
        },
        methods: {
            Update: function () {
                var $t;
                this.HP = (this.HP - 1) | 0;
                if (this.HP <= 0) {
                    if ((($t = this.Ani.Alpha - this.alphatime, this.Ani.Alpha = $t, $t)) <= 0) {
                        this.Alive = false;
                    }
                    /* if (alphatime > 0)
                    {
                       alpha -= alphatime;
                       Ani.Alpha = alpha;
                       if (alpha <= 0)
                       {
                           Alive = false;
                       }
                    }
                    else
                    {
                       Alive = false;
                    }*/
                }
                CirnoGame.Entity.prototype.Update.call(this);
            }
        }
    });

    Bridge.define("CirnoGame.PlatformerControls", {
        inherits: [CirnoGame.EntityBehavior],
        fields: {
            _platformer: null,
            accel: 0,
            jumpSpeed: 0,
            maxSpeed: 0,
            maxAirJumps: 0,
            airJumps: 0,
            airjumppower: 0
        },
        ctors: {
            init: function () {
                this.accel = 0.35;
                this.jumpSpeed = 2.25;
                this.maxSpeed = 1.5;
                this.maxAirJumps = 1;
                this.airJumps = 0;
                this.airjumppower = 0.815;
            },
            ctor: function (entity) {
                this.$initialize();
                CirnoGame.EntityBehavior.ctor.call(this, entity);
                this._platformer = entity;
            }
        },
        methods: {
            Update: function () {
                var againstwall = false;
                var controller = this._platformer.Controller;
                var X = 0;
                if (controller[System.Array.index(0, controller)] && !controller[System.Array.index(1, controller)] && this._platformer.Hspeed > -this.maxSpeed) {
                    this._platformer.Hspeed = Math.max(this._platformer.Hspeed - (this.accel + this._platformer.friction), -this.maxSpeed);
                    X = -1;
                    if (this._platformer.RightWall != null) {
                        againstwall = true;
                    }
                }
                if (controller[System.Array.index(1, controller)] && !controller[System.Array.index(0, controller)] && this._platformer.Hspeed < this.maxSpeed) {
                    this._platformer.Hspeed = Math.min(this._platformer.Hspeed + (this.accel + this._platformer.friction), this.maxSpeed);
                    X = 1;
                    if (this._platformer.LeftWall != null) {
                        againstwall = true;
                    }
                }
                var jumpbutton = 5;
                if (this._platformer.onGround) {
                    this.airJumps = 0;
                }
                if (this._platformer.Vspeed >= 0 && this._platformer.onGround) {
                    if (this._platformer.Pressed(jumpbutton) && this._platformer.onGround && this._platformer.Ceiling == null) {
                        this._platformer.Vspeed = -this.jumpSpeed;
                        this.entity.PlaySound("jump");
                    }
                } else if (this.airJumps < this.maxAirJumps && this._platformer.Pressed(jumpbutton) && this._platformer.Ceiling == null) {
                    this._platformer.Vspeed = -(this.jumpSpeed * this.airjumppower);
                    this.airJumps = (this.airJumps + 1) | 0;
                }
                if (this._platformer.Vspeed < 0 && !controller[System.Array.index(jumpbutton, controller)]) {
                    this._platformer.Vspeed += (this._platformer.gravity * 2);
                }
                CirnoGame.EntityBehavior.prototype.Update.call(this);
            }
        }
    });

    Bridge.define("CirnoGame.PlayerBullet", {
        inherits: [CirnoGame.Entity,CirnoGame.IHarmfulEntity,CirnoGame.ILightSource],
        fields: {
            shooter: null,
            Duration: 0,
            hitEntities: null,
            piercing: false,
            spinrate: 0,
            Gravity: null,
            Bounces: false,
            attacksterrain: false,
            digpower: 0,
            ignoresterrain: false,
            _maxLightRadius: 0,
            _touchDamage: 0
        },
        props: {
            Attacker: {
                get: function () {
                    return this.shooter;
                }
            },
            IsHarmful: {
                get: function () {
                    return true;
                }
            },
            lightFlicker: {
                get: function () {
                    return false;
                }
            },
            lightPosition: {
                get: function () {
                    return this.getCenter();
                }
            },
            maxLightRadius: {
                get: function () {
                    return this.Ani.Alpha >= 1 ? this._maxLightRadius : 0.0;
                },
                set: function (value) {
                    this._maxLightRadius = value;
                }
            },
            touchDamage: {
                get: function () {
                    return this._touchDamage;
                },
                set: function (value) {
                    this._touchDamage = value;
                }
            }
        },
        alias: [
            "Attacker", "CirnoGame$IHarmfulEntity$Attacker",
            "IsHarmful", "CirnoGame$IHarmfulEntity$IsHarmful",
            "lightFlicker", "CirnoGame$ILightSource$lightFlicker",
            "lightPosition", "CirnoGame$ILightSource$lightPosition",
            "maxLightRadius", "CirnoGame$ILightSource$maxLightRadius",
            "touchDamage", "CirnoGame$IHarmfulEntity$touchDamage",
            "ontouchDamage", "CirnoGame$IHarmfulEntity$ontouchDamage"
        ],
        ctors: {
            init: function () {
                this.Duration = 0;
                this.spinrate = 0;
                this.Gravity = new CirnoGame.Vector2();
                this.attacksterrain = false;
                this.digpower = 0.5;
                this.ignoresterrain = false;
                this._maxLightRadius = 1.5;
                this._touchDamage = 1.0;
            },
            ctor: function (game, shooter, graphic) {
                if (graphic === void 0) { graphic = "Reisenbullet"; }

                this.$initialize();
                CirnoGame.Entity.ctor.call(this, game);
                this.Ani = new CirnoGame.Animation(CirnoGame.AnimationLoader._this.GetAnimation(graphic));
                this.shooter = shooter;

                //Ani.HueColor = Game.GetTeamColor(((ICombatant)shooter).Team);
                this.piercing = false;

                this.hitEntities = new (System.Collections.Generic.List$1(CirnoGame.Entity)).ctor();
            }
        },
        methods: {
            GetHitbox: function () {
                if (this.Ani != null && this.Ani.CurrentImage != null) {
                    //float s = Math.Max(Ani.CurrentImage.Width, Ani.CurrentImage.Height);
                    //float s = Ani.CurrentImage.Height;
                    var s = this.Ani.CurrentImage.height * 1.5;
                    //float s2 = s / 2f;
                    //Vector2 V = Ani.Position;
                    var so2 = s / 2;
                    //Vector2 V = getCenter() - new Vector2(so2,so2);
                    var V = CirnoGame.Vector2.Subtract$1(this.getCenter(), so2, so2);
                    return new CirnoGame.Rectangle(V.X, V.Y, s, s);
                }
                return null;
            },
            ontouchDamage: function (target) {
                if (!this.piercing) {
                    this.Alive = false;
                }

                var ok = !this.hitEntities.contains(Bridge.cast(target, CirnoGame.Entity));
                if (ok) {
                    this.hitEntities.add(Bridge.cast(target, CirnoGame.Entity));
                    return true;
                }
                return false;
            },
            Update: function () {
                CirnoGame.Entity.prototype.Update.call(this);
                if (this.spinrate !== 0) {
                    this.Ani.Rotation += this.spinrate;
                }
                if (this.Gravity.RoughLength !== 0) {
                    this.Speed = CirnoGame.Vector2.op_Addition(this.Speed, this.Gravity);
                }
                //if (!App.screenbounds.isTouching(GetHitbox()))

                //if (!Game.stageBounds.isTouching(GetHitbox()))
                if (!this.Game.stageBounds.containsPoint(this.Position)) {
                    if ((this.Ani.X > 0 === this.Hspeed > 0 || this.Ani.X < 0 === this.Hspeed < 0) || (this.Ani.Y > 0 === this.Vspeed > 0 || this.Ani.Y < 0 === this.Vspeed < 0)) {
                        this.Alive = false;
                    }
                }
                //Vector2 center = getCenter();
                var center = CirnoGame.Vector2.Add$1(this.Position, 8, 0);
                if (!this.ignoresterrain) {
                    var T = null;
                    if (!this.Bounces) {
                        T = this.Game.TM.CheckForTile(new CirnoGame.Vector2(center.X, this.y));
                    }
                    if (T != null && T.enabled && T.solid) {
                        if (this.attacksterrain) {
                            if (T.Breakable) {
                                //T.Damage(_touchDamage * digpower);
                                if (T.Damage(this.digpower)) {
                                    this.PlaySound("thunk4");
                                } else {
                                    this.PlaySound("thunk");
                                }
                            } else {
                                this.PlaySound("plink");
                            }
                        }
                        this.Alive = false;
                    } else if (this.Bounces) {

                        T = this.Game.TM.CheckForTile(CirnoGame.Vector2.op_Addition(center, new CirnoGame.Vector2(this.Speed.X)));
                        if (T != null && T.enabled && T.solidToSpeed(this.Speed.ToCardinal())) {
                            this.Speed.X = -this.Speed.X;
                        }

                        T = this.Game.TM.CheckForTile(CirnoGame.Vector2.op_Addition(center, new CirnoGame.Vector2(0, this.Speed.Y)));
                        if (T != null && T.enabled && T.solidToSpeed(this.Speed.ToCardinal())) {
                            this.Speed.Y = -this.Speed.Y;
                        }

                        T = this.Game.TM.CheckForTile(CirnoGame.Vector2.op_Addition(center, this.Speed));
                        if (T != null && T.enabled && T.solidToSpeed(this.Speed.ToCardinal())) {
                            this.Speed.X = -this.Speed.X;
                            this.Speed.Y = -this.Speed.Y;
                        }
                    }
                }
                if (this.Duration > 0) {
                    this.Duration = (this.Duration - 1) | 0;
                    if (this.Duration <= 0) {
                        this.Duration = 1;
                        this.Ani.Alpha -= 0.2;
                        if (this.Ani.Alpha <= 0) {
                            this.Alive = false;
                        }
                    }
                }
            }
        }
    });

    Bridge.define("CirnoGame.RandomAI", {
        inherits: [CirnoGame.EntityBehavior],
        fields: {
            CE: null
        },
        ctors: {
            ctor: function (entity) {
                this.$initialize();
                CirnoGame.EntityBehavior.ctor.call(this, entity);
                this.CE = entity;
                this.FramesPerTick = 15;
            }
        },
        methods: {
            Update: function () {
                CirnoGame.EntityBehavior.prototype.Update.call(this);
                if (Math.random() < 0.1) {
                    var Controller = this.CE.Controller;
                    Controller[System.Array.index(0, Controller)] = false;
                    Controller[System.Array.index(1, Controller)] = false;
                    Controller[System.Array.index(2, Controller)] = false;
                    Controller[System.Array.index(3, Controller)] = false;

                    if (Math.random() < 0.5) {
                        Controller[System.Array.index(0, Controller)] = Math.random() < 0.5;
                        Controller[System.Array.index(1, Controller)] = !Controller[System.Array.index(0, Controller)];
                    }

                    if (Math.random() < 0.5) {
                        Controller[System.Array.index(2, Controller)] = Math.random() < 0.5;
                        Controller[System.Array.index(3, Controller)] = !Controller[System.Array.index(2, Controller)];
                    }
                }
            }
        }
    });

    Bridge.define("CirnoGame.RoomOpeningLever", {
        inherits: [CirnoGame.Entity],
        statics: {
            fields: {
                TEST: null
            },
            methods: {
                FindAndPlaceOnWall: function (game, P, Target) {
                    var T = game.TM.CheckForTile(P);
                    if (T != null) {
                        var X = T.column;
                        var Y = T.row;

                        var XD = Math.random() < 0.5 ? -1 : 1;
                        while (true) {
                            X = (X + XD) | 0;
                            var T2 = game.TM.GetTile(X, Y);
                            if (T2 != null) {
                                if (T2.enabled && T2.solid) {
                                    var T3 = game.TM.GetTile(((X - XD) | 0), ((Y + 1) | 0));
                                    if (!(T3 != null && T3.enabled && T3.solid)) {
                                        var ret = new CirnoGame.RoomOpeningLever(game, new CirnoGame.Point(X, Y), Target, XD === 1);
                                        return ret.Alive ? ret : null;
                                    } else {
                                        return null;
                                    }
                                }
                            } else {
                                return null;
                            }
                        }
                    }
                    return null;
                }
            }
        },
        fields: {
            Room: null,
            Block: null
        },
        props: {
            Activated: false
        },
        ctors: {
            ctor: function (game, Tile, Target, flipped) {
                if (flipped === void 0) { flipped = false; }

                this.$initialize();
                CirnoGame.Entity.ctor.call(this, game);
                this.Ani = new CirnoGame.Animation(CirnoGame.AnimationLoader._this.GetAnimation("images/misc/lever"));
                this.Ani.ImageSpeed = 0;
                this.Block = Tile;
                var T = game.TM.GetTile(Tile.X, Tile.Y);
                CirnoGame.RoomOpeningLever.TEST = this;
                if (T != null && T.solid) {
                    if (Target != null) {
                        this.Room = Target;
                    }
                    T.Breakable = false;
                    T.CanSlope = false;
                    var R = T.GetHitbox();
                    if (flipped) {
                        this.Ani.Position.X = R.left - 16;
                        this.Ani.Flipped = true;
                    } else {
                        this.Ani.Position.X = R.right;
                    }
                    this.Ani.Position.Y = R.top;
                } else {
                    this.Alive = false;
                }
            }
        },
        methods: {
            Update: function () {
                CirnoGame.Entity.prototype.Update.call(this);
                var T = this.Game.TM.GetTile(this.Block.X, this.Block.X);
                if (T != null && T.enabled && T.solid) {
                    T.Breakable = false;
                    T.CanSlope = false;
                } else {
                    this.Alive = false;
                    if (this.Room != null) {
                        this.Room.ClearRoom();
                        this.Room.GeneratePlatforms();
                        this.Room.ApplyBreakable(); //attempt to remove seams
                        this.Room.ForceRedraw();
                    }
                    //Helper.Log("Removing broken lever...");
                }
                var P = this.Game.player;
                if (!this.Activated && P.Position.EstimatedDistance(this.Position) < 16 && P.Controller[System.Array.index(2, P.Controller)]) {
                    this.Activate();
                }
            },
            Activate: function () {
                if (!this.Activated) {
                    this.Activated = true;
                    this.PlaySound("open2"); //sounds better than the electronic switch.
                    this.Ani.CurrentFrame = 1;
                    this.Ani.SetImage();
                    this.Ani.Update();
                    this.Room.UnleashSecret();
                }
            }
        }
    });

    Bridge.define("CirnoGame.TextSprite", {
        inherits: [CirnoGame.Sprite],
        fields: {
            _Text: null,
            textInvallidated: false,
            imageInvallidated: false,
            TextImage: null,
            TextGraphic: null,
            _TextColor: null,
            _FontWeight: null,
            _FontFamily: null,
            _FontSize: 0,
            _shadowBlur: 0,
            _shadowOffset: null,
            _shadowColor: null
        },
        props: {
            Text: {
                get: function () {
                    return this._Text;
                },
                set: function (value) {
                    if (!Bridge.referenceEquals(this._Text, value)) {
                        this._Text = value;
                        /* RedrawBaseTextImage();
                        RenderTextImage();*/
                        this.textInvallidated = true;
                        //imageInvallidated = true;
                    }
                }
            },
            TextColor: {
                get: function () {
                    return this._TextColor;
                },
                set: function (value) {
                    if (!Bridge.referenceEquals(this._TextColor, value)) {
                        this._TextColor = value;
                        //RenderTextImage();
                        this.textInvallidated = true;

                        //imageInvallidated = true;
                    }
                }
            },
            FontWeight: {
                get: function () {
                    return this._FontWeight;
                },
                set: function (value) {
                    if (!Bridge.referenceEquals(this._FontWeight, value)) {
                        this._FontWeight = value;
                        this.UpdateFont();
                    }
                }
            },
            FontFamily: {
                get: function () {
                    return this._FontFamily;
                },
                set: function (value) {
                    if (!Bridge.referenceEquals(this._FontFamily, value)) {
                        this._FontFamily = value;
                        this.UpdateFont();
                    }
                }
            },
            FontSize: {
                get: function () {
                    return this._FontSize;
                },
                set: function (value) {
                    if (this._FontSize !== value) {
                        this._FontSize = value;
                        this.UpdateFont();
                    }
                }
            },
            ShadowBlur: {
                get: function () {
                    return this._shadowBlur;
                },
                set: function (value) {
                    if (this._shadowBlur !== value) {
                        this._shadowBlur = value;
                        this.imageInvallidated = true;
                    }
                }
            },
            ShadowOffset: {
                get: function () {
                    return this._shadowOffset.Clone();
                },
                set: function (value) {
                    if (CirnoGame.Vector2.op_Inequality(this._shadowOffset, value) && value.X !== this._shadowOffset.X && value.Y !== this._shadowOffset.Y) {
                        this._shadowOffset = value.Clone();
                        this.imageInvallidated = true;
                    }
                }
            },
            ShadowColor: {
                get: function () {
                    return this._shadowColor;
                },
                set: function (value) {
                    if (!Bridge.referenceEquals(this._shadowColor, value)) {
                        this._shadowColor = value;
                        this.imageInvallidated = true;
                    }
                }
            }
        },
        ctors: {
            init: function () {
                this._FontWeight = "normal";
                this._FontFamily = "sans-serif";
                this._FontSize = 10;
                this._shadowBlur = 0.0;
                this._shadowOffset = new CirnoGame.Vector2();
                this._shadowColor = "#000000";
            },
            ctor: function () {
                this.$initialize();
                CirnoGame.Sprite.ctor.call(this);
                this.TextImage = document.createElement("canvas");
                this.TextGraphic = this.TextImage.getContext("2d");
                this.TextGraphic.imageSmoothingEnabled = false;
                //TextGraphic.Font.
                this.TextImage.style.imageRendering = "pixelated";
                this.TextGraphic.fillStyle = "#FFFFFF";
            }
        },
        methods: {
            UpdateFont: function () {
                this.TextGraphic.font = System.String.concat(this._FontWeight, " ", this._FontSize, "px ", this._FontFamily);
                this.textInvallidated = true;
                this.imageInvallidated = true;
                this.TextGraphic.fillStyle = this._TextColor;
            },
            RedrawBaseTextImage: function () {
                this.UpdateFont();
                var lines = System.String.split(this._Text, [10].map(function(i) {{ return String.fromCharCode(i); }}));
                var H = this.FontSize * 1.0;


                var W = 0;
                var i = 0;
                while (i < lines.length) {
                    var TM = this.TextGraphic.measureText(lines[System.Array.index(i, lines)]);
                    W = Math.max(W, Bridge.Int.clip32(Math.ceil(TM.width)));
                    i = (i + 1) | 0;
                }
                //TextImage.Height = (int)(H * (lines.Length+0.5f));
                this.TextImage.height = Bridge.Int.clip32(H * (lines.length + 0.25));
                this.TextImage.width = W;
                this.UpdateFont();

                var Y = 0;
                i = 0;
                while (i < lines.length) {
                    this.TextGraphic.fillText(lines[System.Array.index(i, lines)], 0, this.FontSize + Y);
                    Y += H;
                    i = (i + 1) | 0;
                }

                this.textInvallidated = false;
                this.imageInvallidated = true;
            },
            RenderTextImage: function () {

                if (this._shadowBlur <= 0) {
                    this.spriteBuffer.width = this.TextImage.width;
                    this.spriteBuffer.height = this.TextImage.height;
                } else {
                    var S = Bridge.Int.clip32(Math.ceil(this._shadowBlur + this._shadowBlur));
                    this.spriteBuffer.width = (this.TextImage.width + S) | 0;
                    this.spriteBuffer.height = (this.TextImage.height + S) | 0;
                }
                this.spriteGraphics.shadowBlur = 0;

                this.spriteGraphics.globalCompositeOperation = "source-over";
                /* spriteGraphics.FillStyle = _TextColor;
                spriteGraphics.FillRect(0, 0, spriteBuffer.Width, spriteBuffer.Height);
                Script.Write("this.spriteGraphics.globalCompositeOperation = 'destination-in'");*/
                if (this._shadowBlur <= 0) {
                    this.spriteGraphics.drawImage(this.TextImage, 0.0, 0.0);
                } else {
                    this.spriteGraphics.drawImage(this.TextImage, this._shadowBlur, this._shadowBlur);
                }

                if (this._shadowBlur > 0) {
                    this.spriteGraphics.shadowBlur = this._shadowBlur;
                    this.spriteGraphics.shadowColor = this._shadowColor;
                    this.spriteGraphics.shadowOffsetX = this._shadowOffset.X;
                    this.spriteGraphics.shadowOffsetY = this._shadowOffset.Y;
                    this.spriteGraphics.drawImage(this.spriteBuffer, 0.0, 0.0);
                }



                this.imageInvallidated = false;
            },
            ForceUpdate: function () {
                if (this.textInvallidated) {
                    this.RedrawBaseTextImage();
                }
                if (this.imageInvallidated) {
                    this.RenderTextImage();
                }
            },
            Draw: function (g) {
                this.ForceUpdate();
                CirnoGame.Sprite.prototype.Draw.call(this, g);
            }
        }
    });

    Bridge.define("CirnoGame.Tile", {
        inherits: [CirnoGame.Entity],
        fields: {
            tile: 0
        },
        ctors: {
            ctor: function (game, tile) {
                this.$initialize();
                CirnoGame.Entity.ctor.call(this, game);
                this.tile = tile;
                this.Ani = new CirnoGame.Animation(CirnoGame.AnimationLoader.Get("images/land/brick"));
                this.Ani.CurrentFrame = tile;
                this.Ani.ImageSpeed = 0;
            }
        },
        methods: {
            Draw: function (g) {
                /* if (tile>=0 && tile < ani.images.Count)
                {
                   ani.currentFrame = tile;
                }*/
                CirnoGame.Entity.prototype.Draw.call(this, g);
            }
        }
    });

    Bridge.define("CirnoGame.TitleScreen", {
        inherits: [CirnoGame.Sprite],
        fields: {
            Title: null,
            Version: null,
            Desc: null,
            Controls: null,
            Credits: null,
            menu: null,
            Controller: null,
            game: null
        },
        ctors: {
            ctor: function () {
                this.$initialize();
                CirnoGame.Sprite.ctor.call(this);
                this.spriteBuffer.width = CirnoGame.App.Canvas.width;
                this.spriteBuffer.height = Bridge.Int.clip32(this.spriteBuffer.width * CirnoGame.App.TargetAspect);
                this.Title = new CirnoGame.TextSprite();
                this.Title.FontSize = Bridge.Int.clip32(this.spriteBuffer.width * 0.06);
                //Title.Text = "Cirno and the mysterious tower";
                this.Title.Text = CirnoGame.App.GameName;
                this.Title.TextColor = "#77FFFF";
                this.Title.ShadowColor = "#000000";
                this.Title.ShadowOffset = new CirnoGame.Vector2(2, 2);
                this.Title.ShadowBlur = 2;

                this.CenterTextWithFloats(this.Title, 0.5, 0.06);

                this.Version = new CirnoGame.TextSprite();
                this.Version.FontSize = Bridge.Int.clip32(this.spriteBuffer.width * 0.016);
                this.Version.Text = System.String.concat("Version:", CirnoGame.App.GameVersion);
                this.Version.TextColor = "#FFFFFF";
                this.Version.ShadowColor = "#000000";
                this.Version.ShadowOffset = new CirnoGame.Vector2(2, 2);
                this.Version.ShadowBlur = 2;

                this.CenterTextWithFloats(this.Version, 0.75, 0.11);

                /* Title.ForceUpdate();
                Title.Position.Y = spriteBuffer.Height * 0.01f;
                Title.Position.X = (spriteBuffer.Width / 2) - (Title.spriteBuffer.Width / 2);*/



                this.Desc = new CirnoGame.TextSprite();
                this.Desc.FontSize = Bridge.Int.clip32(this.spriteBuffer.width * 0.03);
                this.Desc.TextColor = "#FFFFFF";
                //Desc.Text = "Cirno has found herself in a strange dungeon filled with ghosts!\nHer energy has been stolen, reclaim the energy orbs to extend your time.\nFind the big key to unlock the door.";
                //Desc.Text = "Cirno has found herself in a strange dungeon filled with ghosts!\nReclaim your stolen energy sealed inside the orbs to extend your time.\nFind the gold key to unlock the door.";
                this.Desc.Text = "Cirno has found herself in a strange tower filled with ghosts!\nReclaim your stolen energy sealed inside the orbs to extend your time.\nRemember the door's location and search for the gold key.";
                this.Desc.ShadowColor = "#000000";
                this.Desc.ShadowOffset = new CirnoGame.Vector2(2, 2);
                this.Desc.ShadowBlur = 2;
                this.CenterTextWithFloats(this.Desc, 0.5, 0.2);

                this.Controls = new CirnoGame.TextSprite();
                this.Controls.FontSize = Bridge.Int.clip32(this.spriteBuffer.width * 0.025);
                this.Controls.TextColor = "#FFFFFF";
                this.Controls.Text = "Keyboard Controls:\nLeft/Right=Move\nUp/Down=Aim(Up activates chests/doors)\nZ=Shoot\nX=Jump/Mid-air jump\nA=Place block below you(costs time)\nEnter=Pause\nM=Toggle mute";
                this.Controls.ShadowColor = "#000000";
                this.Controls.ShadowOffset = new CirnoGame.Vector2(2, 2);
                this.Controls.ShadowBlur = 2;
                this.CenterTextWithFloats(this.Controls, 0.5, 0.4);
                this.Controls.Position.X = this.Desc.Position.X;

                this.menu = new CirnoGame.ButtonMenu(this.spriteBuffer.width * 0.8, this.spriteBuffer.height * 0.5, Bridge.Int.clip32(this.spriteBuffer.width * 0.05));
                var B = this.menu.AddButton("Start Game");
                B.OnClick = Bridge.fn.bind(this, function () {
                    this.game.Start();
                });
                //menu.Finish();
                B.Position.X += this.spriteBuffer.width * 0.38;
                B.Position.Y = this.spriteBuffer.height * 0.7;

                //var CB = menu.AddButton("Controller:"+InputControllerManager._this.Controllers[0].id);
                var CB = this.menu.AddButton(System.String.concat("Controller:", CirnoGame.App.IC.id));
                this.Controller = CB;
                CB.OnClick = function () {
                    var ind = CirnoGame.InputControllerManager._this.Controllers.indexOf(CirnoGame.App.IC);
                    ind = (ind + 1) | 0;
                    if (ind >= CirnoGame.InputControllerManager._this.Controllers.Count) {
                        ind = (ind - CirnoGame.InputControllerManager._this.Controllers.Count) | 0;
                    }
                    CirnoGame.App.IC = CirnoGame.InputControllerManager._this.Controllers.getItem(ind);
                    var TS = CB.Contents;
                    var W = TS.spriteBuffer.width;
                    TS.Text = System.String.concat("Controller:", CirnoGame.App.IC.id);
                    TS.ForceUpdate();
                    CB.Position.X -= ((((Bridge.Int.div((((TS.spriteBuffer.width - W) | 0)), 2)) | 0))) | 0;
                };
                CB.Position.X += this.spriteBuffer.width * 0.38;
                ;
                CB.Position.Y = B.Position.Y + (this.spriteBuffer.height * 0.15);
                //CB.Visible = false;
                CB.Lock();

                this.Credits = new CirnoGame.TextSprite();
                this.Credits.FontSize = Bridge.Int.clip32(this.spriteBuffer.width * 0.015);
                this.Credits.TextColor = "#77FFFF";
                //Credits.Text = "Made by:RSGmaker                                                                                                                     Touhou Project and it's characters are owned by ZUN";
                this.Credits.Text = "Made by:RSGmaker                                                                                                           Touhou Project and it's characters are owned by ZUN";
                this.Credits.ShadowColor = "#000000";
                this.Credits.ShadowOffset = new CirnoGame.Vector2(2, 2);
                this.Credits.ShadowBlur = 2;
                this.CenterTextWithFloats(this.Credits, 0.5, 0.98);
            }
        },
        methods: {
            CenterTextWithFloats: function (T, X, Y) {
                this.CenterText(T, new CirnoGame.Vector2(this.spriteBuffer.width * X, this.spriteBuffer.height * Y));
            },
            CenterText: function (T, Location) {
                T.ForceUpdate();
                T.Position.X = Location.X - (((Bridge.Int.div(T.spriteBuffer.width, 2)) | 0));
                T.Position.Y = Location.Y - (((Bridge.Int.div(T.spriteBuffer.height, 2)) | 0));
            },
            Draw: function (g) {
                CirnoGame.Sprite.prototype.Draw.call(this, g);
                if (this.Controller.locked && CirnoGame.InputControllerManager._this.Controllers.Count > 1) {
                    this.Controller.Unlock();
                }

                this.Title.Draw(g);
                this.Version.Draw(g);
                this.Desc.Draw(g);
                this.Controls.Draw(g);
                this.menu.Draw(g);
                this.menu.Update();
                this.Credits.Draw(g);

                //var M = KeyboardManager._this.MousePosition.Clone();
                var M = CirnoGame.KeyboardManager._this.CMouse.Clone();
                if (!System.String.contains(CirnoGame.App.Div.style.left,"px")) {
                    return;
                }
                /* M.X -= float.Parse(App.Div.Style.Left.Replace("px", ""));*/
                //Credits.Text = "X:" + M.X+"/"+(spriteBuffer.Width * 0.1) +" Y:"+M.Y+"/"+(spriteBuffer.Height * 0.96);
                if (M.X < this.spriteBuffer.width * 0.17 && M.Y >= this.spriteBuffer.height * 0.96) {
                    CirnoGame.App.Div.style.cursor = "pointer";
                    if (CirnoGame.KeyboardManager._this.TappedMouseButtons.contains(0)) {
                        Bridge.global.location.href = "https://rsgmaker.deviantart.com";
                    }
                } else {
                    CirnoGame.App.Div.style.cursor = null;
                }
            }
        }
    });

    Bridge.define("CirnoGame.Turret", {
        inherits: [CirnoGame.Entity,CirnoGame.ICombatant],
        fields: {
            attackpower: 0,
            TTD: null
        },
        props: {
            Team: 0,
            HP: 0,
            PointsForKilling: {
                get: function () {
                    return 1;
                }
            },
            TargetPriority: {
                get: function () {
                    return 0.5;
                }
            }
        },
        alias: [
            "Team", "CirnoGame$ICombatant$Team",
            "HP", "CirnoGame$ICombatant$HP",
            "PointsForKilling", "CirnoGame$ICombatant$PointsForKilling",
            "TargetPriority", "CirnoGame$ICombatant$TargetPriority",
            "onDamaged", "CirnoGame$ICombatant$onDamaged",
            "onDeath", "CirnoGame$ICombatant$onDeath",
            "onKill", "CirnoGame$ICombatant$onKill"
        ],
        ctors: {
            init: function () {
                this.attackpower = 1;
            },
            ctor: function (game) {
                this.$initialize();
                CirnoGame.Entity.ctor.call(this, game);
                this.Ani = new CirnoGame.Animation(CirnoGame.AnimationLoader._this.GetAnimation("images/enemies/turret"));
                this.Ani.ImageSpeed = 0;

                this.attackpower = 1 + (this.Game.level * 0.5);
                this.attackpower *= 2;
                this.HP = 0;
                this.Team = 2;
                //defensepower = 1 + (Game.level * 0.5f);
                if (this.Game.playing) {
                    var A = this.AddBehavior(CirnoGame.AimedShooter);
                    A.attackpower = this.attackpower;
                    A.maxtime = Math.max(((480 - (Bridge.Int.mul(this.Game.level, 10))) | 0), 380);
                    //A.maxtime = (int)(A.maxtime*1.75f);
                    A.maxtime = Bridge.Int.clip32(A.maxtime * 1.25);
                    A.ignoresterrain = true;
                    A.maxDistance *= 1.3;
                    A.maxShadow = 1;
                    A.bulletSpeed *= 0.8;
                    A.bulletDuration = 540;
                    A.bulletgraphic = "turretbullet";
                    A.attackTelegraphTime = (A.attackTelegraphTime + A.attackTelegraphTime) | 0;
                }
            }
        },
        methods: {
            getCenter: function () {
                return CirnoGame.Vector2.Add$1(this.Position, 5, 5);
            },
            onDamaged: function (source, amount) {
                //throw new NotImplementedException();
            },
            onDeath: function (source) {
                //throw new NotImplementedException();
            },
            onKill: function (combatant) {
                //throw new NotImplementedException();
            },
            SetDown: function (forcedown) {
                if (forcedown === void 0) { forcedown = false; }
                var TZ = this.Game.TM.tilesize;
                var TD = this.Game.TM.CheckForTile(this.Position);
                var attempts = 0;
                var direction = Math.random() < 0.5 ? TZ : -TZ;
                if (forcedown) {
                    direction = TZ;
                }
                while (!(TD != null && TD.solid && TD.visible) && attempts < 20) {
                    this.y += direction;
                    TD = this.Game.TM.CheckForTile(this.Position);
                }
                if (attempts >= 20) {
                    this.Alive = false;
                    return;
                } else {
                    this.x = (TD.column * TZ) + this.Game.TM.position.X;
                    this.y = (TD.row * TZ) + this.Game.TM.position.Y;
                    //TD.HP = TD.maxHP * 2;
                }
                this.TTD = TD;

            },
            Update: function () {
                var TD = this.Game.TM.CheckForTile(this.Position);
                if (TD != null && TD.solid && TD.visible && TD.opaque) {

                } else if (this.Alive) {
                    this.Alive = false;
                    var P = new CirnoGame.PointItem(this.Game);
                    P.Position.CopyFrom(this.Position);
                    P.collectionDelay = (Bridge.Int.div(P.collectionDelay, 2)) | 0;
                    this.Game.AddEntity(P);
                    if (Math.random() < 0.15) {
                        P = new CirnoGame.HealingItem(this.Game);
                        P.Position.CopyFrom(this.Position);
                        P.Vspeed = -2;
                        P.collectionDelay = (Bridge.Int.div(P.collectionDelay, 2)) | 0;
                        this.Game.AddEntity(P);
                    }
                    return;
                }
                if (TD.CanSlope) {
                    var redraw = false;
                    if (TD.SlopeDirection !== 0) {
                        redraw = true;
                    }
                    TD.CanSlope = false;
                    if (redraw) {
                        TD.UpdateTile();
                    }
                }
                if (this.Ani.Shadow > 0) {
                    this.Ani.ImageSpeed = 0.25;
                } else if (this.Ani.ImageSpeed > 0) {
                    this.Ani.ImageSpeed = 0;
                    this.Ani.CurrentFrame = 0;
                    this.Ani.SetImage();
                }
                CirnoGame.Entity.prototype.Update.call(this);

            }
        }
    });

    Bridge.define("CirnoGame.DoorKey", {
        inherits: [CirnoGame.CollectableItem],
        ctors: {
            ctor: function (game) {
                this.$initialize();
                CirnoGame.CollectableItem.ctor.call(this, game, "bigkey");
                this.floats = false;
                this.magnetDistance = 20;
                this.sound = "key";
            }
        },
        methods: {
            onCollected: function (player) {
                //throw new NotImplementedException();
                this.Game.Door.Opened = true;

                var FM = new CirnoGame.FloatingMessage(this.Game, "Door Unlocked!");
                FM.Text.TextColor = "#77FFFF";
                FM.Position = new CirnoGame.Vector2(this.x + 8, this.y - 20);
                this.Game.AddEntity(FM);
            },
            Update: function () {
                CirnoGame.CollectableItem.prototype.Update.call(this);
                if (this.y <= 0) {
                    this.Game.LevelRestart();
                }
            }
        }
    });

    Bridge.define("CirnoGame.Game", {
        inherits: [CirnoGame.GameSprite],
        statics: {
            methods: {
                GetTeamColor: function (team) {
                    if (team === 1) {
                        return "#FF0000";
                    } else if (team === 2 || team === 0) {
                        return "#0000FF";
                    } else if (team === 3) {
                        return "#FFFF00";
                    }
                    return "#000000";
                }
            }
        },
        fields: {
            player: null,
            entities: null,
            harmful: null,
            combatants: null,
            camera: null,
            stageBounds: null,
            TM: null,
            GamePlaySettings: null,
            TimerSprite: null,
            defaultTimeRemaining: 0,
            lastStand: 0,
            baseLifeCost: 0,
            timeRemaining: 0,
            totalTime: 0,
            level: 0,
            playing: false,
            paused: false,
            cameraWanderPoint: null,
            TS: null,
            Teams: false,
            skiprender: false,
            ScoreSprite: null,
            EG: null,
            Door: null,
            Key: null,
            BigKey: null,
            muted: false,
            lastPauseButtonState: false,
            ShowHitbox: false,
            freecam: false
        },
        props: {
            running: {
                get: function () {
                    return this.playing && !this.paused;
                }
            }
        },
        ctors: {
            init: function () {
                this.defaultTimeRemaining = 180000;
                this.lastStand = 30000;
                this.baseLifeCost = 15000;
                this.totalTime = 0;
                this.level = 0;
                this.playing = false;
                this.paused = false;
                this.Teams = true;
                this.skiprender = true;
                this.muted = false;
                this.lastPauseButtonState = false;
                this.ShowHitbox = false;
                this.freecam = false;
            },
            ctor: function () {
                this.$initialize();
                CirnoGame.GameSprite.ctor.call(this);
                this.GamePlaySettings = new CirnoGame.GamePlaySettings();
                this.Door = new CirnoGame.ExitDoor(this);
                this.entities = new (System.Collections.Generic.List$1(CirnoGame.Entity)).ctor();
                this.combatants = new (System.Collections.Generic.List$1(CirnoGame.Entity)).ctor();
                this.harmful = new (System.Collections.Generic.List$1(CirnoGame.Entity)).ctor();

                this.player = new CirnoGame.PlayerCharacter(this);
                this.player.HP = 0;
                this.timeRemaining = this.defaultTimeRemaining;
                //timeRemaining *= 0.3334f * 0.25f;

                /* test.Ani = new Animation(AnimationLoader._this.Get("images/cirno/walk"));
                test.Ani.ImageSpeed = 0.1f;*/

                //stageBounds = new Rectangle(0, 0, 8000, 3000);
                //stageBounds = new Rectangle(0, 0, 6000, 4000);
                //stageBounds = new Rectangle(0, 0, 2000, 1500);
                //stageBounds = new Rectangle(0, 0, 1000, 750);
                //stageBounds = new Rectangle(0, 0, 2000, 1000);
                this.stageBounds = new CirnoGame.Rectangle(0, 0, 4000, 2000);
                this.TM = new CirnoGame.TileMap(this);
                this.TM.Seed = Bridge.Int.clip32(Math.random() * System.Int64([1410065407,2]));
                this.TM.position.Y = 0;
                var R = CirnoGame.Rectangle.op_Subtraction(this.stageBounds, this.TM.position);
                R.width -= this.TM.tilesize;
                R.height -= this.TM.tilesize;
                //TM.DrawRect(R);



                this.player.Position.Y = this.stageBounds.height / 3;
                this.player.Position.X = this.stageBounds.width / 2;

                this.EG = CirnoGame.Helper.GetContext(document.createElement("canvas"));
                //MapGenerator.Generate(this);
                /* MapGenerator.BoxyGenerate(this);            
                TM.DrawRect(R);
                //TM.testTexture();
                TM.ApplyBreakable();*/
                /* var E = new Entity(this);
                E.Ani = new Animation(AnimationLoader.Get("Images/land/brick"));
                E.y += 24;
                entities.Add(E);
                var ln = 10;
                var i = 0;
                while (i < ln)
                {
                   E = new Entity(this);
                   E.Ani = new Animation(AnimationLoader.Get("Images/land/brick"));
                   E.y += 24;
                   E.x += 16 * (i+1);
                   entities.Add(E);
                   i++;
                }
                i = 0;
                while (i < ln)
                {
                   E = new Entity(this);
                   E.Ani = new Animation(AnimationLoader.Get("Images/land/brick"));
                   E.y += 24;
                   E.x += 16 * -(i + 1);
                   entities.Add(E);
                   i++;
                }*/


                //entities.Add(test);
                this.AddEntity(this.Door);


                //spriteBuffer.Width = 200;
                this.spriteBuffer.width = CirnoGame.App.Canvas.width;
                this.spriteBuffer.height = Bridge.Int.clip32(this.spriteBuffer.width * CirnoGame.App.TargetAspect);
                /* camera.viewport_width = spriteBuffer.Width;
                camera.viewport_height = spriteBuffer.Height;*/
                this.camera = new CirnoGame.Camera(this.spriteBuffer.width, this.spriteBuffer.height);
                //camera.Scale = 6;
                //camera.Scale = 4;
                //camera.Scale = 3.5f;
                this.camera.Scale = 3.75;

                //camera.Scale = 1f;
                this.camera.StageBounds = this.stageBounds;
                this.camera.Update();
                this.camera.instawarp = true;
                /* spriteBuffer.Width = App.Canvas.Width;
                spriteBuffer.Height = App.Canvas.Height;*/
                this.spriteGraphics.imageSmoothingEnabled = false;

                /* PlaceAndAddEntity(new DoorKey(this));

                var i = 0;
                //while (i < 110)
                while (i < 24)
                {
                   PlaceAndAddEntity(new MRGhosty(this));
                   i++;
                }
                i = 0;
                while (i++ <= 6)
                   PlaceAndAddEntity(new Orb(this));
                i = 0;
                while (i++ <= 3)
                {
                   PlaceAndAddEntity(new Chest(this));
                   PlaceAndAddEntity(new KeyItem(this));
                }
                i = 0;
                while (i++ <= 2)
                {
                   PlaceAndAddEntity(new HealingItem(this));
                }*/
                this.StartNextLevel();


                this.TimerSprite = new CirnoGame.TextSprite();
                this.TimerSprite.FontSize = (Bridge.Int.div(this.spriteBuffer.height, 24)) | 0;
                this.TimerSprite.Text = "3:00";
                this.TimerSprite.TextColor = "#FFFFFF";
                this.TimerSprite.ShadowColor = "#000000";
                this.TimerSprite.ShadowOffset = new CirnoGame.Vector2(3, 3);
                this.TimerSprite.ShadowBlur = 1;

                this.TimerSprite.Position.X = this.spriteBuffer.width * 0.47;
                this.TimerSprite.Position.Y = (Bridge.Int.div(((-this.TimerSprite.FontSize) | 0), 8)) | 0;

                this.ScoreSprite = new CirnoGame.TextSprite();
                //ScoreSprite.FontSize = spriteBuffer.Height / 24;
                this.ScoreSprite.FontSize = (Bridge.Int.div(this.spriteBuffer.height, 28)) | 0;
                this.ScoreSprite.Text = "Level:1 Score:0";
                this.ScoreSprite.TextColor = "#FFFFFF";
                this.ScoreSprite.ShadowColor = "#000000";
                this.ScoreSprite.ShadowOffset = new CirnoGame.Vector2(3, 3);
                this.ScoreSprite.ShadowBlur = 1;

                //ScoreSprite.Position.X = spriteBuffer.Width * 0.7f;
                this.ScoreSprite.ForceUpdate();
                this.ScoreSprite.Position.X = (this.spriteBuffer.width * 0.98) - this.ScoreSprite.spriteBuffer.width;
                this.ScoreSprite.Position.Y = (Bridge.Int.div(((-this.ScoreSprite.FontSize) | 0), 8)) | 0;

                this.Key = CirnoGame.AnimationLoader.Get("images/items/key").getItem(0);
                this.BigKey = CirnoGame.AnimationLoader.Get("images/items/bigkey").getItem(0);

                this.TS = new CirnoGame.TitleScreen();
                this.TS.game = this;

                //PlayMusic("theme2");
                this.SetMusic();
            }
        },
        methods: {
            ClearEntities: function () {
                var L = this.entities.toArray();
                var i = 0;
                while (i < L.length) {
                    var E = L[System.Array.index(i, L)];
                    //if (!(E == player || E is ExitDoor))
                    if (E.RemovedOnLevelEnd) {
                        E.Alive = false;
                        this.RemoveEntity(E);
                    }
                    i = (i + 1) | 0;
                }
            },
            StartNextLevel: function () {
                this.ClearEntities();
                CirnoGame.RoomOpeningLever.TEST = null;
                this.level = (this.level + 1) | 0;
                var R = CirnoGame.Rectangle.op_Subtraction(this.stageBounds, this.TM.position);
                R.width -= this.TM.tilesize;
                R.height -= this.TM.tilesize;
                this.TM.Generate();
                CirnoGame.MapGenerator.BoxyGenerate(this);
                //TM.DrawRect(R);
                //TM.ApplyBreakable();


                //var ghosts = (int)(Math.Min(18 + level * 2, 28) * 0.85);
                var ghosts = Bridge.Int.clip32(Math.min(((18 + Bridge.Int.mul(this.level, 2)) | 0), 28) * 1.0);
                var i = 0;
                //while (i < 110)
                while (i < ghosts) {
                    //if (Math.Random() < 0.67)
                    if (Math.random() < 0.5) {
                        this.PlaceAndAddEnemy(new CirnoGame.MRGhosty(this));
                    } else {
                        var spike = Math.random() < 0.25;
                        var T = new CirnoGame.Turret(this);
                        this.PlaceAndAddEnemy(T);
                        T.SetDown(spike);
                        if (spike) {
                            var TD = T.TTD;
                            if (TD != null && this.TM.rows > ((TD.row + 1) | 0)) {
                                var TDD = this.TM.data.get([TD.column, ((TD.row + 1) | 0)]);
                                if (TDD.enabled && TDD.solid) {
                                    T.Alive = false;

                                    TD.texture = 7;
                                    TD.Breakable = false;
                                    TD.CanSlope = false;
                                    TD.opaque = false;
                                    TD.SteppedOn = Bridge.fn.bind(this, function (E) {
                                        var IC = E;
                                        if (IC.blockprice > 0 && IC.invincibilitytime <= 0) {
                                            IC.onDamaged(null, 1.5 + (this.level * 1.5));
                                            IC.PlaySound("damaged");
                                            if (IC.HP <= 0) {
                                                IC.onDeath(null);
                                            }
                                        }
                                    });
                                }
                            }
                        }
                    }
                    i = (i + 1) | 0;
                }
                i = 0;
                //while (i++ <= 6)
                while (Bridge.identity(i, (i = (i + 1) | 0)) <= 4) {
                    this.PlaceAndAddEntity(new CirnoGame.Orb(this));
                }
                i = 0;
                while (Bridge.identity(i, (i = (i + 1) | 0)) <= 3) {
                    this.PlaceAndAddEntity(new CirnoGame.Chest(this));
                    this.PlaceAndAddEntity(new CirnoGame.KeyItem(this));
                }
                i = 0;
                while (Bridge.identity(i, (i = (i + 1) | 0)) <= 1) {
                    this.PlaceAndAddEntity(new CirnoGame.HealingItem(this));
                }

                var key = new CirnoGame.DoorKey(this);
                var attempts = 0;

                this.PlaceAndAddEntity(key);
                while (Math.abs(key.x - this.player.x) < 70 && attempts < 5) { //attempt to prevent key from spawning too close
                    console.log("Door key is too close, repositioning key...");

                    key.Position.CopyFrom(CirnoGame.MapRoom.FindAnyEmptySpot());
                    attempts = (attempts + 1) | 0;
                }
                CirnoGame.MapGenerator.keyroom = CirnoGame.MapRoom.FindRoom(key.Position);
                /* PlaceAndAddEntity(new DoorKey(this));
                PlaceAndAddEntity(new DoorKey(this));
                PlaceAndAddEntity(new DoorKey(this));
                PlaceAndAddEntity(new DoorKey(this));*/

                this.player.invincibilitytime = 180;
                this.camera.instawarp = true;
                this.skiprender = true;
                if (this.playing) {
                    this.SetMusic();
                }
            },
            SetMusic: function () {
                if (!this.playing) {
                    this.PlayMusic("theme3");
                    return;
                }
                var songs = 3;
                var levelspersong = 5;
                var S = ((Bridge.Int.div(this.level, levelspersong)) | 0);
                S = S % songs;
                this.PlayMusic("theme" + (((S + 1) | 0)));
            },
            PlaceAndAddEntity: function (E) {
                E.Position.CopyFrom(CirnoGame.MapRoom.FindAnyEmptySpot());
                this.AddEntity(E);
            },
            PlaceAndAddEnemy: function (E) {
                E.Position.CopyFrom(CirnoGame.MapRoom.FindAnyEmptySpot());
                var attempts = 1;
                while (E.Position.EstimatedDistance(this.player.Position) < 128 && attempts < 5) {
                    console.log("Enemy spawned too close, repositioning enemy...");

                    E.Position.CopyFrom(CirnoGame.MapRoom.FindAnyEmptySpot());
                    attempts = (attempts + 1) | 0;
                }
                this.AddEntity(E);
                this.AddEntity(E);
            },
            Update: function () {
                CirnoGame.GameSprite.prototype.Update.call(this);
                this.Teams = this.GamePlaySettings.GameMode.Teams;
                //if (playing && KeyboardManager._this.TappedButtons.Contains(13))
                if (this.playing && CirnoGame.App.IC.getPressed(5) && !this.lastPauseButtonState) {
                    this.paused = !this.paused;
                }
                this.lastPauseButtonState = CirnoGame.App.IC.getPressed(5);
                if (this.playing && CirnoGame.KeyboardManager._this.TappedButtons.contains(77)) {
                    CirnoGame.AudioManager._this.StopAll();
                    this.muted = !this.muted;
                    if (!this.muted) {
                        this.SetMusic();
                    }
                    CirnoGame.KeyboardManager._this.TappedButtons.remove(77);
                }
                if (!this.paused) {
                    this.UpdateControls();

                    var i = 0;
                    while (i < this.entities.Count) {
                        var E = this.entities.getItem(i);
                        if (E.Alive) {
                            E.Update();
                        }
                        if (!E.Alive) {
                            this.RemoveEntity(E);
                            i = (i - 1) | 0;
                        }
                        i = (i + 1) | 0;
                    }
                    this.UpdateCollisions();
                    this.UpdateTime();
                    if (this.playing && this.player.y < 0) {
                        //player glitched out somehow make a new level.
                        this.LevelRestart();
                    }
                } else {
                    this.TimerSprite.Text = "Paused";
                }
            },
            LevelRestart: function () {
                this.level = (this.level - 1) | 0;
                this.StartNextLevel();
            },
            DoGameOver: function () {
                if (!this.playing) {
                    return;
                }
                if (this.entities.contains(this.player)) {
                    this.RemoveEntity(this.player);
                    //DoGameOver();
                }
                this.playing = false;
                this.StartNextLevel();

            },
            UpdateTime: function () {
                var $t;
                //timeRemaining -= 16.66667f;
                if (this.paused) {
                    this.TimerSprite.Text = "Paused";
                    return;
                }
                if (this.timeRemaining <= 0) {
                    this.timeRemaining = 0;
                    this.TimerSprite.Text = "0";
                    this.TimerSprite.TextColor = "#FF0000";
                    if (this.player.HP > 0) {
                        this.player.HP -= 0.006;
                    } else {
                        this.DoGameOver();
                    }
                    return;
                } else if (this.timeRemaining < this.baseLifeCost) {
                    this.TimerSprite.TextColor = "#FF0000";
                } else if (this.timeRemaining < this.lastStand) {
                    this.TimerSprite.TextColor = "#FFFF00";
                } else {
                    this.TimerSprite.TextColor = "#FFFFFF";
                }
                var totalseconds = this.timeRemaining / 1000.0;
                var totalminutes = totalseconds / 60;

                var minutes = Bridge.Int.clip32(Math.floor(totalminutes));
                var seconds = (totalseconds - (Bridge.Int.mul(minutes, 60)));

                var S = "";
                if (minutes > 0) {
                    S = "" + minutes + ":";
                }
                var prefix = "";
                if (seconds < 10) {
                    prefix = "0";
                    if (totalseconds < 10) {
                        prefix = " ";
                    }
                }
                S = System.String.concat(S, this.RestrictLength(System.String.concat(prefix, System.Single.format(Math.max(0, seconds))), 4));
                if (totalseconds >= 60) {
                    if (System.String.indexOf(S, ".") >= 0) {
                        S = ($t = S.split("."))[System.Array.index(0, $t)];
                    }
                }
                this.TimerSprite.Text = S;
            },
            RestrictLength: function (s, length) {
                if (s.length > length) {
                    return s.substr(0, length);
                }
                return s;
            },
            UpdateCollisions: function () {
                //List<Entity> combatants = new List<Entity>(System.Linq.Enumerable.Where<global::CirnoGame.Entity>(entities, (global::System.Func<global::CirnoGame.Entity, bool>)(entity => entity is ICombatant && entity.Ani.CurrentImage != null && ((ICombatant)entity).HP > 0)));
                //List<Entity> harmfulEntity = new List<Entity>(System.Linq.Enumerable.Where<global::CirnoGame.Entity>(entities, (global::System.Func<global::CirnoGame.Entity, bool>)(entity => entity is IHarmfulEntity && entity.Ani.CurrentImage != null)));
                var combatants = new (System.Collections.Generic.List$1(CirnoGame.Entity)).$ctor1(System.Linq.Enumerable.from(this.combatants).where(function (entity) {
                        return entity.Ani.CurrentImage != null && (entity).CirnoGame$ICombatant$HP > 0;
                    }));
                var harmfulEntity = new (System.Collections.Generic.List$1(CirnoGame.Entity)).$ctor1(System.Linq.Enumerable.from(this.harmful).where(function (entity) {
                        return entity.Ani.CurrentImage != null;
                    }));
                var R2 = new CirnoGame.Rectangle();
                var OR2 = new CirnoGame.Rectangle();
                var i = 0;
                var count = combatants.Count;
                var spd = new CirnoGame.Vector2();
                var spd2 = new CirnoGame.Vector2();
                while (i < count) {
                    var E = { v : combatants.getItem(i) };
                    //if (E is ICombatant)
                    {
                        var EI = { v : E.v };
                        var R = E.v.GetHitbox();
                        spd.CopyFrom(E.v.Speed);
                        spd.Multiply(0.5);
                        //Vector2 spd = E.Speed * 0.5f;
                        //spd.CopyFrom()
                        //Rectangle R2 = new Rectangle(R.x - (spd.X), R.y - (spd.Y), R.width, R.height);
                        R2.Set(R.x - (spd.X), R.y - (spd.Y), R.width, R.height);
                        //List<Entity> L = new List<Entity>(harmfulEntity.Where(entity => entity != E && entity.GetHitbox().isTouching(R)));
                        //List<Entity> L = new List<Entity>(harmfulEntity.Where(entity => entity != E && ((ICombatant)((IHarmfulEntity)entity).Attacker).Team != EI.Team));
                        //List<Entity> L = new List<Entity>(System.Linq.Enumerable.Where<global::CirnoGame.Entity>(harmfulEntity, (global::System.Func<global::CirnoGame.Entity, bool>)(entity => entity != E && !((IHarmfulEntity)entity).Attacker.SameTeam((Entity)EI))));
                        var L = new (System.Collections.Generic.List$1(CirnoGame.Entity)).$ctor1(System.Linq.Enumerable.from(harmfulEntity).where((function ($me, E, EI) {
                                return function (entity) {
                                    return !Bridge.referenceEquals(entity, E.v) && !(entity).CirnoGame$IHarmfulEntity$Attacker.SameTeam(EI.v);
                                };
                            })(this, E, EI)));
                        var j = 0;
                        var ln = L.Count;
                        while (j < ln) {
                            var tmp = L.getItem(j);
                            var HE = tmp;
                            var OR = tmp.GetHitbox();
                            //Vector2 spd2 = tmp.Speed * 0.5f;
                            spd2.CopyFrom(tmp.Speed);
                            spd2.Multiply(0.5);
                            //Rectangle OR2 = new Rectangle(OR.x - (spd2.X), OR.y - (spd2.Y), OR.width, OR.height);
                            OR2.Set(OR.x - (spd2.X), OR.y - (spd2.Y), OR.width, OR.height);
                            //if (EI.Team != ((ICombatant)HE.Attacker).Team)
                            if ((R.isTouching(OR) || R2.isTouching(OR2))) {
                                if (HE.CirnoGame$IHarmfulEntity$ontouchDamage(EI.v)) {
                                    var LHP = EI.v.CirnoGame$ICombatant$HP;
                                    EI.v.CirnoGame$ICombatant$onDamaged(HE, HE.CirnoGame$IHarmfulEntity$touchDamage);
                                    var damaged = LHP > EI.v.CirnoGame$ICombatant$HP;

                                    if (damaged) {
                                        if (Bridge.referenceEquals(EI.v, this.player)) {
                                            EI.v.PlaySound("damaged");
                                        } else {
                                            EI.v.PlaySound("hit");
                                        }
                                    }

                                    if (EI.v.CirnoGame$ICombatant$HP <= 0) {
                                        if (EI.v.HandledLocally) {
                                            var D = { };
                                            D.I = EI.v.ID;
                                            D.A = HE.CirnoGame$IHarmfulEntity$Attacker.ID;
                                            D.S = HE.ID;
                                            this.SendEvent("Kill", D);
                                        }
                                        /* if (damaged)
                                        {
                                           EI.As<Entity>().PlaySound("kill");
                                        }*/
                                    } else {
                                        /* if (damaged)
                                        {
                                           EI.As<Entity>().PlaySound("hit");
                                        }*/
                                    }
                                }
                                this.Attack(EI.v, HE);
                            }
                            j = (j + 1) | 0;
                        }
                        /* List<Entity> L = new List<Entity>(combatants.Where(entity => entity != E && entity is ICombatant && entity.GetHitbox().intersects(R)));
                        int j = 0;
                        while (j < L.Count)
                        {

                           j++;
                        }*/
                    }
                    i = (i + 1) | 0;
                }
            },
            Attack: function (target, source) {
                if (target.CirnoGame$ICombatant$HP > 0 && source.CirnoGame$IHarmfulEntity$ontouchDamage(target)) {
                    target.CirnoGame$ICombatant$onDamaged(source, source.CirnoGame$IHarmfulEntity$touchDamage);
                    //((Entity)target).PlaySound("hit");
                    if (target.CirnoGame$ICombatant$HP <= 0) {
                        if (Bridge.cast(target, CirnoGame.Entity).HandledLocally) {
                            var D = { };
                            D.I = Bridge.cast(target, CirnoGame.Entity).ID;
                            D.A = source.CirnoGame$IHarmfulEntity$Attacker.ID;
                            D.S = Bridge.cast(source, CirnoGame.Entity).ID;
                            this.SendEvent("Kill", D);
                        }
                    }
                }
            },
            PlaySoundEffect: function (source, sound) {
                if (this.muted) {
                    return;
                }
                var vol = 1.0;
                /* float min = 640;
                float maxLength = 320;*/
                //float min = 700;
                var min = 50;
                var maxLength = 200;
                if (CirnoGame.Vector2.op_Inequality(source, null)) {
                    //float dist = (camera.Center - source).RoughLength;
                    //float dist = (camera.Center - source).Length;
                    var dist = this.camera.Center.EstimatedDistance(source);
                    dist -= min;
                    if (dist > 0) {
                        if (dist >= maxLength) {
                            //volume of 0, just don't play it.
                            return;
                        } else {
                            vol = 1.0 - (dist / maxLength);
                        }
                    }
                }
                CirnoGame.AudioManager._this.Blast(System.String.concat("SFX/", sound, ".ogg"), vol);
            },
            AddEntity: function (E) {
                this.entities.add(E);
                if (Bridge.is(E, CirnoGame.ICombatant)) {
                    this.combatants.add(E);
                }
                if (Bridge.is(E, CirnoGame.IHarmfulEntity)) {
                    this.harmful.add(E);
                }
            },
            RemoveEntity: function (E) {
                E.onRemove();
                this.entities.remove(E);
                if (Bridge.is(E, CirnoGame.ICombatant)) {
                    this.combatants.remove(E);
                }
                if (Bridge.is(E, CirnoGame.IHarmfulEntity)) {
                    this.harmful.remove(E);
                }
            },
            Render: function () {
                CirnoGame.GameSprite.prototype.Render.call(this);

                var g = this.spriteGraphics;
                if (this.skiprender) {
                    g = this.EG;
                    this.skiprender = false;
                }
                this.UpdateCamera();
                this.DrawBackground(g);

                g.save();

                this.camera.Apply(g);
                //TM.position.Y = -200;
                this.TM.Draw(g);
                this.entities.forEach(function (E) {
                    if (E.Alive && E.Visible) {
                        E.Draw(g);
                    }
                });

                g.restore();

                if (this.playing) {
                    this.RenderGUI(g);
                } else {
                    g.globalAlpha = 0.3;
                    g.fillStyle = "#000000";
                    g.fillRect(0, 0, this.spriteBuffer.width, this.spriteBuffer.height);
                    g.globalAlpha = 1.0;
                    this.TS.Draw(g);
                    if (this.player.score > 0) {
                        this.ScoreSprite.Text = "Level:" + this.level + " Score:" + this.player.score;
                        this.ScoreSprite.ForceUpdate();
                        this.ScoreSprite.Position.X = (this.spriteBuffer.width * 0.98) - this.ScoreSprite.spriteBuffer.width;
                        this.ScoreSprite.Draw(g);
                    }
                }

            },
            Start: function () {
                if (this.entities.contains(this.player)) {
                    this.RemoveEntity(this.player);
                }
                this.player = new CirnoGame.PlayerCharacter(this);
                this.AddEntity(this.player);
                this.playing = true;
                this.level = 0;
                this.StartNextLevel();
                CirnoGame.App.Div.style.cursor = null;

                this.totalTime = 0;
                this.timeRemaining = this.defaultTimeRemaining;
                //timeRemaining *= 0.3334f * 0.25f;
                /* timeRemaining *= 0.3334f * 0.05f;
                player.HP = 5;*/
            },
            PlayMusic: function (song) {
                if (this.muted) {
                    return;
                }
                var M = CirnoGame.AudioManager._this.Get(System.String.concat("BGM/", song, ".ogg"));
                if (!M.IsPlaying) {
                    CirnoGame.AudioManager._this.StopAllFromDirectory("BGM/");
                    //M.Volume = 0.35;
                    M.Volume = 0.35;
                    M.Loop = true;
                    M.Play();
                }
            },
            RenderGUI: function (g) {
                var PC = this.player;
                var color = "#00DD00";
                if (this.timeRemaining < this.baseLifeCost) {
                    if (this.timeRemaining <= 0) {
                        color = "#CC0088";
                    } else {
                        color = "#FF0000";
                    }
                }

                g.globalAlpha = 0.8;
                this.DrawGauge(g, new CirnoGame.Vector2(0, 0), new CirnoGame.Vector2(((Bridge.Int.div(this.spriteBuffer.width, 4)) | 0), ((Bridge.Int.div(this.spriteBuffer.height, 20)) | 0)), 5, PC.HP / PC.maxHP, color);
                g.globalAlpha = 1;

                this.TimerSprite.Draw(g);
                this.ScoreSprite.Text = "Level:" + this.level + " Score:" + this.player.score;
                this.ScoreSprite.ForceUpdate();
                this.ScoreSprite.Position.X = (this.spriteBuffer.width * 0.98) - this.ScoreSprite.spriteBuffer.width;
                this.ScoreSprite.Draw(g);
                this.RenderIcons(g);
            },
            RenderIcons: function (g) {
                var R = (Bridge.Int.div(this.Key.height, this.Key.width)) | 0;
                var W = this.spriteBuffer.width * 0.02;
                var H = this.spriteBuffer.height * 0.055;

                var Y = H;
                var X = W / 2;
                var i = 0;

                //var sz = spriteBuffer.Width * 0.015f;
                var sz = this.spriteBuffer.width * 0.0115;
                g.globalAlpha = 0.8;
                if (this.Door.Opened) {
                    var DA = this.BigKey;
                    //var Dsz = spriteBuffer.Width * 0.018f;
                    var Dsz = sz * 1.5;
                    var DR = (Bridge.Int.div(DA.height, DA.width)) | 0;

                    g.drawImage(DA, X, Y, Dsz, Dsz * R);
                    X += W;
                }
                while (i < this.player.keys) {
                    g.drawImage(this.Key, X, Y, sz, sz * R);
                    X += W;
                    i = (i + 1) | 0;
                }
                g.globalAlpha = 1.0;
            },
            DrawGauge: function (g, position, size, border, progress, color, drawborder) {
                if (drawborder === void 0) { drawborder = true; }
                var alpha = g.globalAlpha;
                if (drawborder) {
                    g.globalAlpha = 0.6 * alpha;
                    g.fillStyle = "#000000";

                    g.fillRect(position.X, position.Y, size.X, size.Y);
                }

                g.fillStyle = color;
                g.globalAlpha = 1.0 * alpha;
                g.fillRect(((Bridge.Int.clip32(position.X) + border) | 0), ((Bridge.Int.clip32(position.Y) + border) | 0), (size.X - (((border + border) | 0))) * progress, ((Bridge.Int.clip32(size.Y) - (((border + border) | 0))) | 0));

                g.globalAlpha = 0.5 * alpha;
                //Script.Write("var grd = g.createLinearGradient(0, 0, 0, size.y);grd.addColorStop(0, color);grd.addColorStop(0.4, \"white\");grd.addColorStop(1, color);g.fillStyle = grd;");
                var grd = g.createLinearGradient(0, 0, 0, size.Y);
                grd.addColorStop(0, color);
                grd.addColorStop(0.4, "white");
                grd.addColorStop(1, color);
                g.fillStyle = grd;


                g.fillRect(((Bridge.Int.clip32(position.X) + border) | 0), ((Bridge.Int.clip32(position.Y) + border) | 0), (size.X - (((border + border) | 0))) * progress, ((Bridge.Int.clip32(size.Y) - (((border + border) | 0))) | 0));
                g.globalAlpha = alpha;
            },
            SendEvent: function (eventName, data, triggerflush) {
                if (triggerflush === void 0) { triggerflush = false; }
                var D = { };
                D.E = eventName;
                D.D = data;
                /* NetPlayUser NU = null;
                if (Online)
                {
                   NP.Send(D);
                   NU = NP.Me;
                }*/
                //ProcessEvent(D, NU, 0);
                this.ProcessEvent(D);
                /* if (triggerflush)
                {
                   NetPlayNeedsFlush = true;
                }*/
            },
            ProcessEvent: function (msg, user, latency) {
                if (user === void 0) { user = null; }
                if (latency === void 0) { latency = 0.0; }
                var D = msg.D;
                /* List<Player> LP = new List<Player>(players.Where(player => user != null && player.NetworkID == user.userID));
                Player P = null;

                bool hascharacter = true;
                if (LP.Count <= 0)
                {
                   if (P == null && user == null && !Online)
                   {
                       P = localplayer;
                   }
                   else
                   {
                       if (user.IsMe)
                       {
                           localplayer.NetworkID = user.userID;
                           P = localplayer;
                       }
                       else
                       {
                           hascharacter = false;
                       }
                   }
                }
                else
                {
                   P = LP[0];
                }*/
                var evt = msg.E;
                /* if (user != null && !user.IsMe)
                {
                   Dlatency += latency;
                   //latency *= 0.99f;
                   Dlatency *= (1 - (1 / latencyM));
                }
                //if (msg.E == "Init" && !P.local)
                if (evt == "Init" && P == null)
                {
                   if (!hascharacter)
                   {
                       P = new Player(false, false);
                       P.NetworkID = user.userID;
                       //PlayerCharacter PC = new PlayerCharacter(this, P, "Reisen");
                       PlayerCharacter PC = new PlayerCharacter(this, P, D.C);
                       //PC.Team = 1;
                       PC.Team = D.T;
                       PC.x = 700;
                       PC.y = 240;
                       PC.ID = D.I;
                       players.Add(P);
                       AddEntity(PC);
                       if (Hoster)
                       {
                           SendEvent("MapSeed", TM.Seed);

                           List<Entity> L = new List<Entity>(entities.Where(E => E is MadnessOrb || (E is PlayerCharacter && ((PlayerCharacter)E).player.CPU)));
                           int i = 0;
                           while (i < L.Count)
                           {
                               SendEntitySpawnCheck(L[i]);
                               i++;
                           }
                       }
                       Console.WriteLine("User:" + P.NetworkID + " has joined!");
                   }
                }
                if (evt == "Spawn")
                {
                   Entity E = EntityFromID(D.I);
                   if (E == null)
                   {
                       Type T = Helper.GetType(D.T);
                       E = Activator.CreateInstance(T, this).ToDynamic();
                       E.ID = D.I;
                       E.x = D.X;
                       E.y = D.Y;

                       if (D.D)
                       {
                           Helper.CopyFields(D.D, E);
                       }
                       AddEntity(E);
                       CatchupEntity(E, latency);
                       //Activator.CreateInstance()
                       //System.Reflection.
                       //Type T = Type.GetType("");
                   }
                }
                if (evt == "Unpause")
                {
                   paused = false;
                   Console.WriteLine("Game unpaused");
                   SendInit();
                }
                if (evt == "MapSeed" && !Hoster)
                {
                   if (TM.Seed != D)
                   {
                       TM.Seed = D;
                       TM.Generate();
                       //clean up local client entities.
                       if (!connected)
                       {
                           int i = 0;
                           while (i < entities.Count)
                           {
                               if (entities[i] is MadnessOrb || (entities[i] is PlayerCharacter && ((PlayerCharacter)entities[i]).player.CPU))
                               {
                                   RemoveEntity(entities[i]);
                                   i--;
                               }
                               i++;
                           }
                           connected = true;
                       }
                   }

                }
                if (evt == "CE")
                {
                   Entity entity = EntityFromID(D.I);
                   if (entity != null)
                   {
                       entity.CustomEvent(D.D);
                   }
                }
                if (evt == "CBE")
                {
                   Entity entity = EntityFromID(D.I);
                   if (entity != null)
                   {
                       EntityBehavior b = entity.GetBehaviorFromName(D.T);
                       b.CustomEvent(D.D);
                       //entity.CustomEvent(D.D);
                   }
                }*/
                if (Bridge.referenceEquals(evt, "Kill")) {
                    var entity = this.EntityFromID(D.I);
                    if (entity != null) {
                        var attacker = this.EntityFromID(D.A);
                        Bridge.cast(entity, CirnoGame.ICombatant).CirnoGame$ICombatant$onDeath(this.EntityFromID(D.S));
                        if (attacker != null && Bridge.is(attacker, CirnoGame.PlayerCharacter)) {
                            var PC = Bridge.cast(attacker, CirnoGame.PlayerCharacter);
                            //PC.player.Score += ((ICombatant)entity).PointsForKilling;
                            PC.score = (PC.score + Bridge.cast(entity, CirnoGame.ICombatant).CirnoGame$ICombatant$PointsForKilling) | 0;
                            PC.onKill(Bridge.cast(entity, CirnoGame.ICombatant));
                        }
                    }
                }
            },
            EntityFromID: function (ID) {
                var i = 0;
                while (i < this.entities.Count) {
                    var E = this.entities.getItem(i);
                    if (Bridge.referenceEquals(E.ID, ID)) {
                        return E;
                    }
                    i = (i + 1) | 0;
                }
                return null;
            },
            UpdateCamera: function () {
                var $t, $t1;
                //float D = test.Hspeed * 18;
                //float D = (float)Math.Abs(test.Hspeed) * 9;
                //var freecam = true;
                this.camera.speedmod = 1.0;

                /* if (KeyboardManager._this.TappedButtons.ContainsB(67) && App.DEBUG)
                {
                   freecam = !freecam;
                }*/
                if (this.freecam) {
                    var spd = 16 / this.camera.Scale;
                    var PB = CirnoGame.KeyboardManager._this.PressedButtons;
                    //numpad panning
                    if (CirnoGame.HelperExtensions.ContainsB$1(System.Int32, PB, Bridge.box(100, System.Int32))) {
                        this.camera.TargetPosition.X -= spd;
                    }
                    if (CirnoGame.HelperExtensions.ContainsB$1(System.Int32, PB, Bridge.box(102, System.Int32))) {
                        this.camera.TargetPosition.X += spd;
                    }

                    if (CirnoGame.HelperExtensions.ContainsB$1(System.Int32, PB, Bridge.box(104, System.Int32))) {
                        this.camera.TargetPosition.Y -= spd;
                    }
                    if (CirnoGame.HelperExtensions.ContainsB$1(System.Int32, PB, Bridge.box(98, System.Int32))) {
                        this.camera.TargetPosition.Y += spd;
                    }
                    if (CirnoGame.HelperExtensions.ContainsB$1(System.Int32, PB, Bridge.box(107, System.Int32))) {
                        var CC = this.camera.Center;
                        this.camera.Scale *= 1.01;
                        this.camera.Center = CC;
                        this.camera.TargetPosition.X = this.camera.Position.X;
                        this.camera.TargetPosition.Y = this.camera.Position.Y;
                    }
                    if (CirnoGame.HelperExtensions.ContainsB$1(System.Int32, PB, Bridge.box(109, System.Int32))) {
                        var CC1 = this.camera.Center;
                        this.camera.Scale *= 0.99;
                        this.camera.Center = CC1;
                        this.camera.TargetPosition.X = this.camera.Position.X;
                        this.camera.TargetPosition.Y = this.camera.Position.Y;
                    }
                    if (CirnoGame.HelperExtensions.ContainsB$1(System.Int32, PB, Bridge.box(36, System.Int32))) {
                        this.camera.CenteredTargetPosition = this.player.Position;
                    }
                    if (CirnoGame.HelperExtensions.ContainsB$1(System.Int32, PB, Bridge.box(13, System.Int32))) {
                        this.player.Position.X = this.camera.Center.X;
                        this.player.Position.Y = this.camera.Center.Y;
                    }
                    this.camera.Update();
                    return;
                }
                if (!this.playing) {
                    this.camera.speedmod = 0.05;
                    if (CirnoGame.Vector2.op_Equality(this.camera.TargetPosition, null) || this.camera.Position.EstimatedDistance(this.camera.TargetPosition) < 40) {
                        if (Math.random() < 0.0035 || this.camera.instawarp) {
                            this.camera.CenteredTargetPosition = CirnoGame.MapRoom.FindAnyEmptySpot();
                        }
                    }
                    /* camera.TargetPosition = null;
                    if (cameraWanderPoint == null)
                    {
                       cameraWanderPoint = MapRoom.FindAnyEmptySpot();
                    }*/
                    this.camera.Update();
                    return;
                }

                if (this.freecam) {
                    if (CirnoGame.KeyboardManager._this.PressedButtons.contains(101) || CirnoGame.KeyboardManager._this.PressedButtons.contains(111)) {
                        var TEST = CirnoGame.RoomOpeningLever.TEST;
                        if (CirnoGame.KeyboardManager._this.PressedButtons.contains(106) && !TEST.Activated) {
                            TEST.Activate();
                        }
                        if (TEST != null) {
                            if (!TEST.Activated && !CirnoGame.KeyboardManager._this.PressedButtons.contains(111)) {
                                this.camera.CenteredTargetPosition = TEST.Position;
                            } else {
                                var T = this.TM.GetTile(TEST.Room.SX, TEST.Room.SY);
                                var HB = T.GetHitbox();
                                this.camera.CenteredTargetPosition = new CirnoGame.Vector2(HB.left, HB.top);
                            }
                            if (CirnoGame.KeyboardManager._this.TappedButtons.contains(32)) {
                                this.player.Position.X = this.camera.Center.X;
                                this.player.Position.Y = this.camera.Center.Y;
                            }
                            this.camera.Update();
                            return;
                        } else {
                            this.player.MSG.ChangeText("No lever on map");
                        }
                    }
                }
                if (this.player.HP < 0) {
                    return;
                }
                var D = this.player.Hspeed * 32;
                var lookAheadRate = 0.3;
                var H = this.camera.CameraBounds.width / 8;
                D += !this.player.Ani.Flipped ? H : -H;
                var C = CirnoGame.App.Canvas;
                var IS = this.camera.InvScale;
                var V = Math.max(0, this.player.Vspeed * 30);
                if (($t = this.player.Controller)[System.Array.index(2, $t)]) {
                    //V -= camera.CameraBounds.height / 4;
                    V -= this.camera.CameraBounds.height / 3;
                } else if (($t1 = this.player.Controller)[System.Array.index(3, $t1)]) {
                    //V += camera.CameraBounds.height / 4;
                    V += this.camera.CameraBounds.height / 3;
                } else if (this.player.onGround) {
                    //V -= camera.CameraBounds.height / 8;
                    V -= this.camera.CameraBounds.height / 10;
                } else {
                    V += this.camera.CameraBounds.height / 12;
                }

                var TP = this.camera.TargetPosition;
                /* TP.X = (test.x + D) - ((C.Width / 2) * IS);
                TP.Y = (float)Math.Max(0, (test.y + V) - ((C.Height / 2) * IS));*/
                /* TP.X = test.x;
                TP.Y = test.y;*/
                var X = this.player.x + (this.player.Width / 2) + (D * lookAheadRate);
                var Y = this.player.y + (this.player.Height / 2) + (V * lookAheadRate);
                this.camera.CenteredTargetPosition = new CirnoGame.Vector2(X, Y);
                this.camera.Update();
            },
            DrawBackground: function (g) {
                g.fillStyle = "#77AAFF";
                g.fillRect(0, 0, CirnoGame.App.Canvas.width, CirnoGame.App.Canvas.height);
                /* if (BG < 0 || BG >= BGs.Count)
                {
                   g.FillStyle = "#77AAFF";
                   g.FillRect(0, 0, App.Canvas.Width, App.Canvas.Height);
                }
                else
                {
                   g.DrawImage(BGs[BG], (float)0, (float)0);
                }*/
            },
            UpdateControls: function () {

                var PC = this.player;
                var threshhold = 0.7;
                var C = PC.Controller;
                var IC = CirnoGame.App.IC;

                if (IC == null) {
                    return;
                }
                var x = IC.getState(0);
                var y = IC.getState(1);
                C[System.Array.index(0, C)] = x <= -threshhold;
                C[System.Array.index(1, C)] = x >= threshhold;
                C[System.Array.index(2, C)] = y <= -threshhold;
                C[System.Array.index(3, C)] = y >= threshhold;

                var cid = IC.getMapControllerID$1(5);
                if (Bridge.referenceEquals(cid, "Keyboard") || Bridge.referenceEquals(cid, "Mouse")) {
                    /* C[4] = KeyboardManager._this.PressedMouseButtons.Contains(0);
                    C[5] = KeyboardManager._this.PressedMouseButtons.Contains(2);*/
                    C[System.Array.index(4, C)] = IC.getPressed(2);
                    C[System.Array.index(5, C)] = IC.getPressed(3);
                    C[System.Array.index(6, C)] = IC.getPressed(4);
                } else {
                    /* GamePad P = GamePadManager._this.GetPad(IC.id);
                    PC.aimAngle = new Vector2((float)P.axes[2], (float)P.axes[3]).ToAngle();*/
                    var aim = new CirnoGame.Vector2(IC.getState(4), IC.getState(5));
                    if (aim.RoughLength > 0.5) {
                    }


                }
                C[System.Array.index(4, C)] = IC.getPressed(2);
                C[System.Array.index(5, C)] = IC.getPressed(3);
                C[System.Array.index(6, C)] = IC.getPressed(4);
                /* C[4] = IC.getPressed(3);
                C[5] = IC.getPressed(4);*/

                var o = { };
            }
        }
    });

    Bridge.define("CirnoGame.HealingItem", {
        inherits: [CirnoGame.CollectableItem],
        fields: {
            healingPower: 0
        },
        ctors: {
            init: function () {
                this.healingPower = 1.5;
            },
            ctor: function (game) {
                this.$initialize();
                CirnoGame.CollectableItem.ctor.call(this, game, "heart");
                this.floats = false;
                this.magnetDistance = 20;
                this.sound = "ok";
            }
        },
        methods: {
            CanCollect: function (player) {
                return player.HP < player.maxHP;
            },
            onCollected: function (player) {
                player.HP = Math.min(player.HP + this.healingPower, player.maxHP);
            }
        }
    });

    Bridge.define("CirnoGame.KeyItem", {
        inherits: [CirnoGame.CollectableItem],
        ctors: {
            ctor: function (game) {
                this.$initialize();
                CirnoGame.CollectableItem.ctor.call(this, game, "key");
                this.floats = false;
                this.magnetDistance = 20;
            }
        },
        methods: {
            CanCollect: function (player) {
                return player.keys < 5;
            },
            onCollected: function (player) {
                player.keys = (player.keys + 1) | 0;
            }
        }
    });

    Bridge.define("CirnoGame.PlatformerEntity", {
        inherits: [CirnoGame.ControllableEntity],
        fields: {
            friction: 0,
            onGround: false,
            GravityEnabled: false,
            gravity: 0,
            maxFallSpeed: 0,
            feetposition: 0,
            headposition: 0,
            Floor: null,
            Ceiling: null,
            LeftWall: null,
            RightWall: null
        },
        ctors: {
            init: function () {
                this.friction = 0.5;
                this.GravityEnabled = true;
                this.gravity = 0.02;
                this.maxFallSpeed = 2.0;
                this.feetposition = 23;
                this.headposition = 7;
            },
            ctor: function (game) {
                this.$initialize();
                CirnoGame.ControllableEntity.ctor.call(this, game);

            }
        },
        methods: {
            Update: function () {
                CirnoGame.ControllableEntity.prototype.Update.call(this);
                if (this.GravityEnabled) {
                    if (this.Vspeed < this.maxFallSpeed && this.GravityEnabled) {
                        this.Vspeed = Math.min(this.Vspeed + this.gravity, this.maxFallSpeed);
                    }
                }
                /* if (y > 0 && Vspeed>=0)
                {
                   y = 0;
                   Vspeed = 0;
                   onGround = true;
                }
                if (y < 0)
                {
                   onGround = false;
                }*/
                this.ApplyFriction();
                this.UpdateTerrainCollision();

                this.onGround = (this.Floor != null && this.Vspeed >= 0);

                if (this.onGround) {
                    var Y = this.Floor.GetTop(this.getCenter()) - this.feetposition;
                    /* if (y < Y)
                    {
                       onGround = false;
                       Floor = null;
                    }
                    else*/
                    {
                        //y = ((Floor.row * Game.TM.tilesize) + Game.TM.position.Y) - feetposition;
                        this.y = Y;
                        this.Vspeed = 0;
                        this.onGround = true;
                    }
                }
                if (this.Ceiling != null && this.Vspeed < 0) {
                    this.Vspeed = 0;
                    this.y = ((this.Ceiling.row * this.Game.TM.tilesize) + this.Game.TM.position.Y) + this.Game.TM.tilesize - this.headposition;
                }
                if (this.LeftWall != null) {
                    this.Hspeed = Math.max(0, this.Hspeed);
                }
                if (this.RightWall != null) {
                    this.Hspeed = Math.min(0, this.Hspeed);
                }
            },
            ApplyFriction: function () {
                this.Hspeed = CirnoGame.MathHelper.Decelerate(this.Hspeed, this.friction);
                if (!this.GravityEnabled) {
                    this.Vspeed = CirnoGame.MathHelper.Decelerate(this.Vspeed, this.friction);
                }
            },
            GetFloor: function () {
                var T = null;
                var W = this.Width / 3;
                var Y = this.Height;
                if (!(T != null && T.enabled && T.topSolid)) {
                    T = this.Game.TM.CheckForTile(CirnoGame.Vector2.Add$1(this.Position, this.Width / 2, Y));
                }
                if (!(T != null && T.enabled && T.topSolid)) {
                    T = this.Game.TM.CheckForTile(CirnoGame.Vector2.Add$1(this.Position, W, Y));
                }
                if (!(T != null && T.enabled && T.topSolid)) {
                    T = this.Game.TM.CheckForTile(CirnoGame.Vector2.Add$1(this.Position, this.Width - W, Y));
                }
                if (!(T != null && T.enabled && T.topSolid)) {
                    T = null;
                }
                return T;
            },
            GetCeiling: function () {
                var T = null;
                var W = this.Width / 3;
                //float Y = 16;
                var Y = 0 + this.headposition;
                if (!(T != null && T.enabled && T.bottomSolid)) {
                    T = this.Game.TM.CheckForTile(CirnoGame.Vector2.Add$1(this.Position, W, Y));
                }
                if (!(T != null && T.enabled && T.bottomSolid)) {
                    T = this.Game.TM.CheckForTile(CirnoGame.Vector2.Add$1(this.Position, this.Width - W, Y));
                }
                if (!(T != null && T.enabled && T.bottomSolid)) {
                    T = null;
                }
                return T;
            },
            CheckWall: function (X) {
                var T = null;
                /* if (!(T != null && T.enabled && ((T.leftSolid && X > 0) || (T.rightSolid && X < 0))))
                {
                   T = Game.TM.CheckForTile(Position + new Vector2(X, (Height / 2)-2));
                }
                if (!(T != null && T.enabled && ((T.leftSolid && X > 0) || (T.rightSolid && X < 0))))
                {
                   T = Game.TM.CheckForTile(Position + new Vector2(X, Height-2));
                   if (T != null && T.IsSlope)
                   {
                       T = null;
                   }
                }
                if (!(T != null && T.enabled && ((T.leftSolid && X > 0) || (T.rightSolid && X < 0))))
                {
                   T = null;
                }*/
                if (!this.IsTileObstacle(T, X)) {
                    T = this.Game.TM.CheckForTile(CirnoGame.Vector2.Add$1(this.Position, X, (this.Height / 2) - 2));
                }
                if (!this.IsTileObstacle(T, X)) {
                    T = this.Game.TM.CheckForTile(CirnoGame.Vector2.Add$1(this.Position, X, this.Height - 2));
                }
                if (!this.IsTileObstacle(T, X)) {
                    T = null;
                }
                return T;
            },
            IsTileObstacle: function (T, X) {
                if (T != null && T.enabled && ((T.leftSolid && X > 0) || (T.rightSolid && X < 0)) && (this.Floor == null || T.row < this.Floor.row)) {
                    var Y = this.y + this.Height;
                    //if (T.GetHitbox().y < Y-28)
                    //if (T.GetHitbox().y < Y - 8)
                    //if (T.GetHitbox().y < Y - 4)
                    if (T.GetHitbox().y < Y - 0) {
                        return !T.IsSlope;
                    }
                }
                return false;
            },
            UpdateTerrainCollision: function () {
                this.Floor = this.GetFloor();
                this.Ceiling = this.GetCeiling();
                if (this.Floor != null && this.Floor.SteppedOn) {
                    this.Floor.SteppedOn(this);
                }


                if (this.Vspeed < this.maxFallSpeed && this.GravityEnabled) {
                    this.Vspeed = Math.min(this.Vspeed + this.gravity, this.maxFallSpeed);
                }
                var stuck = false;
                if (this.Floor != null) {
                    var c = true;
                    while (c) {
                        var T = this.Floor.GetTileData(0, -1);
                        if (T != null && T.enabled && T.solid) {
                            this.Floor = T;
                            stuck = true;
                        } else {
                            c = false;
                        }
                    }
                }
                stuck = false;
                this.onGround = false;
                if (this.Floor != null && this.Vspeed >= 0) {
                    //float Y = Floor.GetHitbox().top - Height;
                    var Y = this.Floor.GetTop(this.getCenter()) - this.Height;
                    //if (!Floor.platform || y <= Y + Vspeed)
                    //if (!Floor.platform || y+Vspeed>=Y)
                    if ((!this.Floor.platform || this.y <= Y + this.Vspeed) && this.y + (this.Vspeed + 10) >= Y) {
                        if (this.Vspeed > 0) {
                            this.Vspeed = 0;
                            this.onGround = true;
                        }
                        this.y = Y;
                    }
                }
                if (this.Hspeed !== 0) {
                    var wall = this.Hspeed > 0 ? this.RightWall : this.LeftWall;
                    if (wall != null) {
                        this.Hspeed = 0;
                    }
                }
                var W = this.Width / 3;
                var X = Math.abs(this.Hspeed);
                if (this.Hspeed < 0) {
                    X -= 2 - W;
                } else {
                    X += (this.Width - W) + 2;
                }
                this.RightWall = this.CheckWall(X);

                X = -Math.abs(this.Hspeed);
                if (this.Hspeed < 0) {
                    X -= 2 - W;
                } else {
                    X += (this.Width - W) + 2;
                }
                this.LeftWall = this.CheckWall(X);
                if (this.LeftWall != null && Bridge.referenceEquals(this.LeftWall, this.RightWall)) {
                    var R = this.LeftWall.GetHitbox();
                    var V = R.Center;
                    if ((CirnoGame.Vector2.op_Subtraction(V, this.Position)).X > 0) {
                        this.x += 1;
                        if (this.Hspeed < 0) {
                            this.Hspeed = 0;
                        }
                    } else {
                        this.x -= 1;
                        if (this.Hspeed > 0) {
                            this.Hspeed = 0;
                        }
                    }
                }
                if (stuck) {
                    this.UpdateTerrainCollision();
                }
            }
        }
    });

    Bridge.define("CirnoGame.Orb", {
        inherits: [CirnoGame.CollectableItem],
        ctors: {
            ctor: function (game) {
                this.$initialize();
                CirnoGame.CollectableItem.ctor.call(this, game, "orb");
                //Ani = new Animation(AnimationLoader.Get("images/misc/orb"));
                this.magnetDistance = 55;
            }
        },
        methods: {
            onCollected: function (player) {
                //throw new NotImplementedException();
                var time = (1000) * (13 - Math.min(this.Game.level - 0.15, 7));
                if (this.Game.timeRemaining > 0) {
                    this.Game.timeRemaining += time;
                    this.Game.timeRemaining = Math.min(this.Game.defaultTimeRemaining, this.Game.timeRemaining);
                } else {
                    this.Game.timeRemaining += time;
                }
            }
        }
    });

    Bridge.define("CirnoGame.PointItem", {
        inherits: [CirnoGame.CollectableItem],
        ctors: {
            ctor: function (game) {
                this.$initialize();
                CirnoGame.CollectableItem.ctor.call(this, game, "point");
                this.floats = false;
                //magnetDistance = 100;
                this.magnetDistance = 70;
                this.magnetSpeed *= 8;
            }
        },
        methods: {
            onCollected: function (player) {
                player.score = (player.score + 5) | 0;
            }
        }
    });

    Bridge.define("CirnoGame.MRGhosty", {
        inherits: [CirnoGame.PlatformerEntity,CirnoGame.ICombatant,CirnoGame.IHarmfulEntity],
        fields: {
            animation: null,
            attackpower: 0,
            defensepower: 0
        },
        props: {
            Team: 0,
            HP: 0,
            PointsForKilling: {
                get: function () {
                    return 1;
                }
            },
            TargetPriority: {
                get: function () {
                    return 0.5;
                }
            },
            IsHarmful: {
                get: function () {
                    return true;
                }
            },
            Attacker: {
                get: function () {
                    return this;
                }
            },
            touchDamage: {
                get: function () {
                    return this.attackpower * 1.5;
                }
            }
        },
        alias: [
            "Team", "CirnoGame$ICombatant$Team",
            "HP", "CirnoGame$ICombatant$HP",
            "PointsForKilling", "CirnoGame$ICombatant$PointsForKilling",
            "TargetPriority", "CirnoGame$ICombatant$TargetPriority",
            "IsHarmful", "CirnoGame$IHarmfulEntity$IsHarmful",
            "Attacker", "CirnoGame$IHarmfulEntity$Attacker",
            "touchDamage", "CirnoGame$IHarmfulEntity$touchDamage",
            "onDamaged", "CirnoGame$ICombatant$onDamaged",
            "onDeath", "CirnoGame$ICombatant$onDeath",
            "onKill", "CirnoGame$ICombatant$onKill",
            "ontouchDamage", "CirnoGame$IHarmfulEntity$ontouchDamage"
        ],
        ctors: {
            init: function () {
                this.animation = "???";
                this.attackpower = 1;
                this.defensepower = 1;
            },
            ctor: function (game) {
                this.$initialize();
                CirnoGame.PlatformerEntity.ctor.call(this, game);
                this.ChangeAni("");
                this.AddBehavior$1(new CirnoGame.FlightControls(this));
                this.AddBehavior$1(new CirnoGame.RandomAI(this));
                this.attackpower = 1 + (this.Game.level * 0.5);
                this.defensepower = 1 + (this.Game.level * 0.5);
                if (this.Game.playing) {
                    this.AddBehavior(CirnoGame.AimedShooter);
                    this.GetBehavior(CirnoGame.AimedShooter).attackpower = this.attackpower;
                    this.GetBehavior(CirnoGame.AimedShooter).maxtime = Math.max(((480 - (Bridge.Int.mul(this.Game.level, 10))) | 0), 380);
                }
                this.GetBehavior(CirnoGame.FlightControls).maxSpeed *= 0.5;

                this.GravityEnabled = false;
                this.Team = 2;
                this.HP = 2;
            }
        },
        methods: {
            Update: function () {
                CirnoGame.PlatformerEntity.prototype.Update.call(this);
                this.Ani.Flipped = (this.Hspeed < 0);
                this.Ani.ImageSpeed = (Math.abs(this.Hspeed) + Math.abs(this.Vspeed)) * 0.125;
            },
            ChangeAni: function (animation, reset) {
                if (reset === void 0) { reset = false; }
                if (Bridge.referenceEquals(this.animation, animation)) {
                    return;
                }
                if (this.Ani == null) {
                    this.Ani = new CirnoGame.Animation(CirnoGame.AnimationLoader.Get(System.String.concat("images/enemies/mrghost", animation)));
                } else {
                    this.Ani.ChangeAnimation(CirnoGame.AnimationLoader.Get(System.String.concat("images/enemies/mrghost", animation)), reset);
                }
                this.animation = animation;
            },
            onDamaged: function (source, amount) {
                //throw new NotImplementedException();
                //if (!(source is MRGhosty))
                {
                    this.HP -= (amount / this.defensepower);
                }
                /* else
                {
                   Helper.Log("ghosts are allergic to themselves???");
                }*/
            },
            onDeath: function (source) {
                //throw new NotImplementedException();
                this.Alive = false;
                var P = new CirnoGame.PointItem(this.Game);
                P.Position.CopyFrom(this.Position);
                P.collectionDelay = (Bridge.Int.div(P.collectionDelay, 2)) | 0;
                this.Game.AddEntity(P);
                if (Math.random() < 0.15) {
                    P = new CirnoGame.HealingItem(this.Game);
                    P.Position.CopyFrom(this.Position);
                    P.Vspeed = -2;
                    P.collectionDelay = (Bridge.Int.div(P.collectionDelay, 2)) | 0;
                    this.Game.AddEntity(P);
                }
            },
            onKill: function (combatant) {
                //throw new NotImplementedException();
            },
            ontouchDamage: function (target) {
                //throw new NotImplementedException();
                return true;
            }
        }
    });

    Bridge.define("CirnoGame.PlayerCharacter", {
        inherits: [CirnoGame.PlatformerEntity,CirnoGame.ICombatant],
        fields: {
            animation: null,
            shoottime: 0,
            prefix: null,
            newInput: false,
            tapTimer: null,
            shootRecharge: 0,
            turntime: 0,
            score: 0,
            orbs: 0,
            keys: 0,
            energyRecharge: 0,
            maxEnergy: 0,
            energy: 0,
            maxHP: 0,
            regenRate: 0,
            SpawnLocation: null,
            lives: 0,
            frame: 0,
            digpower: 0,
            attackpower: 0,
            defensepower: 0,
            invincibilitytime: 0,
            blockprice: 0,
            invincibilitymod: 0,
            currentshot: 0,
            shotdelay: 0,
            currentshotdelay: 0,
            totalshots: 0,
            MSG: null
        },
        props: {
            Team: 0,
            HP: 0,
            PointsForKilling: {
                get: function () {
                    return 300;
                }
            },
            TargetPriority: {
                get: function () {
                    return 0.7;
                }
            }
        },
        alias: [
            "Team", "CirnoGame$ICombatant$Team",
            "HP", "CirnoGame$ICombatant$HP",
            "PointsForKilling", "CirnoGame$ICombatant$PointsForKilling",
            "TargetPriority", "CirnoGame$ICombatant$TargetPriority",
            "onDamaged", "CirnoGame$ICombatant$onDamaged",
            "onDeath", "CirnoGame$ICombatant$onDeath",
            "onKill", "CirnoGame$ICombatant$onKill"
        ],
        ctors: {
            init: function () {
                this.animation = "???";
                this.shoottime = 0;
                this.prefix = "";
                this.shootRecharge = 0;
                this.turntime = 0;
                this.score = 0;
                this.orbs = 0;
                this.keys = 0;
                this.energyRecharge = 0.022;
                this.maxEnergy = 4;
                this.energy = 4;
                this.maxHP = 20;
                this.regenRate = 1.0;
                this.SpawnLocation = new CirnoGame.Vector2();
                this.lives = 3;
                this.frame = 0;
                this.digpower = 1.0;
                this.attackpower = 1.0;
                this.defensepower = 1.0;
                this.invincibilitytime = 0;
                this.blockprice = 4.0;
                this.invincibilitymod = 1.0;
                this.currentshot = 0;
                this.shotdelay = 5;
                this.currentshotdelay = 0;
                this.totalshots = 1;
            },
            ctor: function (game) {
                this.$initialize();
                CirnoGame.PlatformerEntity.ctor.call(this, game);
                this.ChangeAni("stand");
                this.AddBehavior(CirnoGame.PlatformerControls);
                //AddBehavior(new PlatformerControls(this));
                this.tapTimer = System.Array.init(this.Controller.length, 0, System.Int32);
                this.Team = 0;
                this.HP = this.maxHP;
                this.MSG = new CirnoGame.FloatingMessage(game, "");
                this.MSG.Text.TextColor = "#FFFFFF";
                //MSG.ChangeText("hello world");
                this.MSG.autokill = false;
                game.AddEntity(this.MSG);
                this.MSG.RemovedOnLevelEnd = false;
                this.RemovedOnLevelEnd = false;
            }
        },
        methods: {
            MoveToNewSpawn: function (NewSpawnLocation) {
                this.SpawnLocation.CopyFrom(NewSpawnLocation);
                this.Position.CopyFrom(this.SpawnLocation);
            },
            shoot: function () {
                if (this.energy < 1) {
                    return;
                }
                if (this.shoottime < 1) {
                    this.prefix = "s";
                    this.ChangeAni(System.String.concat(this.prefix, this.animation));
                }
                if (this.shootRecharge <= 0) {
                    this.currentshot = 1;
                    this.DoShot();
                    this.energy -= 1;
                    //shootRecharge = 12;

                    this.currentshotdelay = 0;
                    //shootRecharge = 20;
                    this.shootRecharge = 16;

                }
                this.shoottime = 50;
                //shoottime = 40;
                this.turntime = 0;

            },
            DoShot: function () {
                var PB = new CirnoGame.PlayerBullet(this.Game, this, "Images/misc/crystal");
                PB.Hspeed = this.Ani.Flipped ? -2.5 : 2.5;
                PB.x = this.x + (this.Ani.Flipped ? -4 : 12);
                PB.y = this.y + 10;
                if (!this.Controller[System.Array.index(0, this.Controller)] && !this.Controller[System.Array.index(1, this.Controller)]) {
                    if (this.Controller[System.Array.index(2, this.Controller)]) {
                        PB.Hspeed *= 0.8;
                        PB.Vspeed = -Math.abs(PB.Hspeed);
                        PB.Hspeed *= 0.6;
                    } else if (this.Controller[System.Array.index(3, this.Controller)]) {
                        PB.Hspeed *= 0.8;
                        PB.Vspeed = Math.abs(PB.Hspeed);
                        PB.Hspeed *= 0.6;
                    }
                } else {
                    if (this.Controller[System.Array.index(2, this.Controller)]) {
                        PB.Hspeed *= 0.9;
                        PB.Vspeed = -Math.abs(PB.Hspeed * 0.7);

                    } else if (this.Controller[System.Array.index(3, this.Controller)]) {
                        PB.Hspeed *= 0.9;
                        PB.Vspeed = Math.abs(PB.Hspeed * 0.7);
                    }
                }
                PB.x -= PB.Hspeed;
                PB.y -= PB.Vspeed;
                PB.attacksterrain = this.currentshot === 1;
                PB.digpower = (this.digpower) * 0.6667;
                PB.touchDamage = this.attackpower / (((this.totalshots - 1.0) / 2.0) + 1.0);
                this.Game.AddEntity(PB);
            },
            Update: function () {
                CirnoGame.PlatformerEntity.prototype.Update.call(this);
                this.MSG.Position.X = this.Position.X;
                this.MSG.Position.Y = this.Position.Y - 10;

                if (this.shoottime > 0) {
                    this.shoottime = (this.shoottime - 1) | 0;
                    if (this.shoottime < 1) {
                        if (Bridge.referenceEquals("" + String.fromCharCode(this.animation.charCodeAt(0)), this.prefix)) {
                            this.ChangeAni(this.animation.substr(1));
                        }
                        this.prefix = "";
                    }
                }

                if (this.onGround) {
                    if (this.Hspeed !== 0) {
                        this.ChangeAni(System.String.concat(this.prefix, "walk"));
                    } else {
                        this.ChangeAni(System.String.concat(this.prefix, "stand"));
                    }
                    this.Ani.ImageSpeed = Math.abs(this.Hspeed * 0.125);
                    //Ani.ImageSpeed = Ani.Flipped ? Hspeed * 0.125f : -Hspeed * 0.125f;
                    //Ani.ImageSpeed = (Ani.Flipped ? -Hspeed : Hspeed) * 0.125f;
                } else {
                    this.ChangeAni(System.String.concat(this.prefix, "jump"));
                    //Ani.ImageSpeed = (float)Math.Abs(Vspeed * 0.125);
                    this.Ani.ImageSpeed = 0.15 + ((Math.abs(this.Hspeed) + Math.abs(this.Vspeed)) * 0.7);
                }
                if (this.Ani.Flipped !== this.Hspeed < 0 || (this.Hspeed === 0 && this.onGround)) {
                    this.turntime = (this.turntime + 1) | 0;
                } else {
                    this.turntime = 0;
                }

                //if (LController[3] != Controller[3] && Controller[3])
                /* if (Pressed(3) || Pressed(4) || Pressed(5) || Pressed(6))
                {
                   shoot();
                }*/
                if (this.currentshot < this.totalshots) {
                    this.currentshotdelay = (this.currentshotdelay + 1) | 0;
                    if (this.currentshotdelay >= this.shotdelay) {
                        this.currentshotdelay = 0;
                        this.currentshot = (this.currentshot + 1) | 0;
                        this.DoShot();
                    }
                } else {
                    if (this.shootRecharge > 0) {
                        this.shootRecharge = (this.shootRecharge - 1) | 0;
                    }
                    this.energy = Math.min(this.energy + this.energyRecharge, this.maxEnergy);
                }
                if (this.Controller[System.Array.index(4, this.Controller)]) {
                    this.turntime = 0;
                }
                //if (Pressed(4))
                if (this.Controller[System.Array.index(4, this.Controller)]) {
                    this.shoot();
                }
                if (this.Pressed(6)) {
                    this.PlaceBlock();
                }

                this.UpdateController();
                //if (turntime > 22 && Hspeed != 0)
                //if (turntime > 18 && Hspeed != 0)
                //if (turntime > 14 && Hspeed != 0)
                if (this.turntime > 8 && this.Hspeed !== 0) {
                    this.Ani.Flipped = this.Hspeed < 0;
                }
                if (this.invincibilitytime > 0) {
                    //Ani.Alpha = Ani.Alpha == 0 ? 1 : 0;
                    if ((this.frame & 1) > 0) {
                        this.Visible = !this.Visible;
                    }
                    this.invincibilitytime -= 1;
                } else {
                    this.Visible = true;
                }
                //if (Game.timeRemaining > 0 && HP>0 && invincibilitytime<=0 && HP<maxHP && Game.timeRemaining < Game.defaultTimeRemaining)
                /* if (Game.timeRemaining > 0 && HP > 0 && invincibilitytime <= 0 && HP < maxHP && Game.timeRemaining < Game.lastStand)
                {
                   var staticMod = 0.005f;
                   var HPRate = 1-(HP / maxHP);
                   var TimeRate = 1-(Game.timeRemaining / Game.defaultTimeRemaining);
                   var rate = (HPRate * TimeRate * regenRate);
                   HP += (rate * staticMod);
                   if (HP > maxHP)
                   {
                       HP = maxHP;
                   }
                }*/


                this.frame = (this.frame + 1) | 0;
            },
            PlaceBlock: function () {
                var price = 1000 * this.blockprice;
                if (this.Game.timeRemaining < this.blockprice) {
                    return;
                }
                var W = this.Width / 3;
                var Y = this.Height;
                var T = this.Game.TM.CheckForTile(CirnoGame.Vector2.Add$1(this.Position, this.Width / 2, Y));
                if (T != null && (!T.enabled || !T.solid)) {
                    T.solid = true;
                    T.Breakable = true;
                    T.enabled = true;
                    T.texture = 4;
                    T.UpdateTile();
                    T.HP = T.maxHP * 2;
                    this.Game.timeRemaining -= price;
                }
            },
            ChangeAni: function (animation, reset) {
                if (reset === void 0) { reset = false; }
                if (Bridge.referenceEquals(this.animation, animation)) {
                    return;
                }
                if (this.Ani == null) {
                    this.Ani = new CirnoGame.Animation(CirnoGame.AnimationLoader.Get(System.String.concat("images/cirno/", animation)));
                } else {
                    this.Ani.ChangeAnimation(CirnoGame.AnimationLoader.Get(System.String.concat("images/cirno/", animation)), reset);
                }
                if (!Bridge.referenceEquals(this.animation, "stand")) {
                    this.turntime = 0;
                }
                this.animation = animation;
            },
            UpdateController: function () {
                this.newInput = false;
                var i = 0;
                while (i < this.Controller.length) {
                    this.tapTimer[System.Array.index(i, this.tapTimer)] = (this.tapTimer[System.Array.index(i, this.tapTimer)] + 1) | 0;
                    if (this.Controller[System.Array.index(i, this.Controller)] && !this.LController[System.Array.index(i, this.LController)]) {
                        this.tapTimer[System.Array.index(i, this.tapTimer)] = 0;
                        this.newInput = true;
                    }
                    this.LController[System.Array.index(i, this.LController)] = this.Controller[System.Array.index(i, this.Controller)];
                    i = (i + 1) | 0;
                }
                /* if (_lAimAngle != _aimAngle)
                {
                   newInput = true;
                }
                _lAimAngle = _aimAngle;*/
                if (this.newInput) {
                    //GetBehavior<NetworkSync>().Sync();
                }
            },
            onDamaged: function (source, amount) {
                //throw new NotImplementedException();
                if (this.invincibilitytime <= 0) {
                    this.HP -= (amount / this.defensepower);
                    this.invincibilitytime = 50 * this.invincibilitymod;
                }
            },
            onRemove: function () {
                CirnoGame.PlatformerEntity.prototype.onRemove.call(this);
                this.Game.RemoveEntity(this.MSG);
            },
            onDeath: function (source) {
                //throw new NotImplementedException();
                this.invincibilitytime *= 3.0;

                if (Bridge.referenceEquals(this.Game.player, this)) {
                    //if (Game.timeRemaining > 0)
                    if (this.Game.timeRemaining >= this.Game.baseLifeCost) {
                        this.Position.CopyFrom(this.SpawnLocation);
                        this.HP = this.maxHP;
                        this.Game.timeRemaining -= this.Game.baseLifeCost;
                        //Game.timeRemaining *= 0.85f;
                        //Game.timeRemaining *= 0.6667f;
                        this.Game.camera.instawarp = true;
                        this.Game.skiprender = true;
                    } else {
                        this.Game.DoGameOver();
                    }
                } else {
                    this.Position.CopyFrom(this.SpawnLocation);
                    this.HP = this.maxHP;
                }
            },
            onKill: function (combatant) {
                //throw new NotImplementedException();
            },
            GetHitbox: function () {
                //return base.GetHitbox();
                if (this.Ani != null && this.Ani.CurrentImage != null) {
                    /* var size = 4;
                    var W = Ani.CurrentImage.Width / size;
                    var H = Ani.CurrentImage.Height / size;
                    var W4 = (Ani.CurrentImage.Width / 2) - (W / 2);
                    var H4 = (Ani.CurrentImage.Height / 2) - (H / 2);
                    return new Rectangle(Ani.X+W4, Ani.Y+H4, W, H);*/
                    return new CirnoGame.Rectangle(this.Ani.X + (this.Ani.CurrentImage.width / 2.0), this.Ani.Y + (this.Ani.CurrentImage.height / 2.0), 1, 1);
                }
                return null;
            }
        }
    });
});

//# sourceMappingURL=data:application/json;base64,ewogICJ2ZXJzaW9uIjogMywKICAiZmlsZSI6ICJDaXJub0dhbWUuanMiLAogICJzb3VyY2VSb290IjogIiIsCiAgInNvdXJjZXMiOiBbIkdhbWVNb2RlLmNzIiwiRW50aXR5QmVoYXZpb3IuY3MiLCJBbmltYXRpb24uY3MiLCJBbmltYXRpb25Mb2FkZXIuY3MiLCJBcHAuY3MiLCJBdWRpby5jcyIsIkF1ZGlvTWFuYWdlci5jcyIsIkJ1dHRvbk1lbnUuY3MiLCJTcHJpdGUuY3MiLCJCdXR0b25TcHJpdGUuY3MiLCJDYW1lcmEuY3MiLCJFbnRpdHkuY3MiLCJHYW1lcGFkLmNzIiwiR2FtZVBhZEJ1dHRvbi5jcyIsIkdhbWVQYWRNYW5hZ2VyLmNzIiwiR2FtZVBsYXlTZXR0aW5ncy5jcyIsIkhlbHBlci5jcyIsIkhlbHBlckV4dGVuc2lvbnMuY3MiLCJJbnB1dENvbnRyb2xsZXJzLmNzIiwiSW5wdXRDb250cm9sbGVyTWFuYWdlci5jcyIsIklucHV0TWFwLmNzIiwiSlNPTkFyY2hpdmUuY3MiLCJLZXlib2FyZE1hbmFnZXIuY3MiLCJNYXBHZW5lcmF0b3IuY3MiLCJNYXBSb29tLmNzIiwiTWF0aEhlbHBlci5jcyIsIlBvaW50LmNzIiwiUmVjdGFuZ2xlLmNzIiwiUmVjdGFuZ2xlSS5jcyIsIlJlbmRlcmVyLmNzIiwiVGlsZURhdGEuY3MiLCJUaWxlTWFwLmNzIiwiVmVjdG9yMi5jcyIsIkJlaGF2aW9ycy9BaW1lZFNob290ZXIuY3MiLCJDaGVzdC5jcyIsIkNvbGxlY3RhYmxlSXRlbS5jcyIsIkNvbnRyb2xsYWJsZUVudGl0eS5jcyIsIkV4aXREb29yLmNzIiwiQmVoYXZpb3JzL0ZsaWdodENvbnRyb2xzLmNzIiwiRmxvYXRpbmdNZXNzYWdlLmNzIiwiUGFydGljbGUuY3MiLCJCZWhhdmlvcnMvUGxhdGZvcm1lckNvbnRyb2xzLmNzIiwiUGxheWVyQnVsbGV0LmNzIiwiQmVoYXZpb3JzL1JhbmRvbUFJLmNzIiwiUm9vbU9wZW5pbmdMZXZlci5jcyIsIlRleHRTcHJpdGUuY3MiLCJUaWxlLmNzIiwiVGl0bGVTY3JlZW4uY3MiLCJFbmVtaWVzL1R1cnJldC5jcyIsIkRvb3JLZXkuY3MiLCJHYW1lLmNzIiwiSGVhbGluZ0l0ZW0uY3MiLCJLZXlJdGVtLmNzIiwiUGxhdGZvcm1lckVudGl0eS5jcyIsIk9yYi5jcyIsIlBvaW50SXRlbS5jcyIsIkVuZW1pZXMvTVJHaG9zdHkuY3MiLCJQbGF5ZXJDaGFyYWN0ZXIuY3MiXSwKICAibmFtZXMiOiBbIiJdLAogICJtYXBwaW5ncyI6ICI7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs4Q0F5Q3dEQTtvQkFFNUNBLE9BQU9BLEtBQUlBLDhEQUFlQSw0QkFBeURBLG9DQUFVQSxBQUF3REE7bUNBQUtBLGVBQWNBOzs7NkNBR25JQTtvQkFFckNBLFVBQVVBLEtBQUlBLDhEQUFlQSw0QkFBeURBLG9DQUFVQSxBQUF3REE7bUNBQUtBLCtCQUFVQTs7b0JBQ3ZLQSxJQUFJQTt3QkFDQUEsT0FBT0E7O29CQUNYQSxPQUFPQTs7O29CQTBCUEEsSUFBSUEsaUNBQWNBO3dCQUVkQSwrQkFBWUEsS0FBSUE7d0JBQ2hCQSxnQ0FBYUEsSUFBSUE7d0JBQ2pCQTt3QkFDQUEsZ0NBQWFBLElBQUlBO3dCQUNqQkE7d0JBQ0FBOzs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs0QkE5QldBOztnQkFFZkE7Z0JBQ0FBO2dCQUNBQTtnQkFDQUE7Z0JBQ0FBO2dCQUNBQTtnQkFDQUE7Z0JBQ0FBLFlBQU9BO2dCQUNQQSxnQkFBV0E7Z0JBQ1hBLG1CQUFjQSxpREFBNkJBO2dCQUMzQ0E7Z0JBQ0FBLGlDQUFjQTs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs0QkNuRElBOztnQkFFbEJBLGNBQWNBO2dCQUNkQSxJQUFJQSxpREFBc0JBLHFCQUFnQkE7b0JBRXRDQSxXQUFlQTtvQkFDZkEsU0FBU0E7O29CQUVUQSxRQUFhQTtvQkFDYkEsb0JBQWVBLHFCQUFFQSxzQkFBRkE7Ozs7Ozs7Ozs7OzRCQVVFQTt1Q0FHR0EsS0FBYUE7O2dCQUVyQ0EsUUFBWUE7Z0JBQ1pBLE1BQU1BO2dCQUNOQSxNQUFNQTs7Z0JBRU5BLE1BQU1BO2dCQUNO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OztnQkFFMUVBLElBQUlBO29CQUVBQTs7Z0JBRUpBLGlCQUFpQkE7OztnQkFJakJBO2dCQUNBQTtnQkFDQUEsT0FBT0EsSUFBSUE7b0JBRVBBLGlDQUFTQSxHQUFUQSxvREFBU0EsR0FBVEE7b0JBQ0FBLElBQUlBLG1DQUFXQSxHQUFYQSxxQkFBaUJBLENBQUNBLG9DQUFZQSxHQUFaQTt3QkFFbEJBLGlDQUFTQSxHQUFUQTt3QkFDQUE7O29CQUVKQSxvQ0FBWUEsR0FBWkEscUJBQWlCQSxtQ0FBV0EsR0FBWEE7b0JBQ2pCQTs7Ozs7OztnQkFPSkEsSUFBSUE7Ozs7aUNBTWNBLFFBQXVCQTs7Z0JBR3pDQSxJQUFJQTtvQkFFQUEsV0FBTUEsQ0FBQ0EsU0FBU0E7b0JBQ2hCQSx5QkFBb0JBLEtBQUdBOzs7O2dCQUszQkE7Z0JBQ0FBLHVCQUFrQkE7OytCQUdGQTs7Z0JBR2hCQTs7Z0JBRUFBLElBQUlBLHlDQUFlQTs7b0JBR2ZBLElBQUlBLDJCQUFvQkE7d0JBRXBCQSx1QkFBa0JBO3dCQUNsQkEsVUFBS0E7d0JBQ0xBLDJCQUFzQkE7Ozt3QkFHdEJBO3dCQUNBQTs7d0JBSUFBOzs7b0JBS0pBLHVCQUFrQkE7b0JBQ2xCQSxVQUFLQTs7OzhCQUlNQTs7Ozs7Z0JBT2ZBLElBQUlBLFlBQU9BLFFBQVFBLHlCQUFvQkE7Ozs7Ozs7b0JBUW5DQSxPQUFPQSxJQUFJQSxvQkFBVUEsYUFBUUEsQ0FBQ0Esb0NBQThCQSxhQUFRQSxDQUFDQTs7Z0JBRXpFQSxPQUFPQSIsCiAgInNvdXJjZXNDb250ZW50IjogWyJ1c2luZyBTeXN0ZW07XHJcbnVzaW5nIFN5c3RlbS5Db2xsZWN0aW9ucy5HZW5lcmljO1xyXG51c2luZyBTeXN0ZW0uTGlucTtcclxudXNpbmcgU3lzdGVtLlRleHQ7XHJcbnVzaW5nIFN5c3RlbS5UaHJlYWRpbmcuVGFza3M7XHJcbnVzaW5nIEJyaWRnZTtcclxudXNpbmcgQnJpZGdlLkh0bWw1O1xyXG5cclxubmFtZXNwYWNlIENpcm5vR2FtZVxyXG57XHJcbiAgICBbUHJpb3JpdHkoMSldXHJcbiAgICBwdWJsaWMgY2xhc3MgR2FtZU1vZGVcclxuICAgIHtcclxuICAgICAgICBwdWJsaWMgZW51bSBNb2RlVHlwZXNcclxuICAgICAgICB7XHJcbiAgICAgICAgICAgIC8vLyA8c3VtbWFyeT5cclxuICAgICAgICAgICAgLy8vIFNpbmdsZSAmIE11bHRpcGxheWVyLCBqdXN0IGEgZ2VuZXJhbCBnYW1lLlxyXG4gICAgICAgICAgICAvLy8gPC9zdW1tYXJ5PlxyXG4gICAgICAgICAgICBTa2lybWlzaCxcclxuICAgICAgICAgICAgLy8vIDxzdW1tYXJ5PlxyXG4gICAgICAgICAgICAvLy8gU2luZ2xlcGxheWVyLCBnYW1lcGxheSBpcyBjaGFuZ2VkIHVwIHdpdGggYSBtb2RlIHNwZWNpZmljIHRhc2suXHJcbiAgICAgICAgICAgIC8vLyA8L3N1bW1hcnk+XHJcbiAgICAgICAgICAgIENoYWxsZW5nZSxcclxuICAgICAgICAgICAgLy8vIDxzdW1tYXJ5PlxyXG4gICAgICAgICAgICAvLy8gTGlrZSBjaGFsbGVuZ2UsIGJ1dCBpcyBkZXNpZ25lZCBmb3IgbXVsdGlwbGUgaHVtYW4gcGxheWVycy5cclxuICAgICAgICAgICAgLy8vIDwvc3VtbWFyeT5cclxuICAgICAgICAgICAgQ2FsbGVuZ2VDb29wXHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBwdWJsaWMgYm9vbCBUZWFtcyB7IGdldDsgcHJvdGVjdGVkIHNldDsgfVxyXG4gICAgICAgIHB1YmxpYyBpbnQgU3RhcnRpbmdMaXZlcyB7IGdldDsgcHJvdGVjdGVkIHNldDsgfVxyXG4gICAgICAgIHB1YmxpYyBib29sIFN1cnZpdmFsIHsgZ2V0OyBwcm90ZWN0ZWQgc2V0OyB9XHJcbiAgICAgICAgcHVibGljIGJvb2wgQWxsb3dPbmxpbmVQbGF5IHsgZ2V0OyBwcm90ZWN0ZWQgc2V0OyB9XHJcbiAgICAgICAgcHVibGljIGJvb2wgQWxsb3dDaGFyYWN0ZXJTZWxlY3QgeyBnZXQ7IHByb3RlY3RlZCBzZXQ7IH1cclxuICAgICAgICBwdWJsaWMgaW50IE51bWJlck9mUGxheWVycyB7IGdldDsgcHJvdGVjdGVkIHNldDsgfVxyXG4gICAgICAgIHB1YmxpYyBpbnQgUmVzcGF3blRpbWUgeyBnZXQ7IHByb3RlY3RlZCBzZXQ7IH1cclxuICAgICAgICBwdWJsaWMgc3RyaW5nIE5hbWUgeyBnZXQ7IHByb3RlY3RlZCBzZXQ7IH1cclxuICAgICAgICBwdWJsaWMgTW9kZVR5cGVzIE1vZGVUeXBlIHsgZ2V0OyBwcm90ZWN0ZWQgc2V0OyB9XHJcbiAgICAgICAgcHVibGljIGJvb2wgdW5sb2NrZWQgeyBnZXQ7IHByb3RlY3RlZCBzZXQ7IH1cclxuICAgICAgICBwdWJsaWMgc3RyaW5nIERlc2NyaXB0aW9uIHsgZ2V0OyBwcm90ZWN0ZWQgc2V0OyB9XHJcblxyXG4gICAgICAgIHB1YmxpYyBzdGF0aWMgTGlzdDxHYW1lTW9kZT4gR2V0R2FtZU1vZGVzT2ZUeXBlKE1vZGVUeXBlcyB0eXBlKVxyXG4gICAgICAgIHtcclxuICAgICAgICAgICAgcmV0dXJuIG5ldyBMaXN0PEdhbWVNb2RlPihTeXN0ZW0uTGlucS5FbnVtZXJhYmxlLldoZXJlPGdsb2JhbDo6Q2lybm9HYW1lLkdhbWVNb2RlPihnYW1lTW9kZXMsKGdsb2JhbDo6U3lzdGVtLkZ1bmM8Z2xvYmFsOjpDaXJub0dhbWUuR2FtZU1vZGUsIGJvb2w+KShHID0+IEcuTW9kZVR5cGUgPT0gdHlwZSkpKTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIHB1YmxpYyBzdGF0aWMgR2FtZU1vZGUgR2V0R2FtZU1vZGVCeU5hbWUoc3RyaW5nIG5hbWUpXHJcbiAgICAgICAge1xyXG4gICAgICAgICAgICB2YXIgcmV0ID0gbmV3IExpc3Q8R2FtZU1vZGU+KFN5c3RlbS5MaW5xLkVudW1lcmFibGUuV2hlcmU8Z2xvYmFsOjpDaXJub0dhbWUuR2FtZU1vZGU+KGdhbWVNb2RlcywoZ2xvYmFsOjpTeXN0ZW0uRnVuYzxnbG9iYWw6OkNpcm5vR2FtZS5HYW1lTW9kZSwgYm9vbD4pKEcgPT4gRy5OYW1lID09IG5hbWUpKSk7XHJcbiAgICAgICAgICAgIGlmIChyZXQuQ291bnQgPiAwKVxyXG4gICAgICAgICAgICAgICAgcmV0dXJuIHJldFswXTtcclxuICAgICAgICAgICAgcmV0dXJuIG51bGw7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBwcm90ZWN0ZWQgR2FtZU1vZGUoc3RyaW5nIG5hbWUpXHJcbiAgICAgICAge1xyXG4gICAgICAgICAgICBUZWFtcyA9IHRydWU7XHJcbiAgICAgICAgICAgIFN0YXJ0aW5nTGl2ZXMgPSAzO1xyXG4gICAgICAgICAgICBTdXJ2aXZhbCA9IHRydWU7XHJcbiAgICAgICAgICAgIEFsbG93T25saW5lUGxheSA9IHRydWU7XHJcbiAgICAgICAgICAgIEFsbG93Q2hhcmFjdGVyU2VsZWN0ID0gdHJ1ZTtcclxuICAgICAgICAgICAgTnVtYmVyT2ZQbGF5ZXJzID0gNjtcclxuICAgICAgICAgICAgUmVzcGF3blRpbWUgPSAzOTA7XHJcbiAgICAgICAgICAgIE5hbWUgPSBuYW1lO1xyXG4gICAgICAgICAgICBNb2RlVHlwZSA9IEdhbWVNb2RlLk1vZGVUeXBlcy5Ta2lybWlzaDtcclxuICAgICAgICAgICAgRGVzY3JpcHRpb24gPSBcIk1pc3NpbmcgZGVzY3JpcHRpb24gZm9yIFwiICsgbmFtZTtcclxuICAgICAgICAgICAgdW5sb2NrZWQgPSB0cnVlO1xyXG4gICAgICAgICAgICBnYW1lTW9kZXMuQWRkKHRoaXMpO1xyXG4gICAgICAgIH1cclxuICAgICAgICBwdWJsaWMgc3RhdGljIEdhbWVNb2RlIFRlYW1CYXR0bGU7XHJcbiAgICAgICAgcHVibGljIHN0YXRpYyBHYW1lTW9kZSBEZWF0aE1hdGNoO1xyXG4gICAgICAgIHByb3RlY3RlZCBzdGF0aWMgTGlzdDxHYW1lTW9kZT4gZ2FtZU1vZGVzO1xyXG5cclxuICAgICAgICAvL1tJbml0XVxyXG4gICAgICAgIFtSZWFkeV1cclxuICAgICAgICBwcm90ZWN0ZWQgc3RhdGljIHZvaWQgaW5pdCgpXHJcbiAgICAgICAge1xyXG4gICAgICAgICAgICBpZiAoVGVhbUJhdHRsZSA9PSBudWxsKVxyXG4gICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICBnYW1lTW9kZXMgPSBuZXcgTGlzdDxHYW1lTW9kZT4oKTtcclxuICAgICAgICAgICAgICAgIFRlYW1CYXR0bGUgPSBuZXcgR2FtZU1vZGUoXCJUZWFtIEJhdHRsZVwiKTtcclxuICAgICAgICAgICAgICAgIFRlYW1CYXR0bGUuRGVzY3JpcHRpb24gPSBcIjIgdGVhbXMgYmF0dGxlIHdpdGggbGltaXRlZCBsaXZlc1xcbnVudGlsIG9ubHkgMSB0ZWFtIHJlbWFpbnMuXCI7XHJcbiAgICAgICAgICAgICAgICBEZWF0aE1hdGNoID0gbmV3IEdhbWVNb2RlKFwiRGVhdGggTWF0Y2hcIik7XHJcbiAgICAgICAgICAgICAgICBEZWF0aE1hdGNoLkRlc2NyaXB0aW9uID0gXCJBIGZyZWUgZm9yIGFsbCBtYXRjaCB3aXRoXFxubGltaXRlZCBsaXZlcy5cIjtcclxuICAgICAgICAgICAgICAgIERlYXRoTWF0Y2guVGVhbXMgPSBmYWxzZTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuICAgIH1cclxufVxyXG4iLCJ1c2luZyBTeXN0ZW07XHJcbnVzaW5nIFN5c3RlbS5Db2xsZWN0aW9ucy5HZW5lcmljO1xyXG51c2luZyBTeXN0ZW0uTGlucTtcclxudXNpbmcgU3lzdGVtLlRleHQ7XHJcbnVzaW5nIFN5c3RlbS5UaHJlYWRpbmcuVGFza3M7XHJcbnVzaW5nIEJyaWRnZTtcclxudXNpbmcgQnJpZGdlLkh0bWw1O1xyXG5cclxubmFtZXNwYWNlIENpcm5vR2FtZVxyXG57XHJcbiAgICBwdWJsaWMgY2xhc3MgRW50aXR5QmVoYXZpb3JcclxuICAgIHtcclxuICAgICAgICBwdWJsaWMgYm9vbCBlbmFibGVkID0gdHJ1ZTtcclxuICAgICAgICBwdWJsaWMgaW50IEZyYW1lc1BlclRpY2sgPSAwO1xyXG4gICAgICAgIHB1YmxpYyBFbnRpdHkgZW50aXR5O1xyXG4gICAgICAgIHB1YmxpYyBzdHJpbmcgQmVoYXZpb3JOYW1lIHsgZ2V0OyBwcm90ZWN0ZWQgc2V0OyB9XHJcbiAgICAgICAgcHVibGljIEVudGl0eUJlaGF2aW9yKEVudGl0eSBlbnRpdHkpXHJcbiAgICAgICAge1xyXG4gICAgICAgICAgICB0aGlzLmVudGl0eSA9IGVudGl0eTtcclxuICAgICAgICAgICAgaWYgKEJlaGF2aW9yTmFtZSA9PSBcIlwiIHx8IEJlaGF2aW9yTmFtZSA9PSBudWxsKVxyXG4gICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICBkeW5hbWljIHRlc3QgPSBHZXRUeXBlKCk7XHJcbiAgICAgICAgICAgICAgICB2YXIgRk4gPSBTY3JpcHQuV3JpdGU8c3RyaW5nPihcInRlc3RbXFxcIiQkZnVsbG5hbWVcXFwiXVwiKTtcclxuICAgICAgICAgICAgICAgIC8vSGVscGVyLkxvZyhcIkZOOlwiICsgRk4pO1xyXG4gICAgICAgICAgICAgICAgc3RyaW5nW10gcyA9IEZOLlNwbGl0KFwiLlwiKTtcclxuICAgICAgICAgICAgICAgIEJlaGF2aW9yTmFtZSA9IHNbcy5MZW5ndGggLSAxXTtcclxuICAgICAgICAgICAgICAgIC8vQmVoYXZpb3JOYW1lID0gR2V0VHlwZSgpLkZ1bGxOYW1lO1xyXG4gICAgICAgICAgICAgICAgLy9HZXRUeXBlKCkuR2V0Q2xhc3NOYW1lXHJcblxyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHB1YmxpYyB2aXJ0dWFsIHZvaWQgVXBkYXRlKClcclxuICAgICAgICB7XHJcblxyXG4gICAgICAgIH1cclxuICAgICAgICBwdWJsaWMgdmlydHVhbCB2b2lkIERyYXcoQ2FudmFzUmVuZGVyaW5nQ29udGV4dDJEIGcpXHJcbiAgICAgICAge1xyXG4gICAgICAgIH1cclxuICAgICAgICBwdWJsaWMgdm9pZCBTZW5kQ3VzdG9tRXZlbnQoZHluYW1pYyBldnQsIGJvb2wgdHJpZ2dlcmZsdXNoID0gZmFsc2UpXHJcbiAgICAgICAge1xyXG4gICAgICAgICAgICBkeW5hbWljIEQgPSBuZXcgb2JqZWN0KCk7XHJcbiAgICAgICAgICAgIEQuSSA9IGVudGl0eS5JRDtcclxuICAgICAgICAgICAgRC5EID0gZXZ0O1xyXG4gICAgICAgICAgICAvL0QuVCA9IHRoaXMuR2V0VHlwZSgpLkZ1bGxOYW1lO1xyXG4gICAgICAgICAgICBELlQgPSBCZWhhdmlvck5hbWU7XHJcbiAgICAgICAgICAgIGVudGl0eS5HYW1lLlNlbmRFdmVudChcIkNCRVwiLCBELCB0cmlnZ2VyZmx1c2gpO1xyXG4gICAgICAgIH1cclxuICAgICAgICBwdWJsaWMgdmlydHVhbCB2b2lkIEN1c3RvbUV2ZW50KGR5bmFtaWMgZXZ0KVxyXG4gICAgICAgIHtcclxuXHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG59XHJcbiIsInVzaW5nIFN5c3RlbTtcclxudXNpbmcgU3lzdGVtLkNvbGxlY3Rpb25zLkdlbmVyaWM7XHJcbnVzaW5nIFN5c3RlbS5MaW5xO1xyXG51c2luZyBTeXN0ZW0uVGV4dDtcclxudXNpbmcgU3lzdGVtLlRocmVhZGluZy5UYXNrcztcclxudXNpbmcgQnJpZGdlO1xyXG51c2luZyBCcmlkZ2UuSHRtbDU7XHJcblxyXG5uYW1lc3BhY2UgQ2lybm9HYW1lXHJcbntcclxuICAgIHB1YmxpYyBjbGFzcyBBbmltYXRpb25cclxuICAgIHtcclxuICAgICAgICBwdWJsaWMgTGlzdDxIVE1MSW1hZ2VFbGVtZW50PiBJbWFnZXM7XHJcbiAgICAgICAgcHJvdGVjdGVkIEhUTUxJbWFnZUVsZW1lbnQgX2N1cnJlbnRJbWFnZTtcclxuICAgICAgICBwdWJsaWMgSFRNTEltYWdlRWxlbWVudCBDdXJyZW50SW1hZ2VcclxuICAgICAgICB7XHJcbiAgICAgICAgICAgIGdldFxyXG4gICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gX2N1cnJlbnRJbWFnZTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBzZXRcclxuICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgaWYgKF9jdXJyZW50SW1hZ2UgIT0gdmFsdWUpXHJcbiAgICAgICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICAgICAgQnVmZmVyTmVlZHNSZWRyYXcgPSB0cnVlO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgX2N1cnJlbnRJbWFnZSA9IHZhbHVlO1xyXG5cclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuICAgICAgICBwdWJsaWMgZmxvYXQgQ3VycmVudEZyYW1lO1xyXG4gICAgICAgIHB1YmxpYyBmbG9hdCBJbWFnZVNwZWVkO1xyXG4gICAgICAgIHB1YmxpYyBWZWN0b3IyIFBvc2l0aW9uO1xyXG4gICAgICAgIHB1YmxpYyBpbnQgQW5pbWF0aW9uVGltZUVsYXBzZWQ7XHJcbiAgICAgICAgcHVibGljIGZsb2F0IFhcclxuICAgICAgICB7XHJcbiAgICAgICAgICAgIGdldFxyXG4gICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gUG9zaXRpb24uWDtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBzZXRcclxuICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgUG9zaXRpb24uWCA9IHZhbHVlO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHB1YmxpYyBmbG9hdCBZXHJcbiAgICAgICAge1xyXG4gICAgICAgICAgICBnZXRcclxuICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuIFBvc2l0aW9uLlk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgc2V0XHJcbiAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgIFBvc2l0aW9uLlkgPSB2YWx1ZTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuICAgICAgICBwdWJsaWMgZmxvYXQgU3RyZXRjaFdpZHRoID0gMDtcclxuICAgICAgICBwdWJsaWMgZmxvYXQgU3RyZXRjaEhlaWdodCA9IDA7XHJcbiAgICAgICAgcHVibGljIGZsb2F0IFJvdGF0aW9uID0gMDtcclxuICAgICAgICBwdWJsaWMgZmxvYXQgQWxwaGEgPSAxO1xyXG5cclxuICAgICAgICBwdWJsaWMgYm9vbCBMb29waW5nID0gdHJ1ZTtcclxuICAgICAgICBwdWJsaWMgYm9vbCBMb29wZWQgPSBmYWxzZTtcclxuICAgICAgICBwdWJsaWMgYm9vbCBGcmFtZUNoYW5nZWQgPSBmYWxzZTtcclxuICAgICAgICBwdWJsaWMgYm9vbCBGbGlwcGVkID0gZmFsc2U7XHJcbiAgICAgICAgcHJvdGVjdGVkIGJvb2wgX3RyYW5zZm9ybWVkID0gZmFsc2U7XHJcblxyXG4gICAgICAgIHByb3RlY3RlZCBmbG9hdCBfc2hhZG93O1xyXG4gICAgICAgIHB1YmxpYyBmbG9hdCBTaGFkb3dcclxuICAgICAgICB7XHJcbiAgICAgICAgICAgIGdldFxyXG4gICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gX3NoYWRvdztcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBzZXRcclxuICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgaWYgKF9zaGFkb3cgIT0gdmFsdWUpXHJcbiAgICAgICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICAgICAgX3NoYWRvdyA9IHZhbHVlO1xyXG4gICAgICAgICAgICAgICAgICAgIEJ1ZmZlck5lZWRzUmVkcmF3ID0gdHJ1ZTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuICAgICAgICBwcm90ZWN0ZWQgc3RyaW5nIF9zaGFkb3dDb2xvcjtcclxuICAgICAgICBwdWJsaWMgc3RyaW5nIFNoYWRvd2NvbG9yXHJcbiAgICAgICAge1xyXG4gICAgICAgICAgICBnZXRcclxuICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuIF9zaGFkb3dDb2xvcjtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBzZXRcclxuICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgaWYgKF9zaGFkb3dDb2xvciAhPSB2YWx1ZSlcclxuICAgICAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgICAgICBfc2hhZG93Q29sb3IgPSB2YWx1ZTtcclxuICAgICAgICAgICAgICAgICAgICBCdWZmZXJOZWVkc1JlZHJhdyA9IHRydWU7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIHByb3RlY3RlZCBib29sIEJ1ZmZlck5lZWRzUmVkcmF3ID0gdHJ1ZTtcclxuICAgICAgICBwcm90ZWN0ZWQgc3RyaW5nIF9odWVDb2xvcjtcclxuICAgICAgICBwdWJsaWMgc3RyaW5nIEh1ZUNvbG9yXHJcbiAgICAgICAge1xyXG4gICAgICAgICAgICBnZXRcclxuICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuIF9odWVDb2xvcjtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBzZXRcclxuICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgaWYgKF9odWVDb2xvciAhPSB2YWx1ZSlcclxuICAgICAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgICAgICBCdWZmZXJOZWVkc1JlZHJhdyA9IHRydWU7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICBfaHVlQ29sb3IgPSB2YWx1ZTtcclxuXHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcbiAgICAgICAgcHJvdGVjdGVkIGZsb2F0IF9odWVSZWNvbG9yU3RyZW5ndGg7XHJcbiAgICAgICAgcHVibGljIGZsb2F0IEh1ZVJlY29sb3JTdHJlbmd0aFxyXG4gICAgICAgIHtcclxuICAgICAgICAgICAgZ2V0XHJcbiAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgIHJldHVybiBfaHVlUmVjb2xvclN0cmVuZ3RoO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIHNldFxyXG4gICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICBpZiAoX2h1ZVJlY29sb3JTdHJlbmd0aCAhPSB2YWx1ZSlcclxuICAgICAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgICAgICBCdWZmZXJOZWVkc1JlZHJhdyA9IHRydWU7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICBfaHVlUmVjb2xvclN0cmVuZ3RoID0gdmFsdWU7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIHByb3RlY3RlZCBIVE1MQ2FudmFzRWxlbWVudCBfYnVmZmVyO1xyXG4gICAgICAgIHByb3RlY3RlZCBDYW52YXNSZW5kZXJpbmdDb250ZXh0MkQgX2JnO1xyXG5cclxuICAgICAgICBwdWJsaWMgQW5pbWF0aW9uKExpc3Q8SFRNTEltYWdlRWxlbWVudD4gZGF0YSlcclxuICAgICAgICB7XHJcbiAgICAgICAgICAgIEltYWdlcyA9IGRhdGE7XHJcbiAgICAgICAgICAgIGlmIChJbWFnZXMgPT0gbnVsbClcclxuICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgSW1hZ2VzID0gbmV3IExpc3Q8SFRNTEltYWdlRWxlbWVudD4oKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBJbWFnZVNwZWVkID0gMWY7XHJcbiAgICAgICAgICAgIFBvc2l0aW9uID0gbmV3IFZlY3RvcjIoKTtcclxuICAgICAgICAgICAgQW5pbWF0aW9uVGltZUVsYXBzZWQgPSAwO1xyXG4gICAgICAgICAgICBTaGFkb3cgPSAwO1xyXG4gICAgICAgICAgICBTaGFkb3djb2xvciA9IFwiI0ZGRkZGRlwiO1xyXG4gICAgICAgICAgICBIdWVDb2xvciA9IFwiXCI7XHJcbiAgICAgICAgICAgIEh1ZVJlY29sb3JTdHJlbmd0aCA9IDAuNmY7XHJcbiAgICAgICAgICAgIF9idWZmZXIgPSBuZXcgSFRNTENhbnZhc0VsZW1lbnQoKTtcclxuICAgICAgICAgICAgX2JnID0gX2J1ZmZlci5HZXRDb250ZXh0KENhbnZhc1R5cGVzLkNhbnZhc0NvbnRleHQyRFR5cGUuQ2FudmFzUmVuZGVyaW5nQ29udGV4dDJEKTtcclxuICAgICAgICAgICAgaWYgKEltYWdlcy5Db3VudCA+IDApXHJcbiAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgIFNldEltYWdlKCk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcbiAgICAgICAgcHVibGljIHZvaWQgVXBkYXRlKClcclxuICAgICAgICB7XHJcbiAgICAgICAgICAgIEhUTUxJbWFnZUVsZW1lbnQgTEkgPSBDdXJyZW50SW1hZ2U7XHJcbiAgICAgICAgICAgIGludCBsYXN0ID0gKGludClDdXJyZW50RnJhbWU7XHJcbiAgICAgICAgICAgIEN1cnJlbnRGcmFtZSArPSBJbWFnZVNwZWVkO1xyXG4gICAgICAgICAgICBpbnQgY3VycmVudCA9IChpbnQpQ3VycmVudEZyYW1lO1xyXG4gICAgICAgICAgICBpZiAoY3VycmVudCAhPSBsYXN0KVxyXG4gICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICBpZiAoSW1hZ2VzLkNvdW50ID4gMClcclxuICAgICAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgICAgICB3aGlsZSAoY3VycmVudCA+PSBJbWFnZXMuQ291bnQgJiYgY3VycmVudCA+IDApXHJcbiAgICAgICAgICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAoTG9vcGluZylcclxuICAgICAgICAgICAgICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgY3VycmVudCAtPSBJbWFnZXMuQ291bnQ7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBDdXJyZW50RnJhbWUgLT0gSW1hZ2VzLkNvdW50O1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGVsc2VcclxuICAgICAgICAgICAgICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgQ3VycmVudEZyYW1lIC09IEltYWdlU3BlZWQ7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgd2hpbGUgKGN1cnJlbnQgPCAwKVxyXG4gICAgICAgICAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgY3VycmVudCArPSBJbWFnZXMuQ291bnQ7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIEN1cnJlbnRGcmFtZSArPSBJbWFnZXMuQ291bnQ7XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgU2V0SW1hZ2UoKTtcclxuICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgTG9vcGVkID0gZmFsc2U7XHJcbiAgICAgICAgICAgIGlmIChMSSAhPSBDdXJyZW50SW1hZ2UpXHJcbiAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgIEZyYW1lQ2hhbmdlZCA9IHRydWU7XHJcbiAgICAgICAgICAgICAgICBpZiAoKEltYWdlU3BlZWQgPiAwICYmIGN1cnJlbnQgPT0gMCkgfHwgKChJbWFnZVNwZWVkIDwgMCAmJiBjdXJyZW50ID09IEltYWdlcy5Db3VudCAtIDEpKSlcclxuICAgICAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgICAgICBMb29wZWQgPSB0cnVlO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIGVsc2VcclxuICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgRnJhbWVDaGFuZ2VkID0gZmFsc2U7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgQW5pbWF0aW9uVGltZUVsYXBzZWQrKztcclxuICAgICAgICB9XHJcbiAgICAgICAgcHVibGljIHZvaWQgQ2hhbmdlQW5pbWF0aW9uKExpc3Q8SFRNTEltYWdlRWxlbWVudD4gYW5pLCBib29sIHJlc2V0ID0gdHJ1ZSlcclxuICAgICAgICB7XHJcbiAgICAgICAgICAgIGlmIChyZXNldClcclxuICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgQ3VycmVudEZyYW1lID0gMDtcclxuICAgICAgICAgICAgICAgIEFuaW1hdGlvblRpbWVFbGFwc2VkID0gMDtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBJbWFnZXMgPSBhbmk7XHJcbiAgICAgICAgICAgIC8vQ3VycmVudEltYWdlID0gSW1hZ2VzWyhpbnQpQ3VycmVudEZyYW1lXTtcclxuICAgICAgICAgICAgU2V0SW1hZ2UoKTtcclxuICAgICAgICB9XHJcbiAgICAgICAgcHVibGljIHZvaWQgU2V0SW1hZ2UoKVxyXG4gICAgICAgIHtcclxuICAgICAgICAgICAgaWYgKEltYWdlcy5Db3VudCA8IDIpXHJcbiAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgIEN1cnJlbnRGcmFtZSA9IDA7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgZWxzZVxyXG4gICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICB2YXIgbG4gPSBJbWFnZXMuQ291bnQ7XHJcbiAgICAgICAgICAgICAgICB3aGlsZSAoQ3VycmVudEZyYW1lIDwgMClcclxuICAgICAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgICAgICBDdXJyZW50RnJhbWUgKz0gbG47XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICB3aGlsZSAoQ3VycmVudEZyYW1lID49IGxuKVxyXG4gICAgICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgICAgIEN1cnJlbnRGcmFtZSAtPSBsbjtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBpbnQgY3VycmVudCA9IChpbnQpQ3VycmVudEZyYW1lO1xyXG4gICAgICAgICAgICBpZiAoY3VycmVudCA+PSAwICYmIGN1cnJlbnQgPCBJbWFnZXMuQ291bnQpXHJcbiAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgIEN1cnJlbnRJbWFnZSA9IEltYWdlc1tjdXJyZW50XTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuICAgICAgICBwdWJsaWMgdm9pZCBEcmF3KENhbnZhc1JlbmRlcmluZ0NvbnRleHQyRCBnKVxyXG4gICAgICAgIHtcclxuICAgICAgICAgICAgRHJhdyhnLCBQb3NpdGlvbik7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHB1YmxpYyB2b2lkIERyYXcoQ2FudmFzUmVuZGVyaW5nQ29udGV4dDJEIGcsIFZlY3RvcjIgcG9zaXRpb24pXHJcbiAgICAgICAge1xyXG4gICAgICAgICAgICBmbG9hdCB4ID0gcG9zaXRpb24uWDtcclxuICAgICAgICAgICAgZmxvYXQgeSA9IHBvc2l0aW9uLlk7XHJcbiAgICAgICAgICAgIGlmIChDdXJyZW50SW1hZ2UgPT0gbnVsbClcclxuICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgaW50IGN1cnJlbnQgPSAoaW50KUN1cnJlbnRGcmFtZTtcclxuICAgICAgICAgICAgICAgIGlmIChjdXJyZW50ID49IDAgJiYgY3VycmVudCA8IEltYWdlcy5Db3VudClcclxuICAgICAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgICAgICBDdXJyZW50SW1hZ2UgPSBJbWFnZXNbY3VycmVudF07XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICBpZiAoQ3VycmVudEltYWdlID09IG51bGwpXHJcbiAgICAgICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIGZsb2F0IFggPSB4O1xyXG4gICAgICAgICAgICBmbG9hdCBZID0geTtcclxuICAgICAgICAgICAgZmxvYXQgbGFzdGFscGhhID0gZy5HbG9iYWxBbHBoYTtcclxuICAgICAgICAgICAgYm9vbCBjZW50ZXJlZCA9IGZhbHNlO1xyXG4gICAgICAgICAgICBib29sIHVzZUJ1ZmZlciA9IGZhbHNlO1xyXG4gICAgICAgICAgICBpZiAoSHVlQ29sb3IgIT0gXCJcIilcclxuICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgaWYgKEJ1ZmZlck5lZWRzUmVkcmF3KVxyXG4gICAgICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgICAgIGJvb2wgYWR2ID0gdHJ1ZTtcclxuICAgICAgICAgICAgICAgICAgICBfYmcuR2xvYmFsQ29tcG9zaXRlT3BlcmF0aW9uID0gQ2FudmFzVHlwZXMuQ2FudmFzQ29tcG9zaXRlT3BlcmF0aW9uVHlwZS5Tb3VyY2VPdmVyO1xyXG4gICAgICAgICAgICAgICAgICAgIF9idWZmZXIuV2lkdGggPSBDdXJyZW50SW1hZ2UuV2lkdGg7XHJcbiAgICAgICAgICAgICAgICAgICAgX2J1ZmZlci5IZWlnaHQgPSBDdXJyZW50SW1hZ2UuSGVpZ2h0O1xyXG4gICAgICAgICAgICAgICAgICAgIF9iZy5EcmF3SW1hZ2UoQ3VycmVudEltYWdlLCAwZiwgMGYpO1xyXG4gICAgICAgICAgICAgICAgICAgIF9iZy5HbG9iYWxBbHBoYSA9IEh1ZVJlY29sb3JTdHJlbmd0aDtcclxuICAgICAgICAgICAgICAgICAgICBfYmcuR2xvYmFsQ29tcG9zaXRlT3BlcmF0aW9uID0gQ2FudmFzVHlwZXMuQ2FudmFzQ29tcG9zaXRlT3BlcmF0aW9uVHlwZS5IdWU7XHJcbiAgICAgICAgICAgICAgICAgICAgX2JnLkZpbGxTdHlsZSA9IEh1ZUNvbG9yO1xyXG4gICAgICAgICAgICAgICAgICAgIF9iZy5GaWxsUmVjdCgwLCAwLCBfYnVmZmVyLldpZHRoLCBfYnVmZmVyLkhlaWdodCk7XHJcblxyXG4gICAgICAgICAgICAgICAgICAgIGlmIChhZHYpXHJcbiAgICAgICAgICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBfYmcuR2xvYmFsQWxwaGEgPSAoMSArIEh1ZVJlY29sb3JTdHJlbmd0aCkgLyAyZjtcclxuICAgICAgICAgICAgICAgICAgICAgICAgX2JnLkdsb2JhbENvbXBvc2l0ZU9wZXJhdGlvbiA9IENhbnZhc1R5cGVzLkNhbnZhc0NvbXBvc2l0ZU9wZXJhdGlvblR5cGUuU291cmNlT3ZlcjtcclxuICAgICAgICAgICAgICAgICAgICAgICAgX2JnLkZpbGxSZWN0KDAsIDAsIF9idWZmZXIuV2lkdGgsIF9idWZmZXIuSGVpZ2h0KTtcclxuICAgICAgICAgICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICAgICAgICAgIF9iZy5HbG9iYWxBbHBoYSA9IDE7XHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKGFkdilcclxuICAgICAgICAgICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIF9iZy5HbG9iYWxDb21wb3NpdGVPcGVyYXRpb24gPSBDYW52YXNUeXBlcy5DYW52YXNDb21wb3NpdGVPcGVyYXRpb25UeXBlLkx1bWlub3NpdHk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIF9iZy5EcmF3SW1hZ2UoQ3VycmVudEltYWdlLCAwZiwgMGYpO1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICBTY3JpcHQuV3JpdGUoXCJ0aGlzLl9iZy5nbG9iYWxDb21wb3NpdGVPcGVyYXRpb24gPSAnZGVzdGluYXRpb24taW4nXCIpO1xyXG4gICAgICAgICAgICAgICAgICAgIF9iZy5EcmF3SW1hZ2UoQ3VycmVudEltYWdlLCAwZiwgMGYpO1xyXG4gICAgICAgICAgICAgICAgICAgIGlmIChhZHYpXHJcbiAgICAgICAgICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBfYmcuR2xvYmFsQ29tcG9zaXRlT3BlcmF0aW9uID0gQ2FudmFzVHlwZXMuQ2FudmFzQ29tcG9zaXRlT3BlcmF0aW9uVHlwZS5IdWU7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIF9iZy5HbG9iYWxBbHBoYSA9IEh1ZVJlY29sb3JTdHJlbmd0aCAqIDAuNGY7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIF9iZy5EcmF3SW1hZ2UoQ3VycmVudEltYWdlLCAwZiwgMGYpO1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICB1c2VCdWZmZXIgPSB0cnVlO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIGlmIChBbHBoYSA8IDEpXHJcbiAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgIGlmIChBbHBoYSA8PSAwKVxyXG4gICAgICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgICAgIHJldHVybjtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIGcuR2xvYmFsQWxwaGEgPSBnLkdsb2JhbEFscGhhICogQWxwaGE7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgLy9pZiAocm90YXRpb24gIT0gMClcclxuICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgZmxvYXQgeDIgPSBDdXJyZW50SW1hZ2UuV2lkdGggLyAyZjtcclxuICAgICAgICAgICAgICAgIGZsb2F0IHkyID0gQ3VycmVudEltYWdlLkhlaWdodCAvIDJmO1xyXG5cclxuICAgICAgICAgICAgICAgIFggPSAteDI7XHJcbiAgICAgICAgICAgICAgICBZID0gLXkyO1xyXG4gICAgICAgICAgICAgICAgaWYgKCFfdHJhbnNmb3JtZWQpXHJcbiAgICAgICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICAgICAgZy5TYXZlKCk7XHJcbiAgICAgICAgICAgICAgICAgICAgX3RyYW5zZm9ybWVkID0gdHJ1ZTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIGcuVHJhbnNsYXRlKHggKyB4MiwgeSArIHkyKTtcclxuICAgICAgICAgICAgICAgIGNlbnRlcmVkID0gdHJ1ZTtcclxuICAgICAgICAgICAgICAgIGcuUm90YXRlKFJvdGF0aW9uKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBpZiAoRmxpcHBlZClcclxuICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgaWYgKCFfdHJhbnNmb3JtZWQpXHJcbiAgICAgICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICAgICAgZy5TYXZlKCk7XHJcbiAgICAgICAgICAgICAgICAgICAgX3RyYW5zZm9ybWVkID0gdHJ1ZTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIGcuU2NhbGUoLTEsIDEpO1xyXG4gICAgICAgICAgICAgICAgLy9kb24ndCB0cmFuc2xhdGUgaWYgaXQncyBjZW50ZXJlZC5cclxuICAgICAgICAgICAgICAgIGlmICghY2VudGVyZWQpXHJcbiAgICAgICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICAgICAgZy5UcmFuc2xhdGUoQ3VycmVudEltYWdlLldpZHRoLCAwKTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBpZiAoU2hhZG93ID4gMClcclxuICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgZy5TaGFkb3dCbHVyID0gU2hhZG93O1xyXG4gICAgICAgICAgICAgICAgZy5TaGFkb3dDb2xvciA9IFNoYWRvd2NvbG9yO1xyXG4gICAgICAgICAgICAgICAgaWYgKCF1c2VCdWZmZXIgJiYgQnVmZmVyTmVlZHNSZWRyYXcpXHJcbiAgICAgICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICAgICAgX2JnLlNoYWRvd0JsdXIgPSAwO1xyXG4gICAgICAgICAgICAgICAgICAgIF9idWZmZXIuV2lkdGggPSBDdXJyZW50SW1hZ2UuV2lkdGg7XHJcbiAgICAgICAgICAgICAgICAgICAgX2J1ZmZlci5IZWlnaHQgPSBDdXJyZW50SW1hZ2UuSGVpZ2h0O1xyXG4gICAgICAgICAgICAgICAgICAgIF9iZy5EcmF3SW1hZ2UoQ3VycmVudEltYWdlLCAwZiwgMGYpO1xyXG4gICAgICAgICAgICAgICAgICAgIHVzZUJ1ZmZlciA9IHRydWU7XHJcbiAgICAgICAgICAgICAgICAgICAgLy9CdWZmZXJOZWVkc1JlZHJhdyA9IHRydWU7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICB1c2VCdWZmZXIgPSB0cnVlO1xyXG4gICAgICAgICAgICAgICAgLy9pZiAoKHVzZUJ1ZmZlciAmJiBCdWZmZXJOZWVkc1JlZHJhdykgfHwgUm90YXRpb24hPTAgfHwgdHJ1ZSlcclxuICAgICAgICAgICAgICAgIGlmIChCdWZmZXJOZWVkc1JlZHJhdylcclxuICAgICAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgICAgICBIVE1MQ2FudmFzRWxlbWVudCBDID0gSGVscGVyLkNsb25lQ2FudmFzKF9idWZmZXIpO1xyXG4gICAgICAgICAgICAgICAgICAgIENhbnZhc1JlbmRlcmluZ0NvbnRleHQyRCBDRyA9IEhlbHBlci5HZXRDb250ZXh0KEMpO1xyXG4gICAgICAgICAgICAgICAgICAgIF9idWZmZXIuV2lkdGggKz0gKGludCkoU2hhZG93ICogMik7XHJcbiAgICAgICAgICAgICAgICAgICAgX2J1ZmZlci5IZWlnaHQgKz0gKGludCkoU2hhZG93ICogMik7XHJcbiAgICAgICAgICAgICAgICAgICAgX2JnLlNoYWRvd0JsdXIgPSBTaGFkb3c7XHJcbiAgICAgICAgICAgICAgICAgICAgX2JnLlNoYWRvd0NvbG9yID0gU2hhZG93Y29sb3I7XHJcbiAgICAgICAgICAgICAgICAgICAgZHJhd1dpdGhTaGFkb3dzKF9iZywgQywgU2hhZG93LCBTaGFkb3csIDAsIDAsIFNoYWRvdyAvIDNmKTtcclxuICAgICAgICAgICAgICAgICAgICB1c2VCdWZmZXIgPSB0cnVlO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgWCAtPSBTaGFkb3c7XHJcbiAgICAgICAgICAgICAgICBZIC09IFNoYWRvdztcclxuICAgICAgICAgICAgICAgIGcuU2hhZG93Qmx1ciA9IDA7XHJcbiAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgIGlmIChTdHJldGNoV2lkdGggPT0gMCAmJiBTdHJldGNoSGVpZ2h0ID09IDApXHJcbiAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgIGlmIChTaGFkb3cgPiAwICYmIGZhbHNlKVxyXG4gICAgICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgICAgIGR5bmFtaWMgSSA9IEN1cnJlbnRJbWFnZTtcclxuICAgICAgICAgICAgICAgICAgICBpZiAodXNlQnVmZmVyKVxyXG4gICAgICAgICAgICAgICAgICAgICAgICBJID0gX2J1ZmZlcjtcclxuICAgICAgICAgICAgICAgICAgICBkcmF3V2l0aFNoYWRvd3MoZywgSSwgWCwgWSwgMCwgMCwgU2hhZG93IC8gMyk7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICBlbHNlXHJcbiAgICAgICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKCF1c2VCdWZmZXIpXHJcbiAgICAgICAgICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBnLkRyYXdJbWFnZShDdXJyZW50SW1hZ2UsIFgsIFkpO1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICBlbHNlXHJcbiAgICAgICAgICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBnLkRyYXdJbWFnZShfYnVmZmVyLCBYLCBZKTtcclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgZWxzZVxyXG4gICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICBpZiAoU2hhZG93ID4gMCAmJiBmYWxzZSlcclxuICAgICAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgICAgICBkeW5hbWljIEkgPSBDdXJyZW50SW1hZ2U7XHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKHVzZUJ1ZmZlcilcclxuICAgICAgICAgICAgICAgICAgICAgICAgSSA9IF9idWZmZXI7XHJcbiAgICAgICAgICAgICAgICAgICAgZHJhd1dpdGhTaGFkb3dzKGcsIEksIFgsIFksIFN0cmV0Y2hXaWR0aCwgU3RyZXRjaEhlaWdodCwgU2hhZG93IC8gMyk7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICBlbHNlXHJcbiAgICAgICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKCF1c2VCdWZmZXIpXHJcbiAgICAgICAgICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBnLkRyYXdJbWFnZShDdXJyZW50SW1hZ2UsIFgsIFksIFN0cmV0Y2hXaWR0aCwgU3RyZXRjaEhlaWdodCk7XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgIGVsc2VcclxuICAgICAgICAgICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGcuRHJhd0ltYWdlKF9idWZmZXIsIFgsIFksIFN0cmV0Y2hXaWR0aCwgU3RyZXRjaEhlaWdodCk7XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIGlmIChfdHJhbnNmb3JtZWQpXHJcbiAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgIGcuUmVzdG9yZSgpO1xyXG4gICAgICAgICAgICAgICAgX3RyYW5zZm9ybWVkID0gZmFsc2U7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgaWYgKFNoYWRvdyA+IDApXHJcbiAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgIGcuU2hhZG93Qmx1ciA9IDA7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgaWYgKEFscGhhIDwgMSlcclxuICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgZy5HbG9iYWxBbHBoYSA9IGxhc3RhbHBoYTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBCdWZmZXJOZWVkc1JlZHJhdyA9IGZhbHNlO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgcHJvdGVjdGVkIHZvaWQgZHJhd1dpdGhTaGFkb3dzKENhbnZhc1JlbmRlcmluZ0NvbnRleHQyRCBnLCBkeW5hbWljIEksIGZsb2F0IFgsIGZsb2F0IFksIGZsb2F0IFcsIGZsb2F0IEgsIGZsb2F0IHNpemUpXHJcbiAgICAgICAge1xyXG4gICAgICAgICAgICBpZiAoVyA9PSAwKVxyXG4gICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICBXID0gSS53aWR0aDtcclxuICAgICAgICAgICAgICAgIEggPSBJLmhlaWdodDtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBnLlNoYWRvd09mZnNldFggPSAtc2l6ZTtcclxuICAgICAgICAgICAgZy5EcmF3SW1hZ2UoSSwgWCwgWSwgVywgSCk7XHJcbiAgICAgICAgICAgIGcuU2hhZG93T2Zmc2V0WCA9IHNpemU7XHJcbiAgICAgICAgICAgIGcuRHJhd0ltYWdlKEksIFgsIFksIFcsIEgpO1xyXG4gICAgICAgICAgICBnLlNoYWRvd09mZnNldFggPSAwO1xyXG4gICAgICAgICAgICBnLlNoYWRvd09mZnNldFkgPSAtc2l6ZTtcclxuICAgICAgICAgICAgZy5EcmF3SW1hZ2UoSSwgWCwgWSwgVywgSCk7XHJcbiAgICAgICAgICAgIGcuU2hhZG93T2Zmc2V0WSA9IHNpemU7XHJcbiAgICAgICAgICAgIGcuRHJhd0ltYWdlKEksIFgsIFksIFcsIEgpO1xyXG5cclxuICAgICAgICAgICAgZy5TaGFkb3dPZmZzZXRZID0gMDtcclxuICAgICAgICB9XHJcblxyXG5cclxuICAgIH1cclxufVxyXG4iLCJ1c2luZyBTeXN0ZW07XHJcbnVzaW5nIFN5c3RlbS5Db2xsZWN0aW9ucy5HZW5lcmljO1xyXG51c2luZyBTeXN0ZW0uTGlucTtcclxudXNpbmcgU3lzdGVtLlRleHQ7XHJcbnVzaW5nIFN5c3RlbS5UaHJlYWRpbmcuVGFza3M7XHJcbnVzaW5nIEJyaWRnZTtcclxudXNpbmcgQnJpZGdlLkh0bWw1O1xyXG5cclxubmFtZXNwYWNlIENpcm5vR2FtZVxyXG57XHJcbiAgICBwdWJsaWMgY2xhc3MgQW5pbWF0aW9uTG9hZGVyXHJcbiAgICB7XHJcbiAgICAgICAgcHJvdGVjdGVkIERpY3Rpb25hcnk8c3RyaW5nLCBMaXN0PEhUTUxJbWFnZUVsZW1lbnQ+PiBfZGF0YTtcclxuICAgICAgICBwcm90ZWN0ZWQgc3RhdGljIEFuaW1hdGlvbkxvYWRlciBfX3RoaXM7XHJcbiAgICAgICAgcHVibGljIHN0YXRpYyBBbmltYXRpb25Mb2FkZXIgX3RoaXNcclxuICAgICAgICB7XHJcbiAgICAgICAgICAgIGdldFxyXG4gICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICBpZiAoX190aGlzID09IG51bGwpXHJcbiAgICAgICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICAgICAgX190aGlzID0gbmV3IEFuaW1hdGlvbkxvYWRlcigpO1xyXG4gICAgICAgICAgICAgICAgICAgIHRocm93IG5ldyBFeGNlcHRpb24oXCJBbmltYXRpb24gbG9hZGVyIG5vdCBpbml0aWF0ZWQuXCIpO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgcmV0dXJuIF9fdGhpcztcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuICAgICAgICBwdWJsaWMgSlNPTkFyY2hpdmUgQXJjaGl2ZTtcclxuICAgICAgICBwdWJsaWMgc3RhdGljIHZvaWQgSW5pdChKU09OQXJjaGl2ZSBBcmNoaXZlKVxyXG4gICAgICAgIHtcclxuICAgICAgICAgICAgX190aGlzID0gbmV3IEFuaW1hdGlvbkxvYWRlcigpO1xyXG4gICAgICAgICAgICBfX3RoaXMuQXJjaGl2ZSA9IEFyY2hpdmU7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBwdWJsaWMgQW5pbWF0aW9uTG9hZGVyKClcclxuICAgICAgICB7XHJcbiAgICAgICAgICAgIF9kYXRhID0gbmV3IERpY3Rpb25hcnk8c3RyaW5nLCBMaXN0PEhUTUxJbWFnZUVsZW1lbnQ+PigpO1xyXG4gICAgICAgIH1cclxuICAgICAgICBwdWJsaWMgc3RhdGljIExpc3Q8SFRNTEltYWdlRWxlbWVudD4gR2V0KHN0cmluZyBhbmkpXHJcbiAgICAgICAge1xyXG4gICAgICAgICAgICByZXR1cm4gX3RoaXMuR2V0QW5pbWF0aW9uKGFuaSk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHB1YmxpYyBMaXN0PEhUTUxJbWFnZUVsZW1lbnQ+IEdldEFuaW1hdGlvbihzdHJpbmcgYW5pKVxyXG4gICAgICAgIHtcclxuICAgICAgICAgICAgaWYgKF9kYXRhLkNvbnRhaW5zS2V5KGFuaSkpXHJcbiAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgIHJldHVybiBfZGF0YVthbmldO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIHZhciBBID0gbmV3IExpc3Q8SFRNTEltYWdlRWxlbWVudD4oKTtcclxuICAgICAgICAgICAgdmFyIEkgPSBBcmNoaXZlLkdldEltYWdlKGFuaSArIFwiLnBuZ1wiKTtcclxuICAgICAgICAgICAgaWYgKEkgIT0gbnVsbClcclxuICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgQS5BZGQoSSk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgZWxzZVxyXG4gICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICB2YXIgaiA9IDA7XHJcbiAgICAgICAgICAgICAgICB2YXIgU2FuaSA9IGFuaSArIFwiX1wiO1xyXG4gICAgICAgICAgICAgICAgd2hpbGUgKHRydWUpXHJcbiAgICAgICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICAgICAgSSA9IEFyY2hpdmUuR2V0SW1hZ2UoU2FuaSArIChqKyspICsgXCIucG5nXCIpO1xyXG4gICAgICAgICAgICAgICAgICAgIGlmIChJID09IG51bGwpXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrO1xyXG4gICAgICAgICAgICAgICAgICAgIGVsc2VcclxuICAgICAgICAgICAgICAgICAgICAgICAgQS5BZGQoSSk7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAvKmRvXHJcbiAgICAgICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICAgICAgSSA9IEFyY2hpdmUuR2V0SW1hZ2UoYW5pICsgXCJfXCIgKyBqICsgXCIucG5nXCIpO1xyXG4gICAgICAgICAgICAgICAgICAgIGlmIChJICE9IG51bGwpXHJcbiAgICAgICAgICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBBLkFkZChJKTtcclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICB9IHdoaWxlIChJICE9IG51bGwpOyovXHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgX2RhdGFbYW5pXSA9IEE7XHJcbiAgICAgICAgICAgIHJldHVybiBBO1xyXG4gICAgICAgIH1cclxuICAgIH1cclxufVxyXG4iLCJ1c2luZyBCcmlkZ2U7XHJcbnVzaW5nIEJyaWRnZS5IdG1sNTtcclxudXNpbmcgTmV3dG9uc29mdC5Kc29uO1xyXG51c2luZyBTeXN0ZW0uTGlucTtcclxudXNpbmcgU3lzdGVtO1xyXG5cclxubmFtZXNwYWNlIENpcm5vR2FtZVxyXG57XHJcbiAgICBwdWJsaWMgY2xhc3MgQXBwXHJcbiAgICB7XHJcbiAgICAgICAgcHVibGljIHN0YXRpYyBpbnQgRnJhbWUgPSAwO1xyXG4gICAgICAgIHB1YmxpYyBzdGF0aWMgSFRNTERpdkVsZW1lbnQgRGl2O1xyXG4gICAgICAgIHB1YmxpYyBzdGF0aWMgSFRNTENhbnZhc0VsZW1lbnQgQ2FudmFzO1xyXG4gICAgICAgIC8vcHVibGljIHN0YXRpYyBIVE1MQ2FudmFzRWxlbWVudCBndWlDYW52YXM7XHJcbiAgICAgICAgLy9wdWJsaWMgc3RhdGljIENhbnZhc1JlbmRlcmluZ0NvbnRleHQyRCBndWk7XHJcbiAgICAgICAgcHVibGljIHN0YXRpYyBSZWN0YW5nbGUgU2NyZWVuQm91bmRzO1xyXG5cclxuICAgICAgICBwdWJsaWMgc3RhdGljIEpTT05BcmNoaXZlIEpTT047XHJcbiAgICAgICAgcHVibGljIHN0YXRpYyBDYW52YXNSZW5kZXJpbmdDb250ZXh0MkQgRztcclxuICAgICAgICBwdWJsaWMgc3RhdGljIGRvdWJsZSBUYXJnZXRBc3BlY3Q7XHJcblxyXG4gICAgICAgIHByaXZhdGUgc3RhdGljIGRvdWJsZSBfbFNpemUgPSAtMTtcclxuICAgICAgICBwcm90ZWN0ZWQgc3RhdGljIGRvdWJsZSBfbWlzc2luZ1RpbWUgPSAwO1xyXG4gICAgICAgIHByb3RlY3RlZCBzdGF0aWMgZG91YmxlIF9sVGltZSA9IC0xO1xyXG4gICAgICAgIHB1YmxpYyBzdGF0aWMgZG91YmxlIHRvdGFsVGltZTtcclxuXHJcbiAgICAgICAgcHJvdGVjdGVkIHN0YXRpYyBib29sIF9mcmFtZVJlbmRlcmVkID0gZmFsc2U7XHJcblxyXG4gICAgICAgIHByb3RlY3RlZCBzdGF0aWMgYm9vbCBfZ2FtZVJlbmRlcmVkID0gZmFsc2U7XHJcblxyXG4gICAgICAgIHB1YmxpYyBzdGF0aWMgSW5wdXRDb250cm9sbGVyIElDO1xyXG4gICAgICAgIHB1YmxpYyBzdGF0aWMgR2FtZVNwcml0ZSBDdXJyZW50VmlldztcclxuXHJcbiAgICAgICAgcHVibGljIHN0YXRpYyBzdHJpbmcgR2FtZU5hbWUgPSBcIkNpcm5vJ3MgTXlzdGVyaW91cyBUb3dlclwiO1xyXG4gICAgICAgIHB1YmxpYyBzdGF0aWMgc3RyaW5nIEdhbWVWZXJzaW9uID0gXCIwLjNcIjtcclxuICAgICAgICAvKiNpZiBERUJVR1xyXG4gICAgICAgICAgICAgICAgcHVibGljIHN0YXRpYyBib29sIERFQlVHID0gdHJ1ZTtcclxuICAgICAgICAjZWxzZVxyXG4gICAgICAgICAgICAgICAgcHVibGljIHN0YXRpYyBib29sIERFQlVHID0gZmFsc2U7XHJcbiAgICAgICAgI2VuZGlmKi9cclxuICAgICAgICBwdWJsaWMgc3RhdGljIGJvb2wgREVCVUcgPSBmYWxzZTtcclxuICAgICAgICBwdWJsaWMgc3RhdGljIHZvaWQgTWFpbigpXHJcbiAgICAgICAge1xyXG4gICAgICAgICAgICAvL1VTRSBUSEUgSlNPTiBaSVAgQVJDSElWRSBGRUFUVVJFIEZST00gQk5URVNUIEZPUiBMT0FESU5HIElNQUdFUyBBTkQgRklMRVMuXHJcblxyXG4gICAgICAgICAgICBEb2N1bWVudC5Cb2R5LlN0eWxlLkNzc1RleHQgPSBcIm92ZXJmbG93OiBoaWRkZW47bWFyZ2luOiAwO3BhZGRpbmc6IDA7XCI7XHJcbiAgICAgICAgICAgIEdhbWVQYWRNYW5hZ2VyLl90aGlzID0gbmV3IEdhbWVQYWRNYW5hZ2VyKCk7XHJcbiAgICAgICAgICAgIEdhbWVQYWRNYW5hZ2VyLl90aGlzLlVwZGF0ZSgpO1xyXG4gICAgICAgICAgICBHbG9iYWwuU2V0VGltZW91dCgoZ2xvYmFsOjpTeXN0ZW0uQWN0aW9uKSgoKSA9PiB7XHJcbiAgICAgICAgICAgICAgICBHYW1lUGFkTWFuYWdlci5fdGhpcy5VcGRhdGUoKTtcclxuXHJcbiAgICAgICAgICAgICAgICBJQyA9IElucHV0Q29udHJvbGxlck1hbmFnZXIuX3RoaXMuQ29udHJvbGxlcnNbMF07XHJcbiAgICAgICAgICAgICAgICBJbnB1dE1hcCBJTSA9IElucHV0Q29udHJvbGxlck1hbmFnZXIuX3RoaXMuQ29udHJvbGxlcnNbMF0uSW5wdXRNYXBwaW5nWzJdO1xyXG5cclxuICAgICAgICAgICAgfSksIDUpO1xyXG5cclxuICAgICAgICAgICAgdmFyIG9rID0gZmFsc2U7XHJcbiAgICAgICAgICAgIHZhciB1cHRlc3QgPSB0cnVlO1xyXG4gICAgICAgICAgICBKU09OQXJjaGl2ZS5PcGVuKFwiQXNzZXRzL0ltYWdlcy5KU09OXCIsIChnbG9iYWw6OlN5c3RlbS5BY3Rpb248Z2xvYmFsOjpDaXJub0dhbWUuSlNPTkFyY2hpdmU+KShqc29uID0+XHJcbiAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgIEpTT04gPSBqc29uO1xyXG5cclxuICAgICAgICAgICAgICAgIEpTT04uUHJlbG9hZEltYWdlcygoZ2xvYmFsOjpTeXN0ZW0uQWN0aW9uKSgoKSA9PlxyXG4gICAgICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgICAgIG9rID0gdHJ1ZTtcclxuICAgICAgICAgICAgICAgICAgICBGaW5pc2goKTtcclxuICAgICAgICAgICAgICAgIH0pKTtcclxuICAgICAgICAgICAgfSkpO1xyXG5cclxuICAgICAgICAgICAgLy8gQWZ0ZXIgYnVpbGRpbmcgKEN0cmwgKyBTaGlmdCArIEIpIHRoaXMgcHJvamVjdCwgXHJcbiAgICAgICAgICAgIC8vIGJyb3dzZSB0byB0aGUgL2Jpbi9EZWJ1ZyBvciAvYmluL1JlbGVhc2UgZm9sZGVyLlxyXG5cclxuICAgICAgICAgICAgLy8gQSBuZXcgYnJpZGdlLyBmb2xkZXIgaXMgY3JlYXRlZCBhbmQgY29udGFpbnNcclxuICAgICAgICAgICAgLy8geW91ciBwcm9qZWN0cyBKYXZhU2NyaXB0IGZpbGVzLiBcclxuXHJcbiAgICAgICAgICAgIC8vIE9wZW4gdGhlIGJyaWRnZS9pbmRleC5odG1sIGZpbGUgaW4gYSBicm93ZXIgYnlcclxuICAgICAgICAgICAgLy8gUmlnaHQtQ2xpY2sgPiBPcGVuIFdpdGguLi4sIHRoZW4gY2hvb3NlIGFcclxuICAgICAgICAgICAgLy8gd2ViIGJyb3dzZXIgZnJvbSB0aGUgbGlzdFxyXG5cclxuICAgICAgICAgICAgLy8gVGhpcyBhcHBsaWNhdGlvbiB3aWxsIHRoZW4gcnVuIGluIGEgYnJvd3Nlci5cclxuXHJcblxyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgcHVibGljIHN0YXRpYyB2b2lkIEZpbmlzaCgpXHJcbiAgICAgICAge1xyXG4gICAgICAgICAgICBBbmltYXRpb25Mb2FkZXIuSW5pdChKU09OKTtcclxuICAgICAgICAgICAgdmFyIExUID0gRG9jdW1lbnQuR2V0RWxlbWVudEJ5SWQoXCJsb2FkdGV4dFwiKS5BczxIVE1MUGFyYWdyYXBoRWxlbWVudD4oKTtcclxuICAgICAgICAgICAgTFQuVGV4dENvbnRlbnQgPSBcIlwiO1xyXG4gICAgICAgICAgICBEb2N1bWVudC5Cb2R5LlN0eWxlLkN1cnNvciA9IEN1cnNvci5BdXRvO1xyXG4gICAgICAgICAgICBEb2N1bWVudC5UaXRsZSA9IEdhbWVOYW1lICsgXCIgXCIgKyBHYW1lVmVyc2lvbiArIFwiIGJ5OlJTR21ha2VyXCI7XHJcbiAgICAgICAgICAgIC8vdmFyIFIgPSBuZXcgUmVuZGVyZXIoKTtcclxuICAgICAgICAgICAgLy9Eb2N1bWVudC5Cb2R5LkFwcGVuZENoaWxkKFIudmlldyk7XHJcblxyXG4gICAgICAgICAgICBEaXYgPSBuZXcgSFRNTERpdkVsZW1lbnQoKTtcclxuICAgICAgICAgICAgSFRNTENhbnZhc0VsZW1lbnQgQ2FudiA9IG5ldyBIVE1MQ2FudmFzRWxlbWVudCgpO1xyXG4gICAgICAgICAgICBDYW52YXMgPSBDYW52O1xyXG4gICAgICAgICAgICBUYXJnZXRBc3BlY3QgPSAwLjc1O1xyXG4gICAgICAgICAgICBDYW52LldpZHRoID0gMTAyNDtcclxuICAgICAgICAgICAgQ2Fudi5IZWlnaHQgPSAoaW50KShDYW52LldpZHRoICogVGFyZ2V0QXNwZWN0KTtcclxuICAgICAgICAgICAgU2NyZWVuQm91bmRzID0gbmV3IFJlY3RhbmdsZSgwLCAwLCBDYW52LldpZHRoLCBDYW52LkhlaWdodCk7XHJcblxyXG4gICAgICAgICAgICBEaXYuQXBwZW5kQ2hpbGQoQ2Fudik7XHJcbiAgICAgICAgICAgIERvY3VtZW50LkJvZHkuQXBwZW5kQ2hpbGQoRGl2KTtcclxuICAgICAgICAgICAgLy9Eb2N1bWVudC5Cb2R5LkFwcGVuZENoaWxkKENhbnYpO1xyXG4gICAgICAgICAgICBHID0gQ2FudmFzLkdldENvbnRleHQoQ2FudmFzVHlwZXMuQ2FudmFzQ29udGV4dDJEVHlwZS5DYW52YXNSZW5kZXJpbmdDb250ZXh0MkQpO1xyXG5cclxuICAgICAgICAgICAgRy5JbWFnZVNtb290aGluZ0VuYWJsZWQgPSBmYWxzZTtcclxuICAgICAgICAgICAgQ2FudmFzLlN0eWxlLkltYWdlUmVuZGVyaW5nID0gSW1hZ2VSZW5kZXJpbmcuUGl4ZWxhdGVkO1xyXG4gICAgICAgICAgICB2YXIgZ2cgPSBHO1xyXG4gICAgICAgICAgICBTY3JpcHQuV3JpdGUoXCJnZy53ZWJraXRJbWFnZVNtb290aGluZ0VuYWJsZWQgPSBmYWxzZVwiKTtcclxuICAgICAgICAgICAgU2NyaXB0LldyaXRlKFwiZ2cubW96SW1hZ2VTbW9vdGhpbmdFbmFibGVkID0gZmFsc2VcIik7XHJcblxyXG5cclxuICAgICAgICAgICAgS2V5Ym9hcmRNYW5hZ2VyLkluaXQoKTtcclxuXHJcbiAgICAgICAgICAgIEN1cnJlbnRWaWV3ID0gbmV3IEdhbWUoKTtcclxuXHJcbiAgICAgICAgICAgIEFjdGlvbiBPbkYgPSBSQUY7XHJcbiAgICAgICAgICAgIFNjcmlwdC5Xcml0ZShcInJlcXVlc3RBbmltYXRpb25GcmFtZShPbkYpO1wiKTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIHByaXZhdGUgc3RhdGljIHZvaWQgdXBkYXRlV2luZG93KClcclxuICAgICAgICB7XHJcbiAgICAgICAgICAgIGRvdWJsZSBzaXplID0gTWF0aC5DZWlsaW5nKFdpbmRvdy5Jbm5lckhlaWdodCAqICgxIC8gVGFyZ2V0QXNwZWN0KSk7XHJcbiAgICAgICAgICAgIGlmIChzaXplICE9IF9sU2l6ZSlcclxuICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgQ2FudmFzLlN0eWxlLldpZHRoID0gXCIxMDAlXCI7XHJcbiAgICAgICAgICAgICAgICBEaXYuU3R5bGUuV2lkdGggPSBzaXplICsgXCJweFwiO1xyXG5cclxuICAgICAgICAgICAgICAgIERpdi5TdHlsZS5Qb3NpdGlvbiA9IFBvc2l0aW9uLlJlbGF0aXZlO1xyXG4gICAgICAgICAgICAgICAgRGl2LlN0eWxlLkxlZnQgPSAoKFdpbmRvdy5Jbm5lcldpZHRoIC8gMikgLSAoc2l6ZSAvIDIpKSArIFwicHhcIjtcclxuICAgICAgICAgICAgICAgIHNpemUgPSBfbFNpemU7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcbiAgICAgICAgcHJvdGVjdGVkIHN0YXRpYyB2b2lkIFVwZGF0ZUlucHV0cygpXHJcbiAgICAgICAge1xyXG4gICAgICAgICAgICBpZiAoSUMgIT0gbnVsbClcclxuICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgdmFyIEwgPSBJbnB1dENvbnRyb2xsZXJNYW5hZ2VyLl90aGlzLkNvbnRyb2xsZXJzO1xyXG4gICAgICAgICAgICAgICAgaWYgKEwuQ291bnQgPiAxKVxyXG4gICAgICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgICAgIC8qTGlzdDxpbnQ+IGtleXMgPSBLZXlib2FyZE1hbmFnZXIuX3RoaXMuVGFwcGVkQnV0dG9ucztcclxuICAgICAgICAgICAgICAgICAgICBpZiAoa2V5cy5Db250YWlucygxMDcpKVxyXG4gICAgICAgICAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgaW50IGluZGV4ID0gTC5JbmRleE9mKElDKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgaW5kZXgrKztcclxuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGluZGV4ID49IEwuQ291bnQpXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGluZGV4IC09IEwuQ291bnQ7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICAgICAgSUMgPSBMW2luZGV4XTtcclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKGtleXMuQ29udGFpbnMoMTA5KSlcclxuICAgICAgICAgICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGludCBpbmRleCA9IEwuSW5kZXhPZihJQyk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGluZGV4LS07XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChpbmRleCA8IDApXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGluZGV4ICs9IEwuQ291bnQ7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICAgICAgSUMgPSBMW2luZGV4XTtcclxuICAgICAgICAgICAgICAgICAgICB9Ki9cclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBLZXlib2FyZE1hbmFnZXIuVXBkYXRlKCk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHByb3RlY3RlZCBzdGF0aWMgdm9pZCBVcGRhdGUoZG91YmxlIHRpbWUpXHJcbiAgICAgICAge1xyXG4gICAgICAgICAgICBkb3VibGUgZGVsdGEgPSAwO1xyXG4gICAgICAgICAgICB0b3RhbFRpbWUgPSB0aW1lO1xyXG4gICAgICAgICAgICBpZiAodGltZSA+PSAwKVxyXG4gICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICBpZiAoX2xUaW1lIDwgMClcclxuICAgICAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgICAgICBfbFRpbWUgPSB0aW1lO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgZWxzZVxyXG4gICAgICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgICAgIC8vbWlzc2luZ1RpbWUgLT0gMTYuNjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY3O1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgZGVsdGEgPSAodGltZSAtIF9sVGltZSk7XHJcbiAgICAgICAgICAgICAgICBfbWlzc2luZ1RpbWUgKz0gKGRlbHRhKTtcclxuICAgICAgICAgICAgICAgIGlmIChDdXJyZW50VmlldyBpcyBHYW1lKVxyXG4gICAgICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgICAgIHZhciBHID0gKEdhbWUpQ3VycmVudFZpZXc7XHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKEcucnVubmluZylcclxuICAgICAgICAgICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIEcudG90YWxUaW1lICs9IChmbG9hdClkZWx0YTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKEcudGltZVJlbWFpbmluZyA+IDApXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBHLnRpbWVSZW1haW5pbmcgLT0gKGZsb2F0KWRlbHRhO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAoRy50aW1lUmVtYWluaW5nIDw9IDApXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBHLnRpbWVSZW1haW5pbmcgPSAwO1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB1cGRhdGVXaW5kb3coKTtcclxuICAgICAgICAgICAgLyppZiAoZGVsdGEgPiAyMilcclxuICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgTGFnZ2luZyA9IHRydWU7XHJcbiAgICAgICAgICAgIH0qL1xyXG5cclxuICAgICAgICAgICAgaWYgKC8qdXNlUkFGIHx8ICovX21pc3NpbmdUaW1lID4gMTIvKiB8fCAoX2ZyYW1lUmVuZGVyZWQgJiYgX21pc3NpbmdUaW1lID4gMCkqLylcclxuICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgaWYgKEN1cnJlbnRWaWV3ICE9IG51bGwpXHJcbiAgICAgICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICAgICAgQ3VycmVudFZpZXcuVXBkYXRlKCk7XHJcbiAgICAgICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICAgICAgX21pc3NpbmdUaW1lIC09IDE2LjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NztcclxuICAgICAgICAgICAgICAgIF9mcmFtZVJlbmRlcmVkID0gZmFsc2U7XHJcbiAgICAgICAgICAgICAgICBfZ2FtZVJlbmRlcmVkID0gZmFsc2U7XHJcblxyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIGVsc2VcclxuICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgX2xUaW1lID0gdGltZTtcclxuICAgICAgICAgICAgICAgIHJldHVybjtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBpZiAodGltZSA+PSAwKVxyXG4gICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICBpZiAoX21pc3NpbmdUaW1lID49IDMwMDApXHJcbiAgICAgICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICAgICAgX21pc3NpbmdUaW1lID0gMDtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIGlmIChfbWlzc2luZ1RpbWUgPj0gMTAwMDApXHJcbiAgICAgICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICAgICAgLy9HYW1lIGlzIGxhZ2dpbmcgdG9vIG11Y2ggdG8gcHJvcGVybHkgcGxheSBtdWx0aXBsYXllci5cclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIGRvdWJsZSBUID0gMTYuNjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY3O1xyXG4gICAgICAgICAgICAgICAgaWYgKHRydWUpXHJcbiAgICAgICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICAgICAgVCArPSA4O1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgd2hpbGUgKF9taXNzaW5nVGltZSA+PSBUKVxyXG4gICAgICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgICAgIGlmIChDdXJyZW50VmlldyAhPSBudWxsKVxyXG4gICAgICAgICAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgQ3VycmVudFZpZXcuVXBkYXRlKCk7XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgIF9taXNzaW5nVGltZSAtPSAxNi42NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2Njc7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgLy8vZ2FtZS5SZW5kZXIoKTtcclxuICAgICAgICAgICAgLy9nYW1lLkRyYXcoZyk7XHJcbiAgICAgICAgICAgIF9sVGltZSA9IHRpbWU7XHJcbiAgICAgICAgICAgIEZyYW1lKys7XHJcbiAgICAgICAgICAgIEcuQ2xlYXIoKTtcclxuICAgICAgICAgICAgR2FtZVBhZE1hbmFnZXIuX3RoaXMuVXBkYXRlKCk7XHJcbiAgICAgICAgICAgIGlmIChDdXJyZW50VmlldyAhPSBudWxsKVxyXG4gICAgICAgICAgICB7XHJcblxyXG4gICAgICAgICAgICAgICAgQ3VycmVudFZpZXcuVXBkYXRlKCk7XHJcbiAgICAgICAgICAgICAgICBDdXJyZW50Vmlldy5SZW5kZXIoKTtcclxuICAgICAgICAgICAgICAgIEcuRHJhd0ltYWdlKEN1cnJlbnRWaWV3LnNwcml0ZUJ1ZmZlciwgMGYsIDBmLCBDYW52YXMuV2lkdGgsIENhbnZhcy5IZWlnaHQpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIC8vRy5GaWxsU3R5bGUgPSBcIlwiK0NvbnZlcnQuIEZyYW1lO1xyXG4gICAgICAgICAgICAvL0cuRmlsbFN0eWxlID0gXCIjXCIgKyBGcmFtZS5Ub1N0cmluZyhcIlg2XCIpO1xyXG4gICAgICAgICAgICAvKkcuRmlsbFN0eWxlID0gXCIjXCIgKyBDb2xvckZyb21BaHNiKDEsKEZyYW1lLzIpICUgMzYwLDAuOGYsMC43ZikuVG9TdHJpbmcoXCJYNlwiKTtcclxuICAgICAgICAgICAgRy5GaWxsUmVjdCgwLCAwLCBHLkNhbnZhcy5XaWR0aCwgRy5DYW52YXMuSGVpZ2h0KTtcclxuXHJcbiAgICAgICAgICAgIEcuRmlsbFN0eWxlID0gXCJyZWRcIjtcclxuICAgICAgICAgICAgdmFyIHggPSAoKDAgKyBGcmFtZSAqIDMpICUgKEcuQ2FudmFzLldpZHRoICsgMTAwKSkgLSAxMDA7XHJcbiAgICAgICAgICAgIHZhciB5ID0gKCgwICsgRnJhbWUpICUgKEcuQ2FudmFzLkhlaWdodCArIDEwMCkpIC0gMTAwO1xyXG4gICAgICAgICAgICAvL0cuRmlsbFJlY3QoeCwgeSwgMTAwLCAxMDApO1xyXG5cclxuICAgICAgICAgICAgdmFyIFYgPSBKU09OLkltYWdlcy5WYWx1ZXMuVG9BcnJheSgpO1xyXG5cclxuICAgICAgICAgICAgdmFyIGltZyA9IFZbKEZyYW1lLzEwKSAlIFYuTGVuZ3RoXTtcclxuICAgICAgICAgICAgRy5EcmF3SW1hZ2UoaW1nLCB4LCB5LGltZy5XaWR0aCo0LGltZy5IZWlnaHQgKiA0KTsqL1xyXG4gICAgICAgICAgICBVcGRhdGVJbnB1dHMoKTtcclxuICAgICAgICB9XHJcbiAgICAgICAgcHJpdmF0ZSBzdGF0aWMgdm9pZCBSQUYoKVxyXG4gICAgICAgIHtcclxuXHJcbiAgICAgICAgICAgIEFjdGlvbiBPbkYgPSBSQUY7XHJcbiAgICAgICAgICAgIFNjcmlwdC5Xcml0ZShcInJlcXVlc3RBbmltYXRpb25GcmFtZShPbkYpO1wiKTtcclxuICAgICAgICAgICAgZG91YmxlIHRpbWUgPSBHbG9iYWwuUGVyZm9ybWFuY2UuTm93KCk7XHJcbiAgICAgICAgICAgIFVwZGF0ZSh0aW1lKTtcclxuICAgICAgICB9XHJcbiAgICAgICAgcHVibGljIHN0YXRpYyBpbnQgQ29sb3JGcm9tQWhzYihpbnQgYSwgZmxvYXQgaCwgZmxvYXQgcywgZmxvYXQgYilcclxuICAgICAgICB7XHJcblxyXG4gICAgICAgICAgICAvKmlmICgwID4gYSB8fCAyNTUgPCBhKVxyXG4gICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICB0aHJvdyBuZXcgQXJndW1lbnRPdXRPZlJhbmdlRXhjZXB0aW9uKFwiYVwiLCBhLFxyXG4gICAgICAgICAgICAgICAgICBQcm9wZXJ0aWVzLlJlc291cmNlcy5JbnZhbGlkQWxwaGEpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIGlmICgwZiA+IGggfHwgMzYwZiA8IGgpXHJcbiAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgIHRocm93IG5ldyBBcmd1bWVudE91dE9mUmFuZ2VFeGNlcHRpb24oXCJoXCIsIGgsXHJcbiAgICAgICAgICAgICAgICAgIFByb3BlcnRpZXMuUmVzb3VyY2VzLkludmFsaWRIdWUpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIGlmICgwZiA+IHMgfHwgMWYgPCBzKVxyXG4gICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICB0aHJvdyBuZXcgQXJndW1lbnRPdXRPZlJhbmdlRXhjZXB0aW9uKFwic1wiLCBzLFxyXG4gICAgICAgICAgICAgICAgICBQcm9wZXJ0aWVzLlJlc291cmNlcy5JbnZhbGlkU2F0dXJhdGlvbik7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgaWYgKDBmID4gYiB8fCAxZiA8IGIpXHJcbiAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgIHRocm93IG5ldyBBcmd1bWVudE91dE9mUmFuZ2VFeGNlcHRpb24oXCJiXCIsIGIsXHJcbiAgICAgICAgICAgICAgICAgIFByb3BlcnRpZXMuUmVzb3VyY2VzLkludmFsaWRCcmlnaHRuZXNzKTtcclxuICAgICAgICAgICAgfSovXHJcblxyXG4gICAgICAgICAgICBpZiAoMCA9PSBzKVxyXG4gICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICAvL3JldHVybiBDcmVhdGVTaGFkZShiIC8gMjU1LjApO1xyXG4gICAgICAgICAgICAgICAgLy9yZXR1cm4gMHg4MDgwODA7XHJcbiAgICAgICAgICAgICAgICB2YXIgc2hhZGUgPSAoaW50KShiIC8gMjU1LjApO1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuIFJHQlRvSW50KHNoYWRlLCBzaGFkZSwgc2hhZGUpO1xyXG4gICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICBmbG9hdCBmTWF4LCBmTWlkLCBmTWluO1xyXG4gICAgICAgICAgICBpbnQgaVNleHRhbnQsIGlNYXgsIGlNaWQsIGlNaW47XHJcblxyXG4gICAgICAgICAgICBpZiAoMC41IDwgYilcclxuICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgZk1heCA9IGIgLSAoYiAqIHMpICsgcztcclxuICAgICAgICAgICAgICAgIGZNaW4gPSBiICsgKGIgKiBzKSAtIHM7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgZWxzZVxyXG4gICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICBmTWF4ID0gYiArIChiICogcyk7XHJcbiAgICAgICAgICAgICAgICBmTWluID0gYiAtIChiICogcyk7XHJcbiAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgIGlTZXh0YW50ID0gKGludClNYXRoLkZsb29yKGggLyA2MGYpO1xyXG4gICAgICAgICAgICBpZiAoMzAwZiA8PSBoKVxyXG4gICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICBoIC09IDM2MGY7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgaCAvPSA2MGY7XHJcbiAgICAgICAgICAgIGggLT0gMmYgKiAoZmxvYXQpTWF0aC5GbG9vcigoKGlTZXh0YW50ICsgMWYpICUgNmYpIC8gMmYpO1xyXG4gICAgICAgICAgICBpZiAoMCA9PSBpU2V4dGFudCAlIDIpXHJcbiAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgIGZNaWQgPSBoICogKGZNYXggLSBmTWluKSArIGZNaW47XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgZWxzZVxyXG4gICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICBmTWlkID0gZk1pbiAtIGggKiAoZk1heCAtIGZNaW4pO1xyXG4gICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICBpTWF4ID0gQ29udmVydC5Ub0ludDMyKGZNYXggKiAyNTUpO1xyXG4gICAgICAgICAgICBpTWlkID0gQ29udmVydC5Ub0ludDMyKGZNaWQgKiAyNTUpO1xyXG4gICAgICAgICAgICBpTWluID0gQ29udmVydC5Ub0ludDMyKGZNaW4gKiAyNTUpO1xyXG5cclxuICAgICAgICAgICAgc3dpdGNoIChpU2V4dGFudClcclxuICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgY2FzZSAxOlxyXG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBSR0JUb0ludChpTWlkLCBpTWF4LCBpTWluKTtcclxuICAgICAgICAgICAgICAgIGNhc2UgMjpcclxuICAgICAgICAgICAgICAgICAgICByZXR1cm4gUkdCVG9JbnQoaU1pbiwgaU1heCwgaU1pZCk7XHJcbiAgICAgICAgICAgICAgICBjYXNlIDM6XHJcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIFJHQlRvSW50KGlNaW4sIGlNaWQsIGlNYXgpO1xyXG4gICAgICAgICAgICAgICAgY2FzZSA0OlxyXG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBSR0JUb0ludChpTWlkLCBpTWluLCBpTWF4KTtcclxuICAgICAgICAgICAgICAgIGNhc2UgNTpcclxuICAgICAgICAgICAgICAgICAgICByZXR1cm4gUkdCVG9JbnQoaU1heCwgaU1pbiwgaU1pZCk7XHJcbiAgICAgICAgICAgICAgICBkZWZhdWx0OlxyXG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBSR0JUb0ludChpTWF4LCBpTWlkLCBpTWluKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuICAgICAgICBwdWJsaWMgc3RhdGljIGludCBSR0JUb0ludChpbnQgUiwgaW50IEcsIGludCBCKVxyXG4gICAgICAgIHtcclxuICAgICAgICAgICAgcmV0dXJuIFIgKyAoRyA8PCA4KSArIChCIDw8IDE2KTtcclxuICAgICAgICB9XHJcbiAgICB9XHJcbn0iLCJ1c2luZyBTeXN0ZW07XHJcbnVzaW5nIFN5c3RlbS5Db2xsZWN0aW9ucy5HZW5lcmljO1xyXG51c2luZyBTeXN0ZW0uTGlucTtcclxudXNpbmcgU3lzdGVtLlRleHQ7XHJcbnVzaW5nIFN5c3RlbS5UaHJlYWRpbmcuVGFza3M7XHJcbnVzaW5nIEJyaWRnZTtcclxudXNpbmcgQnJpZGdlLkh0bWw1O1xyXG5cclxubmFtZXNwYWNlIENpcm5vR2FtZVxyXG57XHJcbiAgICBwdWJsaWMgY2xhc3MgQXVkaW9cclxuICAgIHtcclxuICAgICAgICBwcm90ZWN0ZWQgQXVkaW9NYW5hZ2VyIF9BTTtcclxuICAgICAgICBwcm90ZWN0ZWQgSFRNTEF1ZGlvRWxlbWVudCBfYXVkaW87XHJcbiAgICAgICAgcHJvdGVjdGVkIGJvb2wgX2hhc1BsYXllZDtcclxuICAgICAgICBwdWJsaWMgc3RyaW5nIElEIHsgZ2V0OyBwcm90ZWN0ZWQgc2V0OyB9XHJcbiAgICAgICAgcHJvdGVjdGVkIExpc3Q8SFRNTEF1ZGlvRWxlbWVudD4gX2JsYXN0O1xyXG4gICAgICAgIHB1YmxpYyBkb3VibGUgbGFzdHBsYXllZCA9IGRvdWJsZS5OZWdhdGl2ZUluZmluaXR5O1xyXG4gICAgICAgIHB1YmxpYyBib29sIElzUGxheWluZ1xyXG4gICAgICAgIHtcclxuICAgICAgICAgICAgZ2V0XHJcbiAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgIHJldHVybiAhKCFfaGFzUGxheWVkIHx8IF9hdWRpby5QYXVzZWQgfHwgX2F1ZGlvLkN1cnJlbnRUaW1lID09IDAuMCk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgc2V0XHJcbiAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgIGlmICh2YWx1ZSlcclxuICAgICAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgICAgICBQbGF5KCk7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICBlbHNlXHJcbiAgICAgICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICAgICAgUGF1c2UoKTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuICAgICAgICBwcm90ZWN0ZWQgYm9vbCBfbG9vcDtcclxuICAgICAgICBwdWJsaWMgYm9vbCBMb29wXHJcbiAgICAgICAge1xyXG4gICAgICAgICAgICBnZXRcclxuICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgLy9yZXR1cm4gX2F1ZGlvLkxvb3A7XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gX2xvb3A7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgc2V0XHJcbiAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgIC8vX2F1ZGlvLkxvb3AgPSB2YWx1ZTtcclxuICAgICAgICAgICAgICAgIF9sb29wID0gdmFsdWU7XHJcbiAgICAgICAgICAgICAgICAvL19hdWRpby5Mb29wID0gdmFsdWU7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcbiAgICAgICAgcHVibGljIGRvdWJsZSBDdXJyZW50VGltZVxyXG4gICAgICAgIHtcclxuICAgICAgICAgICAgZ2V0XHJcbiAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgIHJldHVybiBfYXVkaW8uQ3VycmVudFRpbWU7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgc2V0XHJcbiAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgIF9hdWRpby5DdXJyZW50VGltZSA9IHZhbHVlO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHB1YmxpYyBkb3VibGUgVm9sdW1lXHJcbiAgICAgICAge1xyXG4gICAgICAgICAgICBnZXRcclxuICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuIF9hdWRpby5Wb2x1bWU7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgc2V0XHJcbiAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgIF9hdWRpby5Wb2x1bWUgPSB2YWx1ZTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuICAgICAgICBwdWJsaWMgYm9vbCBQbGF5KClcclxuICAgICAgICB7XHJcbiAgICAgICAgICAgIGlmICghSXNQbGF5aW5nKVxyXG4gICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICBsYXN0dGltZSA9IEN1cnJlbnRUaW1lO1xyXG4gICAgICAgICAgICAgICAgX2F1ZGlvLlBsYXkoKTtcclxuICAgICAgICAgICAgICAgIF9oYXNQbGF5ZWQgPSB0cnVlO1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuIHRydWU7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xyXG4gICAgICAgIH1cclxuICAgICAgICBwdWJsaWMgYm9vbCBQYXVzZSgpXHJcbiAgICAgICAge1xyXG4gICAgICAgICAgICBpZiAoSXNQbGF5aW5nKVxyXG4gICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICBfYXVkaW8uUGF1c2UoKTtcclxuICAgICAgICAgICAgICAgIHJldHVybiB0cnVlO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIHJldHVybiBmYWxzZTtcclxuICAgICAgICB9XHJcbiAgICAgICAgcHVibGljIGJvb2wgU3RvcCgpXHJcbiAgICAgICAge1xyXG4gICAgICAgICAgICBpZiAoSXNQbGF5aW5nKVxyXG4gICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICBfYXVkaW8uUGF1c2UoKTtcclxuICAgICAgICAgICAgICAgIF9hdWRpby5DdXJyZW50VGltZSA9IDA7XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gdHJ1ZTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICByZXR1cm4gZmFsc2U7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHB1YmxpYyBBY3Rpb248QXVkaW8+IE9uUGxheTtcclxuICAgICAgICBwdWJsaWMgQWN0aW9uPEF1ZGlvPiBPblN0b3A7XHJcbiAgICAgICAgcHVibGljIEF1ZGlvKEhUTUxBdWRpb0VsZW1lbnQgYXVkaW8sIHN0cmluZyBJRCwgQXVkaW9NYW5hZ2VyIEF1ZGlvTWFuYWdlcilcclxuICAgICAgICB7XHJcbiAgICAgICAgICAgIF9hdWRpbyA9IGF1ZGlvO1xyXG4gICAgICAgICAgICB0aGlzLklEID0gSUQ7XHJcbiAgICAgICAgICAgIHZhciBzZWxmID0gdGhpcztcclxuICAgICAgICAgICAgX0FNID0gQXVkaW9NYW5hZ2VyO1xyXG4gICAgICAgICAgICAvL29iamVjdCBBID0gKCgpID0+IHNlbGYuX09uUGxheSk7XHJcbiAgICAgICAgICAgIC8vQWN0aW9uIEEgPSBuZXcgQWN0aW9uKCgpID0+IHNlbGYuX09uUGxheSgpKTtcclxuXHJcbiAgICAgICAgICAgIF9hdWRpby5PblBsYXkgPSBuZXcgQWN0aW9uKCgpID0+IHNlbGYuX09uUGxheSgpKS5Ub0R5bmFtaWMoKTtcclxuICAgICAgICAgICAgX2F1ZGlvLk9uUGF1c2UgPSBuZXcgQWN0aW9uKCgpID0+IHNlbGYuX09uU3RvcCgpKS5Ub0R5bmFtaWMoKTtcclxuICAgICAgICAgICAgLy9fYXVkaW8uT25FbmRlZCA9IG5ldyBBY3Rpb24oKCkgPT4gc2VsZi5fT25TdG9wKCkpLlRvRHluYW1pYygpO1xyXG4gICAgICAgICAgICBfYXVkaW8uT25FbmRlZCA9IG5ldyBBY3Rpb24oKCkgPT4gc2VsZi5fT25FbmQoKSkuVG9EeW5hbWljKCk7XHJcbiAgICAgICAgICAgIF9hdWRpby5PblRpbWVVcGRhdGUgPSBuZXcgQWN0aW9uKCgpID0+IHNlbGYuX09uVXBkYXRlKCkpLlRvRHluYW1pYygpO1xyXG5cclxuICAgICAgICAgICAgX2JsYXN0ID0gbmV3IExpc3Q8SFRNTEF1ZGlvRWxlbWVudD4oKTtcclxuICAgICAgICAgICAgaW50IG1heHZvaWNlcyA9IDY7XHJcbiAgICAgICAgICAgIGludCB2b2ljZXMgPSAxO1xyXG4gICAgICAgICAgICB3aGlsZSAodm9pY2VzIDwgbWF4dm9pY2VzKVxyXG4gICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICBfYmxhc3QuQWRkKChIVE1MQXVkaW9FbGVtZW50KV9hdWRpby5DbG9uZU5vZGUoKSk7XHJcbiAgICAgICAgICAgICAgICB2b2ljZXMgKz0gMTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAvKl9ibGFzdC5BZGQoKEF1ZGlvRWxlbWVudClfYXVkaW8uQ2xvbmVOb2RlKCkpO1xyXG4gICAgICAgICAgICBfYmxhc3QuQWRkKChBdWRpb0VsZW1lbnQpX2F1ZGlvLkNsb25lTm9kZSgpKTtcclxuICAgICAgICAgICAgX2JsYXN0LkFkZCgoQXVkaW9FbGVtZW50KV9hdWRpby5DbG9uZU5vZGUoKSk7XHJcbiAgICAgICAgICAgIF9ibGFzdC5BZGQoKEF1ZGlvRWxlbWVudClfYXVkaW8uQ2xvbmVOb2RlKCkpOyovXHJcbiAgICAgICAgICAgIC8qX2F1ZGlvLk9uUGxheSA9IFwic2VsZi5fT25QbGF5KClcIi5Ub0R5bmFtaWMoKTtcclxuICAgICAgICAgICAgX2F1ZGlvLk9uUGF1c2UgPSBcInNlbGYuX09uU3RvcCgpXCIuVG9EeW5hbWljKCk7XHJcbiAgICAgICAgICAgIF9hdWRpby5PbkVuZGVkID0gXCJzZWxmLl9PblN0b3AoKVwiLlRvRHluYW1pYygpOyovXHJcbiAgICAgICAgfVxyXG5cclxuXHJcbiAgICAgICAgcHVibGljIHZvaWQgQmxhc3QoZmxvYXQgdm9sdW1lID0gMWYpXHJcbiAgICAgICAge1xyXG4gICAgICAgICAgICB2YXIgVCA9IEFwcC50b3RhbFRpbWU7XHJcbiAgICAgICAgICAgIGlmIChUIC0gbGFzdHRpbWUgPCAxNTApXHJcbiAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgIHJldHVybjsvL3ByZXZlbnQgYXVkaW8gc3BhbS5cclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBpZiAoIUlzUGxheWluZylcclxuICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgVm9sdW1lID0gdm9sdW1lO1xyXG4gICAgICAgICAgICAgICAgUGxheSgpO1xyXG4gICAgICAgICAgICAgICAgbGFzdHRpbWUgPSBUO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIGVsc2VcclxuICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgLy8oKEF1ZGlvRWxlbWVudClfYXVkaW8uQ2xvbmVOb2RlKCkpLlBsYXkoKTtcclxuICAgICAgICAgICAgICAgIGludCBpID0gMDtcclxuICAgICAgICAgICAgICAgIHdoaWxlIChpIDwgX2JsYXN0LkNvdW50KVxyXG4gICAgICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgICAgIEhUTUxBdWRpb0VsZW1lbnQgQSA9IF9ibGFzdFtpXTtcclxuICAgICAgICAgICAgICAgICAgICAvL2lmIChBLlBhdXNlZCB8fCBBLkN1cnJlbnRUaW1lPDAuMTVmIHx8IEEuUGxheWVkLkxlbmd0aD09MClcclxuICAgICAgICAgICAgICAgICAgICBpZiAoQS5QYXVzZWQgfHwgQS5DdXJyZW50VGltZSA8IDAuMTBmIHx8IEEuUGxheWVkLkxlbmd0aCA9PSAwKVxyXG4gICAgICAgICAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKEEuUGF1c2VkIHx8IEEuQ3VycmVudFRpbWUgPT0gMC4wIHx8IEEuUGxheWVkLkxlbmd0aCA9PSAwKVxyXG4gICAgICAgICAgICAgICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBBLlZvbHVtZSA9IHZvbHVtZTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIEEuUGxheSgpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgaSA9IF9ibGFzdC5Db3VudDtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxhc3R0aW1lID0gVDtcclxuICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICBpKys7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcblxyXG5cclxuICAgICAgICBwcm90ZWN0ZWQgdm9pZCBfT25QbGF5KClcclxuICAgICAgICB7XHJcbiAgICAgICAgICAgIF9BTS5PblBsYXkodGhpcyk7XHJcbiAgICAgICAgICAgIGlmIChPblBsYXkuVG9EeW5hbWljKCkpXHJcbiAgICAgICAgICAgICAgICBPblBsYXkodGhpcyk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHByb3RlY3RlZCB2b2lkIF9PblN0b3AoKVxyXG4gICAgICAgIHtcclxuICAgICAgICAgICAgX0FNLk9uU3RvcCh0aGlzKTtcclxuICAgICAgICAgICAgaWYgKE9uU3RvcC5Ub0R5bmFtaWMoKSlcclxuICAgICAgICAgICAgICAgIE9uU3RvcCh0aGlzKTtcclxuICAgICAgICB9XHJcbiAgICAgICAgcHJvdGVjdGVkIHZvaWQgX09uRW5kKClcclxuICAgICAgICB7XHJcbiAgICAgICAgICAgIC8qaWYgKF9sb29wKVxyXG4gICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICBDdXJyZW50VGltZSA9IDA7XHJcbiAgICAgICAgICAgICAgICBQbGF5KCk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgZWxzZSovXHJcbiAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgIF9PblN0b3AoKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuICAgICAgICBwcm90ZWN0ZWQgZG91YmxlIGxhc3R0aW1lID0gMDtcclxuICAgICAgICBwcm90ZWN0ZWQgdm9pZCBfT25VcGRhdGUoKVxyXG4gICAgICAgIHtcclxuICAgICAgICAgICAgaWYgKF9sb29wKVxyXG4gICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICAvL2lmICgoQ3VycmVudFRpbWUrMC4zNSkgPj0gX2F1ZGlvLkR1cmF0aW9uKVxyXG4gICAgICAgICAgICAgICAgaWYgKChDdXJyZW50VGltZSArICgoQ3VycmVudFRpbWUgLSBsYXN0dGltZSkgKiAwLjgpKSA+PSBfYXVkaW8uRHVyYXRpb24pXHJcbiAgICAgICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICAgICAgQ3VycmVudFRpbWUgPSAwO1xyXG4gICAgICAgICAgICAgICAgICAgIFBsYXkoKTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIGxhc3R0aW1lID0gQ3VycmVudFRpbWU7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcbiAgICB9XHJcbn1cclxuIiwidXNpbmcgU3lzdGVtO1xyXG51c2luZyBTeXN0ZW0uQ29sbGVjdGlvbnMuR2VuZXJpYztcclxudXNpbmcgU3lzdGVtLkxpbnE7XHJcbnVzaW5nIFN5c3RlbS5UZXh0O1xyXG51c2luZyBTeXN0ZW0uVGhyZWFkaW5nLlRhc2tzO1xyXG51c2luZyBCcmlkZ2U7XHJcbnVzaW5nIEJyaWRnZS5IdG1sNTtcclxuXHJcbm5hbWVzcGFjZSBDaXJub0dhbWVcclxue1xyXG4gICAgcHVibGljIGNsYXNzIEF1ZGlvTWFuYWdlclxyXG4gICAge1xyXG4gICAgICAgIHByb3RlY3RlZCBEaWN0aW9uYXJ5PHN0cmluZywgQXVkaW8+IGRhdGE7XHJcbiAgICAgICAgcHJvdGVjdGVkIExpc3Q8QXVkaW8+IHBsYXlpbmc7XHJcbiAgICAgICAgcHVibGljIHN0YXRpYyBzdHJpbmcgRGlyZWN0b3J5ID0gXCJcIjtcclxuICAgICAgICBwdWJsaWMgc3RhdGljIEF1ZGlvTWFuYWdlciBfX3RoaXM7XHJcbiAgICAgICAgcHVibGljIHN0YXRpYyBBdWRpb01hbmFnZXIgX3RoaXNcclxuICAgICAgICB7XHJcbiAgICAgICAgICAgIGdldFxyXG4gICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICBpZiAoX190aGlzID09IG51bGwpXHJcbiAgICAgICAgICAgICAgICAgICAgX190aGlzID0gbmV3IEF1ZGlvTWFuYWdlcigpO1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuIF9fdGhpcztcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuICAgICAgICBwdWJsaWMgc3RhdGljIHZvaWQgSW5pdCgpXHJcbiAgICAgICAge1xyXG4gICAgICAgICAgICBpZiAoX190aGlzID09IG51bGwpXHJcbiAgICAgICAgICAgICAgICBfX3RoaXMgPSBuZXcgQXVkaW9NYW5hZ2VyKCk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHByb3RlY3RlZCBBdWRpb01hbmFnZXIoKVxyXG4gICAgICAgIHtcclxuICAgICAgICAgICAgZGF0YSA9IG5ldyBEaWN0aW9uYXJ5PHN0cmluZywgQXVkaW8+KCk7XHJcbiAgICAgICAgICAgIHBsYXlpbmcgPSBuZXcgTGlzdDxBdWRpbz4oKTtcclxuICAgICAgICB9XHJcbiAgICAgICAgcHVibGljIEF1ZGlvIEdldChzdHJpbmcgcGF0aClcclxuICAgICAgICB7XHJcbiAgICAgICAgICAgIHBhdGggPSBEaXJlY3RvcnkgKyBwYXRoO1xyXG4gICAgICAgICAgICBpZiAoZGF0YS5Db250YWluc0tleShwYXRoKSlcclxuICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuIGRhdGFbcGF0aF07XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgZWxzZVxyXG4gICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICBIVE1MQXVkaW9FbGVtZW50IEFFID0gbmV3IEhUTUxBdWRpb0VsZW1lbnQocGF0aCk7XHJcbiAgICAgICAgICAgICAgICBBdWRpbyBBID0gbmV3IEF1ZGlvKEFFLCBwYXRoLCB0aGlzKTtcclxuICAgICAgICAgICAgICAgIGRhdGEuQWRkKHBhdGgsIEEpO1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuIEE7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcbiAgICAgICAgcHVibGljIEF1ZGlvIFBsYXkoc3RyaW5nIHBhdGgsIGJvb2wgbG9vcCA9IGZhbHNlKVxyXG4gICAgICAgIHtcclxuICAgICAgICAgICAgQXVkaW8gQSA9IEdldChwYXRoKTtcclxuICAgICAgICAgICAgQS5Mb29wID0gbG9vcDtcclxuICAgICAgICAgICAgQS5QbGF5KCk7XHJcbiAgICAgICAgICAgIHJldHVybiBBO1xyXG4gICAgICAgIH1cclxuICAgICAgICBwdWJsaWMgdm9pZCBCbGFzdChzdHJpbmcgcGF0aCwgZmxvYXQgdm9sdW1lID0gMWYpXHJcbiAgICAgICAge1xyXG4gICAgICAgICAgICBBdWRpbyBBID0gR2V0KHBhdGgpO1xyXG4gICAgICAgICAgICBBLkJsYXN0KHZvbHVtZSk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHB1YmxpYyB2b2lkIFN0b3Aoc3RyaW5nIHBhdGgpXHJcbiAgICAgICAge1xyXG4gICAgICAgICAgICBBdWRpbyBBID0gR2V0KHBhdGgpO1xyXG4gICAgICAgICAgICBBLlN0b3AoKTtcclxuICAgICAgICB9XHJcbiAgICAgICAgcHVibGljIHZvaWQgUGF1c2Uoc3RyaW5nIHBhdGgpXHJcbiAgICAgICAge1xyXG4gICAgICAgICAgICBBdWRpbyBBID0gR2V0KHBhdGgpO1xyXG4gICAgICAgICAgICBBLlBhdXNlKCk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHB1YmxpYyB2b2lkIE9uUGxheShBdWRpbyBhdWRpbylcclxuICAgICAgICB7XHJcbiAgICAgICAgICAgIGlmICghcGxheWluZy5Db250YWlucyhhdWRpbykpXHJcbiAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgIHBsYXlpbmcuQWRkKGF1ZGlvKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuICAgICAgICBwdWJsaWMgdm9pZCBPblN0b3AoQXVkaW8gYXVkaW8pXHJcbiAgICAgICAge1xyXG4gICAgICAgICAgICBpZiAocGxheWluZy5Db250YWlucyhhdWRpbykpXHJcbiAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgIHBsYXlpbmcuUmVtb3ZlKGF1ZGlvKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuICAgICAgICBwdWJsaWMgdm9pZCBTdG9wQWxsRnJvbURpcmVjdG9yeShzdHJpbmcgZGlyZWN0b3J5KVxyXG4gICAgICAgIHtcclxuICAgICAgICAgICAgZGlyZWN0b3J5ID0gRGlyZWN0b3J5ICsgZGlyZWN0b3J5O1xyXG5DaXJub0dhbWUuSGVscGVyRXh0ZW5zaW9ucy5Gb3JFYWNoPGdsb2JhbDo6Q2lybm9HYW1lLkF1ZGlvPiggICAgICAgICAgICBkYXRhLlZhbHVlcywoZ2xvYmFsOjpTeXN0ZW0uQWN0aW9uPGdsb2JhbDo6Q2lybm9HYW1lLkF1ZGlvPikoQSA9PiB7IGlmIChBLklELlN0YXJ0c1dpdGgoZGlyZWN0b3J5KSkgeyBBLlN0b3AoKTsgfSB9KSk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHB1YmxpYyB2b2lkIFN0b3BBbGwoKVxyXG4gICAgICAgIHtcclxuQ2lybm9HYW1lLkhlbHBlckV4dGVuc2lvbnMuRm9yRWFjaDxnbG9iYWw6OkNpcm5vR2FtZS5BdWRpbz4oICAgICAgICAgICAgZGF0YS5WYWx1ZXMsKGdsb2JhbDo6U3lzdGVtLkFjdGlvbjxnbG9iYWw6OkNpcm5vR2FtZS5BdWRpbz4pKEEgPT4geyBBLlN0b3AoKTsgfSkpO1xyXG4gICAgICAgIH1cclxuICAgIH1cclxufVxyXG4iLCJ1c2luZyBTeXN0ZW07XHJcbnVzaW5nIFN5c3RlbS5Db2xsZWN0aW9ucy5HZW5lcmljO1xyXG51c2luZyBTeXN0ZW0uTGlucTtcclxudXNpbmcgU3lzdGVtLlRleHQ7XHJcbnVzaW5nIFN5c3RlbS5UaHJlYWRpbmcuVGFza3M7XHJcbnVzaW5nIEJyaWRnZTtcclxudXNpbmcgQnJpZGdlLkh0bWw1O1xyXG5cclxubmFtZXNwYWNlIENpcm5vR2FtZVxyXG57XHJcbiAgICBwdWJsaWMgY2xhc3MgQnV0dG9uTWVudVxyXG4gICAge1xyXG4gICAgICAgIC8vcHVibGljIExpc3Q8QnV0dG9uU3ByaXRlPiBidXR0b25zO1xyXG4gICAgICAgIHByb3RlY3RlZCBMaXN0PExpc3Q8QnV0dG9uU3ByaXRlPj4gcm93cztcclxuICAgICAgICBwdWJsaWMgZmxvYXQgTWVudVdpZHRoO1xyXG4gICAgICAgIHB1YmxpYyBmbG9hdCBNZW51SGVpZ2h0O1xyXG4gICAgICAgIHByb3RlY3RlZCBpbnQgRm9udFNpemU7XHJcbiAgICAgICAgcHVibGljIGJvb2wgU2VsZWN0aW9uTWVudTtcclxuICAgICAgICBwdWJsaWMgQnV0dG9uU3ByaXRlIFNlbGVjdGVkID0gbnVsbDtcclxuICAgICAgICBwdWJsaWMgQnV0dG9uTWVudSBTZWxmO1xyXG4gICAgICAgIHB1YmxpYyBkeW5hbWljIFNlbGVjdGVkRGF0YVxyXG4gICAgICAgIHtcclxuICAgICAgICAgICAgZ2V0XHJcbiAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgIGlmIChTZWxmLlNlbGVjdGVkICE9IG51bGwpXHJcbiAgICAgICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIFNlbGYuU2VsZWN0ZWQuRGF0YTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIHJldHVybiBudWxsO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHB1YmxpYyBzdHJpbmcgU2VsZWN0ZWRUZXh0XHJcbiAgICAgICAge1xyXG4gICAgICAgICAgICBnZXRcclxuICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgaWYgKFNlbGYuU2VsZWN0ZWQgIT0gbnVsbClcclxuICAgICAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgICAgICBpZiAoU2VsZi5TZWxlY3RlZC5Db250ZW50cyBpcyBUZXh0U3ByaXRlKVxyXG4gICAgICAgICAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuICgoVGV4dFNwcml0ZSlTZWxmLlNlbGVjdGVkLkNvbnRlbnRzKS5UZXh0O1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIHJldHVybiBudWxsO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBwdWJsaWMgQWN0aW9uIE9uQ2hvb3NlO1xyXG5cclxuICAgICAgICBwdWJsaWMgVmVjdG9yMiBQb3NpdGlvbiA9IG5ldyBWZWN0b3IyKCk7XHJcblxyXG4gICAgICAgIHB1YmxpYyBCdXR0b25NZW51KGZsb2F0IG1lbnVXaWR0aCwgZmxvYXQgbWVudUhlaWdodCwgaW50IEZvbnRTaXplLCBib29sIHNlbGVjdGlvbk1lbnUgPSBmYWxzZSlcclxuICAgICAgICB7XHJcbiAgICAgICAgICAgIHJvd3MgPSBuZXcgTGlzdDxMaXN0PEJ1dHRvblNwcml0ZT4+KCk7XHJcbiAgICAgICAgICAgIHRoaXMuTWVudVdpZHRoID0gbWVudVdpZHRoO1xyXG4gICAgICAgICAgICB0aGlzLk1lbnVIZWlnaHQgPSBtZW51SGVpZ2h0O1xyXG4gICAgICAgICAgICB0aGlzLkZvbnRTaXplID0gRm9udFNpemU7XHJcbiAgICAgICAgICAgIHRoaXMuU2VsZWN0aW9uTWVudSA9IHNlbGVjdGlvbk1lbnU7XHJcbiAgICAgICAgICAgIFNlbGYgPSB0aGlzO1xyXG4gICAgICAgIH1cclxuICAgICAgICBwdWJsaWMgTGlzdDxCdXR0b25TcHJpdGU+IEdldEFsbEJ1dHRvbnMoKVxyXG4gICAgICAgIHtcclxuICAgICAgICAgICAgTGlzdDxCdXR0b25TcHJpdGU+IGFsbCA9IG5ldyBMaXN0PEJ1dHRvblNwcml0ZT4oKTtcclxuICAgICAgICAgICAgcm93cy5Gb3JFYWNoKChnbG9iYWw6OlN5c3RlbS5BY3Rpb248Z2xvYmFsOjpTeXN0ZW0uQ29sbGVjdGlvbnMuR2VuZXJpYy5MaXN0PGdsb2JhbDo6Q2lybm9HYW1lLkJ1dHRvblNwcml0ZT4+KShSID0+IGFsbC5BZGRSYW5nZShSKSkpO1xyXG4gICAgICAgICAgICByZXR1cm4gYWxsO1xyXG4gICAgICAgIH1cclxuICAgICAgICBwdWJsaWMgQnV0dG9uU3ByaXRlIEdldFNwcml0ZUJ5RGF0YShkeW5hbWljIGRhdGEpXHJcbiAgICAgICAge1xyXG4gICAgICAgICAgICBMaXN0PEJ1dHRvblNwcml0ZT4gYWxsID0gbmV3IExpc3Q8QnV0dG9uU3ByaXRlPihTeXN0ZW0uTGlucS5FbnVtZXJhYmxlLldoZXJlPGdsb2JhbDo6Q2lybm9HYW1lLkJ1dHRvblNwcml0ZT4oR2V0QWxsQnV0dG9ucygpLChnbG9iYWw6OlN5c3RlbS5GdW5jPGdsb2JhbDo6Q2lybm9HYW1lLkJ1dHRvblNwcml0ZSwgYm9vbD4pKEIgPT4gQi5EYXRhID09IGRhdGEpKSk7XHJcbiAgICAgICAgICAgIGlmIChhbGwuQ291bnQgPiAwKVxyXG4gICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gYWxsWzBdO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIHJldHVybiBudWxsO1xyXG4gICAgICAgIH1cclxuICAgICAgICBwdWJsaWMgdm9pZCBBZGRCdXR0b25zKHN0cmluZ1tdIGJ1dHRvblRleHQpXHJcbiAgICAgICAge1xyXG5DaXJub0dhbWUuSGVscGVyRXh0ZW5zaW9ucy5Gb3JFYWNoPHN0cmluZz4oICAgICAgICAgICAgYnV0dG9uVGV4dCwoZ2xvYmFsOjpTeXN0ZW0uQWN0aW9uPHN0cmluZz4pKFQgPT4gQWRkQnV0dG9uKChzdHJpbmcpVCkpKTtcclxuICAgICAgICB9XHJcbiAgICAgICAgcHVibGljIEJ1dHRvblNwcml0ZSBBZGRCdXR0b24oc3RyaW5nIGJ1dHRvblRleHQsIGludCByb3cgPSAtMSwgZHluYW1pYyBkYXRhID0gbnVsbClcclxuICAgICAgICB7XHJcbiAgICAgICAgICAgIFRleHRTcHJpdGUgVCA9IG5ldyBUZXh0U3ByaXRlKCk7XHJcbiAgICAgICAgICAgIFQuVGV4dCA9IGJ1dHRvblRleHQ7XHJcbiAgICAgICAgICAgIFQuRm9udFNpemUgPSBGb250U2l6ZTtcclxuICAgICAgICAgICAgLy9CdXR0b25TcHJpdGUgQiA9IG5ldyBCdXR0b25TcHJpdGUoVCwgKGludCkoRm9udFNpemUgKiAwLjA1KSk7XHJcbiAgICAgICAgICAgIEJ1dHRvblNwcml0ZSBCID0gbmV3IEJ1dHRvblNwcml0ZShULCAoaW50KShGb250U2l6ZSAqIDAuMSkpO1xyXG4gICAgICAgICAgICBpZiAoZGF0YSAhPSBudWxsKVxyXG4gICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICBCLkRhdGEgPSBkYXRhO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIEFkZEJ1dHRvbihCLCByb3cpO1xyXG4gICAgICAgICAgICByZXR1cm4gQjtcclxuICAgICAgICB9XHJcbiAgICAgICAgcHVibGljIHZvaWQgQWRkQnV0dG9uKEJ1dHRvblNwcml0ZSBidXR0b24sIGludCByb3cgPSAtMSlcclxuICAgICAgICB7XHJcbiAgICAgICAgICAgIGlmIChyb3dzLkNvdW50ID09IDApXHJcbiAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgIHJvd3MuQWRkKG5ldyBMaXN0PEJ1dHRvblNwcml0ZT4oKSk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgaWYgKHJvdyA9PSAtMSlcclxuICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgcm93ID0gcm93cy5Db3VudCAtIDE7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgaWYgKGJ1dHRvbiAhPSBudWxsKVxyXG4gICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICBidXR0b24uT25DbGljayA9ICgpID0+IHsgU2VsZi5TZWxlY3QoYnV0dG9uKTsgfTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICByb3dzW3Jvd10uQWRkKGJ1dHRvbik7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHB1YmxpYyB2b2lkIFNlbGVjdChCdXR0b25TcHJpdGUgYnV0dG9uKVxyXG4gICAgICAgIHtcclxuICAgICAgICAgICAgaWYgKFNlbGVjdGVkICE9IGJ1dHRvbiB8fCAhU2VsZWN0aW9uTWVudSlcclxuICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgaWYgKFNlbGVjdGVkICE9IG51bGwgJiYgU2VsZWN0aW9uTWVudSlcclxuICAgICAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgICAgICAvL1NlbGVjdGVkLkJvcmRlckNvbG9yID0gXCIjMDBBQTMzXCI7XHJcbiAgICAgICAgICAgICAgICAgICAgLy9TZWxlY3RlZC5CdXR0b25Db2xvciA9IFwiIzExQ0M1NVwiO1xyXG4gICAgICAgICAgICAgICAgICAgIFNlbGVjdGVkLlNldENvbG9yU2NoZW1lKDApO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgU2VsZWN0ZWQgPSBidXR0b247XHJcbiAgICAgICAgICAgICAgICB2YXIgT1NDID0gT25DaG9vc2U7XHJcbiAgICAgICAgICAgICAgICB2YXIgc2VsZiA9IHRoaXM7XHJcbiAgICAgICAgICAgICAgICBpZiAoU2VsZWN0aW9uTWVudSAmJiBTZWxlY3RlZCAhPSBudWxsKVxyXG4gICAgICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgICAgIC8vU2VsZWN0ZWQuQm9yZGVyQ29sb3IgPSBcIiNGRkZGRkZcIjtcclxuICAgICAgICAgICAgICAgICAgICAvL1NlbGVjdGVkLkJ1dHRvbkNvbG9yID0gXCIjRkYwMDAwXCI7XHJcbiAgICAgICAgICAgICAgICAgICAgU2VsZWN0ZWQuU2V0Q29sb3JTY2hlbWUoMSk7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICBpZiAoU2VsZWN0ZWQgIT0gbnVsbCAmJiBTY3JpcHQuV3JpdGU8Ym9vbD4oXCJPU0NcIikpXHJcbiAgICAgICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICAgICAgc2VsZi5PbkNob29zZSgpO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHB1YmxpYyB2b2lkIENvbWJpbmVSb3dzKClcclxuICAgICAgICB7XHJcbiAgICAgICAgICAgIExpc3Q8QnV0dG9uU3ByaXRlPiBhbGwgPSBuZXcgTGlzdDxCdXR0b25TcHJpdGU+KCk7XHJcbiAgICAgICAgICAgIHJvd3MuRm9yRWFjaCgoZ2xvYmFsOjpTeXN0ZW0uQWN0aW9uPGdsb2JhbDo6U3lzdGVtLkNvbGxlY3Rpb25zLkdlbmVyaWMuTGlzdDxnbG9iYWw6OkNpcm5vR2FtZS5CdXR0b25TcHJpdGU+PikoUiA9PiBhbGwuQWRkUmFuZ2UoUikpKTtcclxuXHJcbiAgICAgICAgICAgIHJvd3MgPSBuZXcgTGlzdDxMaXN0PEJ1dHRvblNwcml0ZT4+KCk7XHJcbiAgICAgICAgICAgIHJvd3MuQWRkKGFsbCk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHByb3RlY3RlZCBMaXN0PEJ1dHRvblNwcml0ZT4gYWRkUm93KClcclxuICAgICAgICB7XHJcbiAgICAgICAgICAgIExpc3Q8QnV0dG9uU3ByaXRlPiByZXQgPSBuZXcgTGlzdDxCdXR0b25TcHJpdGU+KCk7XHJcbiAgICAgICAgICAgIHJvd3MuQWRkKHJldCk7XHJcbiAgICAgICAgICAgIHJldHVybiByZXQ7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHB1YmxpYyB2b2lkIEJyZWFrVXAoaW50IHRvdGFsUm93cylcclxuICAgICAgICB7XHJcbiAgICAgICAgICAgIENvbWJpbmVSb3dzKCk7XHJcbiAgICAgICAgICAgIExpc3Q8QnV0dG9uU3ByaXRlPiBhbGwgPSByb3dzWzBdO1xyXG4gICAgICAgICAgICByb3dzID0gbmV3IExpc3Q8TGlzdDxCdXR0b25TcHJpdGU+PigpO1xyXG4gICAgICAgICAgICBkb3VibGUgQyA9IE1hdGguQ2VpbGluZyhhbGwuQ291bnQgLyAoZG91YmxlKXRvdGFsUm93cyk7XHJcbiAgICAgICAgICAgIExpc3Q8QnV0dG9uU3ByaXRlPiByb3cgPSBhZGRSb3coKTtcclxuICAgICAgICAgICAgaW50IGkgPSAwO1xyXG4gICAgICAgICAgICB3aGlsZSAoaSA8IGFsbC5Db3VudClcclxuICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgaWYgKHJvdy5Db3VudCA+PSBDKVxyXG4gICAgICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgICAgIHJvdyA9IGFkZFJvdygpO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgQWRkQnV0dG9uKGFsbFtpXSk7XHJcbiAgICAgICAgICAgICAgICBpKys7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcbiAgICAgICAgcHJvdGVjdGVkIHZvaWQgQ2VudGVyT24oU3ByaXRlIHNwcml0ZSwgVmVjdG9yMiBDZW50ZXIpXHJcbiAgICAgICAge1xyXG4gICAgICAgICAgICBzcHJpdGUuRHJhdyhudWxsKTtcclxuICAgICAgICAgICAgVmVjdG9yMiBTID0gc3ByaXRlLlNpemU7XHJcbiAgICAgICAgICAgIFZlY3RvcjIgUzIgPSBTIC8gMmY7XHJcbiAgICAgICAgICAgIHNwcml0ZS5Qb3NpdGlvbiA9IENlbnRlciAtIFMyO1xyXG4gICAgICAgIH1cclxuICAgICAgICBwcm90ZWN0ZWQgdm9pZCBVcGRhdGVSb3coaW50IGluZGV4LCBmbG9hdCB5KVxyXG4gICAgICAgIHtcclxuICAgICAgICAgICAgTGlzdDxCdXR0b25TcHJpdGU+IHJvdyA9IHJvd3NbaW5kZXhdO1xyXG4gICAgICAgICAgICBmbG9hdCBYID0gKE1lbnVXaWR0aCAvIChyb3cuQ291bnQgKyAxLjBmKSk7XHJcbiAgICAgICAgICAgIGludCBpID0gMDtcclxuICAgICAgICAgICAgZmxvYXQgQ1ggPSBYO1xyXG5cclxuICAgICAgICAgICAgQ1ggKz0gUG9zaXRpb24uWDtcclxuICAgICAgICAgICAgd2hpbGUgKGkgPCByb3cuQ291bnQpXHJcbiAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgIEJ1dHRvblNwcml0ZSBCID0gcm93W2ldO1xyXG4gICAgICAgICAgICAgICAgaWYgKEIgIT0gbnVsbClcclxuICAgICAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgICAgICBDZW50ZXJPbihCLCBuZXcgVmVjdG9yMihDWCwgeSkpO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgQ1ggKz0gWDtcclxuICAgICAgICAgICAgICAgIGkrKztcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuICAgICAgICBwdWJsaWMgdm9pZCBGaW5pc2goaW50IHRvdGFsUm93cyA9IC0xKVxyXG4gICAgICAgIHtcclxuICAgICAgICAgICAgaWYgKHRvdGFsUm93cyA+IDApXHJcbiAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgIEJyZWFrVXAodG90YWxSb3dzKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBmbG9hdCB5ID0gMDtcclxuICAgICAgICAgICAgZmxvYXQgQ1kgPSAwO1xyXG4gICAgICAgICAgICBpZiAodG90YWxSb3dzID4gMCAmJiByb3dzLkNvdW50IDwgdG90YWxSb3dzKVxyXG4gICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICB5ID0gKE1lbnVIZWlnaHQgLyAocm93cy5Db3VudCArIDEpKTtcclxuICAgICAgICAgICAgICAgIENZID0geTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBlbHNlXHJcbiAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgIHkgPSAoTWVudUhlaWdodCAvIChyb3dzLkNvdW50KSk7XHJcbiAgICAgICAgICAgICAgICBDWSA9IDA7XHJcbiAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgIENZICs9IFBvc2l0aW9uLlk7XHJcbiAgICAgICAgICAgIHZhciBpID0gMDtcclxuICAgICAgICAgICAgd2hpbGUgKGkgPCByb3dzLkNvdW50KVxyXG4gICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICBVcGRhdGVSb3coaSwgQ1kpO1xyXG4gICAgICAgICAgICAgICAgQ1kgKz0geTtcclxuICAgICAgICAgICAgICAgIGkrKztcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuICAgICAgICBwdWJsaWMgdm9pZCBVcGRhdGUoVmVjdG9yMiBtb3VzZVBvc2l0aW9uID0gbnVsbCwgYm9vbCBjbGlja2VkID0gdHJ1ZSlcclxuICAgICAgICB7XHJcbiAgICAgICAgICAgIGlmIChtb3VzZVBvc2l0aW9uID09IG51bGwpXHJcbiAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgIG1vdXNlUG9zaXRpb24gPSBLZXlib2FyZE1hbmFnZXIuX3RoaXMuQ01vdXNlO1xyXG4gICAgICAgICAgICAgICAgY2xpY2tlZCA9IEtleWJvYXJkTWFuYWdlci5fdGhpcy5UYXBwZWRNb3VzZUJ1dHRvbnMuQ29udGFpbnMoMCk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgaWYgKGNsaWNrZWQpXHJcbiAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgIHJvd3MuRm9yRWFjaCgoZ2xvYmFsOjpTeXN0ZW0uQWN0aW9uPGdsb2JhbDo6U3lzdGVtLkNvbGxlY3Rpb25zLkdlbmVyaWMuTGlzdDxnbG9iYWw6OkNpcm5vR2FtZS5CdXR0b25TcHJpdGU+PikoUiA9PiBSLkZvckVhY2goKGdsb2JhbDo6U3lzdGVtLkFjdGlvbjxnbG9iYWw6OkNpcm5vR2FtZS5CdXR0b25TcHJpdGU+KShCID0+IHsgaWYgKEIgIT0gbnVsbCkgQi5DaGVja0NsaWNrKG1vdXNlUG9zaXRpb24pOyB9KSkpKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuICAgICAgICBwdWJsaWMgdm9pZCBEcmF3KENhbnZhc1JlbmRlcmluZ0NvbnRleHQyRCBnKVxyXG4gICAgICAgIHtcclxuICAgICAgICAgICAgcm93cy5Gb3JFYWNoKChnbG9iYWw6OlN5c3RlbS5BY3Rpb248Z2xvYmFsOjpTeXN0ZW0uQ29sbGVjdGlvbnMuR2VuZXJpYy5MaXN0PGdsb2JhbDo6Q2lybm9HYW1lLkJ1dHRvblNwcml0ZT4+KShSID0+IFIuRm9yRWFjaCgoZ2xvYmFsOjpTeXN0ZW0uQWN0aW9uPGdsb2JhbDo6Q2lybm9HYW1lLkJ1dHRvblNwcml0ZT4pKEIgPT4geyBpZiAoQiAhPSBudWxsKSBCLkRyYXcoZyk7IH0pKSkpO1xyXG4gICAgICAgIH1cclxuICAgIH1cclxufVxyXG4iLCJ1c2luZyBTeXN0ZW07XHJcbnVzaW5nIFN5c3RlbS5Db2xsZWN0aW9ucy5HZW5lcmljO1xyXG51c2luZyBTeXN0ZW0uTGlucTtcclxudXNpbmcgU3lzdGVtLlRleHQ7XHJcbnVzaW5nIFN5c3RlbS5UaHJlYWRpbmcuVGFza3M7XHJcbnVzaW5nIEJyaWRnZTtcclxudXNpbmcgQnJpZGdlLkh0bWw1O1xyXG5cclxubmFtZXNwYWNlIENpcm5vR2FtZVxyXG57XHJcbiAgICBwdWJsaWMgY2xhc3MgU3ByaXRlXHJcbiAgICB7XHJcbiAgICAgICAgcHVibGljIFZlY3RvcjIgUG9zaXRpb247XHJcbiAgICAgICAgcHVibGljIEhUTUxDYW52YXNFbGVtZW50IHNwcml0ZUJ1ZmZlcjtcclxuICAgICAgICBwdWJsaWMgYm9vbCBWaXNpYmxlID0gdHJ1ZTtcclxuICAgICAgICBwcm90ZWN0ZWQgQ2FudmFzUmVuZGVyaW5nQ29udGV4dDJEIHNwcml0ZUdyYXBoaWNzO1xyXG4gICAgICAgIHB1YmxpYyBWZWN0b3IyIFNpemVcclxuICAgICAgICB7XHJcbiAgICAgICAgICAgIGdldFxyXG4gICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gbmV3IFZlY3RvcjIoc3ByaXRlQnVmZmVyLldpZHRoLCBzcHJpdGVCdWZmZXIuSGVpZ2h0KTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBzZXRcclxuICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgaWYgKHZhbHVlID09IG51bGwpXHJcbiAgICAgICAgICAgICAgICAgICAgdmFsdWUgPSBuZXcgVmVjdG9yMigpO1xyXG4gICAgICAgICAgICAgICAgc3ByaXRlQnVmZmVyLldpZHRoID0gKGludCl2YWx1ZS5YO1xyXG4gICAgICAgICAgICAgICAgc3ByaXRlQnVmZmVyLkhlaWdodCA9IChpbnQpdmFsdWUuWTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuICAgICAgICBwdWJsaWMgdmlydHVhbCBDYW52YXNSZW5kZXJpbmdDb250ZXh0MkQgR2V0R3JhcGhpY3MoKVxyXG4gICAgICAgIHtcclxuICAgICAgICAgICAgcmV0dXJuIHNwcml0ZUdyYXBoaWNzO1xyXG4gICAgICAgIH1cclxuICAgICAgICBwdWJsaWMgU3ByaXRlKClcclxuICAgICAgICB7XHJcbiAgICAgICAgICAgIHNwcml0ZUJ1ZmZlciA9IG5ldyBIVE1MQ2FudmFzRWxlbWVudCgpO1xyXG4gICAgICAgICAgICBzcHJpdGVHcmFwaGljcyA9IHNwcml0ZUJ1ZmZlci5HZXRDb250ZXh0KENhbnZhc1R5cGVzLkNhbnZhc0NvbnRleHQyRFR5cGUuQ2FudmFzUmVuZGVyaW5nQ29udGV4dDJEKTtcclxuICAgICAgICAgICAgc3ByaXRlR3JhcGhpY3MuSW1hZ2VTbW9vdGhpbmdFbmFibGVkID0gZmFsc2U7XHJcbiAgICAgICAgICAgIFBvc2l0aW9uID0gbmV3IFZlY3RvcjIoKTtcclxuICAgICAgICB9XHJcbiAgICAgICAgcHVibGljIHZpcnR1YWwgdm9pZCBPbkZyYW1lKClcclxuICAgICAgICB7XHJcblxyXG4gICAgICAgIH1cclxuICAgICAgICBwdWJsaWMgdmlydHVhbCB2b2lkIERyYXcoQ2FudmFzUmVuZGVyaW5nQ29udGV4dDJEIGcpXHJcbiAgICAgICAge1xyXG4gICAgICAgICAgICBpZiAoIVZpc2libGUpXHJcbiAgICAgICAgICAgICAgICByZXR1cm47XHJcbiAgICAgICAgICAgIGcuRHJhd0ltYWdlKHNwcml0ZUJ1ZmZlciwgUG9zaXRpb24uWCwgUG9zaXRpb24uWSk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHB1YmxpYyB2aXJ0dWFsIFJlY3RhbmdsZSBHZXRCb3VuZHMoKVxyXG4gICAgICAgIHtcclxuICAgICAgICAgICAgcmV0dXJuIG5ldyBSZWN0YW5nbGUoUG9zaXRpb24uWCwgUG9zaXRpb24uWSwgc3ByaXRlQnVmZmVyLldpZHRoLCBzcHJpdGVCdWZmZXIuSGVpZ2h0KTtcclxuICAgICAgICB9XHJcbiAgICB9XHJcbn1cclxuIiwidXNpbmcgU3lzdGVtO1xyXG51c2luZyBTeXN0ZW0uQ29sbGVjdGlvbnMuR2VuZXJpYztcclxudXNpbmcgU3lzdGVtLkxpbnE7XHJcbnVzaW5nIFN5c3RlbS5UZXh0O1xyXG51c2luZyBTeXN0ZW0uVGhyZWFkaW5nLlRhc2tzO1xyXG51c2luZyBCcmlkZ2U7XHJcbnVzaW5nIEJyaWRnZS5IdG1sNTtcclxuXHJcbm5hbWVzcGFjZSBDaXJub0dhbWVcclxue1xyXG4gICAgcHVibGljIGNsYXNzIEJ1dHRvblNwcml0ZSA6IFNwcml0ZVxyXG4gICAge1xyXG4gICAgICAgIHByb3RlY3RlZCBib29sIF9idXR0b25OZWVkc1JlcmVuZGVyO1xyXG4gICAgICAgIHByb3RlY3RlZCBTcHJpdGUgX2J1dHRvbkJ1ZmZlcjtcclxuICAgICAgICBwcm90ZWN0ZWQgQ2FudmFzUmVuZGVyaW5nQ29udGV4dDJEIF9idXR0b25HcmFwaGljO1xyXG4gICAgICAgIHB1YmxpYyBkeW5hbWljIERhdGE7XHJcblxyXG4gICAgICAgIHByb3RlY3RlZCBTcHJpdGUgX2NvbnRlbnRzO1xyXG4gICAgICAgIHB1YmxpYyBTcHJpdGUgQ29udGVudHNcclxuICAgICAgICB7XHJcbiAgICAgICAgICAgIGdldFxyXG4gICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gX2NvbnRlbnRzO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIHNldFxyXG4gICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICBpZiAoX2NvbnRlbnRzICE9IHZhbHVlKVxyXG4gICAgICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgICAgIF9jb250ZW50cyA9IHZhbHVlO1xyXG4gICAgICAgICAgICAgICAgICAgIF9idXR0b25OZWVkc1JlcmVuZGVyID0gdHJ1ZTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuICAgICAgICBwcm90ZWN0ZWQgaW50IF9ib3JkZXJTaXplO1xyXG4gICAgICAgIHB1YmxpYyBpbnQgQm9yZGVyU2l6ZVxyXG4gICAgICAgIHtcclxuICAgICAgICAgICAgZ2V0XHJcbiAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgIHJldHVybiBfYm9yZGVyU2l6ZTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBzZXRcclxuICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgaWYgKF9ib3JkZXJTaXplICE9IHZhbHVlKVxyXG4gICAgICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgICAgIF9ib3JkZXJTaXplID0gdmFsdWU7XHJcbiAgICAgICAgICAgICAgICAgICAgX2J1dHRvbk5lZWRzUmVyZW5kZXIgPSB0cnVlO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHByb3RlY3RlZCBzdHJpbmcgX2JvcmRlckNvbG9yO1xyXG4gICAgICAgIHB1YmxpYyBzdHJpbmcgQm9yZGVyQ29sb3JcclxuICAgICAgICB7XHJcbiAgICAgICAgICAgIGdldFxyXG4gICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gX2JvcmRlckNvbG9yO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIHNldFxyXG4gICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICBpZiAoX2JvcmRlckNvbG9yICE9IHZhbHVlKVxyXG4gICAgICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgICAgIF9ib3JkZXJDb2xvciA9IHZhbHVlO1xyXG4gICAgICAgICAgICAgICAgICAgIF9idXR0b25OZWVkc1JlcmVuZGVyID0gdHJ1ZTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuICAgICAgICBwdWJsaWMgc3RyaW5nIExvY2tlZENsaWNrU291bmQgPSBcImhpdFwiO1xyXG4gICAgICAgIHB1YmxpYyBzdHJpbmcgQ2xpY2tTb3VuZCA9IFwic2VsZWN0XCI7XHJcbiAgICAgICAgcHJvdGVjdGVkIHN0cmluZyBfYnV0dG9uQ29sb3I7XHJcbiAgICAgICAgcHVibGljIHN0cmluZyBCdXR0b25Db2xvclxyXG4gICAgICAgIHtcclxuICAgICAgICAgICAgZ2V0XHJcbiAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgIHJldHVybiBfYnV0dG9uQ29sb3I7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgc2V0XHJcbiAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgIGlmIChfYnV0dG9uQ29sb3IgIT0gdmFsdWUpXHJcbiAgICAgICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICAgICAgX2J1dHRvbkNvbG9yID0gdmFsdWU7XHJcbiAgICAgICAgICAgICAgICAgICAgX2J1dHRvbk5lZWRzUmVyZW5kZXIgPSB0cnVlO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHB1YmxpYyBjbGFzcyBDb2xvclNjaGVtZVxyXG4gICAgICAgIHtcclxuICAgICAgICAgICAgcHVibGljIHN0cmluZyBCb3JkZXJDb2xvcjtcclxuICAgICAgICAgICAgcHVibGljIHN0cmluZyBCdXR0b25Db2xvcjtcclxuICAgICAgICAgICAgcHVibGljIENvbG9yU2NoZW1lKHN0cmluZyBib3JkZXJDb2xvciA9IFwiIzAwQUEzM1wiLCBzdHJpbmcgYnV0dG9uQ29sb3IgPSBcIiMxMUNDNTVcIilcclxuICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgdGhpcy5Cb3JkZXJDb2xvciA9IGJvcmRlckNvbG9yO1xyXG4gICAgICAgICAgICAgICAgdGhpcy5CdXR0b25Db2xvciA9IGJ1dHRvbkNvbG9yO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBwdWJsaWMgTGlzdDxDb2xvclNjaGVtZT4gQ29sb3JTY2hlbWVzO1xyXG5cclxuICAgICAgICBwdWJsaWMgYm9vbCBsb2NrZWQgPSBmYWxzZTtcclxuXHJcbiAgICAgICAgcHVibGljIEFjdGlvbiBPbkNsaWNrO1xyXG4gICAgICAgIHB1YmxpYyB2b2lkIFNldENvbG9yU2NoZW1lKENvbG9yU2NoZW1lIHNjaGVtZSlcclxuICAgICAgICB7XHJcbiAgICAgICAgICAgIEJvcmRlckNvbG9yID0gc2NoZW1lLkJvcmRlckNvbG9yO1xyXG4gICAgICAgICAgICBCdXR0b25Db2xvciA9IHNjaGVtZS5CdXR0b25Db2xvcjtcclxuICAgICAgICB9XHJcbiAgICAgICAgcHVibGljIHZvaWQgU2V0Q29sb3JTY2hlbWUoaW50IGluZGV4KVxyXG4gICAgICAgIHtcclxuICAgICAgICAgICAgQ29sb3JTY2hlbWUgQyA9IENvbG9yU2NoZW1lc1tpbmRleF07XHJcbiAgICAgICAgICAgIFNldENvbG9yU2NoZW1lKEMpO1xyXG4gICAgICAgIH1cclxuICAgICAgICAvL3B1YmxpYyBCdXR0b25TcHJpdGUoU3ByaXRlIGNvbnRlbnRzLGludCBib3JkZXJTaXplPTIsc3RyaW5nIGJvcmRlckNvbG9yPVwiIzc3Nzc3N1wiLHN0cmluZyBidXR0b25Db2xvcj1cIiNDQ0NDQ0NcIilcclxuICAgICAgICBwdWJsaWMgQnV0dG9uU3ByaXRlKFNwcml0ZSBjb250ZW50cywgaW50IGJvcmRlclNpemUgPSAyLCBzdHJpbmcgYm9yZGVyQ29sb3IgPSBcIiMwMEFBMzNcIiwgc3RyaW5nIGJ1dHRvbkNvbG9yID0gXCIjMTFDQzU1XCIsIGR5bmFtaWMgZGF0YSA9IG51bGwpXHJcbiAgICAgICAge1xyXG4gICAgICAgICAgICB0aGlzLkNvbnRlbnRzID0gY29udGVudHM7XHJcbiAgICAgICAgICAgIHRoaXMuQm9yZGVyU2l6ZSA9IGJvcmRlclNpemU7XHJcbiAgICAgICAgICAgIHRoaXMuQm9yZGVyQ29sb3IgPSBib3JkZXJDb2xvcjtcclxuICAgICAgICAgICAgdGhpcy5CdXR0b25Db2xvciA9IGJ1dHRvbkNvbG9yO1xyXG5cclxuICAgICAgICAgICAgX2J1dHRvbkJ1ZmZlciA9IG5ldyBTcHJpdGUoKTtcclxuICAgICAgICAgICAgX2J1dHRvbkJ1ZmZlci5TaXplID0gY29udGVudHMuU2l6ZTtcclxuICAgICAgICAgICAgX2J1dHRvbkdyYXBoaWMgPSBfYnV0dG9uQnVmZmVyLkdldEdyYXBoaWNzKCk7XHJcbiAgICAgICAgICAgIF9idXR0b25OZWVkc1JlcmVuZGVyID0gdHJ1ZTtcclxuICAgICAgICAgICAgQ29sb3JTY2hlbWVzID0gbmV3IExpc3Q8Q29sb3JTY2hlbWU+KCk7XHJcbiAgICAgICAgICAgIENvbG9yU2NoZW1lcy5BZGQobmV3IENvbG9yU2NoZW1lKGJvcmRlckNvbG9yLCBidXR0b25Db2xvcikpO1xyXG4gICAgICAgICAgICBDb2xvclNjaGVtZXMuQWRkKG5ldyBDb2xvclNjaGVtZShcIiNGRkZGRkZcIiwgXCIjRkYwMDAwXCIpKTtcclxuICAgICAgICAgICAgQ29sb3JTY2hlbWVzLkFkZChuZXcgQ29sb3JTY2hlbWUoXCIjNzc3Nzc3XCIsIFwiI0NDQ0NDQ1wiKSk7XHJcblxyXG4gICAgICAgICAgICB0aGlzLkRhdGEgPSBkYXRhO1xyXG4gICAgICAgICAgICBpZiAoZGF0YSA9PSBudWxsICYmIGNvbnRlbnRzIGlzIFRleHRTcHJpdGUpXHJcbiAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgIERhdGEgPSAoKFRleHRTcHJpdGUpY29udGVudHMpLlRleHQ7XHJcbiAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgIERyYXcobnVsbCk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHByb3RlY3RlZCB2b2lkIGRyYXdCdXR0b24oKVxyXG4gICAgICAgIHtcclxuICAgICAgICAgICAgQ2FudmFzUmVuZGVyaW5nQ29udGV4dDJEIGcgPSBfYnV0dG9uR3JhcGhpYztcclxuICAgICAgICAgICAgaW50IHN6ID0gX2JvcmRlclNpemUgKyBfYm9yZGVyU2l6ZTtcclxuICAgICAgICAgICAgX2J1dHRvbkJ1ZmZlci5TaXplID0gQ29udGVudHMuU2l6ZSArIG5ldyBWZWN0b3IyKHN6LCBzeik7XHJcbiAgICAgICAgICAgIFZlY3RvcjIgc2l6ZSA9IF9idXR0b25CdWZmZXIuU2l6ZTtcclxuXHJcbiAgICAgICAgICAgIGcuRmlsbFN0eWxlID0gX2JvcmRlckNvbG9yO1xyXG4gICAgICAgICAgICBnLkZpbGxSZWN0KDAsIDAsIChpbnQpc2l6ZS5YLCAoaW50KXNpemUuWSk7XHJcblxyXG4gICAgICAgICAgICBnLkZpbGxTdHlsZSA9IEJ1dHRvbkNvbG9yO1xyXG4gICAgICAgICAgICBnLkZpbGxSZWN0KF9ib3JkZXJTaXplLCBfYm9yZGVyU2l6ZSwgKGludClzaXplLlggLSBzeiwgKGludClzaXplLlkgLSBzeik7XHJcblxyXG4gICAgICAgICAgICBzdHJpbmcgY29sb3IgPSBcInJnYmEoMjU1LDI1NSwyNTUsMClcIjtcclxuXHJcbiAgICAgICAgICAgIHN0cmluZyB3aHQgPSBcInJnYmEoMjU1LDI1NSwyNTUsMC43KVwiO1xyXG5cclxuXHJcbiAgICAgICAgICAgIC8vL1NjcmlwdC5Xcml0ZShcInZhciBncmQgPSBnLmNyZWF0ZUxpbmVhckdyYWRpZW50KDAsIDAsIDAsIHNpemUueSk7Z3JkLmFkZENvbG9yU3RvcCgwLCBjb2xvcik7Z3JkLmFkZENvbG9yU3RvcCgwLjQsIHdodCk7Z3JkLmFkZENvbG9yU3RvcCgxLCBjb2xvcik7Zy5maWxsU3R5bGUgPSBncmQ7XCIpO1xyXG4gICAgICAgICAgICB2YXIgZ3JkID0gZy5DcmVhdGVMaW5lYXJHcmFkaWVudCgwLCAwLCAwLCBzaXplLlkpO1xyXG4gICAgICAgICAgICBncmQuQWRkQ29sb3JTdG9wKDAsIGNvbG9yKTtcclxuICAgICAgICAgICAgZ3JkLkFkZENvbG9yU3RvcCgwLjQsIHdodCk7XHJcbiAgICAgICAgICAgIGdyZC5BZGRDb2xvclN0b3AoMSwgY29sb3IpO1xyXG4gICAgICAgICAgICBnLkZpbGxTdHlsZSA9IGdyZDtcclxuICAgICAgICAgICAgZy5GaWxsUmVjdCgwLCAwLCAoaW50KV9idXR0b25CdWZmZXIuU2l6ZS5YLCAoaW50KV9idXR0b25CdWZmZXIuU2l6ZS5ZKTtcclxuICAgICAgICB9XHJcbiAgICAgICAgcHVibGljIHZvaWQgTG9jayhib29sIHNldGNvbG9yc2NoZW1lID0gdHJ1ZSlcclxuICAgICAgICB7XHJcbiAgICAgICAgICAgIGlmIChsb2NrZWQpXHJcbiAgICAgICAgICAgICAgICByZXR1cm47XHJcbiAgICAgICAgICAgIGxvY2tlZCA9IHRydWU7XHJcbiAgICAgICAgICAgIGlmIChzZXRjb2xvcnNjaGVtZSlcclxuICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgU2V0Q29sb3JTY2hlbWUoMik7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcbiAgICAgICAgcHVibGljIHZvaWQgVW5sb2NrKGJvb2wgc2V0Y29sb3JzY2hlbWUgPSB0cnVlKVxyXG4gICAgICAgIHtcclxuICAgICAgICAgICAgaWYgKCFsb2NrZWQpXHJcbiAgICAgICAgICAgICAgICByZXR1cm47XHJcbiAgICAgICAgICAgIGxvY2tlZCA9IGZhbHNlO1xyXG4gICAgICAgICAgICBpZiAoc2V0Y29sb3JzY2hlbWUpXHJcbiAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgIFNldENvbG9yU2NoZW1lKDApO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHByb3RlY3RlZCBWZWN0b3IyIExDb250ZW50U2l6ZSA9IG5ldyBWZWN0b3IyKCk7XHJcbiAgICAgICAgcHVibGljIGJvb2wgQ2hlY2tDbGljayhWZWN0b3IyIG1vdXNlUG9zaXRpb24pXHJcbiAgICAgICAge1xyXG4gICAgICAgICAgICBpZiAoVmlzaWJsZSAmJiBHZXRCb3VuZHMoKS5jb250YWluc1BvaW50KG1vdXNlUG9zaXRpb24pKVxyXG4gICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICBpZiAobG9ja2VkKVxyXG4gICAgICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgICAgIGlmIChMb2NrZWRDbGlja1NvdW5kICE9IFwiXCIgJiYgTG9ja2VkQ2xpY2tTb3VuZCAhPSBudWxsKVxyXG4gICAgICAgICAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgQXVkaW9NYW5hZ2VyLl90aGlzLkJsYXN0KFwiU0ZYL1wiICsgTG9ja2VkQ2xpY2tTb3VuZCArIFwiLm9nZ1wiKTtcclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xyXG4gICAgICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgICAgIGlmIChDbGlja1NvdW5kICE9IFwiXCIgJiYgQ2xpY2tTb3VuZCAhPSBudWxsKVxyXG4gICAgICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgICAgIC8vQXVkaW9NYW5hZ2VyLl90aGlzLkdldChcIlNGWC9cIiArIENsaWNrU291bmQpO1xyXG4gICAgICAgICAgICAgICAgICAgIEF1ZGlvTWFuYWdlci5fdGhpcy5CbGFzdChcIlNGWC9cIiArIENsaWNrU291bmQgKyBcIi5vZ2dcIik7XHJcblxyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgdmFyIHRtcCA9IE9uQ2xpY2s7XHJcbiAgICAgICAgICAgICAgICBpZiAoU2NyaXB0LldyaXRlPGJvb2w+KFwidG1wXCIpKVxyXG4gICAgICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgICAgIE9uQ2xpY2soKTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIHJldHVybiB0cnVlO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIHJldHVybiBmYWxzZTtcclxuICAgICAgICB9XHJcbiAgICAgICAgcHVibGljIG92ZXJyaWRlIHZvaWQgRHJhdyhDYW52YXNSZW5kZXJpbmdDb250ZXh0MkQgZylcclxuICAgICAgICB7XHJcbiAgICAgICAgICAgIC8vaWYgKF9jb250ZW50cy5TaXplICE9IExDb250ZW50U2l6ZSlcclxuICAgICAgICAgICAgaWYgKF9jb250ZW50cy5TaXplLlggIT0gTENvbnRlbnRTaXplLlggfHwgX2NvbnRlbnRzLlNpemUuWSAhPSBMQ29udGVudFNpemUuWSlcclxuICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgX2J1dHRvbk5lZWRzUmVyZW5kZXIgPSB0cnVlO1xyXG4gICAgICAgICAgICAgICAgTENvbnRlbnRTaXplID0gX2NvbnRlbnRzLlNpemUuQ2xvbmUoKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBpZiAoX2J1dHRvbk5lZWRzUmVyZW5kZXIpXHJcbiAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgIGRyYXdCdXR0b24oKTtcclxuICAgICAgICAgICAgICAgIF9idXR0b25OZWVkc1JlcmVuZGVyID0gZmFsc2U7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgU2l6ZSA9IF9idXR0b25CdWZmZXIuU2l6ZS5DbG9uZSgpO1xyXG4gICAgICAgICAgICAvL3Nwcml0ZUdyYXBoaWNzLkRyYXdJbWFnZShfYnUpXHJcbiAgICAgICAgICAgIF9idXR0b25CdWZmZXIuRHJhdyhzcHJpdGVHcmFwaGljcyk7XHJcbiAgICAgICAgICAgIENvbnRlbnRzLlBvc2l0aW9uID0gbmV3IFZlY3RvcjIoX2JvcmRlclNpemUsIF9ib3JkZXJTaXplKTtcclxuICAgICAgICAgICAgQ29udGVudHMuRHJhdyhzcHJpdGVHcmFwaGljcyk7XHJcblxyXG4gICAgICAgICAgICBpZiAoZyAhPSBudWxsKVxyXG4gICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICBiYXNlLkRyYXcoZyk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcbiAgICB9XHJcbn1cclxuIiwidXNpbmcgU3lzdGVtO1xyXG51c2luZyBTeXN0ZW0uQ29sbGVjdGlvbnMuR2VuZXJpYztcclxudXNpbmcgU3lzdGVtLkxpbnE7XHJcbnVzaW5nIFN5c3RlbS5UZXh0O1xyXG51c2luZyBTeXN0ZW0uVGhyZWFkaW5nLlRhc2tzO1xyXG51c2luZyBCcmlkZ2U7XHJcbnVzaW5nIEJyaWRnZS5IdG1sNTtcclxuXHJcbm5hbWVzcGFjZSBDaXJub0dhbWVcclxue1xyXG4gICAgcHVibGljIGNsYXNzIENhbWVyYVxyXG4gICAge1xyXG4gICAgICAgIHB1YmxpYyBib29sIGluc3Rhd2FycCA9IGZhbHNlO1xyXG4gICAgICAgIHB1YmxpYyBWZWN0b3IyIFBvc2l0aW9uO1xyXG4gICAgICAgIHB1YmxpYyBWZWN0b3IyIFRhcmdldFBvc2l0aW9uO1xyXG4gICAgICAgIHB1YmxpYyBWZWN0b3IyIENlbnRlcmVkVGFyZ2V0UG9zaXRpb25cclxuICAgICAgICB7XHJcbiAgICAgICAgICAgIHNldFxyXG4gICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICBUYXJnZXRQb3NpdGlvbiA9IG5ldyBWZWN0b3IyKHZhbHVlLlggLSAoQ2FtZXJhQm91bmRzLndpZHRoIC8gMiksIHZhbHVlLlkgLSAoQ2FtZXJhQm91bmRzLmhlaWdodCAvIDIpKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgLy9wdWJsaWMgZmxvYXQgTGluZWFyUGFuU3BlZWQgPSAxLjZmO1xyXG4gICAgICAgIC8vcHVibGljIGZsb2F0IExpbmVhclBhblNwZWVkID0gMS4zZjtcclxuICAgICAgICAvLy9wdWJsaWMgZmxvYXQgTGluZWFyUGFuU3BlZWQgPSAxLjJmO1xyXG4gICAgICAgIHB1YmxpYyBmbG9hdCBMaW5lYXJQYW5TcGVlZCA9IDAuOGY7XHJcbiAgICAgICAgLy8vcHVibGljIGZsb2F0IExlcnBQYW5TcGVlZCA9IDAuMDc1ZjtcclxuICAgICAgICBwdWJsaWMgZmxvYXQgTGVycFBhblNwZWVkID0gMC4wNzBmO1xyXG4gICAgICAgIC8vcHJvdGVjdGVkIGZsb2F0IF9zY2FsZSA9IDAuOGY7XHJcbiAgICAgICAgcHJvdGVjdGVkIGZsb2F0IF9zY2FsZSA9IDFmO1xyXG4gICAgICAgIHB1YmxpYyBmbG9hdCBzcGVlZG1vZCA9IDE7XHJcbiAgICAgICAgcHVibGljIGZsb2F0IFNjYWxlXHJcbiAgICAgICAge1xyXG4gICAgICAgICAgICBnZXRcclxuICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuIF9zY2FsZTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBzZXRcclxuICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgX3NjYWxlID0gdmFsdWU7XHJcbiAgICAgICAgICAgICAgICBfaW52c2NhbGUgPSAxIC8gX3NjYWxlO1xyXG4gICAgICAgICAgICAgICAgVXBkYXRlQ2FtZXJhQm91bmRzKCk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcbiAgICAgICAgLy9wcm90ZWN0ZWQgZmxvYXQgX2ludnNjYWxlID0gMS4yNWY7XHJcbiAgICAgICAgcHJvdGVjdGVkIGZsb2F0IF9pbnZzY2FsZSA9IDEuMGY7XHJcbiAgICAgICAgcHVibGljIGZsb2F0IEludlNjYWxlXHJcbiAgICAgICAge1xyXG4gICAgICAgICAgICBnZXRcclxuICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuIF9pbnZzY2FsZTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBzZXRcclxuICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgX2ludnNjYWxlID0gdmFsdWU7XHJcbiAgICAgICAgICAgICAgICBfc2NhbGUgPSAxIC8gX2ludnNjYWxlO1xyXG4gICAgICAgICAgICAgICAgVXBkYXRlQ2FtZXJhQm91bmRzKCk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcbiAgICAgICAgcHJpdmF0ZSBWZWN0b3IyIF9jZW50ZXIgPSBuZXcgVmVjdG9yMigpO1xyXG4gICAgICAgIHB1YmxpYyBWZWN0b3IyIENlbnRlclxyXG4gICAgICAgIHtcclxuICAgICAgICAgICAgZ2V0XHJcbiAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgIFJlY3RhbmdsZSBSID0gQ2FtZXJhQm91bmRzO1xyXG4gICAgICAgICAgICAgICAgLy9yZXR1cm4gUi5DZW50ZXI7XHJcbiAgICAgICAgICAgICAgICBSLkdldENlbnRlcihfY2VudGVyKTtcclxuICAgICAgICAgICAgICAgIHJldHVybiBfY2VudGVyO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIHNldFxyXG4gICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICBQb3NpdGlvbi5YID0gdmFsdWUuWCAtIChDYW1lcmFCb3VuZHMud2lkdGggLyAyKTtcclxuICAgICAgICAgICAgICAgIFBvc2l0aW9uLlkgPSB2YWx1ZS5ZIC0gKENhbWVyYUJvdW5kcy5oZWlnaHQgLyAyKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuICAgICAgICBwdWJsaWMgdm9pZCBTY2FsZVRvU2l6ZShmbG9hdCBzaXplSW5QaXhlbHMpXHJcbiAgICAgICAge1xyXG4gICAgICAgICAgICBTY2FsZSA9IHNpemVJblBpeGVscyAvIEFwcC5DYW52YXMuV2lkdGg7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHB1YmxpYyBmbG9hdCB2aWV3cG9ydF93aWR0aCA9IDE7XHJcbiAgICAgICAgcHVibGljIGZsb2F0IHZpZXdwb3J0X2hlaWdodCA9IDE7XHJcbiAgICAgICAgLy9jYW1lcmEgaGl0Ym94XHJcbiAgICAgICAgcHVibGljIFJlY3RhbmdsZSBDYW1lcmFCb3VuZHM7XHJcbiAgICAgICAgLy9hcmVhIGNhbWVyYSBtdXN0IGJlIGNvbmZpbmVkIHRvLlxyXG4gICAgICAgIHB1YmxpYyBSZWN0YW5nbGUgU3RhZ2VCb3VuZHM7XHJcbiAgICAgICAgcHVibGljIENhbWVyYShmbG9hdCB2aWV3cG9ydF93aWR0aCA9IC0xLCBmbG9hdCB2aWV3cG9ydF9oZWlnaHQgPSAtMSlcclxuICAgICAgICB7XHJcbiAgICAgICAgICAgIFBvc2l0aW9uID0gbmV3IFZlY3RvcjIoKTtcclxuICAgICAgICAgICAgVGFyZ2V0UG9zaXRpb24gPSBuZXcgVmVjdG9yMigpO1xyXG4gICAgICAgICAgICB0aGlzLnZpZXdwb3J0X3dpZHRoID0gdmlld3BvcnRfd2lkdGg7XHJcbiAgICAgICAgICAgIHRoaXMudmlld3BvcnRfaGVpZ2h0ID0gdmlld3BvcnRfaGVpZ2h0O1xyXG4gICAgICAgICAgICBDYW1lcmFCb3VuZHMgPSBuZXcgUmVjdGFuZ2xlKDAsIDAsIHZpZXdwb3J0X3dpZHRoLCB2aWV3cG9ydF9oZWlnaHQpO1xyXG4gICAgICAgICAgICBfaW52c2NhbGUgPSAxLjBmIC8gX3NjYWxlO1xyXG4gICAgICAgICAgICBVcGRhdGVDYW1lcmFCb3VuZHMoKTtcclxuICAgICAgICB9XHJcbiAgICAgICAgcHJpdmF0ZSB2b2lkIFVwZGF0ZUNhbWVyYUJvdW5kcygpXHJcbiAgICAgICAge1xyXG4gICAgICAgICAgICAvL0NhbWVyYUJvdW5kcy53aWR0aCA9IEFwcC5DYW52YXMuV2lkdGggKiBfaW52c2NhbGU7XHJcbiAgICAgICAgICAgIC8vQ2FtZXJhQm91bmRzLmhlaWdodCA9IEFwcC5DYW52YXMuSGVpZ2h0ICogX2ludnNjYWxlO1xyXG4gICAgICAgICAgICBDYW1lcmFCb3VuZHMud2lkdGggPSB2aWV3cG9ydF93aWR0aCAqIF9pbnZzY2FsZTtcclxuICAgICAgICAgICAgQ2FtZXJhQm91bmRzLmhlaWdodCA9IHZpZXdwb3J0X2hlaWdodCAqIF9pbnZzY2FsZTtcclxuICAgICAgICB9XHJcbiAgICAgICAgcHJpdmF0ZSBWZWN0b3IyIHRtcCA9IG5ldyBWZWN0b3IyKCk7XHJcbiAgICAgICAgcHVibGljIHZvaWQgVXBkYXRlKClcclxuICAgICAgICB7XHJcbiAgICAgICAgICAgIGlmIChQb3NpdGlvbi5YICE9IFRhcmdldFBvc2l0aW9uLlggfHwgUG9zaXRpb24uWSAhPSBUYXJnZXRQb3NpdGlvbi5ZKVxyXG4gICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICAvL2Zsb2F0IGRpc3QgPSAoUG9zaXRpb24gLSBUYXJnZXRQb3NpdGlvbikuTGVuZ3RoO1xyXG4gICAgICAgICAgICAgICAgZmxvYXQgZGlzdCA9IFBvc2l0aW9uLkRpc3RhbmNlKFRhcmdldFBvc2l0aW9uKTtcclxuICAgICAgICAgICAgICAgIGZsb2F0IHNwZCA9IExpbmVhclBhblNwZWVkICsgKGRpc3QgKiBMZXJwUGFuU3BlZWQpO1xyXG4gICAgICAgICAgICAgICAgc3BkICo9IHNwZWVkbW9kO1xyXG5cclxuICAgICAgICAgICAgICAgIGlmIChkaXN0IDw9IHNwZCB8fCBpbnN0YXdhcnApXHJcbiAgICAgICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICAgICAgUG9zaXRpb24uWCA9IFRhcmdldFBvc2l0aW9uLlg7XHJcbiAgICAgICAgICAgICAgICAgICAgUG9zaXRpb24uWSA9IFRhcmdldFBvc2l0aW9uLlk7XHJcbiAgICAgICAgICAgICAgICAgICAgaW5zdGF3YXJwID0gZmFsc2U7XHJcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgZWxzZVxyXG4gICAgICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgICAgIHRtcC5Db3B5RnJvbShQb3NpdGlvbik7XHJcbiAgICAgICAgICAgICAgICAgICAgdG1wLlN1YnRyYWN0KFRhcmdldFBvc2l0aW9uKTtcclxuICAgICAgICAgICAgICAgICAgICB0bXAuU2V0QXNOb3JtYWxpemUoc3BkKTtcclxuICAgICAgICAgICAgICAgICAgICAvL1ZlY3RvcjIgViA9IChQb3NpdGlvbiAtIFRhcmdldFBvc2l0aW9uKS5Ob3JtYWxpemUoc3BkKTtcclxuICAgICAgICAgICAgICAgICAgICBQb3NpdGlvbi5TdWJ0cmFjdCh0bXApO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgaWYgKFN0YWdlQm91bmRzICE9IG51bGwpXHJcbiAgICAgICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICAgICAgUG9zaXRpb24uWCA9IE1hdGhIZWxwZXIuQ2xhbXAoUG9zaXRpb24uWCwgU3RhZ2VCb3VuZHMubGVmdCwgU3RhZ2VCb3VuZHMucmlnaHQgLSBDYW1lcmFCb3VuZHMud2lkdGgpO1xyXG4gICAgICAgICAgICAgICAgICAgIFBvc2l0aW9uLlkgPSBNYXRoSGVscGVyLkNsYW1wKFBvc2l0aW9uLlksIFN0YWdlQm91bmRzLnRvcCwgU3RhZ2VCb3VuZHMuYm90dG9tIC0gQ2FtZXJhQm91bmRzLmhlaWdodCk7XHJcblxyXG4gICAgICAgICAgICAgICAgICAgIFRhcmdldFBvc2l0aW9uLlggPSBNYXRoSGVscGVyLkNsYW1wKFRhcmdldFBvc2l0aW9uLlgsIFN0YWdlQm91bmRzLmxlZnQsIFN0YWdlQm91bmRzLnJpZ2h0IC0gQ2FtZXJhQm91bmRzLndpZHRoKTtcclxuICAgICAgICAgICAgICAgICAgICBUYXJnZXRQb3NpdGlvbi5ZID0gTWF0aEhlbHBlci5DbGFtcChUYXJnZXRQb3NpdGlvbi5ZLCBTdGFnZUJvdW5kcy50b3AsIFN0YWdlQm91bmRzLmJvdHRvbSAtIENhbWVyYUJvdW5kcy5oZWlnaHQpO1xyXG4gICAgICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBDYW1lcmFCb3VuZHMueCA9IFBvc2l0aW9uLlg7XHJcbiAgICAgICAgICAgIENhbWVyYUJvdW5kcy55ID0gUG9zaXRpb24uWTtcclxuICAgICAgICB9XHJcbiAgICAgICAgcHVibGljIHZvaWQgQXBwbHkoQ2FudmFzUmVuZGVyaW5nQ29udGV4dDJEIGcpXHJcbiAgICAgICAge1xyXG4gICAgICAgICAgICBnLlNjYWxlKFNjYWxlLCBTY2FsZSk7XHJcbiAgICAgICAgICAgIGcuVHJhbnNsYXRlKC1Qb3NpdGlvbi5YLCAtUG9zaXRpb24uWSk7XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG59XHJcbiIsInVzaW5nIFN5c3RlbTtcclxudXNpbmcgU3lzdGVtLkNvbGxlY3Rpb25zLkdlbmVyaWM7XHJcbnVzaW5nIFN5c3RlbS5MaW5xO1xyXG51c2luZyBTeXN0ZW0uVGV4dDtcclxudXNpbmcgU3lzdGVtLlRocmVhZGluZy5UYXNrcztcclxudXNpbmcgQnJpZGdlO1xyXG51c2luZyBCcmlkZ2UuSHRtbDU7XHJcblxyXG5uYW1lc3BhY2UgQ2lybm9HYW1lXHJcbntcclxuICAgIHB1YmxpYyBjbGFzcyBFbnRpdHlcclxuICAgIHtcclxuICAgICAgICBwdWJsaWMgQW5pbWF0aW9uIEFuaTtcclxuICAgICAgICBwdWJsaWMgYm9vbCBBbGl2ZSA9IHRydWU7XHJcbiAgICAgICAgcHVibGljIGJvb2wgVmlzaWJsZSA9IHRydWU7XHJcbiAgICAgICAgcHVibGljIFZlY3RvcjIgU3BlZWQgPSBuZXcgVmVjdG9yMigpO1xyXG4gICAgICAgIHB1YmxpYyBHYW1lIEdhbWU7XHJcbiAgICAgICAgcHJvdGVjdGVkIExpc3Q8RW50aXR5QmVoYXZpb3I+IF9iZWhhdmlvcnM7XHJcbiAgICAgICAgcHJvdGVjdGVkIExpc3Q8aW50PiBfYmVoYXZpb3JUaWNrcztcclxuICAgICAgICBwdWJsaWMgRGljdGlvbmFyeTxzdHJpbmcsIGR5bmFtaWM+IGRhdGEgPSBuZXcgRGljdGlvbmFyeTxzdHJpbmcsIGR5bmFtaWM+KCk7XHJcbiAgICAgICAgcHVibGljIGludCBaT3JkZXIgPSAwO1xyXG4gICAgICAgIC8vcHVibGljIGRvdWJsZSBJRDtcclxuICAgICAgICBwdWJsaWMgc3RyaW5nIElEO1xyXG4gICAgICAgIHB1YmxpYyBib29sIEhpZGVIaXRib3g7XHJcbiAgICAgICAgcHVibGljIGJvb2wgSGFuZGxlZExvY2FsbHkgPSB0cnVlO1xyXG5cclxuICAgICAgICBwdWJsaWMgYm9vbCBSZW1vdmVkT25MZXZlbEVuZCA9IHRydWU7XHJcbiAgICAgICAgcHVibGljIGZsb2F0IEhzcGVlZFxyXG4gICAgICAgIHtcclxuICAgICAgICAgICAgZ2V0XHJcbiAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgIHJldHVybiBTcGVlZC5YO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIHNldFxyXG4gICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICBTcGVlZC5YID0gdmFsdWU7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcbiAgICAgICAgcHVibGljIGZsb2F0IFZzcGVlZFxyXG4gICAgICAgIHtcclxuICAgICAgICAgICAgZ2V0XHJcbiAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgIHJldHVybiBTcGVlZC5ZO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIHNldFxyXG4gICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICBTcGVlZC5ZID0gdmFsdWU7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcblxyXG5cclxuICAgICAgICBwdWJsaWMgVmVjdG9yMiBQb3NpdGlvblxyXG4gICAgICAgIHtcclxuICAgICAgICAgICAgZ2V0XHJcbiAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgIHJldHVybiBBbmkuUG9zaXRpb247XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgc2V0XHJcbiAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgIEFuaS5Qb3NpdGlvbiA9IHZhbHVlO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHB1YmxpYyBmbG9hdCB4XHJcbiAgICAgICAge1xyXG4gICAgICAgICAgICBnZXRcclxuICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuIEFuaS5Qb3NpdGlvbi5YO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIHNldFxyXG4gICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICBBbmkuUG9zaXRpb24uWCA9IHZhbHVlO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHB1YmxpYyBmbG9hdCB5XHJcbiAgICAgICAge1xyXG4gICAgICAgICAgICBnZXRcclxuICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuIEFuaS5Qb3NpdGlvbi5ZO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIHNldFxyXG4gICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICBBbmkuUG9zaXRpb24uWSA9IHZhbHVlO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBwdWJsaWMgZmxvYXQgV2lkdGhcclxuICAgICAgICB7XHJcbiAgICAgICAgICAgIGdldFxyXG4gICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICBpZiAoQW5pLkN1cnJlbnRJbWFnZSAhPSBudWxsKVxyXG4gICAgICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBBbmkuQ3VycmVudEltYWdlLldpZHRoO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgcmV0dXJuIDA7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIHB1YmxpYyBmbG9hdCBIZWlnaHRcclxuICAgICAgICB7XHJcbiAgICAgICAgICAgIGdldFxyXG4gICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICBpZiAoQW5pLkN1cnJlbnRJbWFnZSAhPSBudWxsKVxyXG4gICAgICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBBbmkuQ3VycmVudEltYWdlLkhlaWdodDtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIHJldHVybiAwO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBwdWJsaWMgdm9pZCBBZGRCZWhhdmlvcihFbnRpdHlCZWhhdmlvciBiZWhhdmlvcilcclxuICAgICAgICB7XHJcbiAgICAgICAgICAgIGlmIChfYmVoYXZpb3JzID09IG51bGwpXHJcbiAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgIF9iZWhhdmlvcnMgPSBuZXcgTGlzdDxFbnRpdHlCZWhhdmlvcj4oKTtcclxuICAgICAgICAgICAgICAgIF9iZWhhdmlvclRpY2tzID0gbmV3IExpc3Q8aW50PigpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIF9iZWhhdmlvcnMuQWRkKGJlaGF2aW9yKTtcclxuICAgICAgICAgICAgX2JlaGF2aW9yVGlja3MuQWRkKDApO1xyXG4gICAgICAgIH1cclxuICAgICAgICBwdWJsaWMgVCBBZGRCZWhhdmlvcjxUPigpXHJcbiAgICAgICAge1xyXG4gICAgICAgICAgICBpZiAoX2JlaGF2aW9ycyA9PSBudWxsKVxyXG4gICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICBfYmVoYXZpb3JzID0gbmV3IExpc3Q8RW50aXR5QmVoYXZpb3I+KCk7XHJcbiAgICAgICAgICAgICAgICBfYmVoYXZpb3JUaWNrcyA9IG5ldyBMaXN0PGludD4oKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB2YXIgQiA9IEFjdGl2YXRvci5DcmVhdGVJbnN0YW5jZSh0eXBlb2YoVCksIHRoaXMpO1xyXG4gICAgICAgICAgICBfYmVoYXZpb3JzLkFkZCgoRW50aXR5QmVoYXZpb3IpQik7XHJcbiAgICAgICAgICAgIF9iZWhhdmlvclRpY2tzLkFkZCgwKTtcclxuICAgICAgICAgICAgcmV0dXJuIEIuQXM8ZHluYW1pYz4oKTtcclxuICAgICAgICAgICAgLyppZiAoQiBpcyBFbnRpdHlCZWhhdmlvcilcclxuICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgX2JlaGF2aW9ycy5BZGQoKEVudGl0eUJlaGF2aW9yKUIpO1xyXG4gICAgICAgICAgICAgICAgX2JlaGF2aW9yVGlja3MuQWRkKDApO1xyXG4gICAgICAgICAgICB9ZWxzZVxyXG4gICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICB0aHJvdyBuZXcgRXhjZXB0aW9uKFwiQXR0ZW1wdGVkIHRvIGFkZCBhbiBpbnZhbGlkIGJlaGF2aW9yXCIpO1xyXG4gICAgICAgICAgICB9Ki9cclxuICAgICAgICB9XHJcbiAgICAgICAgcHVibGljIHZvaWQgUmVtb3ZlQmVoYXZpb3IoRW50aXR5QmVoYXZpb3IgYmVoYXZpb3IpXHJcbiAgICAgICAge1xyXG4gICAgICAgICAgICBpZiAoX2JlaGF2aW9ycyA9PSBudWxsKVxyXG4gICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICBfYmVoYXZpb3JzID0gbmV3IExpc3Q8RW50aXR5QmVoYXZpb3I+KCk7XHJcbiAgICAgICAgICAgICAgICBfYmVoYXZpb3JUaWNrcyA9IG5ldyBMaXN0PGludD4oKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBpZiAoX2JlaGF2aW9ycy5Db250YWlucyhiZWhhdmlvcikpXHJcbiAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgIF9iZWhhdmlvclRpY2tzLlJlbW92ZUF0KF9iZWhhdmlvcnMuSW5kZXhPZihiZWhhdmlvcikpO1xyXG4gICAgICAgICAgICAgICAgX2JlaGF2aW9ycy5SZW1vdmUoYmVoYXZpb3IpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHB1YmxpYyB2b2lkIFJlbW92ZUJlaGF2aW9yPFQ+KClcclxuICAgICAgICB7XHJcbiAgICAgICAgICAgIGlmIChfYmVoYXZpb3JzID09IG51bGwpXHJcbiAgICAgICAgICAgICAgICByZXR1cm47XHJcbiAgICAgICAgICAgIExpc3Q8RW50aXR5QmVoYXZpb3I+IEwgPSBuZXcgTGlzdDxFbnRpdHlCZWhhdmlvcj4oU3lzdGVtLkxpbnEuRW51bWVyYWJsZS5XaGVyZTxnbG9iYWw6OkNpcm5vR2FtZS5FbnRpdHlCZWhhdmlvcj4oX2JlaGF2aW9ycywoZ2xvYmFsOjpTeXN0ZW0uRnVuYzxnbG9iYWw6OkNpcm5vR2FtZS5FbnRpdHlCZWhhdmlvciwgYm9vbD4pKGJlaGF2aW9yID0+IGJlaGF2aW9yIGlzIFQpKSk7XHJcbiAgICAgICAgICAgIC8qaWYgKEwuQ291bnQgPiAwKVxyXG4gICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICBSZW1vdmVCZWhhdmlvcihMWzBdKTtcclxuICAgICAgICAgICAgfSovXHJcbiAgICAgICAgICAgIGZvcmVhY2ggKEVudGl0eUJlaGF2aW9yIGJlaGF2aW9yIGluIEwpXHJcbiAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgIFJlbW92ZUJlaGF2aW9yKGJlaGF2aW9yKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICByZXR1cm47XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHB1YmxpYyBUIEdldEJlaGF2aW9yPFQ+KClcclxuICAgICAgICB7XHJcbiAgICAgICAgICAgIGlmIChfYmVoYXZpb3JzID09IG51bGwpXHJcbiAgICAgICAgICAgICAgICByZXR1cm4gZGVmYXVsdChUKTtcclxuICAgICAgICAgICAgLypMaXN0PEVudGl0eUJlaGF2aW9yPiBMID0gbmV3IExpc3Q8RW50aXR5QmVoYXZpb3I+KF9iZWhhdmlvcnMuV2hlcmUoYmVoYXZpb3IgPT4gYmVoYXZpb3IgaXMgVCkpO1xyXG4gICAgICAgICAgICBpZiAoTC5Db3VudD4wKVxyXG4gICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gKGR5bmFtaWMpTFswXTtcclxuICAgICAgICAgICAgfSovXHJcbiAgICAgICAgICAgIHJldHVybiBTeXN0ZW0uTGlucS5FbnVtZXJhYmxlLkZpcnN0PGdsb2JhbDo6Q2lybm9HYW1lLkVudGl0eUJlaGF2aW9yPihfYmVoYXZpb3JzLChnbG9iYWw6OlN5c3RlbS5GdW5jPGdsb2JhbDo6Q2lybm9HYW1lLkVudGl0eUJlaGF2aW9yLCBib29sPikoYmVoYXZpb3IgPT4gYmVoYXZpb3IgaXMgVCkpLkNhc3Q8VD4oKTtcclxuICAgICAgICAgICAgcmV0dXJuIGRlZmF1bHQoVCk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIC8vcHVibGljIFQgR2V0QmVoYXZpb3I8VD4oRnVuYzxFbnRpdHlCZWhhdmlvcixib29sPiBmdW5jKVxyXG4gICAgICAgIHB1YmxpYyBUIEdldEJlaGF2aW9yPFQ+KEZ1bmM8VCwgYm9vbD4gZnVuYylcclxuICAgICAgICB7XHJcbiAgICAgICAgICAgIExpc3Q8RW50aXR5QmVoYXZpb3I+IEwgPSBuZXcgTGlzdDxFbnRpdHlCZWhhdmlvcj4oU3lzdGVtLkxpbnEuRW51bWVyYWJsZS5XaGVyZTxnbG9iYWw6OkNpcm5vR2FtZS5FbnRpdHlCZWhhdmlvcj4oX2JlaGF2aW9ycywoZ2xvYmFsOjpTeXN0ZW0uRnVuYzxnbG9iYWw6OkNpcm5vR2FtZS5FbnRpdHlCZWhhdmlvciwgYm9vbD4pKGJlaGF2aW9yID0+IGJlaGF2aW9yIGlzIFQpKSk7XHJcbiAgICAgICAgICAgIEZ1bmM8RW50aXR5QmVoYXZpb3IsIGJvb2w+IEYgPSBmdW5jLlRvRHluYW1pYygpO1xyXG4gICAgICAgICAgICByZXR1cm4gU3lzdGVtLkxpbnEuRW51bWVyYWJsZS5GaXJzdDxnbG9iYWw6OkNpcm5vR2FtZS5FbnRpdHlCZWhhdmlvcj4oTCwoZ2xvYmFsOjpTeXN0ZW0uRnVuYzxnbG9iYWw6OkNpcm5vR2FtZS5FbnRpdHlCZWhhdmlvciwgYm9vbD4pRikuQ2FzdDxUPigpO1xyXG4gICAgICAgICAgICAvL3JldHVybiBMLkZpcnN0KGZ1bmMpLkNhc3Q8VD4oKTtcclxuICAgICAgICB9XHJcbiAgICAgICAgcHVibGljIHN0cmluZyBHZXRUZWFtQ29sb3IoKVxyXG4gICAgICAgIHtcclxuICAgICAgICAgICAgaWYgKHRoaXMgaXMgSUNvbWJhdGFudClcclxuICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgaWYgKEdhbWUuR2FtZVBsYXlTZXR0aW5ncy5HYW1lTW9kZS5UZWFtcylcclxuICAgICAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgICAgICByZXR1cm4gR2FtZS5HZXRUZWFtQ29sb3IoKChJQ29tYmF0YW50KXRoaXMpLlRlYW0pO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgZWxzZVxyXG4gICAgICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgICAgIGlmICh0aGlzID09IEdhbWUucGxheWVyKVxyXG4gICAgICAgICAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIEdhbWUuR2V0VGVhbUNvbG9yKDEpO1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICBlbHNlXHJcbiAgICAgICAgICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gR2FtZS5HZXRUZWFtQ29sb3IoMik7XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIHJldHVybiBcIlwiO1xyXG4gICAgICAgIH1cclxuICAgICAgICBwdWJsaWMgYm9vbCBTYW1lVGVhbShFbnRpdHkgY29tYmF0YW50KVxyXG4gICAgICAgIHtcclxuICAgICAgICAgICAgaWYgKFNjcmlwdC5Xcml0ZTxib29sPihcInRoaXMgPT0gY29tYmF0YW50XCIpKVxyXG4gICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gdHJ1ZTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBkeW5hbWljIEEgPSB0aGlzLlRvRHluYW1pYygpO1xyXG4gICAgICAgICAgICBkeW5hbWljIEIgPSBjb21iYXRhbnQuVG9EeW5hbWljKCk7XHJcblxyXG4gICAgICAgICAgICBpZiAoQS5Qb2ludHNGb3JLaWxsaW5nICYmIEIuUG9pbnRzRm9yS2lsbGluZylcclxuICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgSUNvbWJhdGFudCBBQSA9IEE7XHJcbiAgICAgICAgICAgICAgICBJQ29tYmF0YW50IEJCID0gQjtcclxuICAgICAgICAgICAgICAgIGlmIChTY3JpcHQuV3JpdGU8Ym9vbD4oXCJBQS5UZWFtID09IEJCLlRlYW1cIikpXHJcbiAgICAgICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKEdhbWUuVGVhbXMpXHJcbiAgICAgICAgICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAvL3JldHVybiAoKElDb21iYXRhbnQpdGhpcykuVGVhbSAhPSAwO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gdHJ1ZTtcclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgZWxzZVxyXG4gICAgICAgICAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIFNjcmlwdC5Xcml0ZTxib29sPihcIkFBLlRlYW0gPT0gMFwiKTtcclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xyXG4gICAgICAgIH1cclxuICAgICAgICBwdWJsaWMgRW50aXR5QmVoYXZpb3IgR2V0QmVoYXZpb3JGcm9tTmFtZShzdHJpbmcgTmFtZSlcclxuICAgICAgICB7XHJcbiAgICAgICAgICAgIGlmIChfYmVoYXZpb3JzID09IG51bGwpXHJcbiAgICAgICAgICAgICAgICByZXR1cm4gbnVsbDtcclxuICAgICAgICAgICAgLy9MaXN0PEVudGl0eUJlaGF2aW9yPiBMID0gbmV3IExpc3Q8RW50aXR5QmVoYXZpb3I+KF9iZWhhdmlvcnMuV2hlcmUoYmVoYXZpb3IgPT4gYmVoYXZpb3IuR2V0VHlwZSgpLkZ1bGxOYW1lPT10eXBlRnVsbE5hbWUpKTtcclxuICAgICAgICAgICAgLypMaXN0PEVudGl0eUJlaGF2aW9yPiBMID0gbmV3IExpc3Q8RW50aXR5QmVoYXZpb3I+KF9iZWhhdmlvcnMuV2hlcmUoYmVoYXZpb3IgPT4gYmVoYXZpb3IuQmVoYXZpb3JOYW1lID09IE5hbWUpKTtcclxuICAgICAgICAgICAgaWYgKEwuQ291bnQgPiAwKVxyXG4gICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gKGR5bmFtaWMpTFswXTtcclxuICAgICAgICAgICAgfSovXHJcbiAgICAgICAgICAgIHRyeVxyXG4gICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gU3lzdGVtLkxpbnEuRW51bWVyYWJsZS5GaXJzdDxnbG9iYWw6OkNpcm5vR2FtZS5FbnRpdHlCZWhhdmlvcj4oX2JlaGF2aW9ycywoZ2xvYmFsOjpTeXN0ZW0uRnVuYzxnbG9iYWw6OkNpcm5vR2FtZS5FbnRpdHlCZWhhdmlvciwgYm9vbD4pKGJlaGF2aW9yID0+IGJlaGF2aW9yLkJlaGF2aW9yTmFtZSA9PSBOYW1lKSk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgY2F0Y2hcclxuICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgQ29uc29sZS5Xcml0ZUxpbmUoXCJCZWhhdmlvciBcIiArIE5hbWUgKyBcIiB3YXMgbm90IGZvdW5kLlwiKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICByZXR1cm4gbnVsbDtcclxuICAgICAgICB9XHJcbiAgICAgICAgLypwdWJsaWMgdmlydHVhbCBib29sIEhhbmRsZWRMb2NhbGx5XHJcbiAgICAgICAge1xyXG4gICAgICAgICAgICBnZXRcclxuICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuIEdhbWUuSG9zdGVyO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfSovXHJcbiAgICAgICAgcHVibGljIHZpcnR1YWwgdm9pZCBDdXN0b21FdmVudChkeW5hbWljIGV2dClcclxuICAgICAgICB7XHJcblxyXG4gICAgICAgIH1cclxuICAgICAgICAvKnB1YmxpYyB2b2lkIFNlbmRDdXN0b21FdmVudChkeW5hbWljIGV2dCwgYm9vbCB0cmlnZ2VyZmx1c2ggPSBmYWxzZSlcclxuICAgICAgICB7XHJcbiAgICAgICAgICAgIGR5bmFtaWMgRCA9IG5ldyBvYmplY3QoKTtcclxuICAgICAgICAgICAgRC5JID0gSUQ7XHJcbiAgICAgICAgICAgIEQuRCA9IGV2dDtcclxuICAgICAgICAgICAgR2FtZS5TZW5kRXZlbnQoXCJDRVwiLCBELHRyaWdnZXJmbHVzaCk7XHJcbiAgICAgICAgfSovXHJcbiAgICAgICAgcHVibGljIHZvaWQgUGxheVNvdW5kKHN0cmluZyBzb3VuZClcclxuICAgICAgICB7XHJcbiAgICAgICAgICAgIEdhbWUuUGxheVNvdW5kRWZmZWN0KGdldENlbnRlcigpLCBzb3VuZCk7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBwdWJsaWMgdmlydHVhbCBWZWN0b3IyIGdldENlbnRlcigpXHJcbiAgICAgICAge1xyXG4gICAgICAgICAgICAvL3JldHVybiBQb3NpdGlvbiArIG5ldyBWZWN0b3IyKFdpZHRoIC8gMiwgSGVpZ2h0IC8gMik7XHJcbiAgICAgICAgICAgIHJldHVybiBWZWN0b3IyLkFkZChQb3NpdGlvbiwgV2lkdGggLyAyLCBIZWlnaHQgLyAyKTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIC8qcHVibGljIExpZ2h0IEdldExpZ2h0KClcclxuICAgICAgICB7XHJcbiAgICAgICAgICAgIGlmICh0aGlzIGlzIElMaWdodFNvdXJjZSlcclxuICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuIEdhbWUuTGlnaHRzLkZpcnN0KGwgPT4gbC5zb3VyY2UgPT0gdGhpcyk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgcmV0dXJuIG51bGw7XHJcbiAgICAgICAgfSovXHJcblxyXG4gICAgICAgIHB1YmxpYyBFbnRpdHkoR2FtZSBnYW1lKVxyXG4gICAgICAgIHtcclxuICAgICAgICAgICAgLy9JRCA9IE1hdGguUmFuZG9tKCk7XHJcbiAgICAgICAgICAgIElEID0gSGVscGVyLkdldFJhbmRvbVN0cmluZygpO1xyXG4gICAgICAgICAgICB0aGlzLkdhbWUgPSBnYW1lO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgcHJvdGVjdGVkIFJlY3RhbmdsZSBIaXRib3hCdWZmZXIgPSBuZXcgUmVjdGFuZ2xlKCk7XHJcblxyXG4gICAgICAgIHB1YmxpYyB2aXJ0dWFsIFJlY3RhbmdsZSBHZXRIaXRib3goKVxyXG4gICAgICAgIHtcclxuICAgICAgICAgICAgaWYgKEFuaSAhPSBudWxsICYmIEFuaS5DdXJyZW50SW1hZ2UgIT0gbnVsbClcclxuICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgLy9yZXR1cm4gbmV3IFJlY3RhbmdsZShBbmkuWCwgQW5pLlksIEFuaS5DdXJyZW50SW1hZ2UuV2lkdGgsIEFuaS5DdXJyZW50SW1hZ2UuSGVpZ2h0KTtcclxuICAgICAgICAgICAgICAgIHZhciBDSSA9IEFuaS5DdXJyZW50SW1hZ2U7XHJcbiAgICAgICAgICAgICAgICBIaXRib3hCdWZmZXIuU2V0KEFuaS5YLCBBbmkuWSwgQ0kuV2lkdGgsIENJLkhlaWdodCk7XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gSGl0Ym94QnVmZmVyO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIHJldHVybiBudWxsO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgcHVibGljIHZpcnR1YWwgdm9pZCBVcGRhdGUoKVxyXG4gICAgICAgIHtcclxuICAgICAgICAgICAgQW5pLlBvc2l0aW9uICs9IFNwZWVkO1xyXG4gICAgICAgICAgICBBbmkuVXBkYXRlKCk7XHJcbiAgICAgICAgICAgIGlmIChfYmVoYXZpb3JzICE9IG51bGwpXHJcbiAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgIGludCBpID0gMDtcclxuICAgICAgICAgICAgICAgIHdoaWxlIChpIDwgX2JlaGF2aW9ycy5Db3VudClcclxuICAgICAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgICAgICBFbnRpdHlCZWhhdmlvciBiZWhhdmlvciA9IF9iZWhhdmlvcnNbaV07XHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKGJlaGF2aW9yLmVuYWJsZWQgJiYgX2JlaGF2aW9yVGlja3NbaV0rKyA+PSBiZWhhdmlvci5GcmFtZXNQZXJUaWNrKVxyXG4gICAgICAgICAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgX2JlaGF2aW9yVGlja3NbaV0gPSAwO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBiZWhhdmlvci5VcGRhdGUoKTtcclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgaSsrO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHB1YmxpYyB2b2lkIFJlZnJlc2hCZWhhdmlvclRpY2s8VD4oKVxyXG4gICAgICAgIHtcclxuICAgICAgICAgICAgRW50aXR5QmVoYXZpb3IgQiA9IEdldEJlaGF2aW9yPFQ+KCkuVG9EeW5hbWljKCk7XHJcbiAgICAgICAgICAgIGlmIChCICE9IG51bGwpXHJcbiAgICAgICAgICAgICAgICBfYmVoYXZpb3JUaWNrc1tfYmVoYXZpb3JzLkluZGV4T2YoQildID0gQi5GcmFtZXNQZXJUaWNrO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgcHVibGljIHZpcnR1YWwgdm9pZCBEcmF3KENhbnZhc1JlbmRlcmluZ0NvbnRleHQyRCBnKVxyXG4gICAgICAgIHtcclxuICAgICAgICAgICAgQW5pLkRyYXcoZyk7XHJcbiAgICAgICAgICAgIGlmICghSGlkZUhpdGJveCAmJiBHYW1lLlNob3dIaXRib3gpXHJcbiAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgIERyYXdIaXRib3goZyk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgaWYgKF9iZWhhdmlvcnMgIT0gbnVsbClcclxuICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgZm9yZWFjaCAoRW50aXR5QmVoYXZpb3IgYmVoYXZpb3IgaW4gX2JlaGF2aW9ycylcclxuICAgICAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgICAgICBiZWhhdmlvci5EcmF3KGcpO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHB1YmxpYyB2b2lkIERyYXdIaXRib3goQ2FudmFzUmVuZGVyaW5nQ29udGV4dDJEIGcpXHJcbiAgICAgICAge1xyXG4gICAgICAgICAgICBSZWN0YW5nbGUgUiA9IEdldEhpdGJveCgpO1xyXG4gICAgICAgICAgICBpZiAoUiAhPSBudWxsKVxyXG4gICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICBnLlN0cm9rZVN0eWxlID0gXCIjRkZGRjAwXCI7XHJcbiAgICAgICAgICAgICAgICBnLlN0cm9rZVJlY3QoKGludClSLngsIChpbnQpUi55LCAoaW50KVIud2lkdGgsIChpbnQpUi5oZWlnaHQpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBwdWJsaWMgdmlydHVhbCB2b2lkIG9uUmVtb3ZlKClcclxuICAgICAgICB7XHJcblxyXG4gICAgICAgIH1cclxuXHJcbiAgICB9XHJcbn1cclxuIiwidXNpbmcgQnJpZGdlO1xyXG51c2luZyBCcmlkZ2UuSHRtbDU7XHJcbnVzaW5nIFN5c3RlbTtcclxuXHJcbm5hbWVzcGFjZSBDaXJub0dhbWVcclxue1xyXG4gICAgcHVibGljIGNsYXNzIEdhbWVQYWRcclxuICAgIHtcclxuICAgICAgICBwdWJsaWMgYm9vbCBjb25uZWN0ZWQ7XHJcbiAgICAgICAgcHVibGljIGRvdWJsZVtdIGF4ZXM7XHJcbiAgICAgICAgcHVibGljIEdhbWVQYWRCdXR0b25bXSBidXR0b25zO1xyXG4gICAgICAgIHB1YmxpYyBzdHJpbmcgaWQ7XHJcbiAgICAgICAgcHVibGljIGxvbmcgaW5kZXg7XHJcbiAgICAgICAgcHVibGljIEdhbWVQYWQoZHluYW1pYyBwYWQpXHJcbiAgICAgICAge1xyXG4gICAgICAgICAgICBpZCA9IHBhZC5pZDtcclxuICAgICAgICAgICAgaW5kZXggPSBwYWQuaW5kZXg7XHJcbiAgICAgICAgICAgIGNvbm5lY3RlZCA9IHBhZC5jb25uZWN0ZWQ7XHJcbiAgICAgICAgICAgIGF4ZXMgPSBwYWQuYXhlcztcclxuXHJcbiAgICAgICAgICAgIGludCBsZW5ndGggPSBwYWQuYnV0dG9ucy5sZW5ndGg7XHJcblxyXG4gICAgICAgICAgICBidXR0b25zID0gbmV3IEdhbWVQYWRCdXR0b25bbGVuZ3RoXTtcclxuICAgICAgICAgICAgaW50IGkgPSAwO1xyXG4gICAgICAgICAgICB3aGlsZSAoaSA8IGxlbmd0aClcclxuICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgYnV0dG9uc1tpXSA9IHBhZC5idXR0b25zW2ldO1xyXG4gICAgICAgICAgICAgICAgaSsrO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHB1YmxpYyB2b2lkIFVwZGF0ZSgpXHJcbiAgICAgICAge1xyXG4gICAgICAgICAgICBpbnQgaSA9IDA7XHJcbiAgICAgICAgICAgIHdoaWxlIChpIDwgYnV0dG9ucy5MZW5ndGgpXHJcbiAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgIGJ1dHRvbnNbaV0udGFwcGVkID0gZmFsc2U7XHJcbiAgICAgICAgICAgICAgICBpKys7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcbiAgICAgICAgcHVibGljIHZvaWQgQ29tYmluZURhdGEoR2FtZVBhZCBwYWQpXHJcbiAgICAgICAge1xyXG4gICAgICAgICAgICBpZiAoaWQgPT0gcGFkLmlkKVxyXG4gICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICBjb25uZWN0ZWQgPSBwYWQuY29ubmVjdGVkO1xyXG4gICAgICAgICAgICAgICAgYXhlcyA9IHBhZC5heGVzO1xyXG4gICAgICAgICAgICAgICAgLy9idXR0b25zID0gcGFkLmJ1dHRvbnM7XHJcbiAgICAgICAgICAgICAgICBDb21iaW5lQnV0dG9uRGF0YShwYWQuYnV0dG9ucyk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcbiAgICAgICAgcHJvdGVjdGVkIHZvaWQgQ29tYmluZUJ1dHRvbkRhdGEoR2FtZVBhZEJ1dHRvbltdIGJ1dHRvbnMpXHJcbiAgICAgICAge1xyXG4gICAgICAgICAgICBHYW1lUGFkQnV0dG9uW10gTGIgPSBidXR0b25zO1xyXG4gICAgICAgICAgICB0aGlzLmJ1dHRvbnMgPSBidXR0b25zO1xyXG4gICAgICAgICAgICBpbnQgaSA9IDA7XHJcbiAgICAgICAgICAgIHdoaWxlIChpIDwgYnV0dG9ucy5MZW5ndGgpXHJcbiAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgIGlmIChidXR0b25zW2ldLnByZXNzZWQgJiYgIUxiW2ldLnByZXNzZWQpXHJcbiAgICAgICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICAgICAgYnV0dG9uc1tpXS50YXBwZWQgPSB0cnVlO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgaSsrO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG59XHJcbiIsInVzaW5nIFN5c3RlbTtcclxudXNpbmcgU3lzdGVtLkNvbGxlY3Rpb25zLkdlbmVyaWM7XHJcbnVzaW5nIFN5c3RlbS5MaW5xO1xyXG51c2luZyBTeXN0ZW0uVGV4dDtcclxudXNpbmcgU3lzdGVtLlRocmVhZGluZy5UYXNrcztcclxuXHJcbm5hbWVzcGFjZSBDaXJub0dhbWVcclxue1xyXG4gICAgcHVibGljIGNsYXNzIEdhbWVQYWRCdXR0b25cclxuICAgIHtcclxuICAgICAgICBwdWJsaWMgYm9vbCB0YXBwZWQ7XHJcbiAgICAgICAgcHVibGljIGJvb2wgcHJlc3NlZDtcclxuICAgICAgICBwdWJsaWMgZG91YmxlIHZhbHVlO1xyXG4gICAgICAgIHB1YmxpYyBHYW1lUGFkQnV0dG9uKGR5bmFtaWMgYnV0dG9uKVxyXG4gICAgICAgIHtcclxuICAgICAgICAgICAgcHJlc3NlZCA9IGJ1dHRvbi5wcmVzc2VkO1xyXG4gICAgICAgICAgICB2YWx1ZSA9IGJ1dHRvbi52YWx1ZTtcclxuICAgICAgICAgICAgdGFwcGVkID0gZmFsc2U7XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG59XHJcbiIsInVzaW5nIEJyaWRnZTtcclxudXNpbmcgQnJpZGdlLkh0bWw1O1xyXG51c2luZyBTeXN0ZW07XHJcbnVzaW5nIFN5c3RlbS5Db2xsZWN0aW9ucy5HZW5lcmljO1xyXG51c2luZyBTeXN0ZW0uTGlucTtcclxuXHJcbm5hbWVzcGFjZSBDaXJub0dhbWVcclxue1xyXG4gICAgcHVibGljIGNsYXNzIEdhbWVQYWRNYW5hZ2VyXHJcbiAgICB7XHJcbiAgICAgICAgcHVibGljIHN0YXRpYyBHYW1lUGFkTWFuYWdlciBfdGhpcztcclxuICAgICAgICBwdWJsaWMgR2FtZVBhZE1hbmFnZXIoKVxyXG4gICAgICAgIHtcclxuICAgICAgICAgICAgZ2FtZXBhZHMgPSBuZXcgTGlzdDxHYW1lUGFkPigpO1xyXG4gICAgICAgICAgICBVcGRhdGUoKTtcclxuICAgICAgICB9XHJcbiAgICAgICAgcHVibGljIExpc3Q8R2FtZVBhZD4gYWN0aXZlR2FtZXBhZHNcclxuICAgICAgICB7XHJcbiAgICAgICAgICAgIGdldFxyXG4gICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gbmV3IExpc3Q8R2FtZVBhZD4oU3lzdGVtLkxpbnEuRW51bWVyYWJsZS5XaGVyZTxnbG9iYWw6OkNpcm5vR2FtZS5HYW1lUGFkPihnYW1lcGFkcywoZ2xvYmFsOjpTeXN0ZW0uRnVuYzxnbG9iYWw6OkNpcm5vR2FtZS5HYW1lUGFkLCBib29sPikoZ2FtZXBhZCA9PiBnYW1lcGFkLmNvbm5lY3RlZCkpKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuICAgICAgICBwdWJsaWMgR2FtZVBhZCBrZXlib2FyZDtcclxuICAgICAgICBwdWJsaWMgTGlzdDxHYW1lUGFkPiBnYW1lcGFkcztcclxuICAgICAgICBwcml2YXRlIGR5bmFtaWMgdGVtcGdhbWVwYWRzO1xyXG4gICAgICAgIHB1YmxpYyB2b2lkIENhbGxCYWNrVGVzdCgpXHJcbiAgICAgICAge1xyXG4gICAgICAgICAgICBHbG9iYWwuQWxlcnQoXCJDYWxsYmFjayFcIik7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHB1YmxpYyBHYW1lUGFkIEdldFBhZChzdHJpbmcgaWQpXHJcbiAgICAgICAge1xyXG4gICAgICAgICAgICBMaXN0PEdhbWVQYWQ+IEwgPSBuZXcgTGlzdDxHYW1lUGFkPihTeXN0ZW0uTGlucS5FbnVtZXJhYmxlLldoZXJlPGdsb2JhbDo6Q2lybm9HYW1lLkdhbWVQYWQ+KGdhbWVwYWRzLChnbG9iYWw6OlN5c3RlbS5GdW5jPGdsb2JhbDo6Q2lybm9HYW1lLkdhbWVQYWQsIGJvb2w+KShnYW1lcGFkID0+IGdhbWVwYWQuaWQgPT0gaWQpKSk7XHJcbiAgICAgICAgICAgIGlmIChMLkNvdW50ID4gMClcclxuICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuIExbMF07XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgcmV0dXJuIG51bGw7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHB1YmxpYyB2b2lkIFVwZGF0ZSgpXHJcbiAgICAgICAge1xyXG4gICAgICAgICAgICBpbnQgaSA9IDA7XHJcbiAgICAgICAgICAgIHdoaWxlIChpIDwgZ2FtZXBhZHMuQ291bnQpXHJcbiAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgIGdhbWVwYWRzW2ldLlVwZGF0ZSgpO1xyXG4gICAgICAgICAgICAgICAgaSsrO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIGkgPSAwO1xyXG4gICAgICAgICAgICB0ZW1wZ2FtZXBhZHMgPSBTY3JpcHQuV3JpdGU8b2JqZWN0PihcIihuYXZpZ2F0b3IuZ2V0R2FtZXBhZHMoKSB8fCBuYXZpZ2F0b3Iud2Via2l0R2V0R2FtZXBhZHMoKSB8fCBbXSlcIik7XHJcbiAgICAgICAgICAgIExpc3Q8R2FtZVBhZD4gcGFkcyA9IG5ldyBMaXN0PEdhbWVQYWQ+KCk7XHJcbiAgICAgICAgICAgIHdoaWxlIChpIDwgdGVtcGdhbWVwYWRzLmxlbmd0aClcclxuICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgaWYgKHRlbXBnYW1lcGFkc1tpXSAhPSBudWxsKVxyXG4gICAgICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgICAgIEdhbWVQYWQgcGFkID0gbmV3IEdhbWVQYWQodGVtcGdhbWVwYWRzW2ldKTtcclxuICAgICAgICAgICAgICAgICAgICBfVXBkYXRlKHBhZCk7XHJcbiAgICAgICAgICAgICAgICAgICAgcGFkcy5BZGQocGFkKTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIGkrKztcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBpID0gMDtcclxuICAgICAgICAgICAgLy9BZGRzIGFueSBuZXdseSBmb3VuZCBnYW1lcGFkcy5cclxuICAgICAgICAgICAgd2hpbGUgKGkgPCBwYWRzLkNvdW50KVxyXG4gICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICBzdHJpbmcgaWQgPSBwYWRzW2ldLmlkO1xyXG4gICAgICAgICAgICAgICAgaW50IGogPSAwO1xyXG4gICAgICAgICAgICAgICAgYm9vbCBvayA9IHRydWU7XHJcbiAgICAgICAgICAgICAgICB3aGlsZSAoaiA8IGdhbWVwYWRzLkNvdW50KVxyXG4gICAgICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgICAgIGlmIChnYW1lcGFkc1tqXS5pZCA9PSBpZClcclxuICAgICAgICAgICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIG9rID0gZmFsc2U7XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgIGorKztcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIGlmIChvaylcclxuICAgICAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgICAgICBnYW1lcGFkcy5BZGQocGFkc1tpXSk7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICBpKys7XHJcbiAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgIC8qQWN0aW9uIEYgPSBDYWxsQmFja1Rlc3Q7XHJcbiAgICAgICAgICAgIFNjcmlwdC5Xcml0ZShcInNldFRpbWVvdXQoRiwgMzAwMCk7XCIpOyovXHJcbiAgICAgICAgICAgIC8vR2xvYmFsLlNldFRpbWVvdXQoKVxyXG4gICAgICAgIH1cclxuICAgICAgICBwcml2YXRlIHZvaWQgX1VwZGF0ZShHYW1lUGFkIHBhZClcclxuICAgICAgICB7XHJcbiAgICAgICAgICAgIGludCBpID0gMDtcclxuICAgICAgICAgICAgd2hpbGUgKGkgPCBnYW1lcGFkcy5Db3VudClcclxuICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgR2FtZVBhZCBQID0gZ2FtZXBhZHNbaV07XHJcbiAgICAgICAgICAgICAgICBpZiAoUC5pZCA9PSBwYWQuaWQpXHJcbiAgICAgICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICAgICAgUC5Db21iaW5lRGF0YShwYWQpO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgaSsrO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG59XHJcbiIsInVzaW5nIFN5c3RlbTtcclxudXNpbmcgU3lzdGVtLkNvbGxlY3Rpb25zLkdlbmVyaWM7XHJcbnVzaW5nIFN5c3RlbS5MaW5xO1xyXG51c2luZyBTeXN0ZW0uVGV4dDtcclxudXNpbmcgU3lzdGVtLlRocmVhZGluZy5UYXNrcztcclxuXHJcbm5hbWVzcGFjZSBDaXJub0dhbWVcclxue1xyXG4gICAgcHVibGljIGNsYXNzIEdhbWVQbGF5U2V0dGluZ3NcclxuICAgIHtcclxuICAgICAgICBwdWJsaWMgYm9vbCBPbmxpbmUgPSBmYWxzZTtcclxuICAgICAgICBwdWJsaWMgc3RyaW5nIE15Q2hhcmFjdGVyID0gXCJSZWlzZW5cIjtcclxuICAgICAgICBwdWJsaWMgR2FtZU1vZGUgR2FtZU1vZGU7XHJcbiAgICAgICAgcHVibGljIGludCBNeVRlYW0gPSAxO1xyXG4gICAgICAgIHB1YmxpYyBpbnQgQmx1ZU5QQ3MgPSAzO1xyXG4gICAgICAgIHB1YmxpYyBpbnQgUmVkTlBDcyA9IDI7XHJcbiAgICAgICAgcHVibGljIHN0cmluZyBSb29tSUQgPSBcIlwiO1xyXG4gICAgICAgIC8vL3B1YmxpYyBOZXRQbGF5IEhvc3ROUE91dDtcclxuICAgICAgICBwdWJsaWMgZmxvYXQgQ29tcHV0ZXJBSU1vZGlmaWVyID0gMWY7XHJcbiAgICAgICAgcHVibGljIEdhbWVQbGF5U2V0dGluZ3MoKVxyXG4gICAgICAgIHtcclxuICAgICAgICAgICAgLy9HYW1lTW9kZSA9IG5ldyBHYW1lTW9kZSgpO1xyXG4gICAgICAgICAgICAvL0dhbWVNb2RlID0gR2FtZU1vZGUuRGVhdGhNYXRjaDtcclxuICAgICAgICAgICAgR2FtZU1vZGUgPSBHYW1lTW9kZS5UZWFtQmF0dGxlO1xyXG4gICAgICAgIH1cclxuICAgIH1cclxufVxyXG4iLCJ1c2luZyBTeXN0ZW07XHJcbnVzaW5nIFN5c3RlbS5Db2xsZWN0aW9ucy5HZW5lcmljO1xyXG51c2luZyBTeXN0ZW0uTGlucTtcclxudXNpbmcgU3lzdGVtLlRleHQ7XHJcbnVzaW5nIFN5c3RlbS5UaHJlYWRpbmcuVGFza3M7XHJcbnVzaW5nIEJyaWRnZTtcclxudXNpbmcgQnJpZGdlLkh0bWw1O1xyXG5cclxubmFtZXNwYWNlIENpcm5vR2FtZVxyXG57XHJcbiAgICBwdWJsaWMgY2xhc3MgSGVscGVyXHJcbiAgICB7XHJcbiAgICAgICAgcHVibGljIHN0YXRpYyBzdHJpbmcgR2V0UmFuZG9tU3RyaW5nKClcclxuICAgICAgICB7XHJcbiAgICAgICAgICAgIC8vcmV0dXJuIChNYXRoLlJhbmRvbSgpICogbmV3IERhdGUoKS5HZXRUaW1lKCkpLlRvU3RyaW5nKDM2KS5SZXBsYWNlKFwiL1xcXFwuLyBnLCAnLSdcIixudWxsKTtcclxuICAgICAgICAgICAgLy9yZXR1cm4gKE1hdGguUmFuZG9tKCkgKiBuZXcgRGF0ZSgpLkdldFRpbWUoKSkuVG9TdHJpbmcoMzYpLlJlcGxhY2UobmV3IEJyaWRnZS5UZXh0LlJlZ3VsYXJFeHByZXNzaW9ucy5SZWdleChcIlwiLCBudWxsKTtcclxuICAgICAgICAgICAgLy9yZXR1cm4gU2NyaXB0LldyaXRlPHN0cmluZz4oXCIoTWF0aC5yYW5kb20oKSAqIG5ldyBEYXRlKCkuZ2V0VGltZSgpKS50b1N0cmluZygzNikucmVwbGFjZSgvXFxcXC4vIGcsICctJylcIik7XHJcbiAgICAgICAgICAgIHJldHVybiBTY3JpcHQuV3JpdGU8c3RyaW5nPihcIihNYXRoLnJhbmRvbSgpICogbmV3IERhdGUoKS5nZXRUaW1lKCkpLnRvU3RyaW5nKDM2KVwiKTtcclxuICAgICAgICB9XHJcbiAgICAgICAgcHJvdGVjdGVkIHN0YXRpYyBEaWN0aW9uYXJ5PHN0cmluZywgb2JqZWN0PiBfbmFtZXNwYWNlcyA9IG5ldyBEaWN0aW9uYXJ5PHN0cmluZywgb2JqZWN0PigpO1xyXG4gICAgICAgIHB1YmxpYyBzdGF0aWMgVHlwZSBHZXRUeXBlKHN0cmluZyBGdWxsTmFtZSlcclxuICAgICAgICB7XHJcbiAgICAgICAgICAgIHN0cmluZyBuYW1lID0gRnVsbE5hbWU7XHJcbiAgICAgICAgICAgIGlmIChuYW1lID09IFwiXCIgfHwgbmFtZSA9PSBudWxsIHx8ICFuYW1lLkNvbnRhaW5zKFwiLlwiKSlcclxuICAgICAgICAgICAgICAgIHJldHVybiBudWxsO1xyXG4gICAgICAgICAgICBzdHJpbmdbXSBzID0gbmFtZS5TcGxpdChcIi5cIik7XHJcbiAgICAgICAgICAgIC8vc3RyaW5nIG5tID0gR2V0VHlwZSgpLkZ1bGxOYW1lLlNwbGl0KFwiLlwiKVswXTtcclxuICAgICAgICAgICAgaW50IGkgPSAxO1xyXG4gICAgICAgICAgICAvKmlmIChzWzBdICE9IG5tKVxyXG4gICAgICAgICAgICAgICAgcmV0dXJuIG51bGw7Ki9cclxuXHJcbiAgICAgICAgICAgIC8vZHluYW1pYyBvYmogPSBTY3JpcHQuV3JpdGU8b2JqZWN0PihubSk7XHJcblxyXG4gICAgICAgICAgICAvL0dldCBuYW1lc3BhY2VcclxuICAgICAgICAgICAgZHluYW1pYyBvYmo7XHJcbiAgICAgICAgICAgIGlmIChfbmFtZXNwYWNlcy5Db250YWluc0tleShzWzBdKSlcclxuICAgICAgICAgICAgICAgIG9iaiA9IF9uYW1lc3BhY2VzW3NbMF1dO1xyXG4gICAgICAgICAgICBlbHNlXHJcbiAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgIG9iaiA9IEdsb2JhbC5FdmFsPG9iamVjdD4oc1swXSk7XHJcbiAgICAgICAgICAgICAgICBfbmFtZXNwYWNlc1tzWzBdXSA9IG9iajtcclxuICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgd2hpbGUgKGkgPCBzLkxlbmd0aClcclxuICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgLy9QYXJzZSB0aHJvdWdoIG9iamVjdCBoaWVyYXJjaHkuXHJcbiAgICAgICAgICAgICAgICBpZiAoIVNjcmlwdC5Xcml0ZTxib29sPihcIm9ialwiKSlcclxuICAgICAgICAgICAgICAgICAgICByZXR1cm4gbnVsbDtcclxuICAgICAgICAgICAgICAgIG9iaiA9IG9ialtzW2ldXTtcclxuICAgICAgICAgICAgICAgIGkrKztcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICByZXR1cm4gb2JqO1xyXG4gICAgICAgIH1cclxuICAgICAgICBwdWJsaWMgc3RhdGljIHZvaWQgQWRkTXVsdGlwbGU8VD4oVFtdIGFycmF5LCBUIGl0ZW0sIGludCBudW1iZXIpXHJcbiAgICAgICAge1xyXG4gICAgICAgICAgICB3aGlsZSAobnVtYmVyID4gMClcclxuICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgQ2lybm9HYW1lLkhlbHBlckV4dGVuc2lvbnMuUHVzaDxUPihhcnJheSwgaXRlbSk7XHJcbiAgICAgICAgICAgICAgICBudW1iZXItLTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuICAgICAgICBwdWJsaWMgc3RhdGljIHN0cmluZyBSZXBlYXQoc3RyaW5nIHMsIGludCBudW1iZXIpXHJcbiAgICAgICAge1xyXG4gICAgICAgICAgICBpZiAobnVtYmVyIDwgMSlcclxuICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuIFwiXCI7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgc3RyaW5nIHJldCA9IHM7XHJcbiAgICAgICAgICAgIGludCBpID0gbnVtYmVyIC0gMTtcclxuICAgICAgICAgICAgd2hpbGUgKGkgPiAwKVxyXG4gICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICByZXQgPSByZXQgKyBzO1xyXG4gICAgICAgICAgICAgICAgaS0tO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIHJldHVybiByZXQ7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHB1YmxpYyBzdGF0aWMgSFRNTENhbnZhc0VsZW1lbnQgQ2xvbmVDYW52YXMoSFRNTENhbnZhc0VsZW1lbnQgQylcclxuICAgICAgICB7XHJcbiAgICAgICAgICAgIEhUTUxDYW52YXNFbGVtZW50IHJldCA9IG5ldyBIVE1MQ2FudmFzRWxlbWVudCgpO1xyXG4gICAgICAgICAgICByZXQuV2lkdGggPSBDLldpZHRoO1xyXG4gICAgICAgICAgICByZXQuSGVpZ2h0ID0gQy5IZWlnaHQ7XHJcbiAgICAgICAgICAgIENhbnZhc1JlbmRlcmluZ0NvbnRleHQyRCBnID0gcmV0LkdldENvbnRleHQoQ2FudmFzVHlwZXMuQ2FudmFzQ29udGV4dDJEVHlwZS5DYW52YXNSZW5kZXJpbmdDb250ZXh0MkQpO1xyXG4gICAgICAgICAgICBnLkRyYXdJbWFnZShDLCAwZiwgMGYpO1xyXG4gICAgICAgICAgICByZXR1cm4gcmV0O1xyXG4gICAgICAgIH1cclxuICAgICAgICBwdWJsaWMgc3RhdGljIENhbnZhc1JlbmRlcmluZ0NvbnRleHQyRCBHZXRDb250ZXh0KEhUTUxDYW52YXNFbGVtZW50IEMpXHJcbiAgICAgICAge1xyXG4gICAgICAgICAgICByZXR1cm4gQy5HZXRDb250ZXh0KENhbnZhc1R5cGVzLkNhbnZhc0NvbnRleHQyRFR5cGUuQ2FudmFzUmVuZGVyaW5nQ29udGV4dDJEKTtcclxuICAgICAgICB9XHJcbiAgICAgICAgcHVibGljIHN0YXRpYyBkeW5hbWljIEdldEZpZWxkKGR5bmFtaWMgdGFyZ2V0LCBzdHJpbmcgZmllbGROYW1lKVxyXG4gICAgICAgIHtcclxuICAgICAgICAgICAgZHluYW1pYyBPID0gdGFyZ2V0O1xyXG4gICAgICAgICAgICAvL2lmIChPW2ZpZWxkTmFtZV0pXHJcbiAgICAgICAgICAgIGlmIChIYXMoTywgZmllbGROYW1lKSlcclxuICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuIE9bZmllbGROYW1lXTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBpZiAoT1tcImdldFwiICsgZmllbGROYW1lXSlcclxuICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuIE9bXCJnZXRcIiArIGZpZWxkTmFtZV0oKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBzdHJpbmcgcyA9IFwiXCI7XHJcbiAgICAgICAgICAgIHRyeVxyXG4gICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICBzID0gXCJIZWxwZXIgZ2V0IGZpZWxkOiBGaWVsZCBcXFwiXCIgKyBmaWVsZE5hbWUgKyBcIlxcXCIgd2FzIG5vdCBpbiBcIiArIHRhcmdldC5HZXRUeXBlKCkuRnVsbE5hbWUgKyBcIi5cIjtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBjYXRjaFxyXG4gICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICBzID0gXCJIZWxwZXIgZ2V0IGZpZWxkOiBGaWVsZCBcXFwiXCIgKyBmaWVsZE5hbWUgKyBcIlxcXCIgd2FzIG5vdCBpbiBcIiArIHRhcmdldCArIFwiLlwiO1xyXG4gICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICAvL0NvbnNvbGUuV3JpdGVMaW5lKHMpO1xyXG4gICAgICAgICAgICBMb2cocyk7XHJcbiAgICAgICAgICAgIHJldHVybiBudWxsO1xyXG4gICAgICAgIH1cclxuICAgICAgICBwcm90ZWN0ZWQgc3RhdGljIGJvb2wgSGFzKGR5bmFtaWMgdGFyZ2V0LCBzdHJpbmcgZmllbGROYW1lKVxyXG4gICAgICAgIHtcclxuICAgICAgICAgICAgLyppZiAoT1tmaWVsZE5hbWVdIHx8ICgoc3RyaW5nKU8pID09IFwiZmFsc2VcIilcclxuICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuIHRydWU7XHJcbiAgICAgICAgICAgIH0qL1xyXG4gICAgICAgICAgICByZXR1cm4gU2NyaXB0LldyaXRlPGJvb2w+KFwidHlwZW9mIHRhcmdldFtmaWVsZE5hbWVdICE9ICd1bmRlZmluZWQnXCIpO1xyXG4gICAgICAgIH1cclxuICAgICAgICBwdWJsaWMgc3RhdGljIHZvaWQgUmVsb2FkUGFnZSgpXHJcbiAgICAgICAge1xyXG4gICAgICAgICAgICBXaW5kb3cuTG9jYXRpb24uSHJlZiA9IFdpbmRvdy5Mb2NhdGlvbi5IcmVmO1xyXG4gICAgICAgIH1cclxuICAgICAgICBwdWJsaWMgc3RhdGljIHZvaWQgU2V0RmllbGQoZHluYW1pYyB0YXJnZXQsIHN0cmluZyBmaWVsZE5hbWUsIGR5bmFtaWMgZGF0YSlcclxuICAgICAgICB7XHJcbiAgICAgICAgICAgIGR5bmFtaWMgTyA9IHRhcmdldDtcclxuICAgICAgICAgICAgLy9pZiAoT1tmaWVsZE5hbWVdKVxyXG4gICAgICAgICAgICBpZiAoSGFzKE8sIGZpZWxkTmFtZSkpXHJcbiAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgIE9bZmllbGROYW1lXSA9IGRhdGE7XHJcbiAgICAgICAgICAgICAgICByZXR1cm47XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgaWYgKE9bXCJzZXRcIiArIGZpZWxkTmFtZV0pXHJcbiAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgIE9bXCJzZXRcIiArIGZpZWxkTmFtZV0oZGF0YSk7XHJcbiAgICAgICAgICAgICAgICByZXR1cm47XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgc3RyaW5nIHMgPSBcIlwiO1xyXG4gICAgICAgICAgICB0cnlcclxuICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgcyA9IFwiSGVscGVyIHNldCBmaWVsZDogRmllbGQgXFxcIlwiICsgZmllbGROYW1lICsgXCJcXFwiIHdhcyBub3QgaW4gXCIgKyB0YXJnZXQuR2V0VHlwZSgpLkZ1bGxOYW1lICsgXCIuXCI7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgY2F0Y2hcclxuICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgcyA9IFwiSGVscGVyIHNldCBmaWVsZDogRmllbGQgXFxcIlwiICsgZmllbGROYW1lICsgXCJcXFwiIHdhcyBub3QgaW4gXCIgKyB0YXJnZXQgKyBcIi5cIjtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAvL0NvbnNvbGUuV3JpdGVMaW5lKHMpO1xyXG4gICAgICAgICAgICBMb2cocyk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIFtUZW1wbGF0ZShcImNvbnNvbGUubG9nKHttZXNzYWdlfSlcIildXHJcbiAgICAgICAgcHVibGljIHN0YXRpYyB2b2lkIExvZyhzdHJpbmcgbWVzc2FnZSlcclxuICAgICAgICB7XHJcbiAgICAgICAgICAgIGJvb2wgYiA9IFNjcmlwdC5Xcml0ZTxib29sPihcImNvbnNvbGUubG9nKG1lc3NhZ2UpXCIpO1xyXG4gICAgICAgIH1cclxuICAgICAgICBwdWJsaWMgc3RhdGljIHZvaWQgQ29weUZpZWxkcyhkeW5hbWljIHNvdXJjZSwgZHluYW1pYyB0YXJnZXQsIHN0cmluZ1tdIEZpZWxkcyA9IG51bGwpXHJcbiAgICAgICAge1xyXG4gICAgICAgICAgICBpZiAoRmllbGRzID09IG51bGwpXHJcbiAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgIEZpZWxkcyA9IE9iamVjdC5LZXlzKHNvdXJjZSk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgaW50IGkgPSAwO1xyXG4gICAgICAgICAgICB3aGlsZSAoaSA8IEZpZWxkcy5MZW5ndGgpXHJcbiAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgIHN0cmluZyBmID0gRmllbGRzW2ldO1xyXG4gICAgICAgICAgICAgICAgU2V0RmllbGQodGFyZ2V0LCBmLCBHZXRGaWVsZChzb3VyY2UsIGYpKTtcclxuICAgICAgICAgICAgICAgIGkrKztcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuICAgICAgICBwdWJsaWMgc3RhdGljIHN0cmluZyBLZXlDb2RlVG9TdHJpbmcoaW50IGtleWNvZGUpXHJcbiAgICAgICAge1xyXG4gICAgICAgICAgICBzdHJpbmdbXSBjb2RlbmFtZXMgPSBuZXcgc3RyaW5nW10geyBcIlwiLCAvLyBbMF1cclxuICBcIlwiLCAvLyBbMV1cclxuICBcIlwiLCAvLyBbMl1cclxuICBcIkNBTkNFTFwiLCAvLyBbM11cclxuICBcIlwiLCAvLyBbNF1cclxuICBcIlwiLCAvLyBbNV1cclxuICBcIkhFTFBcIiwgLy8gWzZdXHJcbiAgXCJcIiwgLy8gWzddXHJcbiAgXCJCQUNLX1NQQUNFXCIsIC8vIFs4XVxyXG4gIFwiVEFCXCIsIC8vIFs5XVxyXG4gIFwiXCIsIC8vIFsxMF1cclxuICBcIlwiLCAvLyBbMTFdXHJcbiAgXCJDTEVBUlwiLCAvLyBbMTJdXHJcbiAgXCJFTlRFUlwiLCAvLyBbMTNdXHJcbiAgXCJFTlRFUl9TUEVDSUFMXCIsIC8vIFsxNF1cclxuICBcIlwiLCAvLyBbMTVdXHJcbiAgXCJTSElGVFwiLCAvLyBbMTZdXHJcbiAgXCJDT05UUk9MXCIsIC8vIFsxN11cclxuICBcIkFMVFwiLCAvLyBbMThdXHJcbiAgXCJQQVVTRVwiLCAvLyBbMTldXHJcbiAgXCJDQVBTX0xPQ0tcIiwgLy8gWzIwXVxyXG4gIFwiS0FOQVwiLCAvLyBbMjFdXHJcbiAgXCJFSVNVXCIsIC8vIFsyMl1cclxuICBcIkpVTkpBXCIsIC8vIFsyM11cclxuICBcIkZJTkFMXCIsIC8vIFsyNF1cclxuICBcIkhBTkpBXCIsIC8vIFsyNV1cclxuICBcIlwiLCAvLyBbMjZdXHJcbiAgXCJFU0NBUEVcIiwgLy8gWzI3XVxyXG4gIFwiQ09OVkVSVFwiLCAvLyBbMjhdXHJcbiAgXCJOT05DT05WRVJUXCIsIC8vIFsyOV1cclxuICBcIkFDQ0VQVFwiLCAvLyBbMzBdXHJcbiAgXCJNT0RFQ0hBTkdFXCIsIC8vIFszMV1cclxuICBcIlNQQUNFXCIsIC8vIFszMl1cclxuICBcIlBBR0VfVVBcIiwgLy8gWzMzXVxyXG4gIFwiUEFHRV9ET1dOXCIsIC8vIFszNF1cclxuICBcIkVORFwiLCAvLyBbMzVdXHJcbiAgXCJIT01FXCIsIC8vIFszNl1cclxuICBcIkxFRlRcIiwgLy8gWzM3XVxyXG4gIFwiVVBcIiwgLy8gWzM4XVxyXG4gIFwiUklHSFRcIiwgLy8gWzM5XVxyXG4gIFwiRE9XTlwiLCAvLyBbNDBdXHJcbiAgXCJTRUxFQ1RcIiwgLy8gWzQxXVxyXG4gIFwiUFJJTlRcIiwgLy8gWzQyXVxyXG4gIFwiRVhFQ1VURVwiLCAvLyBbNDNdXHJcbiAgXCJQUklOVFNDUkVFTlwiLCAvLyBbNDRdXHJcbiAgXCJJTlNFUlRcIiwgLy8gWzQ1XVxyXG4gIFwiREVMRVRFXCIsIC8vIFs0Nl1cclxuICBcIlwiLCAvLyBbNDddXHJcbiAgXCIwXCIsIC8vIFs0OF1cclxuICBcIjFcIiwgLy8gWzQ5XVxyXG4gIFwiMlwiLCAvLyBbNTBdXHJcbiAgXCIzXCIsIC8vIFs1MV1cclxuICBcIjRcIiwgLy8gWzUyXVxyXG4gIFwiNVwiLCAvLyBbNTNdXHJcbiAgXCI2XCIsIC8vIFs1NF1cclxuICBcIjdcIiwgLy8gWzU1XVxyXG4gIFwiOFwiLCAvLyBbNTZdXHJcbiAgXCI5XCIsIC8vIFs1N11cclxuICBcIkNPTE9OXCIsIC8vIFs1OF1cclxuICBcIlNFTUlDT0xPTlwiLCAvLyBbNTldXHJcbiAgXCJMRVNTX1RIQU5cIiwgLy8gWzYwXVxyXG4gIFwiRVFVQUxTXCIsIC8vIFs2MV1cclxuICBcIkdSRUFURVJfVEhBTlwiLCAvLyBbNjJdXHJcbiAgXCJRVUVTVElPTl9NQVJLXCIsIC8vIFs2M11cclxuICBcIkFUXCIsIC8vIFs2NF1cclxuICBcIkFcIiwgLy8gWzY1XVxyXG4gIFwiQlwiLCAvLyBbNjZdXHJcbiAgXCJDXCIsIC8vIFs2N11cclxuICBcIkRcIiwgLy8gWzY4XVxyXG4gIFwiRVwiLCAvLyBbNjldXHJcbiAgXCJGXCIsIC8vIFs3MF1cclxuICBcIkdcIiwgLy8gWzcxXVxyXG4gIFwiSFwiLCAvLyBbNzJdXHJcbiAgXCJJXCIsIC8vIFs3M11cclxuICBcIkpcIiwgLy8gWzc0XVxyXG4gIFwiS1wiLCAvLyBbNzVdXHJcbiAgXCJMXCIsIC8vIFs3Nl1cclxuICBcIk1cIiwgLy8gWzc3XVxyXG4gIFwiTlwiLCAvLyBbNzhdXHJcbiAgXCJPXCIsIC8vIFs3OV1cclxuICBcIlBcIiwgLy8gWzgwXVxyXG4gIFwiUVwiLCAvLyBbODFdXHJcbiAgXCJSXCIsIC8vIFs4Ml1cclxuICBcIlNcIiwgLy8gWzgzXVxyXG4gIFwiVFwiLCAvLyBbODRdXHJcbiAgXCJVXCIsIC8vIFs4NV1cclxuICBcIlZcIiwgLy8gWzg2XVxyXG4gIFwiV1wiLCAvLyBbODddXHJcbiAgXCJYXCIsIC8vIFs4OF1cclxuICBcIllcIiwgLy8gWzg5XVxyXG4gIFwiWlwiLCAvLyBbOTBdXHJcbiAgXCJPU19LRVlcIiwgLy8gWzkxXSBXaW5kb3dzIEtleSAoV2luZG93cykgb3IgQ29tbWFuZCBLZXkgKE1hYylcclxuICBcIlwiLCAvLyBbOTJdXHJcbiAgXCJDT05URVhUX01FTlVcIiwgLy8gWzkzXVxyXG4gIFwiXCIsIC8vIFs5NF1cclxuICBcIlNMRUVQXCIsIC8vIFs5NV1cclxuICBcIk5VTVBBRDBcIiwgLy8gWzk2XVxyXG4gIFwiTlVNUEFEMVwiLCAvLyBbOTddXHJcbiAgXCJOVU1QQUQyXCIsIC8vIFs5OF1cclxuICBcIk5VTVBBRDNcIiwgLy8gWzk5XVxyXG4gIFwiTlVNUEFENFwiLCAvLyBbMTAwXVxyXG4gIFwiTlVNUEFENVwiLCAvLyBbMTAxXVxyXG4gIFwiTlVNUEFENlwiLCAvLyBbMTAyXVxyXG4gIFwiTlVNUEFEN1wiLCAvLyBbMTAzXVxyXG4gIFwiTlVNUEFEOFwiLCAvLyBbMTA0XVxyXG4gIFwiTlVNUEFEOVwiLCAvLyBbMTA1XVxyXG4gIFwiTVVMVElQTFlcIiwgLy8gWzEwNl1cclxuICBcIkFERFwiLCAvLyBbMTA3XVxyXG4gIFwiU0VQQVJBVE9SXCIsIC8vIFsxMDhdXHJcbiAgXCJTVUJUUkFDVFwiLCAvLyBbMTA5XVxyXG4gIFwiREVDSU1BTFwiLCAvLyBbMTEwXVxyXG4gIFwiRElWSURFXCIsIC8vIFsxMTFdXHJcbiAgXCJGMVwiLCAvLyBbMTEyXVxyXG4gIFwiRjJcIiwgLy8gWzExM11cclxuICBcIkYzXCIsIC8vIFsxMTRdXHJcbiAgXCJGNFwiLCAvLyBbMTE1XVxyXG4gIFwiRjVcIiwgLy8gWzExNl1cclxuICBcIkY2XCIsIC8vIFsxMTddXHJcbiAgXCJGN1wiLCAvLyBbMTE4XVxyXG4gIFwiRjhcIiwgLy8gWzExOV1cclxuICBcIkY5XCIsIC8vIFsxMjBdXHJcbiAgXCJGMTBcIiwgLy8gWzEyMV1cclxuICBcIkYxMVwiLCAvLyBbMTIyXVxyXG4gIFwiRjEyXCIsIC8vIFsxMjNdXHJcbiAgXCJGMTNcIiwgLy8gWzEyNF1cclxuICBcIkYxNFwiLCAvLyBbMTI1XVxyXG4gIFwiRjE1XCIsIC8vIFsxMjZdXHJcbiAgXCJGMTZcIiwgLy8gWzEyN11cclxuICBcIkYxN1wiLCAvLyBbMTI4XVxyXG4gIFwiRjE4XCIsIC8vIFsxMjldXHJcbiAgXCJGMTlcIiwgLy8gWzEzMF1cclxuICBcIkYyMFwiLCAvLyBbMTMxXVxyXG4gIFwiRjIxXCIsIC8vIFsxMzJdXHJcbiAgXCJGMjJcIiwgLy8gWzEzM11cclxuICBcIkYyM1wiLCAvLyBbMTM0XVxyXG4gIFwiRjI0XCIsIC8vIFsxMzVdXHJcbiAgXCJcIiwgLy8gWzEzNl1cclxuICBcIlwiLCAvLyBbMTM3XVxyXG4gIFwiXCIsIC8vIFsxMzhdXHJcbiAgXCJcIiwgLy8gWzEzOV1cclxuICBcIlwiLCAvLyBbMTQwXVxyXG4gIFwiXCIsIC8vIFsxNDFdXHJcbiAgXCJcIiwgLy8gWzE0Ml1cclxuICBcIlwiLCAvLyBbMTQzXVxyXG4gIFwiTlVNX0xPQ0tcIiwgLy8gWzE0NF1cclxuICBcIlNDUk9MTF9MT0NLXCIsIC8vIFsxNDVdXHJcbiAgXCJXSU5fT0VNX0ZKX0pJU0hPXCIsIC8vIFsxNDZdXHJcbiAgXCJXSU5fT0VNX0ZKX01BU1NIT1VcIiwgLy8gWzE0N11cclxuICBcIldJTl9PRU1fRkpfVE9VUk9LVVwiLCAvLyBbMTQ4XVxyXG4gIFwiV0lOX09FTV9GSl9MT1lBXCIsIC8vIFsxNDldXHJcbiAgXCJXSU5fT0VNX0ZKX1JPWUFcIiwgLy8gWzE1MF1cclxuICBcIlwiLCAvLyBbMTUxXVxyXG4gIFwiXCIsIC8vIFsxNTJdXHJcbiAgXCJcIiwgLy8gWzE1M11cclxuICBcIlwiLCAvLyBbMTU0XVxyXG4gIFwiXCIsIC8vIFsxNTVdXHJcbiAgXCJcIiwgLy8gWzE1Nl1cclxuICBcIlwiLCAvLyBbMTU3XVxyXG4gIFwiXCIsIC8vIFsxNThdXHJcbiAgXCJcIiwgLy8gWzE1OV1cclxuICBcIkNJUkNVTUZMRVhcIiwgLy8gWzE2MF1cclxuICBcIkVYQ0xBTUFUSU9OXCIsIC8vIFsxNjFdXHJcbiAgXCJET1VCTEVfUVVPVEVcIiwgLy8gWzE2Ml1cclxuICBcIkhBU0hcIiwgLy8gWzE2M11cclxuICBcIkRPTExBUlwiLCAvLyBbMTY0XVxyXG4gIFwiUEVSQ0VOVFwiLCAvLyBbMTY1XVxyXG4gIFwiQU1QRVJTQU5EXCIsIC8vIFsxNjZdXHJcbiAgXCJVTkRFUlNDT1JFXCIsIC8vIFsxNjddXHJcbiAgXCJPUEVOX1BBUkVOXCIsIC8vIFsxNjhdXHJcbiAgXCJDTE9TRV9QQVJFTlwiLCAvLyBbMTY5XVxyXG4gIFwiQVNURVJJU0tcIiwgLy8gWzE3MF1cclxuICBcIlBMVVNcIiwgLy8gWzE3MV1cclxuICBcIlBJUEVcIiwgLy8gWzE3Ml1cclxuICBcIkhZUEhFTl9NSU5VU1wiLCAvLyBbMTczXVxyXG4gIFwiT1BFTl9DVVJMWV9CUkFDS0VUXCIsIC8vIFsxNzRdXHJcbiAgXCJDTE9TRV9DVVJMWV9CUkFDS0VUXCIsIC8vIFsxNzVdXHJcbiAgXCJUSUxERVwiLCAvLyBbMTc2XVxyXG4gIFwiXCIsIC8vIFsxNzddXHJcbiAgXCJcIiwgLy8gWzE3OF1cclxuICBcIlwiLCAvLyBbMTc5XVxyXG4gIFwiXCIsIC8vIFsxODBdXHJcbiAgXCJWT0xVTUVfTVVURVwiLCAvLyBbMTgxXVxyXG4gIFwiVk9MVU1FX0RPV05cIiwgLy8gWzE4Ml1cclxuICBcIlZPTFVNRV9VUFwiLCAvLyBbMTgzXVxyXG4gIFwiXCIsIC8vIFsxODRdXHJcbiAgXCJcIiwgLy8gWzE4NV1cclxuICBcIlNFTUlDT0xPTlwiLCAvLyBbMTg2XVxyXG4gIFwiRVFVQUxTXCIsIC8vIFsxODddXHJcbiAgXCJDT01NQVwiLCAvLyBbMTg4XVxyXG4gIFwiTUlOVVNcIiwgLy8gWzE4OV1cclxuICBcIlBFUklPRFwiLCAvLyBbMTkwXVxyXG4gIFwiU0xBU0hcIiwgLy8gWzE5MV1cclxuICBcIkJBQ0tfUVVPVEVcIiwgLy8gWzE5Ml1cclxuICBcIlwiLCAvLyBbMTkzXVxyXG4gIFwiXCIsIC8vIFsxOTRdXHJcbiAgXCJcIiwgLy8gWzE5NV1cclxuICBcIlwiLCAvLyBbMTk2XVxyXG4gIFwiXCIsIC8vIFsxOTddXHJcbiAgXCJcIiwgLy8gWzE5OF1cclxuICBcIlwiLCAvLyBbMTk5XVxyXG4gIFwiXCIsIC8vIFsyMDBdXHJcbiAgXCJcIiwgLy8gWzIwMV1cclxuICBcIlwiLCAvLyBbMjAyXVxyXG4gIFwiXCIsIC8vIFsyMDNdXHJcbiAgXCJcIiwgLy8gWzIwNF1cclxuICBcIlwiLCAvLyBbMjA1XVxyXG4gIFwiXCIsIC8vIFsyMDZdXHJcbiAgXCJcIiwgLy8gWzIwN11cclxuICBcIlwiLCAvLyBbMjA4XVxyXG4gIFwiXCIsIC8vIFsyMDldXHJcbiAgXCJcIiwgLy8gWzIxMF1cclxuICBcIlwiLCAvLyBbMjExXVxyXG4gIFwiXCIsIC8vIFsyMTJdXHJcbiAgXCJcIiwgLy8gWzIxM11cclxuICBcIlwiLCAvLyBbMjE0XVxyXG4gIFwiXCIsIC8vIFsyMTVdXHJcbiAgXCJcIiwgLy8gWzIxNl1cclxuICBcIlwiLCAvLyBbMjE3XVxyXG4gIFwiXCIsIC8vIFsyMThdXHJcbiAgXCJPUEVOX0JSQUNLRVRcIiwgLy8gWzIxOV1cclxuICBcIkJBQ0tfU0xBU0hcIiwgLy8gWzIyMF1cclxuICBcIkNMT1NFX0JSQUNLRVRcIiwgLy8gWzIyMV1cclxuICBcIlFVT1RFXCIsIC8vIFsyMjJdXHJcbiAgXCJcIiwgLy8gWzIyM11cclxuICBcIk1FVEFcIiwgLy8gWzIyNF1cclxuICBcIkFMVEdSXCIsIC8vIFsyMjVdXHJcbiAgXCJcIiwgLy8gWzIyNl1cclxuICBcIldJTl9JQ09fSEVMUFwiLCAvLyBbMjI3XVxyXG4gIFwiV0lOX0lDT18wMFwiLCAvLyBbMjI4XVxyXG4gIFwiXCIsIC8vIFsyMjldXHJcbiAgXCJXSU5fSUNPX0NMRUFSXCIsIC8vIFsyMzBdXHJcbiAgXCJcIiwgLy8gWzIzMV1cclxuICBcIlwiLCAvLyBbMjMyXVxyXG4gIFwiV0lOX09FTV9SRVNFVFwiLCAvLyBbMjMzXVxyXG4gIFwiV0lOX09FTV9KVU1QXCIsIC8vIFsyMzRdXHJcbiAgXCJXSU5fT0VNX1BBMVwiLCAvLyBbMjM1XVxyXG4gIFwiV0lOX09FTV9QQTJcIiwgLy8gWzIzNl1cclxuICBcIldJTl9PRU1fUEEzXCIsIC8vIFsyMzddXHJcbiAgXCJXSU5fT0VNX1dTQ1RSTFwiLCAvLyBbMjM4XVxyXG4gIFwiV0lOX09FTV9DVVNFTFwiLCAvLyBbMjM5XVxyXG4gIFwiV0lOX09FTV9BVFROXCIsIC8vIFsyNDBdXHJcbiAgXCJXSU5fT0VNX0ZJTklTSFwiLCAvLyBbMjQxXVxyXG4gIFwiV0lOX09FTV9DT1BZXCIsIC8vIFsyNDJdXHJcbiAgXCJXSU5fT0VNX0FVVE9cIiwgLy8gWzI0M11cclxuICBcIldJTl9PRU1fRU5MV1wiLCAvLyBbMjQ0XVxyXG4gIFwiV0lOX09FTV9CQUNLVEFCXCIsIC8vIFsyNDVdXHJcbiAgXCJBVFROXCIsIC8vIFsyNDZdXHJcbiAgXCJDUlNFTFwiLCAvLyBbMjQ3XVxyXG4gIFwiRVhTRUxcIiwgLy8gWzI0OF1cclxuICBcIkVSRU9GXCIsIC8vIFsyNDldXHJcbiAgXCJQTEFZXCIsIC8vIFsyNTBdXHJcbiAgXCJaT09NXCIsIC8vIFsyNTFdXHJcbiAgXCJcIiwgLy8gWzI1Ml1cclxuICBcIlBBMVwiLCAvLyBbMjUzXVxyXG4gIFwiV0lOX09FTV9DTEVBUlwiLCAvLyBbMjU0XVxyXG4gIFwiXCIgLy8gWzI1NV1cclxuICAgICAgICAgICAgfTtcclxuICAgICAgICAgICAgaWYgKGtleWNvZGUgPj0gMCAmJiBrZXljb2RlIDwgY29kZW5hbWVzLkxlbmd0aClcclxuICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuIGNvZGVuYW1lc1trZXljb2RlXTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB2YXIga2MgPSBrZXljb2RlO1xyXG4gICAgICAgICAgICByZXR1cm4gU2NyaXB0LldyaXRlPHN0cmluZz4oXCJTdHJpbmcuRnJvbUNoYXJDb2RlKGtjKVwiKTtcclxuICAgICAgICB9XHJcbiAgICAgICAgcHVibGljIHN0YXRpYyBkeW5hbWljIE1ha2VTaGFsbG93Q29weShkeW5hbWljIHNvdXJjZSwgc3RyaW5nW10gZmllbGROYW1lcyA9IG51bGwpXHJcbiAgICAgICAge1xyXG4gICAgICAgICAgICBkeW5hbWljIHRhcmdldCA9IG5ldyBvYmplY3QoKTtcclxuICAgICAgICAgICAgc3RyaW5nW10gRmllbGRzID0gZmllbGROYW1lcztcclxuICAgICAgICAgICAgaWYgKEZpZWxkcyA9PSBudWxsKVxyXG4gICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICBGaWVsZHMgPSBPYmplY3QuS2V5cyhzb3VyY2UpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIGludCBpID0gMDtcclxuICAgICAgICAgICAgd2hpbGUgKGkgPCBGaWVsZHMuTGVuZ3RoKVxyXG4gICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICBzdHJpbmcgZiA9IEZpZWxkc1tpXTtcclxuICAgICAgICAgICAgICAgIHRhcmdldFtmXSA9IEdldEZpZWxkKHNvdXJjZSwgZik7XHJcbiAgICAgICAgICAgICAgICBpKys7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgcmV0dXJuIHRhcmdldDtcclxuICAgICAgICB9XHJcbiAgICB9XHJcbn1cclxuIiwidXNpbmcgU3lzdGVtO1xyXG51c2luZyBTeXN0ZW0uQ29sbGVjdGlvbnMuR2VuZXJpYztcclxudXNpbmcgU3lzdGVtLkxpbnE7XHJcbnVzaW5nIFN5c3RlbS5UZXh0O1xyXG51c2luZyBTeXN0ZW0uVGhyZWFkaW5nLlRhc2tzO1xyXG51c2luZyBCcmlkZ2UuSHRtbDU7XHJcbnVzaW5nIEJyaWRnZTtcclxuXHJcbm5hbWVzcGFjZSBDaXJub0dhbWVcclxue1xyXG4gICAgcHVibGljIHN0YXRpYyBjbGFzcyBIZWxwZXJFeHRlbnNpb25zXHJcbiAgICB7XHJcbiAgICAgICAgcHVibGljIHN0YXRpYyBUIFBpY2s8VD4odGhpcyBJRW51bWVyYWJsZTxUPiBsaXN0LCBSYW5kb20gUk5EID0gbnVsbClcclxuICAgICAgICB7XHJcbiAgICAgICAgICAgIGlmIChSTkQgPT0gbnVsbClcclxuICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgUk5EID0gbmV3IFJhbmRvbSgpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIExpc3Q8VD4gTCA9IG5ldyBMaXN0PFQ+KCk7XHJcbiAgICAgICAgICAgIGZvcmVhY2ggKHZhciBpdGVtIGluIGxpc3QpXHJcbiAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgIEwuQWRkKGl0ZW0pO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIHJldHVybiBMW1JORC5OZXh0KEwuQ291bnQpXTtcclxuICAgICAgICB9XHJcbiAgICAgICAgcHVibGljIHN0YXRpYyB2b2lkIEZvckVhY2g8VD4odGhpcyBJRW51bWVyYWJsZTxUPiBsaXN0LCBBY3Rpb248VD4gYWN0aW9uKVxyXG4gICAgICAgIHtcclxuICAgICAgICAgICAgZm9yZWFjaCAodmFyIGl0ZW0gaW4gbGlzdClcclxuICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgYWN0aW9uKGl0ZW0pO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHB1YmxpYyBzdGF0aWMgdm9pZCBGb3JFYWNoPFQ+KHRoaXMgSUVudW1lcmFibGU8VD4gbGlzdCwgc3RyaW5nIG1ldGhvZE5hbWUpXHJcbiAgICAgICAge1xyXG4gICAgICAgICAgICBmb3JlYWNoICh2YXIgaXRlbSBpbiBsaXN0KVxyXG4gICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICBBY3Rpb24gQSA9IGl0ZW1bbWV0aG9kTmFtZV0uQXM8QWN0aW9uPigpO1xyXG4gICAgICAgICAgICAgICAgQSgpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHB1YmxpYyBzdGF0aWMgdm9pZCBBZGRJZk5ldzxUPih0aGlzIExpc3Q8VD4gbGlzdCwgVCBpdGVtKVxyXG4gICAgICAgIHtcclxuICAgICAgICAgICAgaW50IGkgPSAwO1xyXG4gICAgICAgICAgICB2YXIgbG4gPSBsaXN0LkNvdW50O1xyXG4gICAgICAgICAgICBvYmplY3QgQSA9IGl0ZW07XHJcbiAgICAgICAgICAgIHdoaWxlIChpIDwgbG4pXHJcbiAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgIG9iamVjdCBCID0gbGlzdFtpXTtcclxuICAgICAgICAgICAgICAgIGlmIChTY3JpcHQuV3JpdGU8Ym9vbD4oXCJBID09IEJcIikpXHJcbiAgICAgICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgaSsrO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIGxpc3QuQWRkKGl0ZW0pO1xyXG4gICAgICAgICAgICAvKmlmICghbGlzdC5Db250YWlucyhpdGVtKSlcclxuICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgbGlzdC5BZGQoaXRlbSk7XHJcbiAgICAgICAgICAgIH0qL1xyXG4gICAgICAgIH1cclxuICAgICAgICAvL3B1YmxpYyBzdGF0aWMgdm9pZCBSZW1vdmVBbGw8VD4odGhpcyBJRW51bWVyYWJsZTxUPiBsaXN0LCBBY3Rpb248VD4gYWN0aW9uKVxyXG4gICAgICAgIHB1YmxpYyBzdGF0aWMgdm9pZCBSZW1vdmVBbGw8VD4odGhpcyBMaXN0PFQ+IGxpc3QsIEZ1bmM8VCwgYm9vbD4gcHJlZGljYXRlKVxyXG4gICAgICAgIHtcclxuXHJcbiAgICAgICAgICAgIC8vZm9yZWFjaCAodmFyIGl0ZW0gaW4gbGlzdClcclxuICAgICAgICAgICAgaW50IGkgPSAwO1xyXG4gICAgICAgICAgICB3aGlsZSAoaSA8IGxpc3QuQ291bnQpXHJcbiAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgIHZhciBpdGVtID0gbGlzdFtpXTtcclxuICAgICAgICAgICAgICAgIC8vYWN0aW9uKGl0ZW0pO1xyXG4gICAgICAgICAgICAgICAgaWYgKHByZWRpY2F0ZShpdGVtKSlcclxuICAgICAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgICAgICAvL2xpc3QucmVtXHJcbiAgICAgICAgICAgICAgICAgICAgbGlzdC5SZW1vdmUoaXRlbSk7XHJcbiAgICAgICAgICAgICAgICAgICAgaS0tO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgaSsrO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBbVGVtcGxhdGUoXCJ7Kmxpc3R9LnB1c2goeyp2YWx9KVwiKV1cclxuICAgICAgICBwdWJsaWMgc3RhdGljIHZvaWQgUHVzaDxUPih0aGlzIFRbXSBsaXN0LCBUIHZhbClcclxuICAgICAgICB7XHJcbiAgICAgICAgICAgIFNjcmlwdC5Xcml0ZShcImxpc3QucHVzaCh2YWwpXCIpO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgcHVibGljIHN0YXRpYyB2b2lkIFB1c2hJZk5ldzxUPih0aGlzIFRbXSBsaXN0LCBUIHZhbClcclxuICAgICAgICB7XHJcbiAgICAgICAgICAgIGlmICghQ29udGFpbnNCPFQ+KGxpc3QsIHZhbCkpXHJcbiAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgIFB1c2g8VD4obGlzdCwgdmFsKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgcHVibGljIHN0YXRpYyB2b2lkIFB1c2hSYW5nZTxUPih0aGlzIFRbXSBsaXN0LCBwYXJhbXMgVFtdIHZhbClcclxuICAgICAgICB7XHJcbiAgICAgICAgICAgIHZhciBpID0gMDtcclxuICAgICAgICAgICAgd2hpbGUgKGkgPCB2YWwuTGVuZ3RoKVxyXG4gICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICBQdXNoPFQ+KGxpc3QsIHZhbFtpXSk7XHJcbiAgICAgICAgICAgICAgICBpKys7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIFtUZW1wbGF0ZShcInsqbGlzdH0ucG9wKClcIildXHJcbiAgICAgICAgcHVibGljIHN0YXRpYyBUIFBvcDxUPih0aGlzIFRbXSBsaXN0KVxyXG4gICAgICAgIHtcclxuICAgICAgICAgICAgcmV0dXJuIFNjcmlwdC5Xcml0ZTxUPihcImxpc3QucG9wKClcIik7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBwdWJsaWMgc3RhdGljIHZvaWQgQ2xlYXI8VD4odGhpcyBUW10gbGlzdClcclxuICAgICAgICB7XHJcbiAgICAgICAgICAgIGludCBpID0gbGlzdC5MZW5ndGg7XHJcbiAgICAgICAgICAgIHdoaWxlIChpLS0gPiAwKVxyXG4gICAgICAgICAgICAgICAgbGlzdC5Qb3AoKTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIHB1YmxpYyBzdGF0aWMgdm9pZCBSZXBsYWNlQWxsPFQ+KHRoaXMgVFtdIGxpc3QsIFRbXSBTb3VyY2UsIFRbXSBEZXN0aW5hdGlvbilcclxuICAgICAgICB7XHJcbiAgICAgICAgICAgIGludCBpID0gLTE7XHJcbiAgICAgICAgICAgIGkgPSBJbmRleE9mPFQ+KGxpc3QsIFNvdXJjZSwgaSArIDEsIDMpO1xyXG4gICAgICAgICAgICB2YXIgbG4gPSBTb3VyY2UuTGVuZ3RoO1xyXG4gICAgICAgICAgICB3aGlsZSAoaSA+PSAwKVxyXG4gICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICB2YXIgaiA9IDA7XHJcblxyXG4gICAgICAgICAgICAgICAgd2hpbGUgKGogPCBsbilcclxuICAgICAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgICAgICBsaXN0W2kgKyBqXSA9IERlc3RpbmF0aW9uW2pdO1xyXG4gICAgICAgICAgICAgICAgICAgIGorKztcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIGkgPSBJbmRleE9mPFQ+KGxpc3QsIFNvdXJjZSwgaSArIDEsIDMpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHB1YmxpYyBzdGF0aWMgVFtdIFdoZXJlQjxUPih0aGlzIFRbXSBsaXN0LCBGdW5jPFQsIGJvb2w+IHByZWRpY2F0ZSlcclxuICAgICAgICB7XHJcbiAgICAgICAgICAgIG9iamVjdFtdIHJldCA9IG5ldyBvYmplY3RbMF07XHJcbiAgICAgICAgICAgIGludCBpID0gMDtcclxuICAgICAgICAgICAgaW50IGxuID0gbGlzdC5MZW5ndGg7XHJcbiAgICAgICAgICAgIHdoaWxlIChpIDwgbG4pXHJcbiAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgIHZhciBpdGVtID0gbGlzdFtpXTtcclxuICAgICAgICAgICAgICAgIGlmIChwcmVkaWNhdGUoaXRlbSkpXHJcbiAgICAgICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICAgICAgQ2lybm9HYW1lLkhlbHBlckV4dGVuc2lvbnMuUHVzaDxvYmplY3Q+KHJldCwgaXRlbSk7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICBpKys7XHJcbiAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgIHJldHVybiByZXQuQXM8VFtdPigpO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgcHVibGljIHN0YXRpYyBib29sIENvbnRhaW5zQjxUPih0aGlzIExpc3Q8VD4gbGlzdCwgb2JqZWN0IFZhbHVlKVxyXG4gICAgICAgIHtcclxuICAgICAgICAgICAgVFtdIEwgPSBsaXN0W1wiaXRlbXNcIl0uQXM8VFtdPigpO1xyXG4gICAgICAgICAgICByZXR1cm4gQ29udGFpbnNCPFQ+KEwsIFZhbHVlKTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIHB1YmxpYyBzdGF0aWMgYm9vbCBDb250YWluc0I8VD4odGhpcyBUW10gbGlzdCwgb2JqZWN0IFZhbHVlKVxyXG4gICAgICAgIHtcclxuICAgICAgICAgICAgaW50IGkgPSAwO1xyXG4gICAgICAgICAgICBpbnQgbG4gPSBsaXN0Lkxlbmd0aDtcclxuICAgICAgICAgICAgd2hpbGUgKGkgPCBsbilcclxuICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgb2JqZWN0IE8gPSBsaXN0W2ldO1xyXG4gICAgICAgICAgICAgICAgaWYgKFNjcmlwdC5Xcml0ZTxib29sPihcIk8gPT0gVmFsdWVcIikpXHJcbiAgICAgICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHRydWU7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICBpKys7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgcHVibGljIHN0YXRpYyBpbnQgSW5kZXhPZjxUPih0aGlzIFRbXSBsaXN0LCBUW10gVmFsdWUsIGludCBpbmRleCA9IDAsIGludCBzdHJ1Y3R1cmVTaXplID0gMSlcclxuICAgICAgICB7XHJcbiAgICAgICAgICAgIGludCBpID0gaW5kZXg7XHJcbiAgICAgICAgICAgIHZhciBsbiA9IGxpc3QuTGVuZ3RoO1xyXG4gICAgICAgICAgICB2YXIgdmxuID0gVmFsdWUuTGVuZ3RoO1xyXG4gICAgICAgICAgICBvYmplY3QgTyA9IFZhbHVlWzBdO1xyXG4gICAgICAgICAgICBvYmplY3QgQTtcclxuICAgICAgICAgICAgb2JqZWN0IEI7XHJcbiAgICAgICAgICAgIHdoaWxlIChpIDwgbG4gJiYgaSA+PSAwKVxyXG4gICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICAvKnZhciBjID0gaSsxO1xyXG4gICAgICAgICAgICAgICAgaSA9IC0xO1xyXG4gICAgICAgICAgICAgICAgQiA9IFZhbHVlWzBdO1xyXG4gICAgICAgICAgICAgICAgd2hpbGUgKGMgPCBsaXN0Lkxlbmd0aCAmJiBpPT0tMSlcclxuICAgICAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgICAgICBBID0gbGlzdFtjXTtcclxuICAgICAgICAgICAgICAgICAgICBpZiAoQSA9PSBCKVxyXG4gICAgICAgICAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgaSA9IGM7XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgIGMrKztcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIGlmIChpID09IC0xKVxyXG4gICAgICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgICAgIHJldHVybiAtMTtcclxuICAgICAgICAgICAgICAgIH0qL1xyXG4gICAgICAgICAgICAgICAgaSA9IGxpc3QuSW5kZXhPZihPLkFzPHN0cmluZz4oKSwgaSArIDEpO1xyXG4gICAgICAgICAgICAgICAgd2hpbGUgKGkgPj0gMCAmJiBpICUgc3RydWN0dXJlU2l6ZSA+IDApXHJcbiAgICAgICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICAgICAgaSA9IGxpc3QuSW5kZXhPZihPLkFzPHN0cmluZz4oKSwgaSArIDEpO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgaWYgKGkgPT0gLTEpXHJcbiAgICAgICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIC0xO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgdmFyIGsgPSAxO1xyXG4gICAgICAgICAgICAgICAgdmFyIGwgPSBpICsgMTtcclxuXHJcbiAgICAgICAgICAgICAgICBpZiAoaSA8IGxuICYmIGkgPj0gMClcclxuICAgICAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgICAgICBib29sIG9rID0gdHJ1ZTtcclxuICAgICAgICAgICAgICAgICAgICB3aGlsZSAob2sgJiYgayA8IHZsbilcclxuICAgICAgICAgICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIEEgPSBsaXN0W2xdO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBCID0gVmFsdWVba107XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChBICE9IEIpXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIG9rID0gZmFsc2U7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICAgICAgaysrO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBsKys7XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgIGlmIChvaylcclxuICAgICAgICAgICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBpO1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICByZXR1cm4gLTE7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHB1YmxpYyBzdGF0aWMgYm9vbCBJZGVudGljYWw8VD4odGhpcyBUW10gbGlzdCwgVFtdIGxpc3QyKVxyXG4gICAgICAgIHtcclxuICAgICAgICAgICAgaWYgKGxpc3QgPT0gbGlzdDIpXHJcbiAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgIHJldHVybiB0cnVlO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIGlmIChsaXN0ID09IG51bGwgfHwgbGlzdDIgPT0gbnVsbClcclxuICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIHZhciBsbiA9IGxpc3QuTGVuZ3RoO1xyXG4gICAgICAgICAgICBpZiAobG4gPT0gbGlzdDIuTGVuZ3RoKVxyXG4gICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICBpbnQgaSA9IDA7XHJcblxyXG4gICAgICAgICAgICAgICAgd2hpbGUgKGkgPCBsbilcclxuICAgICAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgICAgICBvYmplY3QgQSA9IGxpc3RbaV07XHJcbiAgICAgICAgICAgICAgICAgICAgb2JqZWN0IEIgPSBsaXN0MltpXTtcclxuICAgICAgICAgICAgICAgICAgICBpZiAoQSAhPSBCKVxyXG4gICAgICAgICAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICBpKys7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gdHJ1ZTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICByZXR1cm4gZmFsc2U7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHB1YmxpYyBzdGF0aWMgdm9pZCBSZXZlcnNlT3JkZXJXaXRoU3RydWN0dXJlPFQ+KHRoaXMgVFtdIGxpc3QsIGludCBzaXplKVxyXG4gICAgICAgIHtcclxuICAgICAgICAgICAgLy9UW10gcmV0ID0gbmV3IFRbMF07XHJcbiAgICAgICAgICAgIExpc3Q8VD4gcmV0ID0gbmV3IExpc3Q8VD4oKTtcclxuICAgICAgICAgICAgaW50IGkgPSAwO1xyXG4gICAgICAgICAgICBpbnQgbG4gPSBsaXN0Lkxlbmd0aDtcclxuICAgICAgICAgICAgd2hpbGUgKGkgPCBsbilcclxuICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgaW50IGogPSAwO1xyXG4gICAgICAgICAgICAgICAgd2hpbGUgKGogPCBzaXplKVxyXG4gICAgICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgICAgIC8vcmV0LlB1c2gobGlzdFtqXSk7XHJcbiAgICAgICAgICAgICAgICAgICAgcmV0Lkluc2VydCgwLCBsaXN0WyhzaXplIC0gMSkgLSBqXSk7XHJcbiAgICAgICAgICAgICAgICAgICAgaisrO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgaSArPSBzaXplO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHB1YmxpYyBzdGF0aWMgdm9pZCBDbGVhcih0aGlzIENhbnZhc1JlbmRlcmluZ0NvbnRleHQyRCBHKVxyXG4gICAgICAgIHtcclxuICAgICAgICAgICAgdmFyIEMgPSBHLkNhbnZhcztcclxuICAgICAgICAgICAgRy5DbGVhclJlY3QoMCwgMCwgQy5XaWR0aCwgQy5IZWlnaHQpO1xyXG4gICAgICAgIH1cclxuICAgICAgICAvLy8gPHN1bW1hcnk+XHJcbiAgICAgICAgLy8vIG5vdCB5ZXQgdGVzdGVkIHdpdGggZGVlcCBpbmhlcml0ZW5jZS4uLlxyXG4gICAgICAgIC8vLyA8L3N1bW1hcnk+XHJcbiAgICAgICAgLy8vIDxwYXJhbSBuYW1lPVwiVFwiPjwvcGFyYW0+XHJcbiAgICAgICAgLy8vIDxwYXJhbSBuYW1lPVwiaW5zdGFuY2VcIj48L3BhcmFtPlxyXG4gICAgICAgIC8vLyA8cmV0dXJucz48L3JldHVybnM+XHJcbiAgICAgICAgcHVibGljIHN0YXRpYyBib29sIElzSW5zdGFuY2VPZlR5cGVGYXN0KHRoaXMgVHlwZSBULCBvYmplY3QgaW5zdGFuY2UpXHJcbiAgICAgICAge1xyXG4gICAgICAgICAgICB2YXIgQyA9IGluc3RhbmNlLkFzPGR5bmFtaWM+KCkuY3RvcjtcclxuICAgICAgICAgICAgb2JqZWN0W10gQSA9IFRbXCIkJGluaGVyaXRvcnNcIl0uQXM8ZHluYW1pYz4oKTsvL2xpc3Qgb2YgYWxsIHR5cGVzIHRoYXQgaW5oZXJpdCBmcm9tIHRoaXMgdHlwZVxyXG4gICAgICAgICAgICByZXR1cm4gKEMgPT0gVCB8fCAoQSAhPSBudWxsICYmIEEuSW5kZXhPZihDKSA+PSAwKSk7XHJcbiAgICAgICAgfVxyXG5cclxuICAgIH1cclxufVxyXG4iLCJ1c2luZyBTeXN0ZW07XHJcbnVzaW5nIFN5c3RlbS5Db2xsZWN0aW9ucy5HZW5lcmljO1xyXG51c2luZyBTeXN0ZW0uTGlucTtcclxudXNpbmcgU3lzdGVtLlRleHQ7XHJcbnVzaW5nIFN5c3RlbS5UaHJlYWRpbmcuVGFza3M7XHJcblxyXG5uYW1lc3BhY2UgQ2lybm9HYW1lXHJcbntcclxuICAgIHB1YmxpYyBjbGFzcyBJbnB1dENvbnRyb2xsZXJcclxuICAgIHtcclxuICAgICAgICBwdWJsaWMgc3RhdGljIGludCBOdW1iZXJPZkFjdGlvbnMgPSA4O1xyXG4gICAgICAgIHByb3RlY3RlZCBzdGF0aWMgR2FtZVBhZE1hbmFnZXIgR007XHJcbiAgICAgICAgcHVibGljIExpc3Q8SW5wdXRNYXA+IElucHV0TWFwcGluZztcclxuXHJcbiAgICAgICAgcHVibGljIHN0cmluZyBpZCB7IGdldDsgcHJvdGVjdGVkIHNldDsgfVxyXG5cclxuICAgICAgICBwdWJsaWMgSW5wdXRDb250cm9sbGVyKHN0cmluZyBpZCA9IFwiS2V5Ym9hcmRcIilcclxuICAgICAgICB7XHJcbiAgICAgICAgICAgIHRoaXMuaWQgPSBpZDtcclxuICAgICAgICAgICAgSW5wdXRNYXBwaW5nID0gbmV3IExpc3Q8SW5wdXRNYXA+KCk7XHJcblxyXG4gICAgICAgICAgICBpZiAoaWQgPT0gXCJLZXlib2FyZFwiKVxyXG4gICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICBpbml0a2V5Ym9hcmQoKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBlbHNlXHJcbiAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgIGluaXRnYW1lcGFkKCk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgaWYgKEdNID09IG51bGwpXHJcbiAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgIGlmIChHYW1lUGFkTWFuYWdlci5fdGhpcyA9PSBudWxsKVxyXG4gICAgICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgICAgIEdhbWVQYWRNYW5hZ2VyLl90aGlzID0gbmV3IEdhbWVQYWRNYW5hZ2VyKCk7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICBHTSA9IEdhbWVQYWRNYW5hZ2VyLl90aGlzO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHB1YmxpYyBkeW5hbWljIENvcHlNYXAoKVxyXG4gICAgICAgIHtcclxuICAgICAgICAgICAgLypkeW5hbWljIEQgPSBuZXcgb2JqZWN0KCk7XHJcbiAgICAgICAgICAgIHJldHVybiBEOyovXHJcbiAgICAgICAgICAgIHN0cmluZ1tdIGZpZWxkcyA9IG5ldyBzdHJpbmdbXSB7IFwibWFwXCIsIFwiYW50aW1hcFwiLCBcIm5hbWVcIiwgXCJheGlzXCIsIFwiY29udHJvbGxlcklEXCIgfTtcclxuICAgICAgICAgICAgZHluYW1pY1tdIHJldCA9IG5ldyBkeW5hbWljW0lucHV0TWFwcGluZy5Db3VudF07XHJcbiAgICAgICAgICAgIGludCBpID0gMDtcclxuICAgICAgICAgICAgd2hpbGUgKGkgPCByZXQuTGVuZ3RoKVxyXG4gICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICByZXRbaV0gPSBIZWxwZXIuTWFrZVNoYWxsb3dDb3B5KElucHV0TWFwcGluZ1tpXSwgZmllbGRzKTtcclxuICAgICAgICAgICAgICAgIGkrKztcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICByZXR1cm4gcmV0O1xyXG4gICAgICAgIH1cclxuICAgICAgICBwdWJsaWMgdm9pZCBDb3B5RnJvbU1hcChkeW5hbWljW10gTWFwKVxyXG4gICAgICAgIHtcclxuICAgICAgICAgICAgc3RyaW5nW10gZmllbGRzID0gbmV3IHN0cmluZ1tdIHsgXCJtYXBcIiwgXCJhbnRpbWFwXCIsIFwibmFtZVwiLCBcImF4aXNcIiwgXCJjb250cm9sbGVySURcIiB9O1xyXG5cclxuICAgICAgICAgICAgaW50IGkgPSAwO1xyXG4gICAgICAgICAgICB3aGlsZSAoaSA8IE1hcC5MZW5ndGgpXHJcbiAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgIGlmIChpID49IElucHV0TWFwcGluZy5Db3VudClcclxuICAgICAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgICAgICBJbnB1dE1hcHBpbmcuQWRkKG5ldyBJbnB1dE1hcCgpKTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIElucHV0TWFwIElNID0gSW5wdXRNYXBwaW5nW2ldO1xyXG4gICAgICAgICAgICAgICAgSGVscGVyLkNvcHlGaWVsZHMoTWFwW2ldLCBJTSwgZmllbGRzKTtcclxuICAgICAgICAgICAgICAgIC8vcmV0W2ldID0gSGVscGVyLk1ha2VTaGFsbG93Q29weShJbnB1dE1hcHBpbmdbaV0sIGZpZWxkcyk7XHJcbiAgICAgICAgICAgICAgICBpKys7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcbiAgICAgICAgcHJvdGVjdGVkIHZvaWQgaW5pdGtleWJvYXJkKClcclxuICAgICAgICB7XHJcbiAgICAgICAgICAgIGludCBpID0gMDtcclxuICAgICAgICAgICAgd2hpbGUgKGkgPCBOdW1iZXJPZkFjdGlvbnMpXHJcbiAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgIElucHV0TWFwIG1hcCA9IG5ldyBJbnB1dE1hcCgtMSk7XHJcbiAgICAgICAgICAgICAgICBpZiAoaSA9PSAwKVxyXG4gICAgICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgICAgIG1hcC5tYXAgPSAzOTtcclxuICAgICAgICAgICAgICAgICAgICBtYXAuYW50aW1hcCA9IDM3O1xyXG5cclxuICAgICAgICAgICAgICAgICAgICAvKm1hcC5tYXAgPSA2ODtcclxuICAgICAgICAgICAgICAgICAgICBtYXAuYW50aW1hcD0gNjU7Ki9cclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIGlmIChpID09IDEpXHJcbiAgICAgICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICAgICAgbWFwLm1hcCA9IDQwO1xyXG4gICAgICAgICAgICAgICAgICAgIG1hcC5hbnRpbWFwID0gMzg7XHJcblxyXG4gICAgICAgICAgICAgICAgICAgIC8qbWFwLm1hcCA9IDgzO1xyXG4gICAgICAgICAgICAgICAgICAgIG1hcC5hbnRpbWFwID0gODc7Ki9cclxuICAgICAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgICAgICBpZiAoaSA9PSAyKVxyXG4gICAgICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgICAgIC8vbWFwLm1hcCA9IDMyO1xyXG4gICAgICAgICAgICAgICAgICAgIG1hcC5tYXAgPSA5MDtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIGlmIChpID09IDMpXHJcbiAgICAgICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICAgICAgbWFwLm1hcCA9IDg4O1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgaWYgKGkgPT0gNClcclxuICAgICAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgICAgICBtYXAubWFwID0gNjU7Ly9hXHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICBpZiAoaSA9PSA1KVxyXG4gICAgICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgICAgIG1hcC5tYXAgPSAxMzsvL2VudGVyXHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICBJbnB1dE1hcHBpbmcuQWRkKG1hcCk7XHJcbiAgICAgICAgICAgICAgICBpKys7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcbiAgICAgICAgcHJvdGVjdGVkIHZvaWQgaW5pdGdhbWVwYWQoKVxyXG4gICAgICAgIHtcclxuICAgICAgICAgICAgaW50IGkgPSAwO1xyXG4gICAgICAgICAgICB3aGlsZSAoaSA8IE51bWJlck9mQWN0aW9ucylcclxuICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgSW5wdXRNYXAgbWFwID0gbmV3IElucHV0TWFwKC0xKTtcclxuICAgICAgICAgICAgICAgIGlmIChpID09IDApXHJcbiAgICAgICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICAgICAgbWFwLm1hcCA9IDA7XHJcbiAgICAgICAgICAgICAgICAgICAgbWFwLmF4aXMgPSB0cnVlO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgaWYgKGkgPT0gMSlcclxuICAgICAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgICAgICBtYXAubWFwID0gMTtcclxuICAgICAgICAgICAgICAgICAgICBtYXAuYXhpcyA9IHRydWU7XHJcbiAgICAgICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICAgICAgaWYgKGkgPiAxKVxyXG4gICAgICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgICAgIG1hcC5tYXAgPSBpIC0gMjtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIElucHV0TWFwcGluZy5BZGQobWFwKTtcclxuICAgICAgICAgICAgICAgIGkrKztcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuICAgICAgICBwdWJsaWMgZmxvYXQgZ2V0U3RhdGUoaW50IGFjdGlvbiwgSW5wdXRNYXAgbWFwID0gbnVsbClcclxuICAgICAgICB7XHJcbiAgICAgICAgICAgIGlmIChtYXAgPT0gbnVsbClcclxuICAgICAgICAgICAgICAgIG1hcCA9IElucHV0TWFwcGluZ1thY3Rpb25dO1xyXG4gICAgICAgICAgICAvKklucHV0Q29udHJvbGxlciBJQyA9IHRoaXM7XHJcbiAgICAgICAgICAgIGlmIChtYXAuY29udHJvbGxlciAhPSBudWxsKVxyXG4gICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICBJQyA9IG1hcC5jb250cm9sbGVyO1xyXG4gICAgICAgICAgICB9Ki9cclxuICAgICAgICAgICAgc3RyaW5nIFRJRCA9IGlkO1xyXG4gICAgICAgICAgICBpZiAobWFwLmNvbnRyb2xsZXJJRCAhPSBcIlwiKVxyXG4gICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICBUSUQgPSBtYXAuY29udHJvbGxlcklEO1xyXG4gICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICBpZiAoVElEID09IFwiS2V5Ym9hcmRcIilcclxuICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuIGdldEtleWJvYXJkTWFwU3RhdGUobWFwKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBlbHNlIGlmIChUSUQgPT0gXCJNb3VzZVwiKVxyXG4gICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gZ2V0TW91c2VNYXBTdGF0ZShtYXApO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIGVsc2VcclxuICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuIGdldEdhbWVwYWRNYXBTdGF0ZShtYXApO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIHJldHVybiAwO1xyXG4gICAgICAgIH1cclxuICAgICAgICBwdWJsaWMgYm9vbCBnZXRQcmVzc2VkKGludCBhY3Rpb24sIElucHV0TWFwIG1hcCA9IG51bGwpXHJcbiAgICAgICAge1xyXG4gICAgICAgICAgICByZXR1cm4gZ2V0U3RhdGUoYWN0aW9uLCBtYXApID49IDAuN2Y7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHB1YmxpYyBJbnB1dE1hcCBGaW5kQW55UHJlc3NlZEdhbWVQYWRJbnB1dCgpXHJcbiAgICAgICAge1xyXG4gICAgICAgICAgICBJbnB1dE1hcCByZXQgPSBuZXcgSW5wdXRNYXAoKTtcclxuICAgICAgICAgICAgTGlzdDxHYW1lUGFkPiBMID0gR2FtZVBhZE1hbmFnZXIuX3RoaXMuYWN0aXZlR2FtZXBhZHM7XHJcbiAgICAgICAgICAgIEwuRm9yRWFjaCgoZ2xvYmFsOjpTeXN0ZW0uQWN0aW9uPGdsb2JhbDo6Q2lybm9HYW1lLkdhbWVQYWQ+KShHID0+XHJcbiAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgIGlmIChyZXQubWFwID09IC0xKVxyXG4gICAgICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgICAgIHJldC5jb250cm9sbGVySUQgPSBHLmlkO1xyXG4gICAgICAgICAgICAgICAgICAgIEdhbWVQYWRCdXR0b25bXSBHQiA9IFN5c3RlbS5MaW5xLkVudW1lcmFibGUuV2hlcmU8Z2xvYmFsOjpDaXJub0dhbWUuR2FtZVBhZEJ1dHRvbj4oRy5idXR0b25zLChnbG9iYWw6OlN5c3RlbS5GdW5jPGdsb2JhbDo6Q2lybm9HYW1lLkdhbWVQYWRCdXR0b24sIGJvb2w+KShCID0+IEIucHJlc3NlZCkpLlRvQXJyYXkoKTtcclxuICAgICAgICAgICAgICAgICAgICBpZiAoR0IuTGVuZ3RoID4gMClcclxuICAgICAgICAgICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHJldC5heGlzID0gZmFsc2U7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIEdhbWVQYWRCdXR0b24gdG1wID0gR0JbMF07XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHJldC5tYXAgPSBuZXcgTGlzdDxHYW1lUGFkQnV0dG9uPihHLmJ1dHRvbnMpLkluZGV4T2YodG1wKTtcclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgZWxzZVxyXG4gICAgICAgICAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgaW50IGkgPSAwO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB3aGlsZSAoaSA8IEcuYXhlcy5MZW5ndGggJiYgcmV0Lm1hcCA9PSAtMSlcclxuICAgICAgICAgICAgICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKE1hdGguQWJzKEcuYXhlc1tpXSkgPiAwLjcgJiYgTWF0aC5BYnMoRy5heGVzW2ldKSA8IDIuMClcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXQuYXhpcyA9IHRydWU7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0Lm1hcCA9IGk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKEcuYXhlc1tpXSA8IDApXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXQubmFtZSA9IFwiYW50aVwiO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXQuYW50aW1hcCA9IGk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgaSsrO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9XHJcbikgICAgICAgICAgICAgICAgKTtcclxuICAgICAgICAgICAgaWYgKHJldC5tYXAgIT0gLTEpXHJcbiAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgIHJldHVybiByZXQ7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgcmV0dXJuIG51bGw7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHB1YmxpYyBzdHJpbmcgZ2V0TWFwQ29udHJvbGxlcklEKElucHV0TWFwIG1hcClcclxuICAgICAgICB7XHJcbiAgICAgICAgICAgIGlmIChtYXAuY29udHJvbGxlcklEICE9IFwiXCIpXHJcbiAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgIHJldHVybiBtYXAuY29udHJvbGxlcklEO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIGVsc2VcclxuICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuIGlkO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHB1YmxpYyBzdHJpbmcgZ2V0TWFwQ29udHJvbGxlcklEKGludCBhY3Rpb24pXHJcbiAgICAgICAge1xyXG4gICAgICAgICAgICByZXR1cm4gZ2V0TWFwQ29udHJvbGxlcklEKElucHV0TWFwcGluZ1thY3Rpb25dKTtcclxuICAgICAgICB9XHJcbiAgICAgICAgcHJvdGVjdGVkIGZsb2F0IGdldEdhbWVwYWRNYXBTdGF0ZShJbnB1dE1hcCBtYXApXHJcbiAgICAgICAge1xyXG4gICAgICAgICAgICBzdHJpbmcgVElEID0gaWQ7XHJcbiAgICAgICAgICAgIGlmIChtYXAuY29udHJvbGxlcklEICE9IFwiXCIpXHJcbiAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgIFRJRCA9IG1hcC5jb250cm9sbGVySUQ7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgR2FtZVBhZCBQID0gR2FtZVBhZE1hbmFnZXIuX3RoaXMuR2V0UGFkKFRJRCk7XHJcbiAgICAgICAgICAgIGlmIChQID09IG51bGwgfHwgIVAuY29ubmVjdGVkKVxyXG4gICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gMDtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBpZiAoIW1hcC5heGlzKVxyXG4gICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICBpZiAoUC5idXR0b25zW21hcC5tYXBdLnByZXNzZWQpXHJcbiAgICAgICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIDE7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICBlbHNlIGlmIChtYXAuYW50aW1hcCA+PSAwICYmIFAuYnV0dG9uc1ttYXAuYW50aW1hcF0ucHJlc3NlZClcclxuICAgICAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgICAgICByZXR1cm4gLTE7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gMDtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBlbHNlXHJcbiAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgIHJldHVybiAoZmxvYXQpUC5heGVzW21hcC5tYXBdO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHByb3RlY3RlZCBmbG9hdCBnZXRLZXlib2FyZE1hcFN0YXRlKElucHV0TWFwIG1hcClcclxuICAgICAgICB7XHJcbiAgICAgICAgICAgIExpc3Q8aW50PiBMID0gS2V5Ym9hcmRNYW5hZ2VyLl90aGlzLlByZXNzZWRCdXR0b25zO1xyXG4gICAgICAgICAgICBpZiAoTC5Db250YWlucyhtYXAubWFwKSlcclxuICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuIDFmO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIGVsc2UgaWYgKEwuQ29udGFpbnMobWFwLmFudGltYXApKVxyXG4gICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gLTFmO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIHJldHVybiAwO1xyXG4gICAgICAgIH1cclxuICAgICAgICBwcm90ZWN0ZWQgZmxvYXQgZ2V0TW91c2VNYXBTdGF0ZShJbnB1dE1hcCBtYXApXHJcbiAgICAgICAge1xyXG4gICAgICAgICAgICBMaXN0PGludD4gTCA9IEtleWJvYXJkTWFuYWdlci5fdGhpcy5QcmVzc2VkTW91c2VCdXR0b25zO1xyXG4gICAgICAgICAgICBpZiAoTC5Db250YWlucyhtYXAubWFwKSlcclxuICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuIDFmO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIGVsc2UgaWYgKEwuQ29udGFpbnMobWFwLmFudGltYXApKVxyXG4gICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gLTFmO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIHJldHVybiAwO1xyXG4gICAgICAgIH1cclxuXHJcblxyXG4gICAgfVxyXG59XHJcbiIsInVzaW5nIFN5c3RlbTtcclxudXNpbmcgU3lzdGVtLkNvbGxlY3Rpb25zLkdlbmVyaWM7XHJcbnVzaW5nIFN5c3RlbS5MaW5xO1xyXG51c2luZyBTeXN0ZW0uVGV4dDtcclxudXNpbmcgU3lzdGVtLlRocmVhZGluZy5UYXNrcztcclxuXHJcbm5hbWVzcGFjZSBDaXJub0dhbWVcclxue1xyXG4gICAgcHVibGljIGNsYXNzIElucHV0Q29udHJvbGxlck1hbmFnZXJcclxuICAgIHtcclxuICAgICAgICBwdWJsaWMgTGlzdDxJbnB1dENvbnRyb2xsZXI+IENvbnRyb2xsZXJzO1xyXG4gICAgICAgIHB1YmxpYyBzdGF0aWMgSW5wdXRDb250cm9sbGVyTWFuYWdlciBfdGhpc1xyXG4gICAgICAgIHtcclxuICAgICAgICAgICAgZ2V0XHJcbiAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgIGlmIChfX3RoaXMgPT0gbnVsbClcclxuICAgICAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgICAgICBfX3RoaXMgPSBuZXcgSW5wdXRDb250cm9sbGVyTWFuYWdlcigpO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgcmV0dXJuIF9fdGhpcztcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuICAgICAgICBwdWJsaWMgc3RhdGljIHZvaWQgSW5pdCgpXHJcbiAgICAgICAge1xyXG4gICAgICAgICAgICBpZiAoX190aGlzID09IG51bGwpXHJcbiAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgIF9fdGhpcyA9IG5ldyBJbnB1dENvbnRyb2xsZXJNYW5hZ2VyKCk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcbiAgICAgICAgcHJvdGVjdGVkIHN0YXRpYyBJbnB1dENvbnRyb2xsZXJNYW5hZ2VyIF9fdGhpcztcclxuICAgICAgICBwcm90ZWN0ZWQgSW5wdXRDb250cm9sbGVyTWFuYWdlcigpXHJcbiAgICAgICAge1xyXG4gICAgICAgICAgICBDb250cm9sbGVycyA9IG5ldyBMaXN0PElucHV0Q29udHJvbGxlcj4oKTtcclxuXHJcbiAgICAgICAgICAgIENvbnRyb2xsZXJzLkFkZChuZXcgSW5wdXRDb250cm9sbGVyKCkpO1xyXG4gICAgICAgICAgICBMaXN0PEdhbWVQYWQ+IGdhbWVwYWRzID0gR2FtZVBhZE1hbmFnZXIuX3RoaXMuYWN0aXZlR2FtZXBhZHM7XHJcbiAgICAgICAgICAgIGludCBpID0gMDtcclxuICAgICAgICAgICAgd2hpbGUgKGkgPCBnYW1lcGFkcy5Db3VudClcclxuICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgQ29udHJvbGxlcnMuQWRkKG5ldyBJbnB1dENvbnRyb2xsZXIoZ2FtZXBhZHNbaV0uaWQpKTtcclxuICAgICAgICAgICAgICAgIGkrKztcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuICAgIH1cclxufVxyXG4iLCJ1c2luZyBTeXN0ZW07XHJcbnVzaW5nIFN5c3RlbS5Db2xsZWN0aW9ucy5HZW5lcmljO1xyXG51c2luZyBTeXN0ZW0uTGlucTtcclxudXNpbmcgU3lzdGVtLlRleHQ7XHJcbnVzaW5nIFN5c3RlbS5UaHJlYWRpbmcuVGFza3M7XHJcblxyXG5uYW1lc3BhY2UgQ2lybm9HYW1lXHJcbntcclxuICAgIHB1YmxpYyBjbGFzcyBJbnB1dE1hcFxyXG4gICAge1xyXG4gICAgICAgIHB1YmxpYyBpbnQgbWFwID0gLTE7XHJcbiAgICAgICAgcHVibGljIGludCBhbnRpbWFwID0gLTE7XHJcbiAgICAgICAgcHVibGljIHN0cmluZyBuYW1lID0gXCJcIjtcclxuICAgICAgICBwdWJsaWMgYm9vbCBheGlzID0gZmFsc2U7XHJcbiAgICAgICAgLy9wdWJsaWMgSW5wdXRDb250cm9sbGVyIGNvbnRyb2xsZXI7XHJcbiAgICAgICAgcHVibGljIHN0cmluZyBjb250cm9sbGVySUQgPSBcIlwiO1xyXG4gICAgICAgIHB1YmxpYyBJbnB1dE1hcCgpXHJcbiAgICAgICAge1xyXG4gICAgICAgICAgICBheGlzID0gZmFsc2U7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHB1YmxpYyBJbnB1dE1hcChpbnQgbWFwLCBpbnQgYW50aW1hcCA9IC0xLCBib29sIGF4aXMgPSBmYWxzZSlcclxuICAgICAgICB7XHJcbiAgICAgICAgICAgIHRoaXMubWFwID0gbWFwO1xyXG4gICAgICAgICAgICB0aGlzLmFudGltYXAgPSBhbnRpbWFwO1xyXG4gICAgICAgICAgICB0aGlzLmF4aXMgPSBheGlzO1xyXG4gICAgICAgIH1cclxuICAgIH1cclxufVxyXG4iLCJ1c2luZyBTeXN0ZW07XHJcbnVzaW5nIFN5c3RlbS5Db2xsZWN0aW9ucy5HZW5lcmljO1xyXG51c2luZyBTeXN0ZW0uTGlucTtcclxudXNpbmcgU3lzdGVtLlRleHQ7XHJcbnVzaW5nIFN5c3RlbS5UaHJlYWRpbmcuVGFza3M7XHJcbnVzaW5nIEJyaWRnZTtcclxudXNpbmcgQnJpZGdlLkh0bWw1O1xyXG5cclxubmFtZXNwYWNlIENpcm5vR2FtZVxyXG57XHJcbiAgICBwdWJsaWMgY2xhc3MgSlNPTkFyY2hpdmVcclxuICAgIHtcclxuICAgICAgICAvL3VzZSBGb2xkZXIySlNPTiB0byBjcmVhdGUgdGhlIGFyY2hpdmUuXHJcblxyXG4gICAgICAgIC8vcHVibGljIHN0cmluZyBBcmNoaXZlO1xyXG4gICAgICAgIHB1YmxpYyBEaWN0aW9uYXJ5PHN0cmluZywgc3RyaW5nPiBEYXRhID0gbmV3IERpY3Rpb25hcnk8c3RyaW5nLCBzdHJpbmc+KCk7XHJcbiAgICAgICAgcHVibGljIERpY3Rpb25hcnk8c3RyaW5nLCBIVE1MSW1hZ2VFbGVtZW50PiBJbWFnZXMgPSBuZXcgRGljdGlvbmFyeTxzdHJpbmcsIEhUTUxJbWFnZUVsZW1lbnQ+KCk7XHJcbiAgICAgICAgcHVibGljIEpTT05BcmNoaXZlKHN0cmluZyBBcmNoaXZlKVxyXG4gICAgICAgIHtcclxuICAgICAgICAgICAgLy90aGlzLkFyY2hpdmUgPSBBcmNoaXZlO1xyXG4gICAgICAgICAgICBzdHJpbmdbXVtdIEQgPSBTY3JpcHQuV3JpdGU8ZHluYW1pYz4oXCJKU09OLnBhcnNlKEFyY2hpdmUpXCIpO1xyXG4gICAgICAgICAgICB2YXIgaSA9IDA7XHJcbiAgICAgICAgICAgIHZhciBsbiA9IEQuTGVuZ3RoO1xyXG4gICAgICAgICAgICB3aGlsZSAoaSA8IGxuKVxyXG4gICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICB2YXIgQSA9IERbaSsrXTtcclxuICAgICAgICAgICAgICAgIERhdGFbQVswXS5Ub0xvd2VyKCldID0gQVsxXTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuICAgICAgICBwdWJsaWMgc3RhdGljIHZvaWQgT3BlbihzdHJpbmcgQXJjaGl2ZUZpbGUsIEFjdGlvbjxKU09OQXJjaGl2ZT4gYWN0aW9uKVxyXG4gICAgICAgIHtcclxuICAgICAgICAgICAgWE1MSHR0cFJlcXVlc3QgWEhSID0gbmV3IFhNTEh0dHBSZXF1ZXN0KCk7XHJcbiAgICAgICAgICAgIC8vWEhSLlJlc3BvbnNlVHlwZSA9IFhNTEh0dHBSZXF1ZXN0UmVzcG9uc2VUeXBlLkJsb2I7XHJcbiAgICAgICAgICAgIFhIUi5PbkxvYWQgPSBFdnQgPT5cclxuICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgYWN0aW9uKG5ldyBKU09OQXJjaGl2ZShYSFIuUmVzcG9uc2VUZXh0KSk7XHJcbiAgICAgICAgICAgIH07XHJcbiAgICAgICAgICAgIFhIUi5PcGVuKFwiR0VUXCIsIEFyY2hpdmVGaWxlLCBmYWxzZSk7XHJcbiAgICAgICAgICAgIFhIUi5TZW5kKCk7XHJcbiAgICAgICAgICAgIC8vaWYgKFhIUi5TdGF0dXMpXHJcblxyXG4gICAgICAgIH1cclxuICAgICAgICBwdWJsaWMgdm9pZCBQcmVsb2FkSW1hZ2VzKEFjdGlvbiBhY3Rpb24sIGludCBkZWxheSA9IDEwMClcclxuICAgICAgICB7XHJcbiAgICAgICAgICAgIHZhciBLID0gU3lzdGVtLkxpbnEuRW51bWVyYWJsZS5Ub0FycmF5PHN0cmluZz4oRGF0YS5LZXlzKTtcclxuICAgICAgICAgICAgdmFyIGkgPSAwO1xyXG4gICAgICAgICAgICB3aGlsZSAoaSA8IERhdGEuQ291bnQpXHJcbiAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgIHZhciBBID0gS1tpXTtcclxuICAgICAgICAgICAgICAgIEdldEltYWdlKEEpO1xyXG4gICAgICAgICAgICAgICAgaSsrO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIEdsb2JhbC5TZXRUaW1lb3V0KChnbG9iYWw6OlN5c3RlbS5BY3Rpb24pYWN0aW9uLCBkZWxheSk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHB1YmxpYyBzdHJpbmcgR2V0RGF0YShzdHJpbmcgZmlsZSlcclxuICAgICAgICB7XHJcbiAgICAgICAgICAgIHZhciBmID0gZmlsZS5Ub0xvd2VyKCk7XHJcbiAgICAgICAgICAgIGlmIChEYXRhLkNvbnRhaW5zS2V5KGYpKVxyXG4gICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gRGF0YVtmXTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICByZXR1cm4gbnVsbDtcclxuICAgICAgICB9XHJcbiAgICAgICAgcHVibGljIEhUTUxJbWFnZUVsZW1lbnQgR2V0SW1hZ2Uoc3RyaW5nIGZpbGUpXHJcbiAgICAgICAge1xyXG4gICAgICAgICAgICB2YXIgZiA9IGZpbGUuVG9Mb3dlcigpO1xyXG4gICAgICAgICAgICBpZiAoSW1hZ2VzLkNvbnRhaW5zS2V5KGYpKVxyXG4gICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gSW1hZ2VzW2ZdO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIHZhciBEID0gR2V0RGF0YShmKTtcclxuICAgICAgICAgICAgaWYgKEQgPT0gbnVsbClcclxuICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuIG51bGw7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgdmFyIHJldCA9IG5ldyBIVE1MSW1hZ2VFbGVtZW50KCk7XHJcbiAgICAgICAgICAgIHJldC5PbkxvYWQgPSBFID0+XHJcbiAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgIEhlbHBlci5Mb2coXCJsb2FkZWQgXCIgKyBmICsgXCIgZnJvbSBKU09OIVwiKTtcclxuICAgICAgICAgICAgfTtcclxuICAgICAgICAgICAgcmV0LlNyYyA9IFwiZGF0YTppbWFnZS9wbmc7YmFzZTY0LFwiICsgRDtcclxuICAgICAgICAgICAgSW1hZ2VzW2ZdID0gcmV0O1xyXG4gICAgICAgICAgICByZXR1cm4gcmV0O1xyXG4gICAgICAgIH1cclxuICAgIH1cclxufVxyXG4iLCJ1c2luZyBTeXN0ZW07XHJcbnVzaW5nIFN5c3RlbS5Db2xsZWN0aW9ucy5HZW5lcmljO1xyXG51c2luZyBTeXN0ZW0uTGlucTtcclxudXNpbmcgU3lzdGVtLlRleHQ7XHJcbnVzaW5nIFN5c3RlbS5UaHJlYWRpbmcuVGFza3M7XHJcbnVzaW5nIEJyaWRnZTtcclxudXNpbmcgQnJpZGdlLkh0bWw1O1xyXG5cclxubmFtZXNwYWNlIENpcm5vR2FtZVxyXG57XHJcbiAgICBwdWJsaWMgY2xhc3MgS2V5Ym9hcmRNYW5hZ2VyXHJcbiAgICB7XHJcbiAgICAgICAgcHVibGljIExpc3Q8aW50PiBQcmVzc2VkQnV0dG9ucztcclxuICAgICAgICBwdWJsaWMgTGlzdDxpbnQ+IFRhcHBlZEJ1dHRvbnM7XHJcblxyXG4gICAgICAgIHB1YmxpYyBMaXN0PGludD4gUHJlc3NlZE1vdXNlQnV0dG9ucztcclxuICAgICAgICBwdWJsaWMgTGlzdDxpbnQ+IFRhcHBlZE1vdXNlQnV0dG9ucztcclxuXHJcbiAgICAgICAgcHVibGljIFZlY3RvcjIgTW91c2VQb3NpdGlvbiA9IG5ldyBWZWN0b3IyKCk7XHJcbiAgICAgICAgcHVibGljIFZlY3RvcjIgQ01vdXNlID0gbmV3IFZlY3RvcjIoKTtcclxuXHJcbiAgICAgICAgcHVibGljIHN0YXRpYyBLZXlib2FyZE1hbmFnZXIgX3RoaXNcclxuICAgICAgICB7XHJcbiAgICAgICAgICAgIGdldFxyXG4gICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICBpZiAoX190aGlzID09IG51bGwpXHJcbiAgICAgICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICAgICAgX190aGlzID0gbmV3IEtleWJvYXJkTWFuYWdlcigpO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgcmV0dXJuIF9fdGhpcztcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuICAgICAgICBwdWJsaWMgc3RhdGljIHZvaWQgSW5pdCgpXHJcbiAgICAgICAge1xyXG4gICAgICAgICAgICBpZiAoX190aGlzID09IG51bGwpXHJcbiAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgIF9fdGhpcyA9IG5ldyBLZXlib2FyZE1hbmFnZXIoKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuICAgICAgICBwcm90ZWN0ZWQgc3RhdGljIEtleWJvYXJkTWFuYWdlciBfX3RoaXM7XHJcbiAgICAgICAgcHJvdGVjdGVkIEtleWJvYXJkTWFuYWdlcigpXHJcbiAgICAgICAge1xyXG4gICAgICAgICAgICBQcmVzc2VkQnV0dG9ucyA9IG5ldyBMaXN0PGludD4oKTtcclxuICAgICAgICAgICAgVGFwcGVkQnV0dG9ucyA9IG5ldyBMaXN0PGludD4oKTtcclxuICAgICAgICAgICAgUHJlc3NlZE1vdXNlQnV0dG9ucyA9IG5ldyBMaXN0PGludD4oKTtcclxuICAgICAgICAgICAgVGFwcGVkTW91c2VCdXR0b25zID0gbmV3IExpc3Q8aW50PigpO1xyXG5cclxuICAgICAgICAgICAgUHJlZGljYXRlPEtleWJvYXJkRXZlbnQ+IEtEID0gb25LZXlEb3duO1xyXG4gICAgICAgICAgICBTY3JpcHQuV3JpdGUoXCJkb2N1bWVudC5vbmtleWRvd24gPSBLRDtcIik7XHJcblxyXG4gICAgICAgICAgICBBY3Rpb248S2V5Ym9hcmRFdmVudD4gS1UgPSBvbktleVVwO1xyXG4gICAgICAgICAgICBTY3JpcHQuV3JpdGUoXCJkb2N1bWVudC5vbmtleXVwID0gS1U7XCIpO1xyXG5cclxuICAgICAgICAgICAgQWN0aW9uPE1vdXNlRXZlbnQ+IE1NID0gb25Nb3VzZU1vdmU7XHJcbiAgICAgICAgICAgIFNjcmlwdC5Xcml0ZShcImRvY3VtZW50Lm9ubW91c2Vtb3ZlID0gTU07XCIpO1xyXG5cclxuICAgICAgICAgICAgUHJlZGljYXRlPE1vdXNlRXZlbnQ+IE1EID0gb25Nb3VzZURvd247XHJcbiAgICAgICAgICAgIFNjcmlwdC5Xcml0ZShcImRvY3VtZW50Lm9ubW91c2Vkb3duID0gTUQ7XCIpO1xyXG5cclxuICAgICAgICAgICAgUHJlZGljYXRlPE1vdXNlRXZlbnQ+IE1VID0gb25Nb3VzZVVwO1xyXG4gICAgICAgICAgICBTY3JpcHQuV3JpdGUoXCJkb2N1bWVudC5vbm1vdXNldXAgPSBNVTtcIik7XHJcblxyXG4gICAgICAgICAgICBQcmVkaWNhdGU8TW91c2VFdmVudD4gTkIgPSBOZXZlcmluQm91bmRzO1xyXG4gICAgICAgICAgICBTY3JpcHQuV3JpdGUoXCJkb2N1bWVudC5vbmNvbnRleHRtZW51ID0gTkJcIik7XHJcbiAgICAgICAgfVxyXG5cclxuXHJcbiAgICAgICAgcHVibGljIHN0YXRpYyB2b2lkIFVwZGF0ZSgpXHJcbiAgICAgICAge1xyXG4gICAgICAgICAgICBfX3RoaXMuVGFwcGVkQnV0dG9ucy5DbGVhcigpO1xyXG4gICAgICAgICAgICBfX3RoaXMuVGFwcGVkTW91c2VCdXR0b25zLkNsZWFyKCk7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBwdWJsaWMgc3RhdGljIGJvb2wgTmV2ZXJpbkJvdW5kcyhNb3VzZUV2ZW50IGV2dClcclxuICAgICAgICB7XHJcbiAgICAgICAgICAgIHJldHVybiAhQXBwLlNjcmVlbkJvdW5kcy5jb250YWluc1BvaW50KF90aGlzLkNNb3VzZS5YLCBfdGhpcy5DTW91c2UuWSk7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBwdWJsaWMgc3RhdGljIGJvb2wgb25LZXlEb3duKEtleWJvYXJkRXZlbnQgZXZ0KVxyXG4gICAgICAgIHtcclxuICAgICAgICAgICAgaW50IGtleUNvZGUgPSBldnQuS2V5Q29kZTtcclxuXHJcbiAgICAgICAgICAgIGlmICghX190aGlzLlByZXNzZWRCdXR0b25zLkNvbnRhaW5zKGtleUNvZGUpKVxyXG4gICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICBfX3RoaXMuUHJlc3NlZEJ1dHRvbnMuQWRkKGtleUNvZGUpO1xyXG4gICAgICAgICAgICAgICAgX190aGlzLlRhcHBlZEJ1dHRvbnMuQWRkKGtleUNvZGUpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIGlmICgoa2V5Q29kZSA+PSAzNyAmJiBrZXlDb2RlIDw9IDQwKSB8fCBrZXlDb2RlID09IDMyIHx8IGtleUNvZGUgPT0gMTEyKVxyXG4gICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgcmV0dXJuIHRydWU7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBwdWJsaWMgc3RhdGljIHZvaWQgb25LZXlVcChLZXlib2FyZEV2ZW50IGV2dClcclxuICAgICAgICB7XHJcbiAgICAgICAgICAgIGludCBrZXlDb2RlID0gZXZ0LktleUNvZGU7XHJcblxyXG4gICAgICAgICAgICBpZiAoX190aGlzLlByZXNzZWRCdXR0b25zLkNvbnRhaW5zKGtleUNvZGUpKVxyXG4gICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICBfX3RoaXMuUHJlc3NlZEJ1dHRvbnMuUmVtb3ZlKGtleUNvZGUpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHB1YmxpYyBzdGF0aWMgYm9vbCBvbk1vdXNlRG93bihNb3VzZUV2ZW50IGV2dClcclxuICAgICAgICB7XHJcbiAgICAgICAgICAgIGludCBidG4gPSBldnQuQnV0dG9uO1xyXG4gICAgICAgICAgICBpZiAoIV9fdGhpcy5QcmVzc2VkTW91c2VCdXR0b25zLkNvbnRhaW5zKGJ0bikpXHJcbiAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgIF9fdGhpcy5QcmVzc2VkTW91c2VCdXR0b25zLkFkZChidG4pO1xyXG4gICAgICAgICAgICAgICAgX190aGlzLlRhcHBlZE1vdXNlQnV0dG9ucy5BZGQoYnRuKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICByZXR1cm4gYnRuIDwgMTtcclxuICAgICAgICB9XHJcbiAgICAgICAgcHVibGljIHN0YXRpYyBib29sIG9uTW91c2VVcChNb3VzZUV2ZW50IGV2dClcclxuICAgICAgICB7XHJcbiAgICAgICAgICAgIGludCBidG4gPSBldnQuQnV0dG9uO1xyXG4gICAgICAgICAgICBpZiAoX190aGlzLlByZXNzZWRNb3VzZUJ1dHRvbnMuQ29udGFpbnMoYnRuKSlcclxuICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgX190aGlzLlByZXNzZWRNb3VzZUJ1dHRvbnMuUmVtb3ZlKGJ0bik7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgcmV0dXJuIGJ0biA8IDE7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHB1YmxpYyBzdGF0aWMgdm9pZCBvbk1vdXNlTW92ZShNb3VzZUV2ZW50IGV2dClcclxuICAgICAgICB7XHJcbiAgICAgICAgICAgIF90aGlzLk1vdXNlUG9zaXRpb24gPSBuZXcgVmVjdG9yMihldnQuQ2xpZW50WCwgZXZ0LkNsaWVudFkpO1xyXG5cclxuICAgICAgICAgICAgLy9mbG9hdCBsZWZ0ID0gZmxvYXQuUGFyc2UoQXBwLkNhbnZhcy5TdHlsZS5MZWZ0LlJlcGxhY2UoXCJweFwiLCBcIlwiKSk7XHJcbiAgICAgICAgICAgIGlmIChBcHAuRGl2LlN0eWxlLkxlZnQuSW5kZXhPZihcInB4XCIpPDApXHJcbiAgICAgICAgICAgICAgICByZXR1cm47XHJcbiAgICAgICAgICAgIGZsb2F0IGxlZnQgPSBmbG9hdC5QYXJzZShBcHAuRGl2LlN0eWxlLkxlZnQuUmVwbGFjZShcInB4XCIsIFwiXCIpKTtcclxuICAgICAgICAgICAgZmxvYXQgeCA9IGV2dC5DbGllbnRYIC0gbGVmdDtcclxuICAgICAgICAgICAgZmxvYXQgeSA9IGV2dC5DbGllbnRZO1xyXG5cclxuICAgICAgICAgICAgLy9mbG9hdCBzY2FsZSA9IChBcHAuQ2FudmFzLldpZHRoICogMS4yNWYpIC8gZmxvYXQuUGFyc2UoQXBwLkNhbnZhcy5TdHlsZS5XaWR0aC5SZXBsYWNlKFwicHhcIiwgXCJcIikpO1xyXG5cclxuICAgICAgICAgICAgLy9mbG9hdCBzY2FsZSA9IChBcHAuQ2FudmFzLldpZHRoKSAvIGZsb2F0LlBhcnNlKEFwcC5DYW52YXMuU3R5bGUuV2lkdGguUmVwbGFjZShcInB4XCIsIFwiXCIpKTtcclxuICAgICAgICAgICAgZmxvYXQgc2NhbGUgPSAoQXBwLkNhbnZhcy5XaWR0aCkgLyBmbG9hdC5QYXJzZShBcHAuRGl2LlN0eWxlLldpZHRoLlJlcGxhY2UoXCJweFwiLCBcIlwiKSk7XHJcbiAgICAgICAgICAgIF90aGlzLkNNb3VzZSA9IG5ldyBWZWN0b3IyKHggKiBzY2FsZSwgeSAqIHNjYWxlKTtcclxuICAgICAgICAgICAgLy9Db25zb2xlLldyaXRlTGluZShcIm14OlwiK190aGlzLkNNb3VzZS54ICsgXCIgbXk6XCIgKyBfdGhpcy5DTW91c2UueSk7XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG59XHJcbiIsInVzaW5nIFN5c3RlbTtcclxudXNpbmcgU3lzdGVtLkNvbGxlY3Rpb25zLkdlbmVyaWM7XHJcbnVzaW5nIFN5c3RlbS5MaW5xO1xyXG51c2luZyBTeXN0ZW0uVGV4dDtcclxudXNpbmcgU3lzdGVtLlRocmVhZGluZy5UYXNrcztcclxuXHJcbm5hbWVzcGFjZSBDaXJub0dhbWVcclxue1xyXG4gICAgcHVibGljIGNsYXNzIE1hcEdlbmVyYXRvclxyXG4gICAge1xyXG4gICAgICAgIHB1YmxpYyBzdGF0aWMgTWFwUm9vbSByb290cm9vbTtcclxuICAgICAgICBwdWJsaWMgc3RhdGljIE1hcFJvb20gZG9vcnJvb207XHJcbiAgICAgICAgcHVibGljIHN0YXRpYyBNYXBSb29tIGtleXJvb207XHJcbiAgICAgICAgcHVibGljIHN0YXRpYyB2b2lkIEdlbmVyYXRlKEdhbWUgZ2FtZSlcclxuICAgICAgICB7XHJcbiAgICAgICAgICAgIHZhciBwbGF5ZXIgPSBnYW1lLnBsYXllcjsvL3BsYXllciBjaGFyYWN0ZXJcclxuICAgICAgICAgICAgdmFyIG1hcCA9IGdhbWUuVE07Ly90aGUgdGlsZW1hcCB0byBnZW5lcmF0ZVxyXG4gICAgICAgICAgICB2YXIgYm91bmRzID0gZ2FtZS5zdGFnZUJvdW5kczsvL3RoZSBib3VuZHMgdG8gc3RheSB3aXRoaW5cclxuXHJcbiAgICAgICAgICAgIC8vTGlzdDxSZWN0YW5nbGU+IHJvb21zID0gbmV3IExpc3Q8UmVjdGFuZ2xlPigpO1xyXG5cclxuICAgICAgICAgICAgdmFyIFggPSAwO1xyXG4gICAgICAgICAgICB2YXIgWSA9IDA7XHJcbiAgICAgICAgICAgIGlmIChNYXRoLlJhbmRvbSgpIDwgMC41KVxyXG4gICAgICAgICAgICAgICAgWCA9IE1hdGguUmFuZG9tKCkgPCAwLjUgPyAtMSA6IDE7XHJcbiAgICAgICAgICAgIGVsc2VcclxuICAgICAgICAgICAgICAgIFkgPSBNYXRoLlJhbmRvbSgpIDwgMC41ID8gLTEgOiAxO1xyXG4gICAgICAgICAgICBUaWxlRGF0YSBUID0gbmV3IFRpbGVEYXRhKCk7XHJcbiAgICAgICAgICAgIFQudGV4dHVyZSA9IDE7XHJcbiAgICAgICAgICAgIFQuZW5hYmxlZCA9IHRydWU7XHJcbiAgICAgICAgICAgIFQudmlzaWJsZSA9IHRydWU7XHJcbiAgICAgICAgICAgIFQubWFwID0gbWFwO1xyXG4gICAgICAgICAgICBULnNvbGlkID0gdHJ1ZTtcclxuICAgICAgICAgICAgVC50b3BTb2xpZCA9IHRydWU7XHJcbiAgICAgICAgICAgIC8vbWFwLlNldEFsbChUKTtcclxuICAgICAgICAgICAgcGxheWVyLnggPSAoYm91bmRzLmxlZnQgKyBib3VuZHMucmlnaHQpIC8gMjtcclxuICAgICAgICAgICAgcGxheWVyLnkgPSAoYm91bmRzLnRvcCArIGJvdW5kcy5ib3R0b20pIC8gMjtcclxuICAgICAgICAgICAgLy9wYXRoTWluZXIoZ2FtZSxtYXAuY29sdW1ucy8yLG1hcC5yb3dzLzIsWCxZLDIwKTtcclxuICAgICAgICAgICAgcGF0aE1pbmVyKGdhbWUsIG1hcC5jb2x1bW5zIC8gMiwgbWFwLnJvd3MgLyA0LCBYLCBZLCAzMCk7XHJcblxyXG4gICAgICAgICAgICB2YXIgViA9IEZpbmRFbXB0eVNwYWNlKGdhbWUpO1xyXG4gICAgICAgICAgICBpZiAoViAhPSBudWxsKVxyXG4gICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICBwbGF5ZXIueCA9IFYuWDtcclxuICAgICAgICAgICAgICAgIHBsYXllci55ID0gVi5ZO1xyXG4gICAgICAgICAgICAgICAgSGVscGVyLkxvZyhcInNwYXduaW5nIGF0OlwiICsgKGludClWLlggKyBcIixcIiArIChpbnQpVi5ZKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBlbHNlXHJcbiAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgIEhlbHBlci5Mb2coXCJjYW5ub3QgbG9jYXRlIGEgc3Bhd24gcG9pbnQuLi5cIik7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcbiAgICAgICAgcHVibGljIHN0YXRpYyB2b2lkIEJveHlHZW5lcmF0ZShHYW1lIGdhbWUpXHJcbiAgICAgICAge1xyXG4gICAgICAgICAgICBIZWxwZXIuTG9nKFwiYm94eSBnZW5lcmF0ZVwiKTtcclxuICAgICAgICAgICAgdmFyIHBsYXllciA9IGdhbWUucGxheWVyOy8vcGxheWVyIGNoYXJhY3RlclxyXG4gICAgICAgICAgICB2YXIgbWFwID0gZ2FtZS5UTTsvL3RoZSB0aWxlbWFwIHRvIGdlbmVyYXRlXHJcbiAgICAgICAgICAgIHZhciBib3VuZHMgPSBnYW1lLnN0YWdlQm91bmRzOy8vdGhlIGJvdW5kcyB0byBzdGF5IHdpdGhpblxyXG4gICAgICAgICAgICBNYXBSb29tLlBsYWNlZFJvb21zID0gbmV3IExpc3Q8TWFwUm9vbT4oKTtcclxuICAgICAgICAgICAgTWFwUm9vbS5PcGVuUm9vbXMgPSBuZXcgTGlzdDxNYXBSb29tPigpO1xyXG5cclxuICAgICAgICAgICAgdmFyIFNYID0gbWFwLmNvbHVtbnMgLyAyO1xyXG4gICAgICAgICAgICB2YXIgU1kgPSBtYXAucm93cyAvIDM7XHJcbiAgICAgICAgICAgIHZhciByb290ID0gbmV3IE1hcFJvb20oKTtcclxuICAgICAgICAgICAgcm9vdC5TWCA9IFNYO1xyXG4gICAgICAgICAgICByb290LlNZID0gU1k7XHJcbiAgICAgICAgICAgIHJvb3QuRVggPSBTWCArIDYgKyAoaW50KShNYXRoLlJhbmRvbSgpICogMTApO1xyXG4gICAgICAgICAgICByb290LkVZID0gU1kgKyA2ICsgKGludCkoTWF0aC5SYW5kb20oKSAqIDEwKTtcclxuXHJcbiAgICAgICAgICAgIHJvb3QuZ2FtZSA9IGdhbWU7XHJcbiAgICAgICAgICAgIHJvb3Ryb29tID0gcm9vdDtcclxuXHJcbiAgICAgICAgICAgIC8vdmFyIHJvb210b3RhbCA9IDEyKyhpbnQpKE1hdGguUmFuZG9tKCkgKiAxMCk7XHJcbiAgICAgICAgICAgIC8vdmFyIHJvb210b3RhbCA9IDE2ICsgKGludCkoTWF0aC5SYW5kb20oKSAqIDE2KTtcclxuXHJcbiAgICAgICAgICAgIC8vdmFyIHJvb21NaW5pbXVtID0gMTY7XHJcbiAgICAgICAgICAgIHZhciByb29tTWluaW11bSA9IDEwK01hdGguTWluKGdhbWUubGV2ZWwsNCk7XHJcbiAgICAgICAgICAgIHZhciByb29tdG90YWwgPSByb29tTWluaW11bSArIChpbnQpKE1hdGguUmFuZG9tKCkgKiAocm9vbU1pbmltdW0pKTtcclxuICAgICAgICAgICAgLy92YXIgcm9vbXMgPSAwO1xyXG5cclxuICAgICAgICAgICAgdmFyIGF0dGVtcHRzID0gNDAwO1xyXG4gICAgICAgICAgICB2YXIgUiA9IHJvb3Q7XHJcbiAgICAgICAgICAgIGlmICghcm9vdC5QbGFjZUFuZEV4cGFuZCgpKVxyXG4gICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICBIZWxwZXIuTG9nKFwiQ291bGRuJ3QgZ2VuZXJhdGUgcm9vdCByb29tLlwiKTtcclxuICAgICAgICAgICAgICAgIHJldHVybjtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB3aGlsZSAoTWFwUm9vbS5PcGVuUm9vbXMuQ291bnQgPCByb29tdG90YWwgJiYgYXR0ZW1wdHMgPiAwKVxyXG4gICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICB2YXIgTCA9IENpcm5vR2FtZS5IZWxwZXJFeHRlbnNpb25zLlBpY2s8Z2xvYmFsOjpDaXJub0dhbWUuTWFwUm9vbT4oTWFwUm9vbS5GaW5kVmFsaWRVbnBsYWNlZFJvb21zKCkpO1xyXG4gICAgICAgICAgICAgICAgaWYgKEwuUGxhY2VBbmRFeHBhbmQoKSlcclxuICAgICAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgICAgICAvL3Jvb21zKys7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICBhdHRlbXB0cy0tO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIHZhciBSUiA9IGdhbWUuc3RhZ2VCb3VuZHMgLSBnYW1lLlRNLnBvc2l0aW9uO1xyXG4gICAgICAgICAgICBSUi53aWR0aCAtPSBnYW1lLlRNLnRpbGVzaXplO1xyXG4gICAgICAgICAgICBSUi5oZWlnaHQgLT0gZ2FtZS5UTS50aWxlc2l6ZTtcclxuICAgICAgICAgICAgZ2FtZS5UTS5EcmF3UmVjdChSUik7XHJcbiAgICAgICAgICAgIGdhbWUuVE0uQXBwbHlCcmVha2FibGUoKTtcclxuICAgICAgICAgICAgdmFyIHNlY3JldHMgPSBNYXRoLlJhbmRvbSgpPDAuMyA/IDEgOiAwO1xyXG4gICAgICAgICAgICBpZiAoc2VjcmV0cyA+IDAgJiYgTWF0aC5SYW5kb20oKSA8IDAuMylcclxuICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgc2VjcmV0cysrO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIHdoaWxlIChzZWNyZXRzID4gMClcclxuICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgdmFyIEwgPSBDaXJub0dhbWUuSGVscGVyRXh0ZW5zaW9ucy5QaWNrPGdsb2JhbDo6Q2lybm9HYW1lLk1hcFJvb20+KE1hcFJvb20uRmluZFZhbGlkVW5wbGFjZWRSb29tcygpKTtcclxuICAgICAgICAgICAgICAgIGlmIChMLlBsYWNlQW5kRXhwYW5kKCkpXHJcbiAgICAgICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICAgICAgTC5NYWtlU2VjcmV0KCk7XHJcbiAgICAgICAgICAgICAgICAgICAgdmFyIGxldmVyID0gQXR0ZW1wdENyZWF0ZUxldmVyKGdhbWUsIEwpO1xyXG4gICAgICAgICAgICAgICAgICAgIGdhbWUuQWRkRW50aXR5KGxldmVyKTtcclxuICAgICAgICAgICAgICAgICAgICBIZWxwZXIuTG9nKFwiUGxhY2VkIHNlY3JldCByb29tIGF0OlwiICsgTC5TWCArIFwiLFwiICsgTC5TWSk7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICBzZWNyZXRzLS07XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgdmFyIFYgPSBGaW5kRW1wdHlTcGFjZShnYW1lKTtcclxuICAgICAgICAgICAga2V5cm9vbSA9IG51bGw7XHJcbiAgICAgICAgICAgIGlmIChWICE9IG51bGwpXHJcbiAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgIC8qcGxheWVyLnggPSBWLlg7XHJcbiAgICAgICAgICAgICAgICBwbGF5ZXIueSA9IFYuWTsqL1xyXG4gICAgICAgICAgICAgICAgZ2FtZS5Eb29yLlBvc2l0aW9uLkNvcHlGcm9tKFYpO1xyXG4gICAgICAgICAgICAgICAgZ2FtZS5Eb29yLkRyb3BUb0dyb3VuZCgpO1xyXG4gICAgICAgICAgICAgICAgZG9vcnJvb20gPSBNYXBSb29tLkZpbmRSb29tKGdhbWUuRG9vci5Qb3NpdGlvbik7XHJcbiAgICAgICAgICAgICAgICBpZiAoZG9vcnJvb20gPT0gbnVsbClcclxuICAgICAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgICAgICBIZWxwZXIuTG9nKFwiRG9vciByb29tIGNvdWxkIG5vdCBiZSBkZXRlcm1pbmVkLi4uXCIpO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgXHJcbiAgICAgICAgICAgICAgICB2YXIgUEMgPSAoUGxheWVyQ2hhcmFjdGVyKXBsYXllcjtcclxuICAgICAgICAgICAgICAgIC8vUEMuTW92ZVRvTmV3U3Bhd24oVik7XHJcbiAgICAgICAgICAgICAgICBQQy5Nb3ZlVG9OZXdTcGF3bihnYW1lLkRvb3IuUG9zaXRpb24pO1xyXG4gICAgICAgICAgICAgICAgSGVscGVyLkxvZyhcInNwYXduaW5nIGF0OlwiICsgKGludClWLlggKyBcIixcIiArIChpbnQpVi5ZKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBlbHNlXHJcbiAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgIEhlbHBlci5Mb2coXCJjYW5ub3QgbG9jYXRlIGEgc3Bhd24gcG9pbnQuLi5cIik7XHJcbiAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgfVxyXG4gICAgICAgIHB1YmxpYyBzdGF0aWMgUm9vbU9wZW5pbmdMZXZlciBBdHRlbXB0Q3JlYXRlTGV2ZXIoR2FtZSBnYW1lLE1hcFJvb20gVGFyZ2V0KVxyXG4gICAgICAgIHtcclxuICAgICAgICAgICAgdmFyIGkgPSAwO1xyXG4gICAgICAgICAgICB3aGlsZSAoaSA8IDIwKVxyXG4gICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICB2YXIgbGV2ZXIgPSBSb29tT3BlbmluZ0xldmVyLkZpbmRBbmRQbGFjZU9uV2FsbChnYW1lLCBNYXBSb29tLkZpbmRBbnlFbXB0eVNwb3QoKSwgVGFyZ2V0KTtcclxuICAgICAgICAgICAgICAgIGlmIChsZXZlciAhPSBudWxsKVxyXG4gICAgICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBsZXZlcjtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICByZXR1cm4gbnVsbDtcclxuICAgICAgICB9XHJcbiAgICAgICAgcHVibGljIHN0YXRpYyBWZWN0b3IyIEZpbmRFbXB0eVNwYWNlKEdhbWUgZ2FtZSlcclxuICAgICAgICB7XHJcbiAgICAgICAgICAgIHZhciBtYXAgPSBnYW1lLlRNO1xyXG4gICAgICAgICAgICB2YXIgYm91bmRzID0gZ2FtZS5zdGFnZUJvdW5kczsvL3RoZSBib3VuZHMgdG8gc3RheSB3aXRoaW5cclxuICAgICAgICAgICAgdmFyIGkgPSAwO1xyXG4gICAgICAgICAgICB2YXIgcmV0ID0gbmV3IFZlY3RvcjIoKTtcclxuICAgICAgICAgICAgdmFyIHRtcCA9IG5ldyBWZWN0b3IyKCk7XHJcbiAgICAgICAgICAgIHdoaWxlIChpIDwgMjAwMClcclxuICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgcmV0LlggPSAoZmxvYXQpKGJvdW5kcy5sZWZ0ICsgKE1hdGguUmFuZG9tKCkgKiAoYm91bmRzLndpZHRoIC0gbWFwLnRpbGVzaXplKSkpO1xyXG4gICAgICAgICAgICAgICAgcmV0LlkgPSAoZmxvYXQpKGJvdW5kcy50b3AgKyAoTWF0aC5SYW5kb20oKSAqIChib3VuZHMuYm90dG9tIC0gbWFwLnRpbGVzaXplKSkpO1xyXG4gICAgICAgICAgICAgICAgaWYgKCFtYXAuQ2hlY2tGb3JUaWxlKHJldCkudmlzaWJsZSlcclxuICAgICAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgICAgICB0bXAuWCA9IHJldC5YO1xyXG4gICAgICAgICAgICAgICAgICAgIHRtcC5ZID0gcmV0LlkgLSBtYXAudGlsZXNpemU7XHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKCFtYXAuQ2hlY2tGb3JUaWxlKHJldCkudmlzaWJsZSlcclxuICAgICAgICAgICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiByZXQ7XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgaSsrO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIC8vcmV0dXJuIHJldDtcclxuICAgICAgICAgICAgcmV0dXJuIG51bGw7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIC8vY3JlYXRlIHR1bm5lbHMgaGFsbHdheXMgZXRjXHJcbiAgICAgICAgcHJpdmF0ZSBzdGF0aWMgdm9pZCBwYXRoTWluZXIoR2FtZSBnYW1lLCBpbnQgWCwgaW50IFksIGludCBYZGlyLCBpbnQgWURpciwgaW50IGxpbWl0KVxyXG4gICAgICAgIHtcclxuICAgICAgICAgICAgaWYgKGxpbWl0IDw9IDApXHJcbiAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgIHJldHVybjtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB2YXIgcGxheWVyID0gZ2FtZS5wbGF5ZXI7Ly9wbGF5ZXIgY2hhcmFjdGVyXHJcbiAgICAgICAgICAgIHZhciBtYXAgPSBnYW1lLlRNOy8vdGhlIHRpbGVtYXAgdG8gZ2VuZXJhdGVcclxuICAgICAgICAgICAgdmFyIGJvdW5kcyA9IGdhbWUuc3RhZ2VCb3VuZHM7Ly90aGUgYm91bmRzIHRvIHN0YXkgd2l0aGluXHJcblxyXG4gICAgICAgICAgICB2YXIgZGlzdCA9IDA7XHJcbiAgICAgICAgICAgIHZhciBwb3cgPSAxO1xyXG4gICAgICAgICAgICBpZiAoWURpciAhPSAwKVxyXG4gICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICBwb3cgPSAyO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIHdoaWxlIChkaXN0IDwgNyAmJiBNYXRoLlJhbmRvbSgpIDwgKE1hdGguUG93KDAuOTUsIHBvdykpKVxyXG4gICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICBYICs9IFhkaXI7XHJcbiAgICAgICAgICAgICAgICBZICs9IFlEaXI7XHJcbiAgICAgICAgICAgICAgICBFcmFzZShtYXAsIFgsIFksIDMpO1xyXG4gICAgICAgICAgICAgICAgaWYgKE1hdGguUmFuZG9tKCkgPCAoMC4yICogcG93KSlcclxuICAgICAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgICAgICBpZiAoWGRpciA9PSAwKVxyXG4gICAgICAgICAgICAgICAgICAgICAgICBYICs9IE1hdGguUmFuZG9tKCkgPCAwLjUgPyAxIDogLTE7XHJcbiAgICAgICAgICAgICAgICAgICAgZWxzZVxyXG4gICAgICAgICAgICAgICAgICAgICAgICBZICs9IE1hdGguUmFuZG9tKCkgPCAwLjUgPyAxIDogLTE7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICBlbHNlIGlmIChNYXRoLlJhbmRvbSgpIDwgKDAuMDIgKiBwb3cpICYmIGxpbWl0ID4gNClcclxuICAgICAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgICAgICBsaW1pdCA9IGxpbWl0IC8gMjtcclxuICAgICAgICAgICAgICAgICAgICB2YXIgWEQgPSBNYXRoLlJhbmRvbSgpIDwgMC41ID8gWURpciA6IC1ZRGlyO1xyXG4gICAgICAgICAgICAgICAgICAgIHZhciBZRCA9IE1hdGguUmFuZG9tKCkgPCAwLjUgPyBYZGlyIDogLVhkaXI7XHJcbiAgICAgICAgICAgICAgICAgICAgcGF0aE1pbmVyKGdhbWUsIFgsIFksIFhELCBZRCwgbGltaXQpO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIGxpbWl0LS07XHJcbiAgICAgICAgICAgIGlmIChsaW1pdCA+IDEpXHJcbiAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgIHJvb21NaW5lcihnYW1lLCBYLCBZLCBYZGlyLCBZRGlyLCBsaW1pdCk7XHJcbiAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgfVxyXG4gICAgICAgIHByaXZhdGUgc3RhdGljIHZvaWQgcm9vbU1pbmVyKEdhbWUgZ2FtZSwgaW50IFgsIGludCBZLCBpbnQgWGRpciwgaW50IFlEaXIsIGludCBsaW1pdClcclxuICAgICAgICB7XHJcbiAgICAgICAgICAgIGlmIChsaW1pdCA8PSAwKVxyXG4gICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICByZXR1cm47XHJcbiAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgIHZhciBTWiA9IChpbnQpKDQgKyAoTWF0aC5SYW5kb20oKSAqIDQpKTtcclxuICAgICAgICAgICAgWCArPSBYZGlyICogKFNaIC8gMik7XHJcbiAgICAgICAgICAgIFkgKz0gWURpciAqIChTWiAvIDIpO1xyXG5cclxuICAgICAgICAgICAgLy9FcmFzZShnYW1lLlRNLCBYLCBZLCAoU1ogKiAyKSsyKTtcclxuICAgICAgICAgICAgRXJhc2VBbmRSYW5kbyhnYW1lLlRNLCBYLCBZLCAoU1ogKiAyKSArIDIpO1xyXG5cclxuICAgICAgICAgICAgdmFyIFhEID0gWGRpcjtcclxuICAgICAgICAgICAgdmFyIFlEID0gWURpcjtcclxuICAgICAgICAgICAgaWYgKE1hdGguUmFuZG9tKCkgPCAwLjIwIHx8IChZRCAhPSAwICYmIE1hdGguUmFuZG9tKCkgPCAwLjY1KSB8fCBZRCA8IDApXHJcbiAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgIFhEID0gTWF0aC5SYW5kb20oKSA8IDAuNSA/IFlEaXIgOiAtWURpcjtcclxuICAgICAgICAgICAgICAgIFlEID0gTWF0aC5SYW5kb20oKSA8IDAuNSA/IFhkaXIgOiAtWGRpcjtcclxuICAgICAgICAgICAgICAgIGlmIChZRCA8IDApXHJcbiAgICAgICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICAgICAgWUQgPSAtWUQ7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgWGRpciA9IFhEO1xyXG4gICAgICAgICAgICBZRGlyID0gWUQ7XHJcblxyXG4gICAgICAgICAgICBYICs9IFhkaXIgKiAoU1ogLyAyKTtcclxuICAgICAgICAgICAgWSArPSBZRGlyICogKFNaIC8gMik7XHJcblxyXG4gICAgICAgICAgICBsaW1pdC0tO1xyXG4gICAgICAgICAgICBwYXRoTWluZXIoZ2FtZSwgWCwgWSwgWGRpciwgWURpciwgbGltaXQpO1xyXG4gICAgICAgIH1cclxuICAgICAgICBwcml2YXRlIHN0YXRpYyBUaWxlRGF0YSBibGFuayA9IG5ldyBUaWxlRGF0YSgpO1xyXG4gICAgICAgIHByaXZhdGUgc3RhdGljIHZvaWQgRXJhc2UoVGlsZU1hcCBUTSwgaW50IGNvbHVtbiwgaW50IHJvdywgaW50IHNpemUpXHJcbiAgICAgICAge1xyXG4gICAgICAgICAgICBUTS5DbGVhclJlY3QoY29sdW1uIC0gKHNpemUgLyAyKSwgcm93IC0gKHNpemUgLyAyKSwgKHNpemUpLCAoc2l6ZSkpO1xyXG4gICAgICAgIH1cclxuICAgICAgICBwcml2YXRlIHN0YXRpYyB2b2lkIEVyYXNlQW5kUmFuZG8oVGlsZU1hcCBUTSwgaW50IGNvbHVtbiwgaW50IHJvdywgaW50IHNpemUpXHJcbiAgICAgICAge1xyXG4gICAgICAgICAgICB2YXIgU1ggPSBjb2x1bW4gLSAoc2l6ZSAvIDIpO1xyXG4gICAgICAgICAgICB2YXIgU1kgPSByb3cgLSAoc2l6ZSAvIDIpO1xyXG4gICAgICAgICAgICBUTS5DbGVhclJlY3QoU1gsIFNZLCAoc2l6ZSksIChzaXplKSk7XHJcbiAgICAgICAgICAgIFRNLl9HZW5SZWN0KFNYLCBTWSwgU1ggKyAoc2l6ZSksIFNZICsgKHNpemUpKTtcclxuICAgICAgICB9XHJcbiAgICAgICAgLy9wcml2YXRlIHZvaWQgR3Jvd1Jvb21zKExpc3Q8UmVjdGFuZ2xlPiByb29tcywpXHJcbiAgICB9XHJcbn1cclxuIiwidXNpbmcgU3lzdGVtO1xyXG51c2luZyBTeXN0ZW0uQ29sbGVjdGlvbnMuR2VuZXJpYztcclxudXNpbmcgU3lzdGVtLkxpbnE7XHJcbnVzaW5nIFN5c3RlbS5UZXh0O1xyXG51c2luZyBTeXN0ZW0uVGhyZWFkaW5nLlRhc2tzO1xyXG5cclxubmFtZXNwYWNlIENpcm5vR2FtZVxyXG57XHJcbiAgICBwdWJsaWMgY2xhc3MgTWFwUm9vbVxyXG4gICAge1xyXG4gICAgICAgIHB1YmxpYyBpbnQgU1g7XHJcbiAgICAgICAgcHVibGljIGludCBTWTtcclxuICAgICAgICBwdWJsaWMgaW50IEVYO1xyXG4gICAgICAgIHB1YmxpYyBpbnQgRVk7XHJcblxyXG4gICAgICAgIHB1YmxpYyBib29sIHBsYWNlZCA9IGZhbHNlO1xyXG4gICAgICAgIHB1YmxpYyBib29sIHNlY3JldCA9IGZhbHNlO1xyXG5cclxuICAgICAgICAvL3B1YmxpYyBQb2ludFtdIEV4aXRzO1xyXG4gICAgICAgIHB1YmxpYyBMaXN0PE1hcFJvb20+IEV4aXRSb29tcyA9IG5ldyBMaXN0PE1hcFJvb20+KCk7Ly9jb25uZWN0ZWQgcm9vbXNcclxuXHJcbiAgICAgICAgcHVibGljIHN0YXRpYyBMaXN0PE1hcFJvb20+IFBsYWNlZFJvb21zID0gbmV3IExpc3Q8TWFwUm9vbT4oKTtcclxuICAgICAgICBwdWJsaWMgc3RhdGljIExpc3Q8TWFwUm9vbT4gT3BlblJvb21zID0gbmV3IExpc3Q8TWFwUm9vbT4oKTtcclxuICAgICAgICBwdWJsaWMgTWFwUm9vbSBwYXJlbnQ7XHJcbiAgICAgICAgcHVibGljIENoZXN0W10gZ29sZGNoZXN0cyA9IG5ldyBDaGVzdFswXTtcclxuXHJcbiAgICAgICAgcHVibGljIEdhbWUgZ2FtZTtcclxuICAgICAgICBwdWJsaWMgYm9vbCBJc1ZhbGlkKClcclxuICAgICAgICB7XHJcbiAgICAgICAgICAgIHZhciBtYXAgPSBnYW1lLlRNO1xyXG4gICAgICAgICAgICBpZiAoU1ggPj0gMCAmJiBTWSA+PSAwICYmIEVYIDwgbWFwLmNvbHVtbnMgJiYgRVkgPCBtYXAucm93cylcclxuICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgLy9pbiBib3VuZHNcclxuICAgICAgICAgICAgICAgIHJldHVybiB0cnVlO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIHJldHVybiBmYWxzZTtcclxuICAgICAgICB9XHJcbiAgICAgICAgcHVibGljIGJvb2wgQ2FuQmVQbGFjZWQoKVxyXG4gICAgICAgIHtcclxuICAgICAgICAgICAgdmFyIG1hcCA9IGdhbWUuVE07XHJcbiAgICAgICAgICAgIGlmIChJc1ZhbGlkKCkpXHJcbiAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgIGlmIChtYXAuSXNSZWN0U29saWQoU1gsIFNZLCBFWCwgRVkpKS8vcm9vbSBoYXMgbm8gaW50ZXJzZWN0aW5nIGdhcHMuXHJcbiAgICAgICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHRydWU7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xyXG4gICAgICAgIH1cclxuICAgICAgICBwcml2YXRlIHZvaWQgR2VuZXJhdGVBZGphY2VudFJvb21zKClcclxuICAgICAgICB7XHJcbiAgICAgICAgICAgIHZhciBNID0gR2VuZXJhdGVBZGphY2VudFJvb20oLTEsIDApO1xyXG4gICAgICAgICAgICBpZiAoTSAhPSBudWxsKVxyXG4gICAgICAgICAgICAgICAgRXhpdFJvb21zLkFkZChNKTtcclxuICAgICAgICAgICAgTSA9IEdlbmVyYXRlQWRqYWNlbnRSb29tKDEsIDApO1xyXG4gICAgICAgICAgICBpZiAoTSAhPSBudWxsKVxyXG4gICAgICAgICAgICAgICAgRXhpdFJvb21zLkFkZChNKTtcclxuICAgICAgICAgICAgaWYgKE1hdGguUmFuZG9tKCkgPCAwLjUpXHJcbiAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgIE0gPSBHZW5lcmF0ZUFkamFjZW50Um9vbSgwLCAtMSk7XHJcbiAgICAgICAgICAgICAgICBpZiAoTSAhPSBudWxsKVxyXG4gICAgICAgICAgICAgICAgICAgIEV4aXRSb29tcy5BZGQoTSk7XHJcbiAgICAgICAgICAgICAgICBNID0gR2VuZXJhdGVBZGphY2VudFJvb20oMCwgMSk7XHJcbiAgICAgICAgICAgICAgICBpZiAoTSAhPSBudWxsKVxyXG4gICAgICAgICAgICAgICAgICAgIEV4aXRSb29tcy5BZGQoTSk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcbiAgICAgICAgcHJpdmF0ZSBNYXBSb29tIEdlbmVyYXRlQWRqYWNlbnRSb29tKGludCBYZGlyLCBpbnQgWWRpcilcclxuICAgICAgICB7XHJcbiAgICAgICAgICAgIC8qdmFyIG1pbiA9IDY7XHJcbiAgICAgICAgICAgIHZhciBtYXggPSAxODsqL1xyXG4gICAgICAgICAgICB2YXIgbWluID0gNTtcclxuICAgICAgICAgICAgdmFyIG1heCA9IDEzO1xyXG4gICAgICAgICAgICB2YXIgZGlmID0gKG1heCAtIG1pbik7XHJcbiAgICAgICAgICAgIGludCBXID0gKGludCkobWluICsgKE1hdGguUmFuZG9tKCkgKiBkaWYpKTtcclxuXHJcbiAgICAgICAgICAgIC8vbWluICs9IDE7XHJcbiAgICAgICAgICAgIG1pbiAtPSAxO1xyXG4gICAgICAgICAgICBtYXggLT0gMztcclxuICAgICAgICAgICAgZGlmID0gKG1heCAtIG1pbik7XHJcbiAgICAgICAgICAgIGludCBIID0gKGludCkobWluICsgKE1hdGguUmFuZG9tKCkgKiBkaWYpKTtcclxuXHJcbiAgICAgICAgICAgIHZhciBYID0gLTE7XHJcbiAgICAgICAgICAgIHZhciBZID0gLTE7XHJcbiAgICAgICAgICAgIGlmIChYZGlyICE9IDApXHJcbiAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgIFkgPSAoaW50KShTWSArIChNYXRoLlJhbmRvbSgpICogKEVZIC0gU1kpKSk7XHJcbiAgICAgICAgICAgICAgICBpZiAoWGRpciA8IDApXHJcbiAgICAgICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICAgICAgWCA9IFNYIC0gVztcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIGVsc2VcclxuICAgICAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgICAgICBYID0gRVg7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgZWxzZSBpZiAoWWRpciAhPSAwKVxyXG4gICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICBYID0gKGludCkoU1ggKyBNYXRoLlJhbmRvbSgpICogKChFWCAtIFNYKSkpO1xyXG4gICAgICAgICAgICAgICAgaWYgKFlkaXIgPCAwKVxyXG4gICAgICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgICAgIFkgPSBTWSAtIEg7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICBlbHNlXHJcbiAgICAgICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICAgICAgWSA9IEVZO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICBpZiAoWCA+PSAwICYmIFkgPj0gMClcclxuICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgdmFyIE0gPSBuZXcgTWFwUm9vbSgpO1xyXG4gICAgICAgICAgICAgICAgTS5TWCA9IFg7XHJcbiAgICAgICAgICAgICAgICBNLlNZID0gWTtcclxuICAgICAgICAgICAgICAgIE0uRVggPSBYICsgVztcclxuICAgICAgICAgICAgICAgIE0uRVkgPSBZICsgSDtcclxuICAgICAgICAgICAgICAgIE0ucGFyZW50ID0gdGhpcztcclxuICAgICAgICAgICAgICAgIE0uZ2FtZSA9IGdhbWU7XHJcbiAgICAgICAgICAgICAgICBpZiAoTS5DYW5CZVBsYWNlZCgpKVxyXG4gICAgICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBNO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIHJldHVybiBudWxsO1xyXG4gICAgICAgIH1cclxuICAgICAgICBwdWJsaWMgc3RhdGljIExpc3Q8TWFwUm9vbT4gRmluZFZhbGlkVW5wbGFjZWRSb29tcygpXHJcbiAgICAgICAge1xyXG4gICAgICAgICAgICB2YXIgTCA9IG5ldyBMaXN0PE1hcFJvb20+KCk7XHJcbiAgICAgICAgICAgIHZhciBpID0gMDtcclxuICAgICAgICAgICAgdmFyIGxuID0gT3BlblJvb21zLkNvdW50O1xyXG4gICAgICAgICAgICB3aGlsZSAoaSA8IGxuKVxyXG4gICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICB2YXIgUCA9IE9wZW5Sb29tc1tpXTtcclxuICAgICAgICAgICAgICAgIEwuQWRkUmFuZ2UoU3lzdGVtLkxpbnEuRW51bWVyYWJsZS5XaGVyZTxnbG9iYWw6OkNpcm5vR2FtZS5NYXBSb29tPihQLkV4aXRSb29tcywoZ2xvYmFsOjpTeXN0ZW0uRnVuYzxnbG9iYWw6OkNpcm5vR2FtZS5NYXBSb29tLCBib29sPikoRiA9PiBGLkNhbkJlUGxhY2VkKCkgJiYgIUYucGxhY2VkKSkpO1xyXG4gICAgICAgICAgICAgICAgaSsrO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIHJldHVybiBMO1xyXG4gICAgICAgIH1cclxuICAgICAgICBwdWJsaWMgYm9vbCBDb250YWluc1RpbGUoaW50IFgsaW50IFkpXHJcbiAgICAgICAge1xyXG4gICAgICAgICAgICByZXR1cm4gWCA+PSBTWCAmJiBZID49IFNZICYmIFggPCBFWCAmJiBZIDwgRVk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHB1YmxpYyBib29sIENvbnRhaW5zUG9zaXRpb24oVmVjdG9yMiBWKVxyXG4gICAgICAgIHtcclxuICAgICAgICAgICAgaW50IFggPSAoaW50KSgoVi5YIC0gZ2FtZS5UTS5wb3NpdGlvbi5YKSAvIGdhbWUuVE0udGlsZXNpemUpO1xyXG4gICAgICAgICAgICBpbnQgWSA9IChpbnQpKChWLlkgLSBnYW1lLlRNLnBvc2l0aW9uLlkpIC8gZ2FtZS5UTS50aWxlc2l6ZSk7XHJcbiAgICAgICAgICAgIHJldHVybiBYID49IFNYICYmIFkgPj0gU1kgJiYgWCA8IEVYICYmIFkgPCBFWTtcclxuICAgICAgICB9XHJcbiAgICAgICAgcHVibGljIHN0YXRpYyBNYXBSb29tIEZpbmRSb29tKFZlY3RvcjIgVilcclxuICAgICAgICB7XHJcbiAgICAgICAgICAgIHZhciBMID0gU3lzdGVtLkxpbnEuRW51bWVyYWJsZS5XaGVyZTxnbG9iYWw6OkNpcm5vR2FtZS5NYXBSb29tPihPcGVuUm9vbXMsKGdsb2JhbDo6U3lzdGVtLkZ1bmM8Z2xvYmFsOjpDaXJub0dhbWUuTWFwUm9vbSwgYm9vbD4pKFIgPT4gUi5Db250YWluc1Bvc2l0aW9uKFYpKSkuVG9BcnJheSgpO1xyXG4gICAgICAgICAgICBpZiAoTC5MZW5ndGggPiAwKVxyXG4gICAgICAgICAgICAgICAgcmV0dXJuIExbMF07XHJcbiAgICAgICAgICAgIHJldHVybiBudWxsO1xyXG4gICAgICAgIH1cclxuICAgICAgICAvLy8gPHN1bW1hcnk+XHJcbiAgICAgICAgLy8vIGNsZWFycyBvdXQgdGhlIHJvb20ncyBhcmVhLCBhbmQgYXR0ZW1wdHMgdG8gZ2VuZXJhdGUgZXhpdHJvb21zLlxyXG4gICAgICAgIC8vLyBJZiB0aGUgcm9vbSBpcyBpbnZhbGlkIGl0IGRvZXMgbm90aGluZywgYW5kIHJlbW92ZXMgaXRzZWxmIGZyb20gaXQncyBwYXJlbnQgbGlzdC5cclxuICAgICAgICAvLy8gPC9zdW1tYXJ5PlxyXG4gICAgICAgIC8vLyA8cmV0dXJucz5yZXR1cm5zIHRydWUgaWYgaXQgd2FzIHZhbGlkIGFuZCB3YXMgcGxhY2VkLjwvcmV0dXJucz5cclxuICAgICAgICBwdWJsaWMgYm9vbCBQbGFjZUFuZEV4cGFuZCgpXHJcbiAgICAgICAge1xyXG4gICAgICAgICAgICBpZiAoRXhpdFJvb21zLkNvdW50IDwgMSAmJiAhcGxhY2VkICYmIENhbkJlUGxhY2VkKCkpXHJcbiAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgIFBsYWNlKCk7XHJcbiAgICAgICAgICAgICAgICBpZiAocGxhY2VkKVxyXG4gICAgICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgICAgIEdlbmVyYXRlQWRqYWNlbnRSb29tcygpO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgcmV0dXJuIHBsYWNlZDtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBlbHNlIGlmICghcGxhY2VkKVxyXG4gICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICBpZiAocGFyZW50ICE9IG51bGwpXHJcbiAgICAgICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKENpcm5vR2FtZS5IZWxwZXJFeHRlbnNpb25zLkNvbnRhaW5zQjxnbG9iYWw6OkNpcm5vR2FtZS5NYXBSb29tPihwYXJlbnQuRXhpdFJvb21zLHRoaXMpKVxyXG4gICAgICAgICAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgcGFyZW50LkV4aXRSb29tcy5SZW1vdmUodGhpcyk7XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIHJldHVybiBmYWxzZTtcclxuICAgICAgICB9XHJcbiAgICAgICAgdm9pZCBHZW5lcmF0ZUdvbGRDaGVzdHMoKVxyXG4gICAgICAgIHtcclxuICAgICAgICAgICAgdmFyIGxvY2tlZCA9ICFPcGVuUm9vbXMuQ29udGFpbnModGhpcyk7XHJcblxyXG4gICAgICAgICAgICB2YXIgViA9IEZpbmRFbXB0eVNwb3QoKTtcclxuICAgICAgICAgICAgdmFyIGNoZXN0ID0gbmV3IENoZXN0KGdhbWUpO1xyXG5DaXJub0dhbWUuSGVscGVyRXh0ZW5zaW9ucy5QdXNoPGdsb2JhbDo6Q2lybm9HYW1lLkNoZXN0PiggICAgICAgICAgICBnb2xkY2hlc3RzLGNoZXN0KTtcclxuICAgICAgICAgICAgY2hlc3QuRm9yY2VMb2NrZWQgPSBsb2NrZWQ7XHJcbiAgICAgICAgICAgIGNoZXN0LlBvc2l0aW9uLkNvcHlGcm9tKFYpO1xyXG4gICAgICAgICAgICBjaGVzdC5Hb2xkaWZ5KCk7XHJcbiAgICAgICAgICAgIGdhbWUuQWRkRW50aXR5KGNoZXN0KTtcclxuXHJcbiAgICAgICAgICAgIFZlY3RvcjIgVjIgPSBGaW5kRW1wdHlTcG90KCk7XHJcbiAgICAgICAgICAgIHZhciBhdHRlbXB0cyA9IDA7XHJcbiAgICAgICAgICAgIHdoaWxlIChhdHRlbXB0cysrIDwgNSAmJiAoVjIgPT0gbnVsbCB8fCBNYXRoLkFicyhWMi5YIC0gVi5YKSA8IDE2KSkgeyBWMiA9IEZpbmRFbXB0eVNwb3QoKTsgfVxyXG5cclxuICAgICAgICAgICAgaWYgKFYyICE9IG51bGwgJiYgTWF0aC5BYnMoVjIuWCAtIFYuWCkgPiAxNilcclxuICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgY2hlc3QgPSBuZXcgQ2hlc3QoZ2FtZSk7XHJcbkNpcm5vR2FtZS5IZWxwZXJFeHRlbnNpb25zLlB1c2g8Z2xvYmFsOjpDaXJub0dhbWUuQ2hlc3Q+KCAgICAgICAgICAgICAgICBnb2xkY2hlc3RzLGNoZXN0KTtcclxuICAgICAgICAgICAgICAgIGNoZXN0LlBvc2l0aW9uLkNvcHlGcm9tKFYyKTtcclxuICAgICAgICAgICAgICAgIGNoZXN0LkZvcmNlTG9ja2VkID0gbG9ja2VkO1xyXG4gICAgICAgICAgICAgICAgY2hlc3QuR29sZGlmeSgpO1xyXG4gICAgICAgICAgICAgICAgZ2FtZS5BZGRFbnRpdHkoY2hlc3QpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHB1YmxpYyB2b2lkIE5NYWtlU2VjcmV0KCkvL2Jyb2tlblxyXG4gICAgICAgIHtcclxuICAgICAgICAgICAgdmFyIFRNID0gZ2FtZS5UTTtcclxuICAgICAgICAgICAgdmFyIFcgPSBFWCAtIFNYO1xyXG4gICAgICAgICAgICB2YXIgSCA9IEVZIC0gU1k7XHJcbiAgICAgICAgICAgIC8vVE0uRmlsbFJlY3QoU1gsIFNZLCBXLCBIKTtcclxuICAgICAgICAgICAgLy9DbGVhclJvb20oKTtcclxuICAgICAgICAgICAgLy8vVE0uQ2xlYXJSZWN0KFNYLCBTWSwgVywgSCk7XHJcbiAgICAgICAgICAgIFRNLkRyYXdSZWN0KFNYLCBTWSwgVywgSCk7XHJcbiAgICAgICAgICAgIFRNLlNldEJyZWFrYWJsZVJlY3QoU1gsIFNZLCBXLCBILCBmYWxzZSk7XHJcbiAgICAgICAgICAgIFRNLkNsZWFyUmVjdChTWCArIDEsIFNZICsgMSwgVyAtIDIsIEggLSAyKTtcclxuXHJcbiAgICAgICAgICAgIC8vL1RNLl9HZW5SZWN0KFNYLCBTWSwgRVgsIEVZKTtcclxuICAgICAgICAgICAgLy8vL1RNLlNldEJyZWFrYWJsZVJlY3QoU1ggKyAxLCBTWSArIDEsIFcgLSAyLCBIIC0gMiwgdHJ1ZSk7XHJcbiAgICAgICAgICAgIGlmIChPcGVuUm9vbXMuQ29udGFpbnModGhpcykpXHJcbiAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgIE9wZW5Sb29tcy5SZW1vdmUodGhpcyk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgc2VjcmV0ID0gdHJ1ZTtcclxuXHJcbiAgICAgICAgICAgIEdlbmVyYXRlR29sZENoZXN0cygpO1xyXG4gICAgICAgICAgICBcclxuICAgICAgICAgICAgRm9yY2VSZWRyYXcoKTtcclxuICAgICAgICB9XHJcbiAgICAgICAgcHVibGljIHZvaWQgTWFrZVNlY3JldCgpXHJcbiAgICAgICAge1xyXG4gICAgICAgICAgICB2YXIgVE0gPSBnYW1lLlRNO1xyXG4gICAgICAgICAgICB2YXIgVyA9IEVYIC0gU1g7XHJcbiAgICAgICAgICAgIHZhciBIID0gRVkgLSBTWTtcclxuICAgICAgICAgICAgVE0uRmlsbFJlY3QoU1gsIFNZLCBXLCBIKTtcclxuICAgICAgICAgICAgVE0uU2V0QnJlYWthYmxlUmVjdChTWCwgU1ksIFcsIEgsZmFsc2UpO1xyXG4gICAgICAgICAgICBUTS5TZXRCcmVha2FibGVSZWN0KFNYKzEsIFNZKzEsIFctMiwgSC0yLCB0cnVlKTtcclxuICAgICAgICAgICAgaWYgKE9wZW5Sb29tcy5Db250YWlucyh0aGlzKSlcclxuICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgT3BlblJvb21zLlJlbW92ZSh0aGlzKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBzZWNyZXQgPSB0cnVlO1xyXG4gICAgICAgIH1cclxuICAgICAgICBwdWJsaWMgdm9pZCBOVW5sZWFzaFNlY3JldCgpLy9icm9rZW5cclxuICAgICAgICB7XHJcbiAgICAgICAgICAgIHZhciBUTSA9IGdhbWUuVE07XHJcblxyXG4gICAgICAgICAgICBUTS5DbGVhck91dGVyUmVjdChTWCwgU1ksIChFWCAtIFNYKSwgKEVZIC0gU1kpLCBmYWxzZSk7XHJcbiAgICAgICAgICAgIC8vVE0uQ2xlYXJSZWN0KFNYKzEsIFNZKzEsIChFWCAtIFNYKS0yLCAoRVkgLSBTWSktMik7XHJcbiAgICAgICAgICAgIC8vVE0uX0dlblJlY3QoU1gsIFNZLCBFWCwgRVkpO1xyXG5cclxuICAgICAgICAgICAgT3BlblJvb21zLkFkZCh0aGlzKTtcclxuQ2lybm9HYW1lLkhlbHBlckV4dGVuc2lvbnMuRm9yRWFjaDxnbG9iYWw6OkNpcm5vR2FtZS5DaGVzdD4oICAgICAgICAgICAgZ29sZGNoZXN0cywoZ2xvYmFsOjpTeXN0ZW0uQWN0aW9uPGdsb2JhbDo6Q2lybm9HYW1lLkNoZXN0PikoQyA9PiBDLkZvcmNlTG9ja2VkID0gZmFsc2UpKTtcclxuXHJcbiAgICAgICAgICAgIEZvcmNlUmVkcmF3KCk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHB1YmxpYyB2b2lkIFVubGVhc2hTZWNyZXQoKVxyXG4gICAgICAgIHtcclxuICAgICAgICAgICAgdmFyIFRNID0gZ2FtZS5UTTtcclxuXHJcbiAgICAgICAgICAgIFRNLkNsZWFyUmVjdChTWCArIDEsIFNZICsgMSwgKEVYIC0gU1gpIC0gMiwgKEVZIC0gU1kpIC0gMik7XHJcbiAgICAgICAgICAgIFRNLl9HZW5SZWN0KFNYLCBTWSwgRVgsIEVZKTtcclxuXHJcbiAgICAgICAgICAgIE9wZW5Sb29tcy5BZGQodGhpcyk7XHJcblxyXG4gICAgICAgICAgICBHZW5lcmF0ZUdvbGRDaGVzdHMoKTtcclxuICAgICAgICAgICAgRm9yY2VSZWRyYXcoKTtcclxuICAgICAgICB9XHJcbiAgICAgICAgcHVibGljIHZvaWQgQ2xlYXJSb29tKClcclxuICAgICAgICB7XHJcbiAgICAgICAgICAgIHZhciBUTSA9IGdhbWUuVE07XHJcblxyXG4gICAgICAgICAgICBUTS5DbGVhclJlY3QoU1gsIFNZLCBFWCAtIFNYLCBFWSAtIFNZKTtcclxuICAgICAgICB9XHJcbiAgICAgICAgcHVibGljIHZvaWQgR2VuZXJhdGVQbGF0Zm9ybXMoKVxyXG4gICAgICAgIHtcclxuICAgICAgICAgICAgdmFyIFRNID0gZ2FtZS5UTTtcclxuICAgICAgICAgICAgVE0uX0dlblJlY3QoU1gsIFNZLCBFWCwgRVkpO1xyXG4gICAgICAgIH1cclxuICAgICAgICBwcml2YXRlIHZvaWQgUGxhY2UoKVxyXG4gICAgICAgIHtcclxuICAgICAgICAgICAgdmFyIFRNID0gZ2FtZS5UTTtcclxuICAgICAgICAgICAgVE0uQ2xlYXJSZWN0KFNYLCBTWSwgRVggLSBTWCwgRVkgLSBTWSk7XHJcbiAgICAgICAgICAgIFRNLl9HZW5SZWN0KFNYLCBTWSwgRVgsIEVZKTtcclxuXHJcbiAgICAgICAgICAgIFBsYWNlZFJvb21zLkFkZCh0aGlzKTtcclxuICAgICAgICAgICAgT3BlblJvb21zLkFkZCh0aGlzKTtcclxuICAgICAgICAgICAgcGxhY2VkID0gdHJ1ZTtcclxuICAgICAgICB9XHJcbiAgICAgICAgcHVibGljIHZvaWQgQXBwbHlCcmVha2FibGUoKVxyXG4gICAgICAgIHtcclxuICAgICAgICAgICAgdmFyIFRNID0gZ2FtZS5UTTtcclxuICAgICAgICAgICAgVE0uQXBwbHlCcmVha2FibGVSZWN0KFNYIC0gMiwgU1kgLSAyLCAoRVggLSBTWCkgKyA0LCAoRVkgLSBTWSkgKyA0KTtcclxuICAgICAgICB9XHJcbiAgICAgICAgcHVibGljIHZvaWQgRm9yY2VSZWRyYXcoKVxyXG4gICAgICAgIHtcclxuICAgICAgICAgICAgdmFyIFRNID0gZ2FtZS5UTTtcclxuICAgICAgICAgICAgdmFyIFggPSBTWCAtIDI7XHJcbiAgICAgICAgICAgIHZhciBZID0gU1kgLSAyO1xyXG4gICAgICAgICAgICB2YXIgVyA9IChFWCAtIFNYKSs0O1xyXG4gICAgICAgICAgICB2YXIgSCA9IChFWSAtIFNZKSs0O1xyXG4gICAgICAgICAgICBUTS5iZy5DbGVhclJlY3QoKGludClUTS50aWxlc2l6ZSAqIFgsIChpbnQpVE0udGlsZXNpemUgKiBZLCAoaW50KVRNLnRpbGVzaXplICogVywgKGludClUTS50aWxlc2l6ZSAqIEgpO1xyXG5cclxuICAgICAgICAgICAgVE0uUmVkcmF3KFRNLmJnLCBYLCBZLCBXLCBIKTtcclxuICAgICAgICB9XHJcbiAgICAgICAgcHVibGljIHN0YXRpYyBWZWN0b3IyIEZpbmRBbnlFbXB0eVNwb3QoKVxyXG4gICAgICAgIHtcclxuICAgICAgICAgICAgaWYgKE9wZW5Sb29tcy5Db3VudCA8IDEpXHJcbiAgICAgICAgICAgICAgICByZXR1cm4gbnVsbDtcclxuICAgICAgICAgICAgdmFyIGkgPSAwO1xyXG4gICAgICAgICAgICB3aGlsZSAoaSA8IDEwKVxyXG4gICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICB2YXIgcmV0ID0gQ2lybm9HYW1lLkhlbHBlckV4dGVuc2lvbnMuUGljazxnbG9iYWw6OkNpcm5vR2FtZS5NYXBSb29tPihPcGVuUm9vbXMsUk5HKS5GaW5kRW1wdHlTcG90KCk7XHJcbiAgICAgICAgICAgICAgICBpZiAocmV0ICE9IG51bGwpXHJcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHJldDtcclxuICAgICAgICAgICAgICAgIGkrKztcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICByZXR1cm4gbnVsbDtcclxuICAgICAgICB9XHJcbiAgICAgICAgcHJpdmF0ZSBzdGF0aWMgUmFuZG9tIFJORyA9IG5ldyBSYW5kb20oKTtcclxuICAgICAgICBwdWJsaWMgVmVjdG9yMiBGaW5kRW1wdHlTcG90KClcclxuICAgICAgICB7XHJcbiAgICAgICAgICAgIHZhciBXID0gRVggLSBTWDtcclxuICAgICAgICAgICAgdmFyIEggPSBFWSAtIFNZO1xyXG4gICAgICAgICAgICB2YXIgaSA9IDA7XHJcbiAgICAgICAgICAgIHZhciBtYXAgPSBnYW1lLlRNO1xyXG4gICAgICAgICAgICB3aGlsZSAoaSA8IDUwKVxyXG4gICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICB2YXIgWCA9IChpbnQpKFNYICsgTWF0aC5SYW5kb20oKSAqIFcpO1xyXG4gICAgICAgICAgICAgICAgdmFyIFkgPSAoaW50KShTWSArIE1hdGguUmFuZG9tKCkgKiBIKTtcclxuICAgICAgICAgICAgICAgIHZhciBUID0gbWFwLkdldFRpbGUoWCwgWSk7XHJcbiAgICAgICAgICAgICAgICBpZiAoVCAhPSBudWxsICYmICghVC5lbmFibGVkIHx8ICFULnNvbGlkKSlcclxuICAgICAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgICAgICBUID0gbWFwLkdldFRpbGUoWCwgWSAtIDEpO1xyXG4gICAgICAgICAgICAgICAgICAgIGlmIChUICE9IG51bGwgJiYgKCFULmVuYWJsZWQgfHwgIVQuc29saWQpKVxyXG4gICAgICAgICAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIG5ldyBWZWN0b3IyKG1hcC5wb3NpdGlvbi5YICsgKFggKiBtYXAudGlsZXNpemUpLCBtYXAucG9zaXRpb24uWSArIChZICogbWFwLnRpbGVzaXplKSk7XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgaSsrO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIHJldHVybiBudWxsO1xyXG4gICAgICAgIH1cclxuICAgICAgICAvKnByaXZhdGUgc3RhdGljIFRpbGVEYXRhIGJsYW5rID0gbmV3IFRpbGVEYXRhKCk7XHJcbiAgICAgICAgcHJpdmF0ZSBzdGF0aWMgdm9pZCBFcmFzZShUaWxlTWFwIFRNLCBpbnQgY29sdW1uLCBpbnQgcm93LCBpbnQgc2l6ZSlcclxuICAgICAgICB7XHJcbiAgICAgICAgICAgIFRNLkNsZWFyUmVjdChjb2x1bW4gLSAoc2l6ZSAvIDIpLCByb3cgLSAoc2l6ZSAvIDIpLCAoc2l6ZSksIChzaXplKSk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHByaXZhdGUgc3RhdGljIHZvaWQgRXJhc2VBbmRSYW5kbyhUaWxlTWFwIFRNLCBpbnQgY29sdW1uLCBpbnQgcm93LCBpbnQgc2l6ZSlcclxuICAgICAgICB7XHJcbiAgICAgICAgICAgIHZhciBTWCA9IGNvbHVtbiAtIChzaXplIC8gMik7XHJcbiAgICAgICAgICAgIHZhciBTWSA9IHJvdyAtIChzaXplIC8gMik7XHJcbiAgICAgICAgICAgIFRNLkNsZWFyUmVjdChTWCwgU1ksIChzaXplKSwgKHNpemUpKTtcclxuICAgICAgICAgICAgVE0uX0dlblJlY3QoU1gsIFNZLCBTWCArIChzaXplKSwgU1kgKyAoc2l6ZSkpO1xyXG4gICAgICAgIH0qL1xyXG4gICAgfVxyXG59XHJcbiIsInVzaW5nIFN5c3RlbTtcclxudXNpbmcgU3lzdGVtLkNvbGxlY3Rpb25zLkdlbmVyaWM7XHJcbnVzaW5nIFN5c3RlbS5MaW5xO1xyXG51c2luZyBTeXN0ZW0uVGV4dDtcclxudXNpbmcgU3lzdGVtLlRocmVhZGluZy5UYXNrcztcclxuXHJcbm5hbWVzcGFjZSBDaXJub0dhbWVcclxue1xyXG4gICAgcHVibGljIHN0YXRpYyBjbGFzcyBNYXRoSGVscGVyXHJcbiAgICB7XHJcbiAgICAgICAgcHVibGljIGNvbnN0IGZsb2F0IFBJID0gMy4xNDE1OTI2NTM1OWY7XHJcbiAgICAgICAgcHVibGljIGNvbnN0IGZsb2F0IFBJMiA9IDYuMjgzMTg1MzA3MThmO1xyXG5cclxuICAgICAgICBwdWJsaWMgY29uc3QgZmxvYXQgUElPdmVyMiA9IDEuNTcwNzk2MzI2Nzk1ZjtcclxuXHJcbiAgICAgICAgcHVibGljIHN0YXRpYyBmbG9hdCBEaXN0YW5jZUJldHdlZW5Qb2ludHMoVmVjdG9yMiBBLCBWZWN0b3IyIEIpXHJcbiAgICAgICAge1xyXG4gICAgICAgICAgICByZXR1cm4gRGlzdGFuY2VCZXR3ZWVuUG9pbnRzKEEuWCwgQS5ZLCBCLlgsIEIuWSk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHB1YmxpYyBzdGF0aWMgZmxvYXQgRGlzdGFuY2VCZXR3ZWVuUG9pbnRzKGZsb2F0IHgxLCBmbG9hdCB5MSwgZmxvYXQgeDIsIGZsb2F0IHkyKVxyXG4gICAgICAgIHtcclxuICAgICAgICAgICAgcmV0dXJuIChmbG9hdClNYXRoLlNxcnQoKE1hdGguUG93KHgxIC0geDIsIDIpICsgTWF0aC5Qb3coeTEgLSB5MiwgMikpKTtcclxuICAgICAgICB9XHJcbiAgICAgICAgcHVibGljIHN0YXRpYyBmbG9hdCBDbGFtcChmbG9hdCB2YWx1ZSwgZmxvYXQgbWluLCBmbG9hdCBtYXgpXHJcbiAgICAgICAge1xyXG4gICAgICAgICAgICByZXR1cm4gKGZsb2F0KU1hdGguTWluKG1heCwgTWF0aC5NYXgobWluLCB2YWx1ZSkpO1xyXG4gICAgICAgIH1cclxuICAgICAgICBwdWJsaWMgc3RhdGljIGRvdWJsZSBDbGFtcChkb3VibGUgdmFsdWUsIGRvdWJsZSBtaW4gPSAwLCBkb3VibGUgbWF4ID0gMSlcclxuICAgICAgICB7XHJcbiAgICAgICAgICAgIHJldHVybiBNYXRoLk1pbihtYXgsIE1hdGguTWF4KG1pbiwgdmFsdWUpKTtcclxuICAgICAgICB9XHJcbiAgICAgICAgcHVibGljIHN0YXRpYyBmbG9hdCBMZXJwKGZsb2F0IHZhbHVlMSwgZmxvYXQgdmFsdWUyLCBmbG9hdCBhbW91bnQpXHJcbiAgICAgICAge1xyXG4gICAgICAgICAgICByZXR1cm4gdmFsdWUxICsgKCh2YWx1ZTIgLSB2YWx1ZTEpICogYW1vdW50KTtcclxuICAgICAgICB9XHJcbiAgICAgICAgcHVibGljIHN0YXRpYyBmbG9hdCBEZWdyZWVzVG9SYWRpYW5zKGZsb2F0IGRlZ3JlZXMpXHJcbiAgICAgICAge1xyXG4gICAgICAgICAgICByZXR1cm4gZGVncmVlcyAqIDAuMDE3NDUzMjkyNTFmO1xyXG4gICAgICAgIH1cclxuICAgICAgICBwdWJsaWMgc3RhdGljIGZsb2F0IFJhZGlhbnNUb0RlZ3JlZXMoZmxvYXQgcmFkaWFucylcclxuICAgICAgICB7XHJcbiAgICAgICAgICAgIHJldHVybiByYWRpYW5zICogNTcuMjk1Nzc5NTQ1N2Y7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHB1YmxpYyBzdGF0aWMgZmxvYXQgR2V0QW5nbGUoVmVjdG9yMiBhLCBWZWN0b3IyIGIpXHJcbiAgICAgICAge1xyXG4gICAgICAgICAgICBmbG9hdCBhbmdsZSA9IChmbG9hdCkoTWF0aC5BdGFuMihiLlkgLSBhLlksIGIuWCAtIGEuWCkpO1xyXG4gICAgICAgICAgICByZXR1cm4gYW5nbGU7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHB1YmxpYyBzdGF0aWMgZmxvYXQgR2V0QW5nbGUoVmVjdG9yMiBhKVxyXG4gICAgICAgIHtcclxuICAgICAgICAgICAgZmxvYXQgYW5nbGUgPSAoZmxvYXQpKE1hdGguQXRhbjIoYS5ZLCBhLlgpKTtcclxuICAgICAgICAgICAgcmV0dXJuIGFuZ2xlO1xyXG4gICAgICAgIH1cclxuICAgICAgICBwdWJsaWMgc3RhdGljIGZsb2F0IFJvdWdoRGlzdGFuY2VCZXR3ZWVuUG9pbnRzKFZlY3RvcjIgYSwgVmVjdG9yMiBiKVxyXG4gICAgICAgIHtcclxuICAgICAgICAgICAgLy9yZXR1cm4gKGZsb2F0KShNYXRoLkFicyhhLnggLSBiLngpICsgTWF0aC5BYnMoYS55IC0gYi55KSk7XHJcbiAgICAgICAgICAgIHJldHVybiAoYSAtIGIpLlJvdWdoTGVuZ3RoO1xyXG4gICAgICAgIH1cclxuICAgICAgICBwdWJsaWMgc3RhdGljIGZsb2F0IE1hZ25pdHVkZU9mUmVjdGFuZ2xlKFJlY3RhbmdsZSBSKVxyXG4gICAgICAgIHtcclxuICAgICAgICAgICAgcmV0dXJuIFIud2lkdGggKyBSLmhlaWdodDtcclxuICAgICAgICB9XHJcbiAgICAgICAgcHVibGljIHN0YXRpYyBmbG9hdCBXcmFwUmFkaWFucyhmbG9hdCByYWRpYW4pXHJcbiAgICAgICAge1xyXG4gICAgICAgICAgICB3aGlsZSAocmFkaWFuIDwgLVBJKVxyXG4gICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICByYWRpYW4gKz0gUEkyO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIHdoaWxlIChyYWRpYW4gPj0gUEkpXHJcbiAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgIHJhZGlhbiAtPSBQSTI7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgcmV0dXJuIHJhZGlhbjtcclxuICAgICAgICAgICAgLy9yZXR1cm4gcmFkaWFuICUgUEkyO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgcHVibGljIHN0YXRpYyBkb3VibGUgaW5jcmVtZW50VG93YXJkcyhkb3VibGUgY3VycmVudCwgZG91YmxlIGRlc3RpbmF0aW9uLCBkb3VibGUgc3BlZWQpXHJcbiAgICAgICAge1xyXG4gICAgICAgICAgICBpZiAoY3VycmVudCA8IGRlc3RpbmF0aW9uKVxyXG4gICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICBjdXJyZW50ICs9IHNwZWVkO1xyXG4gICAgICAgICAgICAgICAgaWYgKGN1cnJlbnQgPiBkZXN0aW5hdGlvbilcclxuICAgICAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgICAgICBjdXJyZW50ID0gZGVzdGluYXRpb247XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgaWYgKGN1cnJlbnQgPiBkZXN0aW5hdGlvbilcclxuICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgY3VycmVudCAtPSBzcGVlZDtcclxuICAgICAgICAgICAgICAgIGlmIChjdXJyZW50IDwgZGVzdGluYXRpb24pXHJcbiAgICAgICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICAgICAgY3VycmVudCA9IGRlc3RpbmF0aW9uO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIHJldHVybiBjdXJyZW50O1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgcHVibGljIHN0YXRpYyBkb3VibGUgaW5jcmVtZW50VG93YXJkcyhkb3VibGUgY3VycmVudCwgZG91YmxlIGRlc3RpbmF0aW9uLCBkb3VibGUgaW5jc3BlZWQsIGRvdWJsZSBkZWNzcGVlZClcclxuICAgICAgICB7XHJcbiAgICAgICAgICAgIGlmIChjdXJyZW50IDwgZGVzdGluYXRpb24pXHJcbiAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgIGN1cnJlbnQgKz0gaW5jc3BlZWQ7XHJcbiAgICAgICAgICAgICAgICBpZiAoY3VycmVudCA+IGRlc3RpbmF0aW9uKVxyXG4gICAgICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgICAgIGN1cnJlbnQgPSBkZXN0aW5hdGlvbjtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBpZiAoY3VycmVudCA+IGRlc3RpbmF0aW9uKVxyXG4gICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICBjdXJyZW50IC09IGRlY3NwZWVkO1xyXG4gICAgICAgICAgICAgICAgaWYgKGN1cnJlbnQgPCBkZXN0aW5hdGlvbilcclxuICAgICAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgICAgICBjdXJyZW50ID0gZGVzdGluYXRpb247XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgcmV0dXJuIGN1cnJlbnQ7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBwdWJsaWMgc3RhdGljIFZlY3RvcjIgUmFkaWFuVG9WZWN0b3IoZmxvYXQgcmFkaWFuKVxyXG4gICAgICAgIHtcclxuICAgICAgICAgICAgcmV0dXJuIG5ldyBWZWN0b3IyKChmbG9hdClNYXRoLkNvcyhyYWRpYW4pLCAoZmxvYXQpTWF0aC5TaW4ocmFkaWFuKSk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHB1YmxpYyBzdGF0aWMgZG91YmxlIExlcnAoZG91YmxlIEQxLCBkb3VibGUgRDIsIGRvdWJsZSBsZXJwKVxyXG4gICAgICAgIHtcclxuICAgICAgICAgICAgbGVycCA9IE1hdGhIZWxwZXIuQ2xhbXAobGVycCk7XHJcbiAgICAgICAgICAgIHJldHVybiAoRDEgKiAoMSAtIGxlcnApKSArIChEMiAqIGxlcnApO1xyXG4gICAgICAgIH1cclxuICAgICAgICBwdWJsaWMgc3RhdGljIGJvb2wgV2l0aGluKGRvdWJsZSB2YWwsIGRvdWJsZSBtaW4sIGRvdWJsZSBtYXgpXHJcbiAgICAgICAge1xyXG4gICAgICAgICAgICByZXR1cm4gdmFsID49IG1pbiAmJiB2YWwgPD0gbWF4O1xyXG4gICAgICAgIH1cclxuICAgICAgICBwdWJsaWMgc3RhdGljIGRvdWJsZSBNZWFuKHBhcmFtcyBkb3VibGVbXSB2YWwpXHJcbiAgICAgICAge1xyXG4gICAgICAgICAgICBkb3VibGUgcmV0ID0gMDtcclxuICAgICAgICAgICAgaW50IGkgPSAwO1xyXG4gICAgICAgICAgICB3aGlsZSAoaSA8IHZhbC5MZW5ndGgpXHJcbiAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgIHJldCArPSB2YWxbaV07XHJcbiAgICAgICAgICAgICAgICBpKys7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgcmV0IC89IHZhbC5MZW5ndGg7XHJcbiAgICAgICAgICAgIHJldHVybiByZXQ7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHB1YmxpYyBzdGF0aWMgZG91YmxlIERlY2VsZXJhdGUoZG91YmxlIG1vbWVudHVtLCBkb3VibGUgZGVjZWxlcmF0aW9uKVxyXG4gICAgICAgIHtcclxuICAgICAgICAgICAgdmFyIGRpciA9IG1vbWVudHVtID49IDA7XHJcbiAgICAgICAgICAgIG1vbWVudHVtID0gKGRpciA/IG1vbWVudHVtIDogLW1vbWVudHVtKSAtIGRlY2VsZXJhdGlvbjtcclxuICAgICAgICAgICAgaWYgKG1vbWVudHVtIDwgMClcclxuICAgICAgICAgICAgICAgIHJldHVybiAwO1xyXG4gICAgICAgICAgICByZXR1cm4gZGlyID8gbW9tZW50dW0gOiAtbW9tZW50dW07XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG59XHJcbiIsInVzaW5nIFN5c3RlbTtcclxudXNpbmcgU3lzdGVtLkNvbGxlY3Rpb25zLkdlbmVyaWM7XHJcbnVzaW5nIFN5c3RlbS5MaW5xO1xyXG51c2luZyBTeXN0ZW0uVGV4dDtcclxudXNpbmcgU3lzdGVtLlRocmVhZGluZy5UYXNrcztcclxuXHJcbm5hbWVzcGFjZSBDaXJub0dhbWVcclxue1xyXG4gICAgcHVibGljIGNsYXNzIFBvaW50XHJcbiAgICB7XHJcbiAgICAgICAgcHVibGljIGludCBYO1xyXG4gICAgICAgIHB1YmxpYyBpbnQgWTtcclxuICAgICAgICBwdWJsaWMgUG9pbnQoaW50IHggPSAwLCBpbnQgeSA9IDApXHJcbiAgICAgICAge1xyXG4gICAgICAgICAgICB0aGlzLlggPSB4O1xyXG4gICAgICAgICAgICB0aGlzLlkgPSB5O1xyXG4gICAgICAgIH1cclxuICAgIH1cclxufVxyXG4iLCJ1c2luZyBTeXN0ZW07XHJcbnVzaW5nIFN5c3RlbS5Db2xsZWN0aW9ucy5HZW5lcmljO1xyXG51c2luZyBTeXN0ZW0uTGlucTtcclxudXNpbmcgU3lzdGVtLlRleHQ7XHJcbnVzaW5nIFN5c3RlbS5UaHJlYWRpbmcuVGFza3M7XHJcblxyXG5uYW1lc3BhY2UgQ2lybm9HYW1lXHJcbntcclxuICAgIHB1YmxpYyBjbGFzcyBSZWN0YW5nbGVcclxuICAgIHtcclxuICAgICAgICBwdWJsaWMgZmxvYXQgeCA9IDA7XHJcbiAgICAgICAgcHVibGljIGZsb2F0IHkgPSAwO1xyXG4gICAgICAgIHB1YmxpYyBmbG9hdCB3aWR0aCA9IDA7XHJcbiAgICAgICAgcHVibGljIGZsb2F0IGhlaWdodCA9IDA7XHJcblxyXG4gICAgICAgIHB1YmxpYyBmbG9hdCBsZWZ0XHJcbiAgICAgICAge1xyXG4gICAgICAgICAgICBnZXRcclxuICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuIHg7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgc2V0XHJcbiAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgIHggPSB2YWx1ZTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuICAgICAgICBwdWJsaWMgZmxvYXQgdG9wXHJcbiAgICAgICAge1xyXG4gICAgICAgICAgICBnZXRcclxuICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuIHk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgc2V0XHJcbiAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgIHkgPSB2YWx1ZTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuICAgICAgICBwdWJsaWMgZmxvYXQgcmlnaHRcclxuICAgICAgICB7XHJcbiAgICAgICAgICAgIGdldFxyXG4gICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICByZXR1cm4geCArIHdpZHRoO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIHNldFxyXG4gICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICB3aWR0aCA9IHZhbHVlIC0geDtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuICAgICAgICBwdWJsaWMgZmxvYXQgYm90dG9tXHJcbiAgICAgICAge1xyXG4gICAgICAgICAgICBnZXRcclxuICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuIHkgKyBoZWlnaHQ7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgc2V0XHJcbiAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgIGhlaWdodCA9IHZhbHVlIC0geTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuICAgICAgICBwdWJsaWMgZmxvYXRbXSBwb2ludHNcclxuICAgICAgICB7XHJcbiAgICAgICAgICAgIGdldFxyXG4gICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICBmbG9hdFtdIHJldCA9IG5ldyBmbG9hdFs4XTtcclxuICAgICAgICAgICAgICAgIGludCBpID0gMDtcclxuICAgICAgICAgICAgICAgIHJldFtpKytdID0geDtcclxuICAgICAgICAgICAgICAgIHJldFtpKytdID0geTtcclxuXHJcbiAgICAgICAgICAgICAgICByZXRbaSsrXSA9IHJpZ2h0O1xyXG4gICAgICAgICAgICAgICAgcmV0W2krK10gPSB5O1xyXG5cclxuICAgICAgICAgICAgICAgIHJldFtpKytdID0gcmlnaHQ7XHJcbiAgICAgICAgICAgICAgICByZXRbaSsrXSA9IGJvdHRvbTtcclxuXHJcbiAgICAgICAgICAgICAgICByZXRbaSsrXSA9IHg7XHJcbiAgICAgICAgICAgICAgICByZXRbaSsrXSA9IGJvdHRvbTtcclxuXHJcbiAgICAgICAgICAgICAgICByZXR1cm4gcmV0O1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHB1YmxpYyBWZWN0b3IyIENlbnRlclxyXG4gICAgICAgIHtcclxuICAgICAgICAgICAgZ2V0XHJcbiAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgIHJldHVybiBuZXcgVmVjdG9yMihsZWZ0ICsgKHdpZHRoIC8gMiksIHRvcCArIChoZWlnaHQgLyAyKSk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcbiAgICAgICAgcHVibGljIHZvaWQgQ29weUZyb20oUmVjdGFuZ2xlIFIpXHJcbiAgICAgICAge1xyXG4gICAgICAgICAgICB4ID0gUi54O1xyXG4gICAgICAgICAgICB5ID0gUi55O1xyXG4gICAgICAgICAgICB3aWR0aCA9IFIud2lkdGg7XHJcbiAgICAgICAgICAgIGhlaWdodCA9IFIuaGVpZ2h0O1xyXG4gICAgICAgIH1cclxuICAgICAgICBwdWJsaWMgdm9pZCBHZXRDZW50ZXIoVmVjdG9yMiBPVVQpXHJcbiAgICAgICAge1xyXG4gICAgICAgICAgICBPVVQuWCA9IGxlZnQgKyAod2lkdGggLyAyKTtcclxuICAgICAgICAgICAgT1VULlkgPSB0b3AgKyAoaGVpZ2h0IC8gMik7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHB1YmxpYyBWZWN0b3IyIE1pblxyXG4gICAgICAgIHtcclxuICAgICAgICAgICAgZ2V0XHJcbiAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgIHJldHVybiBuZXcgVmVjdG9yMih4LCB5KTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBzZXRcclxuICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgaWYgKHZhbHVlID09IG51bGwpXHJcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuO1xyXG4gICAgICAgICAgICAgICAgeCA9IHZhbHVlLlg7XHJcbiAgICAgICAgICAgICAgICB5ID0gdmFsdWUuWTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuICAgICAgICBwdWJsaWMgVmVjdG9yMiBNYXhcclxuICAgICAgICB7XHJcbiAgICAgICAgICAgIGdldFxyXG4gICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gbmV3IFZlY3RvcjIocmlnaHQsIGJvdHRvbSk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgc2V0XHJcbiAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgIGlmICh2YWx1ZSA9PSBudWxsKVxyXG4gICAgICAgICAgICAgICAgICAgIHJldHVybjtcclxuICAgICAgICAgICAgICAgIHJpZ2h0ID0gdmFsdWUuWDtcclxuICAgICAgICAgICAgICAgIGJvdHRvbSA9IHZhbHVlLlk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcbiAgICAgICAgcHVibGljIGJvb2wgY29udGFpbnNQb2ludChmbG9hdCB4LCBmbG9hdCB5KVxyXG4gICAgICAgIHtcclxuICAgICAgICAgICAgaWYgKHggPj0gdGhpcy54ICYmIHkgPj0gdGhpcy55ICYmIHggPD0gcmlnaHQgJiYgeSA8PSBib3R0b20pXHJcbiAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgIHJldHVybiB0cnVlO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIHJldHVybiBmYWxzZTtcclxuICAgICAgICB9XHJcbiAgICAgICAgcHVibGljIGJvb2wgY29udGFpbnNQb2ludChWZWN0b3IyIHBvaW50KVxyXG4gICAgICAgIHtcclxuICAgICAgICAgICAgaWYgKHBvaW50LlggPj0gdGhpcy54ICYmIHBvaW50LlkgPj0gdGhpcy55ICYmIHBvaW50LlggPD0gcmlnaHQgJiYgcG9pbnQuWSA8PSBib3R0b20pXHJcbiAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgIHJldHVybiB0cnVlO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIHJldHVybiBmYWxzZTtcclxuICAgICAgICB9XHJcbiAgICAgICAgcHVibGljIGJvb2wgaW50ZXJzZWN0cyhSZWN0YW5nbGUgUilcclxuICAgICAgICB7XHJcbiAgICAgICAgICAgIGZsb2F0W10gcCA9IFIucG9pbnRzO1xyXG4gICAgICAgICAgICBib29sIGNvbnRhaW4gPSBmYWxzZTtcclxuICAgICAgICAgICAgYm9vbCBvdXRzaWRlID0gZmFsc2U7XHJcbiAgICAgICAgICAgIGludCBpID0gMDtcclxuICAgICAgICAgICAgd2hpbGUgKGkgPCBwLkxlbmd0aClcclxuICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgaWYgKGNvbnRhaW5zUG9pbnQocFtpKytdLCBwW2krK10pKVxyXG4gICAgICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgICAgIGNvbnRhaW4gPSB0cnVlO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgZWxzZVxyXG4gICAgICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgICAgIG91dHNpZGUgPSB0cnVlO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIGlmIChjb250YWluICYmIG91dHNpZGUpXHJcbiAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgIHJldHVybiB0cnVlO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIGlmIChSLmxlZnQgPCBsZWZ0ICYmIFIucmlnaHQgPiByaWdodClcclxuICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgLy9pZiAoKHRvcCA8PSBSLnRvcCAmJiBib3R0b20gPD0gUi50b3ApIHx8ICh0b3AgPD0gUi5ib3R0b20gJiYgYm90dG9tIDw9IFIuYm90dG9tKSlcclxuICAgICAgICAgICAgICAgIGlmICgodG9wIDw9IFIudG9wICYmIGJvdHRvbSA+PSBSLnRvcCkgfHwgKHRvcCA8PSBSLmJvdHRvbSAmJiBib3R0b20gPj0gUi5ib3R0b20pKVxyXG4gICAgICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgICAgIHJldHVybiB0cnVlO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIGlmIChSLnRvcCA8IHRvcCAmJiBSLmJvdHRvbSA+IGJvdHRvbSlcclxuICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgaWYgKChsZWZ0IDw9IFIubGVmdCAmJiByaWdodCA+PSBSLmxlZnQpIHx8IChsZWZ0IDw9IFIucmlnaHQgJiYgcmlnaHQgPj0gUi5yaWdodCkpXHJcbiAgICAgICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHRydWU7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgLyppZiAoUi5sZWZ0IDwgbGVmdCAmJiBSLnJpZ2h0ID4gcmlnaHQpXHJcbiAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgIGlmICgodG9wIDw9IFIudG9wICYmIGJvdHRvbSA8PSBSLnRvcCkgfHwgKHRvcCA8PSBSLmJvdHRvbSAmJiBib3R0b20gPD0gUi5ib3R0b20pKVxyXG4gICAgICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgICAgIHJldHVybiB0cnVlO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIGlmIChSLnRvcCA8IHRvcCAmJiBSLmJvdHRvbSA+IGJvdHRvbSlcclxuICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgaWYgKChsZWZ0IDw9IFIubGVmdCAmJiByaWdodCA8PSBSLmxlZnQpIHx8IChsZWZ0IDw9IFIucmlnaHQgJiYgcmlnaHQgPD0gUi5yaWdodCkpXHJcbiAgICAgICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHRydWU7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH0qL1xyXG4gICAgICAgICAgICByZXR1cm4gZmFsc2U7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHB1YmxpYyBib29sIGlzVG91Y2hpbmcoUmVjdGFuZ2xlIFIpXHJcbiAgICAgICAge1xyXG4gICAgICAgICAgICBpZiAoUiA9PSBudWxsKVxyXG4gICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgZmxvYXRbXSBwID0gUi5wb2ludHM7XHJcbiAgICAgICAgICAgIGludCBpID0gMDtcclxuICAgICAgICAgICAgd2hpbGUgKGkgPCBwLkxlbmd0aClcclxuICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgaWYgKGNvbnRhaW5zUG9pbnQocFtpKytdLCBwW2krK10pKVxyXG4gICAgICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgICAgIHJldHVybiB0cnVlO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIGlmIChpbnRlcnNlY3RzKFIpKVxyXG4gICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gdHJ1ZTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAvKmlmIChSLmxlZnQgPCBsZWZ0ICYmIFIucmlnaHQgPiByaWdodClcclxuICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgaWYgKCh0b3A8PVIudG9wICYmIGJvdHRvbTw9Ui50b3ApIHx8ICh0b3AgPD0gUi5ib3R0b20gJiYgYm90dG9tIDw9IFIuYm90dG9tKSlcclxuICAgICAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgICAgICByZXR1cm4gdHJ1ZTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBpZiAoUi50b3AgPCB0b3AgJiYgUi5ib3R0b20gPiBib3R0b20pXHJcbiAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgIGlmICgobGVmdCA8PSBSLmxlZnQgJiYgcmlnaHQgPD0gUi5sZWZ0KSB8fCAobGVmdCA8PSBSLnJpZ2h0ICYmIHJpZ2h0IDw9IFIucmlnaHQpKVxyXG4gICAgICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgICAgIHJldHVybiB0cnVlO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9Ki9cclxuICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xyXG4gICAgICAgIH1cclxuICAgICAgICBwdWJsaWMgUmVjdGFuZ2xlKGZsb2F0IHggPSAwLCBmbG9hdCB5ID0gMCwgZmxvYXQgd2lkdGggPSAwLCBmbG9hdCBoZWlnaHQgPSAwKVxyXG4gICAgICAgIHtcclxuICAgICAgICAgICAgdGhpcy54ID0geDtcclxuICAgICAgICAgICAgdGhpcy55ID0geTtcclxuICAgICAgICAgICAgdGhpcy53aWR0aCA9IHdpZHRoO1xyXG4gICAgICAgICAgICB0aGlzLmhlaWdodCA9IGhlaWdodDtcclxuICAgICAgICB9XHJcbiAgICAgICAgcHVibGljIHZvaWQgU2V0KGZsb2F0IHggPSAwLCBmbG9hdCB5ID0gMCwgZmxvYXQgd2lkdGggPSAwLCBmbG9hdCBoZWlnaHQgPSAwKVxyXG4gICAgICAgIHtcclxuICAgICAgICAgICAgdGhpcy54ID0geDtcclxuICAgICAgICAgICAgdGhpcy55ID0geTtcclxuICAgICAgICAgICAgdGhpcy53aWR0aCA9IHdpZHRoO1xyXG4gICAgICAgICAgICB0aGlzLmhlaWdodCA9IGhlaWdodDtcclxuICAgICAgICB9XHJcbiAgICAgICAgcHVibGljIHN0YXRpYyBSZWN0YW5nbGUgb3BlcmF0b3IgKyhSZWN0YW5nbGUgQSwgVmVjdG9yMiBCKVxyXG4gICAgICAgIHtcclxuICAgICAgICAgICAgcmV0dXJuIG5ldyBSZWN0YW5nbGUoQS54ICsgQi5YLCBBLnkgKyBCLlksIEEud2lkdGgsIEEuaGVpZ2h0KTtcclxuICAgICAgICB9XHJcbiAgICAgICAgcHVibGljIHN0YXRpYyBSZWN0YW5nbGUgb3BlcmF0b3IgLShSZWN0YW5nbGUgQSwgVmVjdG9yMiBCKVxyXG4gICAgICAgIHtcclxuICAgICAgICAgICAgcmV0dXJuIG5ldyBSZWN0YW5nbGUoQS54IC0gQi5YLCBBLnkgLSBCLlksIEEud2lkdGgsIEEuaGVpZ2h0KTtcclxuICAgICAgICB9XHJcbiAgICB9XHJcbn1cclxuIiwidXNpbmcgU3lzdGVtO1xyXG51c2luZyBTeXN0ZW0uQ29sbGVjdGlvbnMuR2VuZXJpYztcclxudXNpbmcgU3lzdGVtLkxpbnE7XHJcbnVzaW5nIFN5c3RlbS5UZXh0O1xyXG51c2luZyBTeXN0ZW0uVGhyZWFkaW5nLlRhc2tzO1xyXG5cclxubmFtZXNwYWNlIENpcm5vR2FtZVxyXG57XHJcbiAgICBwdWJsaWMgY2xhc3MgUmVjdGFuZ2xlSVxyXG4gICAge1xyXG4gICAgICAgIHB1YmxpYyBpbnQgeCA9IDA7XHJcbiAgICAgICAgcHVibGljIGludCB5ID0gMDtcclxuICAgICAgICBwdWJsaWMgaW50IHdpZHRoID0gMDtcclxuICAgICAgICBwdWJsaWMgaW50IGhlaWdodCA9IDA7XHJcblxyXG5cclxuICAgICAgICBwdWJsaWMgaW50IGxlZnRcclxuICAgICAgICB7XHJcbiAgICAgICAgICAgIGdldFxyXG4gICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICByZXR1cm4geDtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBzZXRcclxuICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgeCA9IHZhbHVlO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHB1YmxpYyBpbnQgdG9wXHJcbiAgICAgICAge1xyXG4gICAgICAgICAgICBnZXRcclxuICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuIHk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgc2V0XHJcbiAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgIHkgPSB2YWx1ZTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuICAgICAgICBwdWJsaWMgaW50IHJpZ2h0XHJcbiAgICAgICAge1xyXG4gICAgICAgICAgICBnZXRcclxuICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuIHggKyB3aWR0aDtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBzZXRcclxuICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgd2lkdGggPSB2YWx1ZSAtIHg7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcbiAgICAgICAgcHVibGljIGludCBib3R0b21cclxuICAgICAgICB7XHJcbiAgICAgICAgICAgIGdldFxyXG4gICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICByZXR1cm4geSArIGhlaWdodDtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBzZXRcclxuICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgaGVpZ2h0ID0gdmFsdWUgLSB5O1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHB1YmxpYyBpbnRbXSBwb2ludHNcclxuICAgICAgICB7XHJcbiAgICAgICAgICAgIGdldFxyXG4gICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICBpbnRbXSByZXQgPSBuZXcgaW50WzhdO1xyXG4gICAgICAgICAgICAgICAgaW50IGkgPSAwO1xyXG4gICAgICAgICAgICAgICAgcmV0W2krK10gPSB4O1xyXG4gICAgICAgICAgICAgICAgcmV0W2krK10gPSB5O1xyXG5cclxuICAgICAgICAgICAgICAgIHJldFtpKytdID0gcmlnaHQ7XHJcbiAgICAgICAgICAgICAgICByZXRbaSsrXSA9IHk7XHJcblxyXG4gICAgICAgICAgICAgICAgcmV0W2krK10gPSByaWdodDtcclxuICAgICAgICAgICAgICAgIHJldFtpKytdID0gYm90dG9tO1xyXG5cclxuICAgICAgICAgICAgICAgIHJldFtpKytdID0geDtcclxuICAgICAgICAgICAgICAgIHJldFtpKytdID0gYm90dG9tO1xyXG5cclxuICAgICAgICAgICAgICAgIHJldHVybiByZXQ7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcbiAgICAgICAgcHVibGljIFBvaW50IENlbnRlclxyXG4gICAgICAgIHtcclxuICAgICAgICAgICAgZ2V0XHJcbiAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgIHJldHVybiBuZXcgUG9pbnQobGVmdCArICh3aWR0aCAvIDIpLCB0b3AgKyAoaGVpZ2h0IC8gMikpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHB1YmxpYyBQb2ludCBNaW5cclxuICAgICAgICB7XHJcbiAgICAgICAgICAgIGdldFxyXG4gICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gbmV3IFBvaW50KHgsIHkpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIHNldFxyXG4gICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICBpZiAodmFsdWUgPT0gbnVsbClcclxuICAgICAgICAgICAgICAgICAgICByZXR1cm47XHJcbiAgICAgICAgICAgICAgICB4ID0gdmFsdWUuWDtcclxuICAgICAgICAgICAgICAgIHkgPSB2YWx1ZS5ZO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHB1YmxpYyBQb2ludCBNYXhcclxuICAgICAgICB7XHJcbiAgICAgICAgICAgIGdldFxyXG4gICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gbmV3IFBvaW50KHJpZ2h0LCBib3R0b20pO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIHNldFxyXG4gICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICBpZiAodmFsdWUgPT0gbnVsbClcclxuICAgICAgICAgICAgICAgICAgICByZXR1cm47XHJcbiAgICAgICAgICAgICAgICByaWdodCA9IHZhbHVlLlg7XHJcbiAgICAgICAgICAgICAgICBib3R0b20gPSB2YWx1ZS5ZO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHB1YmxpYyBib29sIGNvbnRhaW5zUG9pbnQoaW50IHgsIGludCB5KVxyXG4gICAgICAgIHtcclxuICAgICAgICAgICAgaWYgKHggPj0gdGhpcy54ICYmIHkgPj0gdGhpcy55ICYmIHggPD0gcmlnaHQgJiYgeSA8PSBib3R0b20pXHJcbiAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgIHJldHVybiB0cnVlO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIHJldHVybiBmYWxzZTtcclxuICAgICAgICB9XHJcbiAgICAgICAgcHVibGljIGJvb2wgY29udGFpbnNQb2ludChQb2ludCBwb2ludClcclxuICAgICAgICB7XHJcbiAgICAgICAgICAgIGlmIChwb2ludC5YID49IHRoaXMueCAmJiBwb2ludC5ZID49IHRoaXMueSAmJiBwb2ludC5YIDw9IHJpZ2h0ICYmIHBvaW50LlkgPD0gYm90dG9tKVxyXG4gICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gdHJ1ZTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICByZXR1cm4gZmFsc2U7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHB1YmxpYyBib29sIGludGVyc2VjdHMoUmVjdGFuZ2xlSSBSKVxyXG4gICAgICAgIHtcclxuICAgICAgICAgICAgaW50W10gcCA9IFIucG9pbnRzO1xyXG4gICAgICAgICAgICBib29sIGNvbnRhaW4gPSBmYWxzZTtcclxuICAgICAgICAgICAgYm9vbCBvdXRzaWRlID0gZmFsc2U7XHJcbiAgICAgICAgICAgIGludCBpID0gMDtcclxuICAgICAgICAgICAgd2hpbGUgKGkgPCBwLkxlbmd0aClcclxuICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgaWYgKGNvbnRhaW5zUG9pbnQocFtpKytdLCBwW2krK10pKVxyXG4gICAgICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgICAgIGNvbnRhaW4gPSB0cnVlO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgZWxzZVxyXG4gICAgICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgICAgIG91dHNpZGUgPSB0cnVlO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIGlmIChjb250YWluICYmIG91dHNpZGUpXHJcbiAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgIHJldHVybiB0cnVlO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIGlmIChSLmxlZnQgPCBsZWZ0ICYmIFIucmlnaHQgPiByaWdodClcclxuICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgLy9pZiAoKHRvcCA8PSBSLnRvcCAmJiBib3R0b20gPD0gUi50b3ApIHx8ICh0b3AgPD0gUi5ib3R0b20gJiYgYm90dG9tIDw9IFIuYm90dG9tKSlcclxuICAgICAgICAgICAgICAgIGlmICgodG9wIDw9IFIudG9wICYmIGJvdHRvbSA+PSBSLnRvcCkgfHwgKHRvcCA8PSBSLmJvdHRvbSAmJiBib3R0b20gPj0gUi5ib3R0b20pKVxyXG4gICAgICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgICAgIHJldHVybiB0cnVlO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIGlmIChSLnRvcCA8IHRvcCAmJiBSLmJvdHRvbSA+IGJvdHRvbSlcclxuICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgaWYgKChsZWZ0IDw9IFIubGVmdCAmJiByaWdodCA+PSBSLmxlZnQpIHx8IChsZWZ0IDw9IFIucmlnaHQgJiYgcmlnaHQgPj0gUi5yaWdodCkpXHJcbiAgICAgICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHRydWU7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgLyppZiAoUi5sZWZ0IDwgbGVmdCAmJiBSLnJpZ2h0ID4gcmlnaHQpXHJcbiAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgIGlmICgodG9wIDw9IFIudG9wICYmIGJvdHRvbSA8PSBSLnRvcCkgfHwgKHRvcCA8PSBSLmJvdHRvbSAmJiBib3R0b20gPD0gUi5ib3R0b20pKVxyXG4gICAgICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgICAgIHJldHVybiB0cnVlO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIGlmIChSLnRvcCA8IHRvcCAmJiBSLmJvdHRvbSA+IGJvdHRvbSlcclxuICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgaWYgKChsZWZ0IDw9IFIubGVmdCAmJiByaWdodCA8PSBSLmxlZnQpIHx8IChsZWZ0IDw9IFIucmlnaHQgJiYgcmlnaHQgPD0gUi5yaWdodCkpXHJcbiAgICAgICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHRydWU7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH0qL1xyXG4gICAgICAgICAgICByZXR1cm4gZmFsc2U7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHB1YmxpYyBib29sIGlzVG91Y2hpbmcoUmVjdGFuZ2xlSSBSKVxyXG4gICAgICAgIHtcclxuICAgICAgICAgICAgaWYgKFIgPT0gbnVsbClcclxuICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIGludFtdIHAgPSBSLnBvaW50cztcclxuICAgICAgICAgICAgaW50IGkgPSAwO1xyXG4gICAgICAgICAgICB3aGlsZSAoaSA8IHAuTGVuZ3RoKVxyXG4gICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICBpZiAoY29udGFpbnNQb2ludChwW2krK10sIHBbaSsrXSkpXHJcbiAgICAgICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHRydWU7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgaWYgKGludGVyc2VjdHMoUikpXHJcbiAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgIHJldHVybiB0cnVlO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIHJldHVybiBmYWxzZTtcclxuICAgICAgICB9XHJcbiAgICAgICAgcHVibGljIFJlY3RhbmdsZUkoaW50IHggPSAwLCBpbnQgeSA9IDAsIGludCB3aWR0aCA9IDAsIGludCBoZWlnaHQgPSAwKVxyXG4gICAgICAgIHtcclxuICAgICAgICAgICAgdGhpcy54ID0geDtcclxuICAgICAgICAgICAgdGhpcy55ID0geTtcclxuICAgICAgICAgICAgdGhpcy53aWR0aCA9IHdpZHRoO1xyXG4gICAgICAgICAgICB0aGlzLmhlaWdodCA9IGhlaWdodDtcclxuICAgICAgICB9XHJcbiAgICAgICAgcHVibGljIHN0YXRpYyBSZWN0YW5nbGVJIG9wZXJhdG9yICsoUmVjdGFuZ2xlSSBBLCBQb2ludCBCKVxyXG4gICAgICAgIHtcclxuICAgICAgICAgICAgcmV0dXJuIG5ldyBSZWN0YW5nbGVJKEEueCArIEIuWCwgQS55ICsgQi5ZLCBBLndpZHRoLCBBLmhlaWdodCk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHB1YmxpYyBzdGF0aWMgUmVjdGFuZ2xlSSBvcGVyYXRvciAtKFJlY3RhbmdsZUkgQSwgUG9pbnQgQilcclxuICAgICAgICB7XHJcbiAgICAgICAgICAgIHJldHVybiBuZXcgUmVjdGFuZ2xlSShBLnggLSBCLlgsIEEueSAtIEIuWSwgQS53aWR0aCwgQS5oZWlnaHQpO1xyXG4gICAgICAgIH1cclxuICAgIH1cclxufVxyXG4iLCJ1c2luZyBTeXN0ZW07XHJcbnVzaW5nIFN5c3RlbS5Db2xsZWN0aW9ucy5HZW5lcmljO1xyXG51c2luZyBTeXN0ZW0uTGlucTtcclxudXNpbmcgU3lzdGVtLlRleHQ7XHJcbnVzaW5nIFN5c3RlbS5UaHJlYWRpbmcuVGFza3M7XHJcbnVzaW5nIEJyaWRnZTtcclxudXNpbmcgQnJpZGdlLkh0bWw1O1xyXG5cclxubmFtZXNwYWNlIENpcm5vR2FtZVxyXG57XHJcbiAgICBwdWJsaWMgY2xhc3MgUmVuZGVyZXJcclxuICAgIHtcclxuICAgICAgICBwdWJsaWMgSFRNTEVsZW1lbnQgdmlldztcclxuICAgICAgICBwdWJsaWMgUmVuZGVyZXIoaW50IHdpZHRoID0gODAwLCBpbnQgaGVpZ2h0ID0gNjAwLCBpbnQgYmFja2dyb3VuZENvbG9yID0gMHgxMDk5YmIpXHJcbiAgICAgICAge1xyXG4gICAgICAgICAgICAvKnZhciB3aWR0aCA9IDgwMDtcclxuICAgICAgICAgICAgdmFyIGhlaWdodCA9IDYwMDtcclxuICAgICAgICAgICAgdmFyIGJhY2tncm91bmRDb2xvciA9IDB4MTA5OWJiOyovXHJcbiAgICAgICAgICAgIHZpZXcgPSBTY3JpcHQuV3JpdGU8ZHluYW1pYz4oXCJuZXcgUElYSS5BcHBsaWNhdGlvbih3aWR0aCwgaGVpZ2h0LCB7YmFja2dyb3VuZENvbG9yIDogYmFja2dyb3VuZENvbG9yfSlcIik7XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG59XHJcbiIsInVzaW5nIFN5c3RlbTtcclxudXNpbmcgU3lzdGVtLkNvbGxlY3Rpb25zLkdlbmVyaWM7XHJcbnVzaW5nIFN5c3RlbS5MaW5xO1xyXG51c2luZyBTeXN0ZW0uVGV4dDtcclxudXNpbmcgU3lzdGVtLlRocmVhZGluZy5UYXNrcztcclxudXNpbmcgQnJpZGdlO1xyXG51c2luZyBCcmlkZ2UuSHRtbDU7XHJcblxyXG5uYW1lc3BhY2UgQ2lybm9HYW1lXHJcbntcclxuICAgIHB1YmxpYyBjbGFzcyBUaWxlRGF0YVxyXG4gICAge1xyXG4gICAgICAgIHB1YmxpYyBpbnQgdGV4dHVyZTtcclxuICAgICAgICBwdWJsaWMgaW50IHJvdztcclxuICAgICAgICBwdWJsaWMgaW50IGNvbHVtbjtcclxuICAgICAgICBwdWJsaWMgYm9vbCBlbmFibGVkO1xyXG4gICAgICAgIHB1YmxpYyBUaWxlTWFwIG1hcDtcclxuICAgICAgICBwdWJsaWMgYm9vbCB2aXNpYmxlO1xyXG5cclxuICAgICAgICBwdWJsaWMgYm9vbCB0b3BTb2xpZDtcclxuICAgICAgICBwdWJsaWMgYm9vbCByaWdodFNvbGlkO1xyXG4gICAgICAgIHB1YmxpYyBib29sIGxlZnRTb2xpZDtcclxuICAgICAgICBwdWJsaWMgYm9vbCBib3R0b21Tb2xpZDtcclxuXHJcbiAgICAgICAgcHVibGljIGJvb2wgQ2FuU2xvcGU7XHJcblxyXG4gICAgICAgIHB1YmxpYyBib29sIEJyZWFrYWJsZSA9IGZhbHNlO1xyXG4gICAgICAgIHB1YmxpYyBmbG9hdCBIUCA9IDQ7XHJcbiAgICAgICAgcHVibGljIGZsb2F0IG1heEhQID0gNDtcclxuICAgICAgICBwdWJsaWMgYm9vbCBvcGFxdWUgPSB0cnVlO1xyXG5cclxuICAgICAgICBwcml2YXRlIFJlY3RhbmdsZSBfaGl0Ym94O1xyXG5cclxuICAgICAgICBwdWJsaWMgQWN0aW9uPFBsYXRmb3JtZXJFbnRpdHk+IFN0ZXBwZWRPbjtcclxuXHJcbiAgICAgICAgcHVibGljIFRpbGVEYXRhIENsb25lKClcclxuICAgICAgICB7XHJcbiAgICAgICAgICAgIHZhciBUID0gbmV3IFRpbGVEYXRhKCk7XHJcbiAgICAgICAgICAgIFQudGV4dHVyZSA9IHRleHR1cmU7XHJcbiAgICAgICAgICAgIFQuZW5hYmxlZCA9IGVuYWJsZWQ7XHJcbiAgICAgICAgICAgIFQubWFwID0gbWFwO1xyXG4gICAgICAgICAgICBULnZpc2libGUgPSB2aXNpYmxlO1xyXG4gICAgICAgICAgICBULnRvcFNvbGlkID0gdG9wU29saWQ7XHJcbiAgICAgICAgICAgIFQucmlnaHRTb2xpZCA9IHJpZ2h0U29saWQ7XHJcbiAgICAgICAgICAgIFQubGVmdFNvbGlkID0gbGVmdFNvbGlkO1xyXG4gICAgICAgICAgICBULmJvdHRvbVNvbGlkID0gYm90dG9tU29saWQ7XHJcbiAgICAgICAgICAgIFQuQ2FuU2xvcGUgPSBDYW5TbG9wZTtcclxuICAgICAgICAgICAgcmV0dXJuIFQ7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBwdWJsaWMgYm9vbCBEYW1hZ2UoZmxvYXQgZGFtYWdlKVxyXG4gICAgICAgIHtcclxuICAgICAgICAgICAgSFAgLT0gZGFtYWdlO1xyXG4gICAgICAgICAgICBpZiAoSFAgPD0gMCAmJiB0b3BTb2xpZClcclxuICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgc29saWQgPSBmYWxzZTtcclxuICAgICAgICAgICAgICAgIHZpc2libGUgPSBmYWxzZTtcclxuICAgICAgICAgICAgICAgIGVuYWJsZWQgPSBmYWxzZTtcclxuICAgICAgICAgICAgICAgIC8qZW5hYmxlZCA9IHRydWU7XHJcbiAgICAgICAgICAgICAgICB2aXNpYmxlID0gdHJ1ZTtcclxuICAgICAgICAgICAgICAgIHRleHR1cmUgPSAyOyovXHJcbiAgICAgICAgICAgICAgICAvKm1hcC5Gb3JjZVJlZHJhdygpOyovXHJcbiAgICAgICAgICAgICAgICBVcGRhdGVUaWxlKCk7XHJcbiAgICAgICAgICAgICAgICBTcGF3blBhcnRpY2xlcygpO1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuIHRydWU7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgZWxzZVxyXG4gICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICBtYXAuUmVkcmF3VGlsZShjb2x1bW4sIHJvdywgZmFsc2UpO1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHB1YmxpYyB2b2lkIFVwZGF0ZVRpbGUoKVxyXG4gICAgICAgIHtcclxuICAgICAgICAgICAgbWFwLlJlZHJhd1RpbGUoY29sdW1uLCByb3cpO1xyXG4gICAgICAgIH1cclxuICAgICAgICBwcml2YXRlIHZvaWQgU3Bhd25QYXJ0aWNsZXMoKVxyXG4gICAgICAgIHtcclxuICAgICAgICAgICAgdmFyIHR4ID0gKGludClNYXRoSGVscGVyLkNsYW1wKHRleHR1cmUsIDAsIG1hcC50aWxlcy5Db3VudCAtIDEpO1xyXG4gICAgICAgICAgICB2YXIgVCA9IG1hcC50aWxlc1t0eF07XHJcblxyXG4gICAgICAgICAgICB2YXIgc3ogPSAoaW50KShtYXAudGlsZXNpemUgLyAyKTtcclxuICAgICAgICAgICAgdmFyIEcgPSBtYXAuZ2FtZTtcclxuICAgICAgICAgICAgdmFyIEhCID0gR2V0SGl0Ym94KCk7XHJcbiAgICAgICAgICAgIC8vdmFyIHNwZCA9IDEuNWY7XHJcbiAgICAgICAgICAgIHZhciBzcGQgPSAxO1xyXG5cclxuXHJcbiAgICAgICAgICAgIHZhciBDID0gbmV3IEhUTUxDYW52YXNFbGVtZW50KCk7XHJcbiAgICAgICAgICAgIEMuV2lkdGggPSBzejtcclxuICAgICAgICAgICAgQy5IZWlnaHQgPSBzejtcclxuICAgICAgICAgICAgdmFyIGcgPSBIZWxwZXIuR2V0Q29udGV4dChDKTtcclxuXHJcbiAgICAgICAgICAgIGcuRHJhd0ltYWdlKFQsIDAsIDAsIHN6LCBzeiwgMCwgMCwgc3osIHN6KTtcclxuICAgICAgICAgICAgdmFyIFAgPSBuZXcgUGFydGljbGUoRywgQy5BczxIVE1MSW1hZ2VFbGVtZW50PigpKTtcclxuICAgICAgICAgICAgUC5Ic3BlZWQgPSAtc3BkO1xyXG4gICAgICAgICAgICBQLlZzcGVlZCA9IC1zcGQ7XHJcbiAgICAgICAgICAgIFAueCA9IEhCLmxlZnQ7XHJcbiAgICAgICAgICAgIFAueSA9IEhCLnRvcDtcclxuICAgICAgICAgICAgRy5BZGRFbnRpdHkoUCk7XHJcblxyXG4gICAgICAgICAgICAvL1xyXG4gICAgICAgICAgICBDID0gbmV3IEhUTUxDYW52YXNFbGVtZW50KCk7XHJcbiAgICAgICAgICAgIEMuV2lkdGggPSBzejtcclxuICAgICAgICAgICAgQy5IZWlnaHQgPSBzejtcclxuICAgICAgICAgICAgZyA9IEhlbHBlci5HZXRDb250ZXh0KEMpO1xyXG5cclxuICAgICAgICAgICAgZy5EcmF3SW1hZ2UoVCwgc3osIDAsIHN6LCBzeiwgMCwgMCwgc3osIHN6KTtcclxuICAgICAgICAgICAgUCA9IG5ldyBQYXJ0aWNsZShHLCBDLkFzPEhUTUxJbWFnZUVsZW1lbnQ+KCkpO1xyXG4gICAgICAgICAgICBQLkhzcGVlZCA9IHNwZDtcclxuICAgICAgICAgICAgUC5Wc3BlZWQgPSAtc3BkO1xyXG4gICAgICAgICAgICBQLnggPSBIQi5sZWZ0ICsgc3o7XHJcbiAgICAgICAgICAgIFAueSA9IEhCLnRvcDtcclxuICAgICAgICAgICAgRy5BZGRFbnRpdHkoUCk7XHJcblxyXG4gICAgICAgICAgICAvL1xyXG4gICAgICAgICAgICBDID0gbmV3IEhUTUxDYW52YXNFbGVtZW50KCk7XHJcbiAgICAgICAgICAgIEMuV2lkdGggPSBzejtcclxuICAgICAgICAgICAgQy5IZWlnaHQgPSBzejtcclxuICAgICAgICAgICAgZyA9IEhlbHBlci5HZXRDb250ZXh0KEMpO1xyXG5cclxuICAgICAgICAgICAgZy5EcmF3SW1hZ2UoVCwgMCwgc3osIHN6LCBzeiwgMCwgMCwgc3osIHN6KTtcclxuICAgICAgICAgICAgUCA9IG5ldyBQYXJ0aWNsZShHLCBDLkFzPEhUTUxJbWFnZUVsZW1lbnQ+KCkpO1xyXG4gICAgICAgICAgICBQLkhzcGVlZCA9IC1zcGQ7XHJcbiAgICAgICAgICAgIFAuVnNwZWVkID0gc3BkO1xyXG4gICAgICAgICAgICBQLnggPSBIQi5sZWZ0O1xyXG4gICAgICAgICAgICBQLnkgPSBIQi50b3AgKyBzejtcclxuICAgICAgICAgICAgRy5BZGRFbnRpdHkoUCk7XHJcblxyXG4gICAgICAgICAgICAvL1xyXG4gICAgICAgICAgICBDID0gbmV3IEhUTUxDYW52YXNFbGVtZW50KCk7XHJcbiAgICAgICAgICAgIEMuV2lkdGggPSBzejtcclxuICAgICAgICAgICAgQy5IZWlnaHQgPSBzejtcclxuICAgICAgICAgICAgZyA9IEhlbHBlci5HZXRDb250ZXh0KEMpO1xyXG5cclxuICAgICAgICAgICAgZy5EcmF3SW1hZ2UoVCwgc3osIHN6LCBzeiwgc3osIDAsIDAsIHN6LCBzeik7XHJcbiAgICAgICAgICAgIFAgPSBuZXcgUGFydGljbGUoRywgQy5BczxIVE1MSW1hZ2VFbGVtZW50PigpKTtcclxuICAgICAgICAgICAgUC5Ic3BlZWQgPSBzcGQ7XHJcbiAgICAgICAgICAgIFAuVnNwZWVkID0gc3BkO1xyXG4gICAgICAgICAgICBQLnggPSBIQi5sZWZ0ICsgc3o7XHJcbiAgICAgICAgICAgIFAueSA9IEhCLnRvcCArIHN6O1xyXG4gICAgICAgICAgICBHLkFkZEVudGl0eShQKTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIHB1YmxpYyBib29sIHNvbGlkXHJcbiAgICAgICAge1xyXG4gICAgICAgICAgICBnZXRcclxuICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuIHRvcFNvbGlkICYmIHJpZ2h0U29saWQgJiYgbGVmdFNvbGlkICYmIGJvdHRvbVNvbGlkO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIHNldFxyXG4gICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICB0b3BTb2xpZCA9IHZhbHVlO1xyXG4gICAgICAgICAgICAgICAgbGVmdFNvbGlkID0gdmFsdWU7XHJcbiAgICAgICAgICAgICAgICByaWdodFNvbGlkID0gdmFsdWU7XHJcbiAgICAgICAgICAgICAgICBib3R0b21Tb2xpZCA9IHZhbHVlO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG4gICAgICAgIFJlY3RhbmdsZSBIUiA9IG5ldyBSZWN0YW5nbGUoKTtcclxuICAgICAgICBwdWJsaWMgUmVjdGFuZ2xlIEdldEhpdGJveCgpXHJcbiAgICAgICAge1xyXG4gICAgICAgICAgICAvKmlmIChfaGl0Ym94ID09IG51bGwpXHJcbiAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgIHZhciB0c3ogPSBtYXAudGlsZXNpemU7XHJcbiAgICAgICAgICAgICAgICB2YXIgcG9zID0gbWFwLnBvc2l0aW9uO1xyXG4gICAgICAgICAgICAgICAgX2hpdGJveCA9IG5ldyBSZWN0YW5nbGUocG9zLlggKyAoY29sdW1uICogdHN6KSwgcG9zLlkgKyAocm93ICogdHN6KSwgdHN6LCB0c3opO1xyXG4gICAgICAgICAgICB9Ki9cclxuICAgICAgICAgICAgdmFyIHRzeiA9IG1hcC50aWxlc2l6ZTtcclxuICAgICAgICAgICAgdmFyIHBvcyA9IG1hcC5wb3NpdGlvbjtcclxuICAgICAgICAgICAgSFIuU2V0KHBvcy5YICsgKGNvbHVtbiAqIHRzeiksIHBvcy5ZICsgKHJvdyAqIHRzeiksIHRzeiwgdHN6KTtcclxuICAgICAgICAgICAgcmV0dXJuIEhSO1xyXG4gICAgICAgICAgICAvL3JldHVybiBuZXcgUmVjdGFuZ2xlKHBvcy5YICsgKGNvbHVtbiAqIHRzeiksIHBvcy5ZICsgKHJvdyAqIHRzeiksIHRzeiwgdHN6KTtcclxuICAgICAgICAgICAgLy9yZXR1cm4gX2hpdGJveDtcclxuICAgICAgICB9XHJcbiAgICAgICAgcHVibGljIHZvaWQgR2V0SGl0Ym94MihSZWN0YW5nbGUgT1VUKVxyXG4gICAgICAgIHtcclxuICAgICAgICAgICAgLyppZiAoX2hpdGJveCA9PSBudWxsKVxyXG4gICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICB2YXIgdHN6ID0gbWFwLnRpbGVzaXplO1xyXG4gICAgICAgICAgICAgICAgdmFyIHBvcyA9IG1hcC5wb3NpdGlvbjtcclxuICAgICAgICAgICAgICAgIF9oaXRib3ggPSBuZXcgUmVjdGFuZ2xlKHBvcy5YICsgKGNvbHVtbiAqIHRzeiksIHBvcy5ZICsgKHJvdyAqIHRzeiksIHRzeiwgdHN6KTtcclxuICAgICAgICAgICAgfSovXHJcbiAgICAgICAgICAgIHZhciB0c3ogPSBtYXAudGlsZXNpemU7XHJcbiAgICAgICAgICAgIHZhciBwb3MgPSBtYXAucG9zaXRpb247XHJcbiAgICAgICAgICAgIE9VVC54ID0gcG9zLlggKyAoY29sdW1uICogdHN6KTtcclxuICAgICAgICAgICAgT1VULnkgPSBwb3MuWSArIChyb3cgKiB0c3opO1xyXG4gICAgICAgICAgICBPVVQud2lkdGggPSB0c3o7XHJcbiAgICAgICAgICAgIE9VVC5oZWlnaHQgPSB0c3o7XHJcbiAgICAgICAgICAgIC8vcmV0dXJuIF9oaXRib3g7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHB1YmxpYyBib29sIHBsYXRmb3JtXHJcbiAgICAgICAge1xyXG4gICAgICAgICAgICBnZXRcclxuICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuIHRvcFNvbGlkICYmICFyaWdodFNvbGlkICYmICFsZWZ0U29saWQgJiYgIWJvdHRvbVNvbGlkO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHB1YmxpYyBUaWxlRGF0YSBHZXRUaWxlRGF0YShpbnQgcmVsYXRpdmVYLCBpbnQgcmVsYXRpdmVZKVxyXG4gICAgICAgIHtcclxuICAgICAgICAgICAgcmV0dXJuIG1hcC5HZXRUaWxlKGNvbHVtbiArIHJlbGF0aXZlWCwgcm93ICsgcmVsYXRpdmVZKTtcclxuICAgICAgICB9XHJcbiAgICAgICAgcHVibGljIGJvb2wgc29saWRUb1NwZWVkKFZlY3RvcjIgYW5nbGUpXHJcbiAgICAgICAge1xyXG4gICAgICAgICAgICBpZiAoIWVuYWJsZWQpXHJcbiAgICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7XHJcbiAgICAgICAgICAgIGlmIChhbmdsZS5Sb3VnaExlbmd0aCA9PSAwKVxyXG4gICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gc29saWQ7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgZWxzZVxyXG4gICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICBpZiAoKGFuZ2xlLlggPiAwICYmIGxlZnRTb2xpZCkgfHwgKGFuZ2xlLlggPCAwICYmIHJpZ2h0U29saWQpIHx8IChhbmdsZS5ZID4gMCAmJiB0b3BTb2xpZCkgfHwgKGFuZ2xlLlkgPiAwICYmIGJvdHRvbVNvbGlkKSlcclxuICAgICAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgICAgICByZXR1cm4gdHJ1ZTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICByZXR1cm4gZmFsc2U7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHB1YmxpYyBmbG9hdCBHZXRUb3AoVmVjdG9yMiBwb3NpdGlvbilcclxuICAgICAgICB7XHJcblxyXG4gICAgICAgICAgICAvKlRpbGVEYXRhIExlZnQgPSBHZXRUaWxlRGF0YSgtMSwgMCk7XHJcbiAgICAgICAgICAgIFRpbGVEYXRhIFJpZ2h0ID0gR2V0VGlsZURhdGEoMSwgMCk7XHJcbiAgICAgICAgICAgIGJvb2wgTHNvbGlkID0gTGVmdCAhPSBudWxsICYmIExlZnQuZW5hYmxlZCAmJiBMZWZ0LnNvbGlkO1xyXG4gICAgICAgICAgICBib29sIFJzb2xpZCA9IFJpZ2h0ICE9IG51bGwgJiYgUmlnaHQuZW5hYmxlZCAmJiBSaWdodC5zb2xpZDsqL1xyXG4gICAgICAgICAgICBpbnQgZGlyZWN0aW9uID0gU2xvcGVEaXJlY3Rpb247XHJcbiAgICAgICAgICAgIC8vaWYgKCFDYW5TbG9wZSB8fCAhc29saWQgfHwgKExzb2xpZCAmJiBSc29saWQpKVxyXG4gICAgICAgICAgICB2YXIgdHN6ID0gbWFwLnRpbGVzaXplO1xyXG4gICAgICAgICAgICBpZiAoZGlyZWN0aW9uID09IDApXHJcbiAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgIC8vcmV0dXJuIFIudG9wO1xyXG5cclxuICAgICAgICAgICAgICAgIHZhciBwb3MgPSBtYXAucG9zaXRpb247XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gcG9zLlkgKyAocm93ICogdHN6KTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBlbHNlXHJcbiAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgIFJlY3RhbmdsZSBSID0gR2V0SGl0Ym94KCk7XHJcbiAgICAgICAgICAgICAgICBmbG9hdCBZID0gKChSLnJpZ2h0IC0gcG9zaXRpb24uWCkgLyBSLndpZHRoKSAqIHRzejtcclxuICAgICAgICAgICAgICAgIGlmIChkaXJlY3Rpb24gPiAwKVxyXG4gICAgICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgICAgIFkgPSAodHN6IC0gWSk7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAvL1kgKj0gMS4wZjtcclxuICAgICAgICAgICAgICAgIFkgPSAoZmxvYXQpTWF0aC5NaW4odHN6LCBNYXRoLk1heCgwLCBZKSk7XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gUi5ib3R0b20gLSBZO1xyXG4gICAgICAgICAgICAgICAgLy9yZXR1cm4gKGZsb2F0KU1hdGguTWluKFIudG9wLCBNYXRoLk1heChSLmJvdHRvbSwoKFIucmlnaHQgLSBwb3NpdGlvbi5YKSAvIFIud2lkdGgpICogUi5oZWlnaHQpKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuICAgICAgICBwdWJsaWMgYm9vbCBJc1Nsb3BlXHJcbiAgICAgICAge1xyXG4gICAgICAgICAgICBnZXRcclxuICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuIFNsb3BlRGlyZWN0aW9uICE9IDA7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcbiAgICAgICAgcHVibGljIGludCBTbG9wZURpcmVjdGlvblxyXG4gICAgICAgIHtcclxuICAgICAgICAgICAgZ2V0XHJcbiAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgIGlmICghQ2FuU2xvcGUpXHJcbiAgICAgICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIDA7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICBUaWxlRGF0YSBCb3R0b20gPSBHZXRUaWxlRGF0YSgwLCAxKTtcclxuICAgICAgICAgICAgICAgIGlmICghKEJvdHRvbSAhPSBudWxsICYmIEJvdHRvbS5lbmFibGVkICYmIEJvdHRvbS5zb2xpZCkpXHJcbiAgICAgICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIDA7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICBUaWxlRGF0YSBMZWZ0ID0gR2V0VGlsZURhdGEoLTEsIDApO1xyXG4gICAgICAgICAgICAgICAgVGlsZURhdGEgUmlnaHQgPSBHZXRUaWxlRGF0YSgxLCAwKTtcclxuICAgICAgICAgICAgICAgIGJvb2wgTHNvbGlkID0gTGVmdCAhPSBudWxsICYmIExlZnQuZW5hYmxlZCAmJiBMZWZ0LnNvbGlkO1xyXG4gICAgICAgICAgICAgICAgYm9vbCBSc29saWQgPSBSaWdodCAhPSBudWxsICYmIFJpZ2h0LmVuYWJsZWQgJiYgUmlnaHQuc29saWQ7XHJcbiAgICAgICAgICAgICAgICBpZiAoIUNhblNsb3BlIHx8ICFzb2xpZCB8fCAoTHNvbGlkICYmIFJzb2xpZCkgfHwgKCFSc29saWQgJiYgIUxzb2xpZCkpXHJcbiAgICAgICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIDA7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICBUaWxlRGF0YSBUb3AgPSBHZXRUaWxlRGF0YSgwLCAtMSk7XHJcbiAgICAgICAgICAgICAgICBib29sIFRzb2xpZCA9IFRvcCAhPSBudWxsICYmIFRvcC5lbmFibGVkICYmIFRvcC5zb2xpZDtcclxuICAgICAgICAgICAgICAgIGlmIChUc29saWQpXHJcbiAgICAgICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIDA7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICBpZiAoUnNvbGlkKVxyXG4gICAgICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgICAgIHJldHVybiAxO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgZWxzZVxyXG4gICAgICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgICAgIHJldHVybiAtMTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuICAgIH1cclxufVxyXG4iLCJ1c2luZyBTeXN0ZW07XHJcbnVzaW5nIFN5c3RlbS5Db2xsZWN0aW9ucy5HZW5lcmljO1xyXG51c2luZyBTeXN0ZW0uTGlucTtcclxudXNpbmcgU3lzdGVtLlRleHQ7XHJcbnVzaW5nIFN5c3RlbS5UaHJlYWRpbmcuVGFza3M7XHJcbnVzaW5nIEJyaWRnZTtcclxudXNpbmcgQnJpZGdlLkh0bWw1O1xyXG5cclxubmFtZXNwYWNlIENpcm5vR2FtZVxyXG57XHJcbiAgICBwdWJsaWMgY2xhc3MgVGlsZU1hcFxyXG4gICAge1xyXG4gICAgICAgIHB1YmxpYyBWZWN0b3IyIHBvc2l0aW9uO1xyXG4gICAgICAgIHB1YmxpYyBmbG9hdCB0aWxlc2l6ZTtcclxuICAgICAgICBwdWJsaWMgaW50IHJvd3M7XHJcbiAgICAgICAgcHVibGljIGludCBjb2x1bW5zO1xyXG4gICAgICAgIHB1YmxpYyBUaWxlRGF0YVssXSBkYXRhO1xyXG4gICAgICAgIHB1YmxpYyBMaXN0PEhUTUxJbWFnZUVsZW1lbnQ+IHRpbGVzO1xyXG4gICAgICAgIHB1YmxpYyBMaXN0PEhUTUxJbWFnZUVsZW1lbnQ+IGNyYWNrcztcclxuXHJcbiAgICAgICAgcHVibGljIEdhbWUgZ2FtZTtcclxuXHJcbiAgICAgICAgcHJvdGVjdGVkIEhUTUxDYW52YXNFbGVtZW50IGJ1ZmZlcjtcclxuICAgICAgICBwdWJsaWMgQ2FudmFzUmVuZGVyaW5nQ29udGV4dDJEIGJnO1xyXG5cclxuICAgICAgICAvLy8gPHN1bW1hcnk+XHJcbiAgICAgICAgLy8vIHJldHVybnMgdHJ1ZSBpZiB0aGUgcmVjdGFuZ2xlIGhhcyBubyBlbXB0eSBzcGFjZXMuXHJcbiAgICAgICAgLy8vIDwvc3VtbWFyeT5cclxuICAgICAgICAvLy8gPHBhcmFtIG5hbWU9XCJzWFwiPjwvcGFyYW0+XHJcbiAgICAgICAgLy8vIDxwYXJhbSBuYW1lPVwic1lcIj48L3BhcmFtPlxyXG4gICAgICAgIC8vLyA8cGFyYW0gbmFtZT1cImVYXCI+PC9wYXJhbT5cclxuICAgICAgICAvLy8gPHBhcmFtIG5hbWU9XCJlWVwiPjwvcGFyYW0+XHJcbiAgICAgICAgLy8vIDxyZXR1cm5zPjwvcmV0dXJucz5cclxuICAgICAgICBwdWJsaWMgYm9vbCBJc1JlY3RTb2xpZChpbnQgc1gsIGludCBzWSwgaW50IGVYLCBpbnQgZVkpXHJcbiAgICAgICAge1xyXG4gICAgICAgICAgICB2YXIgWCA9IHNYO1xyXG4gICAgICAgICAgICB2YXIgWSA9IHNZO1xyXG4gICAgICAgICAgICB3aGlsZSAoWSA8IGVZKVxyXG4gICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICBYID0gc1k7XHJcbiAgICAgICAgICAgICAgICB3aGlsZSAoWCA8IGVYKVxyXG4gICAgICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgICAgIHZhciBUID0gZGF0YVtYLCBZXTtcclxuICAgICAgICAgICAgICAgICAgICBpZiAoIShULmVuYWJsZWQgJiYgVC50b3BTb2xpZCkpXHJcbiAgICAgICAgICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgIFgrKztcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIFkrKztcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICByZXR1cm4gdHJ1ZTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIHByb3RlY3RlZCBSYW5kb20gUk5EO1xyXG4gICAgICAgIHB1YmxpYyBpbnQgU2VlZCA9IDA7XHJcblxyXG4gICAgICAgIHB1YmxpYyB2b2lkIEZvcmNlUmVkcmF3KClcclxuICAgICAgICB7XHJcbiAgICAgICAgICAgIG5lZWRSZWRyYXcgPSB0cnVlO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgcHJvdGVjdGVkIGJvb2wgbmVlZFJlZHJhdztcclxuICAgICAgICBwdWJsaWMgYm9vbCBBbGxvd1NreUJyaWRnZSA9IGZhbHNlO1xyXG4gICAgICAgIHB1YmxpYyBUaWxlTWFwKEdhbWUgZ2FtZSwgaW50IFNlZWQgPSAtMSlcclxuICAgICAgICB7XHJcbiAgICAgICAgICAgIFJORCA9IG5ldyBSYW5kb20oKTtcclxuICAgICAgICAgICAgLy9wb3NpdGlvbiA9IG5ldyBWZWN0b3IyKC01NzYpO1xyXG4gICAgICAgICAgICAvLy9wb3NpdGlvbiA9IG5ldyBWZWN0b3IyKC0xMjgpO1xyXG4gICAgICAgICAgICBwb3NpdGlvbiA9IG5ldyBWZWN0b3IyKCk7XHJcbiAgICAgICAgICAgIC8vdGlsZXNpemUgPSA0ODtcclxuICAgICAgICAgICAgdGlsZXNpemUgPSAxNjtcclxuICAgICAgICAgICAgLy9yb3dzID0gMTY7XHJcbiAgICAgICAgICAgIC8qY29sdW1ucyA9IDUyOyovXHJcbiAgICAgICAgICAgIHJvd3MgPSAoaW50KU1hdGguQ2VpbGluZygoKC1wb3NpdGlvbi5ZICogMikgKyBnYW1lLnN0YWdlQm91bmRzLmJvdHRvbSkgLyB0aWxlc2l6ZSk7XHJcbiAgICAgICAgICAgIGNvbHVtbnMgPSAoaW50KU1hdGguQ2VpbGluZygoKC1wb3NpdGlvbi5YICogMikgKyBnYW1lLnN0YWdlQm91bmRzLnJpZ2h0KSAvIHRpbGVzaXplKTtcclxuICAgICAgICAgICAgZGF0YSA9IG5ldyBUaWxlRGF0YVtjb2x1bW5zLCByb3dzXTtcclxuICAgICAgICAgICAgdGlsZXMgPSBBbmltYXRpb25Mb2FkZXIuR2V0KFwiaW1hZ2VzL2xhbmQvYnJpY2tcIik7XHJcbiAgICAgICAgICAgIGNyYWNrcyA9IEFuaW1hdGlvbkxvYWRlci5HZXQoXCJpbWFnZXMvbGFuZC9jcmFja3NcIik7XHJcbiAgICAgICAgICAgIHRoaXMuZ2FtZSA9IGdhbWU7XHJcblxyXG4gICAgICAgICAgICBidWZmZXIgPSBuZXcgSFRNTENhbnZhc0VsZW1lbnQoKTtcclxuICAgICAgICAgICAgYmcgPSBidWZmZXIuR2V0Q29udGV4dChDYW52YXNUeXBlcy5DYW52YXNDb250ZXh0MkRUeXBlLkNhbnZhc1JlbmRlcmluZ0NvbnRleHQyRCk7XHJcbiAgICAgICAgICAgIGlmIChTZWVkIDwgMClcclxuICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgdGhpcy5TZWVkID0gUk5ELk5leHQoKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBlbHNlXHJcbiAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgIHRoaXMuU2VlZCA9IFNlZWQ7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgLy9SYW5kb21pemUoKTtcclxuICAgICAgICAgICAgR2VuZXJhdGUoKTtcclxuICAgICAgICB9XHJcbiAgICAgICAgcHJvdGVjdGVkIHZvaWQgUmFuZG9taXplKClcclxuICAgICAgICB7XHJcbiAgICAgICAgICAgIGludCByb3cgPSAwO1xyXG4gICAgICAgICAgICBpbnQgY29sdW1uID0gMDtcclxuICAgICAgICAgICAgd2hpbGUgKHJvdyA8IHJvd3MpXHJcbiAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgIHdoaWxlIChjb2x1bW4gPCBjb2x1bW5zKVxyXG4gICAgICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgICAgIFRpbGVEYXRhIFQgPSBuZXcgVGlsZURhdGEoKTtcclxuICAgICAgICAgICAgICAgICAgICBULnJvdyA9IHJvdztcclxuICAgICAgICAgICAgICAgICAgICBULmNvbHVtbiA9IGNvbHVtbjtcclxuICAgICAgICAgICAgICAgICAgICBULnRleHR1cmUgPSAxO1xyXG4gICAgICAgICAgICAgICAgICAgIC8vVC5lbmFibGVkID0gKE1hdGguUmFuZG9tKCkgPCAwLjE1KSB8fCAocm93Pj1yb3dzLTEpO1xyXG4gICAgICAgICAgICAgICAgICAgIFQuZW5hYmxlZCA9IChSTkQuTmV4dERvdWJsZSgpIDwgMC4xNSkgfHwgKHJvdyA+PSByb3dzIC0gMSk7XHJcbiAgICAgICAgICAgICAgICAgICAgVC50b3BTb2xpZCA9IFQuZW5hYmxlZDtcclxuICAgICAgICAgICAgICAgICAgICBpZiAoVC5lbmFibGVkICYmIChyb3cgPj0gcm93cyAtIDEpKVxyXG4gICAgICAgICAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgVC50ZXh0dXJlID0gMjtcclxuICAgICAgICAgICAgICAgICAgICAgICAgVC5zb2xpZCA9IHRydWU7XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgIGVsc2UgaWYgKFQuZW5hYmxlZClcclxuICAgICAgICAgICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChSTkQuTmV4dERvdWJsZSgpIDwgMC4zKVxyXG4gICAgICAgICAgICAgICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBULnNvbGlkID0gdHJ1ZTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIFQudGV4dHVyZSA9IDA7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoUk5ELk5leHREb3VibGUoKSA8IDAuNSlcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBULnRleHR1cmUgPSAzO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgIFQudmlzaWJsZSA9IFQuZW5hYmxlZDtcclxuICAgICAgICAgICAgICAgICAgICBULm1hcCA9IHRoaXM7XHJcbiAgICAgICAgICAgICAgICAgICAgZGF0YVtjb2x1bW4sIHJvd10gPSBUO1xyXG4gICAgICAgICAgICAgICAgICAgIGNvbHVtbisrO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgY29sdW1uID0gMDtcclxuICAgICAgICAgICAgICAgIHJvdysrO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHB1YmxpYyB2b2lkIEdlbmVyYXRlKClcclxuICAgICAgICB7XHJcbiAgICAgICAgICAgIFJORCA9IG5ldyBSYW5kb20oU2VlZCk7XHJcbiAgICAgICAgICAgIC8vUmFuZG9taXplKCk7XHJcbiAgICAgICAgICAgIF9HZW4oKTtcclxuICAgICAgICAgICAgbmVlZFJlZHJhdyA9IHRydWU7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHByb3RlY3RlZCB2b2lkIF9HZW4oKVxyXG4gICAgICAgIHtcclxuICAgICAgICAgICAgaW50W10gaGVpZ2h0bWFwID0gbmV3IGludFtjb2x1bW5zXTtcclxuICAgICAgICAgICAgLy9mbG9hdCBlbnRyb3B5ID0gMC44ZjtcclxuICAgICAgICAgICAgLy9mbG9hdCBlbnRyb3B5ID0gMC40NWY7XHJcbiAgICAgICAgICAgIGZsb2F0IGVudHJvcHkgPSAwLjYwZjtcclxuICAgICAgICAgICAgaW50IG1heCA9IChpbnQpKHJvd3MgKiBlbnRyb3B5KTtcclxuICAgICAgICAgICAgLy9pbnQgc21vb3RobmVzc1NpemUgPSAxMjtcclxuICAgICAgICAgICAgaW50IHNtb290aG5lc3NTaXplID0gODtcclxuICAgICAgICAgICAgaW50IHNtb290aG5lc3NTdHJlbmd0aCA9IDI7XHJcblxyXG4gICAgICAgICAgICBpbnQgWCA9IDA7XHJcbiAgICAgICAgICAgIC8vcmFuZG9taXplcyB0aGUgaGVpZ2h0bWFwXHJcbiAgICAgICAgICAgIHdoaWxlIChYIDwgY29sdW1ucylcclxuICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgaGVpZ2h0bWFwW1hdID0gKGludCkoUk5ELk5leHREb3VibGUoKSAqIG1heCk7XHJcbiAgICAgICAgICAgICAgICBYICs9IDE7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgaW50IHMgPSAwO1xyXG4gICAgICAgICAgICB3aGlsZSAocyA8IHNtb290aG5lc3NTdHJlbmd0aClcclxuICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgaW50W10gb2hlaWdodG1hcCA9IGhlaWdodG1hcDtcclxuICAgICAgICAgICAgICAgIGhlaWdodG1hcCA9IG5ldyBpbnRbY29sdW1uc107XHJcbiAgICAgICAgICAgICAgICBYID0gMDtcclxuICAgICAgICAgICAgICAgIHdoaWxlIChYIDwgY29sdW1ucylcclxuICAgICAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgICAgICBoZWlnaHRtYXBbWF0gPSBibHVyKG9oZWlnaHRtYXAsIFgsIHNtb290aG5lc3NTaXplKTtcclxuICAgICAgICAgICAgICAgICAgICBYICs9IDE7XHJcbiAgICAgICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICAgICAgWCA9IDE7XHJcbiAgICAgICAgICAgICAgICBzKys7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgLy9yZW1vdmVzIGJ1bXBzIGZyb20gaGVpZ2h0bWFwXHJcbiAgICAgICAgICAgIHdoaWxlIChYIDwgY29sdW1ucyAtIDEpXHJcbiAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgIGludCBBID0gaGVpZ2h0bWFwW1ggLSAxXTtcclxuICAgICAgICAgICAgICAgIGludCBCID0gaGVpZ2h0bWFwW1ggKyAxXTtcclxuXHJcbiAgICAgICAgICAgICAgICBpbnQgSCA9IGhlaWdodG1hcFtYXTtcclxuICAgICAgICAgICAgICAgIC8vaWYgKEEgPT0gQiAmJiBNYXRoLkFicyhBLSBIKT09MSlcclxuICAgICAgICAgICAgICAgIGlmICgoQSA+IEgpID09IChCID4gSCkgJiYgSCAhPSBBKVxyXG4gICAgICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgICAgIGhlaWdodG1hcFtYXSA9IChBICsgQikgLyAyO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgWCArPSAxO1xyXG4gICAgICAgICAgICB9XHJcblxyXG5cclxuXHJcbiAgICAgICAgICAgIGludCByb3cgPSAwO1xyXG4gICAgICAgICAgICBpbnQgY29sdW1uID0gMDtcclxuICAgICAgICAgICAgVGlsZURhdGEgTFQgPSBudWxsO1xyXG4gICAgICAgICAgICBmbG9hdCBicmlkZ2VDaGFuY2UgPSAwLjkwZjtcclxuICAgICAgICAgICAgaW50IFJORGJyaWRnZSA9IDA7XHJcbiAgICAgICAgICAgIHdoaWxlIChyb3cgPCByb3dzKVxyXG4gICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICB3aGlsZSAoY29sdW1uIDwgY29sdW1ucylcclxuICAgICAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgICAgICBpbnQgSCA9IHJvd3MgLSBoZWlnaHRtYXBbY29sdW1uXTtcclxuICAgICAgICAgICAgICAgICAgICBib29sIGZpbGwgPSByb3cgPj0gSDtcclxuICAgICAgICAgICAgICAgICAgICBUaWxlRGF0YSBUID0gbmV3IFRpbGVEYXRhKCk7XHJcbiAgICAgICAgICAgICAgICAgICAgVC5yb3cgPSByb3c7XHJcbiAgICAgICAgICAgICAgICAgICAgVC5jb2x1bW4gPSBjb2x1bW47XHJcbiAgICAgICAgICAgICAgICAgICAgVC50ZXh0dXJlID0gMTtcclxuICAgICAgICAgICAgICAgICAgICAvL1QuZW5hYmxlZCA9IChNYXRoLlJhbmRvbSgpIDwgMC4xNSkgfHwgKHJvdyA+PSByb3dzIC0gMSk7XHJcbiAgICAgICAgICAgICAgICAgICAgVC5lbmFibGVkID0gKGZpbGwpIHx8IChyb3cgPj0gcm93cyAtIDEpO1xyXG4gICAgICAgICAgICAgICAgICAgIFQudG9wU29saWQgPSBULmVuYWJsZWQ7XHJcbiAgICAgICAgICAgICAgICAgICAgVC5ib3R0b21Tb2xpZCA9IFQuZW5hYmxlZDtcclxuICAgICAgICAgICAgICAgICAgICBpZiAoVC5lbmFibGVkICYmIChyb3cgPj0gcm93cyAtIDEpKVxyXG4gICAgICAgICAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgVC50ZXh0dXJlID0gMjtcclxuICAgICAgICAgICAgICAgICAgICAgICAgVC5zb2xpZCA9IHRydWU7XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgIGVsc2UgaWYgKFQuZW5hYmxlZClcclxuICAgICAgICAgICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIC8vaWYgKE1hdGguUmFuZG9tKCkgPCAwLjMpXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIFQuc29saWQgPSB0cnVlO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgVC50ZXh0dXJlID0gNDtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIFQuQ2FuU2xvcGUgPSB0cnVlO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKFJORC5OZXh0RG91YmxlKCkgPCAwLjUpXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgVC50ZXh0dXJlID0gNTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChyb3cgPiBIICYmIFJORC5OZXh0RG91YmxlKCkgPCAwLjAyKVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIFQudGV4dHVyZSA9IDY7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKCFULmVuYWJsZWQpXHJcbiAgICAgICAgICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAoKEFsbG93U2t5QnJpZGdlICYmIHJvdyA9PSAyMCAmJiBSTkQuTmV4dERvdWJsZSgpIDwgMC45MykgfHwgKHJvdyArIDQgPj0gSCAmJiByb3cgKyAyIDwgSCAmJiBSTkQuTmV4dERvdWJsZSgpIDwgMC4wMjUpIHx8IChMVCAhPSBudWxsICYmIExULmVuYWJsZWQgJiYgTFQudGV4dHVyZSA9PSAxICYmIFJORC5OZXh0RG91YmxlKCkgPCBicmlkZ2VDaGFuY2UpKVxyXG4gICAgICAgICAgICAgICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBULmVuYWJsZWQgPSB0cnVlO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgVC50b3BTb2xpZCA9IFQuZW5hYmxlZDtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJyaWRnZUNoYW5jZSAtPSAwLjA3NWY7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICAgICAgZWxzZVxyXG4gICAgICAgICAgICAgICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoUk5EYnJpZGdlIDwgMSAmJiBSTkQuTmV4dERvdWJsZSgpIDwgMC4wMTUpXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgUk5EYnJpZGdlID0gUk5ELk5leHQoOCk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoUk5EYnJpZGdlID4gMClcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBULmVuYWJsZWQgPSB0cnVlO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIFQudG9wU29saWQgPSBULmVuYWJsZWQ7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgUk5EYnJpZGdlLS07XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLy99ZWxzZSBpZiAoUk5ELk5leHREb3VibGUoKSA8IDAuMDI1KVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgZWxzZSBpZiAoUk5ELk5leHREb3VibGUoKSA8IDAuMDM1KVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIFQuZW5hYmxlZCA9IHRydWU7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgVC50b3BTb2xpZCA9IFQuZW5hYmxlZDtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVsc2UgaWYgKHRydWUpLy9kZWJ1ZyBmaWxsIHRoaW5nXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgVC5lbmFibGVkID0gdHJ1ZTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBULnRvcFNvbGlkID0gVC5lbmFibGVkO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIFQuQ2FuU2xvcGUgPSBNYXRoLlJhbmRvbSgpIDwgMC41O1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgIGlmICghVC5lbmFibGVkIHx8IFQudGV4dHVyZSAhPSAxKVxyXG4gICAgICAgICAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgYnJpZGdlQ2hhbmNlID0gMC45MGY7XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgIFQudmlzaWJsZSA9IFQuZW5hYmxlZDtcclxuICAgICAgICAgICAgICAgICAgICBULm1hcCA9IHRoaXM7XHJcbiAgICAgICAgICAgICAgICAgICAgVC5zb2xpZCA9IHRydWU7XHJcbiAgICAgICAgICAgICAgICAgICAgZGF0YVtjb2x1bW4sIHJvd10gPSBUO1xyXG4gICAgICAgICAgICAgICAgICAgIExUID0gVDtcclxuICAgICAgICAgICAgICAgICAgICBjb2x1bW4rKztcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIGNvbHVtbiA9IDA7XHJcbiAgICAgICAgICAgICAgICByb3crKztcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuICAgICAgICBwdWJsaWMgdm9pZCBfR2VuUmVjdChpbnQgU1gsIGludCBTWSwgaW50IEVYLCBpbnQgRVkpXHJcbiAgICAgICAge1xyXG4gICAgICAgICAgICBTWCA9IChpbnQpTWF0aEhlbHBlci5DbGFtcChTWCwgMCwgY29sdW1ucyAtIDEpO1xyXG4gICAgICAgICAgICBTWSA9IChpbnQpTWF0aEhlbHBlci5DbGFtcChTWSwgMCwgcm93cyAtIDEpO1xyXG4gICAgICAgICAgICBFWCA9IChpbnQpTWF0aEhlbHBlci5DbGFtcChFWCwgMCwgY29sdW1ucyAtIDEpO1xyXG4gICAgICAgICAgICBFWSA9IChpbnQpTWF0aEhlbHBlci5DbGFtcChFWSwgMCwgcm93cyAtIDEpO1xyXG5cclxuICAgICAgICAgICAgLy9mbG9hdCBlbnRyb3B5ID0gMC44ZjtcclxuICAgICAgICAgICAgLy9mbG9hdCBlbnRyb3B5ID0gMC40NWY7XHJcbiAgICAgICAgICAgIC8vZmxvYXQgZW50cm9weSA9IDAuNjBmO1xyXG4gICAgICAgICAgICAvLy9mbG9hdCBlbnRyb3B5ID0gMC41MGY7XHJcbiAgICAgICAgICAgIC8vLy9pbnQgbWF4ID0gKGludCkocm93cyAqIGVudHJvcHkpO1xyXG4gICAgICAgICAgICAvL2ludCBzbW9vdGhuZXNzU2l6ZSA9IDEyO1xyXG5cclxuICAgICAgICAgICAgaW50IFggPSAwO1xyXG5cclxuXHJcblxyXG4gICAgICAgICAgICBpbnQgcm93ID0gU1k7XHJcbiAgICAgICAgICAgIGludCBjb2x1bW4gPSBTWDtcclxuICAgICAgICAgICAgVGlsZURhdGEgTFQgPSBudWxsO1xyXG4gICAgICAgICAgICAvL2Zsb2F0IGJyaWRnZUNoYW5jZSA9IDAuOTBmO1xyXG4gICAgICAgICAgICAvLy9mbG9hdCBicmlkZ2VDaGFuY2UgPSAwLjk1ZjtcclxuICAgICAgICAgICAgaW50IFJORGJyaWRnZSA9IDA7XHJcblxyXG4gICAgICAgICAgICB3aGlsZSAocm93IDwgRVkpXHJcbiAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgIHdoaWxlIChjb2x1bW4gPCBFWClcclxuICAgICAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgICAgICBib29sIGZpbGwgPSBmYWxzZTtcclxuICAgICAgICAgICAgICAgICAgICBUaWxlRGF0YSBUID0gbmV3IFRpbGVEYXRhKCk7XHJcbiAgICAgICAgICAgICAgICAgICAgVC5yb3cgPSByb3c7XHJcbiAgICAgICAgICAgICAgICAgICAgVC5jb2x1bW4gPSBjb2x1bW47XHJcbiAgICAgICAgICAgICAgICAgICAgVC50ZXh0dXJlID0gMTtcclxuICAgICAgICAgICAgICAgICAgICAvL1QuZW5hYmxlZCA9IChNYXRoLlJhbmRvbSgpIDwgMC4xNSkgfHwgKHJvdyA+PSByb3dzIC0gMSk7XHJcbiAgICAgICAgICAgICAgICAgICAgVC5lbmFibGVkID0gKGZpbGwpIHx8IChyb3cgPj0gcm93cyAtIDEpO1xyXG4gICAgICAgICAgICAgICAgICAgIFQudG9wU29saWQgPSBULmVuYWJsZWQ7XHJcbiAgICAgICAgICAgICAgICAgICAgVC5ib3R0b21Tb2xpZCA9IFQuZW5hYmxlZDtcclxuICAgICAgICAgICAgICAgICAgICAvKmlmIChULmVuYWJsZWQgJiYgKHJvdyA+PSByb3dzIC0gMSkpXHJcbiAgICAgICAgICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBULnRleHR1cmUgPSAyO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBULnNvbGlkID0gdHJ1ZTtcclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgZWxzZSBpZiAoVC5lbmFibGVkKVxyXG4gICAgICAgICAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgLy9pZiAoTWF0aC5SYW5kb20oKSA8IDAuMylcclxuICAgICAgICAgICAgICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgVC5zb2xpZCA9IHRydWU7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBULnRleHR1cmUgPSA0O1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgVC5DYW5TbG9wZSA9IHRydWU7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoUk5ELk5leHREb3VibGUoKSA8IDAuNSlcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBULnRleHR1cmUgPSA1O1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGZhbHNlICYmIFJORC5OZXh0RG91YmxlKCkgPCAwLjAyKVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIFQudGV4dHVyZSA9IDY7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICB9Ki9cclxuICAgICAgICAgICAgICAgICAgICBpZiAoIVQuZW5hYmxlZClcclxuICAgICAgICAgICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIC8qaWYgKChBbGxvd1NreUJyaWRnZSAmJiByb3cgPT0gMjAgJiYgUk5ELk5leHREb3VibGUoKSA8IDAuOTMpIHx8IChmYWxzZSAmJiBmYWxzZSAmJiBSTkQuTmV4dERvdWJsZSgpIDwgMC4wMjUpIHx8IChMVCAhPSBudWxsICYmIExULmVuYWJsZWQgJiYgTFQudGV4dHVyZSA9PSAxICYmIFJORC5OZXh0RG91YmxlKCkgPCBicmlkZ2VDaGFuY2UpKVxyXG4gICAgICAgICAgICAgICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBULmVuYWJsZWQgPSB0cnVlO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgVC50b3BTb2xpZCA9IFQuZW5hYmxlZDtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJyaWRnZUNoYW5jZSAtPSAwLjA3NWY7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICAgICAgZWxzZSovXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChSTkRicmlkZ2UgPCAxICYmIFJORC5OZXh0RG91YmxlKCkgPCAwLjAzMClcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAvL1JORGJyaWRnZSA9IFJORC5OZXh0KDgpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIFJORGJyaWRnZSA9IDIrUk5ELk5leHQoNCk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLyppZiAoTWF0aC5SYW5kb20oKSA8IDAuOSlcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIFJORGJyaWRnZSArPSAxO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0qL1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKFJORGJyaWRnZSA+IDApXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgVC5lbmFibGVkID0gdHJ1ZTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBULnRvcFNvbGlkID0gVC5lbmFibGVkO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIFQuQ2FuU2xvcGUgPSB0cnVlO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIFJORGJyaWRnZS0tO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vfWVsc2UgaWYgKFJORC5OZXh0RG91YmxlKCkgPCAwLjAyNSlcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vZWxzZSBpZiAoUk5ELk5leHREb3VibGUoKSA8IDAuMDM1KVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgLy9lbHNlIGlmIChSTkQuTmV4dERvdWJsZSgpIDwgMC4wNClcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vZWxzZSBpZiAoUk5ELk5leHREb3VibGUoKSA8IDAuMDQ1KVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgZWxzZSBpZiAoUk5ELk5leHREb3VibGUoKSA8IDAuMDMwKVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIFQuZW5hYmxlZCA9IHRydWU7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgVC50b3BTb2xpZCA9IFQuZW5hYmxlZDtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBULkNhblNsb3BlID0gdHJ1ZTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgLyppZiAoIVQuZW5hYmxlZCB8fCBULnRleHR1cmUgIT0gMSlcclxuICAgICAgICAgICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGJyaWRnZUNoYW5jZSA9IDAuOTBmO1xyXG4gICAgICAgICAgICAgICAgICAgIH0qL1xyXG4gICAgICAgICAgICAgICAgICAgIFQudmlzaWJsZSA9IFQuZW5hYmxlZDtcclxuICAgICAgICAgICAgICAgICAgICBULm1hcCA9IHRoaXM7XHJcbiAgICAgICAgICAgICAgICAgICAgVC5zb2xpZCA9IHRydWU7XHJcbiAgICAgICAgICAgICAgICAgICAgZGF0YVtjb2x1bW4sIHJvd10gPSBUO1xyXG4gICAgICAgICAgICAgICAgICAgIExUID0gVDtcclxuICAgICAgICAgICAgICAgICAgICBjb2x1bW4rKztcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIGNvbHVtbiA9IFNYO1xyXG4gICAgICAgICAgICAgICAgcm93Kys7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcbiAgICAgICAgcHVibGljIHZvaWQgU2V0QnJlYWthYmxlUmVjdChpbnQgY29sdW1uLCBpbnQgcm93LCBpbnQgV2lkdGgsIGludCBIZWlnaHQsYm9vbCBicmVha2FibGUpXHJcbiAgICAgICAge1xyXG4gICAgICAgICAgICB2YXIgU1ggPSAoaW50KShjb2x1bW4pO1xyXG4gICAgICAgICAgICB2YXIgU1kgPSAoaW50KShyb3cpO1xyXG4gICAgICAgICAgICB2YXIgRVggPSAoaW50KShTWCArIFdpZHRoKTtcclxuICAgICAgICAgICAgdmFyIEVZID0gKGludCkoU1kgKyBIZWlnaHQpO1xyXG4gICAgICAgICAgICBTWCA9IChpbnQpTWF0aEhlbHBlci5DbGFtcChTWCwgMCwgY29sdW1ucyAtIDEpO1xyXG4gICAgICAgICAgICBTWSA9IChpbnQpTWF0aEhlbHBlci5DbGFtcChTWSwgMCwgcm93cyAtIDEpO1xyXG4gICAgICAgICAgICBFWCA9IChpbnQpTWF0aEhlbHBlci5DbGFtcChFWCwgMCwgY29sdW1ucyAtIDEpO1xyXG4gICAgICAgICAgICBFWSA9IChpbnQpTWF0aEhlbHBlci5DbGFtcChFWSwgMCwgcm93cyAtIDEpO1xyXG4gICAgICAgICAgICB2YXIgWCA9IFNYO1xyXG4gICAgICAgICAgICB2YXIgWSA9IFNZO1xyXG4gICAgICAgICAgICBUaWxlRGF0YSBUID0gbmV3IFRpbGVEYXRhKCk7XHJcbiAgICAgICAgICAgIFQucm93ID0gWTtcclxuICAgICAgICAgICAgVC5jb2x1bW4gPSBYO1xyXG4gICAgICAgICAgICBULnRleHR1cmUgPSAxO1xyXG4gICAgICAgICAgICBULmVuYWJsZWQgPSB0cnVlO1xyXG4gICAgICAgICAgICBULnZpc2libGUgPSB0cnVlO1xyXG4gICAgICAgICAgICBULm1hcCA9IHRoaXM7XHJcbiAgICAgICAgICAgIFQuc29saWQgPSB0cnVlO1xyXG4gICAgICAgICAgICBpZiAoYnJlYWthYmxlKVxyXG4gICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICBULnRleHR1cmUgPSAxO1xyXG4gICAgICAgICAgICAgICAgaWYgKE1hdGguUmFuZG9tKCkgPCAwLjAyKVxyXG4gICAgICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgICAgIFQudGV4dHVyZSA9IE1hdGguUmFuZG9tKCkgPCAwLjUgPyA1IDogNjtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIFQuQnJlYWthYmxlID0gdHJ1ZTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBlbHNlXHJcbiAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgIFQudGV4dHVyZSA9IDA7XHJcbiAgICAgICAgICAgICAgICBULkJyZWFrYWJsZSA9IGZhbHNlO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIHdoaWxlIChZIDwgRVkpXHJcbiAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgIFggPSBTWDtcclxuICAgICAgICAgICAgICAgIHdoaWxlIChYIDwgRVgpXHJcbiAgICAgICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICAgICAgLyp2YXIgVFQgPSBULkNsb25lKCk7XHJcbiAgICAgICAgICAgICAgICAgICAgVFQuY29sdW1uID0gWDtcclxuICAgICAgICAgICAgICAgICAgICBUVC5yb3cgPSBZO1xyXG4gICAgICAgICAgICAgICAgICAgIGRhdGFbWCwgWV0gPSBUVDsqL1xyXG4gICAgICAgICAgICAgICAgICAgIHZhciBUVCA9IGRhdGFbWCwgWV07XHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKFRUID09IG51bGwpXHJcbiAgICAgICAgICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBUVCA9IFQuQ2xvbmUoKTtcclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKFQuc29saWQpXHJcbiAgICAgICAgICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBUVC50ZXh0dXJlID0gVC50ZXh0dXJlO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBUVC5CcmVha2FibGUgPSBULkJyZWFrYWJsZTtcclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgWCsrO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgWSsrO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHB1YmxpYyB2b2lkIEZpbGxSZWN0KGludCBjb2x1bW4sIGludCByb3csIGludCBXaWR0aCwgaW50IEhlaWdodClcclxuICAgICAgICB7XHJcbiAgICAgICAgICAgIHZhciBTWCA9IChpbnQpKGNvbHVtbik7XHJcbiAgICAgICAgICAgIHZhciBTWSA9IChpbnQpKHJvdyk7XHJcbiAgICAgICAgICAgIHZhciBFWCA9IChpbnQpKFNYICsgV2lkdGgpO1xyXG4gICAgICAgICAgICB2YXIgRVkgPSAoaW50KShTWSArIEhlaWdodCk7XHJcbiAgICAgICAgICAgIFNYID0gKGludClNYXRoSGVscGVyLkNsYW1wKFNYLCAwLCBjb2x1bW5zIC0gMSk7XHJcbiAgICAgICAgICAgIFNZID0gKGludClNYXRoSGVscGVyLkNsYW1wKFNZLCAwLCByb3dzIC0gMSk7XHJcbiAgICAgICAgICAgIEVYID0gKGludClNYXRoSGVscGVyLkNsYW1wKEVYLCAwLCBjb2x1bW5zIC0gMSk7XHJcbiAgICAgICAgICAgIEVZID0gKGludClNYXRoSGVscGVyLkNsYW1wKEVZLCAwLCByb3dzIC0gMSk7XHJcbiAgICAgICAgICAgIHZhciBYID0gU1g7XHJcbiAgICAgICAgICAgIHZhciBZID0gU1k7XHJcbiAgICAgICAgICAgIFRpbGVEYXRhIFQgPSBuZXcgVGlsZURhdGEoKTtcclxuICAgICAgICAgICAgVC5yb3cgPSBZO1xyXG4gICAgICAgICAgICBULmNvbHVtbiA9IFg7XHJcbiAgICAgICAgICAgIFQudGV4dHVyZSA9IDE7XHJcbiAgICAgICAgICAgIFQuZW5hYmxlZCA9IHRydWU7XHJcbiAgICAgICAgICAgIFQudmlzaWJsZSA9IHRydWU7XHJcbiAgICAgICAgICAgIFQubWFwID0gdGhpcztcclxuICAgICAgICAgICAgVC5zb2xpZCA9IHRydWU7XHJcbiAgICAgICAgICAgIHdoaWxlIChZIDwgRVkpXHJcbiAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgIFggPSBTWDtcclxuICAgICAgICAgICAgICAgIHdoaWxlIChYIDwgRVgpXHJcbiAgICAgICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICAgICAgdmFyIFRUID0gVC5DbG9uZSgpO1xyXG4gICAgICAgICAgICAgICAgICAgIFRULmNvbHVtbiA9IFg7XHJcbiAgICAgICAgICAgICAgICAgICAgVFQucm93ID0gWTtcclxuICAgICAgICAgICAgICAgICAgICBkYXRhW1gsIFldID0gVFQ7XHJcbiAgICAgICAgICAgICAgICAgICAgWCsrO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgWSsrO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHB1YmxpYyB2b2lkIERyYXdSZWN0KGludCBjb2x1bW4sIGludCByb3csIGludCBXaWR0aCwgaW50IEhlaWdodClcclxuICAgICAgICB7XHJcbiAgICAgICAgICAgIHZhciBYID0gY29sdW1uO1xyXG4gICAgICAgICAgICB2YXIgWSA9IHJvdztcclxuICAgICAgICAgICAgdmFyIFRYID0gWDtcclxuICAgICAgICAgICAgdmFyIFRZID0gWTtcclxuICAgICAgICAgICAgdmFyIEVYID0gWCArIFdpZHRoO1xyXG4gICAgICAgICAgICB2YXIgRVkgPSBZICsgSGVpZ2h0O1xyXG5cclxuICAgICAgICAgICAgd2hpbGUgKFRYIDwgRVgpXHJcbiAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgIFRpbGVEYXRhIFQgPSBuZXcgVGlsZURhdGEoKTtcclxuICAgICAgICAgICAgICAgIFQucm93ID0gVFk7XHJcbiAgICAgICAgICAgICAgICBULmNvbHVtbiA9IFRYO1xyXG4gICAgICAgICAgICAgICAgVC50ZXh0dXJlID0gMTtcclxuICAgICAgICAgICAgICAgIFQuZW5hYmxlZCA9IHRydWU7XHJcbiAgICAgICAgICAgICAgICBULnZpc2libGUgPSB0cnVlO1xyXG4gICAgICAgICAgICAgICAgVC5tYXAgPSB0aGlzO1xyXG4gICAgICAgICAgICAgICAgVC5zb2xpZCA9IHRydWU7XHJcbiAgICAgICAgICAgICAgICBTZXRUaWxlKFRYLCBUWSwgVCk7XHJcbiAgICAgICAgICAgICAgICBUWCsrO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIFRYID0gWDtcclxuICAgICAgICAgICAgVFkgPSBFWTtcclxuICAgICAgICAgICAgd2hpbGUgKFRYIDwgRVgpXHJcbiAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgIFRpbGVEYXRhIFQgPSBuZXcgVGlsZURhdGEoKTtcclxuICAgICAgICAgICAgICAgIFQucm93ID0gVFk7XHJcbiAgICAgICAgICAgICAgICBULmNvbHVtbiA9IFRYO1xyXG4gICAgICAgICAgICAgICAgVC50ZXh0dXJlID0gMTtcclxuICAgICAgICAgICAgICAgIFQuZW5hYmxlZCA9IHRydWU7XHJcbiAgICAgICAgICAgICAgICBULnZpc2libGUgPSB0cnVlO1xyXG4gICAgICAgICAgICAgICAgVC5tYXAgPSB0aGlzO1xyXG4gICAgICAgICAgICAgICAgVC5zb2xpZCA9IHRydWU7XHJcbiAgICAgICAgICAgICAgICBTZXRUaWxlKFRYLCBUWSwgVCk7XHJcbiAgICAgICAgICAgICAgICBUWCsrO1xyXG4gICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICBUWCA9IFg7XHJcbiAgICAgICAgICAgIFRZID0gWTtcclxuICAgICAgICAgICAgd2hpbGUgKFRZIDwgRVkpXHJcbiAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgIFRpbGVEYXRhIFQgPSBuZXcgVGlsZURhdGEoKTtcclxuICAgICAgICAgICAgICAgIFQucm93ID0gVFk7XHJcbiAgICAgICAgICAgICAgICBULmNvbHVtbiA9IFRYO1xyXG4gICAgICAgICAgICAgICAgVC50ZXh0dXJlID0gMTtcclxuICAgICAgICAgICAgICAgIFQuZW5hYmxlZCA9IHRydWU7XHJcbiAgICAgICAgICAgICAgICBULnZpc2libGUgPSB0cnVlO1xyXG4gICAgICAgICAgICAgICAgVC5tYXAgPSB0aGlzO1xyXG4gICAgICAgICAgICAgICAgVC5zb2xpZCA9IHRydWU7XHJcbiAgICAgICAgICAgICAgICBTZXRUaWxlKFRYLCBUWSwgVCk7XHJcbiAgICAgICAgICAgICAgICBUWSsrO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIFRYID0gRVg7XHJcbiAgICAgICAgICAgIFRZID0gWTtcclxuICAgICAgICAgICAgd2hpbGUgKFRZIDwgRVkpXHJcbiAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgIFRpbGVEYXRhIFQgPSBuZXcgVGlsZURhdGEoKTtcclxuICAgICAgICAgICAgICAgIFQucm93ID0gVFk7XHJcbiAgICAgICAgICAgICAgICBULmNvbHVtbiA9IFRYO1xyXG4gICAgICAgICAgICAgICAgVC50ZXh0dXJlID0gMTtcclxuICAgICAgICAgICAgICAgIFQuZW5hYmxlZCA9IHRydWU7XHJcbiAgICAgICAgICAgICAgICBULnZpc2libGUgPSB0cnVlO1xyXG4gICAgICAgICAgICAgICAgVC5tYXAgPSB0aGlzO1xyXG4gICAgICAgICAgICAgICAgVC5zb2xpZCA9IHRydWU7XHJcbiAgICAgICAgICAgICAgICBTZXRUaWxlKFRYLCBUWSwgVCk7XHJcbiAgICAgICAgICAgICAgICBUWSsrO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHB1YmxpYyB2b2lkIERyYXdSZWN0KFJlY3RhbmdsZSByZWN0KVxyXG4gICAgICAgIHtcclxuICAgICAgICAgICAgLyp2YXIgUFggPSAoaW50KSgocG9zaXRpb24uWCAtIFRQLlgpIC8gdGlsZXNpemUpO1xyXG4gICAgICAgICAgICB2YXIgUFkgPSAoaW50KSgocG9zaXRpb24uWSAtIFRQLlkpIC8gdGlsZXNpemUpOyovXHJcbiAgICAgICAgICAgIERyYXdSZWN0KChpbnQpKHJlY3QubGVmdCAvIHRpbGVzaXplKSwgKGludCkocmVjdC50b3AgLyB0aWxlc2l6ZSksIChpbnQpKHJlY3Qud2lkdGggLyB0aWxlc2l6ZSksIChpbnQpKHJlY3QuaGVpZ2h0IC8gdGlsZXNpemUpKTtcclxuICAgICAgICB9XHJcbiAgICAgICAgcHVibGljIHZvaWQgU2V0QWxsKFRpbGVEYXRhIFQpXHJcbiAgICAgICAge1xyXG4gICAgICAgICAgICB2YXIgWCA9IDA7XHJcbiAgICAgICAgICAgIHZhciBZID0gMDtcclxuICAgICAgICAgICAgd2hpbGUgKFkgPCByb3dzKVxyXG4gICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICBYID0gMDtcclxuICAgICAgICAgICAgICAgIHdoaWxlIChYIDwgY29sdW1ucylcclxuICAgICAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgICAgICB2YXIgVEQgPSBULkNsb25lKCk7XHJcbiAgICAgICAgICAgICAgICAgICAgVEQuY29sdW1uID0gWDtcclxuICAgICAgICAgICAgICAgICAgICBURC5yb3cgPSBZO1xyXG4gICAgICAgICAgICAgICAgICAgIGRhdGFbWCwgWV0gPSBUO1xyXG4gICAgICAgICAgICAgICAgICAgIFgrKztcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIFkrKztcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuICAgICAgICBwdWJsaWMgdm9pZCBDbGVhck91dGVyUmVjdChpbnQgY29sdW1uLCBpbnQgcm93LCBpbnQgd2lkdGgsIGludCBoZWlnaHQsYm9vbCBib3R0b209dHJ1ZSlcclxuICAgICAgICB7XHJcbiAgICAgICAgICAgIHZhciBTWCA9IChpbnQpKGNvbHVtbik7XHJcbiAgICAgICAgICAgIHZhciBTWSA9IChpbnQpKHJvdyk7XHJcbiAgICAgICAgICAgIHZhciBFWCA9IChpbnQpKFNYICsgd2lkdGgpO1xyXG4gICAgICAgICAgICB2YXIgRVkgPSAoaW50KShTWSArIGhlaWdodCk7XHJcbiAgICAgICAgICAgIFNYID0gKGludClNYXRoSGVscGVyLkNsYW1wKFNYLCAwLCBjb2x1bW5zIC0gMSk7XHJcbiAgICAgICAgICAgIFNZID0gKGludClNYXRoSGVscGVyLkNsYW1wKFNZLCAwLCByb3dzIC0gMSk7XHJcbiAgICAgICAgICAgIEVYID0gKGludClNYXRoSGVscGVyLkNsYW1wKEVYLCAwLCBjb2x1bW5zIC0gMSk7XHJcbiAgICAgICAgICAgIEVZID0gKGludClNYXRoSGVscGVyLkNsYW1wKEVZLCAwLCByb3dzIC0gMSk7XHJcbiAgICAgICAgICAgIHZhciBYID0gU1g7XHJcbiAgICAgICAgICAgIHZhciBZID0gU1k7XHJcbiAgICAgICAgICAgIHZhciBUID0gbmV3IFRpbGVEYXRhKCk7XHJcbiAgICAgICAgICAgIFQubWFwID0gdGhpcztcclxuICAgICAgICAgICAgVC52aXNpYmxlID0gZmFsc2U7XHJcbiAgICAgICAgICAgIFQuc29saWQgPSBmYWxzZTtcclxuICAgICAgICAgICAgdmFyIFRYID0gWDtcclxuICAgICAgICAgICAgdmFyIFRZID0gWTtcclxuICAgICAgICAgICAgd2hpbGUgKFRYIDwgRVgtMSlcclxuICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgdmFyIFRUID0gVC5DbG9uZSgpO1xyXG4gICAgICAgICAgICAgICAgVFQuY29sdW1uID0gVFg7XHJcbiAgICAgICAgICAgICAgICBUVC5yb3cgPSBUWTtcclxuICAgICAgICAgICAgICAgIFNldFRpbGUoVFgsIFRZLCBUVCk7XHJcbiAgICAgICAgICAgICAgICBUWCsrO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIFRYID0gWDtcclxuICAgICAgICAgICAgVFkgPSBFWTtcclxuICAgICAgICAgICAgaWYgKGJvdHRvbSlcclxuICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgd2hpbGUgKFRYIDwgRVgpXHJcbiAgICAgICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICAgICAgdmFyIFRUID0gVC5DbG9uZSgpO1xyXG4gICAgICAgICAgICAgICAgICAgIFRULmNvbHVtbiA9IFRYO1xyXG4gICAgICAgICAgICAgICAgICAgIFRULnJvdyA9IFRZO1xyXG4gICAgICAgICAgICAgICAgICAgIFNldFRpbGUoVFgsIFRZLCBUVCk7XHJcbiAgICAgICAgICAgICAgICAgICAgVFgrKztcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgVFggPSBYO1xyXG4gICAgICAgICAgICBUWSA9IFk7XHJcbiAgICAgICAgICAgIHdoaWxlIChUWSA8IEVZLTEpXHJcbiAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgIHZhciBUVCA9IFQuQ2xvbmUoKTtcclxuICAgICAgICAgICAgICAgIFRULmNvbHVtbiA9IFRYO1xyXG4gICAgICAgICAgICAgICAgVFQucm93ID0gVFk7XHJcbiAgICAgICAgICAgICAgICBTZXRUaWxlKFRYLCBUWSwgVFQpO1xyXG4gICAgICAgICAgICAgICAgVFkrKztcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBUWCA9IEVYO1xyXG4gICAgICAgICAgICBUWSA9IFk7XHJcbiAgICAgICAgICAgIHdoaWxlIChUWSA8IEVZLTEpXHJcbiAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgIHZhciBUVCA9IFQuQ2xvbmUoKTtcclxuICAgICAgICAgICAgICAgIFRULmNvbHVtbiA9IFRYO1xyXG4gICAgICAgICAgICAgICAgVFQucm93ID0gVFk7XHJcbiAgICAgICAgICAgICAgICBTZXRUaWxlKFRYLCBUWSwgVFQpO1xyXG4gICAgICAgICAgICAgICAgVFkrKztcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuICAgICAgICBwdWJsaWMgdm9pZCBDbGVhclJlY3QoaW50IGNvbHVtbiwgaW50IHJvdywgaW50IHdpZHRoLCBpbnQgaGVpZ2h0KVxyXG4gICAgICAgIHtcclxuICAgICAgICAgICAgdmFyIFNYID0gKGludCkoY29sdW1uKTtcclxuICAgICAgICAgICAgdmFyIFNZID0gKGludCkocm93KTtcclxuICAgICAgICAgICAgdmFyIEVYID0gKGludCkoU1ggKyB3aWR0aCk7XHJcbiAgICAgICAgICAgIHZhciBFWSA9IChpbnQpKFNZICsgaGVpZ2h0KTtcclxuICAgICAgICAgICAgU1ggPSAoaW50KU1hdGhIZWxwZXIuQ2xhbXAoU1gsIDAsIGNvbHVtbnMgLSAxKTtcclxuICAgICAgICAgICAgU1kgPSAoaW50KU1hdGhIZWxwZXIuQ2xhbXAoU1ksIDAsIHJvd3MgLSAxKTtcclxuICAgICAgICAgICAgRVggPSAoaW50KU1hdGhIZWxwZXIuQ2xhbXAoRVgsIDAsIGNvbHVtbnMgLSAxKTtcclxuICAgICAgICAgICAgRVkgPSAoaW50KU1hdGhIZWxwZXIuQ2xhbXAoRVksIDAsIHJvd3MgLSAxKTtcclxuICAgICAgICAgICAgdmFyIFggPSBTWDtcclxuICAgICAgICAgICAgdmFyIFkgPSBTWTtcclxuICAgICAgICAgICAgdmFyIFQgPSBuZXcgVGlsZURhdGEoKTtcclxuICAgICAgICAgICAgVC5tYXAgPSB0aGlzO1xyXG4gICAgICAgICAgICBULnZpc2libGUgPSBmYWxzZTtcclxuICAgICAgICAgICAgVC5zb2xpZCA9IGZhbHNlO1xyXG4gICAgICAgICAgICBULmVuYWJsZWQgPSBmYWxzZTtcclxuICAgICAgICAgICAgd2hpbGUgKFkgPCBFWSlcclxuICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgWCA9IFNYO1xyXG4gICAgICAgICAgICAgICAgd2hpbGUgKFggPCBFWClcclxuICAgICAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgICAgICB2YXIgVFQgPSBULkNsb25lKCk7XHJcbiAgICAgICAgICAgICAgICAgICAgVFQuY29sdW1uID0gWDtcclxuICAgICAgICAgICAgICAgICAgICBUVC5yb3cgPSBZO1xyXG4gICAgICAgICAgICAgICAgICAgIGRhdGFbWCwgWV0gPSBUVDtcclxuICAgICAgICAgICAgICAgICAgICBYKys7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICBZKys7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcbiAgICAgICAgcHVibGljIHZvaWQgQ2xlYXJSZWN0KFJlY3RhbmdsZSByZWN0KVxyXG4gICAgICAgIHtcclxuICAgICAgICAgICAgdmFyIFNYID0gKGludCkocmVjdC5sZWZ0IC8gdGlsZXNpemUpO1xyXG4gICAgICAgICAgICB2YXIgU1kgPSAoaW50KShyZWN0LnRvcCAvIHRpbGVzaXplKTtcclxuICAgICAgICAgICAgdmFyIEVYID0gKGludCkocmVjdC5yaWdodCAvIHRpbGVzaXplKTtcclxuICAgICAgICAgICAgdmFyIEVZID0gKGludCkocmVjdC5oZWlnaHQgLyB0aWxlc2l6ZSk7XHJcbiAgICAgICAgICAgIHZhciBYID0gU1g7XHJcbiAgICAgICAgICAgIHZhciBZID0gU1k7XHJcbiAgICAgICAgICAgIHZhciBUID0gbmV3IFRpbGVEYXRhKCk7XHJcbiAgICAgICAgICAgIFQubWFwID0gdGhpcztcclxuICAgICAgICAgICAgVC52aXNpYmxlID0gZmFsc2U7XHJcbiAgICAgICAgICAgIFQuc29saWQgPSBmYWxzZTtcclxuICAgICAgICAgICAgd2hpbGUgKFkgPCBFWSlcclxuICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgWCA9IFNYO1xyXG4gICAgICAgICAgICAgICAgd2hpbGUgKFggPCBFWClcclxuICAgICAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgICAgICB2YXIgVFQgPSBULkNsb25lKCk7XHJcbiAgICAgICAgICAgICAgICAgICAgVFQuY29sdW1uID0gWDtcclxuICAgICAgICAgICAgICAgICAgICBUVC5yb3cgPSBZO1xyXG4gICAgICAgICAgICAgICAgICAgIGRhdGFbWCwgWV0gPSBUVDtcclxuICAgICAgICAgICAgICAgICAgICBYKys7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICBZKys7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcbiAgICAgICAgcHVibGljIHZvaWQgU2V0VGlsZShpbnQgY29sdW1uLCBpbnQgcm93LCBUaWxlRGF0YSBUKVxyXG4gICAgICAgIHtcclxuICAgICAgICAgICAgaWYgKGNvbHVtbiA+PSAwICYmIHJvdyA+PSAwICYmIGNvbHVtbiA8IGRhdGEuR2V0TGVuZ3RoKDApICYmIHJvdyA8IGRhdGEuR2V0TGVuZ3RoKDEpKVxyXG4gICAgICAgICAgICAgICAgZGF0YVtjb2x1bW4sIHJvd10gPSBUO1xyXG4gICAgICAgIH1cclxuICAgICAgICBwcm90ZWN0ZWQgaW50IGJsdXIoaW50W10gYXJyYXksIGludCBpbmRleCwgaW50IGJsdXIgPSAxKVxyXG4gICAgICAgIHtcclxuICAgICAgICAgICAgaW50IHRvdGFsID0gMDtcclxuICAgICAgICAgICAgaW50IHJldCA9IDA7XHJcbiAgICAgICAgICAgIGludCBpID0gMDtcclxuICAgICAgICAgICAgaW50IGluZCA9IGluZGV4O1xyXG4gICAgICAgICAgICBpZiAoaW5kID49IDAgJiYgaW5kIDwgYXJyYXkuTGVuZ3RoKVxyXG4gICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICB0b3RhbCsrO1xyXG4gICAgICAgICAgICAgICAgcmV0ICs9IGFycmF5W2luZF07XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgd2hpbGUgKGkgPCBibHVyKVxyXG4gICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICBpbmQtLTtcclxuICAgICAgICAgICAgICAgIGlmIChpbmQgPj0gMCAmJiBpbmQgPCBhcnJheS5MZW5ndGgpXHJcbiAgICAgICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICAgICAgdG90YWwrKztcclxuICAgICAgICAgICAgICAgICAgICByZXQgKz0gYXJyYXlbaW5kXTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIGkrKztcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBpID0gMDtcclxuICAgICAgICAgICAgd2hpbGUgKGkgPCBibHVyKVxyXG4gICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICBpbmQrKztcclxuICAgICAgICAgICAgICAgIGlmIChpbmQgPj0gMCAmJiBpbmQgPCBhcnJheS5MZW5ndGgpXHJcbiAgICAgICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICAgICAgdG90YWwrKztcclxuICAgICAgICAgICAgICAgICAgICByZXQgKz0gYXJyYXlbaW5kXTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIGkrKztcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICByZXR1cm4gcmV0IC8gdG90YWw7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHB1YmxpYyBUaWxlRGF0YSBDaGVja0ZvclRpbGUoVmVjdG9yMiBwb3NpdGlvbilcclxuICAgICAgICB7XHJcbiAgICAgICAgICAgIC8qcG9zaXRpb24gPSBwb3NpdGlvbiAtIHRoaXMucG9zaXRpb247XHJcbiAgICAgICAgICAgIHBvc2l0aW9uIC89IHRpbGVzaXplO1xyXG4gICAgICAgICAgICBpZiAocG9zaXRpb24uWD49MCAmJiBwb3NpdGlvbi5YPGNvbHVtbnMgJiYgcG9zaXRpb24uWT49MCAmJiBwb3NpdGlvbi5ZPHJvd3MpXHJcbiAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgIHJldHVybiBkYXRhWyhpbnQpcG9zaXRpb24uWCwgKGludClwb3NpdGlvbi5ZXTtcclxuICAgICAgICAgICAgfSovXHJcbiAgICAgICAgICAgIHZhciBUUCA9IHRoaXMucG9zaXRpb247XHJcbiAgICAgICAgICAgIHZhciBQWCA9IChpbnQpKChwb3NpdGlvbi5YIC0gVFAuWCkgLyB0aWxlc2l6ZSk7XHJcbiAgICAgICAgICAgIHZhciBQWSA9IChpbnQpKChwb3NpdGlvbi5ZIC0gVFAuWSkgLyB0aWxlc2l6ZSk7XHJcbiAgICAgICAgICAgIGlmIChQWCA+PSAwICYmIFBYIDwgY29sdW1ucyAmJiBQWSA+PSAwICYmIFBZIDwgcm93cylcclxuICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuIGRhdGFbUFgsIFBZXTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICByZXR1cm4gbnVsbDtcclxuICAgICAgICB9XHJcbiAgICAgICAgcHVibGljIFRpbGVEYXRhIEdldFRpbGUoaW50IGNvbHVtbiwgaW50IHJvdylcclxuICAgICAgICB7XHJcbiAgICAgICAgICAgIGlmIChjb2x1bW4gPj0gMCAmJiByb3cgPj0gMCAmJiBjb2x1bW4gPCBjb2x1bW5zICYmIHJvdyA8IHJvd3MpXHJcbiAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgIHJldHVybiBkYXRhW2NvbHVtbiwgcm93XTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICByZXR1cm4gbnVsbDtcclxuICAgICAgICB9XHJcbiAgICAgICAgcHJvdGVjdGVkIHZvaWQgX0RyYXcoKVxyXG4gICAgICAgIHtcclxuICAgICAgICAgICAgaWYgKG5lZWRSZWRyYXcvKiAmJiAhQW5pbWF0aW9uTG9hZGVyLl90aGlzLklzTG9hZGluZyhcIlRpbGVcIikqLylcclxuICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgaW50IFcgPSAoaW50KU1hdGguQ2VpbGluZyhjb2x1bW5zICogdGlsZXNpemUpO1xyXG4gICAgICAgICAgICAgICAgaW50IEggPSAoaW50KU1hdGguQ2VpbGluZyhyb3dzICogdGlsZXNpemUpO1xyXG5cclxuICAgICAgICAgICAgICAgIGlmIChidWZmZXIuV2lkdGggIT0gVyB8fCBidWZmZXIuSGVpZ2h0ICE9IEgpXHJcbiAgICAgICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICAgICAgYnVmZmVyLldpZHRoID0gVztcclxuICAgICAgICAgICAgICAgICAgICBidWZmZXIuSGVpZ2h0ID0gSDtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIGVsc2VcclxuICAgICAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgICAgICBiZy5DbGVhclJlY3QoMCwgMCwgYnVmZmVyLldpZHRoLCBidWZmZXIuSGVpZ2h0KTtcclxuICAgICAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgICAgICBSZWRyYXcoYmcpO1xyXG4gICAgICAgICAgICAgICAgbmVlZFJlZHJhdyA9IGZhbHNlO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHByaXZhdGUgUmVjdGFuZ2xlIHJ0bXAgPSBuZXcgUmVjdGFuZ2xlKCk7XHJcbiAgICAgICAgcHVibGljIHZvaWQgRHJhdyhDYW52YXNSZW5kZXJpbmdDb250ZXh0MkQgZylcclxuICAgICAgICB7XHJcbiAgICAgICAgICAgIF9EcmF3KCk7XHJcbiAgICAgICAgICAgIC8vZy5EcmF3SW1hZ2UoYnVmZmVyLCBwb3NpdGlvbi5YLCBwb3NpdGlvbi5ZKTtcclxuICAgICAgICAgICAgcnRtcC5Db3B5RnJvbShnYW1lLmNhbWVyYS5DYW1lcmFCb3VuZHMpO1xyXG4gICAgICAgICAgICAvL2hpZGUgZmxvYXRpbmcgcG9pbnQgc2VhbXMuXHJcbiAgICAgICAgICAgIHJ0bXAueCAtPSAxO1xyXG4gICAgICAgICAgICBydG1wLnkgLT0gMTtcclxuICAgICAgICAgICAgcnRtcC53aWR0aCArPSAyO1xyXG4gICAgICAgICAgICBydG1wLmhlaWdodCArPSAyO1xyXG4gICAgICAgICAgICB2YXIgQ0IgPSBydG1wO1xyXG4gICAgICAgICAgICAvL3ZhciBDQiA9IGdhbWUuY2FtZXJhLkNhbWVyYUJvdW5kcztcclxuICAgICAgICAgICAgLy9nLkRyYXdJbWFnZShidWZmZXIsIENCLmxlZnQtcG9zaXRpb24uWCwgQ0IudG9wLXBvc2l0aW9uLlksIENCLndpZHRoLCBDQi5oZWlnaHQsIENCLmxlZnQsIENCLnRvcCwgQ0Iud2lkdGgsIENCLmhlaWdodCk7Ly9kcmF3IG1hcCBjcm9wcGVkIHRvIGNhbWVyYSBib3VuZHNcclxuICAgICAgICAgICAgZy5EcmF3SW1hZ2UoYnVmZmVyLCBDQi5sZWZ0IC0gcG9zaXRpb24uWCwgQ0IudG9wIC0gcG9zaXRpb24uWSwgQ0Iud2lkdGgsIENCLmhlaWdodCwgQ0IubGVmdCwgQ0IudG9wLCBDQi53aWR0aCwgQ0IuaGVpZ2h0KTsvL2RyYXcgbWFwIGNyb3BwZWQgdG8gY2FtZXJhIGJvdW5kc1xyXG4gICAgICAgIH1cclxuICAgICAgICBwdWJsaWMgdm9pZCBSZWRyYXdUaWxlKGludCBYLCBpbnQgWSwgYm9vbCB1cGRhdGVOZWlnaGJvcnMgPSB0cnVlKVxyXG4gICAgICAgIHtcclxuICAgICAgICAgICAgaWYgKHVwZGF0ZU5laWdoYm9ycylcclxuICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgaW50IFRYID0gKFggLSAxKSAqIChpbnQpdGlsZXNpemU7XHJcbiAgICAgICAgICAgICAgICBpbnQgVFkgPSAoWSAtIDEpICogKGludCl0aWxlc2l6ZTtcclxuICAgICAgICAgICAgICAgIGJnLkNsZWFyUmVjdChUWCwgVFksIChpbnQpdGlsZXNpemUgKiAzLCAoaW50KXRpbGVzaXplICogMyk7XHJcblxyXG4gICAgICAgICAgICAgICAgUmVkcmF3KGJnLCBYIC0gMSwgWSAtIDEsIDMsIDMpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIGVsc2VcclxuICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgaW50IFRYID0gKFgpICogKGludCl0aWxlc2l6ZTtcclxuICAgICAgICAgICAgICAgIGludCBUWSA9IChZKSAqIChpbnQpdGlsZXNpemU7XHJcbiAgICAgICAgICAgICAgICBiZy5DbGVhclJlY3QoVFgsIFRZLCAoaW50KXRpbGVzaXplLCAoaW50KXRpbGVzaXplKTtcclxuXHJcbiAgICAgICAgICAgICAgICBSZWRyYXcoYmcsIFgsIFksIDEsIDEpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBwdWJsaWMgdm9pZCBSZWRyYXcoQ2FudmFzUmVuZGVyaW5nQ29udGV4dDJEIGcsIGludCBTWCA9IC0xLCBpbnQgU1kgPSAtMSwgaW50IFcgPSAtMSwgaW50IEggPSAtMSlcclxuICAgICAgICB7XHJcbiAgICAgICAgICAgIGZsb2F0IFBYID0gcG9zaXRpb24uWDtcclxuICAgICAgICAgICAgZmxvYXQgUFkgPSBwb3NpdGlvbi5ZO1xyXG4gICAgICAgICAgICBQWCA9IDA7XHJcbiAgICAgICAgICAgIFBZID0gMDtcclxuICAgICAgICAgICAgaWYgKFNYID09IC0xKVxyXG4gICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICBTWCA9IDA7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgaWYgKFNZID09IC0xKVxyXG4gICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICBTWSA9IDA7XHJcbiAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgIGlmIChXID09IC0xKVxyXG4gICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICBXID0gY29sdW1ucztcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBpZiAoSCA9PSAtMSlcclxuICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgSCA9IHJvd3M7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgdmFyIEVYID0gU1ggKyBXO1xyXG4gICAgICAgICAgICB2YXIgRVkgPSBTWSArIEg7XHJcbiAgICAgICAgICAgIFNYID0gKGludClNYXRoSGVscGVyLkNsYW1wKFNYLCAwLCBjb2x1bW5zKTtcclxuICAgICAgICAgICAgU1kgPSAoaW50KU1hdGhIZWxwZXIuQ2xhbXAoU1ksIDAsIHJvd3MpO1xyXG5cclxuICAgICAgICAgICAgRVggPSAoaW50KU1hdGhIZWxwZXIuQ2xhbXAoRVgsIDAsIGNvbHVtbnMpO1xyXG4gICAgICAgICAgICBFWSA9IChpbnQpTWF0aEhlbHBlci5DbGFtcChFWSwgMCwgcm93cyk7XHJcblxyXG4gICAgICAgICAgICBmbG9hdCBYID0gUFggKyAoU1ggKiB0aWxlc2l6ZSk7XHJcbiAgICAgICAgICAgIGZsb2F0IFkgPSBQWSArIChTWSAqIHRpbGVzaXplKTtcclxuICAgICAgICAgICAgaW50IHJvdyA9IFNZO1xyXG4gICAgICAgICAgICBpbnQgY29sdW1uID0gU1g7XHJcbiAgICAgICAgICAgIHZhciBCRyA9IHRpbGVzWzJdO1xyXG4gICAgICAgICAgICAvL3ZhciBCRzIgPSB0aWxlc1szXTtcclxuICAgICAgICAgICAgdmFyIEJHMiA9IG5ldyBIVE1MSW1hZ2VFbGVtZW50W10geyB0aWxlc1szXSwgdGlsZXNbOV0sIHRpbGVzWzEwXSB9O1xyXG4gICAgICAgICAgICB2YXIgdGlsZXNDID0gdGlsZXMuQ291bnQ7XHJcblxyXG4gICAgICAgICAgICBSZWN0YW5nbGUgUiA9IG5ldyBSZWN0YW5nbGUoKTtcclxuICAgICAgICAgICAgdmFyIGRvb3Jyb29tID0gTWFwR2VuZXJhdG9yLmRvb3Jyb29tO1xyXG4gICAgICAgICAgICB2YXIga2V5cm9vbSA9IE1hcEdlbmVyYXRvci5rZXlyb29tO1xyXG4gICAgICAgICAgICB2YXIgZG9vcnJvb21jb2xvciA9IFwiIzAwMDAwMFwiO1xyXG4gICAgICAgICAgICAvL3ZhciBrZXlyb29tY29sb3IgPSBcIiNDQzAwMDBcIjtcclxuICAgICAgICAgICAgLy92YXIga2V5cm9vbWNvbG9yID0gXCIjMTE4ODIyXCI7XHJcbiAgICAgICAgICAgIHZhciBrZXlyb29tY29sb3IgPSBcIiM1NTg4MjJcIjtcclxuXHJcbiAgICAgICAgICAgIHZhciBncmFkY29sb3IgPSBcIiMwMDAwNzdcIjtcclxuICAgICAgICAgICAgLy8vdmFyIEFncmFkY29sb3IgPSBcIiMxMTg4MjJcIjtcclxuICAgICAgICAgICAgdmFyIEFncmFkY29sb3IgPSBcIiNDQzAwMDBcIjtcclxuXHJcbiAgICAgICAgICAgIHZhciBEWCA9IDA7XHJcbiAgICAgICAgICAgIHZhciBEWSA9IDA7XHJcblxyXG4gICAgICAgICAgICBpZiAoZG9vcnJvb20gIT0gbnVsbClcclxuICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgRFggPSAoZG9vcnJvb20uU1ggKyBkb29ycm9vbS5FWCkgLyAyO1xyXG4gICAgICAgICAgICAgICAgRFkgPSAoZG9vcnJvb20uU1kgKyBkb29ycm9vbS5FWSkgLyAyO1xyXG4gICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICB3aGlsZSAocm93IDwgRVkpXHJcbiAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgIHdoaWxlIChjb2x1bW4gPCBFWClcclxuICAgICAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgICAgICAvL2lmIChSLmlzVG91Y2hpbmcobmV3IFJlY3RhbmdsZShYLCBZLCB0aWxlc2l6ZSwgdGlsZXNpemUpKSlcclxuICAgICAgICAgICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIFRpbGVEYXRhIFQgPSBkYXRhW2NvbHVtbiwgcm93XTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgdmFyIHRleCA9IE1hdGguTWluKHRpbGVzLkNvdW50IC0gMSwgVC50ZXh0dXJlKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKFQuZW5hYmxlZCAmJiB0ZXggPj0gMCAmJiB0ZXggPCB0aWxlc0MpXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGcuRHJhd0ltYWdlKHRpbGVzW3RleF0sIFgsIFkpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKFQuQnJlYWthYmxlICYmIFQuSFAgPCBULm1heEhQKVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGludCBkbWcgPSAoaW50KU1hdGguTWF4KDEsIE1hdGguTWluKE1hdGguUm91bmQoVC5tYXhIUCAtIFQuSFApLCAzKSkgLSAxO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGcuRHJhd0ltYWdlKGNyYWNrc1tkbWddLCBYLCBZKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGludCBzZCA9IFQuU2xvcGVEaXJlY3Rpb247XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoc2QgIT0gMClcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAvL29iamVjdCBzZyA9IGc7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLy9TY3JpcHQuV3JpdGUoXCJzZy5nbG9iYWxDb21wb3NpdGVPcGVyYXRpb24gPSAnZGVzdGluYXRpb24tb3V0J1wiKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBnLkdsb2JhbENvbXBvc2l0ZU9wZXJhdGlvbiA9IENhbnZhc1R5cGVzLkNhbnZhc0NvbXBvc2l0ZU9wZXJhdGlvblR5cGUuRGVzdGluYXRpb25PdXQ7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgVC5HZXRIaXRib3gyKFIpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIFIueCAtPSBwb3NpdGlvbi5YO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIFIueSAtPSBwb3NpdGlvbi5ZO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGcuQmVnaW5QYXRoKCk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZy5Nb3ZlVG8oUi5sZWZ0LCBSLnRvcCk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgVmVjdG9yMiBQO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIFAgPSBuZXcgVmVjdG9yMihSLmxlZnQgKyAoUi53aWR0aCAvIDJmKSwgUi50b3AgKyAoUi5oZWlnaHQgLyAyZikpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChzZCA+IDApXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBnLkxpbmVUbyhSLmxlZnQsIFIuYm90dG9tKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZWxzZVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZy5MaW5lVG8oUi5yaWdodCwgUi5ib3R0b20pO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZy5MaW5lVG8oUi5yaWdodCwgUi50b3ApO1xyXG5cclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBnLkxpbmVUbyhSLmxlZnQsIFIudG9wKTtcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZy5GaWxsKCk7XHJcblxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGcuR2xvYmFsQ29tcG9zaXRlT3BlcmF0aW9uID0gQ2FudmFzVHlwZXMuQ2FudmFzQ29tcG9zaXRlT3BlcmF0aW9uVHlwZS5EZXN0aW5hdGlvbk92ZXI7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLyppZiAoZG9vcnJvb20hPW51bGwgJiYgZG9vcnJvb20uQ29udGFpbnNUaWxlKGNvbHVtbiwgcm93KSlcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGcuR2xvYmFsQWxwaGEgPSAwLjU1ZjtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZy5GaWxsU3R5bGUgPSBkb29ycm9vbWNvbG9yO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAvL2cuRmlsbFJlY3QoUi54LlRvRHluYW1pYygpLCBSLnkuVG9EeW5hbWljKCksIFIud2lkdGguVG9EeW5hbWljKCksIFIuaGVpZ2h0LlRvRHluYW1pYygpKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZy5GaWxsUmVjdChYLlRvRHluYW1pYygpLCBZLlRvRHluYW1pYygpLCB0aWxlc2l6ZS5Ub0R5bmFtaWMoKSwgdGlsZXNpemUuVG9EeW5hbWljKCkpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBnLkdsb2JhbEFscGhhID0gMWY7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVsc2UgKi9pZiAoa2V5cm9vbSAhPSBudWxsICYmIGtleXJvb20uQ29udGFpbnNUaWxlKGNvbHVtbiwgcm93KSlcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGcuR2xvYmFsQWxwaGEgPSAwLjE3ZjtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZy5GaWxsU3R5bGUgPSBrZXlyb29tY29sb3I7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vZy5GaWxsUmVjdChSLnguVG9EeW5hbWljKCksIFIueS5Ub0R5bmFtaWMoKSwgUi53aWR0aC5Ub0R5bmFtaWMoKSwgUi5oZWlnaHQuVG9EeW5hbWljKCkpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBnLkZpbGxSZWN0KFguVG9EeW5hbWljKCksIFkuVG9EeW5hbWljKCksIHRpbGVzaXplLlRvRHluYW1pYygpLCB0aWxlc2l6ZS5Ub0R5bmFtaWMoKSk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGcuR2xvYmFsQWxwaGEgPSAxZjtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZWxzZSBpZiAoZG9vcnJvb20hPW51bGwpXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgRGlzdCA9IE1hdGguTWF4KE1hdGguQWJzKGNvbHVtbiAtIERYKSArIE1hdGguQWJzKHJvdyAtIERZKSAtIDUsIDApO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgQSA9IDAuNWYgLSAoRGlzdCAqIDAuMDNmKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFyIEcgPSBncmFkY29sb3I7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChBIDwgMClcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLy9BID0gTWF0aC5NaW4oKC1BICogMC41MGYpIC0gMC4yMmYsIDAuMzBmKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIEEgPSAoLUEgKiAwLjUwZikgLSAwLjIyZjtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIEcgPSBBZ3JhZGNvbG9yO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKEEgPiAwLjNmKVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIEEgPSAwLjZmIC0gQTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoQSA8IDApXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAvKkEgPSAtQTsqL1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBHID0gZ3JhZGNvbG9yO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBBID0gMDtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChBID4gMClcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZy5HbG9iYWxBbHBoYSA9IEE7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBnLkZpbGxTdHlsZSA9IEc7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBnLkZpbGxSZWN0KFguVG9EeW5hbWljKCksIFkuVG9EeW5hbWljKCksIHRpbGVzaXplLlRvRHluYW1pYygpLCB0aWxlc2l6ZS5Ub0R5bmFtaWMoKSk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBnLkdsb2JhbEFscGhhID0gMWY7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZy5EcmF3SW1hZ2UoQkcsIFgsIFkpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGcuR2xvYmFsQ29tcG9zaXRlT3BlcmF0aW9uID0gQ2FudmFzVHlwZXMuQ2FudmFzQ29tcG9zaXRlT3BlcmF0aW9uVHlwZS5Tb3VyY2VPdmVyO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgZWxzZSBpZiAoIVQub3BhcXVlKVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGcuR2xvYmFsQ29tcG9zaXRlT3BlcmF0aW9uID0gQ2FudmFzVHlwZXMuQ2FudmFzQ29tcG9zaXRlT3BlcmF0aW9uVHlwZS5EZXN0aW5hdGlvbk92ZXI7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLyppZiAoZG9vcnJvb20hPW51bGwgJiYgZG9vcnJvb20uQ29udGFpbnNUaWxlKGNvbHVtbiwgcm93KSlcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGcuR2xvYmFsQWxwaGEgPSAwLjU1ZjtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZy5GaWxsU3R5bGUgPSBkb29ycm9vbWNvbG9yO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAvL2cuRmlsbFJlY3QoUi54LlRvRHluYW1pYygpLCBSLnkuVG9EeW5hbWljKCksIFIud2lkdGguVG9EeW5hbWljKCksIFIuaGVpZ2h0LlRvRHluYW1pYygpKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZy5GaWxsUmVjdChYLlRvRHluYW1pYygpLCBZLlRvRHluYW1pYygpLCB0aWxlc2l6ZS5Ub0R5bmFtaWMoKSwgdGlsZXNpemUuVG9EeW5hbWljKCkpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBnLkdsb2JhbEFscGhhID0gMWY7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVsc2UgKi9cclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoa2V5cm9vbSAhPSBudWxsICYmIGtleXJvb20uQ29udGFpbnNUaWxlKGNvbHVtbiwgcm93KSlcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGcuR2xvYmFsQWxwaGEgPSAwLjE3ZjtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZy5GaWxsU3R5bGUgPSBrZXlyb29tY29sb3I7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vZy5GaWxsUmVjdChSLnguVG9EeW5hbWljKCksIFIueS5Ub0R5bmFtaWMoKSwgUi53aWR0aC5Ub0R5bmFtaWMoKSwgUi5oZWlnaHQuVG9EeW5hbWljKCkpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBnLkZpbGxSZWN0KFguVG9EeW5hbWljKCksIFkuVG9EeW5hbWljKCksIHRpbGVzaXplLlRvRHluYW1pYygpLCB0aWxlc2l6ZS5Ub0R5bmFtaWMoKSk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGcuR2xvYmFsQWxwaGEgPSAxZjtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZWxzZSBpZiAoZG9vcnJvb20gIT0gbnVsbClcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhciBEaXN0ID0gTWF0aC5NYXgoTWF0aC5BYnMoY29sdW1uIC0gRFgpICsgTWF0aC5BYnMocm93IC0gRFkpIC0gNSwgMCk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhciBBID0gMC41ZiAtIChEaXN0ICogMC4wM2YpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgRyA9IGdyYWRjb2xvcjtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKEEgPCAwKVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAvL0EgPSBNYXRoLk1pbigoLUEgKiAwLjUwZikgLSAwLjIyZiwgMC4zMGYpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgQSA9ICgtQSAqIDAuNTBmKSAtIDAuMjJmO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgRyA9IEFncmFkY29sb3I7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoQSA+IDAuM2YpXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgQSA9IDAuNmYgLSBBO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChBIDwgMClcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8qQSA9IC1BOyovXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIEcgPSBncmFkY29sb3I7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIEEgPSAwO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKEEgPiAwKVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBnLkdsb2JhbEFscGhhID0gQTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGcuRmlsbFN0eWxlID0gRztcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGcuRmlsbFJlY3QoWC5Ub0R5bmFtaWMoKSwgWS5Ub0R5bmFtaWMoKSwgdGlsZXNpemUuVG9EeW5hbWljKCksIHRpbGVzaXplLlRvRHluYW1pYygpKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGcuR2xvYmFsQWxwaGEgPSAxZjtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBnLkRyYXdJbWFnZShCRywgWCwgWSk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZy5HbG9iYWxDb21wb3NpdGVPcGVyYXRpb24gPSBDYW52YXNUeXBlcy5DYW52YXNDb21wb3NpdGVPcGVyYXRpb25UeXBlLlNvdXJjZU92ZXI7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGVsc2VcclxuICAgICAgICAgICAgICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFyIHRleHR1cmUgPSBCRztcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vaWYgKE1hdGguUmFuZG9tKCkgPj0gMC45OClcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChNYXRoLlJhbmRvbSgpID49IDAuOTcpXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdGV4dHVyZSA9IENpcm5vR2FtZS5IZWxwZXJFeHRlbnNpb25zLlBpY2s8Z2xvYmFsOjpCcmlkZ2UuSHRtbDUuSFRNTEltYWdlRWxlbWVudD4oQkcyKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vZy5EcmF3SW1hZ2UoTWF0aC5SYW5kb20oKSA8IDAuOTggPyBCRyA6IEJHMiwgWCwgWSk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBnLkRyYXdJbWFnZSh0ZXh0dXJlLCBYLCBZKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8qaWYgKGRvb3Jyb29tICE9IG51bGwgJiYgZG9vcnJvb20uQ29udGFpbnNUaWxlKGNvbHVtbiwgcm93KSlcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBnLkdsb2JhbEFscGhhID0gMC41NWY7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZy5GaWxsU3R5bGUgPSBkb29ycm9vbWNvbG9yO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGcuRmlsbFJlY3QoWC5Ub0R5bmFtaWMoKSwgWS5Ub0R5bmFtaWMoKSwgdGlsZXNpemUuVG9EeW5hbWljKCksIHRpbGVzaXplLlRvRHluYW1pYygpKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBnLkdsb2JhbEFscGhhID0gMWY7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBlbHNlICovaWYgKGtleXJvb20gIT0gbnVsbCAmJiBrZXlyb29tLkNvbnRhaW5zVGlsZShjb2x1bW4sIHJvdykpXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLypULkdldEhpdGJveDIoUik7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgUi54IC09IHBvc2l0aW9uLlg7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgUi55IC09IHBvc2l0aW9uLlk7Ki9cclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBnLkdsb2JhbEFscGhhID0gMC4xN2Y7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZy5GaWxsU3R5bGUgPSBrZXlyb29tY29sb3I7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZy5GaWxsUmVjdChYLlRvRHluYW1pYygpLCBZLlRvRHluYW1pYygpLCB0aWxlc2l6ZS5Ub0R5bmFtaWMoKSwgdGlsZXNpemUuVG9EeW5hbWljKCkpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGcuR2xvYmFsQWxwaGEgPSAxZjtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVsc2UgaWYgKGRvb3Jyb29tICE9IG51bGwpXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFyIERpc3QgPSBNYXRoLk1heChNYXRoLkFicyhjb2x1bW4gLSBEWCkgKyBNYXRoLkFicyhyb3cgLSBEWSktNSwwKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgQSA9IDAuNWYgLSAoRGlzdCAqIDAuMDNmKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgRyA9IGdyYWRjb2xvcjtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoQSA8IDApXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAvL0EgPSBNYXRoLk1pbigoLUEgKiAwLjUwZikgLSAwLjIyZiwgMC4zMGYpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBBID0gKC1BICogMC41MGYpIC0gMC4yMmY7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIEcgPSBBZ3JhZGNvbG9yO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoQSA+IDAuM2YpXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIEEgPSAwLjZmIC0gQTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChBIDwgMClcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAvKkEgPSAtQTsqL1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIEcgPSBncmFkY29sb3I7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgQSA9IDA7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChBID4gMClcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGcuR2xvYmFsQWxwaGEgPSBBO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBnLkZpbGxTdHlsZSA9IEc7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGcuRmlsbFJlY3QoWC5Ub0R5bmFtaWMoKSwgWS5Ub0R5bmFtaWMoKSwgdGlsZXNpemUuVG9EeW5hbWljKCksIHRpbGVzaXplLlRvRHluYW1pYygpKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZy5HbG9iYWxBbHBoYSA9IDFmO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICBjb2x1bW4rKztcclxuICAgICAgICAgICAgICAgICAgICBYICs9IHRpbGVzaXplO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgWCA9IFBYICsgKFNYICogdGlsZXNpemUpO1xyXG4gICAgICAgICAgICAgICAgWSArPSB0aWxlc2l6ZTtcclxuICAgICAgICAgICAgICAgIGNvbHVtbiA9IFNYO1xyXG4gICAgICAgICAgICAgICAgcm93Kys7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcbiAgICAgICAgcHVibGljIGJvb2wgSXNFeHBvc2VkKGludCBYLCBpbnQgWSlcclxuICAgICAgICB7XHJcbiAgICAgICAgICAgIGludCByb3cgPSBZIC0gMjtcclxuICAgICAgICAgICAgaW50IGNvbHVtbiA9IFggLSAyO1xyXG4gICAgICAgICAgICBUaWxlRGF0YVtdIFREUmF3ID0gZGF0YS5BczxUaWxlRGF0YVtdPigpO1xyXG4gICAgICAgICAgICBpbnQgaW5kID0gMDtcclxuICAgICAgICAgICAgaW50IGxpbmQgPSAwO1xyXG5cclxuICAgICAgICAgICAgaW5kID0gY29sdW1uICogcm93cztcclxuICAgICAgICAgICAgaW5kICs9IHJvdztcclxuXHJcbiAgICAgICAgICAgIHdoaWxlIChyb3cgPD0gWSArIDIpXHJcbiAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgIGxpbmQgPSBpbmQ7XHJcbiAgICAgICAgICAgICAgICB3aGlsZSAoY29sdW1uIDw9IFggKyAyKVxyXG4gICAgICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgICAgIC8qdmFyIFQgPSBkYXRhW2NvbHVtbiwgcm93XTtcclxuICAgICAgICAgICAgICAgICAgICBULnRleHR1cmUgPSBNYXRoLlJhbmRvbSgpIDwgMC41ID8gMCA6IDE7Ki9cclxuICAgICAgICAgICAgICAgICAgICBpZiAocm93ID49IDAgJiYgY29sdW1uID49IDAgJiYgcm93IDwgcm93cyAmJiBjb2x1bW4gPCBjb2x1bW5zKVxyXG4gICAgICAgICAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgLy92YXIgVCA9IGRhdGFbY29sdW1uLCByb3ddO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB2YXIgVCA9IFREUmF3W2luZF07XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmICghVC5lbmFibGVkIHx8ICFULnNvbGlkKVxyXG4gICAgICAgICAgICAgICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gdHJ1ZTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICBjb2x1bW4rKztcclxuICAgICAgICAgICAgICAgICAgICBpbmQgKz0gcm93cztcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIGluZCA9IGxpbmQ7XHJcbiAgICAgICAgICAgICAgICBpbmQgKz0gMTtcclxuICAgICAgICAgICAgICAgIHJvdysrO1xyXG4gICAgICAgICAgICAgICAgY29sdW1uID0gWCAtIDI7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xyXG4gICAgICAgIH1cclxuICAgICAgICBwdWJsaWMgdm9pZCBBcHBseUJyZWFrYWJsZVJlY3QoaW50IFNYID0gLTEsIGludCBTWSA9IC0xLCBpbnQgVyA9IC0xLCBpbnQgSCA9IC0xKVxyXG4gICAgICAgIHtcclxuICAgICAgICAgICAgaWYgKFNYID09IC0xKVxyXG4gICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICBTWCA9IDA7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgaWYgKFNZID09IC0xKVxyXG4gICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICBTWSA9IDA7XHJcbiAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgIGlmIChXID09IC0xKVxyXG4gICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICBXID0gY29sdW1ucztcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBpZiAoSCA9PSAtMSlcclxuICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgSCA9IHJvd3M7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgdmFyIEVYID0gU1ggKyBXO1xyXG4gICAgICAgICAgICB2YXIgRVkgPSBTWSArIEg7XHJcbiAgICAgICAgICAgIFNYID0gKGludClNYXRoSGVscGVyLkNsYW1wKFNYLCAwLCBjb2x1bW5zKTtcclxuICAgICAgICAgICAgU1kgPSAoaW50KU1hdGhIZWxwZXIuQ2xhbXAoU1ksIDAsIHJvd3MpO1xyXG5cclxuICAgICAgICAgICAgRVggPSAoaW50KU1hdGhIZWxwZXIuQ2xhbXAoRVgsIDAsIGNvbHVtbnMpO1xyXG4gICAgICAgICAgICBFWSA9IChpbnQpTWF0aEhlbHBlci5DbGFtcChFWSwgMCwgcm93cyk7XHJcbiAgICAgICAgICAgIGludCByb3cgPSBTWDtcclxuICAgICAgICAgICAgaW50IGNvbHVtbiA9IFNZO1xyXG5cclxuICAgICAgICAgICAgd2hpbGUgKHJvdyA8IEVZKVxyXG4gICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICB3aGlsZSAoY29sdW1uIDwgRVgpXHJcbiAgICAgICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICAgICAgLyp2YXIgVCA9IGRhdGFbY29sdW1uLCByb3ddO1xyXG4gICAgICAgICAgICAgICAgICAgIFQudGV4dHVyZSA9IE1hdGguUmFuZG9tKCkgPCAwLjUgPyAwIDogMTsqL1xyXG4gICAgICAgICAgICAgICAgICAgIHZhciBUID0gZGF0YVtjb2x1bW4sIHJvd107XHJcbiAgICAgICAgICAgICAgICAgICAgdmFyIFRUID0gVC5DbG9uZSgpO1xyXG4gICAgICAgICAgICAgICAgICAgIFRULmNvbHVtbiA9IGNvbHVtbjtcclxuICAgICAgICAgICAgICAgICAgICBUVC5yb3cgPSByb3c7XHJcbiAgICAgICAgICAgICAgICAgICAgZGF0YVtjb2x1bW4sIHJvd10gPSBUVDtcclxuICAgICAgICAgICAgICAgICAgICBUID0gVFQ7XHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKElzRXhwb3NlZChjb2x1bW4sIHJvdykpXHJcbiAgICAgICAgICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBULnRleHR1cmUgPSAxO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAoTWF0aC5SYW5kb20oKSA8IDAuMDIpXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIFQudGV4dHVyZSA9IE1hdGguUmFuZG9tKCkgPCAwLjUgPyA1IDogNjtcclxuICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgICAgICBULkJyZWFrYWJsZSA9IHRydWU7XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgIGVsc2VcclxuICAgICAgICAgICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIFQudGV4dHVyZSA9IDA7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIFQuQnJlYWthYmxlID0gZmFsc2U7XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgIGNvbHVtbisrO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgcm93Kys7XHJcbiAgICAgICAgICAgICAgICBjb2x1bW4gPSBTWDtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBuZWVkUmVkcmF3ID0gdHJ1ZTtcclxuICAgICAgICB9XHJcbiAgICAgICAgcHVibGljIHZvaWQgQXBwbHlCcmVha2FibGUoKVxyXG4gICAgICAgIHtcclxuICAgICAgICAgICAgaW50IHJvdyA9IDA7XHJcbiAgICAgICAgICAgIGludCBjb2x1bW4gPSAwO1xyXG4gICAgICAgICAgICBUaWxlRGF0YVtdIFREUmF3ID0gZGF0YS5BczxUaWxlRGF0YVtdPigpO1xyXG4gICAgICAgICAgICBpbnQgaW5kID0gMDtcclxuICAgICAgICAgICAgaW50IGxpbmQgPSAwO1xyXG5cclxuICAgICAgICAgICAgd2hpbGUgKHJvdyA8IHJvd3MpXHJcbiAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgIGxpbmQgPSBpbmQ7XHJcbiAgICAgICAgICAgICAgICB3aGlsZSAoY29sdW1uIDwgY29sdW1ucylcclxuICAgICAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgICAgICAvKnZhciBUID0gZGF0YVtjb2x1bW4sIHJvd107XHJcbiAgICAgICAgICAgICAgICAgICAgVC50ZXh0dXJlID0gTWF0aC5SYW5kb20oKSA8IDAuNSA/IDAgOiAxOyovXHJcblxyXG4gICAgICAgICAgICAgICAgICAgIHZhciBUID0gVERSYXdbaW5kXTtcclxuICAgICAgICAgICAgICAgICAgICAvL3ZhciBUID0gZGF0YVtjb2x1bW4sIHJvd107XHJcbiAgICAgICAgICAgICAgICAgICAgdmFyIFRUID0gVC5DbG9uZSgpO1xyXG4gICAgICAgICAgICAgICAgICAgIFRULmNvbHVtbiA9IGNvbHVtbjtcclxuICAgICAgICAgICAgICAgICAgICBUVC5yb3cgPSByb3c7XHJcbiAgICAgICAgICAgICAgICAgICAgLy9kYXRhW2NvbHVtbiwgcm93XSA9IFRUO1xyXG4gICAgICAgICAgICAgICAgICAgIFREUmF3W2luZF0gPSBUVDtcclxuICAgICAgICAgICAgICAgICAgICBUID0gVFQ7XHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKElzRXhwb3NlZChjb2x1bW4sIHJvdykpXHJcbiAgICAgICAgICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBULnRleHR1cmUgPSAxO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAoTWF0aC5SYW5kb20oKSA8IDAuMDIpXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIFQudGV4dHVyZSA9IE1hdGguUmFuZG9tKCkgPCAwLjUgPyA1IDogNjtcclxuICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgICAgICBULkJyZWFrYWJsZSA9IHRydWU7XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgIGVsc2VcclxuICAgICAgICAgICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIFQudGV4dHVyZSA9IDA7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIFQuQnJlYWthYmxlID0gZmFsc2U7XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgIGNvbHVtbisrO1xyXG4gICAgICAgICAgICAgICAgICAgIGluZCArPSByb3dzO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgaW5kID0gbGluZDtcclxuICAgICAgICAgICAgICAgIHJvdysrO1xyXG4gICAgICAgICAgICAgICAgLy9pbmQgLT0gKGNvbHVtbnMgKiByb3dzKTtcclxuICAgICAgICAgICAgICAgIGNvbHVtbiA9IDA7XHJcbiAgICAgICAgICAgICAgICBcclxuICAgICAgICAgICAgICAgIGluZCArPSAxO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIG5lZWRSZWRyYXcgPSB0cnVlO1xyXG4gICAgICAgIH1cclxuICAgICAgICBwdWJsaWMgdm9pZCB0ZXN0VGV4dHVyZSgpXHJcbiAgICAgICAge1xyXG4gICAgICAgICAgICBpbnQgcm93ID0gMDtcclxuICAgICAgICAgICAgaW50IGNvbHVtbiA9IDA7XHJcblxyXG4gICAgICAgICAgICB3aGlsZSAocm93IDwgcm93cylcclxuICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgd2hpbGUgKGNvbHVtbiA8IGNvbHVtbnMpXHJcbiAgICAgICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICAgICAgdmFyIFQgPSBkYXRhW2NvbHVtbiwgcm93XTtcclxuICAgICAgICAgICAgICAgICAgICBULnRleHR1cmUgPSBNYXRoLlJhbmRvbSgpIDwgMC41ID8gMCA6IDE7XHJcbiAgICAgICAgICAgICAgICAgICAgY29sdW1uKys7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICByb3crKztcclxuICAgICAgICAgICAgICAgIGNvbHVtbiA9IDA7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgbmVlZFJlZHJhdyA9IHRydWU7XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG59XHJcbiIsInVzaW5nIFN5c3RlbTtcclxudXNpbmcgU3lzdGVtLkNvbGxlY3Rpb25zLkdlbmVyaWM7XHJcbnVzaW5nIFN5c3RlbS5MaW5xO1xyXG51c2luZyBTeXN0ZW0uVGV4dDtcclxudXNpbmcgU3lzdGVtLlRocmVhZGluZy5UYXNrcztcclxuXHJcbm5hbWVzcGFjZSBDaXJub0dhbWVcclxue1xyXG4gICAgcHVibGljIGNsYXNzIFZlY3RvcjJcclxuICAgIHtcclxuICAgICAgICBwdWJsaWMgZmxvYXQgWDtcclxuICAgICAgICBwdWJsaWMgZmxvYXQgWTtcclxuICAgICAgICBwdWJsaWMgZmxvYXQgTGVuZ3RoXHJcbiAgICAgICAge1xyXG4gICAgICAgICAgICBnZXRcclxuICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuIChmbG9hdClNYXRoLlNxcnQoKFggKiBYKSArIChZICogWSkpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHB1YmxpYyBmbG9hdCBEaXN0YW5jZShWZWN0b3IyIFApXHJcbiAgICAgICAge1xyXG4gICAgICAgICAgICB2YXIgWFggPSBYIC0gUC5YO1xyXG4gICAgICAgICAgICB2YXIgWVkgPSBZIC0gUC5ZO1xyXG4gICAgICAgICAgICByZXR1cm4gKGZsb2F0KU1hdGguU3FydCgoWFggKiBYWCkgKyAoWVkgKiBZWSkpO1xyXG4gICAgICAgIH1cclxuICAgICAgICAvLy8gPHN1bW1hcnk+XHJcbiAgICAgICAgLy8vIFJldHVybnMgYSByb3VnaCBlc3RpbWF0ZSBvZiB0aGUgdmVjdG9yJ3MgbGVuZ3RoLlxyXG4gICAgICAgIC8vLyA8L3N1bW1hcnk+XHJcbiAgICAgICAgcHVibGljIGZsb2F0IEVzdGltYXRlZExlbmd0aFxyXG4gICAgICAgIHtcclxuICAgICAgICAgICAgZ2V0XHJcbiAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgIHZhciBBID0gTWF0aC5BYnMoWCk7XHJcbiAgICAgICAgICAgICAgICB2YXIgQiA9IE1hdGguQWJzKFkpO1xyXG4gICAgICAgICAgICAgICAgaWYgKEIgPiBBKVxyXG4gICAgICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgICAgIHZhciB0bXAgPSBBO1xyXG4gICAgICAgICAgICAgICAgICAgIEEgPSBCO1xyXG4gICAgICAgICAgICAgICAgICAgIEIgPSB0bXA7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICBCICo9IDAuMzQ7XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gKGZsb2F0KShBICsgQik7XHJcbiAgICAgICAgICAgICAgICAvL3JldHVybiAoZmxvYXQpKE1hdGguQWJzKFgpICsgTWF0aC5BYnMoWSkpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG4gICAgICAgIC8vLyA8c3VtbWFyeT5cclxuICAgICAgICAvLy8gUmV0dXJucyBhIHJvdWdoIGVzdGltYXRlIG9mIHRoZSB2ZWN0b3IncyBsZW5ndGguXHJcbiAgICAgICAgLy8vIDwvc3VtbWFyeT5cclxuICAgICAgICBwdWJsaWMgZmxvYXQgRXN0aW1hdGVkRGlzdGFuY2UoVmVjdG9yMiBQKVxyXG4gICAgICAgIHtcclxuICAgICAgICAgICAgdmFyIEEgPSBNYXRoLkFicyhYIC0gUC5YKTtcclxuICAgICAgICAgICAgdmFyIEIgPSBNYXRoLkFicyhZIC0gUC5ZKTtcclxuICAgICAgICAgICAgaWYgKEIgPiBBKVxyXG4gICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICB2YXIgdG1wID0gQTtcclxuICAgICAgICAgICAgICAgIEEgPSBCO1xyXG4gICAgICAgICAgICAgICAgQiA9IHRtcDtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBCICo9IDAuMzQ7XHJcbiAgICAgICAgICAgIHJldHVybiAoZmxvYXQpKEEgKyBCKTtcclxuICAgICAgICAgICAgLy9yZXR1cm4gKGZsb2F0KShNYXRoLkFicyhYKSArIE1hdGguQWJzKFkpKTtcclxuICAgICAgICB9XHJcbiAgICAgICAgLy8vIDxzdW1tYXJ5PlxyXG4gICAgICAgIC8vLyBSZXR1cm5zIHRoZSBzdW0gb2YgaXRzIGFic29sdXRlIHBhcnRzLlxyXG4gICAgICAgIC8vLyA8L3N1bW1hcnk+XHJcbiAgICAgICAgcHVibGljIGZsb2F0IFJvdWdoTGVuZ3RoXHJcbiAgICAgICAge1xyXG4gICAgICAgICAgICBnZXRcclxuICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuIChmbG9hdCkoTWF0aC5BYnMoWCkgKyBNYXRoLkFicyhZKSk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcbiAgICAgICAgcHVibGljIFZlY3RvcjIoZmxvYXQgeCA9IDAsIGZsb2F0IHkgPSAwKVxyXG4gICAgICAgIHtcclxuICAgICAgICAgICAgdGhpcy5YID0geDtcclxuICAgICAgICAgICAgdGhpcy5ZID0geTtcclxuICAgICAgICB9XHJcbiAgICAgICAgcHVibGljIHZvaWQgTXVsdGlwbHkoZmxvYXQgZilcclxuICAgICAgICB7XHJcbiAgICAgICAgICAgIFggKj0gZjtcclxuICAgICAgICAgICAgWSAqPSBmO1xyXG4gICAgICAgIH1cclxuICAgICAgICBwdWJsaWMgVmVjdG9yMiBSb3VnaE5vcm1hbGl6ZShmbG9hdCBsZW5ndGggPSAxKVxyXG4gICAgICAgIHtcclxuICAgICAgICAgICAgZmxvYXQgRCA9IExlbmd0aCAvIGxlbmd0aDtcclxuICAgICAgICAgICAgcmV0dXJuIG5ldyBWZWN0b3IyKFggLyBELCBZIC8gRCk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHB1YmxpYyBWZWN0b3IyIE5vcm1hbGl6ZShmbG9hdCBsZW5ndGggPSAxKVxyXG4gICAgICAgIHtcclxuICAgICAgICAgICAgZmxvYXQgZGlzdGFuY2UgPSBNYXRoLlNxcnQoWCAqIFggKyBZICogWSkuQXM8ZmxvYXQ+KCk7XHJcbiAgICAgICAgICAgIFZlY3RvcjIgViA9IG5ldyBWZWN0b3IyKCk7XHJcbiAgICAgICAgICAgIFYuWCA9IFggLyBkaXN0YW5jZTtcclxuICAgICAgICAgICAgVi5ZID0gWSAvIGRpc3RhbmNlO1xyXG4gICAgICAgICAgICBWLlggKj0gbGVuZ3RoO1xyXG4gICAgICAgICAgICBWLlkgKj0gbGVuZ3RoO1xyXG4gICAgICAgICAgICByZXR1cm4gVjtcclxuICAgICAgICB9XHJcbiAgICAgICAgcHVibGljIHZvaWQgU2V0QXNOb3JtYWxpemUoZmxvYXQgbGVuZ3RoID0gMSlcclxuICAgICAgICB7XHJcbiAgICAgICAgICAgIGZsb2F0IGRpc3RhbmNlID0gTWF0aC5TcXJ0KFggKiBYICsgWSAqIFkpLkFzPGZsb2F0PigpO1xyXG4gICAgICAgICAgICBYID0gWCAvIGRpc3RhbmNlO1xyXG4gICAgICAgICAgICBZID0gWSAvIGRpc3RhbmNlO1xyXG4gICAgICAgICAgICBYICo9IGxlbmd0aDtcclxuICAgICAgICAgICAgWSAqPSBsZW5ndGg7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHB1YmxpYyBWZWN0b3IyIFRvQ2FyZGluYWwoKVxyXG4gICAgICAgIHtcclxuICAgICAgICAgICAgdmFyIHggPSBYO1xyXG4gICAgICAgICAgICB2YXIgeSA9IFk7XHJcbiAgICAgICAgICAgIHZhciBBID0gTWF0aC5BYnMoWCk7XHJcbiAgICAgICAgICAgIHZhciBCID0gTWF0aC5BYnMoWSk7XHJcbiAgICAgICAgICAgIGlmIChCID4gQSlcclxuICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgeCA9IDA7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgZWxzZSBpZiAoQSA+IEIpXHJcbiAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgIHkgPSAwO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIHJldHVybiBuZXcgVmVjdG9yMih4LCB5KTtcclxuICAgICAgICB9XHJcbiAgICAgICAgcHVibGljIGJvb2wgRXF1YWxzKFZlY3RvcjIgbylcclxuICAgICAgICB7XHJcbiAgICAgICAgICAgIFZlY3RvcjIgQiA9IChWZWN0b3IyKW87XHJcbiAgICAgICAgICAgIGlmICh0aGlzICE9IEIgJiYgQiA9PSBudWxsKVxyXG4gICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgcmV0dXJuIEIuWCA9PSBYICYmIEIuWSA9PSBZO1xyXG4gICAgICAgIH1cclxuICAgICAgICBwdWJsaWMgb3ZlcnJpZGUgYm9vbCBFcXVhbHMob2JqZWN0IG8pXHJcbiAgICAgICAge1xyXG4gICAgICAgICAgICBpZiAobyBpcyBWZWN0b3IyKVxyXG4gICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICBWZWN0b3IyIEIgPSAoVmVjdG9yMilvO1xyXG4gICAgICAgICAgICAgICAgaWYgKHRoaXMgIT0gQiAmJiBCID09IG51bGwpXHJcbiAgICAgICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgcmV0dXJuIEIuWCA9PSBYICYmIEIuWSA9PSBZO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIHJldHVybiBiYXNlLkVxdWFscyhvKTtcclxuICAgICAgICB9XHJcbiAgICAgICAgcHVibGljIHN0YXRpYyBib29sIG9wZXJhdG9yID09KFZlY3RvcjIgQSwgVmVjdG9yMiBCKVxyXG4gICAgICAgIHtcclxuICAgICAgICAgICAgb2JqZWN0IE9BID0gQTtcclxuICAgICAgICAgICAgb2JqZWN0IE9CID0gQjtcclxuICAgICAgICAgICAgaWYgKChPQSA9PSBudWxsIHx8IE9CID09IG51bGwpICYmIChPQSAhPSBudWxsIHx8IE9CICE9IG51bGwpKVxyXG4gICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgaWYgKE9BID09IG51bGwgJiYgT0IgPT0gbnVsbClcclxuICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuIHRydWU7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgcmV0dXJuIEEuWCA9PSBCLlggJiYgQS5ZID09IEIuWTtcclxuICAgICAgICAgICAgLy9yZXR1cm4gZmFsc2U7XHJcbiAgICAgICAgICAgIGlmICgoKE9iamVjdClBKSAhPSAoKE9iamVjdClCKSAmJiAoQSA9PSBudWxsIHx8IEIgPT0gbnVsbCkpXHJcbiAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICByZXR1cm4gKEEuWCA9PSBCLlggJiYgQS5ZID09IEIuWSk7XHJcbiAgICAgICAgICAgIHJldHVybiAoKChPYmplY3QpQSkgIT0gKChPYmplY3QpQikpIHx8IChBLlggPT0gQi5YICYmIEEuWSA9PSBCLlkpO1xyXG4gICAgICAgIH1cclxuICAgICAgICBwdWJsaWMgc3RhdGljIGJvb2wgb3BlcmF0b3IgIT0oVmVjdG9yMiBBLCBWZWN0b3IyIEIpXHJcbiAgICAgICAge1xyXG4gICAgICAgICAgICByZXR1cm4gIShBID09IEIpO1xyXG4gICAgICAgICAgICBpZiAoKChPYmplY3QpQSkgIT0gKChPYmplY3QpQikgJiYgKEEgPT0gbnVsbCB8fCBCID09IG51bGwpKVxyXG4gICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gdHJ1ZTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICByZXR1cm4gIShBLlggPT0gQi5YICYmIEEuWSA9PSBCLlkpO1xyXG4gICAgICAgICAgICByZXR1cm4gISgoKChPYmplY3QpQSkgIT0gKChPYmplY3QpQikpIHx8IChBLlggPT0gQi5YICYmIEEuWSA9PSBCLlkpKTtcclxuICAgICAgICB9XHJcbiAgICAgICAgcHVibGljIHN0YXRpYyBWZWN0b3IyIG9wZXJhdG9yICooVmVjdG9yMiBBLCBmbG9hdCBzY2FsZSlcclxuICAgICAgICB7XHJcbiAgICAgICAgICAgIHJldHVybiBuZXcgVmVjdG9yMihBLlggKiBzY2FsZSwgQS5ZICogc2NhbGUpO1xyXG4gICAgICAgIH1cclxuICAgICAgICBwdWJsaWMgc3RhdGljIFZlY3RvcjIgb3BlcmF0b3IgLyhWZWN0b3IyIEEsIGZsb2F0IHNjYWxlKVxyXG4gICAgICAgIHtcclxuICAgICAgICAgICAgcmV0dXJuIG5ldyBWZWN0b3IyKEEuWCAvIHNjYWxlLCBBLlkgLyBzY2FsZSk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHB1YmxpYyBzdGF0aWMgVmVjdG9yMiBvcGVyYXRvciArKFZlY3RvcjIgQSwgVmVjdG9yMiBCKVxyXG4gICAgICAgIHtcclxuICAgICAgICAgICAgcmV0dXJuIG5ldyBWZWN0b3IyKEEuWCArIEIuWCwgQS5ZICsgQi5ZKTtcclxuICAgICAgICB9XHJcbiAgICAgICAgcHVibGljIHN0YXRpYyBWZWN0b3IyIG9wZXJhdG9yIC0oVmVjdG9yMiBBLCBWZWN0b3IyIEIpXHJcbiAgICAgICAge1xyXG4gICAgICAgICAgICByZXR1cm4gbmV3IFZlY3RvcjIoQS5YIC0gQi5YLCBBLlkgLSBCLlkpO1xyXG4gICAgICAgIH1cclxuICAgICAgICBwdWJsaWMgc3RhdGljIFZlY3RvcjIgRW1wdHlcclxuICAgICAgICB7XHJcbiAgICAgICAgICAgIGdldFxyXG4gICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gbmV3IFZlY3RvcjIoKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuICAgICAgICBwdWJsaWMgZmxvYXQgVG9BbmdsZSgpXHJcbiAgICAgICAge1xyXG4gICAgICAgICAgICByZXR1cm4gTWF0aEhlbHBlci5XcmFwUmFkaWFucyhNYXRoSGVscGVyLkdldEFuZ2xlKHRoaXMpKTtcclxuICAgICAgICAgICAgLy9yZXR1cm4gTWF0aEhlbHBlci5XcmFwUmFkaWFucyhNYXRoSGVscGVyLkdldEFuZ2xlKG5ldyBWZWN0b3IyKCksIHRoaXMpKTtcclxuICAgICAgICB9XHJcbiAgICAgICAgcHVibGljIHN0YXRpYyBWZWN0b3IyIEZyb21SYWRpYW4oZmxvYXQgcmFkaWFuKVxyXG4gICAgICAgIHtcclxuICAgICAgICAgICAgcmV0dXJuIE1hdGhIZWxwZXIuUmFkaWFuVG9WZWN0b3IocmFkaWFuKTtcclxuICAgICAgICB9XHJcbiAgICAgICAgcHVibGljIFZlY3RvcjIgQ2xvbmUoKVxyXG4gICAgICAgIHtcclxuICAgICAgICAgICAgcmV0dXJuIG5ldyBWZWN0b3IyKFgsIFkpO1xyXG4gICAgICAgIH1cclxuICAgICAgICBwdWJsaWMgdm9pZCBDb3B5RnJvbShWZWN0b3IyIFYpXHJcbiAgICAgICAge1xyXG4gICAgICAgICAgICBpZiAoViA9PSBudWxsKVxyXG4gICAgICAgICAgICAgICAgcmV0dXJuO1xyXG4gICAgICAgICAgICBYID0gVi5YO1xyXG4gICAgICAgICAgICBZID0gVi5ZO1xyXG4gICAgICAgIH1cclxuICAgICAgICBwdWJsaWMgVmVjdG9yMiBSb3RhdGUoZmxvYXQgcmFkaWFuKVxyXG4gICAgICAgIHtcclxuICAgICAgICAgICAgZmxvYXQgYW5nbGUgPSBUb0FuZ2xlKCkgKyByYWRpYW47XHJcbiAgICAgICAgICAgIHJldHVybiBGcm9tUmFkaWFuKGFuZ2xlKS5Ob3JtYWxpemUoTGVuZ3RoKTtcclxuICAgICAgICB9XHJcbiAgICAgICAgcHVibGljIHN0YXRpYyBWZWN0b3IyIEFkZChWZWN0b3IyIEEsIFZlY3RvcjIgQilcclxuICAgICAgICB7XHJcbiAgICAgICAgICAgIHJldHVybiBuZXcgVmVjdG9yMihBLlggKyBCLlgsIEEuWSArIEIuWSk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHB1YmxpYyBzdGF0aWMgVmVjdG9yMiBBZGQoVmVjdG9yMiBBLCBmbG9hdCBYLCBmbG9hdCBZKVxyXG4gICAgICAgIHtcclxuICAgICAgICAgICAgcmV0dXJuIG5ldyBWZWN0b3IyKEEuWCArIFgsIEEuWSArIFkpO1xyXG4gICAgICAgIH1cclxuICAgICAgICBwdWJsaWMgc3RhdGljIFZlY3RvcjIgU3VidHJhY3QoVmVjdG9yMiBBLCBWZWN0b3IyIEIpXHJcbiAgICAgICAge1xyXG4gICAgICAgICAgICByZXR1cm4gbmV3IFZlY3RvcjIoQS5YIC0gQi5YLCBBLlkgLSBCLlkpO1xyXG4gICAgICAgIH1cclxuICAgICAgICBwdWJsaWMgc3RhdGljIFZlY3RvcjIgU3VidHJhY3QoVmVjdG9yMiBBLCBmbG9hdCBYLCBmbG9hdCBZKVxyXG4gICAgICAgIHtcclxuICAgICAgICAgICAgcmV0dXJuIG5ldyBWZWN0b3IyKEEuWCAtIFgsIEEuWSAtIFkpO1xyXG4gICAgICAgIH1cclxuICAgICAgICBwdWJsaWMgdm9pZCBBZGQoVmVjdG9yMiBWKVxyXG4gICAgICAgIHtcclxuICAgICAgICAgICAgWCArPSBWLlg7XHJcbiAgICAgICAgICAgIFkgKz0gVi5ZO1xyXG4gICAgICAgIH1cclxuICAgICAgICBwdWJsaWMgdm9pZCBTdWJ0cmFjdChWZWN0b3IyIFYpXHJcbiAgICAgICAge1xyXG4gICAgICAgICAgICBYIC09IFYuWDtcclxuICAgICAgICAgICAgWSAtPSBWLlk7XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG59XHJcbiIsInVzaW5nIFN5c3RlbTtcclxudXNpbmcgU3lzdGVtLkNvbGxlY3Rpb25zLkdlbmVyaWM7XHJcbnVzaW5nIFN5c3RlbS5MaW5xO1xyXG51c2luZyBTeXN0ZW0uVGV4dDtcclxudXNpbmcgU3lzdGVtLlRocmVhZGluZy5UYXNrcztcclxuXHJcbm5hbWVzcGFjZSBDaXJub0dhbWVcclxue1xyXG4gICAgcHVibGljIGNsYXNzIEFpbWVkU2hvb3RlciA6IEVudGl0eUJlaGF2aW9yXHJcbiAgICB7XHJcbiAgICAgICAgcHJpdmF0ZSBpbnQgdGltZSA9IDA7XHJcbiAgICAgICAgcHVibGljIGludCBtYXh0aW1lID0gNjAgKiA4O1xyXG4gICAgICAgIHB1YmxpYyBFbnRpdHkgVGFyZ2V0O1xyXG4gICAgICAgIC8vcHVibGljIGZsb2F0IG1heERpc3RhbmNlID0gMTIwO1xyXG4gICAgICAgIHB1YmxpYyBmbG9hdCBtYXhEaXN0YW5jZSA9IDEzMDtcclxuICAgICAgICBwdWJsaWMgZmxvYXQgbWF4U2hhZG93ID0gNTtcclxuXHJcbiAgICAgICAgcHVibGljIGZsb2F0IGF0dGFja3Bvd2VyID0gMTtcclxuICAgICAgICBwdWJsaWMgZmxvYXQgYnVsbGV0U3BlZWQgPSAwLjVmO1xyXG4gICAgICAgIHB1YmxpYyBpbnQgYnVsbGV0RHVyYXRpb24gPSA2MCAqIDE1O1xyXG5cclxuICAgICAgICBwdWJsaWMgYm9vbCBpZ25vcmVzdGVycmFpbiA9IGZhbHNlO1xyXG4gICAgICAgIHB1YmxpYyBzdHJpbmcgYnVsbGV0Z3JhcGhpYyA9IFwiZWJ1bGxldFwiO1xyXG4gICAgICAgIHB1YmxpYyBpbnQgYXR0YWNrVGVsZWdyYXBoVGltZSA9IDYwO1xyXG4gICAgICAgIHB1YmxpYyBBaW1lZFNob290ZXIoRW50aXR5IGVudGl0eSkgOiBiYXNlKGVudGl0eSlcclxuICAgICAgICB7XHJcbiAgICAgICAgICAgIC8qZW50aXR5LkFuaS5IdWVDb2xvciA9IFwiI0ZGMDAwMFwiO1xyXG4gICAgICAgICAgICBlbnRpdHkuQW5pLkh1ZVJlY29sb3JTdHJlbmd0aCA9IDIuMGY7Ki9cclxuICAgICAgICAgICAgZW50aXR5LkFuaS5TaGFkb3djb2xvciA9IFwiI0ZGMDAwMFwiO1xyXG4gICAgICAgIH1cclxuICAgICAgICBwdWJsaWMgb3ZlcnJpZGUgdm9pZCBVcGRhdGUoKVxyXG4gICAgICAgIHtcclxuICAgICAgICAgICAgYmFzZS5VcGRhdGUoKTtcclxuICAgICAgICAgICAgVXBkYXRlVGFyZ2V0KCk7XHJcbiAgICAgICAgICAgIHZhciBBID0gZW50aXR5LkFuaTtcclxuXHJcbiAgICAgICAgICAgIFxyXG5cclxuICAgICAgICAgICAgaWYgKFRhcmdldCAhPSBudWxsKVxyXG4gICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICBpZiAodGltZSA8IGF0dGFja1RlbGVncmFwaFRpbWUpXHJcbiAgICAgICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICAgICAgLy9pZiAoKHRpbWUgJiA0KSA+IDApXHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKHRydWUpXHJcbiAgICAgICAgICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAvL0EuU2hhZG93ID0gNi0odGltZSAqIDAuMWYpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBBLlNoYWRvdyA9IG1heFNoYWRvdztcclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgZWxzZVxyXG4gICAgICAgICAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgQS5TaGFkb3cgPSAwO1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIGVsc2VcclxuICAgICAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgICAgICBBLlNoYWRvdyA9IDA7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICB0aW1lLS07XHJcbiAgICAgICAgICAgICAgICBpZiAodGltZSA8PSAwKVxyXG4gICAgICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgICAgIFJlc2V0VGltZXIoKTtcclxuICAgICAgICAgICAgICAgICAgICBTaG9vdCgpO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9ZWxzZVxyXG4gICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICBBLlNoYWRvdyA9IDA7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgLypBLlNoYWRvd2NvbG9yID0gQS5IdWVDb2xvcjtcclxuICAgICAgICAgICAgQS5TaGFkb3cgPSBBLlNoYWRvd2NvbG9yICE9IFwiXCIgPyAwIDogMztcclxuICAgICAgICAgICAgQS5IdWVDb2xvciA9IFwiI0ZGMDAwMFwiO1xyXG4gICAgICAgICAgICBBLkh1ZVJlY29sb3JTdHJlbmd0aCA9IDIuMGY7Ki9cclxuICAgICAgICAgICAgLy9BLlVwZGF0ZSgpO1xyXG5cclxuICAgICAgICB9XHJcbiAgICAgICAgcHJpdmF0ZSB2b2lkIFVwZGF0ZVRhcmdldCgpXHJcbiAgICAgICAge1xyXG4gICAgICAgICAgICBpZiAoVGFyZ2V0ICE9IG51bGwpXHJcbiAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgIGlmIChUYXJnZXQuUG9zaXRpb24uRXN0aW1hdGVkRGlzdGFuY2UoZW50aXR5LlBvc2l0aW9uKSA+IG1heERpc3RhbmNlKVxyXG4gICAgICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgICAgIFRhcmdldCA9IG51bGw7XHJcbiAgICAgICAgICAgICAgICB9ZWxzZVxyXG4gICAgICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgICAgIHJldHVybjtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB2YXIgVCA9IGVudGl0eS5HYW1lLnBsYXllcjtcclxuICAgICAgICAgICAgaWYgKFQuUG9zaXRpb24uRXN0aW1hdGVkRGlzdGFuY2UoZW50aXR5LlBvc2l0aW9uKTxtYXhEaXN0YW5jZSl7XHJcbiAgICAgICAgICAgICAgICBUYXJnZXQgPSBUO1xyXG4gICAgICAgICAgICAgICAgUmVzZXRUaW1lcigpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHByaXZhdGUgdm9pZCBSZXNldFRpbWVyKClcclxuICAgICAgICB7XHJcbiAgICAgICAgICAgIHRpbWUgPSAobWF4dGltZS8yKTtcclxuICAgICAgICAgICAgdGltZSArPSAoaW50KU1hdGguUm91bmQodGltZSAqIE1hdGguUmFuZG9tKCkpO1xyXG4gICAgICAgIH1cclxuICAgICAgICBwcml2YXRlIHZvaWQgU2hvb3QoKVxyXG4gICAgICAgIHtcclxuICAgICAgICAgICAgaWYgKFRhcmdldCA9PSBudWxsIHx8ICgoSUNvbWJhdGFudClUYXJnZXQpLkhQPD0wKVxyXG4gICAgICAgICAgICAgICAgcmV0dXJuO1xyXG4gICAgICAgICAgICB2YXIgUCA9IG5ldyBQbGF5ZXJCdWxsZXQoZW50aXR5LkdhbWUsIGVudGl0eSwgXCJpbWFnZXMvbWlzYy9cIitidWxsZXRncmFwaGljKTtcclxuICAgICAgICAgICAgUC5Qb3NpdGlvbi5Db3B5RnJvbShlbnRpdHkuZ2V0Q2VudGVyKCkpO1xyXG4gICAgICAgICAgICBcclxuICAgICAgICAgICAgdmFyIEQgPSAoVGFyZ2V0LmdldENlbnRlcigpIC0gUC5Qb3NpdGlvbik7XHJcbiAgICAgICAgICAgIEQuU2V0QXNOb3JtYWxpemUoYnVsbGV0U3BlZWQpO1xyXG4gICAgICAgICAgICBQLkhzcGVlZCA9IEQuWDtcclxuICAgICAgICAgICAgUC5Wc3BlZWQgPSBELlk7XHJcbiAgICAgICAgICAgIFAudG91Y2hEYW1hZ2UgPSBhdHRhY2twb3dlcjtcclxuICAgICAgICAgICAgUC5pZ25vcmVzdGVycmFpbiA9IGlnbm9yZXN0ZXJyYWluO1xyXG4gICAgICAgICAgICBQLkR1cmF0aW9uID0gYnVsbGV0RHVyYXRpb247XHJcbiAgICAgICAgICAgIGVudGl0eS5HYW1lLkFkZEVudGl0eShQKTtcclxuICAgICAgICB9XHJcbiAgICB9XHJcbn1cclxuIiwidXNpbmcgU3lzdGVtO1xyXG51c2luZyBTeXN0ZW0uQ29sbGVjdGlvbnMuR2VuZXJpYztcclxudXNpbmcgU3lzdGVtLkxpbnE7XHJcbnVzaW5nIFN5c3RlbS5UZXh0O1xyXG51c2luZyBTeXN0ZW0uVGhyZWFkaW5nLlRhc2tzO1xyXG5cclxubmFtZXNwYWNlIENpcm5vR2FtZVxyXG57XHJcbiAgICBwdWJsaWMgY2xhc3MgQ2hlc3QgOiBFbnRpdHlcclxuICAgIHtcclxuICAgICAgICBwdWJsaWMgQ2hlc3QoR2FtZSBnYW1lKSA6IGJhc2UoZ2FtZSlcclxuICAgICAgICB7XHJcbiAgICAgICAgICAgIEFuaSA9IG5ldyBBbmltYXRpb24oQW5pbWF0aW9uTG9hZGVyLl90aGlzLkdldEFuaW1hdGlvbihcImltYWdlcy9taXNjL2NoZXN0XCIpKTtcclxuICAgICAgICAgICAgQW5pLkltYWdlU3BlZWQgPSAwO1xyXG4gICAgICAgICAgICBpZiAoTWF0aC5SYW5kb20oKSA8IDAuMTUpXHJcbiAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgIEhlYXJ0aWZ5KCk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcbiAgICAgICAgcHVibGljIHZvaWQgR29sZGlmeSgpXHJcbiAgICAgICAge1xyXG4gICAgICAgICAgICB2YXIgUCA9IEFuaS5Qb3NpdGlvbjtcclxuICAgICAgICAgICAgQW5pID0gbmV3IEFuaW1hdGlvbihBbmltYXRpb25Mb2FkZXIuX3RoaXMuR2V0QW5pbWF0aW9uKFwiaW1hZ2VzL21pc2MvZ29sZGNoZXN0XCIpKTtcclxuICAgICAgICAgICAgQW5pLkltYWdlU3BlZWQgPSAwO1xyXG4gICAgICAgICAgICBBbmkuUG9zaXRpb24uQ29weUZyb20oUCk7XHJcbiAgICAgICAgICAgIEdvbGRlbiA9IHRydWU7XHJcbiAgICAgICAgICAgIEhlYXJ0ID0gZmFsc2U7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHB1YmxpYyB2b2lkIEhlYXJ0aWZ5KClcclxuICAgICAgICB7XHJcbiAgICAgICAgICAgIHZhciBQID0gQW5pLlBvc2l0aW9uO1xyXG4gICAgICAgICAgICBBbmkgPSBuZXcgQW5pbWF0aW9uKEFuaW1hdGlvbkxvYWRlci5fdGhpcy5HZXRBbmltYXRpb24oXCJpbWFnZXMvbWlzYy9waW5rY2hlc3RcIikpO1xyXG4gICAgICAgICAgICBBbmkuSW1hZ2VTcGVlZCA9IDA7XHJcbiAgICAgICAgICAgIEFuaS5Qb3NpdGlvbi5Db3B5RnJvbShQKTtcclxuICAgICAgICAgICAgSGVhcnQgPSB0cnVlO1xyXG4gICAgICAgIH1cclxuICAgICAgICBwdWJsaWMgYm9vbCBGb3JjZUxvY2tlZCA9IGZhbHNlO1xyXG4gICAgICAgIHB1YmxpYyBib29sIEdvbGRlbiB7IGdldDsgcHJpdmF0ZSBzZXQ7IH1cclxuICAgICAgICBwdWJsaWMgYm9vbCBPcGVuZWQgeyBnZXQ7IHByaXZhdGUgc2V0OyB9XHJcbiAgICAgICAgcHVibGljIGJvb2wgSGVhcnQgeyBnZXQ7IHByaXZhdGUgc2V0OyB9XHJcbiAgICAgICAgcHVibGljIG92ZXJyaWRlIHZvaWQgVXBkYXRlKClcclxuICAgICAgICB7XHJcbiAgICAgICAgICAgIGJhc2UuVXBkYXRlKCk7XHJcbiAgICAgICAgICAgIHZhciBGID0gR2V0Rmxvb3IoKTtcclxuICAgICAgICAgICAgaWYgKEYgPT0gbnVsbClcclxuICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgVnNwZWVkID0gMjtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBlbHNlXHJcbiAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgIFZzcGVlZCA9IDA7XHJcbiAgICAgICAgICAgICAgICB5ID0gRi5HZXRIaXRib3goKS50b3AgLSBBbmkuQ3VycmVudEltYWdlLkhlaWdodDtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB2YXIgUCA9IChQbGF5ZXJDaGFyYWN0ZXIpR2FtZS5wbGF5ZXI7XHJcbiAgICAgICAgICAgIGlmIChQLlBvc2l0aW9uLkVzdGltYXRlZERpc3RhbmNlKFBvc2l0aW9uKSA8IDE2KVxyXG4gICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICBpZiAoIUZvcmNlTG9ja2VkKVxyXG4gICAgICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgICAgIGlmICghT3BlbmVkICYmIFAuQ29udHJvbGxlclsyXSAmJiAoUC5rZXlzID4gMCB8fCBHb2xkZW4pKVxyXG4gICAgICAgICAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKCFHb2xkZW4pXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIFAua2V5cy0tO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIE9wZW4oUCk7XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgZWxzZSBpZiAoUC5Db250cm9sbGVyWzJdKVxyXG4gICAgICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgICAgIFAuTVNHLkNoYW5nZVRleHQoXCJJdCdzIHNlYWxlZCB3aXRoIG1hZ2ljLi4uXCIpO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHN0cmluZ1tdIFR1cGxlTmFtZXMgPSBuZXcgc3RyaW5nW117XCJOdWxsXCIsXCJTaW5nbGVcIixcIkRvdWJsZVwiLFwiVHJpcGxlXCIsXCJRdWFkcnVwbGVcIixcIlF1aW50dXBsZVwiLFwiU2V4dHVwbGVcIixcIlNlcHR1cGxlXCIsXCJPY3R1cGxlXCIsIFwiTm9udXBsZVwiLFwiRGVjdXBsZVwifTtcclxuICAgICAgICBwcml2YXRlIHZvaWQgT3BlbihQbGF5ZXJDaGFyYWN0ZXIgcGxheWVyKVxyXG4gICAgICAgIHtcclxuICAgICAgICAgICAgaWYgKCFPcGVuZWQpXHJcbiAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgIFBsYXlTb3VuZChcImNoZXN0b3BlblwiKTtcclxuICAgICAgICAgICAgICAgIEFuaS5DdXJyZW50RnJhbWUgPSAxO1xyXG4gICAgICAgICAgICAgICAgQW5pLlNldEltYWdlKCk7XHJcbiAgICAgICAgICAgICAgICBBbmkuVXBkYXRlKCk7XHJcbiAgICAgICAgICAgICAgICBPcGVuZWQgPSB0cnVlO1xyXG4gICAgICAgICAgICAgICAgLy9UT0RPOmdpdmUgcGxheWVyIGEgcGVybWFuZW50IHVwZ3JhZGUsIGFuZCBkaXNwbGF5IHRleHQgYWJvdmUgdGhlIGNoZXN0IHRlbGxpbmcgdGhlIHBsYXllciB3aGF0IHRoZXkganVzdCBnb3RcclxuICAgICAgICAgICAgICAgIHZhciBNID0gXCJcIjtcclxuICAgICAgICAgICAgICAgIHZhciBvayA9IHRydWU7XHJcbiAgICAgICAgICAgICAgICB2YXIgUyA9IFwiXCI7XHJcbiAgICAgICAgICAgICAgICB2YXIgY29sb3IgPSBcIiNGRkZGRkZcIjtcclxuICAgICAgICAgICAgICAgIHN0cmluZ1tdIHBpY2tlciA9IG51bGw7XHJcbiAgICAgICAgICAgICAgICB3aGlsZSAob2spXHJcbiAgICAgICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICAgICAgdmFyIGNvbW1vbiA9IG5ldyBzdHJpbmdbXSB7IFwicG9pbnRcIiwgXCJwb2ludFwiLCBcInBvaW50XCIsIFwicG9pbnRcIiwgXCJwb2ludFwiLCBcInBvaW50XCIsIFwiaGVhcnRcIiwgXCJoZWFydFwiLCBcInRyaXBsZWhlYXJ0XCIsIFwic2luZ2xlb3JiXCIgfTtcclxuICAgICAgICAgICAgICAgICAgICB2YXIgcmFyZSA9IG5ldyBzdHJpbmdbXSB7IFwiYXR0YWNrcG93ZXJcIiwgXCJkZWZlbnNlcG93ZXJcIiwgXCJtaW5pbmdcIiB9O1xyXG4gICAgICAgICAgICAgICAgICAgIHZhciBsZWdlbmRhcnkgPSBuZXcgc3RyaW5nW10geyBcInRyaXBsZWp1bXBcIiwgXCJjaGVhcGVyYmxvY2tzXCIsIFwiaW52aW5jaWJpbGl0eVwiLCBcInJlcGVhdGVyXCIsXCJtb3Zlc3BlZWRcIiB9O1xyXG5cclxuICAgICAgICAgICAgICAgICAgICB2YXIgaGVhcnRUYWJsZSA9IG5ldyBzdHJpbmdbXSB7IFwic3VwZXJ0cmlwbGVoZWFydFwiIH07XHJcblxyXG5cclxuICAgICAgICAgICAgICAgICAgICB2YXIgUiA9IE1hdGguUmFuZG9tKCk7XHJcbiAgICAgICAgICAgICAgICAgICAgc3RyaW5nIEM7XHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKEhlYXJ0KVxyXG4gICAgICAgICAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgQyA9IENpcm5vR2FtZS5IZWxwZXJFeHRlbnNpb25zLlBpY2s8c3RyaW5nPihoZWFydFRhYmxlKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgUyA9IFwiY29tbW9uXCI7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGNvbG9yID0gXCIjRkZGRkZGXCI7XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgIGVsc2VcclxuICAgICAgICAgICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChwaWNrZXIgPT0gbnVsbCB8fCBNYXRoLlJhbmRvbSgpIDwgMC4yMClcclxuICAgICAgICAgICAgICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKFIgPCAwLjYwICYmICFHb2xkZW4pXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcGlja2VyID0gY29tbW9uO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIFMgPSBcImNvbW1vblwiO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbG9yID0gXCIjRkZGRkZGXCI7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBlbHNlXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgUiA9IE1hdGguUmFuZG9tKCk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKFIgPCAwLjkxKVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcGlja2VyID0gcmFyZTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgUyA9IFwicmFyZVwiO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb2xvciA9IFwiI0ZGQkIzM1wiO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBlbHNlXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBwaWNrZXIgPSBsZWdlbmRhcnk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIFMgPSBcImxlZ2VuZGFyeVwiO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb2xvciA9IFwiI0ZGNTVGRlwiO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAodHJ1ZSlcclxuICAgICAgICAgICAgICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgQyA9IENpcm5vR2FtZS5IZWxwZXJFeHRlbnNpb25zLlBpY2s8c3RyaW5nPihwaWNrZXIpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGVsc2VcclxuICAgICAgICAgICAgICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgcGlja2VyID0gbGVnZW5kYXJ5O1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgUyA9IFwibGVnZW5kYXJ5XCI7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb2xvciA9IFwiI0ZGNTVGRlwiO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgQyA9IFwibW92ZXNwZWVkXCI7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgb2sgPSBmYWxzZTtcclxuICAgICAgICAgICAgICAgICAgICBDb2xsZWN0YWJsZUl0ZW0gQ0k7XHJcbiAgICAgICAgICAgICAgICAgICAgc3dpdGNoIChDKVxyXG4gICAgICAgICAgICAgICAgICAgIHtcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGNhc2UgXCJwb2ludFwiOlxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFyIFAgPSBuZXcgUG9pbnRJdGVtKEdhbWUpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgUC5Qb3NpdGlvbi5Db3B5RnJvbShQb3NpdGlvbik7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBQLlZzcGVlZCA9IC0yZjtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIFAuSHNwZWVkID0gLTJmO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgUC5jb2xsZWN0aW9uRGVsYXkgPSAzMDtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIEdhbWUuQWRkRW50aXR5KFApO1xyXG5cclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIFAgPSBuZXcgUG9pbnRJdGVtKEdhbWUpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgUC5Qb3NpdGlvbi5Db3B5RnJvbShQb3NpdGlvbik7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBQLlZzcGVlZCA9IC0yZjtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIFAuSHNwZWVkID0gMmY7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBQLmNvbGxlY3Rpb25EZWxheSA9IDMwO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgR2FtZS5BZGRFbnRpdHkoUCk7XHJcblxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgTSA9IFwiUG9pbnRzXCI7XHJcblxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGNhc2UgXCJoZWFydFwiOlxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHBsYXllci5IUCA+PSBwbGF5ZXIubWF4SFApXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgb2sgPSB0cnVlO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFyIEggPSBuZXcgSGVhbGluZ0l0ZW0oR2FtZSk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBILlBvc2l0aW9uLkNvcHlGcm9tKFBvc2l0aW9uKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIEguVnNwZWVkID0gLTJmO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgSC5jb2xsZWN0aW9uRGVsYXkgPSAzMDtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIEdhbWUuQWRkRW50aXR5KEgpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgTSA9IFwiSGVhbFwiO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGNhc2UgXCJ0cmlwbGVoZWFydFwiOlxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKChwbGF5ZXIuSFAgPiBwbGF5ZXIubWF4SFAgLyAzKSAmJiAhSGVhcnQpXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgb2sgPSB0cnVlO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFyIEgxID0gbmV3IEhlYWxpbmdJdGVtKEdhbWUpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgSDEuUG9zaXRpb24uQ29weUZyb20oUG9zaXRpb24pO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgSDEuVnNwZWVkID0gLTJmO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgSDEuSHNwZWVkID0gLTJmO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgSDEuY29sbGVjdGlvbkRlbGF5ID0gMzA7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBHYW1lLkFkZEVudGl0eShIMSk7XHJcblxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgSDEgPSBuZXcgSGVhbGluZ0l0ZW0oR2FtZSk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBIMS5Qb3NpdGlvbi5Db3B5RnJvbShQb3NpdGlvbik7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBIMS5Wc3BlZWQgPSAtMmY7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBIMS5Ic3BlZWQgPSAwO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgSDEuY29sbGVjdGlvbkRlbGF5ID0gMzA7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBHYW1lLkFkZEVudGl0eShIMSk7XHJcblxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgSDEgPSBuZXcgSGVhbGluZ0l0ZW0oR2FtZSk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBIMS5Qb3NpdGlvbi5Db3B5RnJvbShQb3NpdGlvbik7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBIMS5Wc3BlZWQgPSAtMmY7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBIMS5Ic3BlZWQgPSAyZjtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIEgxLmNvbGxlY3Rpb25EZWxheSA9IDMwO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgR2FtZS5BZGRFbnRpdHkoSDEpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgTSA9IFwiSGVhbCB4M1wiO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGNhc2UgXCJzdXBlcnRyaXBsZWhlYXJ0XCI6XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoKHBsYXllci5IUCA+IHBsYXllci5tYXhIUCAvIDMpICYmICFIZWFydClcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBvayA9IHRydWU7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBIMSA9IG5ldyBIZWFsaW5nSXRlbShHYW1lKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIEgxLlBvc2l0aW9uLkNvcHlGcm9tKFBvc2l0aW9uKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIEgxLlZzcGVlZCA9IC0yZjtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIEgxLkhzcGVlZCA9IC0yZjtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIEgxLmhlYWxpbmdQb3dlciAqPSAxLjVmO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgSDEuY29sbGVjdGlvbkRlbGF5ID0gMzA7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBHYW1lLkFkZEVudGl0eShIMSk7XHJcblxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgSDEgPSBuZXcgSGVhbGluZ0l0ZW0oR2FtZSk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBIMS5Qb3NpdGlvbi5Db3B5RnJvbShQb3NpdGlvbik7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBIMS5Wc3BlZWQgPSAtMmY7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBIMS5Ic3BlZWQgPSAwO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgSDEuaGVhbGluZ1Bvd2VyICo9IDEuNWY7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBIMS5jb2xsZWN0aW9uRGVsYXkgPSAzMDtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIEdhbWUuQWRkRW50aXR5KEgxKTtcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBIMSA9IG5ldyBIZWFsaW5nSXRlbShHYW1lKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIEgxLlBvc2l0aW9uLkNvcHlGcm9tKFBvc2l0aW9uKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIEgxLlZzcGVlZCA9IC0yZjtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIEgxLkhzcGVlZCA9IDJmO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgSDEuaGVhbGluZ1Bvd2VyICo9IDEuNWY7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBIMS5jb2xsZWN0aW9uRGVsYXkgPSAzMDtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIEdhbWUuQWRkRW50aXR5KEgxKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIE0gPSBcIkhlYWwrXCI7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBicmVhaztcclxuICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSBcInNpbmdsZW9yYlwiOlxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKEdhbWUudGltZVJlbWFpbmluZyA+IDApXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgb2sgPSB0cnVlO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgQ0kgPSBuZXcgT3JiKEdhbWUpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgQ0kuUG9zaXRpb24uQ29weUZyb20oUG9zaXRpb24pO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgQ0kuVnNwZWVkID0gLTJmO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgQ0kuSHNwZWVkID0gLTJmO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgQ0kuY29sbGVjdGlvbkRlbGF5ID0gMzA7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBHYW1lLkFkZEVudGl0eShDSSk7XHJcblxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgLypDSSA9IG5ldyBPcmIoR2FtZSk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBDSS5Qb3NpdGlvbi5Db3B5RnJvbShQb3NpdGlvbik7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBDSS5Wc3BlZWQgPSAtMmY7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBDSS5Ic3BlZWQgPSAyZjtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIENJLmNvbGxlY3Rpb25EZWxheSA9IDMwO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgR2FtZS5BZGRFbnRpdHkoQ0kpOyovXHJcblxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgTSA9IFwiT3JiXCI7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBicmVhaztcclxuICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSBcIm1pbmluZ1wiOlxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHBsYXllci5kaWdwb3dlciA8IDIuMGYpXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcGxheWVyLmRpZ3Bvd2VyICs9IDAuNWY7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBlbHNlXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgb2sgPSB0cnVlO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgTSA9IFwiTWluaW5nIFBvd2VyIFwiICsgKHBsYXllci5kaWdwb3dlcikgKyBcInhcIjtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBjYXNlIFwidHJpcGxlanVtcFwiOlxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFyIFBDID0gcGxheWVyLkdldEJlaGF2aW9yPFBsYXRmb3JtZXJDb250cm9scz4oKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChQQy5tYXhBaXJKdW1wcyA8IDIpXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgUEMubWF4QWlySnVtcHMgPSAyO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgZWxzZVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG9rID0gdHJ1ZTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIE0gPSBcIlRyaXBsZSBKdW1wXCI7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBicmVhaztcclxuICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSBcImNoZWFwZXJibG9ja3NcIjpcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChwbGF5ZXIuYmxvY2twcmljZSAhPSA0KVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG9rID0gdHJ1ZTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBicmVhaztcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHBsYXllci5ibG9ja3ByaWNlID0gMTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIE0gPSBcIkJsb2NrcyBhcmUgY2hlYXBlciBub3dcIjtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBjYXNlIFwibW92ZXNwZWVkXCI6XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAocGxheWVyLmRhdGEuQ29udGFpbnNLZXkoXCJtb3Zlc3BlZWRcIikpXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgb2sgPSB0cnVlO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgcGxheWVyLmRhdGFbXCJtb3Zlc3BlZWRcIl0gPSB0cnVlO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFyIFBsYXQgPSBwbGF5ZXIuR2V0QmVoYXZpb3I8UGxhdGZvcm1lckNvbnRyb2xzPigpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgUGxhdC5tYXhTcGVlZCAqPSAxLjA3ZjtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIFBsYXQuYWNjZWwgKj0gMS4wN2Y7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBNID0gXCJNb3ZlbWVudCBzcGVlZCtcIjtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBjYXNlIFwiaW52aW5jaWJpbGl0eVwiOlxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHBsYXllci5pbnZpbmNpYmlsaXR5bW9kICE9IDEpXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgb2sgPSB0cnVlO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgcGxheWVyLmludmluY2liaWxpdHltb2QgPSAyO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgTSA9IFwiSW52aW5jaWJpbGl0eSBleHRlbmRlZFwiO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7XHJcblxyXG4gICAgICAgICAgICAgICAgICAgICAgICBjYXNlIFwiYXR0YWNrcG93ZXJcIjpcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHBsYXllci5hdHRhY2twb3dlciArPSAxO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgTSA9IFwiQXR0YWNrIFBvd2VyIFwiICsgKGludCkocGxheWVyLmF0dGFja3Bvd2VyKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBjYXNlIFwiZGVmZW5zZXBvd2VyXCI6XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBwbGF5ZXIuZGVmZW5zZXBvd2VyICs9IDE7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBNID0gXCJEZWZlbnNpdmUgUG93ZXIgXCIgKyAoaW50KShwbGF5ZXIuZGVmZW5zZXBvd2VyKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBjYXNlIFwicmVwZWF0ZXJcIjpcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChwbGF5ZXIudG90YWxzaG90cyA+IDIpXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgb2sgPSB0cnVlO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgcGxheWVyLnRvdGFsc2hvdHMgKz0gMTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIE0gPSBUdXBsZU5hbWVzW3BsYXllci50b3RhbHNob3RzXStcIiBzaG90XCI7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBicmVhaztcclxuICAgICAgICAgICAgICAgICAgICAgICAgZGVmYXVsdDpcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIG9rID0gdHJ1ZTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrO1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICBpZiAoIW9rICYmIE0gIT0gXCJcIilcclxuICAgICAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgICAgICBGbG9hdGluZ01lc3NhZ2UgRk0gPSBuZXcgRmxvYXRpbmdNZXNzYWdlKEdhbWUsIE0pO1xyXG4gICAgICAgICAgICAgICAgICAgIEZNLlRleHQuVGV4dENvbG9yID0gY29sb3I7XHJcbiAgICAgICAgICAgICAgICAgICAgLy9GTS5Qb3NpdGlvbiA9IG5ldyBWZWN0b3IyKHggLSA4LCB5IC0gMjApO1xyXG4gICAgICAgICAgICAgICAgICAgIEZNLlBvc2l0aW9uID0gbmV3IFZlY3RvcjIoeCArIDgsIHkgLSAyMCk7XHJcbiAgICAgICAgICAgICAgICAgICAgR2FtZS5BZGRFbnRpdHkoRk0pO1xyXG4gICAgICAgICAgICAgICAgICAgIGlmIChTICE9IFwiXCIgJiYgUyAhPSBcImNvbW1vblwiKVxyXG4gICAgICAgICAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgUGxheVNvdW5kKFwib2syQlwiKTtcclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgZWxzZVxyXG4gICAgICAgICAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgUGxheVNvdW5kKFwianVtcFwiKTtcclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcbiAgICAgICAgcHJvdGVjdGVkIFRpbGVEYXRhIEdldEZsb29yKClcclxuICAgICAgICB7XHJcbiAgICAgICAgICAgIFRpbGVEYXRhIFQgPSBudWxsO1xyXG4gICAgICAgICAgICBmbG9hdCBXID0gV2lkdGggLyAzO1xyXG4gICAgICAgICAgICBmbG9hdCBZID0gSGVpZ2h0O1xyXG4gICAgICAgICAgICBpZiAoIShUICE9IG51bGwgJiYgVC5lbmFibGVkICYmIFQudG9wU29saWQpKVxyXG4gICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICBUID0gR2FtZS5UTS5DaGVja0ZvclRpbGUoVmVjdG9yMi5BZGQoUG9zaXRpb24sIFdpZHRoIC8gMiwgWSkpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIGlmICghKFQgIT0gbnVsbCAmJiBULmVuYWJsZWQgJiYgVC50b3BTb2xpZCkpXHJcbiAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgIFQgPSBHYW1lLlRNLkNoZWNrRm9yVGlsZShWZWN0b3IyLkFkZChQb3NpdGlvbiwgVywgWSkpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIGlmICghKFQgIT0gbnVsbCAmJiBULmVuYWJsZWQgJiYgVC50b3BTb2xpZCkpXHJcbiAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgIFQgPSBHYW1lLlRNLkNoZWNrRm9yVGlsZShWZWN0b3IyLkFkZChQb3NpdGlvbiwgV2lkdGggLSBXLCBZKSk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgaWYgKCEoVCAhPSBudWxsICYmIFQuZW5hYmxlZCAmJiBULnRvcFNvbGlkKSlcclxuICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgVCA9IG51bGw7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgcmV0dXJuIFQ7XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG59XHJcbiIsInVzaW5nIFN5c3RlbTtcclxudXNpbmcgU3lzdGVtLkNvbGxlY3Rpb25zLkdlbmVyaWM7XHJcbnVzaW5nIFN5c3RlbS5MaW5xO1xyXG51c2luZyBTeXN0ZW0uVGV4dDtcclxudXNpbmcgU3lzdGVtLlRocmVhZGluZy5UYXNrcztcclxuXHJcbm5hbWVzcGFjZSBDaXJub0dhbWVcclxue1xyXG4gICAgcHVibGljIGFic3RyYWN0IGNsYXNzIENvbGxlY3RhYmxlSXRlbSA6IEVudGl0eVxyXG4gICAge1xyXG4gICAgICAgIHB1YmxpYyBib29sIGZsb2F0cyA9IHRydWU7XHJcbiAgICAgICAgcHVibGljIGZsb2F0IG1hZ25ldERpc3RhbmNlID0gMzU7XHJcbiAgICAgICAgcHVibGljIGZsb2F0IG1hZ25ldFNwZWVkID0gODtcclxuICAgICAgICBwdWJsaWMgZmxvYXQgbWF4RmFsbFNwZWVkID0gMjtcclxuICAgICAgICBwdWJsaWMgZmxvYXQgZmFsbGFjY2VsID0gMC4xZjtcclxuICAgICAgICBwdWJsaWMgc3RyaW5nIGl0ZW1OYW1lO1xyXG4gICAgICAgIHB1YmxpYyBpbnQgY29sbGVjdGlvbkRlbGF5ID0gMTA7XHJcbiAgICAgICAgcHVibGljIHN0cmluZyBzb3VuZCA9IFwicG93ZXJ1cFwiO1xyXG4gICAgICAgIHB1YmxpYyBDb2xsZWN0YWJsZUl0ZW0oR2FtZSBnYW1lLCBzdHJpbmcgaXRlbU5hbWUpIDogYmFzZShnYW1lKVxyXG4gICAgICAgIHtcclxuICAgICAgICAgICAgQW5pID0gbmV3IEFuaW1hdGlvbihBbmltYXRpb25Mb2FkZXIuR2V0KFwiaW1hZ2VzL2l0ZW1zL1wiICsgaXRlbU5hbWUpKTtcclxuICAgICAgICAgICAgQW5pLlNldEltYWdlKCk7XHJcbiAgICAgICAgICAgIHRoaXMuaXRlbU5hbWUgPSBpdGVtTmFtZTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIHB1YmxpYyB2aXJ0dWFsIGJvb2wgQ2FuQ29sbGVjdChQbGF5ZXJDaGFyYWN0ZXIgcGxheWVyKVxyXG4gICAgICAgIHtcclxuICAgICAgICAgICAgcmV0dXJuIHRydWU7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBwdWJsaWMgb3ZlcnJpZGUgdm9pZCBVcGRhdGUoKVxyXG4gICAgICAgIHtcclxuICAgICAgICAgICAgaWYgKGNvbGxlY3Rpb25EZWxheSA+IDApXHJcbiAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgIGNvbGxlY3Rpb25EZWxheS0tO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIFZlY3RvcjIgQztcclxuICAgICAgICAgICAgdmFyIHBsYXllciA9IEdhbWUucGxheWVyO1xyXG5cclxuICAgICAgICAgICAgaWYgKGNvbGxlY3Rpb25EZWxheSA8PSAwICYmIENhbkNvbGxlY3QocGxheWVyKSAmJiAoKEMgPSBwbGF5ZXIuZ2V0Q2VudGVyKCkpLkVzdGltYXRlZERpc3RhbmNlKFBvc2l0aW9uKSA8IG1hZ25ldERpc3RhbmNlKSlcclxuICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgdmFyIEMyID0gZ2V0Q2VudGVyKCk7XHJcbiAgICAgICAgICAgICAgICB2YXIgUCA9IEMgLSBDMjtcclxuICAgICAgICAgICAgICAgIHZhciBsbiA9IFAuTGVuZ3RoO1xyXG4gICAgICAgICAgICAgICAgdmFyIHNwZCA9IG1hZ25ldFNwZWVkO1xyXG4gICAgICAgICAgICAgICAgdmFyIGZzcGQgPSBzcGQgLyBNYXRoLk1heCgxLCBsbik7XHJcbiAgICAgICAgICAgICAgICBpZiAobG4gPD0gZnNwZC8qICYmIENhbkNvbGxlY3QoR2FtZS5wbGF5ZXIpKi8pXHJcbiAgICAgICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICAgICAgLy8oKFBsYXllckNoYXJhY3RlcilHYW1lLnBsYXllcikub25Db2xsZWN0SXRlbSh0aGlzKTtcclxuICAgICAgICAgICAgICAgICAgICBBbGl2ZSA9IGZhbHNlO1xyXG4gICAgICAgICAgICAgICAgICAgIEhzcGVlZCA9IDA7XHJcbiAgICAgICAgICAgICAgICAgICAgVnNwZWVkID0gMDtcclxuICAgICAgICAgICAgICAgICAgICBQb3NpdGlvbi5Db3B5RnJvbShHYW1lLnBsYXllci5Qb3NpdGlvbik7XHJcbiAgICAgICAgICAgICAgICAgICAgb25Db2xsZWN0ZWQoKChQbGF5ZXJDaGFyYWN0ZXIpR2FtZS5wbGF5ZXIpKTtcclxuICAgICAgICAgICAgICAgICAgICBQbGF5U291bmQoc291bmQpO1xyXG4gICAgICAgICAgICAgICAgICAgIHJldHVybjtcclxuXHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICBQID0gUC5Ob3JtYWxpemUoZnNwZCk7XHJcbiAgICAgICAgICAgICAgICAvKnggKz0gUC5YO1xyXG4gICAgICAgICAgICAgICAgeSArPSBQLlk7Ki9cclxuICAgICAgICAgICAgICAgIEhzcGVlZCA9IFAuWDtcclxuICAgICAgICAgICAgICAgIFZzcGVlZCA9IFAuWTtcclxuXHJcbiAgICAgICAgICAgICAgICAvL1ZzcGVlZCA9IDA7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgZWxzZSBpZiAoIWZsb2F0cylcclxuICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgdmFyIEYgPSBHZXRGbG9vcigpO1xyXG4gICAgICAgICAgICAgICAgaWYgKEYgPT0gbnVsbClcclxuICAgICAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgICAgICBpZiAoVnNwZWVkIDwgbWF4RmFsbFNwZWVkKVxyXG4gICAgICAgICAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgVnNwZWVkID0gTWF0aC5NaW4oVnNwZWVkICsgZmFsbGFjY2VsLCBtYXhGYWxsU3BlZWQpO1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICBlbHNlXHJcbiAgICAgICAgICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBWc3BlZWQgPSBtYXhGYWxsU3BlZWQ7XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgZWxzZVxyXG4gICAgICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgICAgIFZzcGVlZCA9IDA7XHJcbiAgICAgICAgICAgICAgICAgICAgeSA9IEYuR2V0SGl0Ym94KCkudG9wIC0gQW5pLkN1cnJlbnRJbWFnZS5IZWlnaHQ7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAvL0hzcGVlZCA9IDA7XHJcbiAgICAgICAgICAgICAgICBIc3BlZWQgPSAoZmxvYXQpTWF0aEhlbHBlci5EZWNlbGVyYXRlKEhzcGVlZCwgMC4xKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBlbHNlXHJcbiAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgIC8vSHNwZWVkID0gMDtcclxuICAgICAgICAgICAgICAgIC8vVnNwZWVkID0gMDtcclxuICAgICAgICAgICAgICAgIEhzcGVlZCA9IChmbG9hdClNYXRoSGVscGVyLkRlY2VsZXJhdGUoSHNwZWVkLCAwLjEpO1xyXG4gICAgICAgICAgICAgICAgVnNwZWVkID0gKGZsb2F0KU1hdGhIZWxwZXIuRGVjZWxlcmF0ZShWc3BlZWQsIDAuMSk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgYmFzZS5VcGRhdGUoKTtcclxuICAgICAgICB9XHJcbiAgICAgICAgcHJvdGVjdGVkIFRpbGVEYXRhIEdldEZsb29yKClcclxuICAgICAgICB7XHJcbiAgICAgICAgICAgIFRpbGVEYXRhIFQgPSBudWxsO1xyXG4gICAgICAgICAgICBmbG9hdCBXID0gV2lkdGggLyAzO1xyXG4gICAgICAgICAgICBmbG9hdCBZID0gSGVpZ2h0O1xyXG4gICAgICAgICAgICBpZiAoIShUICE9IG51bGwgJiYgVC5lbmFibGVkICYmIFQudG9wU29saWQpKVxyXG4gICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICBUID0gR2FtZS5UTS5DaGVja0ZvclRpbGUoVmVjdG9yMi5BZGQoUG9zaXRpb24sIFdpZHRoIC8gMiwgWSkpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIGlmICghKFQgIT0gbnVsbCAmJiBULmVuYWJsZWQgJiYgVC50b3BTb2xpZCkpXHJcbiAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgIFQgPSBHYW1lLlRNLkNoZWNrRm9yVGlsZShWZWN0b3IyLkFkZChQb3NpdGlvbiwgVywgWSkpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIGlmICghKFQgIT0gbnVsbCAmJiBULmVuYWJsZWQgJiYgVC50b3BTb2xpZCkpXHJcbiAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgIFQgPSBHYW1lLlRNLkNoZWNrRm9yVGlsZShWZWN0b3IyLkFkZChQb3NpdGlvbiwgV2lkdGggLSBXLCBZKSk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgaWYgKCEoVCAhPSBudWxsICYmIFQuZW5hYmxlZCAmJiBULnRvcFNvbGlkKSlcclxuICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgVCA9IG51bGw7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgcmV0dXJuIFQ7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGFic3RyYWN0IHB1YmxpYyB2b2lkIG9uQ29sbGVjdGVkKFBsYXllckNoYXJhY3RlciBwbGF5ZXIpO1xyXG4gICAgICAgIC8qcHVibGljIHZpcnR1YWwgdm9pZCBvbkNvbGxlY3RlZChQbGF5ZXJDaGFyYWN0ZXIgcGxheWVyKVxyXG4gICAgICAgIHtcclxuXHJcbiAgICAgICAgfSovXHJcbiAgICB9XHJcbn1cclxuIiwidXNpbmcgU3lzdGVtO1xyXG51c2luZyBTeXN0ZW0uQ29sbGVjdGlvbnMuR2VuZXJpYztcclxudXNpbmcgU3lzdGVtLkxpbnE7XHJcbnVzaW5nIFN5c3RlbS5UZXh0O1xyXG51c2luZyBTeXN0ZW0uVGhyZWFkaW5nLlRhc2tzO1xyXG5cclxubmFtZXNwYWNlIENpcm5vR2FtZVxyXG57XHJcbiAgICBwdWJsaWMgY2xhc3MgQ29udHJvbGxhYmxlRW50aXR5IDogRW50aXR5XHJcbiAgICB7XHJcbiAgICAgICAgcHVibGljIGJvb2xbXSBDb250cm9sbGVyO1xyXG4gICAgICAgIHB1YmxpYyBib29sW10gTENvbnRyb2xsZXI7XHJcbiAgICAgICAgcHVibGljIENvbnRyb2xsYWJsZUVudGl0eShHYW1lIGdhbWUpIDogYmFzZShnYW1lKVxyXG4gICAgICAgIHtcclxuICAgICAgICAgICAgQ29udHJvbGxlciA9IG5ldyBib29sWzddO1xyXG4gICAgICAgICAgICBMQ29udHJvbGxlciA9IG5ldyBib29sW0NvbnRyb2xsZXIuTGVuZ3RoXTtcclxuICAgICAgICB9XHJcbiAgICAgICAgLy8vIDxzdW1tYXJ5PlxyXG4gICAgICAgIC8vLyByZXR1cm5zIHRydWUgaWYgdGhlIGJ1dHRvbiB3YXMganVzdCBwcmVzc2VkLlxyXG4gICAgICAgIC8vLyA8L3N1bW1hcnk+XHJcbiAgICAgICAgLy8vIDxwYXJhbSBuYW1lPVwiYnV0dG9uXCI+PC9wYXJhbT5cclxuICAgICAgICAvLy8gPHJldHVybnM+PC9yZXR1cm5zPlxyXG4gICAgICAgIHB1YmxpYyBib29sIFByZXNzZWQoaW50IGJ1dHRvbilcclxuICAgICAgICB7XHJcbiAgICAgICAgICAgIHJldHVybiAoQ29udHJvbGxlcltidXR0b25dICE9IExDb250cm9sbGVyW2J1dHRvbl0gJiYgQ29udHJvbGxlcltidXR0b25dKTtcclxuICAgICAgICB9XHJcbiAgICAgICAgLy8vIDxzdW1tYXJ5PlxyXG4gICAgICAgIC8vLyByZXR1cm5zIHRydWUgaWYganVzdCByZWxlYXNlZC5cclxuICAgICAgICAvLy8gPC9zdW1tYXJ5PlxyXG4gICAgICAgIC8vLyA8cGFyYW0gbmFtZT1cImJ1dHRvblwiPjwvcGFyYW0+XHJcbiAgICAgICAgLy8vIDxyZXR1cm5zPjwvcmV0dXJucz5cclxuICAgICAgICBwdWJsaWMgYm9vbCBSZWxlYXNlZChpbnQgYnV0dG9uKVxyXG4gICAgICAgIHtcclxuICAgICAgICAgICAgcmV0dXJuIChDb250cm9sbGVyW2J1dHRvbl0gIT0gTENvbnRyb2xsZXJbYnV0dG9uXSAmJiAhQ29udHJvbGxlcltidXR0b25dKTtcclxuICAgICAgICB9XHJcbiAgICB9XHJcbn1cclxuIiwidXNpbmcgU3lzdGVtO1xyXG51c2luZyBTeXN0ZW0uQ29sbGVjdGlvbnMuR2VuZXJpYztcclxudXNpbmcgU3lzdGVtLkxpbnE7XHJcbnVzaW5nIFN5c3RlbS5UZXh0O1xyXG51c2luZyBTeXN0ZW0uVGhyZWFkaW5nLlRhc2tzO1xyXG5cclxubmFtZXNwYWNlIENpcm5vR2FtZVxyXG57XHJcbiAgICBwdWJsaWMgY2xhc3MgRXhpdERvb3IgOiBFbnRpdHlcclxuICAgIHtcclxuICAgICAgICBwcml2YXRlIGludCByZXNldCA9IDA7XHJcbiAgICAgICAgcHJpdmF0ZSBUaWxlRGF0YSBSVDtcclxuICAgICAgICBwcml2YXRlIGJvb2wgX09wZW5lZCA9IGZhbHNlO1xyXG4gICAgICAgIHB1YmxpYyBib29sIE9wZW5lZFxyXG4gICAgICAgIHtcclxuICAgICAgICAgICAgZ2V0XHJcbiAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgIHJldHVybiBfT3BlbmVkO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIHNldFxyXG4gICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICBfT3BlbmVkID0gdmFsdWU7XHJcbiAgICAgICAgICAgICAgICBpZiAoX09wZW5lZClcclxuICAgICAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgICAgICBBbmkuQ3VycmVudEZyYW1lID0gMTtcclxuICAgICAgICAgICAgICAgICAgICBBbmkuU2V0SW1hZ2UoKTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIGVsc2VcclxuICAgICAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgICAgICBBbmkuQ3VycmVudEZyYW1lID0gMDtcclxuICAgICAgICAgICAgICAgICAgICBBbmkuU2V0SW1hZ2UoKTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuICAgICAgICBwdWJsaWMgRXhpdERvb3IoR2FtZSBnYW1lKSA6IGJhc2UoZ2FtZSlcclxuICAgICAgICB7XHJcbiAgICAgICAgICAgIEFuaSA9IG5ldyBBbmltYXRpb24oQW5pbWF0aW9uTG9hZGVyLkdldChcImltYWdlcy9taXNjL2Rvb3JcIikpO1xyXG4gICAgICAgICAgICBBbmkuSW1hZ2VTcGVlZCA9IDA7XHJcbiAgICAgICAgICAgIEFuaS5TZXRJbWFnZSgpO1xyXG4gICAgICAgICAgICBSZW1vdmVkT25MZXZlbEVuZCA9IGZhbHNlO1xyXG4gICAgICAgIH1cclxuICAgICAgICBwdWJsaWMgdm9pZCBEcm9wVG9Hcm91bmQoKVxyXG4gICAgICAgIHtcclxuICAgICAgICAgICAgd2hpbGUgKEdldEZsb29yKCkgPT0gbnVsbClcclxuICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgeSArPSAxNjtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB2YXIgRiA9IEdldEZsb29yKCk7XHJcbiAgICAgICAgICAgIC8vRi5CcmVha2FibGUgPSBmYWxzZTtcclxuICAgICAgICAgICAgdmFyIEZCID0gRi5HZXRIaXRib3goKTtcclxuICAgICAgICAgICAgeCA9IEZCLmxlZnQ7XHJcbiAgICAgICAgICAgIHkgPSBGQi50b3AgLSAzMjtcclxuICAgICAgICAgICAgdmFyIFQgPSBHYW1lLlRNLkdldFRpbGUoRi5jb2x1bW4sIEYucm93IC0gMSk7XHJcbiAgICAgICAgICAgIGlmIChUICE9IG51bGwgJiYgVC5lbmFibGVkICYmIFQudG9wU29saWQpXHJcbiAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgIHkgLT0gMTY7XHJcbiAgICAgICAgICAgICAgICBGID0gVDtcclxuICAgICAgICAgICAgICAgIEhlbHBlci5Mb2coXCJkdWcgZG9vciBvdXQgb2YgdGhlIGdyb3VuZFwiKTtcclxuXHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgUlQgPSBGO1xyXG4gICAgICAgICAgICAvKkYuQnJlYWthYmxlID0gZmFsc2U7XHJcbiAgICAgICAgICAgIEYudGV4dHVyZSA9IDA7XHJcblxyXG4gICAgICAgICAgICBHYW1lLlRNLlJlZHJhd1RpbGUoRi5jb2x1bW4sIEYucm93KTsqL1xyXG4gICAgICAgICAgICByZXNldCA9IDA7XHJcblxyXG4gICAgICAgIH1cclxuICAgICAgICBwdWJsaWMgb3ZlcnJpZGUgdm9pZCBVcGRhdGUoKVxyXG4gICAgICAgIHtcclxuICAgICAgICAgICAgYmFzZS5VcGRhdGUoKTtcclxuICAgICAgICAgICAgaWYgKCFfT3BlbmVkKVxyXG4gICAgICAgICAgICAgICAgcmV0dXJuO1xyXG4gICAgICAgICAgICAvKnZhciBGID0gR2V0Rmxvb3IoKTtcclxuICAgICAgICAgICAgaWYgKEYgPT0gbnVsbClcclxuICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgVnNwZWVkID0gMTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBlbHNlXHJcbiAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgIFZzcGVlZCA9IDA7XHJcbiAgICAgICAgICAgICAgICB5ID0gRi5HZXRIaXRib3goKS50b3AgLSBBbmkuQ3VycmVudEltYWdlLkhlaWdodDtcclxuICAgICAgICAgICAgfSovXHJcbiAgICAgICAgICAgIHZhciBQID0gKFBsYXllckNoYXJhY3RlcilHYW1lLnBsYXllcjtcclxuICAgICAgICAgICAgaWYgKFAuUG9zaXRpb24uRXN0aW1hdGVkRGlzdGFuY2UoUG9zaXRpb24pIDwgMjAgJiYgUC5Db250cm9sbGVyWzJdKVxyXG4gICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICBPcGVuZWQgPSBmYWxzZTtcclxuICAgICAgICAgICAgICAgIFAuc2NvcmUgKz0gKEdhbWUubGV2ZWwgKiAxMCk7XHJcblxyXG4gICAgICAgICAgICAgICAgdmFyIHRpbWUgPSAoMTAwMCkgKiAxMztcclxuICAgICAgICAgICAgICAgIGlmIChHYW1lLnRpbWVSZW1haW5pbmcgPiAwKVxyXG4gICAgICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgICAgIEdhbWUudGltZVJlbWFpbmluZyArPSB0aW1lO1xyXG4gICAgICAgICAgICAgICAgICAgIEdhbWUudGltZVJlbWFpbmluZyA9IE1hdGguTWluKEdhbWUuZGVmYXVsdFRpbWVSZW1haW5pbmcsIEdhbWUudGltZVJlbWFpbmluZyk7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICBlbHNlXHJcbiAgICAgICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICAgICAgR2FtZS50aW1lUmVtYWluaW5nICs9IHRpbWU7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICBHYW1lLlN0YXJ0TmV4dExldmVsKCk7XHJcblxyXG4gICAgICAgICAgICAgICAgLypQLmtleXMtLTtcclxuICAgICAgICAgICAgICAgIE9wZW4oUCk7Ki9cclxuICAgICAgICAgICAgICAgIC8qQW5pLkN1cnJlbnRGcmFtZSA9IDE7XHJcbiAgICAgICAgICAgICAgICBBbmkuU2V0SW1hZ2UoKTtcclxuICAgICAgICAgICAgICAgIEFuaS5VcGRhdGUoKTsqL1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIGlmIChyZXNldCA8IDIpXHJcbiAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgIHJlc2V0Kys7XHJcbiAgICAgICAgICAgICAgICAvL3Jlc2V0ID0gZmFsc2U7XHJcbiAgICAgICAgICAgICAgICAvL3ZhciBGID0gR2V0Rmxvb3IoKTtcclxuICAgICAgICAgICAgICAgIHZhciBGID0gUlQ7XHJcbiAgICAgICAgICAgICAgICBpZiAoRiAhPSBudWxsICYmIHJlc2V0ID09IDIpXHJcbiAgICAgICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICAgICAgRi5CcmVha2FibGUgPSBmYWxzZTtcclxuICAgICAgICAgICAgICAgICAgICBGLnRleHR1cmUgPSAwO1xyXG4gICAgICAgICAgICAgICAgICAgIEdhbWUuVE0uUmVkcmF3VGlsZShGLmNvbHVtbiwgRi5yb3cpO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHByb3RlY3RlZCBUaWxlRGF0YSBHZXRGbG9vcigpXHJcbiAgICAgICAge1xyXG4gICAgICAgICAgICBUaWxlRGF0YSBUID0gbnVsbDtcclxuICAgICAgICAgICAgZmxvYXQgVyA9IFdpZHRoIC8gMztcclxuICAgICAgICAgICAgZmxvYXQgWSA9IEhlaWdodDtcclxuICAgICAgICAgICAgaWYgKCEoVCAhPSBudWxsICYmIFQuZW5hYmxlZCAmJiBULnRvcFNvbGlkKSlcclxuICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgVCA9IEdhbWUuVE0uQ2hlY2tGb3JUaWxlKFZlY3RvcjIuQWRkKFBvc2l0aW9uLCBXaWR0aCAvIDIsIFkpKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBpZiAoIShUICE9IG51bGwgJiYgVC5lbmFibGVkICYmIFQudG9wU29saWQpKVxyXG4gICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICBUID0gR2FtZS5UTS5DaGVja0ZvclRpbGUoVmVjdG9yMi5BZGQoUG9zaXRpb24sIFcsIFkpKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBpZiAoIShUICE9IG51bGwgJiYgVC5lbmFibGVkICYmIFQudG9wU29saWQpKVxyXG4gICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICBUID0gR2FtZS5UTS5DaGVja0ZvclRpbGUoVmVjdG9yMi5BZGQoUG9zaXRpb24sIFdpZHRoIC0gVywgWSkpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIGlmICghKFQgIT0gbnVsbCAmJiBULmVuYWJsZWQgJiYgVC50b3BTb2xpZCkpXHJcbiAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgIFQgPSBudWxsO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIHJldHVybiBUO1xyXG4gICAgICAgIH1cclxuICAgIH1cclxufVxyXG4iLCJ1c2luZyBTeXN0ZW07XHJcbnVzaW5nIFN5c3RlbS5Db2xsZWN0aW9ucy5HZW5lcmljO1xyXG51c2luZyBTeXN0ZW0uTGlucTtcclxudXNpbmcgU3lzdGVtLlRleHQ7XHJcbnVzaW5nIFN5c3RlbS5UaHJlYWRpbmcuVGFza3M7XHJcblxyXG5uYW1lc3BhY2UgQ2lybm9HYW1lXHJcbntcclxuICAgIHB1YmxpYyBjbGFzcyBGbGlnaHRDb250cm9scyA6IEVudGl0eUJlaGF2aW9yXHJcbiAgICB7XHJcbiAgICAgICAgcHVibGljIGZsb2F0IGFjY2VsID0gMC4zNWY7XHJcbiAgICAgICAgcHVibGljIGZsb2F0IG1heFNwZWVkID0gMS41ZjtcclxuICAgICAgICBQbGF0Zm9ybWVyRW50aXR5IF9wbGF0Zm9ybWVyO1xyXG5cclxuICAgICAgICBwdWJsaWMgRmxpZ2h0Q29udHJvbHMoUGxhdGZvcm1lckVudGl0eSBlbnRpdHkpIDogYmFzZShlbnRpdHkpXHJcbiAgICAgICAge1xyXG4gICAgICAgICAgICBfcGxhdGZvcm1lciA9IGVudGl0eTtcclxuICAgICAgICB9XHJcbiAgICAgICAgcHVibGljIG92ZXJyaWRlIHZvaWQgVXBkYXRlKClcclxuICAgICAgICB7XHJcbiAgICAgICAgICAgIGJvb2xbXSBjb250cm9sbGVyID0gX3BsYXRmb3JtZXIuQ29udHJvbGxlcjtcclxuICAgICAgICAgICAgaWYgKGNvbnRyb2xsZXJbMF0gJiYgX3BsYXRmb3JtZXIuSHNwZWVkID4gLW1heFNwZWVkKVxyXG4gICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICBfcGxhdGZvcm1lci5Ic3BlZWQgPSAoZmxvYXQpTWF0aC5NYXgoX3BsYXRmb3JtZXIuSHNwZWVkIC0gKGFjY2VsICsgX3BsYXRmb3JtZXIuZnJpY3Rpb24pLCAtbWF4U3BlZWQpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIGlmIChjb250cm9sbGVyWzFdICYmIF9wbGF0Zm9ybWVyLkhzcGVlZCA8IG1heFNwZWVkKVxyXG4gICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICBfcGxhdGZvcm1lci5Ic3BlZWQgPSAoZmxvYXQpTWF0aC5NaW4oX3BsYXRmb3JtZXIuSHNwZWVkICsgKGFjY2VsICsgX3BsYXRmb3JtZXIuZnJpY3Rpb24pLCBtYXhTcGVlZCk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgaWYgKGNvbnRyb2xsZXJbMl0gJiYgX3BsYXRmb3JtZXIuVnNwZWVkID4gLW1heFNwZWVkKVxyXG4gICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICBfcGxhdGZvcm1lci5Wc3BlZWQgPSAoZmxvYXQpTWF0aC5NYXgoX3BsYXRmb3JtZXIuVnNwZWVkIC0gKGFjY2VsICsgX3BsYXRmb3JtZXIuZnJpY3Rpb24pLCAtbWF4U3BlZWQpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIGlmIChjb250cm9sbGVyWzNdICYmIF9wbGF0Zm9ybWVyLlZzcGVlZCA8IG1heFNwZWVkKVxyXG4gICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICBfcGxhdGZvcm1lci5Wc3BlZWQgPSAoZmxvYXQpTWF0aC5NaW4oX3BsYXRmb3JtZXIuVnNwZWVkICsgKGFjY2VsICsgX3BsYXRmb3JtZXIuZnJpY3Rpb24pLCBtYXhTcGVlZCk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgLyp2YXIganVtcGJ1dHRvbiA9IDU7XHJcbiAgICAgICAgICAgIGlmIChfcGxhdGZvcm1lci5Wc3BlZWQgPj0gMCAmJiBfcGxhdGZvcm1lci5vbkdyb3VuZClcclxuICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgaWYgKF9wbGF0Zm9ybWVyLlByZXNzZWQoanVtcGJ1dHRvbikgJiYgX3BsYXRmb3JtZXIub25Hcm91bmQgJiYgX3BsYXRmb3JtZXIuQ2VpbGluZyA9PSBudWxsKVxyXG4gICAgICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgICAgIF9wbGF0Zm9ybWVyLlZzcGVlZCA9IC1qdW1wU3BlZWQ7XHJcbiAgICAgICAgICAgICAgICAgICAgLy8vZW50aXR5LlBsYXlTb3VuZChcImp1bXBcIik7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgZWxzZSBpZiAoYWlySnVtcHMgPCBtYXhBaXJKdW1wcyAmJiBfcGxhdGZvcm1lci5QcmVzc2VkKGp1bXBidXR0b24pICYmIF9wbGF0Zm9ybWVyLkNlaWxpbmcgPT0gbnVsbClcclxuICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgX3BsYXRmb3JtZXIuVnNwZWVkID0gLShqdW1wU3BlZWQgKiBhaXJqdW1wcG93ZXIpO1xyXG4gICAgICAgICAgICAgICAgYWlySnVtcHMrKztcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBpZiAoX3BsYXRmb3JtZXIuVnNwZWVkIDwgMCAmJiAhY29udHJvbGxlcltqdW1wYnV0dG9uXSlcclxuICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgX3BsYXRmb3JtZXIuVnNwZWVkICs9IChfcGxhdGZvcm1lci5ncmF2aXR5ICogMik7XHJcbiAgICAgICAgICAgIH0qL1xyXG4gICAgICAgICAgICBiYXNlLlVwZGF0ZSgpO1xyXG4gICAgICAgIH1cclxuICAgIH1cclxufVxyXG4iLCJ1c2luZyBTeXN0ZW07XHJcbnVzaW5nIFN5c3RlbS5Db2xsZWN0aW9ucy5HZW5lcmljO1xyXG51c2luZyBTeXN0ZW0uTGlucTtcclxudXNpbmcgU3lzdGVtLlRleHQ7XHJcbnVzaW5nIFN5c3RlbS5UaHJlYWRpbmcuVGFza3M7XHJcbnVzaW5nIEJyaWRnZS5IdG1sNTtcclxuXHJcbm5hbWVzcGFjZSBDaXJub0dhbWVcclxue1xyXG4gICAgcHVibGljIGNsYXNzIEZsb2F0aW5nTWVzc2FnZSA6IEVudGl0eVxyXG4gICAge1xyXG4gICAgICAgIHB1YmxpYyBpbnQgdGltZSA9IDMwO1xyXG4gICAgICAgIHB1YmxpYyBUZXh0U3ByaXRlIFRleHQ7XHJcbiAgICAgICAgZmxvYXQgYWxwaGEgPSAxO1xyXG4gICAgICAgIHB1YmxpYyBib29sIGF1dG9raWxsID0gdHJ1ZTtcclxuICAgICAgICBwdWJsaWMgRmxvYXRpbmdNZXNzYWdlKEdhbWUgZ2FtZSwgc3RyaW5nIHRleHQpIDogYmFzZShnYW1lKVxyXG4gICAgICAgIHtcclxuICAgICAgICAgICAgQW5pID0gbmV3IEFuaW1hdGlvbihudWxsKTtcclxuICAgICAgICAgICAgVGV4dCA9IG5ldyBUZXh0U3ByaXRlKCk7XHJcbiAgICAgICAgICAgIFRleHQuVGV4dCA9IHRleHQ7XHJcbiAgICAgICAgICAgIFRleHQuVGV4dENvbG9yID0gXCIjRkZGRkZGXCI7XHJcbiAgICAgICAgICAgIFRleHQuU2hhZG93Q29sb3IgPSBcIiMwMDAwMDBcIjtcclxuICAgICAgICAgICAgVGV4dC5TaGFkb3dPZmZzZXQgPSBuZXcgVmVjdG9yMigyLCAyKTtcclxuICAgICAgICAgICAgVGV4dC5TaGFkb3dCbHVyID0gMTtcclxuICAgICAgICAgICAgVGV4dC5Gb250U2l6ZSA9IDE0O1xyXG4gICAgICAgICAgICB0aW1lID0gMzAgKyAodGV4dC5MZW5ndGggKiAyMCk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHB1YmxpYyB2b2lkIENoYW5nZVRleHQoc3RyaW5nIHRleHQsc3RyaW5nIGNvbG9yPW51bGwpXHJcbiAgICAgICAge1xyXG4gICAgICAgICAgICBUZXh0LlRleHQgPSB0ZXh0O1xyXG4gICAgICAgICAgICB0aW1lID0gMzAgKyAodGV4dC5MZW5ndGggKiAyMCk7XHJcbiAgICAgICAgICAgIGFscGhhID0gMTtcclxuICAgICAgICAgICAgaWYgKGNvbG9yICE9IG51bGwpXHJcbiAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgIFRleHQuVGV4dENvbG9yID0gY29sb3I7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcbiAgICAgICAgcHVibGljIG92ZXJyaWRlIHZvaWQgVXBkYXRlKClcclxuICAgICAgICB7XHJcbiAgICAgICAgICAgIGJhc2UuVXBkYXRlKCk7XHJcbiAgICAgICAgICAgIGlmICh0aW1lID4gMClcclxuICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgdGltZS0tO1xyXG4gICAgICAgICAgICAgICAgaWYgKHRpbWUgPCAxICYmIGFscGhhPjApXHJcbiAgICAgICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICAgICAgLy9BbGl2ZSA9IGZhbHNlO1xyXG4gICAgICAgICAgICAgICAgICAgIGFscGhhIC09IDAuMDVmO1xyXG4gICAgICAgICAgICAgICAgICAgIGlmIChhbHBoYSA8PSAwKVxyXG4gICAgICAgICAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgYWxwaGEgPSAwO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAoYXV0b2tpbGwpXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIEFsaXZlID0gZmFsc2U7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgdGltZSA9IDE7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcbiAgICAgICAgcHVibGljIG92ZXJyaWRlIHZvaWQgRHJhdyhDYW52YXNSZW5kZXJpbmdDb250ZXh0MkQgZylcclxuICAgICAgICB7XHJcbiAgICAgICAgICAgIC8vYmFzZS5EcmF3KGcpO1xyXG4gICAgICAgICAgICBpZiAoYWxwaGEgPCAxKVxyXG4gICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICBpZiAoYWxwaGEgPD0gMClcclxuICAgICAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgICAgICByZXR1cm47XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICBnLkdsb2JhbEFscGhhID0gYWxwaGE7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgLy9UZXh0LlBvc2l0aW9uLkNvcHlGcm9tKFBvc2l0aW9uKTtcclxuICAgICAgICAgICAgVGV4dC5Gb3JjZVVwZGF0ZSgpO1xyXG4gICAgICAgICAgICBUZXh0LlBvc2l0aW9uLlggPSAoaW50KVBvc2l0aW9uLlggLSAoVGV4dC5zcHJpdGVCdWZmZXIuV2lkdGggLyAyKTtcclxuICAgICAgICAgICAgVGV4dC5Qb3NpdGlvbi5ZID0gKGludClQb3NpdGlvbi5ZIC0gKFRleHQuc3ByaXRlQnVmZmVyLkhlaWdodCAvIDIpO1xyXG4gICAgICAgICAgICBUZXh0LkRyYXcoZyk7XHJcbiAgICAgICAgICAgIGcuR2xvYmFsQWxwaGEgPSAxZjtcclxuICAgICAgICB9XHJcbiAgICB9XHJcbn1cclxuIiwidXNpbmcgU3lzdGVtO1xyXG51c2luZyBTeXN0ZW0uQ29sbGVjdGlvbnMuR2VuZXJpYztcclxudXNpbmcgU3lzdGVtLkxpbnE7XHJcbnVzaW5nIFN5c3RlbS5UZXh0O1xyXG51c2luZyBTeXN0ZW0uVGhyZWFkaW5nLlRhc2tzO1xyXG51c2luZyBCcmlkZ2U7XHJcbnVzaW5nIEJyaWRnZS5IdG1sNTtcclxuXHJcbm5hbWVzcGFjZSBDaXJub0dhbWVcclxue1xyXG4gICAgcHVibGljIGNsYXNzIFBhcnRpY2xlIDogRW50aXR5XHJcbiAgICB7XHJcbiAgICAgICAgcHVibGljIGludCBIUCA9IDEyO1xyXG4gICAgICAgIHB1YmxpYyBmbG9hdCBhbHBoYXRpbWUgPSAwLjJmO1xyXG5cclxuICAgICAgICBwdWJsaWMgUGFydGljbGUoR2FtZSBnYW1lLCBIVE1MSW1hZ2VFbGVtZW50IGltYWdlKSA6IGJhc2UoZ2FtZSlcclxuICAgICAgICB7XHJcbiAgICAgICAgICAgIEFuaSA9IG5ldyBBbmltYXRpb24obmV3IExpc3Q8SFRNTEltYWdlRWxlbWVudD4obmV3IEhUTUxJbWFnZUVsZW1lbnRbXSB7IGltYWdlIH0pKTtcclxuICAgICAgICB9XHJcbiAgICAgICAgcHVibGljIG92ZXJyaWRlIHZvaWQgVXBkYXRlKClcclxuICAgICAgICB7XHJcbiAgICAgICAgICAgIEhQLS07XHJcbiAgICAgICAgICAgIGlmIChIUCA8PSAwKVxyXG4gICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICBpZiAoKEFuaS5BbHBoYSAtPSBhbHBoYXRpbWUpIDw9IDApXHJcbiAgICAgICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICAgICAgQWxpdmUgPSBmYWxzZTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIC8qaWYgKGFscGhhdGltZSA+IDApXHJcbiAgICAgICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICAgICAgYWxwaGEgLT0gYWxwaGF0aW1lO1xyXG4gICAgICAgICAgICAgICAgICAgIEFuaS5BbHBoYSA9IGFscGhhO1xyXG4gICAgICAgICAgICAgICAgICAgIGlmIChhbHBoYSA8PSAwKVxyXG4gICAgICAgICAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgQWxpdmUgPSBmYWxzZTtcclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICBlbHNlXHJcbiAgICAgICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICAgICAgQWxpdmUgPSBmYWxzZTtcclxuICAgICAgICAgICAgICAgIH0qL1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIGJhc2UuVXBkYXRlKCk7XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG59XHJcbiIsInVzaW5nIFN5c3RlbTtcclxudXNpbmcgU3lzdGVtLkNvbGxlY3Rpb25zLkdlbmVyaWM7XHJcbnVzaW5nIFN5c3RlbS5MaW5xO1xyXG51c2luZyBTeXN0ZW0uVGV4dDtcclxudXNpbmcgU3lzdGVtLlRocmVhZGluZy5UYXNrcztcclxuXHJcbm5hbWVzcGFjZSBDaXJub0dhbWVcclxue1xyXG4gICAgcHVibGljIGNsYXNzIFBsYXRmb3JtZXJDb250cm9scyA6IEVudGl0eUJlaGF2aW9yXHJcbiAgICB7XHJcbiAgICAgICAgUGxhdGZvcm1lckVudGl0eSBfcGxhdGZvcm1lcjtcclxuICAgICAgICBwdWJsaWMgZmxvYXQgYWNjZWwgPSAwLjM1ZjtcclxuICAgICAgICAvL3B1YmxpYyBmbG9hdCBqdW1wU3BlZWQgPSAxOGY7XHJcbiAgICAgICAgcHVibGljIGZsb2F0IGp1bXBTcGVlZCA9IDIuMjVmO1xyXG4gICAgICAgIHB1YmxpYyBmbG9hdCBtYXhTcGVlZCA9IDEuNWY7XHJcbiAgICAgICAgcHVibGljIGludCBtYXhBaXJKdW1wcyA9IDE7XHJcbiAgICAgICAgcHVibGljIGludCBhaXJKdW1wcyA9IDA7XHJcbiAgICAgICAgcHVibGljIGZsb2F0IGFpcmp1bXBwb3dlciA9IDAuODE1ZjtcclxuICAgICAgICBwdWJsaWMgUGxhdGZvcm1lckNvbnRyb2xzKFBsYXRmb3JtZXJFbnRpdHkgZW50aXR5KSA6IGJhc2UoZW50aXR5KVxyXG4gICAgICAgIHtcclxuICAgICAgICAgICAgX3BsYXRmb3JtZXIgPSBlbnRpdHk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHB1YmxpYyBvdmVycmlkZSB2b2lkIFVwZGF0ZSgpXHJcbiAgICAgICAge1xyXG4gICAgICAgICAgICB2YXIgYWdhaW5zdHdhbGwgPSBmYWxzZTtcclxuICAgICAgICAgICAgYm9vbFtdIGNvbnRyb2xsZXIgPSBfcGxhdGZvcm1lci5Db250cm9sbGVyO1xyXG4gICAgICAgICAgICB2YXIgWCA9IDA7XHJcbiAgICAgICAgICAgIGlmIChjb250cm9sbGVyWzBdICYmICFjb250cm9sbGVyWzFdICYmIF9wbGF0Zm9ybWVyLkhzcGVlZCA+IC1tYXhTcGVlZClcclxuICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgX3BsYXRmb3JtZXIuSHNwZWVkID0gKGZsb2F0KU1hdGguTWF4KF9wbGF0Zm9ybWVyLkhzcGVlZCAtIChhY2NlbCArIF9wbGF0Zm9ybWVyLmZyaWN0aW9uKSwgLW1heFNwZWVkKTtcclxuICAgICAgICAgICAgICAgIFggPSAtMTtcclxuICAgICAgICAgICAgICAgIGlmIChfcGxhdGZvcm1lci5SaWdodFdhbGwgIT0gbnVsbClcclxuICAgICAgICAgICAgICAgICAgICBhZ2FpbnN0d2FsbCA9IHRydWU7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgaWYgKGNvbnRyb2xsZXJbMV0gJiYgIWNvbnRyb2xsZXJbMF0gJiYgX3BsYXRmb3JtZXIuSHNwZWVkIDwgbWF4U3BlZWQpXHJcbiAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgIF9wbGF0Zm9ybWVyLkhzcGVlZCA9IChmbG9hdClNYXRoLk1pbihfcGxhdGZvcm1lci5Ic3BlZWQgKyAoYWNjZWwgKyBfcGxhdGZvcm1lci5mcmljdGlvbiksIG1heFNwZWVkKTtcclxuICAgICAgICAgICAgICAgIFggPSAxO1xyXG4gICAgICAgICAgICAgICAgaWYgKF9wbGF0Zm9ybWVyLkxlZnRXYWxsICE9IG51bGwpXHJcbiAgICAgICAgICAgICAgICAgICAgYWdhaW5zdHdhbGwgPSB0cnVlO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIHZhciBqdW1wYnV0dG9uID0gNTtcclxuICAgICAgICAgICAgaWYgKF9wbGF0Zm9ybWVyLm9uR3JvdW5kKVxyXG4gICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICBhaXJKdW1wcyA9IDA7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgaWYgKF9wbGF0Zm9ybWVyLlZzcGVlZCA+PSAwICYmIF9wbGF0Zm9ybWVyLm9uR3JvdW5kKVxyXG4gICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICBpZiAoX3BsYXRmb3JtZXIuUHJlc3NlZChqdW1wYnV0dG9uKSAmJiBfcGxhdGZvcm1lci5vbkdyb3VuZCAmJiBfcGxhdGZvcm1lci5DZWlsaW5nID09IG51bGwpXHJcbiAgICAgICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICAgICAgX3BsYXRmb3JtZXIuVnNwZWVkID0gLWp1bXBTcGVlZDtcclxuICAgICAgICAgICAgICAgICAgICBlbnRpdHkuUGxheVNvdW5kKFwianVtcFwiKTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAvKmVsc2UgaWYgKF9wbGF0Zm9ybWVyLlByZXNzZWQoanVtcGJ1dHRvbikgJiYgX3BsYXRmb3JtZXIuQ2VpbGluZyA9PSBudWxsICYmIGFnYWluc3R3YWxsICYmIF9wbGF0Zm9ybWVyLlZzcGVlZCA+PSAwKVxyXG4gICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICAvL3BlcmZvcm0gd2FsbCBqdW1wXHJcbiAgICAgICAgICAgICAgICBfcGxhdGZvcm1lci5Ic3BlZWQgPSBYICogbWF4U3BlZWQ7XHJcbiAgICAgICAgICAgICAgICBfcGxhdGZvcm1lci5Wc3BlZWQgPSAtKGp1bXBTcGVlZCAqICgoMSArIGFpcmp1bXBwb3dlcikgLyAyZikpO1xyXG4gICAgICAgICAgICB9Ki9cclxuICAgICAgICAgICAgZWxzZSBpZiAoYWlySnVtcHMgPCBtYXhBaXJKdW1wcyAmJiBfcGxhdGZvcm1lci5QcmVzc2VkKGp1bXBidXR0b24pICYmIF9wbGF0Zm9ybWVyLkNlaWxpbmcgPT0gbnVsbClcclxuICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgX3BsYXRmb3JtZXIuVnNwZWVkID0gLShqdW1wU3BlZWQgKiBhaXJqdW1wcG93ZXIpO1xyXG4gICAgICAgICAgICAgICAgYWlySnVtcHMrKztcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBpZiAoX3BsYXRmb3JtZXIuVnNwZWVkIDwgMCAmJiAhY29udHJvbGxlcltqdW1wYnV0dG9uXSlcclxuICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgX3BsYXRmb3JtZXIuVnNwZWVkICs9IChfcGxhdGZvcm1lci5ncmF2aXR5ICogMik7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgYmFzZS5VcGRhdGUoKTtcclxuICAgICAgICB9XHJcbiAgICB9XHJcbn1cclxuIiwidXNpbmcgU3lzdGVtO1xyXG51c2luZyBTeXN0ZW0uQ29sbGVjdGlvbnMuR2VuZXJpYztcclxudXNpbmcgU3lzdGVtLkxpbnE7XHJcbnVzaW5nIFN5c3RlbS5UZXh0O1xyXG51c2luZyBTeXN0ZW0uVGhyZWFkaW5nLlRhc2tzO1xyXG51c2luZyBCcmlkZ2U7XHJcbnVzaW5nIEJyaWRnZS5IdG1sNTtcclxuXHJcbm5hbWVzcGFjZSBDaXJub0dhbWVcclxue1xyXG4gICAgcHVibGljIGNsYXNzIFBsYXllckJ1bGxldCA6IEVudGl0eSwgSUhhcm1mdWxFbnRpdHksIElMaWdodFNvdXJjZVxyXG4gICAge1xyXG4gICAgICAgIHB1YmxpYyBFbnRpdHkgc2hvb3RlcjtcclxuICAgICAgICBwdWJsaWMgaW50IER1cmF0aW9uID0gMDtcclxuICAgICAgICBwcm90ZWN0ZWQgTGlzdDxFbnRpdHk+IGhpdEVudGl0aWVzO1xyXG4gICAgICAgIHB1YmxpYyBib29sIHBpZXJjaW5nO1xyXG4gICAgICAgIHB1YmxpYyBmbG9hdCBzcGlucmF0ZSA9IDA7XHJcbiAgICAgICAgcHVibGljIFZlY3RvcjIgR3Jhdml0eSA9IG5ldyBWZWN0b3IyKCk7XHJcbiAgICAgICAgcHVibGljIGJvb2wgQm91bmNlcztcclxuICAgICAgICBwdWJsaWMgYm9vbCBhdHRhY2tzdGVycmFpbiA9IGZhbHNlO1xyXG4gICAgICAgIHB1YmxpYyBmbG9hdCBkaWdwb3dlciA9IDAuNWY7XHJcbiAgICAgICAgcHVibGljIGJvb2wgaWdub3Jlc3RlcnJhaW4gPSBmYWxzZTtcclxuICAgICAgICBwdWJsaWMgUGxheWVyQnVsbGV0KEdhbWUgZ2FtZSwgRW50aXR5IHNob290ZXIsIHN0cmluZyBncmFwaGljID0gXCJSZWlzZW5idWxsZXRcIikgOiBiYXNlKGdhbWUpXHJcbiAgICAgICAge1xyXG4gICAgICAgICAgICBBbmkgPSBuZXcgQW5pbWF0aW9uKEFuaW1hdGlvbkxvYWRlci5fdGhpcy5HZXRBbmltYXRpb24oZ3JhcGhpYykpO1xyXG4gICAgICAgICAgICB0aGlzLnNob290ZXIgPSBzaG9vdGVyO1xyXG5cclxuICAgICAgICAgICAgLy9BbmkuSHVlQ29sb3IgPSBHYW1lLkdldFRlYW1Db2xvcigoKElDb21iYXRhbnQpc2hvb3RlcikuVGVhbSk7XHJcbiAgICAgICAgICAgIC8vL0FuaS5IdWVDb2xvciA9IHNob290ZXIuR2V0VGVhbUNvbG9yKCk7XHJcbiAgICAgICAgICAgIC8vL0FuaS5IdWVSZWNvbG9yU3RyZW5ndGggPSAxO1xyXG4gICAgICAgICAgICBwaWVyY2luZyA9IGZhbHNlO1xyXG5cclxuICAgICAgICAgICAgaGl0RW50aXRpZXMgPSBuZXcgTGlzdDxFbnRpdHk+KCk7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBwdWJsaWMgRW50aXR5IEF0dGFja2VyXHJcbiAgICAgICAge1xyXG4gICAgICAgICAgICBnZXRcclxuICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuIHNob290ZXI7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIHB1YmxpYyBib29sIElzSGFybWZ1bFxyXG4gICAgICAgIHtcclxuICAgICAgICAgICAgZ2V0XHJcbiAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgIHJldHVybiB0cnVlO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBwdWJsaWMgYm9vbCBsaWdodEZsaWNrZXJcclxuICAgICAgICB7XHJcbiAgICAgICAgICAgIGdldFxyXG4gICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIHB1YmxpYyBWZWN0b3IyIGxpZ2h0UG9zaXRpb25cclxuICAgICAgICB7XHJcbiAgICAgICAgICAgIGdldFxyXG4gICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gZ2V0Q2VudGVyKCk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIHByb3RlY3RlZCBmbG9hdCBfbWF4TGlnaHRSYWRpdXMgPSAxLjVmO1xyXG4gICAgICAgIHB1YmxpYyBmbG9hdCBtYXhMaWdodFJhZGl1c1xyXG4gICAgICAgIHtcclxuICAgICAgICAgICAgZ2V0XHJcbiAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgIHJldHVybiBBbmkuQWxwaGEgPj0gMSA/IF9tYXhMaWdodFJhZGl1cyA6IDBmO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIHNldFxyXG4gICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICBfbWF4TGlnaHRSYWRpdXMgPSB2YWx1ZTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuICAgICAgICBwdWJsaWMgb3ZlcnJpZGUgUmVjdGFuZ2xlIEdldEhpdGJveCgpXHJcbiAgICAgICAge1xyXG4gICAgICAgICAgICBpZiAoQW5pICE9IG51bGwgJiYgQW5pLkN1cnJlbnRJbWFnZSAhPSBudWxsKVxyXG4gICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICAvL2Zsb2F0IHMgPSBNYXRoLk1heChBbmkuQ3VycmVudEltYWdlLldpZHRoLCBBbmkuQ3VycmVudEltYWdlLkhlaWdodCk7XHJcbiAgICAgICAgICAgICAgICAvL2Zsb2F0IHMgPSBBbmkuQ3VycmVudEltYWdlLkhlaWdodDtcclxuICAgICAgICAgICAgICAgIGZsb2F0IHMgPSBBbmkuQ3VycmVudEltYWdlLkhlaWdodCAqIDEuNWY7XHJcbiAgICAgICAgICAgICAgICAvL2Zsb2F0IHMyID0gcyAvIDJmO1xyXG4gICAgICAgICAgICAgICAgLy9WZWN0b3IyIFYgPSBBbmkuUG9zaXRpb247XHJcbiAgICAgICAgICAgICAgICBmbG9hdCBzbzIgPSBzIC8gMjtcclxuICAgICAgICAgICAgICAgIC8vVmVjdG9yMiBWID0gZ2V0Q2VudGVyKCkgLSBuZXcgVmVjdG9yMihzbzIsc28yKTtcclxuICAgICAgICAgICAgICAgIFZlY3RvcjIgViA9IFZlY3RvcjIuU3VidHJhY3QoZ2V0Q2VudGVyKCksIHNvMiwgc28yKTtcclxuICAgICAgICAgICAgICAgIHJldHVybiBuZXcgUmVjdGFuZ2xlKFYuWCwgVi5ZLCBzLCBzKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICByZXR1cm4gbnVsbDtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIHByb3RlY3RlZCBmbG9hdCBfdG91Y2hEYW1hZ2UgPSAxZjtcclxuICAgICAgICBwdWJsaWMgZmxvYXQgdG91Y2hEYW1hZ2VcclxuICAgICAgICB7XHJcbiAgICAgICAgICAgIGdldFxyXG4gICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gX3RvdWNoRGFtYWdlO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIHNldFxyXG4gICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICBfdG91Y2hEYW1hZ2UgPSB2YWx1ZTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgcHVibGljIGJvb2wgb250b3VjaERhbWFnZShJQ29tYmF0YW50IHRhcmdldClcclxuICAgICAgICB7XHJcbiAgICAgICAgICAgIGlmICghcGllcmNpbmcpXHJcbiAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgIEFsaXZlID0gZmFsc2U7XHJcbiAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgIGJvb2wgb2sgPSAhaGl0RW50aXRpZXMuQ29udGFpbnMoKEVudGl0eSl0YXJnZXQpO1xyXG4gICAgICAgICAgICBpZiAob2spXHJcbiAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgIGhpdEVudGl0aWVzLkFkZCgoRW50aXR5KXRhcmdldCk7XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gdHJ1ZTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICByZXR1cm4gZmFsc2U7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBwdWJsaWMgb3ZlcnJpZGUgdm9pZCBVcGRhdGUoKVxyXG4gICAgICAgIHtcclxuICAgICAgICAgICAgYmFzZS5VcGRhdGUoKTtcclxuICAgICAgICAgICAgaWYgKHNwaW5yYXRlICE9IDApXHJcbiAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgIEFuaS5Sb3RhdGlvbiArPSBzcGlucmF0ZTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBpZiAoR3Jhdml0eS5Sb3VnaExlbmd0aCAhPSAwKVxyXG4gICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICBTcGVlZCArPSBHcmF2aXR5O1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIC8vaWYgKCFBcHAuc2NyZWVuYm91bmRzLmlzVG91Y2hpbmcoR2V0SGl0Ym94KCkpKVxyXG5cclxuICAgICAgICAgICAgLy9pZiAoIUdhbWUuc3RhZ2VCb3VuZHMuaXNUb3VjaGluZyhHZXRIaXRib3goKSkpXHJcbiAgICAgICAgICAgIGlmICghR2FtZS5zdGFnZUJvdW5kcy5jb250YWluc1BvaW50KFBvc2l0aW9uKSlcclxuICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgaWYgKChBbmkuWCA+IDAgPT0gSHNwZWVkID4gMCB8fCBBbmkuWCA8IDAgPT0gSHNwZWVkIDwgMCkgfHwgKEFuaS5ZID4gMCA9PSBWc3BlZWQgPiAwIHx8IEFuaS5ZIDwgMCA9PSBWc3BlZWQgPCAwKSlcclxuICAgICAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgICAgICBBbGl2ZSA9IGZhbHNlO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIC8vVmVjdG9yMiBjZW50ZXIgPSBnZXRDZW50ZXIoKTtcclxuICAgICAgICAgICAgVmVjdG9yMiBjZW50ZXIgPSBWZWN0b3IyLkFkZChQb3NpdGlvbiwgOCwgMCk7XHJcbiAgICAgICAgICAgIGlmICghaWdub3Jlc3RlcnJhaW4pXHJcbiAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgIFRpbGVEYXRhIFQgPSBudWxsO1xyXG4gICAgICAgICAgICAgICAgaWYgKCFCb3VuY2VzKVxyXG4gICAgICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgICAgIFQgPSBHYW1lLlRNLkNoZWNrRm9yVGlsZShuZXcgVmVjdG9yMihjZW50ZXIuWCwgeSkpO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgaWYgKFQgIT0gbnVsbCAmJiBULmVuYWJsZWQgJiYgVC5zb2xpZClcclxuICAgICAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgICAgICBpZiAoYXR0YWNrc3RlcnJhaW4pXHJcbiAgICAgICAgICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAoVC5CcmVha2FibGUpXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vVC5EYW1hZ2UoX3RvdWNoRGFtYWdlICogZGlncG93ZXIpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKFQuRGFtYWdlKGRpZ3Bvd2VyKSlcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBQbGF5U291bmQoXCJ0aHVuazRcIik7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBlbHNlXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgUGxheVNvdW5kKFwidGh1bmtcIik7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICAgICAgZWxzZVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgUGxheVNvdW5kKFwicGxpbmtcIik7XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgIEFsaXZlID0gZmFsc2U7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICBlbHNlIGlmIChCb3VuY2VzKVxyXG4gICAgICAgICAgICAgICAge1xyXG5cclxuICAgICAgICAgICAgICAgICAgICBUID0gR2FtZS5UTS5DaGVja0ZvclRpbGUoY2VudGVyICsgbmV3IFZlY3RvcjIoU3BlZWQuWCkpO1xyXG4gICAgICAgICAgICAgICAgICAgIGlmIChUICE9IG51bGwgJiYgVC5lbmFibGVkICYmIFQuc29saWRUb1NwZWVkKFNwZWVkLlRvQ2FyZGluYWwoKSkpXHJcbiAgICAgICAgICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBTcGVlZC5YID0gLVNwZWVkLlg7XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgICAgICAgICBUID0gR2FtZS5UTS5DaGVja0ZvclRpbGUoY2VudGVyICsgbmV3IFZlY3RvcjIoMCwgU3BlZWQuWSkpO1xyXG4gICAgICAgICAgICAgICAgICAgIGlmIChUICE9IG51bGwgJiYgVC5lbmFibGVkICYmIFQuc29saWRUb1NwZWVkKFNwZWVkLlRvQ2FyZGluYWwoKSkpXHJcbiAgICAgICAgICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBTcGVlZC5ZID0gLVNwZWVkLlk7XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgICAgICAgICBUID0gR2FtZS5UTS5DaGVja0ZvclRpbGUoY2VudGVyICsgU3BlZWQpO1xyXG4gICAgICAgICAgICAgICAgICAgIGlmIChUICE9IG51bGwgJiYgVC5lbmFibGVkICYmIFQuc29saWRUb1NwZWVkKFNwZWVkLlRvQ2FyZGluYWwoKSkpXHJcbiAgICAgICAgICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBTcGVlZC5YID0gLVNwZWVkLlg7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIFNwZWVkLlkgPSAtU3BlZWQuWTtcclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgaWYgKER1cmF0aW9uID4gMClcclxuICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgRHVyYXRpb24tLTtcclxuICAgICAgICAgICAgICAgIGlmIChEdXJhdGlvbiA8PSAwKVxyXG4gICAgICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgICAgIER1cmF0aW9uID0gMTtcclxuICAgICAgICAgICAgICAgICAgICBBbmkuQWxwaGEgLT0gMC4yZjtcclxuICAgICAgICAgICAgICAgICAgICBpZiAoQW5pLkFscGhhIDw9IDApXHJcbiAgICAgICAgICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBBbGl2ZSA9IGZhbHNlO1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuICAgIH1cclxufVxyXG4iLCJ1c2luZyBTeXN0ZW07XHJcbnVzaW5nIFN5c3RlbS5Db2xsZWN0aW9ucy5HZW5lcmljO1xyXG51c2luZyBTeXN0ZW0uTGlucTtcclxudXNpbmcgU3lzdGVtLlRleHQ7XHJcbnVzaW5nIFN5c3RlbS5UaHJlYWRpbmcuVGFza3M7XHJcblxyXG5uYW1lc3BhY2UgQ2lybm9HYW1lXHJcbntcclxuICAgIHB1YmxpYyBjbGFzcyBSYW5kb21BSSA6IEVudGl0eUJlaGF2aW9yXHJcbiAgICB7XHJcbiAgICAgICAgQ29udHJvbGxhYmxlRW50aXR5IENFO1xyXG4gICAgICAgIHB1YmxpYyBSYW5kb21BSShDb250cm9sbGFibGVFbnRpdHkgZW50aXR5KSA6IGJhc2UoZW50aXR5KVxyXG4gICAgICAgIHtcclxuICAgICAgICAgICAgQ0UgPSBlbnRpdHk7XHJcbiAgICAgICAgICAgIHRoaXMuRnJhbWVzUGVyVGljayA9IDE1O1xyXG4gICAgICAgIH1cclxuICAgICAgICBwdWJsaWMgb3ZlcnJpZGUgdm9pZCBVcGRhdGUoKVxyXG4gICAgICAgIHtcclxuICAgICAgICAgICAgYmFzZS5VcGRhdGUoKTtcclxuICAgICAgICAgICAgaWYgKE1hdGguUmFuZG9tKCkgPCAwLjEpXHJcbiAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgIHZhciBDb250cm9sbGVyID0gQ0UuQ29udHJvbGxlcjtcclxuICAgICAgICAgICAgICAgIENvbnRyb2xsZXJbMF0gPSBmYWxzZTtcclxuICAgICAgICAgICAgICAgIENvbnRyb2xsZXJbMV0gPSBmYWxzZTtcclxuICAgICAgICAgICAgICAgIENvbnRyb2xsZXJbMl0gPSBmYWxzZTtcclxuICAgICAgICAgICAgICAgIENvbnRyb2xsZXJbM10gPSBmYWxzZTtcclxuXHJcbiAgICAgICAgICAgICAgICBpZiAoTWF0aC5SYW5kb20oKSA8IDAuNSlcclxuICAgICAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgICAgICBDb250cm9sbGVyWzBdID0gTWF0aC5SYW5kb20oKSA8IDAuNTtcclxuICAgICAgICAgICAgICAgICAgICBDb250cm9sbGVyWzFdID0gIUNvbnRyb2xsZXJbMF07XHJcbiAgICAgICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICAgICAgaWYgKE1hdGguUmFuZG9tKCkgPCAwLjUpXHJcbiAgICAgICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICAgICAgQ29udHJvbGxlclsyXSA9IE1hdGguUmFuZG9tKCkgPCAwLjU7XHJcbiAgICAgICAgICAgICAgICAgICAgQ29udHJvbGxlclszXSA9ICFDb250cm9sbGVyWzJdO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG59XHJcbiIsInVzaW5nIFN5c3RlbTtcclxudXNpbmcgU3lzdGVtLkNvbGxlY3Rpb25zLkdlbmVyaWM7XHJcbnVzaW5nIFN5c3RlbS5MaW5xO1xyXG51c2luZyBTeXN0ZW0uVGV4dDtcclxudXNpbmcgU3lzdGVtLlRocmVhZGluZy5UYXNrcztcclxuXHJcbm5hbWVzcGFjZSBDaXJub0dhbWVcclxue1xyXG4gICAgcHVibGljIGNsYXNzIFJvb21PcGVuaW5nTGV2ZXIgOiBFbnRpdHlcclxuICAgIHtcclxuICAgICAgICBwdWJsaWMgc3RhdGljIFJvb21PcGVuaW5nTGV2ZXIgVEVTVDtcclxuICAgICAgICBwdWJsaWMgUm9vbU9wZW5pbmdMZXZlcihHYW1lIGdhbWUsIFBvaW50IFRpbGUsIE1hcFJvb20gVGFyZ2V0LCBib29sIGZsaXBwZWQ9ZmFsc2UpIDogYmFzZShnYW1lKVxyXG4gICAgICAgIHtcclxuICAgICAgICAgICAgQW5pID0gbmV3IEFuaW1hdGlvbihBbmltYXRpb25Mb2FkZXIuX3RoaXMuR2V0QW5pbWF0aW9uKFwiaW1hZ2VzL21pc2MvbGV2ZXJcIikpO1xyXG4gICAgICAgICAgICBBbmkuSW1hZ2VTcGVlZCA9IDA7XHJcbiAgICAgICAgICAgIEJsb2NrID0gVGlsZTtcclxuICAgICAgICAgICAgdmFyIFQgPSBnYW1lLlRNLkdldFRpbGUoVGlsZS5YLCBUaWxlLlkpO1xyXG4gICAgICAgICAgICBURVNUID0gdGhpcztcclxuICAgICAgICAgICAgaWYgKFQgIT0gbnVsbCAmJiBULnNvbGlkKVxyXG4gICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICBpZiAoVGFyZ2V0ICE9IG51bGwpXHJcbiAgICAgICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5Sb29tID0gVGFyZ2V0O1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgVC5CcmVha2FibGUgPSBmYWxzZTtcclxuICAgICAgICAgICAgICAgIFQuQ2FuU2xvcGUgPSBmYWxzZTtcclxuICAgICAgICAgICAgICAgIHZhciBSID0gVC5HZXRIaXRib3goKTtcclxuICAgICAgICAgICAgICAgIGlmIChmbGlwcGVkKVxyXG4gICAgICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgICAgIEFuaS5Qb3NpdGlvbi5YID0gUi5sZWZ0IC0gMTY7XHJcbiAgICAgICAgICAgICAgICAgICAgQW5pLkZsaXBwZWQgPSB0cnVlO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgZWxzZVxyXG4gICAgICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgICAgIEFuaS5Qb3NpdGlvbi5YID0gUi5yaWdodDtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIEFuaS5Qb3NpdGlvbi5ZID0gUi50b3A7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgZWxzZVxyXG4gICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICBBbGl2ZSA9IGZhbHNlO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHB1YmxpYyBNYXBSb29tIFJvb207XHJcbiAgICAgICAgcHVibGljIFBvaW50IEJsb2NrO1xyXG4gICAgICAgIHB1YmxpYyBib29sIEFjdGl2YXRlZCB7IGdldDsgcHJpdmF0ZSBzZXQ7IH1cclxuICAgICAgICBwdWJsaWMgb3ZlcnJpZGUgdm9pZCBVcGRhdGUoKVxyXG4gICAgICAgIHtcclxuICAgICAgICAgICAgYmFzZS5VcGRhdGUoKTtcclxuICAgICAgICAgICAgdmFyIFQgPSBHYW1lLlRNLkdldFRpbGUoQmxvY2suWCwgQmxvY2suWCk7XHJcbiAgICAgICAgICAgIGlmIChUICE9IG51bGwgJiYgVC5lbmFibGVkICYmIFQuc29saWQpXHJcbiAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgIFQuQnJlYWthYmxlID0gZmFsc2U7XHJcbiAgICAgICAgICAgICAgICBULkNhblNsb3BlID0gZmFsc2U7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgZWxzZVxyXG4gICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICBBbGl2ZSA9IGZhbHNlO1xyXG4gICAgICAgICAgICAgICAgaWYgKFJvb20gIT0gbnVsbClcclxuICAgICAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgICAgICBSb29tLkNsZWFyUm9vbSgpO1xyXG4gICAgICAgICAgICAgICAgICAgIFJvb20uR2VuZXJhdGVQbGF0Zm9ybXMoKTtcclxuICAgICAgICAgICAgICAgICAgICBSb29tLkFwcGx5QnJlYWthYmxlKCk7Ly9hdHRlbXB0IHRvIHJlbW92ZSBzZWFtc1xyXG4gICAgICAgICAgICAgICAgICAgIFJvb20uRm9yY2VSZWRyYXcoKTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIC8vSGVscGVyLkxvZyhcIlJlbW92aW5nIGJyb2tlbiBsZXZlci4uLlwiKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB2YXIgUCA9IChQbGF5ZXJDaGFyYWN0ZXIpR2FtZS5wbGF5ZXI7XHJcbiAgICAgICAgICAgIGlmICghQWN0aXZhdGVkICYmIFAuUG9zaXRpb24uRXN0aW1hdGVkRGlzdGFuY2UoUG9zaXRpb24pIDwgMTYgJiYgUC5Db250cm9sbGVyWzJdKVxyXG4gICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICBBY3RpdmF0ZSgpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHB1YmxpYyB2b2lkIEFjdGl2YXRlKClcclxuICAgICAgICB7XHJcbiAgICAgICAgICAgIGlmICghQWN0aXZhdGVkKVxyXG4gICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICBBY3RpdmF0ZWQgPSB0cnVlO1xyXG4gICAgICAgICAgICAgICAgUGxheVNvdW5kKFwib3BlbjJcIik7Ly9zb3VuZHMgYmV0dGVyIHRoYW4gdGhlIGVsZWN0cm9uaWMgc3dpdGNoLlxyXG4gICAgICAgICAgICAgICAgQW5pLkN1cnJlbnRGcmFtZSA9IDE7XHJcbiAgICAgICAgICAgICAgICBBbmkuU2V0SW1hZ2UoKTtcclxuICAgICAgICAgICAgICAgIEFuaS5VcGRhdGUoKTtcclxuICAgICAgICAgICAgICAgIFJvb20uVW5sZWFzaFNlY3JldCgpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHB1YmxpYyBzdGF0aWMgUm9vbU9wZW5pbmdMZXZlciBGaW5kQW5kUGxhY2VPbldhbGwoR2FtZSBnYW1lLFZlY3RvcjIgUCwgTWFwUm9vbSBUYXJnZXQpXHJcbiAgICAgICAge1xyXG4gICAgICAgICAgICB2YXIgVCA9IGdhbWUuVE0uQ2hlY2tGb3JUaWxlKFApO1xyXG4gICAgICAgICAgICBpZiAoVCAhPSBudWxsKVxyXG4gICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICB2YXIgWCA9IFQuY29sdW1uO1xyXG4gICAgICAgICAgICAgICAgdmFyIFkgPSBULnJvdztcclxuXHJcbiAgICAgICAgICAgICAgICB2YXIgWEQgPSBNYXRoLlJhbmRvbSgpIDwgMC41ID8gLTEgOiAxO1xyXG4gICAgICAgICAgICAgICAgd2hpbGUgKHRydWUpXHJcbiAgICAgICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICAgICAgWCArPSBYRDtcclxuICAgICAgICAgICAgICAgICAgICB2YXIgVDIgPSBnYW1lLlRNLkdldFRpbGUoWCwgWSk7XHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKFQyICE9IG51bGwpXHJcbiAgICAgICAgICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAoVDIuZW5hYmxlZCAmJiBUMi5zb2xpZClcclxuICAgICAgICAgICAgICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFyIFQzID0gZ2FtZS5UTS5HZXRUaWxlKFgtWEQsIFkrMSk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoIShUMyAhPSBudWxsICYmIFQzLmVuYWJsZWQgJiYgVDMuc29saWQpKS8vdG9vIGNsb3NlIHRvIHRoZSBmbG9vciwgdGhlIGxldmVyIGNvdWxkIGJlY29tZSBvYnNjdXJlZC4uLlxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhciByZXQgPSBuZXcgUm9vbU9wZW5pbmdMZXZlcihnYW1lLCBuZXcgUG9pbnQoWCwgWSksIFRhcmdldCwgWEQgPT0gMSk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHJldC5BbGl2ZSA/IHJldCA6IG51bGw7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBlbHNlXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIG51bGw7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgZWxzZVxyXG4gICAgICAgICAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIG51bGw7XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIHJldHVybiBudWxsO1xyXG4gICAgICAgIH1cclxuICAgIH1cclxufVxyXG4iLCJ1c2luZyBTeXN0ZW07XHJcbnVzaW5nIFN5c3RlbS5Db2xsZWN0aW9ucy5HZW5lcmljO1xyXG51c2luZyBTeXN0ZW0uTGlucTtcclxudXNpbmcgU3lzdGVtLlRleHQ7XHJcbnVzaW5nIFN5c3RlbS5UaHJlYWRpbmcuVGFza3M7XHJcbnVzaW5nIEJyaWRnZTtcclxudXNpbmcgQnJpZGdlLkh0bWw1O1xyXG5cclxubmFtZXNwYWNlIENpcm5vR2FtZVxyXG57XHJcbiAgICBwdWJsaWMgY2xhc3MgVGV4dFNwcml0ZSA6IFNwcml0ZVxyXG4gICAge1xyXG4gICAgICAgIHByb3RlY3RlZCBzdHJpbmcgX1RleHQ7XHJcbiAgICAgICAgcHVibGljIHN0cmluZyBUZXh0XHJcbiAgICAgICAge1xyXG4gICAgICAgICAgICBnZXRcclxuICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuIF9UZXh0O1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIHNldFxyXG4gICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICBpZiAoX1RleHQgIT0gdmFsdWUpXHJcbiAgICAgICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICAgICAgX1RleHQgPSB2YWx1ZTtcclxuICAgICAgICAgICAgICAgICAgICAvKlJlZHJhd0Jhc2VUZXh0SW1hZ2UoKTtcclxuICAgICAgICAgICAgICAgICAgICBSZW5kZXJUZXh0SW1hZ2UoKTsqL1xyXG4gICAgICAgICAgICAgICAgICAgIHRleHRJbnZhbGxpZGF0ZWQgPSB0cnVlO1xyXG4gICAgICAgICAgICAgICAgICAgIC8vaW1hZ2VJbnZhbGxpZGF0ZWQgPSB0cnVlO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHByb3RlY3RlZCBib29sIHRleHRJbnZhbGxpZGF0ZWQ7XHJcbiAgICAgICAgcHJvdGVjdGVkIGJvb2wgaW1hZ2VJbnZhbGxpZGF0ZWQ7XHJcblxyXG4gICAgICAgIHByb3RlY3RlZCBIVE1MQ2FudmFzRWxlbWVudCBUZXh0SW1hZ2U7XHJcbiAgICAgICAgcHJvdGVjdGVkIENhbnZhc1JlbmRlcmluZ0NvbnRleHQyRCBUZXh0R3JhcGhpYztcclxuICAgICAgICBwcm90ZWN0ZWQgc3RyaW5nIF9UZXh0Q29sb3I7XHJcbiAgICAgICAgcHVibGljIHN0cmluZyBUZXh0Q29sb3JcclxuICAgICAgICB7XHJcbiAgICAgICAgICAgIGdldFxyXG4gICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gX1RleHRDb2xvcjtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBzZXRcclxuICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgaWYgKF9UZXh0Q29sb3IgIT0gdmFsdWUpXHJcbiAgICAgICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICAgICAgX1RleHRDb2xvciA9IHZhbHVlO1xyXG4gICAgICAgICAgICAgICAgICAgIC8vUmVuZGVyVGV4dEltYWdlKCk7XHJcbiAgICAgICAgICAgICAgICAgICAgdGV4dEludmFsbGlkYXRlZCA9IHRydWU7XHJcblxyXG4gICAgICAgICAgICAgICAgICAgIC8vaW1hZ2VJbnZhbGxpZGF0ZWQgPSB0cnVlO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBwcm90ZWN0ZWQgc3RyaW5nIF9Gb250V2VpZ2h0ID0gXCJub3JtYWxcIjtcclxuICAgICAgICBwdWJsaWMgc3RyaW5nIEZvbnRXZWlnaHRcclxuICAgICAgICB7XHJcbiAgICAgICAgICAgIGdldFxyXG4gICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gX0ZvbnRXZWlnaHQ7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgc2V0XHJcbiAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgIGlmIChfRm9udFdlaWdodCAhPSB2YWx1ZSlcclxuICAgICAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgICAgICBfRm9udFdlaWdodCA9IHZhbHVlO1xyXG4gICAgICAgICAgICAgICAgICAgIFVwZGF0ZUZvbnQoKTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgcHJvdGVjdGVkIHN0cmluZyBfRm9udEZhbWlseSA9IFwic2Fucy1zZXJpZlwiO1xyXG4gICAgICAgIHB1YmxpYyBzdHJpbmcgRm9udEZhbWlseVxyXG4gICAgICAgIHtcclxuICAgICAgICAgICAgZ2V0XHJcbiAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgIHJldHVybiBfRm9udEZhbWlseTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBzZXRcclxuICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgaWYgKF9Gb250RmFtaWx5ICE9IHZhbHVlKVxyXG4gICAgICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgICAgIF9Gb250RmFtaWx5ID0gdmFsdWU7XHJcbiAgICAgICAgICAgICAgICAgICAgVXBkYXRlRm9udCgpO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBwcm90ZWN0ZWQgaW50IF9Gb250U2l6ZSA9IDEwO1xyXG4gICAgICAgIHB1YmxpYyBpbnQgRm9udFNpemVcclxuICAgICAgICB7XHJcbiAgICAgICAgICAgIGdldFxyXG4gICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gX0ZvbnRTaXplO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIHNldFxyXG4gICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICBpZiAoX0ZvbnRTaXplICE9IHZhbHVlKVxyXG4gICAgICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgICAgIF9Gb250U2l6ZSA9IHZhbHVlO1xyXG4gICAgICAgICAgICAgICAgICAgIFVwZGF0ZUZvbnQoKTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgcHJvdGVjdGVkIGZsb2F0IF9zaGFkb3dCbHVyID0gMGY7XHJcbiAgICAgICAgcHVibGljIGZsb2F0IFNoYWRvd0JsdXJcclxuICAgICAgICB7XHJcbiAgICAgICAgICAgIGdldFxyXG4gICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gX3NoYWRvd0JsdXI7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgc2V0XHJcbiAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgIGlmIChfc2hhZG93Qmx1ciAhPSB2YWx1ZSlcclxuICAgICAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgICAgICBfc2hhZG93Qmx1ciA9IHZhbHVlO1xyXG4gICAgICAgICAgICAgICAgICAgIGltYWdlSW52YWxsaWRhdGVkID0gdHJ1ZTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuICAgICAgICBwcm90ZWN0ZWQgVmVjdG9yMiBfc2hhZG93T2Zmc2V0ID0gbmV3IFZlY3RvcjIoKTtcclxuICAgICAgICBwdWJsaWMgVmVjdG9yMiBTaGFkb3dPZmZzZXRcclxuICAgICAgICB7XHJcbiAgICAgICAgICAgIGdldFxyXG4gICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gX3NoYWRvd09mZnNldC5DbG9uZSgpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIHNldFxyXG4gICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICBpZiAoX3NoYWRvd09mZnNldCAhPSB2YWx1ZSAmJiB2YWx1ZS5YICE9IF9zaGFkb3dPZmZzZXQuWCAmJiB2YWx1ZS5ZICE9IF9zaGFkb3dPZmZzZXQuWSlcclxuICAgICAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgICAgICBfc2hhZG93T2Zmc2V0ID0gdmFsdWUuQ2xvbmUoKTtcclxuICAgICAgICAgICAgICAgICAgICBpbWFnZUludmFsbGlkYXRlZCA9IHRydWU7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcbiAgICAgICAgcHJvdGVjdGVkIHN0cmluZyBfc2hhZG93Q29sb3IgPSBcIiMwMDAwMDBcIjtcclxuICAgICAgICBwdWJsaWMgc3RyaW5nIFNoYWRvd0NvbG9yXHJcbiAgICAgICAge1xyXG4gICAgICAgICAgICBnZXRcclxuICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuIF9zaGFkb3dDb2xvcjtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBzZXRcclxuICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgaWYgKF9zaGFkb3dDb2xvciAhPSB2YWx1ZSlcclxuICAgICAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgICAgICBfc2hhZG93Q29sb3IgPSB2YWx1ZTtcclxuICAgICAgICAgICAgICAgICAgICBpbWFnZUludmFsbGlkYXRlZCA9IHRydWU7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIHByb3RlY3RlZCB2b2lkIFVwZGF0ZUZvbnQoKVxyXG4gICAgICAgIHtcclxuICAgICAgICAgICAgVGV4dEdyYXBoaWMuRm9udCA9IF9Gb250V2VpZ2h0ICsgXCIgXCIgKyBfRm9udFNpemUgKyBcInB4IFwiICsgX0ZvbnRGYW1pbHk7XHJcbiAgICAgICAgICAgIHRleHRJbnZhbGxpZGF0ZWQgPSB0cnVlO1xyXG4gICAgICAgICAgICBpbWFnZUludmFsbGlkYXRlZCA9IHRydWU7XHJcbiAgICAgICAgICAgIFRleHRHcmFwaGljLkZpbGxTdHlsZSA9IF9UZXh0Q29sb3I7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICAvKnByb3RlY3RlZCBzdHJpbmcgRm9udFxyXG4gICAgICAgIHtcclxuICAgICAgICAgICAgZ2V0XHJcbiAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgIHJldHVybiBUZXh0R3JhcGhpYy5Gb250O1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIHNldFxyXG4gICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICBpZiAoVGV4dEdyYXBoaWMuRm9udCAhPSB2YWx1ZSlcclxuICAgICAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgICAgICBUZXh0R3JhcGhpYy5Gb250ID0gdmFsdWU7XHJcbiAgICAgICAgICAgICAgICAgICAgdGV4dEludmFsbGlkYXRlZCA9IHRydWU7XHJcbiAgICAgICAgICAgICAgICAgICAgaW1hZ2VJbnZhbGxpZGF0ZWQgPSB0cnVlO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgXHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9Ki9cclxuICAgICAgICBwdWJsaWMgVGV4dFNwcml0ZSgpXHJcbiAgICAgICAge1xyXG4gICAgICAgICAgICBUZXh0SW1hZ2UgPSBuZXcgSFRNTENhbnZhc0VsZW1lbnQoKTtcclxuICAgICAgICAgICAgVGV4dEdyYXBoaWMgPSBUZXh0SW1hZ2UuR2V0Q29udGV4dChDYW52YXNUeXBlcy5DYW52YXNDb250ZXh0MkRUeXBlLkNhbnZhc1JlbmRlcmluZ0NvbnRleHQyRCk7XHJcbiAgICAgICAgICAgIFRleHRHcmFwaGljLkltYWdlU21vb3RoaW5nRW5hYmxlZCA9IGZhbHNlO1xyXG4gICAgICAgICAgICAvL1RleHRHcmFwaGljLkZvbnQuXHJcbiAgICAgICAgICAgIFRleHRJbWFnZS5TdHlsZS5JbWFnZVJlbmRlcmluZyA9IEltYWdlUmVuZGVyaW5nLlBpeGVsYXRlZDtcclxuICAgICAgICAgICAgVGV4dEdyYXBoaWMuRmlsbFN0eWxlID0gXCIjRkZGRkZGXCI7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHByb3RlY3RlZCB2b2lkIFJlZHJhd0Jhc2VUZXh0SW1hZ2UoKVxyXG4gICAgICAgIHtcclxuICAgICAgICAgICAgVXBkYXRlRm9udCgpO1xyXG4gICAgICAgICAgICBzdHJpbmdbXSBsaW5lcyA9IF9UZXh0LlNwbGl0KCdcXG4nKTtcclxuICAgICAgICAgICAgZmxvYXQgSCA9IEZvbnRTaXplICogMWY7XHJcblxyXG5cclxuICAgICAgICAgICAgaW50IFcgPSAwO1xyXG4gICAgICAgICAgICBpbnQgaSA9IDA7XHJcbiAgICAgICAgICAgIHdoaWxlIChpIDwgbGluZXMuTGVuZ3RoKVxyXG4gICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICBUZXh0TWV0cmljcyBUTSA9IFRleHRHcmFwaGljLk1lYXN1cmVUZXh0KGxpbmVzW2ldKTtcclxuICAgICAgICAgICAgICAgIFcgPSBNYXRoLk1heChXLCAoaW50KU1hdGguQ2VpbGluZyhUTS5XaWR0aCkpO1xyXG4gICAgICAgICAgICAgICAgaSsrO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIC8vVGV4dEltYWdlLkhlaWdodCA9IChpbnQpKEggKiAobGluZXMuTGVuZ3RoKzAuNWYpKTtcclxuICAgICAgICAgICAgVGV4dEltYWdlLkhlaWdodCA9IChpbnQpKEggKiAobGluZXMuTGVuZ3RoICsgMC4yNWYpKTtcclxuICAgICAgICAgICAgVGV4dEltYWdlLldpZHRoID0gVztcclxuICAgICAgICAgICAgVXBkYXRlRm9udCgpO1xyXG5cclxuICAgICAgICAgICAgZmxvYXQgWSA9IDA7XHJcbiAgICAgICAgICAgIGkgPSAwO1xyXG4gICAgICAgICAgICB3aGlsZSAoaSA8IGxpbmVzLkxlbmd0aClcclxuICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgVGV4dEdyYXBoaWMuRmlsbFRleHQobGluZXNbaV0sIDAsIChpbnQpKEZvbnRTaXplICsgWSkpO1xyXG4gICAgICAgICAgICAgICAgWSArPSBIO1xyXG4gICAgICAgICAgICAgICAgaSsrO1xyXG4gICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICB0ZXh0SW52YWxsaWRhdGVkID0gZmFsc2U7XHJcbiAgICAgICAgICAgIGltYWdlSW52YWxsaWRhdGVkID0gdHJ1ZTtcclxuICAgICAgICB9XHJcbiAgICAgICAgcHJvdGVjdGVkIHZvaWQgUmVuZGVyVGV4dEltYWdlKClcclxuICAgICAgICB7XHJcblxyXG4gICAgICAgICAgICBpZiAoX3NoYWRvd0JsdXIgPD0gMClcclxuICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgc3ByaXRlQnVmZmVyLldpZHRoID0gVGV4dEltYWdlLldpZHRoO1xyXG4gICAgICAgICAgICAgICAgc3ByaXRlQnVmZmVyLkhlaWdodCA9IFRleHRJbWFnZS5IZWlnaHQ7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgZWxzZVxyXG4gICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICBpbnQgUyA9IChpbnQpTWF0aC5DZWlsaW5nKF9zaGFkb3dCbHVyICsgX3NoYWRvd0JsdXIpO1xyXG4gICAgICAgICAgICAgICAgc3ByaXRlQnVmZmVyLldpZHRoID0gVGV4dEltYWdlLldpZHRoICsgUztcclxuICAgICAgICAgICAgICAgIHNwcml0ZUJ1ZmZlci5IZWlnaHQgPSBUZXh0SW1hZ2UuSGVpZ2h0ICsgUztcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBzcHJpdGVHcmFwaGljcy5TaGFkb3dCbHVyID0gMDtcclxuXHJcbiAgICAgICAgICAgIHNwcml0ZUdyYXBoaWNzLkdsb2JhbENvbXBvc2l0ZU9wZXJhdGlvbiA9IENhbnZhc1R5cGVzLkNhbnZhc0NvbXBvc2l0ZU9wZXJhdGlvblR5cGUuU291cmNlT3ZlcjtcclxuICAgICAgICAgICAgLypzcHJpdGVHcmFwaGljcy5GaWxsU3R5bGUgPSBfVGV4dENvbG9yO1xyXG4gICAgICAgICAgICBzcHJpdGVHcmFwaGljcy5GaWxsUmVjdCgwLCAwLCBzcHJpdGVCdWZmZXIuV2lkdGgsIHNwcml0ZUJ1ZmZlci5IZWlnaHQpO1xyXG4gICAgICAgICAgICBTY3JpcHQuV3JpdGUoXCJ0aGlzLnNwcml0ZUdyYXBoaWNzLmdsb2JhbENvbXBvc2l0ZU9wZXJhdGlvbiA9ICdkZXN0aW5hdGlvbi1pbidcIik7Ki9cclxuICAgICAgICAgICAgaWYgKF9zaGFkb3dCbHVyIDw9IDApXHJcbiAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgIHNwcml0ZUdyYXBoaWNzLkRyYXdJbWFnZShUZXh0SW1hZ2UsIDBmLCAwZik7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgZWxzZVxyXG4gICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICBzcHJpdGVHcmFwaGljcy5EcmF3SW1hZ2UoVGV4dEltYWdlLCBfc2hhZG93Qmx1ciwgX3NoYWRvd0JsdXIpO1xyXG4gICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICBpZiAoX3NoYWRvd0JsdXIgPiAwKVxyXG4gICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICAvLy9zcHJpdGVHcmFwaGljcy5HbG9iYWxDb21wb3NpdGVPcGVyYXRpb24gPSBDYW52YXNUeXBlcy5DYW52YXNDb21wb3NpdGVPcGVyYXRpb25UeXBlLlNvdXJjZU92ZXI7XHJcbiAgICAgICAgICAgICAgICBzcHJpdGVHcmFwaGljcy5TaGFkb3dCbHVyID0gX3NoYWRvd0JsdXI7XHJcbiAgICAgICAgICAgICAgICBzcHJpdGVHcmFwaGljcy5TaGFkb3dDb2xvciA9IF9zaGFkb3dDb2xvcjtcclxuICAgICAgICAgICAgICAgIHNwcml0ZUdyYXBoaWNzLlNoYWRvd09mZnNldFggPSBfc2hhZG93T2Zmc2V0Llg7XHJcbiAgICAgICAgICAgICAgICBzcHJpdGVHcmFwaGljcy5TaGFkb3dPZmZzZXRZID0gX3NoYWRvd09mZnNldC5ZO1xyXG4gICAgICAgICAgICAgICAgc3ByaXRlR3JhcGhpY3MuRHJhd0ltYWdlKHNwcml0ZUJ1ZmZlciwgMGYsIDBmKTtcclxuICAgICAgICAgICAgfVxyXG5cclxuXHJcblxyXG4gICAgICAgICAgICBpbWFnZUludmFsbGlkYXRlZCA9IGZhbHNlO1xyXG4gICAgICAgIH1cclxuICAgICAgICBwdWJsaWMgdm9pZCBGb3JjZVVwZGF0ZSgpXHJcbiAgICAgICAge1xyXG4gICAgICAgICAgICBpZiAodGV4dEludmFsbGlkYXRlZClcclxuICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgUmVkcmF3QmFzZVRleHRJbWFnZSgpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIGlmIChpbWFnZUludmFsbGlkYXRlZClcclxuICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgUmVuZGVyVGV4dEltYWdlKCk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcbiAgICAgICAgcHVibGljIG92ZXJyaWRlIHZvaWQgRHJhdyhDYW52YXNSZW5kZXJpbmdDb250ZXh0MkQgZylcclxuICAgICAgICB7XHJcbiAgICAgICAgICAgIEZvcmNlVXBkYXRlKCk7XHJcbiAgICAgICAgICAgIGJhc2UuRHJhdyhnKTtcclxuICAgICAgICB9XHJcblxyXG4gICAgfVxyXG59XHJcbiIsInVzaW5nIFN5c3RlbTtcclxudXNpbmcgU3lzdGVtLkNvbGxlY3Rpb25zLkdlbmVyaWM7XHJcbnVzaW5nIFN5c3RlbS5MaW5xO1xyXG51c2luZyBTeXN0ZW0uVGV4dDtcclxudXNpbmcgU3lzdGVtLlRocmVhZGluZy5UYXNrcztcclxudXNpbmcgQnJpZGdlLkh0bWw1O1xyXG5cclxubmFtZXNwYWNlIENpcm5vR2FtZVxyXG57XHJcbiAgICBwdWJsaWMgY2xhc3MgVGlsZSA6IEVudGl0eVxyXG4gICAge1xyXG4gICAgICAgIHB1YmxpYyBpbnQgdGlsZTtcclxuICAgICAgICBwdWJsaWMgVGlsZShHYW1lIGdhbWUsIGludCB0aWxlKSA6IGJhc2UoZ2FtZSlcclxuICAgICAgICB7XHJcbiAgICAgICAgICAgIHRoaXMudGlsZSA9IHRpbGU7XHJcbiAgICAgICAgICAgIEFuaSA9IG5ldyBBbmltYXRpb24oQW5pbWF0aW9uTG9hZGVyLkdldChcImltYWdlcy9sYW5kL2JyaWNrXCIpKTtcclxuICAgICAgICAgICAgQW5pLkN1cnJlbnRGcmFtZSA9IHRpbGU7XHJcbiAgICAgICAgICAgIEFuaS5JbWFnZVNwZWVkID0gMDtcclxuICAgICAgICB9XHJcbiAgICAgICAgcHVibGljIG92ZXJyaWRlIHZvaWQgRHJhdyhDYW52YXNSZW5kZXJpbmdDb250ZXh0MkQgZylcclxuICAgICAgICB7XHJcbiAgICAgICAgICAgIC8qaWYgKHRpbGU+PTAgJiYgdGlsZSA8IGFuaS5pbWFnZXMuQ291bnQpXHJcbiAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgIGFuaS5jdXJyZW50RnJhbWUgPSB0aWxlO1xyXG4gICAgICAgICAgICB9Ki9cclxuICAgICAgICAgICAgYmFzZS5EcmF3KGcpO1xyXG4gICAgICAgIH1cclxuICAgIH1cclxufVxyXG4iLCJ1c2luZyBTeXN0ZW07XHJcbnVzaW5nIFN5c3RlbS5Db2xsZWN0aW9ucy5HZW5lcmljO1xyXG51c2luZyBTeXN0ZW0uTGlucTtcclxudXNpbmcgU3lzdGVtLlRleHQ7XHJcbnVzaW5nIFN5c3RlbS5UaHJlYWRpbmcuVGFza3M7XHJcbnVzaW5nIEJyaWRnZTtcclxudXNpbmcgQnJpZGdlLkh0bWw1O1xyXG5cclxubmFtZXNwYWNlIENpcm5vR2FtZVxyXG57XHJcbiAgICBwdWJsaWMgY2xhc3MgVGl0bGVTY3JlZW4gOiBTcHJpdGVcclxuICAgIHtcclxuICAgICAgICBwdWJsaWMgVGV4dFNwcml0ZSBUaXRsZTtcclxuXHJcbiAgICAgICAgcHVibGljIFRleHRTcHJpdGUgVmVyc2lvbjtcclxuXHJcbiAgICAgICAgcHVibGljIFRleHRTcHJpdGUgRGVzYztcclxuXHJcbiAgICAgICAgcHVibGljIFRleHRTcHJpdGUgQ29udHJvbHM7XHJcblxyXG4gICAgICAgIHB1YmxpYyBUZXh0U3ByaXRlIENyZWRpdHM7XHJcblxyXG4gICAgICAgIHB1YmxpYyBCdXR0b25NZW51IG1lbnU7XHJcbiAgICAgICAgQnV0dG9uU3ByaXRlIENvbnRyb2xsZXI7XHJcbiAgICAgICAgcHVibGljIEdhbWUgZ2FtZTtcclxuICAgICAgICBwdWJsaWMgVGl0bGVTY3JlZW4oKVxyXG4gICAgICAgIHtcclxuICAgICAgICAgICAgc3ByaXRlQnVmZmVyLldpZHRoID0gQXBwLkNhbnZhcy5XaWR0aDtcclxuICAgICAgICAgICAgc3ByaXRlQnVmZmVyLkhlaWdodCA9IChpbnQpKHNwcml0ZUJ1ZmZlci5XaWR0aCAqIEFwcC5UYXJnZXRBc3BlY3QpO1xyXG4gICAgICAgICAgICBUaXRsZSA9IG5ldyBUZXh0U3ByaXRlKCk7XHJcbiAgICAgICAgICAgIFRpdGxlLkZvbnRTaXplID0gKGludCkoc3ByaXRlQnVmZmVyLldpZHRoICogMC4wNmYpO1xyXG4gICAgICAgICAgICAvL1RpdGxlLlRleHQgPSBcIkNpcm5vIGFuZCB0aGUgbXlzdGVyaW91cyB0b3dlclwiO1xyXG4gICAgICAgICAgICBUaXRsZS5UZXh0ID0gQXBwLkdhbWVOYW1lO1xyXG4gICAgICAgICAgICBUaXRsZS5UZXh0Q29sb3IgPSBcIiM3N0ZGRkZcIjtcclxuICAgICAgICAgICAgVGl0bGUuU2hhZG93Q29sb3IgPSBcIiMwMDAwMDBcIjtcclxuICAgICAgICAgICAgVGl0bGUuU2hhZG93T2Zmc2V0ID0gbmV3IFZlY3RvcjIoMiwgMik7XHJcbiAgICAgICAgICAgIFRpdGxlLlNoYWRvd0JsdXIgPSAyO1xyXG5cclxuICAgICAgICAgICAgQ2VudGVyVGV4dFdpdGhGbG9hdHMoVGl0bGUsIDAuNWYsIDAuMDZmKTtcclxuXHJcbiAgICAgICAgICAgIFZlcnNpb24gPSBuZXcgVGV4dFNwcml0ZSgpO1xyXG4gICAgICAgICAgICBWZXJzaW9uLkZvbnRTaXplID0gKGludCkoc3ByaXRlQnVmZmVyLldpZHRoICogMC4wMTZmKTtcclxuICAgICAgICAgICAgVmVyc2lvbi5UZXh0ID0gXCJWZXJzaW9uOlwiICsgQXBwLkdhbWVWZXJzaW9uO1xyXG4gICAgICAgICAgICBWZXJzaW9uLlRleHRDb2xvciA9IFwiI0ZGRkZGRlwiO1xyXG4gICAgICAgICAgICBWZXJzaW9uLlNoYWRvd0NvbG9yID0gXCIjMDAwMDAwXCI7XHJcbiAgICAgICAgICAgIFZlcnNpb24uU2hhZG93T2Zmc2V0ID0gbmV3IFZlY3RvcjIoMiwgMik7XHJcbiAgICAgICAgICAgIFZlcnNpb24uU2hhZG93Qmx1ciA9IDI7XHJcblxyXG4gICAgICAgICAgICBDZW50ZXJUZXh0V2l0aEZsb2F0cyhWZXJzaW9uLCAwLjc1ZiwgMC4xMWYpO1xyXG5cclxuICAgICAgICAgICAgLypUaXRsZS5Gb3JjZVVwZGF0ZSgpO1xyXG4gICAgICAgICAgICBUaXRsZS5Qb3NpdGlvbi5ZID0gc3ByaXRlQnVmZmVyLkhlaWdodCAqIDAuMDFmO1xyXG4gICAgICAgICAgICBUaXRsZS5Qb3NpdGlvbi5YID0gKHNwcml0ZUJ1ZmZlci5XaWR0aCAvIDIpIC0gKFRpdGxlLnNwcml0ZUJ1ZmZlci5XaWR0aCAvIDIpOyovXHJcblxyXG5cclxuXHJcbiAgICAgICAgICAgIERlc2MgPSBuZXcgVGV4dFNwcml0ZSgpO1xyXG4gICAgICAgICAgICBEZXNjLkZvbnRTaXplID0gKGludCkoc3ByaXRlQnVmZmVyLldpZHRoICogMC4wMzBmKTtcclxuICAgICAgICAgICAgRGVzYy5UZXh0Q29sb3IgPSBcIiNGRkZGRkZcIjtcclxuICAgICAgICAgICAgLy9EZXNjLlRleHQgPSBcIkNpcm5vIGhhcyBmb3VuZCBoZXJzZWxmIGluIGEgc3RyYW5nZSBkdW5nZW9uIGZpbGxlZCB3aXRoIGdob3N0cyFcXG5IZXIgZW5lcmd5IGhhcyBiZWVuIHN0b2xlbiwgcmVjbGFpbSB0aGUgZW5lcmd5IG9yYnMgdG8gZXh0ZW5kIHlvdXIgdGltZS5cXG5GaW5kIHRoZSBiaWcga2V5IHRvIHVubG9jayB0aGUgZG9vci5cIjtcclxuICAgICAgICAgICAgLy9EZXNjLlRleHQgPSBcIkNpcm5vIGhhcyBmb3VuZCBoZXJzZWxmIGluIGEgc3RyYW5nZSBkdW5nZW9uIGZpbGxlZCB3aXRoIGdob3N0cyFcXG5SZWNsYWltIHlvdXIgc3RvbGVuIGVuZXJneSBzZWFsZWQgaW5zaWRlIHRoZSBvcmJzIHRvIGV4dGVuZCB5b3VyIHRpbWUuXFxuRmluZCB0aGUgZ29sZCBrZXkgdG8gdW5sb2NrIHRoZSBkb29yLlwiO1xyXG4gICAgICAgICAgICBEZXNjLlRleHQgPSBcIkNpcm5vIGhhcyBmb3VuZCBoZXJzZWxmIGluIGEgc3RyYW5nZSB0b3dlciBmaWxsZWQgd2l0aCBnaG9zdHMhXFxuUmVjbGFpbSB5b3VyIHN0b2xlbiBlbmVyZ3kgc2VhbGVkIGluc2lkZSB0aGUgb3JicyB0byBleHRlbmQgeW91ciB0aW1lLlxcblJlbWVtYmVyIHRoZSBkb29yJ3MgbG9jYXRpb24gYW5kIHNlYXJjaCBmb3IgdGhlIGdvbGQga2V5LlwiO1xyXG4gICAgICAgICAgICBEZXNjLlNoYWRvd0NvbG9yID0gXCIjMDAwMDAwXCI7XHJcbiAgICAgICAgICAgIERlc2MuU2hhZG93T2Zmc2V0ID0gbmV3IFZlY3RvcjIoMiwgMik7XHJcbiAgICAgICAgICAgIERlc2MuU2hhZG93Qmx1ciA9IDI7XHJcbiAgICAgICAgICAgIENlbnRlclRleHRXaXRoRmxvYXRzKERlc2MsIDAuNWYsIDAuMmYpO1xyXG5cclxuICAgICAgICAgICAgQ29udHJvbHMgPSBuZXcgVGV4dFNwcml0ZSgpO1xyXG4gICAgICAgICAgICBDb250cm9scy5Gb250U2l6ZSA9IChpbnQpKHNwcml0ZUJ1ZmZlci5XaWR0aCAqIDAuMDI1Zik7XHJcbiAgICAgICAgICAgIENvbnRyb2xzLlRleHRDb2xvciA9IFwiI0ZGRkZGRlwiO1xyXG4gICAgICAgICAgICBDb250cm9scy5UZXh0ID0gXCJLZXlib2FyZCBDb250cm9sczpcXG5MZWZ0L1JpZ2h0PU1vdmVcXG5VcC9Eb3duPUFpbShVcCBhY3RpdmF0ZXMgY2hlc3RzL2Rvb3JzKVxcblo9U2hvb3RcXG5YPUp1bXAvTWlkLWFpciBqdW1wXFxuQT1QbGFjZSBibG9jayBiZWxvdyB5b3UoY29zdHMgdGltZSlcXG5FbnRlcj1QYXVzZVxcbk09VG9nZ2xlIG11dGVcIjtcclxuICAgICAgICAgICAgQ29udHJvbHMuU2hhZG93Q29sb3IgPSBcIiMwMDAwMDBcIjtcclxuICAgICAgICAgICAgQ29udHJvbHMuU2hhZG93T2Zmc2V0ID0gbmV3IFZlY3RvcjIoMiwgMik7XHJcbiAgICAgICAgICAgIENvbnRyb2xzLlNoYWRvd0JsdXIgPSAyO1xyXG4gICAgICAgICAgICBDZW50ZXJUZXh0V2l0aEZsb2F0cyhDb250cm9scywgMC41ZiwgMC40Zik7XHJcbiAgICAgICAgICAgIENvbnRyb2xzLlBvc2l0aW9uLlggPSBEZXNjLlBvc2l0aW9uLlg7XHJcblxyXG4gICAgICAgICAgICBtZW51ID0gbmV3IEJ1dHRvbk1lbnUoc3ByaXRlQnVmZmVyLldpZHRoICogMC44Ziwgc3ByaXRlQnVmZmVyLkhlaWdodCAqIDAuNWYsIChpbnQpKHNwcml0ZUJ1ZmZlci5XaWR0aCAqIDAuMDVmKSk7XHJcbiAgICAgICAgICAgIHZhciBCID0gbWVudS5BZGRCdXR0b24oXCJTdGFydCBHYW1lXCIpO1xyXG4gICAgICAgICAgICBCLk9uQ2xpY2sgPSAoKSA9PiB7XHJcbiAgICAgICAgICAgICAgICBnYW1lLlN0YXJ0KCk7XHJcbiAgICAgICAgICAgIH07XHJcbiAgICAgICAgICAgIC8vbWVudS5GaW5pc2goKTtcclxuICAgICAgICAgICAgQi5Qb3NpdGlvbi5YICs9IHNwcml0ZUJ1ZmZlci5XaWR0aCAqIDAuMzhmO1xyXG4gICAgICAgICAgICBCLlBvc2l0aW9uLlkgPSBzcHJpdGVCdWZmZXIuSGVpZ2h0ICogMC43ZjtcclxuXHJcbiAgICAgICAgICAgIC8vdmFyIENCID0gbWVudS5BZGRCdXR0b24oXCJDb250cm9sbGVyOlwiK0lucHV0Q29udHJvbGxlck1hbmFnZXIuX3RoaXMuQ29udHJvbGxlcnNbMF0uaWQpO1xyXG4gICAgICAgICAgICB2YXIgQ0IgPSBtZW51LkFkZEJ1dHRvbihcIkNvbnRyb2xsZXI6XCIgKyBBcHAuSUMuaWQpO1xyXG4gICAgICAgICAgICBDb250cm9sbGVyID0gQ0I7XHJcbiAgICAgICAgICAgIENCLk9uQ2xpY2sgPSAoKSA9PiB7XHJcbiAgICAgICAgICAgICAgICB2YXIgaW5kID0gSW5wdXRDb250cm9sbGVyTWFuYWdlci5fdGhpcy5Db250cm9sbGVycy5JbmRleE9mKEFwcC5JQyk7XHJcbiAgICAgICAgICAgICAgICBpbmQrKztcclxuICAgICAgICAgICAgICAgIGlmIChpbmQ+PSBJbnB1dENvbnRyb2xsZXJNYW5hZ2VyLl90aGlzLkNvbnRyb2xsZXJzLkNvdW50KVxyXG4gICAgICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgICAgIGluZCAtPSBJbnB1dENvbnRyb2xsZXJNYW5hZ2VyLl90aGlzLkNvbnRyb2xsZXJzLkNvdW50O1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgQXBwLklDID0gSW5wdXRDb250cm9sbGVyTWFuYWdlci5fdGhpcy5Db250cm9sbGVyc1tpbmRdO1xyXG4gICAgICAgICAgICAgICAgdmFyIFRTID0gQ0IuQ29udGVudHMuQXM8VGV4dFNwcml0ZT4oKTtcclxuICAgICAgICAgICAgICAgIHZhciBXID0gVFMuc3ByaXRlQnVmZmVyLldpZHRoO1xyXG4gICAgICAgICAgICAgICAgVFMuVGV4dCA9IFwiQ29udHJvbGxlcjpcIiArIEFwcC5JQy5pZDtcclxuICAgICAgICAgICAgICAgIFRTLkZvcmNlVXBkYXRlKCk7XHJcbiAgICAgICAgICAgICAgICBDQi5Qb3NpdGlvbi5YIC09ICgoVFMuc3ByaXRlQnVmZmVyLldpZHRoIC0gVykgLyAyKTtcclxuICAgICAgICAgICAgfTtcclxuICAgICAgICAgICAgQ0IuUG9zaXRpb24uWCArPSBzcHJpdGVCdWZmZXIuV2lkdGggKiAwLjM4ZjsgO1xyXG4gICAgICAgICAgICBDQi5Qb3NpdGlvbi5ZID0gQi5Qb3NpdGlvbi5ZICsgKHNwcml0ZUJ1ZmZlci5IZWlnaHQgKiAwLjE1Zik7XHJcbiAgICAgICAgICAgIC8vQ0IuVmlzaWJsZSA9IGZhbHNlO1xyXG4gICAgICAgICAgICBDQi5Mb2NrKCk7XHJcblxyXG4gICAgICAgICAgICBDcmVkaXRzID0gbmV3IFRleHRTcHJpdGUoKTtcclxuICAgICAgICAgICAgQ3JlZGl0cy5Gb250U2l6ZSA9IChpbnQpKHNwcml0ZUJ1ZmZlci5XaWR0aCAqIDAuMDE1Zik7XHJcbiAgICAgICAgICAgIENyZWRpdHMuVGV4dENvbG9yID0gXCIjNzdGRkZGXCI7XHJcbiAgICAgICAgICAgIC8vQ3JlZGl0cy5UZXh0ID0gXCJNYWRlIGJ5OlJTR21ha2VyICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgVG91aG91IFByb2plY3QgYW5kIGl0J3MgY2hhcmFjdGVycyBhcmUgb3duZWQgYnkgWlVOXCI7XHJcbiAgICAgICAgICAgIENyZWRpdHMuVGV4dCA9IFwiTWFkZSBieTpSU0dtYWtlciAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgVG91aG91IFByb2plY3QgYW5kIGl0J3MgY2hhcmFjdGVycyBhcmUgb3duZWQgYnkgWlVOXCI7XHJcbiAgICAgICAgICAgIENyZWRpdHMuU2hhZG93Q29sb3IgPSBcIiMwMDAwMDBcIjtcclxuICAgICAgICAgICAgQ3JlZGl0cy5TaGFkb3dPZmZzZXQgPSBuZXcgVmVjdG9yMigyLCAyKTtcclxuICAgICAgICAgICAgQ3JlZGl0cy5TaGFkb3dCbHVyID0gMjtcclxuICAgICAgICAgICAgQ2VudGVyVGV4dFdpdGhGbG9hdHMoQ3JlZGl0cywgMC41ZiwgMC45OGYpO1xyXG4gICAgICAgIH1cclxuICAgICAgICBwdWJsaWMgdm9pZCBDZW50ZXJUZXh0V2l0aEZsb2F0cyhUZXh0U3ByaXRlIFQsIGZsb2F0IFgsIGZsb2F0IFkpXHJcbiAgICAgICAge1xyXG4gICAgICAgICAgICBDZW50ZXJUZXh0KFQsIG5ldyBWZWN0b3IyKHNwcml0ZUJ1ZmZlci5XaWR0aCAqIFgsIHNwcml0ZUJ1ZmZlci5IZWlnaHQgKiBZKSk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHB1YmxpYyB2b2lkIENlbnRlclRleHQoVGV4dFNwcml0ZSBULCBWZWN0b3IyIExvY2F0aW9uKVxyXG4gICAgICAgIHtcclxuICAgICAgICAgICAgVC5Gb3JjZVVwZGF0ZSgpO1xyXG4gICAgICAgICAgICBULlBvc2l0aW9uLlggPSBMb2NhdGlvbi5YIC0gKFQuc3ByaXRlQnVmZmVyLldpZHRoIC8gMik7XHJcbiAgICAgICAgICAgIFQuUG9zaXRpb24uWSA9IExvY2F0aW9uLlkgLSAoVC5zcHJpdGVCdWZmZXIuSGVpZ2h0IC8gMik7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHB1YmxpYyBvdmVycmlkZSB2b2lkIERyYXcoQ2FudmFzUmVuZGVyaW5nQ29udGV4dDJEIGcpXHJcbiAgICAgICAge1xyXG4gICAgICAgICAgICBiYXNlLkRyYXcoZyk7XHJcbiAgICAgICAgICAgIGlmIChDb250cm9sbGVyLmxvY2tlZCAmJiBJbnB1dENvbnRyb2xsZXJNYW5hZ2VyLl90aGlzLkNvbnRyb2xsZXJzLkNvdW50ID4gMSlcclxuICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgQ29udHJvbGxlci5VbmxvY2soKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBcclxuICAgICAgICAgICAgVGl0bGUuRHJhdyhnKTtcclxuICAgICAgICAgICAgVmVyc2lvbi5EcmF3KGcpO1xyXG4gICAgICAgICAgICBEZXNjLkRyYXcoZyk7XHJcbiAgICAgICAgICAgIENvbnRyb2xzLkRyYXcoZyk7XHJcbiAgICAgICAgICAgIG1lbnUuRHJhdyhnKTtcclxuICAgICAgICAgICAgbWVudS5VcGRhdGUoKTtcclxuICAgICAgICAgICAgQ3JlZGl0cy5EcmF3KGcpO1xyXG5cclxuICAgICAgICAgICAgLy92YXIgTSA9IEtleWJvYXJkTWFuYWdlci5fdGhpcy5Nb3VzZVBvc2l0aW9uLkNsb25lKCk7XHJcbiAgICAgICAgICAgIHZhciBNID0gS2V5Ym9hcmRNYW5hZ2VyLl90aGlzLkNNb3VzZS5DbG9uZSgpO1xyXG4gICAgICAgICAgICBpZiAoIUFwcC5EaXYuU3R5bGUuTGVmdC5Db250YWlucyhcInB4XCIpKVxyXG4gICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICByZXR1cm47XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgLypNLlggLT0gZmxvYXQuUGFyc2UoQXBwLkRpdi5TdHlsZS5MZWZ0LlJlcGxhY2UoXCJweFwiLCBcIlwiKSk7Ki9cclxuICAgICAgICAgICAgLy9DcmVkaXRzLlRleHQgPSBcIlg6XCIgKyBNLlgrXCIvXCIrKHNwcml0ZUJ1ZmZlci5XaWR0aCAqIDAuMSkgK1wiIFk6XCIrTS5ZK1wiL1wiKyhzcHJpdGVCdWZmZXIuSGVpZ2h0ICogMC45Nik7XHJcbiAgICAgICAgICAgIGlmIChNLlggPCBzcHJpdGVCdWZmZXIuV2lkdGggKiAwLjE3ICYmIE0uWSA+PSBzcHJpdGVCdWZmZXIuSGVpZ2h0ICogMC45NilcclxuICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgQXBwLkRpdi5TdHlsZS5DdXJzb3IgPSBDdXJzb3IuUG9pbnRlcjtcclxuICAgICAgICAgICAgICAgIGlmIChLZXlib2FyZE1hbmFnZXIuX3RoaXMuVGFwcGVkTW91c2VCdXR0b25zLkNvbnRhaW5zKDApKVxyXG4gICAgICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgICAgIEdsb2JhbC5Mb2NhdGlvbi5IcmVmID0gXCJodHRwczovL3JzZ21ha2VyLmRldmlhbnRhcnQuY29tXCI7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgZWxzZVxyXG4gICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICBBcHAuRGl2LlN0eWxlLkN1cnNvciA9IG51bGw7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcbiAgICB9XHJcbn1cclxuIiwidXNpbmcgU3lzdGVtO1xyXG51c2luZyBTeXN0ZW0uQ29sbGVjdGlvbnMuR2VuZXJpYztcclxudXNpbmcgU3lzdGVtLkxpbnE7XHJcbnVzaW5nIFN5c3RlbS5UZXh0O1xyXG51c2luZyBTeXN0ZW0uVGhyZWFkaW5nLlRhc2tzO1xyXG5cclxubmFtZXNwYWNlIENpcm5vR2FtZVxyXG57XHJcbiAgICBwdWJsaWMgY2xhc3MgVHVycmV0IDogRW50aXR5LCBJQ29tYmF0YW50XHJcbiAgICB7XHJcbiAgICAgICAgcHVibGljIGZsb2F0IGF0dGFja3Bvd2VyID0gMTtcclxuICAgICAgICAvL3B1YmxpYyBmbG9hdCBkZWZlbnNlcG93ZXIgPSAxO1xyXG4gICAgICAgIHB1YmxpYyBUdXJyZXQoR2FtZSBnYW1lKSA6IGJhc2UoZ2FtZSlcclxuICAgICAgICB7XHJcbiAgICAgICAgICAgIEFuaSA9IG5ldyBBbmltYXRpb24oQW5pbWF0aW9uTG9hZGVyLl90aGlzLkdldEFuaW1hdGlvbihcImltYWdlcy9lbmVtaWVzL3R1cnJldFwiKSk7XHJcbiAgICAgICAgICAgIEFuaS5JbWFnZVNwZWVkID0gMDtcclxuXHJcbiAgICAgICAgICAgIGF0dGFja3Bvd2VyID0gMSArIChHYW1lLmxldmVsICogMC41Zik7XHJcbiAgICAgICAgICAgIGF0dGFja3Bvd2VyICo9IDI7XHJcbiAgICAgICAgICAgIEhQID0gMDtcclxuICAgICAgICAgICAgVGVhbSA9IDI7XHJcbiAgICAgICAgICAgIC8vZGVmZW5zZXBvd2VyID0gMSArIChHYW1lLmxldmVsICogMC41Zik7XHJcbiAgICAgICAgICAgIGlmIChHYW1lLnBsYXlpbmcpXHJcbiAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgIHZhciBBID0gQWRkQmVoYXZpb3I8QWltZWRTaG9vdGVyPigpO1xyXG4gICAgICAgICAgICAgICAgQS5hdHRhY2twb3dlciA9IGF0dGFja3Bvd2VyO1xyXG4gICAgICAgICAgICAgICAgQS5tYXh0aW1lID0gTWF0aC5NYXgoNDgwIC0gKEdhbWUubGV2ZWwgKiAxMCksIDM4MCk7XHJcbiAgICAgICAgICAgICAgICAvL0EubWF4dGltZSA9IChpbnQpKEEubWF4dGltZSoxLjc1Zik7XHJcbiAgICAgICAgICAgICAgICBBLm1heHRpbWUgPSAoaW50KShBLm1heHRpbWUgKiAxLjI1Zik7XHJcbiAgICAgICAgICAgICAgICBBLmlnbm9yZXN0ZXJyYWluID0gdHJ1ZTtcclxuICAgICAgICAgICAgICAgIEEubWF4RGlzdGFuY2UgKj0gMS4zZjtcclxuICAgICAgICAgICAgICAgIEEubWF4U2hhZG93ID0gMTtcclxuICAgICAgICAgICAgICAgIEEuYnVsbGV0U3BlZWQgKj0gMC44MGY7XHJcbiAgICAgICAgICAgICAgICBBLmJ1bGxldER1cmF0aW9uID0gNjAgKiA5O1xyXG4gICAgICAgICAgICAgICAgQS5idWxsZXRncmFwaGljID0gXCJ0dXJyZXRidWxsZXRcIjtcclxuICAgICAgICAgICAgICAgIEEuYXR0YWNrVGVsZWdyYXBoVGltZSArPSBBLmF0dGFja1RlbGVncmFwaFRpbWU7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIHB1YmxpYyBpbnQgVGVhbSB7IGdldDsgc2V0OyB9XHJcblxyXG4gICAgICAgIHB1YmxpYyBmbG9hdCBIUCB7IGdldDsgc2V0OyB9XHJcblxyXG4gICAgICAgIHB1YmxpYyBpbnQgUG9pbnRzRm9yS2lsbGluZ1xyXG4gICAgICAgIHtcclxuICAgICAgICAgICAgZ2V0XHJcbiAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgIHJldHVybiAxO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBwdWJsaWMgZmxvYXQgVGFyZ2V0UHJpb3JpdHlcclxuICAgICAgICB7XHJcbiAgICAgICAgICAgIGdldFxyXG4gICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gMC41ZjtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgcHVibGljIG92ZXJyaWRlIFZlY3RvcjIgZ2V0Q2VudGVyKClcclxuICAgICAgICB7XHJcbiAgICAgICAgICAgIHJldHVybiBWZWN0b3IyLkFkZChQb3NpdGlvbiwgNSwgNSk7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBwdWJsaWMgdm9pZCBvbkRhbWFnZWQoSUhhcm1mdWxFbnRpdHkgc291cmNlLCBmbG9hdCBhbW91bnQpXHJcbiAgICAgICAge1xyXG4gICAgICAgICAgICAvL3Rocm93IG5ldyBOb3RJbXBsZW1lbnRlZEV4Y2VwdGlvbigpO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgcHVibGljIHZvaWQgb25EZWF0aChJSGFybWZ1bEVudGl0eSBzb3VyY2UpXHJcbiAgICAgICAge1xyXG4gICAgICAgICAgICAvL3Rocm93IG5ldyBOb3RJbXBsZW1lbnRlZEV4Y2VwdGlvbigpO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgcHVibGljIHZvaWQgb25LaWxsKElDb21iYXRhbnQgY29tYmF0YW50KVxyXG4gICAgICAgIHtcclxuICAgICAgICAgICAgLy90aHJvdyBuZXcgTm90SW1wbGVtZW50ZWRFeGNlcHRpb24oKTtcclxuICAgICAgICB9XHJcbiAgICAgICAgcHVibGljIFRpbGVEYXRhIFRURDtcclxuXHJcbiAgICAgICAgcHVibGljIHZvaWQgU2V0RG93bihib29sIGZvcmNlZG93biA9IGZhbHNlKVxyXG4gICAgICAgIHtcclxuICAgICAgICAgICAgdmFyIFRaID0gR2FtZS5UTS50aWxlc2l6ZTtcclxuICAgICAgICAgICAgdmFyIFREID0gR2FtZS5UTS5DaGVja0ZvclRpbGUoUG9zaXRpb24pO1xyXG4gICAgICAgICAgICB2YXIgYXR0ZW1wdHMgPSAwO1xyXG4gICAgICAgICAgICB2YXIgZGlyZWN0aW9uID0gTWF0aC5SYW5kb20oKSA8IDAuNSA/IFRaIDogLVRaO1xyXG4gICAgICAgICAgICBpZiAoZm9yY2Vkb3duKVxyXG4gICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICBkaXJlY3Rpb24gPSBUWjtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB3aGlsZSAoIShURCAhPSBudWxsICYmIFRELnNvbGlkICYmIFRELnZpc2libGUpICYmIGF0dGVtcHRzPDIwKVxyXG4gICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICB5ICs9IGRpcmVjdGlvbjtcclxuICAgICAgICAgICAgICAgIFREID0gR2FtZS5UTS5DaGVja0ZvclRpbGUoUG9zaXRpb24pO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIGlmIChhdHRlbXB0cyA+PSAyMClcclxuICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgQWxpdmUgPSBmYWxzZTtcclxuICAgICAgICAgICAgICAgIHJldHVybjtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBlbHNlXHJcbiAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgIHggPSAoVEQuY29sdW1uICogVFopICsgR2FtZS5UTS5wb3NpdGlvbi5YO1xyXG4gICAgICAgICAgICAgICAgeSA9IChURC5yb3cgKiBUWikgKyBHYW1lLlRNLnBvc2l0aW9uLlk7XHJcbiAgICAgICAgICAgICAgICAvL1RELkhQID0gVEQubWF4SFAgKiAyO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIFRURCA9IFREO1xyXG5cclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIHB1YmxpYyBvdmVycmlkZSB2b2lkIFVwZGF0ZSgpXHJcbiAgICAgICAge1xyXG4gICAgICAgICAgICB2YXIgVEQgPSBHYW1lLlRNLkNoZWNrRm9yVGlsZShQb3NpdGlvbik7XHJcbiAgICAgICAgICAgIGlmIChURCE9bnVsbCAmJiBURC5zb2xpZCAmJiBURC52aXNpYmxlICYmIFRELm9wYXF1ZSlcclxuICAgICAgICAgICAge1xyXG5cclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBlbHNlIGlmIChBbGl2ZSlcclxuICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgQWxpdmUgPSBmYWxzZTtcclxuICAgICAgICAgICAgICAgIENvbGxlY3RhYmxlSXRlbSBQID0gbmV3IFBvaW50SXRlbShHYW1lKTtcclxuICAgICAgICAgICAgICAgIFAuUG9zaXRpb24uQ29weUZyb20oUG9zaXRpb24pO1xyXG4gICAgICAgICAgICAgICAgUC5jb2xsZWN0aW9uRGVsYXkgLz0gMjtcclxuICAgICAgICAgICAgICAgIEdhbWUuQWRkRW50aXR5KFApO1xyXG4gICAgICAgICAgICAgICAgaWYgKE1hdGguUmFuZG9tKCkgPCAwLjE1KVxyXG4gICAgICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgICAgIFAgPSBuZXcgSGVhbGluZ0l0ZW0oR2FtZSk7XHJcbiAgICAgICAgICAgICAgICAgICAgUC5Qb3NpdGlvbi5Db3B5RnJvbShQb3NpdGlvbik7XHJcbiAgICAgICAgICAgICAgICAgICAgUC5Wc3BlZWQgPSAtMjtcclxuICAgICAgICAgICAgICAgICAgICBQLmNvbGxlY3Rpb25EZWxheSAvPSAyO1xyXG4gICAgICAgICAgICAgICAgICAgIEdhbWUuQWRkRW50aXR5KFApO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgcmV0dXJuO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIGlmIChURC5DYW5TbG9wZSlcclxuICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgdmFyIHJlZHJhdyA9IGZhbHNlO1xyXG4gICAgICAgICAgICAgICAgaWYgKFRELlNsb3BlRGlyZWN0aW9uICE9IDApXHJcbiAgICAgICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICAgICAgcmVkcmF3ID0gdHJ1ZTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIFRELkNhblNsb3BlID0gZmFsc2U7XHJcbiAgICAgICAgICAgICAgICBpZiAocmVkcmF3KVxyXG4gICAgICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgICAgIFRELlVwZGF0ZVRpbGUoKTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBpZiAoQW5pLlNoYWRvdyA+IDApXHJcbiAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgIEFuaS5JbWFnZVNwZWVkID0gMC4yNWY7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgZWxzZSBpZiAoQW5pLkltYWdlU3BlZWQgPiAwKVxyXG4gICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICBBbmkuSW1hZ2VTcGVlZCA9IDA7XHJcbiAgICAgICAgICAgICAgICBBbmkuQ3VycmVudEZyYW1lID0gMDtcclxuICAgICAgICAgICAgICAgIEFuaS5TZXRJbWFnZSgpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIGJhc2UuVXBkYXRlKCk7XHJcbiAgICAgICAgICAgIFxyXG4gICAgICAgIH1cclxuICAgIH1cclxufVxyXG4iLCJ1c2luZyBTeXN0ZW07XHJcbnVzaW5nIFN5c3RlbS5Db2xsZWN0aW9ucy5HZW5lcmljO1xyXG51c2luZyBTeXN0ZW0uTGlucTtcclxudXNpbmcgU3lzdGVtLlRleHQ7XHJcbnVzaW5nIFN5c3RlbS5UaHJlYWRpbmcuVGFza3M7XHJcblxyXG5uYW1lc3BhY2UgQ2lybm9HYW1lXHJcbntcclxuICAgIHB1YmxpYyBjbGFzcyBEb29yS2V5IDogQ29sbGVjdGFibGVJdGVtXHJcbiAgICB7XHJcbiAgICAgICAgcHVibGljIERvb3JLZXkoR2FtZSBnYW1lKSA6IGJhc2UoZ2FtZSwgXCJiaWdrZXlcIilcclxuICAgICAgICB7XHJcbiAgICAgICAgICAgIGZsb2F0cyA9IGZhbHNlO1xyXG4gICAgICAgICAgICBtYWduZXREaXN0YW5jZSA9IDIwO1xyXG4gICAgICAgICAgICBzb3VuZCA9IFwia2V5XCI7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBwdWJsaWMgb3ZlcnJpZGUgdm9pZCBvbkNvbGxlY3RlZChQbGF5ZXJDaGFyYWN0ZXIgcGxheWVyKVxyXG4gICAgICAgIHtcclxuICAgICAgICAgICAgLy90aHJvdyBuZXcgTm90SW1wbGVtZW50ZWRFeGNlcHRpb24oKTtcclxuICAgICAgICAgICAgR2FtZS5Eb29yLk9wZW5lZCA9IHRydWU7XHJcblxyXG4gICAgICAgICAgICBGbG9hdGluZ01lc3NhZ2UgRk0gPSBuZXcgRmxvYXRpbmdNZXNzYWdlKEdhbWUsIFwiRG9vciBVbmxvY2tlZCFcIik7XHJcbiAgICAgICAgICAgIEZNLlRleHQuVGV4dENvbG9yID0gXCIjNzdGRkZGXCI7XHJcbiAgICAgICAgICAgIEZNLlBvc2l0aW9uID0gbmV3IFZlY3RvcjIoeCArIDgsIHkgLSAyMCk7XHJcbiAgICAgICAgICAgIEdhbWUuQWRkRW50aXR5KEZNKTtcclxuICAgICAgICB9XHJcbiAgICAgICAgcHVibGljIG92ZXJyaWRlIHZvaWQgVXBkYXRlKClcclxuICAgICAgICB7XHJcbiAgICAgICAgICAgIGJhc2UuVXBkYXRlKCk7XHJcbiAgICAgICAgICAgIGlmICh5IDw9IDApXHJcbiAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgIEdhbWUuTGV2ZWxSZXN0YXJ0KCk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcbiAgICB9XHJcbn1cclxuIiwidXNpbmcgU3lzdGVtO1xyXG51c2luZyBTeXN0ZW0uQ29sbGVjdGlvbnMuR2VuZXJpYztcclxudXNpbmcgU3lzdGVtLkxpbnE7XHJcbnVzaW5nIFN5c3RlbS5UZXh0O1xyXG51c2luZyBTeXN0ZW0uVGhyZWFkaW5nLlRhc2tzO1xyXG51c2luZyBCcmlkZ2U7XHJcbnVzaW5nIEJyaWRnZS5IdG1sNTtcclxuXHJcbm5hbWVzcGFjZSBDaXJub0dhbWVcclxue1xyXG4gICAgcHVibGljIGNsYXNzIEdhbWUgOiBHYW1lU3ByaXRlXHJcbiAgICB7XHJcbiAgICAgICAgcHVibGljIFBsYXllckNoYXJhY3RlciBwbGF5ZXI7XHJcbiAgICAgICAgcHVibGljIExpc3Q8RW50aXR5PiBlbnRpdGllcztcclxuICAgICAgICBwdWJsaWMgTGlzdDxFbnRpdHk+IGhhcm1mdWw7XHJcbiAgICAgICAgcHVibGljIExpc3Q8RW50aXR5PiBjb21iYXRhbnRzO1xyXG4gICAgICAgIHB1YmxpYyBDYW1lcmEgY2FtZXJhO1xyXG4gICAgICAgIHB1YmxpYyBSZWN0YW5nbGUgc3RhZ2VCb3VuZHM7XHJcbiAgICAgICAgcHVibGljIFRpbGVNYXAgVE07XHJcbiAgICAgICAgcHVibGljIEdhbWVQbGF5U2V0dGluZ3MgR2FtZVBsYXlTZXR0aW5ncztcclxuXHJcbiAgICAgICAgcHVibGljIFRleHRTcHJpdGUgVGltZXJTcHJpdGU7XHJcblxyXG4gICAgICAgIHB1YmxpYyBmbG9hdCBkZWZhdWx0VGltZVJlbWFpbmluZyA9IDEwMDAgKiA2MCAqIDM7Ly8zIG1pbnV0ZXNcclxuICAgICAgICAvL3B1YmxpYyBmbG9hdCBtYXhUaW1lUmVtYWluaW5nID0gMTAwMCAqIDYwICogNTsvLzMgbWludXRlc1xyXG4gICAgICAgIHB1YmxpYyBmbG9hdCBsYXN0U3RhbmQgPSAxMDAwICogMzA7XHJcbiAgICAgICAgcHVibGljIGZsb2F0IGJhc2VMaWZlQ29zdCA9IDEwMDAgKiAxNTtcclxuICAgICAgICBwdWJsaWMgZmxvYXQgdGltZVJlbWFpbmluZztcclxuICAgICAgICBwdWJsaWMgZmxvYXQgdG90YWxUaW1lID0gMDtcclxuICAgICAgICBwdWJsaWMgaW50IGxldmVsID0gMDtcclxuICAgICAgICBwdWJsaWMgYm9vbCBwbGF5aW5nID0gZmFsc2U7XHJcbiAgICAgICAgcHVibGljIGJvb2wgcGF1c2VkID0gZmFsc2U7XHJcbiAgICAgICAgcHVibGljIFZlY3RvcjIgY2FtZXJhV2FuZGVyUG9pbnQ7XHJcbiAgICAgICAgcHVibGljIFRpdGxlU2NyZWVuIFRTO1xyXG4gICAgICAgIHB1YmxpYyBib29sIFRlYW1zID0gdHJ1ZTtcclxuXHJcbiAgICAgICAgcHVibGljIGJvb2wgcnVubmluZ1xyXG4gICAgICAgIHtcclxuICAgICAgICAgICAgZ2V0XHJcbiAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgIHJldHVybiBwbGF5aW5nICYmICFwYXVzZWQ7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcbiAgICAgICAgcHVibGljIGJvb2wgc2tpcHJlbmRlciA9IHRydWU7XHJcblxyXG4gICAgICAgIHB1YmxpYyBUZXh0U3ByaXRlIFNjb3JlU3ByaXRlO1xyXG5cclxuICAgICAgICBwdWJsaWMgQ2FudmFzUmVuZGVyaW5nQ29udGV4dDJEIEVHO1xyXG5cclxuICAgICAgICBwdWJsaWMgRXhpdERvb3IgRG9vcjtcclxuXHJcbiAgICAgICAgcHVibGljIEhUTUxJbWFnZUVsZW1lbnQgS2V5O1xyXG4gICAgICAgIHB1YmxpYyBIVE1MSW1hZ2VFbGVtZW50IEJpZ0tleTtcclxuICAgICAgICBwdWJsaWMgR2FtZSgpXHJcbiAgICAgICAge1xyXG4gICAgICAgICAgICBHYW1lUGxheVNldHRpbmdzID0gbmV3IEdhbWVQbGF5U2V0dGluZ3MoKTtcclxuICAgICAgICAgICAgRG9vciA9IG5ldyBFeGl0RG9vcih0aGlzKTtcclxuICAgICAgICAgICAgZW50aXRpZXMgPSBuZXcgTGlzdDxFbnRpdHk+KCk7XHJcbiAgICAgICAgICAgIGNvbWJhdGFudHMgPSBuZXcgTGlzdDxFbnRpdHk+KCk7XHJcbiAgICAgICAgICAgIGhhcm1mdWwgPSBuZXcgTGlzdDxFbnRpdHk+KCk7XHJcblxyXG4gICAgICAgICAgICBwbGF5ZXIgPSBuZXcgUGxheWVyQ2hhcmFjdGVyKHRoaXMpO1xyXG4gICAgICAgICAgICBwbGF5ZXIuSFAgPSAwO1xyXG4gICAgICAgICAgICB0aW1lUmVtYWluaW5nID0gZGVmYXVsdFRpbWVSZW1haW5pbmc7XHJcbiAgICAgICAgICAgIC8vdGltZVJlbWFpbmluZyAqPSAwLjMzMzRmICogMC4yNWY7XHJcblxyXG4gICAgICAgICAgICAvKnRlc3QuQW5pID0gbmV3IEFuaW1hdGlvbihBbmltYXRpb25Mb2FkZXIuX3RoaXMuR2V0KFwiaW1hZ2VzL2Npcm5vL3dhbGtcIikpO1xyXG4gICAgICAgICAgICB0ZXN0LkFuaS5JbWFnZVNwZWVkID0gMC4xZjsqL1xyXG4gICAgICAgICAgICBcclxuICAgICAgICAgICAgLy9zdGFnZUJvdW5kcyA9IG5ldyBSZWN0YW5nbGUoMCwgMCwgODAwMCwgMzAwMCk7XHJcbiAgICAgICAgICAgIC8vc3RhZ2VCb3VuZHMgPSBuZXcgUmVjdGFuZ2xlKDAsIDAsIDYwMDAsIDQwMDApO1xyXG4gICAgICAgICAgICAvL3N0YWdlQm91bmRzID0gbmV3IFJlY3RhbmdsZSgwLCAwLCAyMDAwLCAxNTAwKTtcclxuICAgICAgICAgICAgLy9zdGFnZUJvdW5kcyA9IG5ldyBSZWN0YW5nbGUoMCwgMCwgMTAwMCwgNzUwKTtcclxuICAgICAgICAgICAgLy9zdGFnZUJvdW5kcyA9IG5ldyBSZWN0YW5nbGUoMCwgMCwgMjAwMCwgMTAwMCk7XHJcbiAgICAgICAgICAgIHN0YWdlQm91bmRzID0gbmV3IFJlY3RhbmdsZSgwLCAwLCA0MDAwLCAyMDAwKTtcclxuICAgICAgICAgICAgVE0gPSBuZXcgVGlsZU1hcCh0aGlzKTtcclxuICAgICAgICAgICAgVE0uU2VlZCA9IChpbnQpKE1hdGguUmFuZG9tKCkgKiA5OTk5OTk5OTk5KTtcclxuICAgICAgICAgICAgLy8vVE0uR2VuZXJhdGUoKTtcclxuICAgICAgICAgICAgVE0ucG9zaXRpb24uWSA9IDA7XHJcbiAgICAgICAgICAgIHZhciBSID0gc3RhZ2VCb3VuZHMgLSBUTS5wb3NpdGlvbjtcclxuICAgICAgICAgICAgUi53aWR0aCAtPSBUTS50aWxlc2l6ZTtcclxuICAgICAgICAgICAgUi5oZWlnaHQgLT0gVE0udGlsZXNpemU7XHJcbiAgICAgICAgICAgIC8vVE0uRHJhd1JlY3QoUik7XHJcblxyXG5cclxuXHJcbiAgICAgICAgICAgIHBsYXllci5Qb3NpdGlvbi5ZID0gc3RhZ2VCb3VuZHMuaGVpZ2h0IC8gMztcclxuICAgICAgICAgICAgcGxheWVyLlBvc2l0aW9uLlggPSBzdGFnZUJvdW5kcy53aWR0aCAvIDI7XHJcblxyXG4gICAgICAgICAgICBFRyA9IEhlbHBlci5HZXRDb250ZXh0KG5ldyBIVE1MQ2FudmFzRWxlbWVudCgpKTtcclxuICAgICAgICAgICAgLy9NYXBHZW5lcmF0b3IuR2VuZXJhdGUodGhpcyk7XHJcbiAgICAgICAgICAgIC8qTWFwR2VuZXJhdG9yLkJveHlHZW5lcmF0ZSh0aGlzKTsgICAgICAgICAgICBcclxuICAgICAgICAgICAgVE0uRHJhd1JlY3QoUik7XHJcbiAgICAgICAgICAgIC8vVE0udGVzdFRleHR1cmUoKTtcclxuICAgICAgICAgICAgVE0uQXBwbHlCcmVha2FibGUoKTsqL1xyXG4gICAgICAgICAgICAvKnZhciBFID0gbmV3IEVudGl0eSh0aGlzKTtcclxuICAgICAgICAgICAgRS5BbmkgPSBuZXcgQW5pbWF0aW9uKEFuaW1hdGlvbkxvYWRlci5HZXQoXCJJbWFnZXMvbGFuZC9icmlja1wiKSk7XHJcbiAgICAgICAgICAgIEUueSArPSAyNDtcclxuICAgICAgICAgICAgZW50aXRpZXMuQWRkKEUpO1xyXG4gICAgICAgICAgICB2YXIgbG4gPSAxMDtcclxuICAgICAgICAgICAgdmFyIGkgPSAwO1xyXG4gICAgICAgICAgICB3aGlsZSAoaSA8IGxuKVxyXG4gICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICBFID0gbmV3IEVudGl0eSh0aGlzKTtcclxuICAgICAgICAgICAgICAgIEUuQW5pID0gbmV3IEFuaW1hdGlvbihBbmltYXRpb25Mb2FkZXIuR2V0KFwiSW1hZ2VzL2xhbmQvYnJpY2tcIikpO1xyXG4gICAgICAgICAgICAgICAgRS55ICs9IDI0O1xyXG4gICAgICAgICAgICAgICAgRS54ICs9IDE2ICogKGkrMSk7XHJcbiAgICAgICAgICAgICAgICBlbnRpdGllcy5BZGQoRSk7XHJcbiAgICAgICAgICAgICAgICBpKys7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgaSA9IDA7XHJcbiAgICAgICAgICAgIHdoaWxlIChpIDwgbG4pXHJcbiAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgIEUgPSBuZXcgRW50aXR5KHRoaXMpO1xyXG4gICAgICAgICAgICAgICAgRS5BbmkgPSBuZXcgQW5pbWF0aW9uKEFuaW1hdGlvbkxvYWRlci5HZXQoXCJJbWFnZXMvbGFuZC9icmlja1wiKSk7XHJcbiAgICAgICAgICAgICAgICBFLnkgKz0gMjQ7XHJcbiAgICAgICAgICAgICAgICBFLnggKz0gMTYgKiAtKGkgKyAxKTtcclxuICAgICAgICAgICAgICAgIGVudGl0aWVzLkFkZChFKTtcclxuICAgICAgICAgICAgICAgIGkrKztcclxuICAgICAgICAgICAgfSovXHJcblxyXG5cclxuICAgICAgICAgICAgLy9lbnRpdGllcy5BZGQodGVzdCk7XHJcbiAgICAgICAgICAgIEFkZEVudGl0eShEb29yKTtcclxuICAgICAgICAgICAgLy8vQWRkRW50aXR5KHBsYXllcik7XHJcblxyXG5cclxuICAgICAgICAgICAgLy9zcHJpdGVCdWZmZXIuV2lkdGggPSAyMDA7XHJcbiAgICAgICAgICAgIHNwcml0ZUJ1ZmZlci5XaWR0aCA9IEFwcC5DYW52YXMuV2lkdGg7XHJcbiAgICAgICAgICAgIHNwcml0ZUJ1ZmZlci5IZWlnaHQgPSAoaW50KShzcHJpdGVCdWZmZXIuV2lkdGggKiBBcHAuVGFyZ2V0QXNwZWN0KTtcclxuICAgICAgICAgICAgLypjYW1lcmEudmlld3BvcnRfd2lkdGggPSBzcHJpdGVCdWZmZXIuV2lkdGg7XHJcbiAgICAgICAgICAgIGNhbWVyYS52aWV3cG9ydF9oZWlnaHQgPSBzcHJpdGVCdWZmZXIuSGVpZ2h0OyovXHJcbiAgICAgICAgICAgIGNhbWVyYSA9IG5ldyBDYW1lcmEoc3ByaXRlQnVmZmVyLldpZHRoLCBzcHJpdGVCdWZmZXIuSGVpZ2h0KTtcclxuICAgICAgICAgICAgLy9jYW1lcmEuU2NhbGUgPSA2O1xyXG4gICAgICAgICAgICAvLy9jYW1lcmEuU2NhbGUgPSA1O1xyXG4gICAgICAgICAgICAvL2NhbWVyYS5TY2FsZSA9IDQ7XHJcbiAgICAgICAgICAgIC8vY2FtZXJhLlNjYWxlID0gMy41ZjtcclxuICAgICAgICAgICAgY2FtZXJhLlNjYWxlID0gMy43NWY7XHJcblxyXG4gICAgICAgICAgICAvL2NhbWVyYS5TY2FsZSA9IDFmO1xyXG4gICAgICAgICAgICBjYW1lcmEuU3RhZ2VCb3VuZHMgPSBzdGFnZUJvdW5kcztcclxuICAgICAgICAgICAgY2FtZXJhLlVwZGF0ZSgpO1xyXG4gICAgICAgICAgICBjYW1lcmEuaW5zdGF3YXJwID0gdHJ1ZTtcclxuICAgICAgICAgICAgLypzcHJpdGVCdWZmZXIuV2lkdGggPSBBcHAuQ2FudmFzLldpZHRoO1xyXG4gICAgICAgICAgICBzcHJpdGVCdWZmZXIuSGVpZ2h0ID0gQXBwLkNhbnZhcy5IZWlnaHQ7Ki9cclxuICAgICAgICAgICAgc3ByaXRlR3JhcGhpY3MuSW1hZ2VTbW9vdGhpbmdFbmFibGVkID0gZmFsc2U7XHJcblxyXG4gICAgICAgICAgICAvKlBsYWNlQW5kQWRkRW50aXR5KG5ldyBEb29yS2V5KHRoaXMpKTtcclxuXHJcbiAgICAgICAgICAgIHZhciBpID0gMDtcclxuICAgICAgICAgICAgLy93aGlsZSAoaSA8IDExMClcclxuICAgICAgICAgICAgd2hpbGUgKGkgPCAyNClcclxuICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgUGxhY2VBbmRBZGRFbnRpdHkobmV3IE1SR2hvc3R5KHRoaXMpKTtcclxuICAgICAgICAgICAgICAgIGkrKztcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBpID0gMDtcclxuICAgICAgICAgICAgd2hpbGUgKGkrKyA8PSA2KVxyXG4gICAgICAgICAgICAgICAgUGxhY2VBbmRBZGRFbnRpdHkobmV3IE9yYih0aGlzKSk7XHJcbiAgICAgICAgICAgIGkgPSAwO1xyXG4gICAgICAgICAgICB3aGlsZSAoaSsrIDw9IDMpXHJcbiAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgIFBsYWNlQW5kQWRkRW50aXR5KG5ldyBDaGVzdCh0aGlzKSk7XHJcbiAgICAgICAgICAgICAgICBQbGFjZUFuZEFkZEVudGl0eShuZXcgS2V5SXRlbSh0aGlzKSk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgaSA9IDA7XHJcbiAgICAgICAgICAgIHdoaWxlIChpKysgPD0gMilcclxuICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgUGxhY2VBbmRBZGRFbnRpdHkobmV3IEhlYWxpbmdJdGVtKHRoaXMpKTtcclxuICAgICAgICAgICAgfSovXHJcbiAgICAgICAgICAgIFN0YXJ0TmV4dExldmVsKCk7XHJcblxyXG5cclxuICAgICAgICAgICAgVGltZXJTcHJpdGUgPSBuZXcgVGV4dFNwcml0ZSgpO1xyXG4gICAgICAgICAgICBUaW1lclNwcml0ZS5Gb250U2l6ZSA9IHNwcml0ZUJ1ZmZlci5IZWlnaHQgLyAyNDtcclxuICAgICAgICAgICAgVGltZXJTcHJpdGUuVGV4dCA9IFwiMzowMFwiO1xyXG4gICAgICAgICAgICBUaW1lclNwcml0ZS5UZXh0Q29sb3IgPSBcIiNGRkZGRkZcIjtcclxuICAgICAgICAgICAgVGltZXJTcHJpdGUuU2hhZG93Q29sb3IgPSBcIiMwMDAwMDBcIjtcclxuICAgICAgICAgICAgVGltZXJTcHJpdGUuU2hhZG93T2Zmc2V0ID0gbmV3IFZlY3RvcjIoMywgMyk7XHJcbiAgICAgICAgICAgIFRpbWVyU3ByaXRlLlNoYWRvd0JsdXIgPSAxO1xyXG5cclxuICAgICAgICAgICAgVGltZXJTcHJpdGUuUG9zaXRpb24uWCA9IHNwcml0ZUJ1ZmZlci5XaWR0aCAqIDAuNDdmO1xyXG4gICAgICAgICAgICBUaW1lclNwcml0ZS5Qb3NpdGlvbi5ZID0gLVRpbWVyU3ByaXRlLkZvbnRTaXplIC8gODtcclxuXHJcbiAgICAgICAgICAgIFNjb3JlU3ByaXRlID0gbmV3IFRleHRTcHJpdGUoKTtcclxuICAgICAgICAgICAgLy9TY29yZVNwcml0ZS5Gb250U2l6ZSA9IHNwcml0ZUJ1ZmZlci5IZWlnaHQgLyAyNDtcclxuICAgICAgICAgICAgU2NvcmVTcHJpdGUuRm9udFNpemUgPSBzcHJpdGVCdWZmZXIuSGVpZ2h0IC8gMjg7XHJcbiAgICAgICAgICAgIFNjb3JlU3ByaXRlLlRleHQgPSBcIkxldmVsOjEgU2NvcmU6MFwiO1xyXG4gICAgICAgICAgICBTY29yZVNwcml0ZS5UZXh0Q29sb3IgPSBcIiNGRkZGRkZcIjtcclxuICAgICAgICAgICAgU2NvcmVTcHJpdGUuU2hhZG93Q29sb3IgPSBcIiMwMDAwMDBcIjtcclxuICAgICAgICAgICAgU2NvcmVTcHJpdGUuU2hhZG93T2Zmc2V0ID0gbmV3IFZlY3RvcjIoMywgMyk7XHJcbiAgICAgICAgICAgIFNjb3JlU3ByaXRlLlNoYWRvd0JsdXIgPSAxO1xyXG5cclxuICAgICAgICAgICAgLy9TY29yZVNwcml0ZS5Qb3NpdGlvbi5YID0gc3ByaXRlQnVmZmVyLldpZHRoICogMC43ZjtcclxuICAgICAgICAgICAgU2NvcmVTcHJpdGUuRm9yY2VVcGRhdGUoKTtcclxuICAgICAgICAgICAgU2NvcmVTcHJpdGUuUG9zaXRpb24uWCA9IChzcHJpdGVCdWZmZXIuV2lkdGggKiAwLjk4ZikgLSBTY29yZVNwcml0ZS5zcHJpdGVCdWZmZXIuV2lkdGg7XHJcbiAgICAgICAgICAgIFNjb3JlU3ByaXRlLlBvc2l0aW9uLlkgPSAtU2NvcmVTcHJpdGUuRm9udFNpemUgLyA4O1xyXG5cclxuICAgICAgICAgICAgS2V5ID0gQW5pbWF0aW9uTG9hZGVyLkdldChcImltYWdlcy9pdGVtcy9rZXlcIilbMF07XHJcbiAgICAgICAgICAgIEJpZ0tleSA9IEFuaW1hdGlvbkxvYWRlci5HZXQoXCJpbWFnZXMvaXRlbXMvYmlna2V5XCIpWzBdO1xyXG5cclxuICAgICAgICAgICAgVFMgPSBuZXcgVGl0bGVTY3JlZW4oKTtcclxuICAgICAgICAgICAgVFMuZ2FtZSA9IHRoaXM7XHJcblxyXG4gICAgICAgICAgICAvL1BsYXlNdXNpYyhcInRoZW1lMlwiKTtcclxuICAgICAgICAgICAgU2V0TXVzaWMoKTtcclxuICAgICAgICB9XHJcbiAgICAgICAgcHVibGljIHZvaWQgQ2xlYXJFbnRpdGllcygpXHJcbiAgICAgICAge1xyXG4gICAgICAgICAgICB2YXIgTCA9IGVudGl0aWVzLlRvQXJyYXkoKTtcclxuICAgICAgICAgICAgdmFyIGkgPSAwO1xyXG4gICAgICAgICAgICB3aGlsZSAoaSA8IEwuTGVuZ3RoKVxyXG4gICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICB2YXIgRSA9IExbaV07XHJcbiAgICAgICAgICAgICAgICAvL2lmICghKEUgPT0gcGxheWVyIHx8IEUgaXMgRXhpdERvb3IpKVxyXG4gICAgICAgICAgICAgICAgaWYgKEUuUmVtb3ZlZE9uTGV2ZWxFbmQpXHJcbiAgICAgICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICAgICAgRS5BbGl2ZSA9IGZhbHNlO1xyXG4gICAgICAgICAgICAgICAgICAgIFJlbW92ZUVudGl0eShFKTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIGkrKztcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuICAgICAgICBwdWJsaWMgdm9pZCBTdGFydE5leHRMZXZlbCgpXHJcbiAgICAgICAge1xyXG4gICAgICAgICAgICBDbGVhckVudGl0aWVzKCk7XHJcbiAgICAgICAgICAgIFJvb21PcGVuaW5nTGV2ZXIuVEVTVCA9IG51bGw7XHJcbiAgICAgICAgICAgIGxldmVsICs9IDE7XHJcbiAgICAgICAgICAgIHZhciBSID0gc3RhZ2VCb3VuZHMgLSBUTS5wb3NpdGlvbjtcclxuICAgICAgICAgICAgUi53aWR0aCAtPSBUTS50aWxlc2l6ZTtcclxuICAgICAgICAgICAgUi5oZWlnaHQgLT0gVE0udGlsZXNpemU7XHJcbiAgICAgICAgICAgIFRNLkdlbmVyYXRlKCk7XHJcbiAgICAgICAgICAgIE1hcEdlbmVyYXRvci5Cb3h5R2VuZXJhdGUodGhpcyk7XHJcbiAgICAgICAgICAgIC8vVE0uRHJhd1JlY3QoUik7XHJcbiAgICAgICAgICAgIC8vVE0uQXBwbHlCcmVha2FibGUoKTtcclxuXHJcblxyXG4gICAgICAgICAgICAvL3ZhciBnaG9zdHMgPSAoaW50KShNYXRoLk1pbigxOCArIGxldmVsICogMiwgMjgpICogMC44NSk7XHJcbiAgICAgICAgICAgIHZhciBnaG9zdHMgPSAoaW50KShNYXRoLk1pbigxOCArIGxldmVsICogMiwgMjgpICogMS4wKTtcclxuICAgICAgICAgICAgdmFyIGkgPSAwO1xyXG4gICAgICAgICAgICAvL3doaWxlIChpIDwgMTEwKVxyXG4gICAgICAgICAgICB3aGlsZSAoaSA8IGdob3N0cylcclxuICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgLy9pZiAoTWF0aC5SYW5kb20oKSA8IDAuNjcpXHJcbiAgICAgICAgICAgICAgICBpZiAoTWF0aC5SYW5kb20oKSA8IDAuNSlcclxuICAgICAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgICAgICBQbGFjZUFuZEFkZEVuZW15KG5ldyBNUkdob3N0eSh0aGlzKSk7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICBlbHNlXHJcbiAgICAgICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICAgICAgdmFyIHNwaWtlID0gTWF0aC5SYW5kb20oKSA8IDAuMjU7XHJcbiAgICAgICAgICAgICAgICAgICAgdmFyIFQgPSBuZXcgVHVycmV0KHRoaXMpO1xyXG4gICAgICAgICAgICAgICAgICAgIFBsYWNlQW5kQWRkRW5lbXkoVCk7XHJcbiAgICAgICAgICAgICAgICAgICAgVC5TZXREb3duKHNwaWtlKTtcclxuICAgICAgICAgICAgICAgICAgICBpZiAoc3Bpa2UpXHJcbiAgICAgICAgICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB2YXIgVEQgPSBULlRURDtcclxuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKFREICE9IG51bGwgJiYgVE0ucm93cz5URC5yb3crMSlcclxuICAgICAgICAgICAgICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFyIFRERCA9IFRNLmRhdGFbVEQuY29sdW1uLCBURC5yb3cgKyAxXTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChUREQuZW5hYmxlZCAmJiBUREQuc29saWQpXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgVC5BbGl2ZSA9IGZhbHNlO1xyXG5cclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBURC50ZXh0dXJlID0gNztcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBURC5CcmVha2FibGUgPSBmYWxzZTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBURC5DYW5TbG9wZSA9IGZhbHNlO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIFRELm9wYXF1ZSA9IGZhbHNlO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIFRELlN0ZXBwZWRPbiA9IEUgPT5cclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhciBJQyA9IEUuQXM8UGxheWVyQ2hhcmFjdGVyPigpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoSUMuYmxvY2twcmljZSA+IDAgJiYgSUMuaW52aW5jaWJpbGl0eXRpbWUgPD0gMClcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgSUMub25EYW1hZ2VkKG51bGwsIDEuNWYrKGxldmVsKjEuNWYpKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIElDLlBsYXlTb3VuZChcImRhbWFnZWRcIik7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoSUMuSFAgPD0gMClcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBJQy5vbkRlYXRoKG51bGwpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIGkrKztcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBpID0gMDtcclxuICAgICAgICAgICAgLy93aGlsZSAoaSsrIDw9IDYpXHJcbiAgICAgICAgICAgIHdoaWxlIChpKysgPD0gNClcclxuICAgICAgICAgICAgICAgIFBsYWNlQW5kQWRkRW50aXR5KG5ldyBPcmIodGhpcykpO1xyXG4gICAgICAgICAgICBpID0gMDtcclxuICAgICAgICAgICAgd2hpbGUgKGkrKyA8PSAzKVxyXG4gICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICBQbGFjZUFuZEFkZEVudGl0eShuZXcgQ2hlc3QodGhpcykpO1xyXG4gICAgICAgICAgICAgICAgUGxhY2VBbmRBZGRFbnRpdHkobmV3IEtleUl0ZW0odGhpcykpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIGkgPSAwO1xyXG4gICAgICAgICAgICB3aGlsZSAoaSsrIDw9IDEpXHJcbiAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgIFBsYWNlQW5kQWRkRW50aXR5KG5ldyBIZWFsaW5nSXRlbSh0aGlzKSk7XHJcbiAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgIHZhciBrZXkgPSBuZXcgQ2lybm9HYW1lLkRvb3JLZXkodGhpcyk7XHJcbiAgICAgICAgICAgIHZhciBhdHRlbXB0cyA9IDA7XHJcblxyXG4gICAgICAgICAgICB0aGlzLlBsYWNlQW5kQWRkRW50aXR5KGtleSk7XHJcbiAgICAgICAgICAgIHdoaWxlIChNYXRoLkFicyhrZXkueCAtIHBsYXllci54KSA8IDcwICYmIGF0dGVtcHRzIDwgNSlcclxuICAgICAgICAgICAgey8vYXR0ZW1wdCB0byBwcmV2ZW50IGtleSBmcm9tIHNwYXduaW5nIHRvbyBjbG9zZVxyXG4gICAgICAgICAgICAgICAgSGVscGVyLkxvZyhcIkRvb3Iga2V5IGlzIHRvbyBjbG9zZSwgcmVwb3NpdGlvbmluZyBrZXkuLi5cIik7XHJcblxyXG4gICAgICAgICAgICAgICBrZXkuUG9zaXRpb24uQ29weUZyb20oTWFwUm9vbS5GaW5kQW55RW1wdHlTcG90KCkpO1xyXG4gICAgICAgICAgICAgICAgYXR0ZW1wdHMgKz0gMTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBNYXBHZW5lcmF0b3Iua2V5cm9vbSA9IE1hcFJvb20uRmluZFJvb20oa2V5LlBvc2l0aW9uKTtcclxuICAgICAgICAgICAgLy8vUGxhY2VBbmRBZGRFbnRpdHkobmV3IERvb3JLZXkodGhpcykpO1xyXG4gICAgICAgICAgICAvKlBsYWNlQW5kQWRkRW50aXR5KG5ldyBEb29yS2V5KHRoaXMpKTtcclxuICAgICAgICAgICAgUGxhY2VBbmRBZGRFbnRpdHkobmV3IERvb3JLZXkodGhpcykpO1xyXG4gICAgICAgICAgICBQbGFjZUFuZEFkZEVudGl0eShuZXcgRG9vcktleSh0aGlzKSk7XHJcbiAgICAgICAgICAgIFBsYWNlQW5kQWRkRW50aXR5KG5ldyBEb29yS2V5KHRoaXMpKTsqL1xyXG5cclxuICAgICAgICAgICAgcGxheWVyLmludmluY2liaWxpdHl0aW1lID0gMTgwO1xyXG4gICAgICAgICAgICBjYW1lcmEuaW5zdGF3YXJwID0gdHJ1ZTtcclxuICAgICAgICAgICAgc2tpcHJlbmRlciA9IHRydWU7XHJcbiAgICAgICAgICAgIGlmIChwbGF5aW5nKVxyXG4gICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICBTZXRNdXNpYygpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHB1YmxpYyB2b2lkIFNldE11c2ljKClcclxuICAgICAgICB7XHJcbiAgICAgICAgICAgIGlmICghcGxheWluZylcclxuICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgUGxheU11c2ljKFwidGhlbWUzXCIpO1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIHZhciBzb25ncyA9IDM7XHJcbiAgICAgICAgICAgIHZhciBsZXZlbHNwZXJzb25nID0gNTtcclxuICAgICAgICAgICAgdmFyIFMgPSAoaW50KShsZXZlbCAvIGxldmVsc3BlcnNvbmcpO1xyXG4gICAgICAgICAgICBTID0gUyAlIHNvbmdzO1xyXG4gICAgICAgICAgICBQbGF5TXVzaWMoXCJ0aGVtZVwiICsgKFMgKyAxKSk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHB1YmxpYyB2b2lkIFBsYWNlQW5kQWRkRW50aXR5KEVudGl0eSBFKVxyXG4gICAgICAgIHtcclxuICAgICAgICAgICAgRS5Qb3NpdGlvbi5Db3B5RnJvbShNYXBSb29tLkZpbmRBbnlFbXB0eVNwb3QoKSk7XHJcbiAgICAgICAgICAgIEFkZEVudGl0eShFKTtcclxuICAgICAgICB9XHJcbiAgICAgICAgcHVibGljIHZvaWQgUGxhY2VBbmRBZGRFbmVteShFbnRpdHkgRSlcclxuICAgICAgICB7XHJcbiAgICAgICAgICAgIEUuUG9zaXRpb24uQ29weUZyb20oTWFwUm9vbS5GaW5kQW55RW1wdHlTcG90KCkpO1xyXG4gICAgICAgICAgICB2YXIgYXR0ZW1wdHMgPSAxO1xyXG4gICAgICAgICAgICB3aGlsZSAoRS5Qb3NpdGlvbi5Fc3RpbWF0ZWREaXN0YW5jZSh0aGlzLnBsYXllci5Qb3NpdGlvbikgPCAxMjggJiYgYXR0ZW1wdHMgPCA1KVxyXG4gICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICBIZWxwZXIuTG9nKFwiRW5lbXkgc3Bhd25lZCB0b28gY2xvc2UsIHJlcG9zaXRpb25pbmcgZW5lbXkuLi5cIik7XHJcblxyXG4gICAgICAgICAgICAgICAgIEUuUG9zaXRpb24uQ29weUZyb20oTWFwUm9vbS5GaW5kQW55RW1wdHlTcG90KCkpO1xyXG4gICAgICAgICAgICAgICAgYXR0ZW1wdHMgKz0gMTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB0aGlzLkFkZEVudGl0eShFKTtcclxuICAgICAgICAgICAgQWRkRW50aXR5KEUpO1xyXG4gICAgICAgIH1cclxuICAgICAgICBwdWJsaWMgc3RhdGljIHN0cmluZyBHZXRUZWFtQ29sb3IoaW50IHRlYW0pXHJcbiAgICAgICAge1xyXG4gICAgICAgICAgICBpZiAodGVhbSA9PSAxKVxyXG4gICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gXCIjRkYwMDAwXCI7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgZWxzZSBpZiAodGVhbSA9PSAyIHx8IHRlYW0gPT0gMClcclxuICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuIFwiIzAwMDBGRlwiO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIGVsc2UgaWYgKHRlYW0gPT0gMylcclxuICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuIFwiI0ZGRkYwMFwiO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIHJldHVybiBcIiMwMDAwMDBcIjtcclxuICAgICAgICB9XHJcbiAgICAgICAgcHVibGljIGJvb2wgbXV0ZWQgPSBmYWxzZTtcclxuICAgICAgICBib29sIGxhc3RQYXVzZUJ1dHRvblN0YXRlID0gZmFsc2U7XHJcbiAgICAgICAgcHVibGljIG92ZXJyaWRlIHZvaWQgVXBkYXRlKClcclxuICAgICAgICB7XHJcbiAgICAgICAgICAgIGJhc2UuVXBkYXRlKCk7XHJcbiAgICAgICAgICAgIFRlYW1zID0gR2FtZVBsYXlTZXR0aW5ncy5HYW1lTW9kZS5UZWFtcztcclxuICAgICAgICAgICAgLy9pZiAocGxheWluZyAmJiBLZXlib2FyZE1hbmFnZXIuX3RoaXMuVGFwcGVkQnV0dG9ucy5Db250YWlucygxMykpXHJcbiAgICAgICAgICAgIGlmIChwbGF5aW5nICYmIEFwcC5JQy5nZXRQcmVzc2VkKDUpICYmICFsYXN0UGF1c2VCdXR0b25TdGF0ZSlcclxuICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgcGF1c2VkID0gIXBhdXNlZDtcclxuICAgICAgICAgICAgICAgIC8vL0tleWJvYXJkTWFuYWdlci5fdGhpcy5UYXBwZWRCdXR0b25zLlJlbW92ZSgxMyk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgbGFzdFBhdXNlQnV0dG9uU3RhdGUgPSBBcHAuSUMuZ2V0UHJlc3NlZCg1KTtcclxuICAgICAgICAgICAgaWYgKHBsYXlpbmcgJiYgS2V5Ym9hcmRNYW5hZ2VyLl90aGlzLlRhcHBlZEJ1dHRvbnMuQ29udGFpbnMoNzcpKVxyXG4gICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICBBdWRpb01hbmFnZXIuX3RoaXMuU3RvcEFsbCgpO1xyXG4gICAgICAgICAgICAgICAgbXV0ZWQgPSAhbXV0ZWQ7XHJcbiAgICAgICAgICAgICAgICBpZiAoIW11dGVkKVxyXG4gICAgICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgICAgIFNldE11c2ljKCk7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICBLZXlib2FyZE1hbmFnZXIuX3RoaXMuVGFwcGVkQnV0dG9ucy5SZW1vdmUoNzcpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIGlmICghcGF1c2VkKVxyXG4gICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICBVcGRhdGVDb250cm9scygpO1xyXG5cclxuICAgICAgICAgICAgICAgIHZhciBpID0gMDtcclxuICAgICAgICAgICAgICAgIHdoaWxlIChpIDwgZW50aXRpZXMuQ291bnQpXHJcbiAgICAgICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICAgICAgdmFyIEUgPSBlbnRpdGllc1tpXTtcclxuICAgICAgICAgICAgICAgICAgICBpZiAoRS5BbGl2ZSlcclxuICAgICAgICAgICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIEUuVXBkYXRlKCk7XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgIGlmICghRS5BbGl2ZSlcclxuICAgICAgICAgICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIFJlbW92ZUVudGl0eShFKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgaS0tO1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICBpKys7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICBVcGRhdGVDb2xsaXNpb25zKCk7XHJcbiAgICAgICAgICAgICAgICBVcGRhdGVUaW1lKCk7XHJcbiAgICAgICAgICAgICAgICBpZiAocGxheWluZyAmJiBwbGF5ZXIueSA8IDApXHJcbiAgICAgICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICAgICAgLy9wbGF5ZXIgZ2xpdGNoZWQgb3V0IHNvbWVob3cgbWFrZSBhIG5ldyBsZXZlbC5cclxuICAgICAgICAgICAgICAgICAgICBMZXZlbFJlc3RhcnQoKTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBlbHNlXHJcbiAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgIFRpbWVyU3ByaXRlLlRleHQgPSBcIlBhdXNlZFwiO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHB1YmxpYyB2b2lkIExldmVsUmVzdGFydCgpXHJcbiAgICAgICAge1xyXG4gICAgICAgICAgICBsZXZlbC0tO1xyXG4gICAgICAgICAgICBTdGFydE5leHRMZXZlbCgpO1xyXG4gICAgICAgIH1cclxuICAgICAgICBwdWJsaWMgdm9pZCBEb0dhbWVPdmVyKClcclxuICAgICAgICB7XHJcbiAgICAgICAgICAgIGlmICghcGxheWluZylcclxuICAgICAgICAgICAgICAgIHJldHVybjtcclxuICAgICAgICAgICAgaWYgKGVudGl0aWVzLkNvbnRhaW5zKHBsYXllcikpXHJcbiAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgIFJlbW92ZUVudGl0eShwbGF5ZXIpO1xyXG4gICAgICAgICAgICAgICAgLy9Eb0dhbWVPdmVyKCk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgcGxheWluZyA9IGZhbHNlO1xyXG4gICAgICAgICAgICBTdGFydE5leHRMZXZlbCgpO1xyXG5cclxuICAgICAgICB9XHJcbiAgICAgICAgcHVibGljIHZvaWQgVXBkYXRlVGltZSgpXHJcbiAgICAgICAge1xyXG4gICAgICAgICAgICAvL3RpbWVSZW1haW5pbmcgLT0gMTYuNjY2NjdmO1xyXG4gICAgICAgICAgICBpZiAocGF1c2VkKVxyXG4gICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICBUaW1lclNwcml0ZS5UZXh0ID0gXCJQYXVzZWRcIjtcclxuICAgICAgICAgICAgICAgIHJldHVybjtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBpZiAodGltZVJlbWFpbmluZyA8PSAwKVxyXG4gICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICB0aW1lUmVtYWluaW5nID0gMDtcclxuICAgICAgICAgICAgICAgIFRpbWVyU3ByaXRlLlRleHQgPSBcIjBcIjtcclxuICAgICAgICAgICAgICAgIFRpbWVyU3ByaXRlLlRleHRDb2xvciA9IFwiI0ZGMDAwMFwiO1xyXG4gICAgICAgICAgICAgICAgaWYgKHBsYXllci5IUCA+IDApXHJcbiAgICAgICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICAgICAgcGxheWVyLkhQIC09IDAuMDA2ZjtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIGVsc2VcclxuICAgICAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgICAgICBEb0dhbWVPdmVyKCk7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICByZXR1cm47XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgZWxzZSBpZiAodGltZVJlbWFpbmluZyA8IGJhc2VMaWZlQ29zdClcclxuICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgVGltZXJTcHJpdGUuVGV4dENvbG9yID0gXCIjRkYwMDAwXCI7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgZWxzZSBpZiAodGltZVJlbWFpbmluZyA8IGxhc3RTdGFuZClcclxuICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgVGltZXJTcHJpdGUuVGV4dENvbG9yID0gXCIjRkZGRjAwXCI7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgZWxzZVxyXG4gICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICBUaW1lclNwcml0ZS5UZXh0Q29sb3IgPSBcIiNGRkZGRkZcIjtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB2YXIgdG90YWxzZWNvbmRzID0gdGltZVJlbWFpbmluZyAvIDEwMDBmO1xyXG4gICAgICAgICAgICB2YXIgdG90YWxtaW51dGVzID0gdG90YWxzZWNvbmRzIC8gNjA7XHJcblxyXG4gICAgICAgICAgICB2YXIgbWludXRlcyA9IChpbnQpTWF0aC5GbG9vcih0b3RhbG1pbnV0ZXMpO1xyXG4gICAgICAgICAgICB2YXIgc2Vjb25kcyA9ICh0b3RhbHNlY29uZHMgLSAobWludXRlcyAqIDYwKSk7XHJcblxyXG4gICAgICAgICAgICB2YXIgUyA9IFwiXCI7XHJcbiAgICAgICAgICAgIGlmIChtaW51dGVzID4gMClcclxuICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgUyA9IFwiXCIgKyBtaW51dGVzICsgXCI6XCI7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgdmFyIHByZWZpeCA9IFwiXCI7XHJcbiAgICAgICAgICAgIGlmIChzZWNvbmRzIDwgMTApXHJcbiAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgIHByZWZpeCA9IFwiMFwiO1xyXG4gICAgICAgICAgICAgICAgaWYgKHRvdGFsc2Vjb25kcyA8IDEwKVxyXG4gICAgICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgICAgIHByZWZpeCA9IFwiIFwiO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIFMgPSBTICsgUmVzdHJpY3RMZW5ndGgocHJlZml4ICsgTWF0aC5NYXgoMCwgc2Vjb25kcyksIDQpO1xyXG4gICAgICAgICAgICBpZiAodG90YWxzZWNvbmRzID49IDYwKVxyXG4gICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICBpZiAoUy5JbmRleE9mKFwiLlwiKSA+PSAwKVxyXG4gICAgICAgICAgICAgICAgICAgIFMgPSBTLlNwbGl0KFwiLlwiKVswXTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBUaW1lclNwcml0ZS5UZXh0ID0gUztcclxuICAgICAgICB9XHJcbiAgICAgICAgcHVibGljIHN0cmluZyBSZXN0cmljdExlbmd0aChzdHJpbmcgcywgaW50IGxlbmd0aClcclxuICAgICAgICB7XHJcbiAgICAgICAgICAgIGlmIChzLkxlbmd0aCA+IGxlbmd0aClcclxuICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuIHMuU3Vic3RyKDAsIGxlbmd0aCk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgcmV0dXJuIHM7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHB1YmxpYyB2b2lkIFVwZGF0ZUNvbGxpc2lvbnMoKVxyXG4gICAgICAgIHtcclxuICAgICAgICAgICAgLy9MaXN0PEVudGl0eT4gY29tYmF0YW50cyA9IG5ldyBMaXN0PEVudGl0eT4oU3lzdGVtLkxpbnEuRW51bWVyYWJsZS5XaGVyZTxnbG9iYWw6OkNpcm5vR2FtZS5FbnRpdHk+KGVudGl0aWVzLCAoZ2xvYmFsOjpTeXN0ZW0uRnVuYzxnbG9iYWw6OkNpcm5vR2FtZS5FbnRpdHksIGJvb2w+KShlbnRpdHkgPT4gZW50aXR5IGlzIElDb21iYXRhbnQgJiYgZW50aXR5LkFuaS5DdXJyZW50SW1hZ2UgIT0gbnVsbCAmJiAoKElDb21iYXRhbnQpZW50aXR5KS5IUCA+IDApKSk7XHJcbiAgICAgICAgICAgIC8vTGlzdDxFbnRpdHk+IGhhcm1mdWxFbnRpdHkgPSBuZXcgTGlzdDxFbnRpdHk+KFN5c3RlbS5MaW5xLkVudW1lcmFibGUuV2hlcmU8Z2xvYmFsOjpDaXJub0dhbWUuRW50aXR5PihlbnRpdGllcywgKGdsb2JhbDo6U3lzdGVtLkZ1bmM8Z2xvYmFsOjpDaXJub0dhbWUuRW50aXR5LCBib29sPikoZW50aXR5ID0+IGVudGl0eSBpcyBJSGFybWZ1bEVudGl0eSAmJiBlbnRpdHkuQW5pLkN1cnJlbnRJbWFnZSAhPSBudWxsKSkpO1xyXG4gICAgICAgICAgICAvLy9MaXN0PEVudGl0eT4gY29tYmF0YW50cyA9IG5ldyBMaXN0PEVudGl0eT4oZW50aXRpZXMuV2hlcmUoZW50aXR5ID0+IGVudGl0eSBpcyBJQ29tYmF0YW50ICYmIGVudGl0eS5BbmkuQ3VycmVudEltYWdlICE9IG51bGwgJiYgKChJQ29tYmF0YW50KWVudGl0eSkuSFAgPiAwKSk7XHJcbiAgICAgICAgICAgIC8vL0xpc3Q8RW50aXR5PiBoYXJtZnVsRW50aXR5ID0gbmV3IExpc3Q8RW50aXR5PihlbnRpdGllcy5XaGVyZShlbnRpdHkgPT4gZW50aXR5IGlzIElIYXJtZnVsRW50aXR5ICYmIGVudGl0eS5BbmkuQ3VycmVudEltYWdlICE9IG51bGwpKTtcclxuICAgICAgICAgICAgTGlzdDxFbnRpdHk+IGNvbWJhdGFudHMgPSBuZXcgTGlzdDxFbnRpdHk+KFN5c3RlbS5MaW5xLkVudW1lcmFibGUuV2hlcmU8Z2xvYmFsOjpDaXJub0dhbWUuRW50aXR5Pih0aGlzLmNvbWJhdGFudHMsKGdsb2JhbDo6U3lzdGVtLkZ1bmM8Z2xvYmFsOjpDaXJub0dhbWUuRW50aXR5LCBib29sPikoZW50aXR5ID0+IGVudGl0eS5BbmkuQ3VycmVudEltYWdlICE9IG51bGwgJiYgKGVudGl0eS5BczxJQ29tYmF0YW50PigpKS5IUCA+IDApKSk7XHJcbiAgICAgICAgICAgIExpc3Q8RW50aXR5PiBoYXJtZnVsRW50aXR5ID0gbmV3IExpc3Q8RW50aXR5PihTeXN0ZW0uTGlucS5FbnVtZXJhYmxlLldoZXJlPGdsb2JhbDo6Q2lybm9HYW1lLkVudGl0eT4oaGFybWZ1bCwoZ2xvYmFsOjpTeXN0ZW0uRnVuYzxnbG9iYWw6OkNpcm5vR2FtZS5FbnRpdHksIGJvb2w+KShlbnRpdHkgPT4gZW50aXR5LkFuaS5DdXJyZW50SW1hZ2UgIT0gbnVsbCkpKTtcclxuICAgICAgICAgICAgdmFyIFIyID0gbmV3IFJlY3RhbmdsZSgpO1xyXG4gICAgICAgICAgICB2YXIgT1IyID0gbmV3IFJlY3RhbmdsZSgpO1xyXG4gICAgICAgICAgICBpbnQgaSA9IDA7XHJcbiAgICAgICAgICAgIHZhciBjb3VudCA9IGNvbWJhdGFudHMuQ291bnQ7XHJcbiAgICAgICAgICAgIFZlY3RvcjIgc3BkID0gbmV3IFZlY3RvcjIoKTtcclxuICAgICAgICAgICAgVmVjdG9yMiBzcGQyID0gbmV3IFZlY3RvcjIoKTtcclxuICAgICAgICAgICAgd2hpbGUgKGkgPCBjb3VudClcclxuICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgRW50aXR5IEUgPSBjb21iYXRhbnRzW2ldO1xyXG4gICAgICAgICAgICAgICAgLy9pZiAoRSBpcyBJQ29tYmF0YW50KVxyXG4gICAgICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgICAgIElDb21iYXRhbnQgRUkgPSAoSUNvbWJhdGFudClFLkFzPElDb21iYXRhbnQ+KCk7XHJcbiAgICAgICAgICAgICAgICAgICAgUmVjdGFuZ2xlIFIgPSBFLkdldEhpdGJveCgpO1xyXG4gICAgICAgICAgICAgICAgICAgIHNwZC5Db3B5RnJvbShFLlNwZWVkKTtcclxuICAgICAgICAgICAgICAgICAgICBzcGQuTXVsdGlwbHkoMC41Zik7XHJcbiAgICAgICAgICAgICAgICAgICAgLy9WZWN0b3IyIHNwZCA9IEUuU3BlZWQgKiAwLjVmO1xyXG4gICAgICAgICAgICAgICAgICAgIC8vc3BkLkNvcHlGcm9tKClcclxuICAgICAgICAgICAgICAgICAgICAvL1JlY3RhbmdsZSBSMiA9IG5ldyBSZWN0YW5nbGUoUi54IC0gKHNwZC5YKSwgUi55IC0gKHNwZC5ZKSwgUi53aWR0aCwgUi5oZWlnaHQpO1xyXG4gICAgICAgICAgICAgICAgICAgIFIyLlNldChSLnggLSAoc3BkLlgpLCBSLnkgLSAoc3BkLlkpLCBSLndpZHRoLCBSLmhlaWdodCk7XHJcbiAgICAgICAgICAgICAgICAgICAgLy9MaXN0PEVudGl0eT4gTCA9IG5ldyBMaXN0PEVudGl0eT4oaGFybWZ1bEVudGl0eS5XaGVyZShlbnRpdHkgPT4gZW50aXR5ICE9IEUgJiYgZW50aXR5LkdldEhpdGJveCgpLmlzVG91Y2hpbmcoUikpKTtcclxuICAgICAgICAgICAgICAgICAgICAvL0xpc3Q8RW50aXR5PiBMID0gbmV3IExpc3Q8RW50aXR5PihoYXJtZnVsRW50aXR5LldoZXJlKGVudGl0eSA9PiBlbnRpdHkgIT0gRSAmJiAoKElDb21iYXRhbnQpKChJSGFybWZ1bEVudGl0eSllbnRpdHkpLkF0dGFja2VyKS5UZWFtICE9IEVJLlRlYW0pKTtcclxuICAgICAgICAgICAgICAgICAgICAvL0xpc3Q8RW50aXR5PiBMID0gbmV3IExpc3Q8RW50aXR5PihTeXN0ZW0uTGlucS5FbnVtZXJhYmxlLldoZXJlPGdsb2JhbDo6Q2lybm9HYW1lLkVudGl0eT4oaGFybWZ1bEVudGl0eSwgKGdsb2JhbDo6U3lzdGVtLkZ1bmM8Z2xvYmFsOjpDaXJub0dhbWUuRW50aXR5LCBib29sPikoZW50aXR5ID0+IGVudGl0eSAhPSBFICYmICEoKElIYXJtZnVsRW50aXR5KWVudGl0eSkuQXR0YWNrZXIuU2FtZVRlYW0oKEVudGl0eSlFSSkpKSk7XHJcbiAgICAgICAgICAgICAgICAgICAgTGlzdDxFbnRpdHk+IEwgPSBuZXcgTGlzdDxFbnRpdHk+KFN5c3RlbS5MaW5xLkVudW1lcmFibGUuV2hlcmU8Z2xvYmFsOjpDaXJub0dhbWUuRW50aXR5PihoYXJtZnVsRW50aXR5LChnbG9iYWw6OlN5c3RlbS5GdW5jPGdsb2JhbDo6Q2lybm9HYW1lLkVudGl0eSwgYm9vbD4pKGVudGl0eSA9PiBlbnRpdHkgIT0gRSAmJiAhKGVudGl0eS5BczxJSGFybWZ1bEVudGl0eT4oKSkuQXR0YWNrZXIuU2FtZVRlYW0oRUkuQXM8RW50aXR5PigpKSkpKTtcclxuICAgICAgICAgICAgICAgICAgICBpbnQgaiA9IDA7XHJcbiAgICAgICAgICAgICAgICAgICAgdmFyIGxuID0gTC5Db3VudDtcclxuICAgICAgICAgICAgICAgICAgICB3aGlsZSAoaiA8IGxuKVxyXG4gICAgICAgICAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgRW50aXR5IHRtcCA9IExbal07XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIElIYXJtZnVsRW50aXR5IEhFID0gdG1wLkFzPElIYXJtZnVsRW50aXR5PigpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBSZWN0YW5nbGUgT1IgPSB0bXAuR2V0SGl0Ym94KCk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIC8vVmVjdG9yMiBzcGQyID0gdG1wLlNwZWVkICogMC41ZjtcclxuICAgICAgICAgICAgICAgICAgICAgICAgc3BkMi5Db3B5RnJvbSh0bXAuU3BlZWQpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBzcGQyLk11bHRpcGx5KDAuNWYpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAvL1JlY3RhbmdsZSBPUjIgPSBuZXcgUmVjdGFuZ2xlKE9SLnggLSAoc3BkMi5YKSwgT1IueSAtIChzcGQyLlkpLCBPUi53aWR0aCwgT1IuaGVpZ2h0KTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgT1IyLlNldChPUi54IC0gKHNwZDIuWCksIE9SLnkgLSAoc3BkMi5ZKSwgT1Iud2lkdGgsIE9SLmhlaWdodCk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIC8vaWYgKEVJLlRlYW0gIT0gKChJQ29tYmF0YW50KUhFLkF0dGFja2VyKS5UZWFtKVxyXG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAoKFIuaXNUb3VjaGluZyhPUikgfHwgUjIuaXNUb3VjaGluZyhPUjIpKSlcclxuICAgICAgICAgICAgICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKEhFLm9udG91Y2hEYW1hZ2UoRUkpKVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhciBMSFAgPSBFSS5IUDtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBFSS5vbkRhbWFnZWQoSEUsIEhFLnRvdWNoRGFtYWdlKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgZGFtYWdlZCA9IExIUCA+IEVJLkhQO1xyXG5cclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoZGFtYWdlZClcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChFSSA9PSBwbGF5ZXIpXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIEVJLkFzPEVudGl0eT4oKS5QbGF5U291bmQoXCJkYW1hZ2VkXCIpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVsc2VcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgRUkuQXM8RW50aXR5PigpLlBsYXlTb3VuZChcImhpdFwiKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKEVJLkhQIDw9IDApXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoRUkuQXM8RW50aXR5PigpLkhhbmRsZWRMb2NhbGx5KVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBkeW5hbWljIEQgPSBuZXcgb2JqZWN0KCk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBELkkgPSBFSS5BczxFbnRpdHk+KCkuSUQ7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBELkEgPSBIRS5BdHRhY2tlci5JRDtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIEQuUyA9IEhFLkFzPEVudGl0eT4oKS5JRDtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIFNlbmRFdmVudChcIktpbGxcIiwgRCk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLyppZiAoZGFtYWdlZClcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgRUkuQXM8RW50aXR5PigpLlBsYXlTb3VuZChcImtpbGxcIik7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0qL1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBlbHNlXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAvKmlmIChkYW1hZ2VkKVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBFSS5BczxFbnRpdHk+KCkuUGxheVNvdW5kKFwiaGl0XCIpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9Ki9cclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBBdHRhY2soRUkuQXM8SUNvbWJhdGFudD4oKSwgSEUuQXM8SUhhcm1mdWxFbnRpdHk+KCkpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGorKztcclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgLypMaXN0PEVudGl0eT4gTCA9IG5ldyBMaXN0PEVudGl0eT4oY29tYmF0YW50cy5XaGVyZShlbnRpdHkgPT4gZW50aXR5ICE9IEUgJiYgZW50aXR5IGlzIElDb21iYXRhbnQgJiYgZW50aXR5LkdldEhpdGJveCgpLmludGVyc2VjdHMoUikpKTtcclxuICAgICAgICAgICAgICAgICAgICBpbnQgaiA9IDA7XHJcbiAgICAgICAgICAgICAgICAgICAgd2hpbGUgKGogPCBMLkNvdW50KVxyXG4gICAgICAgICAgICAgICAgICAgIHtcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGorKztcclxuICAgICAgICAgICAgICAgICAgICB9Ki9cclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIGkrKztcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuICAgICAgICBwdWJsaWMgdm9pZCBBdHRhY2soSUNvbWJhdGFudCB0YXJnZXQsIElIYXJtZnVsRW50aXR5IHNvdXJjZSlcclxuICAgICAgICB7XHJcbiAgICAgICAgICAgIGlmICh0YXJnZXQuSFAgPiAwICYmIHNvdXJjZS5vbnRvdWNoRGFtYWdlKHRhcmdldCkpXHJcbiAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgIHRhcmdldC5vbkRhbWFnZWQoc291cmNlLCBzb3VyY2UudG91Y2hEYW1hZ2UpO1xyXG4gICAgICAgICAgICAgICAgLy8oKEVudGl0eSl0YXJnZXQpLlBsYXlTb3VuZChcImhpdFwiKTtcclxuICAgICAgICAgICAgICAgIGlmICh0YXJnZXQuSFAgPD0gMClcclxuICAgICAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgICAgICBpZiAoKChFbnRpdHkpdGFyZ2V0KS5IYW5kbGVkTG9jYWxseSlcclxuICAgICAgICAgICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGR5bmFtaWMgRCA9IG5ldyBvYmplY3QoKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgRC5JID0gKChFbnRpdHkpdGFyZ2V0KS5JRDtcclxuICAgICAgICAgICAgICAgICAgICAgICAgRC5BID0gKChFbnRpdHkpc291cmNlLkF0dGFja2VyKS5JRDtcclxuICAgICAgICAgICAgICAgICAgICAgICAgRC5TID0gKChFbnRpdHkpc291cmNlKS5JRDtcclxuICAgICAgICAgICAgICAgICAgICAgICAgU2VuZEV2ZW50KFwiS2lsbFwiLCBEKTtcclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcbiAgICAgICAgcHVibGljIHZvaWQgUGxheVNvdW5kRWZmZWN0KFZlY3RvcjIgc291cmNlLCBzdHJpbmcgc291bmQpXHJcbiAgICAgICAge1xyXG4gICAgICAgICAgICBpZiAobXV0ZWQpXHJcbiAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgIHJldHVybjtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBmbG9hdCB2b2wgPSAxZjtcclxuICAgICAgICAgICAgLypmbG9hdCBtaW4gPSA2NDA7XHJcbiAgICAgICAgICAgIGZsb2F0IG1heExlbmd0aCA9IDMyMDsqL1xyXG4gICAgICAgICAgICAvL2Zsb2F0IG1pbiA9IDcwMDtcclxuICAgICAgICAgICAgZmxvYXQgbWluID0gNTA7XHJcbiAgICAgICAgICAgIGZsb2F0IG1heExlbmd0aCA9IDIwMDtcclxuICAgICAgICAgICAgaWYgKHNvdXJjZSAhPSBudWxsKVxyXG4gICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICAvL2Zsb2F0IGRpc3QgPSAoY2FtZXJhLkNlbnRlciAtIHNvdXJjZSkuUm91Z2hMZW5ndGg7XHJcbiAgICAgICAgICAgICAgICAvL2Zsb2F0IGRpc3QgPSAoY2FtZXJhLkNlbnRlciAtIHNvdXJjZSkuTGVuZ3RoO1xyXG4gICAgICAgICAgICAgICAgZmxvYXQgZGlzdCA9IGNhbWVyYS5DZW50ZXIuRXN0aW1hdGVkRGlzdGFuY2Uoc291cmNlKTtcclxuICAgICAgICAgICAgICAgIGRpc3QgLT0gbWluO1xyXG4gICAgICAgICAgICAgICAgaWYgKGRpc3QgPiAwKVxyXG4gICAgICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgICAgIGlmIChkaXN0ID49IG1heExlbmd0aClcclxuICAgICAgICAgICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIC8vdm9sdW1lIG9mIDAsIGp1c3QgZG9uJ3QgcGxheSBpdC5cclxuICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuO1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICBlbHNlXHJcbiAgICAgICAgICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB2b2wgPSAxZiAtIChkaXN0IC8gbWF4TGVuZ3RoKTtcclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgQXVkaW9NYW5hZ2VyLl90aGlzLkJsYXN0KFwiU0ZYL1wiICsgc291bmQgKyBcIi5vZ2dcIiwgdm9sKTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIHB1YmxpYyB2b2lkIEFkZEVudGl0eShFbnRpdHkgRSlcclxuICAgICAgICB7XHJcbiAgICAgICAgICAgIGVudGl0aWVzLkFkZChFKTtcclxuICAgICAgICAgICAgaWYgKEUgaXMgSUNvbWJhdGFudClcclxuICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgY29tYmF0YW50cy5BZGQoRS5Ub0R5bmFtaWMoKSk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgaWYgKEUgaXMgSUhhcm1mdWxFbnRpdHkpXHJcbiAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgIGhhcm1mdWwuQWRkKEUuVG9EeW5hbWljKCkpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHB1YmxpYyB2b2lkIFJlbW92ZUVudGl0eShFbnRpdHkgRSlcclxuICAgICAgICB7XHJcbiAgICAgICAgICAgIEUub25SZW1vdmUoKTtcclxuICAgICAgICAgICAgZW50aXRpZXMuUmVtb3ZlKEUpO1xyXG4gICAgICAgICAgICBpZiAoRSBpcyBJQ29tYmF0YW50KVxyXG4gICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICBjb21iYXRhbnRzLlJlbW92ZShFLlRvRHluYW1pYygpKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBpZiAoRSBpcyBJSGFybWZ1bEVudGl0eSlcclxuICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgaGFybWZ1bC5SZW1vdmUoRS5Ub0R5bmFtaWMoKSk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcbiAgICAgICAgcHVibGljIG92ZXJyaWRlIHZvaWQgUmVuZGVyKClcclxuICAgICAgICB7XHJcbiAgICAgICAgICAgIGJhc2UuUmVuZGVyKCk7XHJcblxyXG4gICAgICAgICAgICBDYW52YXNSZW5kZXJpbmdDb250ZXh0MkQgZyA9IHNwcml0ZUdyYXBoaWNzO1xyXG4gICAgICAgICAgICBpZiAoc2tpcHJlbmRlcilcclxuICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgZyA9IEVHO1xyXG4gICAgICAgICAgICAgICAgc2tpcHJlbmRlciA9IGZhbHNlO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIFVwZGF0ZUNhbWVyYSgpO1xyXG4gICAgICAgICAgICBEcmF3QmFja2dyb3VuZChnKTtcclxuXHJcbiAgICAgICAgICAgIGcuU2F2ZSgpO1xyXG5cclxuICAgICAgICAgICAgY2FtZXJhLkFwcGx5KGcpO1xyXG4gICAgICAgICAgICAvL1RNLnBvc2l0aW9uLlkgPSAtMjAwO1xyXG4gICAgICAgICAgICBUTS5EcmF3KGcpO1xyXG4gICAgICAgICAgICBlbnRpdGllcy5Gb3JFYWNoKChnbG9iYWw6OlN5c3RlbS5BY3Rpb248Z2xvYmFsOjpDaXJub0dhbWUuRW50aXR5PikoRSA9PiB7IGlmIChFLkFsaXZlICYmIEUuVmlzaWJsZSkgeyBFLkRyYXcoZyk7IH0gfSkpO1xyXG5cclxuICAgICAgICAgICAgZy5SZXN0b3JlKCk7XHJcblxyXG4gICAgICAgICAgICBpZiAocGxheWluZylcclxuICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgUmVuZGVyR1VJKGcpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIGVsc2VcclxuICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgZy5HbG9iYWxBbHBoYSA9IDAuM2Y7XHJcbiAgICAgICAgICAgICAgICBnLkZpbGxTdHlsZSA9IFwiIzAwMDAwMFwiO1xyXG4gICAgICAgICAgICAgICAgZy5GaWxsUmVjdCgwLCAwLCBzcHJpdGVCdWZmZXIuV2lkdGgsIHNwcml0ZUJ1ZmZlci5IZWlnaHQpO1xyXG4gICAgICAgICAgICAgICAgZy5HbG9iYWxBbHBoYSA9IDFmO1xyXG4gICAgICAgICAgICAgICAgVFMuRHJhdyhnKTtcclxuICAgICAgICAgICAgICAgIGlmIChwbGF5ZXIuc2NvcmUgPiAwKVxyXG4gICAgICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgICAgIFNjb3JlU3ByaXRlLlRleHQgPSBcIkxldmVsOlwiICsgbGV2ZWwgKyBcIiBTY29yZTpcIiArIHBsYXllci5zY29yZTtcclxuICAgICAgICAgICAgICAgICAgICBTY29yZVNwcml0ZS5Gb3JjZVVwZGF0ZSgpO1xyXG4gICAgICAgICAgICAgICAgICAgIFNjb3JlU3ByaXRlLlBvc2l0aW9uLlggPSAoc3ByaXRlQnVmZmVyLldpZHRoICogMC45OGYpIC0gU2NvcmVTcHJpdGUuc3ByaXRlQnVmZmVyLldpZHRoO1xyXG4gICAgICAgICAgICAgICAgICAgIFNjb3JlU3ByaXRlLkRyYXcoZyk7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgfVxyXG4gICAgICAgIHB1YmxpYyB2b2lkIFN0YXJ0KClcclxuICAgICAgICB7XHJcbiAgICAgICAgICAgIGlmIChlbnRpdGllcy5Db250YWlucyhwbGF5ZXIpKVxyXG4gICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICBSZW1vdmVFbnRpdHkocGxheWVyKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBwbGF5ZXIgPSBuZXcgUGxheWVyQ2hhcmFjdGVyKHRoaXMpO1xyXG4gICAgICAgICAgICBBZGRFbnRpdHkocGxheWVyKTtcclxuICAgICAgICAgICAgcGxheWluZyA9IHRydWU7XHJcbiAgICAgICAgICAgIGxldmVsID0gMDtcclxuICAgICAgICAgICAgU3RhcnROZXh0TGV2ZWwoKTtcclxuICAgICAgICAgICAgQXBwLkRpdi5TdHlsZS5DdXJzb3IgPSBudWxsO1xyXG5cclxuICAgICAgICAgICAgdG90YWxUaW1lID0gMDtcclxuICAgICAgICAgICAgdGltZVJlbWFpbmluZyA9IGRlZmF1bHRUaW1lUmVtYWluaW5nO1xyXG4gICAgICAgICAgICAvL3RpbWVSZW1haW5pbmcgKj0gMC4zMzM0ZiAqIDAuMjVmO1xyXG4gICAgICAgICAgICAvKnRpbWVSZW1haW5pbmcgKj0gMC4zMzM0ZiAqIDAuMDVmO1xyXG4gICAgICAgICAgICBwbGF5ZXIuSFAgPSA1OyovXHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBwdWJsaWMgdm9pZCBQbGF5TXVzaWMoc3RyaW5nIHNvbmcpXHJcbiAgICAgICAge1xyXG4gICAgICAgICAgICBpZiAobXV0ZWQpXHJcbiAgICAgICAgICAgICAgICByZXR1cm47XHJcbiAgICAgICAgICAgIEF1ZGlvIE0gPSBBdWRpb01hbmFnZXIuX3RoaXMuR2V0KFwiQkdNL1wiICsgc29uZyArIFwiLm9nZ1wiKTtcclxuICAgICAgICAgICAgaWYgKCFNLklzUGxheWluZylcclxuICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgQXVkaW9NYW5hZ2VyLl90aGlzLlN0b3BBbGxGcm9tRGlyZWN0b3J5KFwiQkdNL1wiKTtcclxuICAgICAgICAgICAgICAgIC8vTS5Wb2x1bWUgPSAwLjM1O1xyXG4gICAgICAgICAgICAgICAgTS5Wb2x1bWUgPSAwLjM1O1xyXG4gICAgICAgICAgICAgICAgTS5Mb29wID0gdHJ1ZTtcclxuICAgICAgICAgICAgICAgIE0uUGxheSgpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHB1YmxpYyB2b2lkIFJlbmRlckdVSShDYW52YXNSZW5kZXJpbmdDb250ZXh0MkQgZylcclxuICAgICAgICB7XHJcbiAgICAgICAgICAgIHZhciBQQyA9IChQbGF5ZXJDaGFyYWN0ZXIpcGxheWVyO1xyXG4gICAgICAgICAgICB2YXIgY29sb3IgPSBcIiMwMEREMDBcIjtcclxuICAgICAgICAgICAgaWYgKHRpbWVSZW1haW5pbmcgPCBiYXNlTGlmZUNvc3QpXHJcbiAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgIGlmICh0aW1lUmVtYWluaW5nIDw9IDApXHJcbiAgICAgICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICAgICAgY29sb3IgPSBcIiNDQzAwODhcIjtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIGVsc2VcclxuICAgICAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgICAgICBjb2xvciA9IFwiI0ZGMDAwMFwiO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICBnLkdsb2JhbEFscGhhID0gMC44ZjtcclxuICAgICAgICAgICAgRHJhd0dhdWdlKGcsIG5ldyBWZWN0b3IyKDAsIDApLCBuZXcgVmVjdG9yMihzcHJpdGVCdWZmZXIuV2lkdGggLyA0LCBzcHJpdGVCdWZmZXIuSGVpZ2h0IC8gMjApLCA1LCBQQy5IUCAvIFBDLm1heEhQLCBjb2xvcik7XHJcbiAgICAgICAgICAgIGcuR2xvYmFsQWxwaGEgPSAxO1xyXG5cclxuICAgICAgICAgICAgVGltZXJTcHJpdGUuRHJhdyhnKTtcclxuICAgICAgICAgICAgU2NvcmVTcHJpdGUuVGV4dCA9IFwiTGV2ZWw6XCIgKyBsZXZlbCArIFwiIFNjb3JlOlwiICsgcGxheWVyLnNjb3JlO1xyXG4gICAgICAgICAgICBTY29yZVNwcml0ZS5Gb3JjZVVwZGF0ZSgpO1xyXG4gICAgICAgICAgICBTY29yZVNwcml0ZS5Qb3NpdGlvbi5YID0gKHNwcml0ZUJ1ZmZlci5XaWR0aCAqIDAuOThmKSAtIFNjb3JlU3ByaXRlLnNwcml0ZUJ1ZmZlci5XaWR0aDtcclxuICAgICAgICAgICAgU2NvcmVTcHJpdGUuRHJhdyhnKTtcclxuICAgICAgICAgICAgUmVuZGVySWNvbnMoZyk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHB1YmxpYyB2b2lkIFJlbmRlckljb25zKENhbnZhc1JlbmRlcmluZ0NvbnRleHQyRCBnKVxyXG4gICAgICAgIHtcclxuICAgICAgICAgICAgdmFyIFIgPSBLZXkuSGVpZ2h0IC8gS2V5LldpZHRoO1xyXG4gICAgICAgICAgICB2YXIgVyA9IHNwcml0ZUJ1ZmZlci5XaWR0aCAqIDAuMDJmO1xyXG4gICAgICAgICAgICB2YXIgSCA9IHNwcml0ZUJ1ZmZlci5IZWlnaHQgKiAwLjA1NWY7XHJcblxyXG4gICAgICAgICAgICB2YXIgWSA9IEg7XHJcbiAgICAgICAgICAgIHZhciBYID0gVyAvIDI7XHJcbiAgICAgICAgICAgIHZhciBpID0gMDtcclxuICAgICAgICAgICAgXHJcbiAgICAgICAgICAgIC8vdmFyIHN6ID0gc3ByaXRlQnVmZmVyLldpZHRoICogMC4wMTVmO1xyXG4gICAgICAgICAgICB2YXIgc3ogPSBzcHJpdGVCdWZmZXIuV2lkdGggKiAwLjAxMTVmO1xyXG4gICAgICAgICAgICBnLkdsb2JhbEFscGhhID0gMC44ZjtcclxuICAgICAgICAgICAgaWYgKERvb3IuT3BlbmVkKVxyXG4gICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICB2YXIgREEgPSBCaWdLZXk7XHJcbiAgICAgICAgICAgICAgICAvL3ZhciBEc3ogPSBzcHJpdGVCdWZmZXIuV2lkdGggKiAwLjAxOGY7XHJcbiAgICAgICAgICAgICAgICB2YXIgRHN6ID0gc3ogKiAxLjVmO1xyXG4gICAgICAgICAgICAgICAgdmFyIERSID0gREEuSGVpZ2h0IC8gREEuV2lkdGg7XHJcblxyXG4gICAgICAgICAgICAgICAgZy5EcmF3SW1hZ2UoREEsIFgsIFksIERzeiwgRHN6ICogUik7XHJcbiAgICAgICAgICAgICAgICBYICs9IFc7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgd2hpbGUgKGkgPCBwbGF5ZXIua2V5cylcclxuICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgZy5EcmF3SW1hZ2UoS2V5LCBYLCBZLCBzeiwgc3ogKiBSKTtcclxuICAgICAgICAgICAgICAgIFggKz0gVztcclxuICAgICAgICAgICAgICAgIGkrKztcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBnLkdsb2JhbEFscGhhID0gMWY7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHB1YmxpYyB2b2lkIERyYXdHYXVnZShDYW52YXNSZW5kZXJpbmdDb250ZXh0MkQgZywgVmVjdG9yMiBwb3NpdGlvbiwgVmVjdG9yMiBzaXplLCBpbnQgYm9yZGVyLCBmbG9hdCBwcm9ncmVzcywgc3RyaW5nIGNvbG9yLCBib29sIGRyYXdib3JkZXIgPSB0cnVlKVxyXG4gICAgICAgIHtcclxuICAgICAgICAgICAgdmFyIGFscGhhID0gZy5HbG9iYWxBbHBoYTtcclxuICAgICAgICAgICAgaWYgKGRyYXdib3JkZXIpXHJcbiAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgIGcuR2xvYmFsQWxwaGEgPSAwLjZmICogYWxwaGE7XHJcbiAgICAgICAgICAgICAgICBnLkZpbGxTdHlsZSA9IFwiIzAwMDAwMFwiO1xyXG5cclxuICAgICAgICAgICAgICAgIGcuRmlsbFJlY3QoKGludClwb3NpdGlvbi5YLCAoaW50KXBvc2l0aW9uLlksIChpbnQpc2l6ZS5YLCAoaW50KXNpemUuWSk7XHJcbiAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgIGcuRmlsbFN0eWxlID0gY29sb3I7XHJcbiAgICAgICAgICAgIGcuR2xvYmFsQWxwaGEgPSAxLjBmICogYWxwaGE7XHJcbiAgICAgICAgICAgIGcuRmlsbFJlY3QoKGludClwb3NpdGlvbi5YICsgYm9yZGVyLCAoaW50KXBvc2l0aW9uLlkgKyBib3JkZXIsIChpbnQpKChzaXplLlggLSAoYm9yZGVyICsgYm9yZGVyKSkgKiBwcm9ncmVzcyksIChpbnQpc2l6ZS5ZIC0gKGJvcmRlciArIGJvcmRlcikpO1xyXG5cclxuICAgICAgICAgICAgZy5HbG9iYWxBbHBoYSA9IDAuNWYgKiBhbHBoYTtcclxuICAgICAgICAgICAgLy9TY3JpcHQuV3JpdGUoXCJ2YXIgZ3JkID0gZy5jcmVhdGVMaW5lYXJHcmFkaWVudCgwLCAwLCAwLCBzaXplLnkpO2dyZC5hZGRDb2xvclN0b3AoMCwgY29sb3IpO2dyZC5hZGRDb2xvclN0b3AoMC40LCBcXFwid2hpdGVcXFwiKTtncmQuYWRkQ29sb3JTdG9wKDEsIGNvbG9yKTtnLmZpbGxTdHlsZSA9IGdyZDtcIik7XHJcbiAgICAgICAgICAgIHZhciBncmQgPSBnLkNyZWF0ZUxpbmVhckdyYWRpZW50KDAsIDAsIDAsIHNpemUuWSk7XHJcbiAgICAgICAgICAgIGdyZC5BZGRDb2xvclN0b3AoMCwgY29sb3IpO1xyXG4gICAgICAgICAgICBncmQuQWRkQ29sb3JTdG9wKDAuNCwgXCJ3aGl0ZVwiKTtcclxuICAgICAgICAgICAgZ3JkLkFkZENvbG9yU3RvcCgxLCBjb2xvcik7XHJcbiAgICAgICAgICAgIGcuRmlsbFN0eWxlID0gZ3JkO1xyXG5cclxuXHJcbiAgICAgICAgICAgIGcuRmlsbFJlY3QoKGludClwb3NpdGlvbi5YICsgYm9yZGVyLCAoaW50KXBvc2l0aW9uLlkgKyBib3JkZXIsIChpbnQpKChzaXplLlggLSAoYm9yZGVyICsgYm9yZGVyKSkgKiBwcm9ncmVzcyksIChpbnQpc2l6ZS5ZIC0gKGJvcmRlciArIGJvcmRlcikpO1xyXG4gICAgICAgICAgICBnLkdsb2JhbEFscGhhID0gYWxwaGE7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHB1YmxpYyBib29sIFNob3dIaXRib3ggPSBmYWxzZTtcclxuICAgICAgICBwdWJsaWMgdm9pZCBTZW5kRXZlbnQoc3RyaW5nIGV2ZW50TmFtZSwgZHluYW1pYyBkYXRhLCBib29sIHRyaWdnZXJmbHVzaCA9IGZhbHNlKVxyXG4gICAgICAgIHtcclxuICAgICAgICAgICAgZHluYW1pYyBEID0gbmV3IG9iamVjdCgpO1xyXG4gICAgICAgICAgICBELkUgPSBldmVudE5hbWU7XHJcbiAgICAgICAgICAgIEQuRCA9IGRhdGE7XHJcbiAgICAgICAgICAgIC8qTmV0UGxheVVzZXIgTlUgPSBudWxsO1xyXG4gICAgICAgICAgICBpZiAoT25saW5lKVxyXG4gICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICBOUC5TZW5kKEQpO1xyXG4gICAgICAgICAgICAgICAgTlUgPSBOUC5NZTtcclxuICAgICAgICAgICAgfSovXHJcbiAgICAgICAgICAgIC8vUHJvY2Vzc0V2ZW50KEQsIE5VLCAwKTtcclxuICAgICAgICAgICAgUHJvY2Vzc0V2ZW50KEQpO1xyXG4gICAgICAgICAgICAvKmlmICh0cmlnZ2VyZmx1c2gpXHJcbiAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgIE5ldFBsYXlOZWVkc0ZsdXNoID0gdHJ1ZTtcclxuICAgICAgICAgICAgfSovXHJcbiAgICAgICAgfVxyXG4gICAgICAgIHB1YmxpYyB2b2lkIFByb2Nlc3NFdmVudChkeW5hbWljIG1zZywgLypOZXRQbGF5VXNlciovb2JqZWN0IHVzZXIgPSBudWxsLCBmbG9hdCBsYXRlbmN5ID0gMClcclxuICAgICAgICB7XHJcbiAgICAgICAgICAgIGR5bmFtaWMgRCA9IG1zZy5EO1xyXG4gICAgICAgICAgICAvKkxpc3Q8UGxheWVyPiBMUCA9IG5ldyBMaXN0PFBsYXllcj4ocGxheWVycy5XaGVyZShwbGF5ZXIgPT4gdXNlciAhPSBudWxsICYmIHBsYXllci5OZXR3b3JrSUQgPT0gdXNlci51c2VySUQpKTtcclxuICAgICAgICAgICAgUGxheWVyIFAgPSBudWxsO1xyXG4gICAgICAgICAgICBcclxuICAgICAgICAgICAgYm9vbCBoYXNjaGFyYWN0ZXIgPSB0cnVlO1xyXG4gICAgICAgICAgICBpZiAoTFAuQ291bnQgPD0gMClcclxuICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgaWYgKFAgPT0gbnVsbCAmJiB1c2VyID09IG51bGwgJiYgIU9ubGluZSlcclxuICAgICAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgICAgICBQID0gbG9jYWxwbGF5ZXI7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICBlbHNlXHJcbiAgICAgICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKHVzZXIuSXNNZSlcclxuICAgICAgICAgICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGxvY2FscGxheWVyLk5ldHdvcmtJRCA9IHVzZXIudXNlcklEO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBQID0gbG9jYWxwbGF5ZXI7XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgIGVsc2VcclxuICAgICAgICAgICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGhhc2NoYXJhY3RlciA9IGZhbHNlO1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBlbHNlXHJcbiAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgIFAgPSBMUFswXTtcclxuICAgICAgICAgICAgfSovXHJcbiAgICAgICAgICAgIHN0cmluZyBldnQgPSBtc2cuRTtcclxuICAgICAgICAgICAgLyppZiAodXNlciAhPSBudWxsICYmICF1c2VyLklzTWUpXHJcbiAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgIERsYXRlbmN5ICs9IGxhdGVuY3k7XHJcbiAgICAgICAgICAgICAgICAvL2xhdGVuY3kgKj0gMC45OWY7XHJcbiAgICAgICAgICAgICAgICBEbGF0ZW5jeSAqPSAoMSAtICgxIC8gbGF0ZW5jeU0pKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAvL2lmIChtc2cuRSA9PSBcIkluaXRcIiAmJiAhUC5sb2NhbClcclxuICAgICAgICAgICAgaWYgKGV2dCA9PSBcIkluaXRcIiAmJiBQID09IG51bGwpXHJcbiAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgIGlmICghaGFzY2hhcmFjdGVyKVxyXG4gICAgICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgICAgIFAgPSBuZXcgUGxheWVyKGZhbHNlLCBmYWxzZSk7XHJcbiAgICAgICAgICAgICAgICAgICAgUC5OZXR3b3JrSUQgPSB1c2VyLnVzZXJJRDtcclxuICAgICAgICAgICAgICAgICAgICAvL1BsYXllckNoYXJhY3RlciBQQyA9IG5ldyBQbGF5ZXJDaGFyYWN0ZXIodGhpcywgUCwgXCJSZWlzZW5cIik7XHJcbiAgICAgICAgICAgICAgICAgICAgUGxheWVyQ2hhcmFjdGVyIFBDID0gbmV3IFBsYXllckNoYXJhY3Rlcih0aGlzLCBQLCBELkMpO1xyXG4gICAgICAgICAgICAgICAgICAgIC8vUEMuVGVhbSA9IDE7XHJcbiAgICAgICAgICAgICAgICAgICAgUEMuVGVhbSA9IEQuVDtcclxuICAgICAgICAgICAgICAgICAgICBQQy54ID0gNzAwO1xyXG4gICAgICAgICAgICAgICAgICAgIFBDLnkgPSAyNDA7XHJcbiAgICAgICAgICAgICAgICAgICAgUEMuSUQgPSBELkk7XHJcbiAgICAgICAgICAgICAgICAgICAgcGxheWVycy5BZGQoUCk7XHJcbiAgICAgICAgICAgICAgICAgICAgQWRkRW50aXR5KFBDKTtcclxuICAgICAgICAgICAgICAgICAgICBpZiAoSG9zdGVyKVxyXG4gICAgICAgICAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgU2VuZEV2ZW50KFwiTWFwU2VlZFwiLCBUTS5TZWVkKTtcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIExpc3Q8RW50aXR5PiBMID0gbmV3IExpc3Q8RW50aXR5PihlbnRpdGllcy5XaGVyZShFID0+IEUgaXMgTWFkbmVzc09yYiB8fCAoRSBpcyBQbGF5ZXJDaGFyYWN0ZXIgJiYgKChQbGF5ZXJDaGFyYWN0ZXIpRSkucGxheWVyLkNQVSkpKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgaW50IGkgPSAwO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB3aGlsZSAoaSA8IEwuQ291bnQpXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIFNlbmRFbnRpdHlTcGF3bkNoZWNrKExbaV0pO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgaSsrO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgIENvbnNvbGUuV3JpdGVMaW5lKFwiVXNlcjpcIiArIFAuTmV0d29ya0lEICsgXCIgaGFzIGpvaW5lZCFcIik7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgaWYgKGV2dCA9PSBcIlNwYXduXCIpXHJcbiAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgIEVudGl0eSBFID0gRW50aXR5RnJvbUlEKEQuSSk7XHJcbiAgICAgICAgICAgICAgICBpZiAoRSA9PSBudWxsKVxyXG4gICAgICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgICAgIFR5cGUgVCA9IEhlbHBlci5HZXRUeXBlKEQuVCk7XHJcbiAgICAgICAgICAgICAgICAgICAgRSA9IEFjdGl2YXRvci5DcmVhdGVJbnN0YW5jZShULCB0aGlzKS5Ub0R5bmFtaWMoKTtcclxuICAgICAgICAgICAgICAgICAgICBFLklEID0gRC5JO1xyXG4gICAgICAgICAgICAgICAgICAgIEUueCA9IEQuWDtcclxuICAgICAgICAgICAgICAgICAgICBFLnkgPSBELlk7XHJcblxyXG4gICAgICAgICAgICAgICAgICAgIGlmIChELkQpXHJcbiAgICAgICAgICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBIZWxwZXIuQ29weUZpZWxkcyhELkQsIEUpO1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICBBZGRFbnRpdHkoRSk7XHJcbiAgICAgICAgICAgICAgICAgICAgQ2F0Y2h1cEVudGl0eShFLCBsYXRlbmN5KTtcclxuICAgICAgICAgICAgICAgICAgICAvL0FjdGl2YXRvci5DcmVhdGVJbnN0YW5jZSgpXHJcbiAgICAgICAgICAgICAgICAgICAgLy9TeXN0ZW0uUmVmbGVjdGlvbi5cclxuICAgICAgICAgICAgICAgICAgICAvL1R5cGUgVCA9IFR5cGUuR2V0VHlwZShcIlwiKTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBpZiAoZXZ0ID09IFwiVW5wYXVzZVwiKVxyXG4gICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICBwYXVzZWQgPSBmYWxzZTtcclxuICAgICAgICAgICAgICAgIENvbnNvbGUuV3JpdGVMaW5lKFwiR2FtZSB1bnBhdXNlZFwiKTtcclxuICAgICAgICAgICAgICAgIFNlbmRJbml0KCk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgaWYgKGV2dCA9PSBcIk1hcFNlZWRcIiAmJiAhSG9zdGVyKVxyXG4gICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICBpZiAoVE0uU2VlZCAhPSBEKVxyXG4gICAgICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgICAgIFRNLlNlZWQgPSBEO1xyXG4gICAgICAgICAgICAgICAgICAgIFRNLkdlbmVyYXRlKCk7XHJcbiAgICAgICAgICAgICAgICAgICAgLy9jbGVhbiB1cCBsb2NhbCBjbGllbnQgZW50aXRpZXMuXHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKCFjb25uZWN0ZWQpXHJcbiAgICAgICAgICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBpbnQgaSA9IDA7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHdoaWxlIChpIDwgZW50aXRpZXMuQ291bnQpXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChlbnRpdGllc1tpXSBpcyBNYWRuZXNzT3JiIHx8IChlbnRpdGllc1tpXSBpcyBQbGF5ZXJDaGFyYWN0ZXIgJiYgKChQbGF5ZXJDaGFyYWN0ZXIpZW50aXRpZXNbaV0pLnBsYXllci5DUFUpKVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIFJlbW92ZUVudGl0eShlbnRpdGllc1tpXSk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaS0tO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgaSsrO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGNvbm5lY3RlZCA9IHRydWU7XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBpZiAoZXZ0ID09IFwiQ0VcIilcclxuICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgRW50aXR5IGVudGl0eSA9IEVudGl0eUZyb21JRChELkkpO1xyXG4gICAgICAgICAgICAgICAgaWYgKGVudGl0eSAhPSBudWxsKVxyXG4gICAgICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgICAgIGVudGl0eS5DdXN0b21FdmVudChELkQpO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIGlmIChldnQgPT0gXCJDQkVcIilcclxuICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgRW50aXR5IGVudGl0eSA9IEVudGl0eUZyb21JRChELkkpO1xyXG4gICAgICAgICAgICAgICAgaWYgKGVudGl0eSAhPSBudWxsKVxyXG4gICAgICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgICAgIEVudGl0eUJlaGF2aW9yIGIgPSBlbnRpdHkuR2V0QmVoYXZpb3JGcm9tTmFtZShELlQpO1xyXG4gICAgICAgICAgICAgICAgICAgIGIuQ3VzdG9tRXZlbnQoRC5EKTtcclxuICAgICAgICAgICAgICAgICAgICAvL2VudGl0eS5DdXN0b21FdmVudChELkQpO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9Ki9cclxuICAgICAgICAgICAgaWYgKGV2dCA9PSBcIktpbGxcIilcclxuICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgRW50aXR5IGVudGl0eSA9IEVudGl0eUZyb21JRChELkkpO1xyXG4gICAgICAgICAgICAgICAgaWYgKGVudGl0eSAhPSBudWxsKVxyXG4gICAgICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgICAgIEVudGl0eSBhdHRhY2tlciA9IEVudGl0eUZyb21JRChELkEpO1xyXG4gICAgICAgICAgICAgICAgICAgICgoSUNvbWJhdGFudCllbnRpdHkpLm9uRGVhdGgoRW50aXR5RnJvbUlEKEQuUykpO1xyXG4gICAgICAgICAgICAgICAgICAgIGlmIChhdHRhY2tlciAhPSBudWxsICYmIGF0dGFja2VyIGlzIFBsYXllckNoYXJhY3RlcilcclxuICAgICAgICAgICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIFBsYXllckNoYXJhY3RlciBQQyA9IChQbGF5ZXJDaGFyYWN0ZXIpYXR0YWNrZXI7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIC8vUEMucGxheWVyLlNjb3JlICs9ICgoSUNvbWJhdGFudCllbnRpdHkpLlBvaW50c0ZvcktpbGxpbmc7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIFBDLnNjb3JlICs9ICgoSUNvbWJhdGFudCllbnRpdHkpLlBvaW50c0ZvcktpbGxpbmc7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIFBDLm9uS2lsbCgoKElDb21iYXRhbnQpZW50aXR5KSk7XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHB1YmxpYyBFbnRpdHkgRW50aXR5RnJvbUlEKHN0cmluZyBJRClcclxuICAgICAgICB7XHJcbiAgICAgICAgICAgIGludCBpID0gMDtcclxuICAgICAgICAgICAgd2hpbGUgKGkgPCBlbnRpdGllcy5Db3VudClcclxuICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgRW50aXR5IEUgPSBlbnRpdGllc1tpXTtcclxuICAgICAgICAgICAgICAgIGlmIChFLklEID09IElEKVxyXG4gICAgICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBFO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgaSsrO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIHJldHVybiBudWxsO1xyXG4gICAgICAgIH1cclxuICAgICAgICBwdWJsaWMgYm9vbCBmcmVlY2FtID0gZmFsc2U7XHJcbiAgICAgICAgcHVibGljIHZvaWQgVXBkYXRlQ2FtZXJhKClcclxuICAgICAgICB7XHJcbiAgICAgICAgICAgIC8vZmxvYXQgRCA9IHRlc3QuSHNwZWVkICogMTg7XHJcbiAgICAgICAgICAgIC8vZmxvYXQgRCA9IChmbG9hdClNYXRoLkFicyh0ZXN0LkhzcGVlZCkgKiA5O1xyXG4gICAgICAgICAgICAvL3ZhciBmcmVlY2FtID0gdHJ1ZTtcclxuICAgICAgICAgICAgY2FtZXJhLnNwZWVkbW9kID0gMWY7XHJcblxyXG4gICAgICAgICAgICAvKmlmIChLZXlib2FyZE1hbmFnZXIuX3RoaXMuVGFwcGVkQnV0dG9ucy5Db250YWluc0IoNjcpICYmIEFwcC5ERUJVRylcclxuICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgZnJlZWNhbSA9ICFmcmVlY2FtO1xyXG4gICAgICAgICAgICB9Ki9cclxuICAgICAgICAgICAgaWYgKGZyZWVjYW0pXHJcbiAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgIHZhciBzcGQgPSAxNiAvIGNhbWVyYS5TY2FsZTtcclxuICAgICAgICAgICAgICAgIHZhciBQQiA9IEtleWJvYXJkTWFuYWdlci5fdGhpcy5QcmVzc2VkQnV0dG9ucztcclxuICAgICAgICAgICAgICAgIC8vbnVtcGFkIHBhbm5pbmdcclxuICAgICAgICAgICAgICAgIGlmIChDaXJub0dhbWUuSGVscGVyRXh0ZW5zaW9ucy5Db250YWluc0I8aW50PihQQiwgMTAwKSlcclxuICAgICAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgICAgICBjYW1lcmEuVGFyZ2V0UG9zaXRpb24uWCAtPSBzcGQ7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICBpZiAoQ2lybm9HYW1lLkhlbHBlckV4dGVuc2lvbnMuQ29udGFpbnNCPGludD4oUEIsIDEwMikpXHJcbiAgICAgICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICAgICAgY2FtZXJhLlRhcmdldFBvc2l0aW9uLlggKz0gc3BkO1xyXG4gICAgICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgICAgIGlmIChDaXJub0dhbWUuSGVscGVyRXh0ZW5zaW9ucy5Db250YWluc0I8aW50PihQQiwgMTA0KSlcclxuICAgICAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgICAgICBjYW1lcmEuVGFyZ2V0UG9zaXRpb24uWSAtPSBzcGQ7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICBpZiAoQ2lybm9HYW1lLkhlbHBlckV4dGVuc2lvbnMuQ29udGFpbnNCPGludD4oUEIsIDk4KSlcclxuICAgICAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgICAgICBjYW1lcmEuVGFyZ2V0UG9zaXRpb24uWSArPSBzcGQ7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICBpZiAoQ2lybm9HYW1lLkhlbHBlckV4dGVuc2lvbnMuQ29udGFpbnNCPGludD4oUEIsIDEwNykpLy9udW1wYWQrXHJcbiAgICAgICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICAgICAgdmFyIENDID0gY2FtZXJhLkNlbnRlcjtcclxuICAgICAgICAgICAgICAgICAgICBjYW1lcmEuU2NhbGUgKj0gMS4wMWY7XHJcbiAgICAgICAgICAgICAgICAgICAgY2FtZXJhLkNlbnRlciA9IENDO1xyXG4gICAgICAgICAgICAgICAgICAgIGNhbWVyYS5UYXJnZXRQb3NpdGlvbi5YID0gY2FtZXJhLlBvc2l0aW9uLlg7XHJcbiAgICAgICAgICAgICAgICAgICAgY2FtZXJhLlRhcmdldFBvc2l0aW9uLlkgPSBjYW1lcmEuUG9zaXRpb24uWTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIGlmIChDaXJub0dhbWUuSGVscGVyRXh0ZW5zaW9ucy5Db250YWluc0I8aW50PihQQiwgMTA5KSkvL251bXBhZC1cclxuICAgICAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgICAgICB2YXIgQ0MgPSBjYW1lcmEuQ2VudGVyO1xyXG4gICAgICAgICAgICAgICAgICAgIGNhbWVyYS5TY2FsZSAqPSAwLjk5ZjtcclxuICAgICAgICAgICAgICAgICAgICBjYW1lcmEuQ2VudGVyID0gQ0M7XHJcbiAgICAgICAgICAgICAgICAgICAgY2FtZXJhLlRhcmdldFBvc2l0aW9uLlggPSBjYW1lcmEuUG9zaXRpb24uWDtcclxuICAgICAgICAgICAgICAgICAgICBjYW1lcmEuVGFyZ2V0UG9zaXRpb24uWSA9IGNhbWVyYS5Qb3NpdGlvbi5ZO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgaWYgKENpcm5vR2FtZS5IZWxwZXJFeHRlbnNpb25zLkNvbnRhaW5zQjxpbnQ+KFBCLCAzNikpLy9ob21lXHJcbiAgICAgICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICAgICAgY2FtZXJhLkNlbnRlcmVkVGFyZ2V0UG9zaXRpb24gPSBwbGF5ZXIuUG9zaXRpb247XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICBpZiAoQ2lybm9HYW1lLkhlbHBlckV4dGVuc2lvbnMuQ29udGFpbnNCPGludD4oUEIsIDEzKSkvL2VudGVyXHJcbiAgICAgICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICAgICAgcGxheWVyLlBvc2l0aW9uLlggPSBjYW1lcmEuQ2VudGVyLlg7XHJcbiAgICAgICAgICAgICAgICAgICAgcGxheWVyLlBvc2l0aW9uLlkgPSBjYW1lcmEuQ2VudGVyLlk7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICBjYW1lcmEuVXBkYXRlKCk7XHJcbiAgICAgICAgICAgICAgICByZXR1cm47XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgaWYgKCFwbGF5aW5nKVxyXG4gICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICBjYW1lcmEuc3BlZWRtb2QgPSAwLjA1ZjtcclxuICAgICAgICAgICAgICAgIGlmIChjYW1lcmEuVGFyZ2V0UG9zaXRpb24gPT0gbnVsbCB8fCBjYW1lcmEuUG9zaXRpb24uRXN0aW1hdGVkRGlzdGFuY2UoY2FtZXJhLlRhcmdldFBvc2l0aW9uKSA8IDQwKVxyXG4gICAgICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgICAgIGlmIChNYXRoLlJhbmRvbSgpIDwgMC4wMDM1IHx8IGNhbWVyYS5pbnN0YXdhcnApXHJcbiAgICAgICAgICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBjYW1lcmEuQ2VudGVyZWRUYXJnZXRQb3NpdGlvbiA9IE1hcFJvb20uRmluZEFueUVtcHR5U3BvdCgpO1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIC8qY2FtZXJhLlRhcmdldFBvc2l0aW9uID0gbnVsbDtcclxuICAgICAgICAgICAgICAgIGlmIChjYW1lcmFXYW5kZXJQb2ludCA9PSBudWxsKVxyXG4gICAgICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgICAgIGNhbWVyYVdhbmRlclBvaW50ID0gTWFwUm9vbS5GaW5kQW55RW1wdHlTcG90KCk7XHJcbiAgICAgICAgICAgICAgICB9Ki9cclxuICAgICAgICAgICAgICAgIGNhbWVyYS5VcGRhdGUoKTtcclxuICAgICAgICAgICAgICAgIHJldHVybjtcclxuICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgaWYgKGZyZWVjYW0pXHJcbiAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgIGlmIChLZXlib2FyZE1hbmFnZXIuX3RoaXMuUHJlc3NlZEJ1dHRvbnMuQ29udGFpbnMoMTAxKSB8fCBLZXlib2FyZE1hbmFnZXIuX3RoaXMuUHJlc3NlZEJ1dHRvbnMuQ29udGFpbnMoMTExKSlcclxuICAgICAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgICAgICB2YXIgVEVTVCA9IFJvb21PcGVuaW5nTGV2ZXIuVEVTVDtcclxuICAgICAgICAgICAgICAgICAgICBpZiAoS2V5Ym9hcmRNYW5hZ2VyLl90aGlzLlByZXNzZWRCdXR0b25zLkNvbnRhaW5zKDEwNikgJiYgIVRFU1QuQWN0aXZhdGVkKVxyXG4gICAgICAgICAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgVEVTVC5BY3RpdmF0ZSgpO1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICBpZiAoVEVTVCAhPSBudWxsKVxyXG4gICAgICAgICAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKCFURVNULkFjdGl2YXRlZCAmJiAhS2V5Ym9hcmRNYW5hZ2VyLl90aGlzLlByZXNzZWRCdXR0b25zLkNvbnRhaW5zKDExMSkpXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNhbWVyYS5DZW50ZXJlZFRhcmdldFBvc2l0aW9uID0gVEVTVC5Qb3NpdGlvbjtcclxuICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgICAgICBlbHNlXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhciBUID0gVE0uR2V0VGlsZShURVNULlJvb20uU1gsIFRFU1QuUm9vbS5TWSk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgSEIgPSBULkdldEhpdGJveCgpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgY2FtZXJhLkNlbnRlcmVkVGFyZ2V0UG9zaXRpb24gPSBuZXcgVmVjdG9yMihIQi5sZWZ0LCBIQi50b3ApO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChLZXlib2FyZE1hbmFnZXIuX3RoaXMuVGFwcGVkQnV0dG9ucy5Db250YWlucygzMikpXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHBsYXllci5Qb3NpdGlvbi5YID0gY2FtZXJhLkNlbnRlci5YO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgcGxheWVyLlBvc2l0aW9uLlkgPSBjYW1lcmEuQ2VudGVyLlk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICAgICAgY2FtZXJhLlVwZGF0ZSgpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICByZXR1cm47XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgIGVsc2VcclxuICAgICAgICAgICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHBsYXllci5NU0cuQ2hhbmdlVGV4dChcIk5vIGxldmVyIG9uIG1hcFwiKTtcclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgaWYgKHBsYXllci5IUCA8IDApXHJcbiAgICAgICAgICAgICAgICByZXR1cm47XHJcbiAgICAgICAgICAgIGZsb2F0IEQgPSAoZmxvYXQpcGxheWVyLkhzcGVlZCAqIDMyO1xyXG4gICAgICAgICAgICBmbG9hdCBsb29rQWhlYWRSYXRlID0gMC4zZjtcclxuICAgICAgICAgICAgdmFyIEggPSBjYW1lcmEuQ2FtZXJhQm91bmRzLndpZHRoIC8gODtcclxuICAgICAgICAgICAgRCArPSAhcGxheWVyLkFuaS5GbGlwcGVkID8gSCA6IC1IO1xyXG4gICAgICAgICAgICB2YXIgQyA9IEFwcC5DYW52YXM7XHJcbiAgICAgICAgICAgIHZhciBJUyA9IGNhbWVyYS5JbnZTY2FsZTtcclxuICAgICAgICAgICAgZmxvYXQgViA9IE1hdGguTWF4KDAsIHBsYXllci5Wc3BlZWQgKiAzMCk7XHJcbiAgICAgICAgICAgIGlmIChwbGF5ZXIuQ29udHJvbGxlclsyXSlcclxuICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgLy9WIC09IGNhbWVyYS5DYW1lcmFCb3VuZHMuaGVpZ2h0IC8gNDtcclxuICAgICAgICAgICAgICAgIFYgLT0gY2FtZXJhLkNhbWVyYUJvdW5kcy5oZWlnaHQgLyAzO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIGVsc2UgaWYgKHBsYXllci5Db250cm9sbGVyWzNdKVxyXG4gICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICAvL1YgKz0gY2FtZXJhLkNhbWVyYUJvdW5kcy5oZWlnaHQgLyA0O1xyXG4gICAgICAgICAgICAgICAgViArPSBjYW1lcmEuQ2FtZXJhQm91bmRzLmhlaWdodCAvIDM7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgZWxzZSBpZiAocGxheWVyLm9uR3JvdW5kKVxyXG4gICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICAvL1YgLT0gY2FtZXJhLkNhbWVyYUJvdW5kcy5oZWlnaHQgLyA4O1xyXG4gICAgICAgICAgICAgICAgViAtPSBjYW1lcmEuQ2FtZXJhQm91bmRzLmhlaWdodCAvIDEwO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIGVsc2VcclxuICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgViArPSBjYW1lcmEuQ2FtZXJhQm91bmRzLmhlaWdodCAvIDEyO1xyXG4gICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICB2YXIgVFAgPSBjYW1lcmEuVGFyZ2V0UG9zaXRpb247XHJcbiAgICAgICAgICAgIC8qVFAuWCA9ICh0ZXN0LnggKyBEKSAtICgoQy5XaWR0aCAvIDIpICogSVMpO1xyXG4gICAgICAgICAgICBUUC5ZID0gKGZsb2F0KU1hdGguTWF4KDAsICh0ZXN0LnkgKyBWKSAtICgoQy5IZWlnaHQgLyAyKSAqIElTKSk7Ki9cclxuICAgICAgICAgICAgLypUUC5YID0gdGVzdC54O1xyXG4gICAgICAgICAgICBUUC5ZID0gdGVzdC55OyovXHJcbiAgICAgICAgICAgIHZhciBYID0gcGxheWVyLnggKyAocGxheWVyLldpZHRoIC8gMikgKyAoRCAqIGxvb2tBaGVhZFJhdGUpO1xyXG4gICAgICAgICAgICB2YXIgWSA9IHBsYXllci55ICsgKHBsYXllci5IZWlnaHQgLyAyKSArIChWICogbG9va0FoZWFkUmF0ZSk7XHJcbiAgICAgICAgICAgIGNhbWVyYS5DZW50ZXJlZFRhcmdldFBvc2l0aW9uID0gbmV3IFZlY3RvcjIoWCwgWSk7XHJcbiAgICAgICAgICAgIGNhbWVyYS5VcGRhdGUoKTtcclxuICAgICAgICB9XHJcbiAgICAgICAgcHVibGljIHZvaWQgRHJhd0JhY2tncm91bmQoQ2FudmFzUmVuZGVyaW5nQ29udGV4dDJEIGcpXHJcbiAgICAgICAge1xyXG4gICAgICAgICAgICBnLkZpbGxTdHlsZSA9IFwiIzc3QUFGRlwiO1xyXG4gICAgICAgICAgICBnLkZpbGxSZWN0KDAsIDAsIEFwcC5DYW52YXMuV2lkdGgsIEFwcC5DYW52YXMuSGVpZ2h0KTtcclxuICAgICAgICAgICAgLyppZiAoQkcgPCAwIHx8IEJHID49IEJHcy5Db3VudClcclxuICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgZy5GaWxsU3R5bGUgPSBcIiM3N0FBRkZcIjtcclxuICAgICAgICAgICAgICAgIGcuRmlsbFJlY3QoMCwgMCwgQXBwLkNhbnZhcy5XaWR0aCwgQXBwLkNhbnZhcy5IZWlnaHQpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIGVsc2VcclxuICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgZy5EcmF3SW1hZ2UoQkdzW0JHXSwgKGZsb2F0KTAsIChmbG9hdCkwKTtcclxuICAgICAgICAgICAgfSovXHJcbiAgICAgICAgfVxyXG4gICAgICAgIHB1YmxpYyB2b2lkIFVwZGF0ZUNvbnRyb2xzKClcclxuICAgICAgICB7XHJcblxyXG4gICAgICAgICAgICB2YXIgUEMgPSBwbGF5ZXI7XHJcbiAgICAgICAgICAgIGZsb2F0IHRocmVzaGhvbGQgPSAwLjdmO1xyXG4gICAgICAgICAgICBib29sW10gQyA9IFBDLkNvbnRyb2xsZXI7XHJcbiAgICAgICAgICAgIHZhciBJQyA9IEFwcC5JQztcclxuXHJcbiAgICAgICAgICAgIGlmIChJQyA9PSBudWxsKVxyXG4gICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICByZXR1cm47XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgZmxvYXQgeCA9IElDLmdldFN0YXRlKDApO1xyXG4gICAgICAgICAgICBmbG9hdCB5ID0gSUMuZ2V0U3RhdGUoMSk7XHJcbiAgICAgICAgICAgIENbMF0gPSB4IDw9IC10aHJlc2hob2xkO1xyXG4gICAgICAgICAgICBDWzFdID0geCA+PSB0aHJlc2hob2xkO1xyXG4gICAgICAgICAgICBDWzJdID0geSA8PSAtdGhyZXNoaG9sZDtcclxuICAgICAgICAgICAgQ1szXSA9IHkgPj0gdGhyZXNoaG9sZDtcclxuXHJcbiAgICAgICAgICAgIHN0cmluZyBjaWQgPSBJQy5nZXRNYXBDb250cm9sbGVySUQoNSk7XHJcbiAgICAgICAgICAgIGlmIChjaWQgPT0gXCJLZXlib2FyZFwiIHx8IGNpZCA9PSBcIk1vdXNlXCIpXHJcbiAgICAgICAgICAgIC8vaWYgKElDLmlkID09IFwiS2V5Ym9hcmRcIilcclxuICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgLy8vL1BDLkFpbUF0KEdldE1vdXNlKCkpO1xyXG4gICAgICAgICAgICAgICAgLypDWzRdID0gS2V5Ym9hcmRNYW5hZ2VyLl90aGlzLlByZXNzZWRNb3VzZUJ1dHRvbnMuQ29udGFpbnMoMCk7XHJcbiAgICAgICAgICAgICAgICBDWzVdID0gS2V5Ym9hcmRNYW5hZ2VyLl90aGlzLlByZXNzZWRNb3VzZUJ1dHRvbnMuQ29udGFpbnMoMik7Ki9cclxuICAgICAgICAgICAgICAgIENbNF0gPSBJQy5nZXRQcmVzc2VkKDIpO1xyXG4gICAgICAgICAgICAgICAgQ1s1XSA9IElDLmdldFByZXNzZWQoMyk7XHJcbiAgICAgICAgICAgICAgICBDWzZdID0gSUMuZ2V0UHJlc3NlZCg0KTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBlbHNlXHJcbiAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgIC8qR2FtZVBhZCBQID0gR2FtZVBhZE1hbmFnZXIuX3RoaXMuR2V0UGFkKElDLmlkKTtcclxuICAgICAgICAgICAgICAgIFBDLmFpbUFuZ2xlID0gbmV3IFZlY3RvcjIoKGZsb2F0KVAuYXhlc1syXSwgKGZsb2F0KVAuYXhlc1szXSkuVG9BbmdsZSgpOyovXHJcbiAgICAgICAgICAgICAgICBWZWN0b3IyIGFpbSA9IG5ldyBWZWN0b3IyKElDLmdldFN0YXRlKDQpLCBJQy5nZXRTdGF0ZSg1KSk7XHJcbiAgICAgICAgICAgICAgICBpZiAoYWltLlJvdWdoTGVuZ3RoID4gMC41KVxyXG4gICAgICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgICAgIC8vLy9QQy5haW1BbmdsZSA9IGFpbS5Ub0FuZ2xlKCk7XHJcbiAgICAgICAgICAgICAgICB9XHJcblxyXG5cclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBDWzRdID0gSUMuZ2V0UHJlc3NlZCgyKTtcclxuICAgICAgICAgICAgQ1s1XSA9IElDLmdldFByZXNzZWQoMyk7XHJcbiAgICAgICAgICAgIENbNl0gPSBJQy5nZXRQcmVzc2VkKDQpO1xyXG4gICAgICAgICAgICAvKkNbNF0gPSBJQy5nZXRQcmVzc2VkKDMpO1xyXG4gICAgICAgICAgICBDWzVdID0gSUMuZ2V0UHJlc3NlZCg0KTsqL1xyXG5cclxuICAgICAgICAgICAgb2JqZWN0IG8gPSBuZXcgb2JqZWN0KCk7XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG59XHJcbiIsInVzaW5nIFN5c3RlbTtcclxudXNpbmcgU3lzdGVtLkNvbGxlY3Rpb25zLkdlbmVyaWM7XHJcbnVzaW5nIFN5c3RlbS5MaW5xO1xyXG51c2luZyBTeXN0ZW0uVGV4dDtcclxudXNpbmcgU3lzdGVtLlRocmVhZGluZy5UYXNrcztcclxuXHJcbm5hbWVzcGFjZSBDaXJub0dhbWVcclxue1xyXG4gICAgY2xhc3MgSGVhbGluZ0l0ZW0gOiBDb2xsZWN0YWJsZUl0ZW1cclxuICAgIHtcclxuICAgICAgICBwdWJsaWMgZmxvYXQgaGVhbGluZ1Bvd2VyID0gMS41ZjtcclxuICAgICAgICBwdWJsaWMgSGVhbGluZ0l0ZW0oR2FtZSBnYW1lKSA6IGJhc2UoZ2FtZSwgXCJoZWFydFwiKVxyXG4gICAgICAgIHtcclxuICAgICAgICAgICAgZmxvYXRzID0gZmFsc2U7XHJcbiAgICAgICAgICAgIG1hZ25ldERpc3RhbmNlID0gMjA7XHJcbiAgICAgICAgICAgIHNvdW5kID0gXCJva1wiO1xyXG4gICAgICAgIH1cclxuICAgICAgICBwdWJsaWMgb3ZlcnJpZGUgYm9vbCBDYW5Db2xsZWN0KFBsYXllckNoYXJhY3RlciBwbGF5ZXIpXHJcbiAgICAgICAge1xyXG4gICAgICAgICAgICByZXR1cm4gcGxheWVyLkhQIDwgcGxheWVyLm1heEhQO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgcHVibGljIG92ZXJyaWRlIHZvaWQgb25Db2xsZWN0ZWQoUGxheWVyQ2hhcmFjdGVyIHBsYXllcilcclxuICAgICAgICB7XHJcbiAgICAgICAgICAgIHBsYXllci5IUCA9IE1hdGguTWluKHBsYXllci5IUCArIGhlYWxpbmdQb3dlciwgcGxheWVyLm1heEhQKTtcclxuICAgICAgICB9XHJcbiAgICB9XHJcbn1cclxuIiwidXNpbmcgU3lzdGVtO1xyXG51c2luZyBTeXN0ZW0uQ29sbGVjdGlvbnMuR2VuZXJpYztcclxudXNpbmcgU3lzdGVtLkxpbnE7XHJcbnVzaW5nIFN5c3RlbS5UZXh0O1xyXG51c2luZyBTeXN0ZW0uVGhyZWFkaW5nLlRhc2tzO1xyXG5cclxubmFtZXNwYWNlIENpcm5vR2FtZVxyXG57XHJcbiAgICBwdWJsaWMgY2xhc3MgS2V5SXRlbSA6IENvbGxlY3RhYmxlSXRlbVxyXG4gICAge1xyXG4gICAgICAgIHB1YmxpYyBLZXlJdGVtKEdhbWUgZ2FtZSkgOiBiYXNlKGdhbWUsIFwia2V5XCIpXHJcbiAgICAgICAge1xyXG4gICAgICAgICAgICBmbG9hdHMgPSBmYWxzZTtcclxuICAgICAgICAgICAgbWFnbmV0RGlzdGFuY2UgPSAyMDtcclxuICAgICAgICB9XHJcbiAgICAgICAgcHVibGljIG92ZXJyaWRlIGJvb2wgQ2FuQ29sbGVjdChQbGF5ZXJDaGFyYWN0ZXIgcGxheWVyKVxyXG4gICAgICAgIHtcclxuICAgICAgICAgICAgcmV0dXJuIHBsYXllci5rZXlzIDwgNTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIHB1YmxpYyBvdmVycmlkZSB2b2lkIG9uQ29sbGVjdGVkKFBsYXllckNoYXJhY3RlciBwbGF5ZXIpXHJcbiAgICAgICAge1xyXG4gICAgICAgICAgICBwbGF5ZXIua2V5cysrO1xyXG4gICAgICAgIH1cclxuICAgIH1cclxufVxyXG4iLCJ1c2luZyBTeXN0ZW07XHJcbnVzaW5nIFN5c3RlbS5Db2xsZWN0aW9ucy5HZW5lcmljO1xyXG51c2luZyBTeXN0ZW0uTGlucTtcclxudXNpbmcgU3lzdGVtLlRleHQ7XHJcbnVzaW5nIFN5c3RlbS5UaHJlYWRpbmcuVGFza3M7XHJcblxyXG5uYW1lc3BhY2UgQ2lybm9HYW1lXHJcbntcclxuICAgIHB1YmxpYyBjbGFzcyBQbGF0Zm9ybWVyRW50aXR5IDogQ29udHJvbGxhYmxlRW50aXR5XHJcbiAgICB7XHJcbiAgICAgICAgcHVibGljIGZsb2F0IGZyaWN0aW9uID0gMC41ZjtcclxuICAgICAgICBwdWJsaWMgYm9vbCBvbkdyb3VuZDtcclxuICAgICAgICBwdWJsaWMgYm9vbCBHcmF2aXR5RW5hYmxlZCA9IHRydWU7XHJcbiAgICAgICAgLy9wdWJsaWMgZmxvYXQgZ3Jhdml0eSA9IDEuNmY7XHJcbiAgICAgICAgLy9wdWJsaWMgZmxvYXQgZ3Jhdml0eSA9IDAuOWY7XHJcbiAgICAgICAgLy9wdWJsaWMgZmxvYXQgZ3Jhdml0eSA9IDAuMDE3NWY7XHJcbiAgICAgICAgcHVibGljIGZsb2F0IGdyYXZpdHkgPSAwLjAyZjtcclxuICAgICAgICBwdWJsaWMgZmxvYXQgbWF4RmFsbFNwZWVkID0gMi4wZjtcclxuICAgICAgICBwdWJsaWMgZmxvYXQgZmVldHBvc2l0aW9uID0gMjM7XHJcbiAgICAgICAgLy9wdWJsaWMgZmxvYXQgaGVhZHBvc2l0aW9uID0gNDtcclxuICAgICAgICBwdWJsaWMgZmxvYXQgaGVhZHBvc2l0aW9uID0gNztcclxuXHJcbiAgICAgICAgcHVibGljIFRpbGVEYXRhIEZsb29yO1xyXG4gICAgICAgIHB1YmxpYyBUaWxlRGF0YSBDZWlsaW5nO1xyXG5cclxuICAgICAgICBwdWJsaWMgVGlsZURhdGEgTGVmdFdhbGw7XHJcbiAgICAgICAgcHVibGljIFRpbGVEYXRhIFJpZ2h0V2FsbDtcclxuXHJcblxyXG4gICAgICAgIHB1YmxpYyBQbGF0Zm9ybWVyRW50aXR5KEdhbWUgZ2FtZSkgOiBiYXNlKGdhbWUpXHJcbiAgICAgICAge1xyXG5cclxuICAgICAgICB9XHJcbiAgICAgICAgcHVibGljIG92ZXJyaWRlIHZvaWQgVXBkYXRlKClcclxuICAgICAgICB7XHJcbiAgICAgICAgICAgIGJhc2UuVXBkYXRlKCk7XHJcbiAgICAgICAgICAgIGlmIChHcmF2aXR5RW5hYmxlZClcclxuICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgaWYgKFZzcGVlZCA8IG1heEZhbGxTcGVlZCAmJiBHcmF2aXR5RW5hYmxlZClcclxuICAgICAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgICAgICBWc3BlZWQgPSAoZmxvYXQpTWF0aC5NaW4oVnNwZWVkICsgZ3Jhdml0eSwgbWF4RmFsbFNwZWVkKTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAvKmlmICh5ID4gMCAmJiBWc3BlZWQ+PTApXHJcbiAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgIHkgPSAwO1xyXG4gICAgICAgICAgICAgICAgVnNwZWVkID0gMDtcclxuICAgICAgICAgICAgICAgIG9uR3JvdW5kID0gdHJ1ZTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBpZiAoeSA8IDApXHJcbiAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgIG9uR3JvdW5kID0gZmFsc2U7XHJcbiAgICAgICAgICAgIH0qL1xyXG4gICAgICAgICAgICBBcHBseUZyaWN0aW9uKCk7XHJcbiAgICAgICAgICAgIFVwZGF0ZVRlcnJhaW5Db2xsaXNpb24oKTtcclxuXHJcbiAgICAgICAgICAgIG9uR3JvdW5kID0gKEZsb29yICE9IG51bGwgJiYgVnNwZWVkID49IDApO1xyXG5cclxuICAgICAgICAgICAgaWYgKG9uR3JvdW5kKVxyXG4gICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICBmbG9hdCBZID0gRmxvb3IuR2V0VG9wKGdldENlbnRlcigpKSAtIGZlZXRwb3NpdGlvbjtcclxuICAgICAgICAgICAgICAgIC8qaWYgKHkgPCBZKVxyXG4gICAgICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgICAgIG9uR3JvdW5kID0gZmFsc2U7XHJcbiAgICAgICAgICAgICAgICAgICAgRmxvb3IgPSBudWxsO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgZWxzZSovXHJcbiAgICAgICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICAgICAgLy95ID0gKChGbG9vci5yb3cgKiBHYW1lLlRNLnRpbGVzaXplKSArIEdhbWUuVE0ucG9zaXRpb24uWSkgLSBmZWV0cG9zaXRpb247XHJcbiAgICAgICAgICAgICAgICAgICAgeSA9IFk7XHJcbiAgICAgICAgICAgICAgICAgICAgVnNwZWVkID0gMDtcclxuICAgICAgICAgICAgICAgICAgICBvbkdyb3VuZCA9IHRydWU7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgaWYgKENlaWxpbmcgIT0gbnVsbCAmJiBWc3BlZWQgPCAwLyogJiYgIUNlaWxpbmcucGxhdGZvcm0qLylcclxuICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgVnNwZWVkID0gMDtcclxuICAgICAgICAgICAgICAgIHkgPSAoKENlaWxpbmcucm93ICogR2FtZS5UTS50aWxlc2l6ZSkgKyBHYW1lLlRNLnBvc2l0aW9uLlkpICsgR2FtZS5UTS50aWxlc2l6ZSAtIGhlYWRwb3NpdGlvbjtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBpZiAoTGVmdFdhbGwgIT0gbnVsbClcclxuICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgSHNwZWVkID0gTWF0aC5NYXgoMCwgSHNwZWVkKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBpZiAoUmlnaHRXYWxsICE9IG51bGwpXHJcbiAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgIEhzcGVlZCA9IE1hdGguTWluKDAsIEhzcGVlZCk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcbiAgICAgICAgcHVibGljIHZvaWQgQXBwbHlGcmljdGlvbigpXHJcbiAgICAgICAge1xyXG4gICAgICAgICAgICBIc3BlZWQgPSAoZmxvYXQpTWF0aEhlbHBlci5EZWNlbGVyYXRlKEhzcGVlZCwgZnJpY3Rpb24pO1xyXG4gICAgICAgICAgICBpZiAoIUdyYXZpdHlFbmFibGVkKVxyXG4gICAgICAgICAgICAgICAgVnNwZWVkID0gKGZsb2F0KU1hdGhIZWxwZXIuRGVjZWxlcmF0ZShWc3BlZWQsIGZyaWN0aW9uKTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIHByb3RlY3RlZCBUaWxlRGF0YSBHZXRGbG9vcigpXHJcbiAgICAgICAge1xyXG4gICAgICAgICAgICBUaWxlRGF0YSBUID0gbnVsbDtcclxuICAgICAgICAgICAgZmxvYXQgVyA9IFdpZHRoIC8gMztcclxuICAgICAgICAgICAgZmxvYXQgWSA9IEhlaWdodDtcclxuICAgICAgICAgICAgaWYgKCEoVCAhPSBudWxsICYmIFQuZW5hYmxlZCAmJiBULnRvcFNvbGlkKSlcclxuICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgVCA9IEdhbWUuVE0uQ2hlY2tGb3JUaWxlKFZlY3RvcjIuQWRkKFBvc2l0aW9uLCBXaWR0aCAvIDIsIFkpKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBpZiAoIShUICE9IG51bGwgJiYgVC5lbmFibGVkICYmIFQudG9wU29saWQpKVxyXG4gICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICBUID0gR2FtZS5UTS5DaGVja0ZvclRpbGUoVmVjdG9yMi5BZGQoUG9zaXRpb24sIFcsIFkpKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBpZiAoIShUICE9IG51bGwgJiYgVC5lbmFibGVkICYmIFQudG9wU29saWQpKVxyXG4gICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICBUID0gR2FtZS5UTS5DaGVja0ZvclRpbGUoVmVjdG9yMi5BZGQoUG9zaXRpb24sIFdpZHRoIC0gVywgWSkpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIGlmICghKFQgIT0gbnVsbCAmJiBULmVuYWJsZWQgJiYgVC50b3BTb2xpZCkpXHJcbiAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgIFQgPSBudWxsO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIHJldHVybiBUO1xyXG4gICAgICAgIH1cclxuICAgICAgICBwcm90ZWN0ZWQgVGlsZURhdGEgR2V0Q2VpbGluZygpXHJcbiAgICAgICAge1xyXG4gICAgICAgICAgICBUaWxlRGF0YSBUID0gbnVsbDtcclxuICAgICAgICAgICAgZmxvYXQgVyA9IFdpZHRoIC8gMztcclxuICAgICAgICAgICAgLy9mbG9hdCBZID0gMTY7XHJcbiAgICAgICAgICAgIGZsb2F0IFkgPSAwICsgaGVhZHBvc2l0aW9uO1xyXG4gICAgICAgICAgICBpZiAoIShUICE9IG51bGwgJiYgVC5lbmFibGVkICYmIFQuYm90dG9tU29saWQpKVxyXG4gICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICBUID0gR2FtZS5UTS5DaGVja0ZvclRpbGUoVmVjdG9yMi5BZGQoUG9zaXRpb24sIFcsIFkpKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBpZiAoIShUICE9IG51bGwgJiYgVC5lbmFibGVkICYmIFQuYm90dG9tU29saWQpKVxyXG4gICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICBUID0gR2FtZS5UTS5DaGVja0ZvclRpbGUoVmVjdG9yMi5BZGQoUG9zaXRpb24sIFdpZHRoIC0gVywgWSkpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIGlmICghKFQgIT0gbnVsbCAmJiBULmVuYWJsZWQgJiYgVC5ib3R0b21Tb2xpZCkpXHJcbiAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgIFQgPSBudWxsO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIHJldHVybiBUO1xyXG4gICAgICAgIH1cclxuICAgICAgICBwcm90ZWN0ZWQgVGlsZURhdGEgQ2hlY2tXYWxsKGZsb2F0IFgpXHJcbiAgICAgICAge1xyXG4gICAgICAgICAgICBUaWxlRGF0YSBUID0gbnVsbDtcclxuICAgICAgICAgICAgLyppZiAoIShUICE9IG51bGwgJiYgVC5lbmFibGVkICYmICgoVC5sZWZ0U29saWQgJiYgWCA+IDApIHx8IChULnJpZ2h0U29saWQgJiYgWCA8IDApKSkpXHJcbiAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgIFQgPSBHYW1lLlRNLkNoZWNrRm9yVGlsZShQb3NpdGlvbiArIG5ldyBWZWN0b3IyKFgsIChIZWlnaHQgLyAyKS0yKSk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgaWYgKCEoVCAhPSBudWxsICYmIFQuZW5hYmxlZCAmJiAoKFQubGVmdFNvbGlkICYmIFggPiAwKSB8fCAoVC5yaWdodFNvbGlkICYmIFggPCAwKSkpKVxyXG4gICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICBUID0gR2FtZS5UTS5DaGVja0ZvclRpbGUoUG9zaXRpb24gKyBuZXcgVmVjdG9yMihYLCBIZWlnaHQtMikpO1xyXG4gICAgICAgICAgICAgICAgaWYgKFQgIT0gbnVsbCAmJiBULklzU2xvcGUpXHJcbiAgICAgICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICAgICAgVCA9IG51bGw7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgaWYgKCEoVCAhPSBudWxsICYmIFQuZW5hYmxlZCAmJiAoKFQubGVmdFNvbGlkICYmIFggPiAwKSB8fCAoVC5yaWdodFNvbGlkICYmIFggPCAwKSkpKVxyXG4gICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICBUID0gbnVsbDtcclxuICAgICAgICAgICAgfSovXHJcbiAgICAgICAgICAgIGlmICghSXNUaWxlT2JzdGFjbGUoVCwgWCkpXHJcbiAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgIFQgPSBHYW1lLlRNLkNoZWNrRm9yVGlsZShWZWN0b3IyLkFkZChQb3NpdGlvbiwgWCwgKEhlaWdodCAvIDIpIC0gMikpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIGlmICghSXNUaWxlT2JzdGFjbGUoVCwgWCkpXHJcbiAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgIFQgPSBHYW1lLlRNLkNoZWNrRm9yVGlsZShWZWN0b3IyLkFkZChQb3NpdGlvbiwgWCwgSGVpZ2h0IC0gMikpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIGlmICghSXNUaWxlT2JzdGFjbGUoVCwgWCkpXHJcbiAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgIFQgPSBudWxsO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIHJldHVybiBUO1xyXG4gICAgICAgIH1cclxuICAgICAgICBwcm90ZWN0ZWQgYm9vbCBJc1RpbGVPYnN0YWNsZShUaWxlRGF0YSBULCBmbG9hdCBYKVxyXG4gICAgICAgIHtcclxuICAgICAgICAgICAgaWYgKFQgIT0gbnVsbCAmJiBULmVuYWJsZWQgJiYgKChULmxlZnRTb2xpZCAmJiBYID4gMCkgfHwgKFQucmlnaHRTb2xpZCAmJiBYIDwgMCkpICYmIChGbG9vciA9PSBudWxsIHx8IFQucm93IDwgRmxvb3Iucm93KSlcclxuICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgZmxvYXQgWSA9IHkgKyBIZWlnaHQ7XHJcbiAgICAgICAgICAgICAgICAvL2lmIChULkdldEhpdGJveCgpLnkgPCBZLTI4KVxyXG4gICAgICAgICAgICAgICAgLy9pZiAoVC5HZXRIaXRib3goKS55IDwgWSAtIDgpXHJcbiAgICAgICAgICAgICAgICAvL2lmIChULkdldEhpdGJveCgpLnkgPCBZIC0gNClcclxuICAgICAgICAgICAgICAgIGlmIChULkdldEhpdGJveCgpLnkgPCBZIC0gMClcclxuICAgICAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgICAgICByZXR1cm4gIVQuSXNTbG9wZTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICByZXR1cm4gZmFsc2U7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHByb3RlY3RlZCB2b2lkIFVwZGF0ZVRlcnJhaW5Db2xsaXNpb24oKVxyXG4gICAgICAgIHtcclxuICAgICAgICAgICAgRmxvb3IgPSBHZXRGbG9vcigpO1xyXG4gICAgICAgICAgICBDZWlsaW5nID0gR2V0Q2VpbGluZygpO1xyXG4gICAgICAgICAgICBpZiAoRmxvb3IgIT0gbnVsbCAmJiBGbG9vci5TdGVwcGVkT24uQXM8ZHluYW1pYz4oKSlcclxuICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgRmxvb3IuU3RlcHBlZE9uKHRoaXMpO1xyXG4gICAgICAgICAgICB9XHJcblxyXG5cclxuICAgICAgICAgICAgaWYgKFZzcGVlZCA8IG1heEZhbGxTcGVlZCAmJiBHcmF2aXR5RW5hYmxlZClcclxuICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgVnNwZWVkID0gKGZsb2F0KU1hdGguTWluKFZzcGVlZCArIGdyYXZpdHksIG1heEZhbGxTcGVlZCk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgYm9vbCBzdHVjayA9IGZhbHNlO1xyXG4gICAgICAgICAgICBpZiAoRmxvb3IgIT0gbnVsbClcclxuICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgYm9vbCBjID0gdHJ1ZTtcclxuICAgICAgICAgICAgICAgIHdoaWxlIChjKVxyXG4gICAgICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgICAgIFRpbGVEYXRhIFQgPSBGbG9vci5HZXRUaWxlRGF0YSgwLCAtMSk7XHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKFQgIT0gbnVsbCAmJiBULmVuYWJsZWQgJiYgVC5zb2xpZClcclxuICAgICAgICAgICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIEZsb29yID0gVDtcclxuICAgICAgICAgICAgICAgICAgICAgICAgc3R1Y2sgPSB0cnVlO1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICBlbHNlXHJcbiAgICAgICAgICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBjID0gZmFsc2U7XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIHN0dWNrID0gZmFsc2U7XHJcbiAgICAgICAgICAgIG9uR3JvdW5kID0gZmFsc2U7XHJcbiAgICAgICAgICAgIGlmIChGbG9vciAhPSBudWxsICYmIFZzcGVlZCA+PSAwKVxyXG4gICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICAvL2Zsb2F0IFkgPSBGbG9vci5HZXRIaXRib3goKS50b3AgLSBIZWlnaHQ7XHJcbiAgICAgICAgICAgICAgICBmbG9hdCBZID0gRmxvb3IuR2V0VG9wKGdldENlbnRlcigpKSAtIEhlaWdodDtcclxuICAgICAgICAgICAgICAgIC8vaWYgKCFGbG9vci5wbGF0Zm9ybSB8fCB5IDw9IFkgKyBWc3BlZWQpXHJcbiAgICAgICAgICAgICAgICAvL2lmICghRmxvb3IucGxhdGZvcm0gfHwgeStWc3BlZWQ+PVkpXHJcbiAgICAgICAgICAgICAgICBpZiAoKCFGbG9vci5wbGF0Zm9ybSB8fCB5IDw9IFkgKyBWc3BlZWQpICYmIHkgKyAoVnNwZWVkICsgMTApID49IFkpXHJcbiAgICAgICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKFZzcGVlZCA+IDApXHJcbiAgICAgICAgICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBWc3BlZWQgPSAwO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBvbkdyb3VuZCA9IHRydWU7XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgIHkgPSBZO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIGlmIChIc3BlZWQgIT0gMClcclxuICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgVGlsZURhdGEgd2FsbCA9IEhzcGVlZCA+IDAgPyBSaWdodFdhbGwgOiBMZWZ0V2FsbDtcclxuICAgICAgICAgICAgICAgIGlmICh3YWxsICE9IG51bGwpXHJcbiAgICAgICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICAgICAgSHNwZWVkID0gMDtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBmbG9hdCBXID0gV2lkdGggLyAzO1xyXG4gICAgICAgICAgICBmbG9hdCBYID0gKGZsb2F0KU1hdGguQWJzKEhzcGVlZCk7XHJcbiAgICAgICAgICAgIGlmIChIc3BlZWQgPCAwKVxyXG4gICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICBYIC09IDIgLSBXO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIGVsc2VcclxuICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgWCArPSAoV2lkdGggLSBXKSArIDI7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgUmlnaHRXYWxsID0gQ2hlY2tXYWxsKFgpO1xyXG5cclxuICAgICAgICAgICAgWCA9IChmbG9hdCktTWF0aC5BYnMoSHNwZWVkKTtcclxuICAgICAgICAgICAgaWYgKEhzcGVlZCA8IDApXHJcbiAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgIFggLT0gMiAtIFc7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgZWxzZVxyXG4gICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICBYICs9IChXaWR0aCAtIFcpICsgMjtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBMZWZ0V2FsbCA9IENoZWNrV2FsbChYKTtcclxuICAgICAgICAgICAgaWYgKExlZnRXYWxsICE9IG51bGwgJiYgTGVmdFdhbGwgPT0gUmlnaHRXYWxsKVxyXG4gICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICBSZWN0YW5nbGUgUiA9IExlZnRXYWxsLkdldEhpdGJveCgpO1xyXG4gICAgICAgICAgICAgICAgVmVjdG9yMiBWID0gUi5DZW50ZXI7XHJcbiAgICAgICAgICAgICAgICBpZiAoKFYgLSBQb3NpdGlvbikuWCA+IDApXHJcbiAgICAgICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICAgICAgeCArPSAxO1xyXG4gICAgICAgICAgICAgICAgICAgIGlmIChIc3BlZWQgPCAwKVxyXG4gICAgICAgICAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgSHNwZWVkID0gMDtcclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICBlbHNlXHJcbiAgICAgICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICAgICAgeCAtPSAxO1xyXG4gICAgICAgICAgICAgICAgICAgIGlmIChIc3BlZWQgPiAwKVxyXG4gICAgICAgICAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgSHNwZWVkID0gMDtcclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgaWYgKHN0dWNrKVxyXG4gICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICBVcGRhdGVUZXJyYWluQ29sbGlzaW9uKCk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcbiAgICB9XHJcbn1cclxuIiwidXNpbmcgU3lzdGVtO1xyXG51c2luZyBTeXN0ZW0uQ29sbGVjdGlvbnMuR2VuZXJpYztcclxudXNpbmcgU3lzdGVtLkxpbnE7XHJcbnVzaW5nIFN5c3RlbS5UZXh0O1xyXG51c2luZyBTeXN0ZW0uVGhyZWFkaW5nLlRhc2tzO1xyXG5cclxubmFtZXNwYWNlIENpcm5vR2FtZVxyXG57XHJcbiAgICBwdWJsaWMgY2xhc3MgT3JiIDogQ29sbGVjdGFibGVJdGVtXHJcbiAgICB7XHJcbiAgICAgICAgcHVibGljIE9yYihHYW1lIGdhbWUpIDogYmFzZShnYW1lLCBcIm9yYlwiKVxyXG4gICAgICAgIHtcclxuICAgICAgICAgICAgLy9BbmkgPSBuZXcgQW5pbWF0aW9uKEFuaW1hdGlvbkxvYWRlci5HZXQoXCJpbWFnZXMvbWlzYy9vcmJcIikpO1xyXG4gICAgICAgICAgICBtYWduZXREaXN0YW5jZSA9IDU1O1xyXG4gICAgICAgIH1cclxuICAgICAgICBwdWJsaWMgb3ZlcnJpZGUgdm9pZCBvbkNvbGxlY3RlZChQbGF5ZXJDaGFyYWN0ZXIgcGxheWVyKVxyXG4gICAgICAgIHtcclxuICAgICAgICAgICAgLy90aHJvdyBuZXcgTm90SW1wbGVtZW50ZWRFeGNlcHRpb24oKTtcclxuICAgICAgICAgICAgdmFyIHRpbWUgPSAoMTAwMCkgKiAoMTMgLSBNYXRoLk1pbihHYW1lLmxldmVsLTEgKiAwLjE1Ziw3KSk7XHJcbiAgICAgICAgICAgIGlmIChHYW1lLnRpbWVSZW1haW5pbmcgPiAwKVxyXG4gICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICBHYW1lLnRpbWVSZW1haW5pbmcgKz0gdGltZTtcclxuICAgICAgICAgICAgICAgIEdhbWUudGltZVJlbWFpbmluZyA9IE1hdGguTWluKEdhbWUuZGVmYXVsdFRpbWVSZW1haW5pbmcsIEdhbWUudGltZVJlbWFpbmluZyk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgZWxzZVxyXG4gICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICBHYW1lLnRpbWVSZW1haW5pbmcgKz0gdGltZTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuICAgICAgICAvKnB1YmxpYyBvdmVycmlkZSB2b2lkIFVwZGF0ZSgpXHJcbiAgICAgICAge1xyXG4gICAgICAgICAgICBpZiAoR2FtZS5wbGF5ZXIuUG9zaXRpb24uRXN0aW1hdGVkRGlzdGFuY2UoUG9zaXRpb24pIDwgMzUpXHJcbiAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgIHZhciBQID0gR2FtZS5wbGF5ZXIuUG9zaXRpb24gLSBQb3NpdGlvbjtcclxuICAgICAgICAgICAgICAgIHZhciBsbiA9IFAuTGVuZ3RoO1xyXG4gICAgICAgICAgICAgICAgdmFyIHNwZCA9IDg7XHJcbiAgICAgICAgICAgICAgICBQID0gUC5Ob3JtYWxpemUoc3BkIC8gTWF0aC5NYXgoMSxsbikpO1xyXG4gICAgICAgICAgICAgICAgeCArPSBQLlg7XHJcbiAgICAgICAgICAgICAgICB5ICs9IFAuWTtcclxuICAgICAgICAgICAgICAgIGlmIChsbiA8PSBzcGQpXHJcbiAgICAgICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICAgICAgQWxpdmUgPSBmYWxzZTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBiYXNlLlVwZGF0ZSgpO1xyXG4gICAgICAgIH0qL1xyXG4gICAgfVxyXG59XHJcbiIsInVzaW5nIFN5c3RlbTtcclxudXNpbmcgU3lzdGVtLkNvbGxlY3Rpb25zLkdlbmVyaWM7XHJcbnVzaW5nIFN5c3RlbS5MaW5xO1xyXG51c2luZyBTeXN0ZW0uVGV4dDtcclxudXNpbmcgU3lzdGVtLlRocmVhZGluZy5UYXNrcztcclxuXHJcbm5hbWVzcGFjZSBDaXJub0dhbWVcclxue1xyXG4gICAgcHVibGljIGNsYXNzIFBvaW50SXRlbSA6IENvbGxlY3RhYmxlSXRlbVxyXG4gICAge1xyXG4gICAgICAgIHB1YmxpYyBQb2ludEl0ZW0oR2FtZSBnYW1lKSA6IGJhc2UoZ2FtZSwgXCJwb2ludFwiKVxyXG4gICAgICAgIHtcclxuICAgICAgICAgICAgZmxvYXRzID0gZmFsc2U7XHJcbiAgICAgICAgICAgIC8vbWFnbmV0RGlzdGFuY2UgPSAxMDA7XHJcbiAgICAgICAgICAgIG1hZ25ldERpc3RhbmNlID0gNzA7XHJcbiAgICAgICAgICAgIG1hZ25ldFNwZWVkICo9IDg7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHB1YmxpYyBvdmVycmlkZSB2b2lkIG9uQ29sbGVjdGVkKFBsYXllckNoYXJhY3RlciBwbGF5ZXIpXHJcbiAgICAgICAge1xyXG4gICAgICAgICAgICBwbGF5ZXIuc2NvcmUgKz0gNTtcclxuICAgICAgICB9XHJcbiAgICB9XHJcbn1cclxuIiwidXNpbmcgU3lzdGVtO1xyXG51c2luZyBTeXN0ZW0uQ29sbGVjdGlvbnMuR2VuZXJpYztcclxudXNpbmcgU3lzdGVtLkxpbnE7XHJcbnVzaW5nIFN5c3RlbS5UZXh0O1xyXG51c2luZyBTeXN0ZW0uVGhyZWFkaW5nLlRhc2tzO1xyXG5cclxubmFtZXNwYWNlIENpcm5vR2FtZVxyXG57XHJcbiAgICBwdWJsaWMgY2xhc3MgTVJHaG9zdHkgOiBQbGF0Zm9ybWVyRW50aXR5LCBJQ29tYmF0YW50LCBJSGFybWZ1bEVudGl0eVxyXG4gICAge1xyXG4gICAgICAgIHB1YmxpYyBzdHJpbmcgYW5pbWF0aW9uID0gXCI/Pz9cIjtcclxuXHJcbiAgICAgICAgcHVibGljIGludCBUZWFtIHsgZ2V0OyBzZXQ7IH1cclxuXHJcbiAgICAgICAgcHVibGljIGZsb2F0IEhQIHsgZ2V0OyBzZXQ7IH1cclxuXHJcbiAgICAgICAgcHVibGljIGludCBQb2ludHNGb3JLaWxsaW5nXHJcbiAgICAgICAge1xyXG4gICAgICAgICAgICBnZXRcclxuICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuIDE7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIHB1YmxpYyBmbG9hdCBUYXJnZXRQcmlvcml0eVxyXG4gICAgICAgIHtcclxuICAgICAgICAgICAgZ2V0XHJcbiAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgIHJldHVybiAwLjVmO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBwdWJsaWMgYm9vbCBJc0hhcm1mdWxcclxuICAgICAgICB7XHJcbiAgICAgICAgICAgIGdldFxyXG4gICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gdHJ1ZTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgcHVibGljIEVudGl0eSBBdHRhY2tlclxyXG4gICAgICAgIHtcclxuICAgICAgICAgICAgZ2V0XHJcbiAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgIHJldHVybiB0aGlzO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBwdWJsaWMgZmxvYXQgdG91Y2hEYW1hZ2VcclxuICAgICAgICB7XHJcbiAgICAgICAgICAgIGdldFxyXG4gICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gYXR0YWNrcG93ZXIqMS41ZjtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuICAgICAgICBwdWJsaWMgZmxvYXQgYXR0YWNrcG93ZXIgPSAxO1xyXG4gICAgICAgIHB1YmxpYyBmbG9hdCBkZWZlbnNlcG93ZXIgPSAxO1xyXG5cclxuICAgICAgICBwdWJsaWMgTVJHaG9zdHkoR2FtZSBnYW1lKSA6IGJhc2UoZ2FtZSlcclxuICAgICAgICB7XHJcbiAgICAgICAgICAgIENoYW5nZUFuaShcIlwiKTtcclxuICAgICAgICAgICAgQWRkQmVoYXZpb3IobmV3IEZsaWdodENvbnRyb2xzKHRoaXMpKTtcclxuICAgICAgICAgICAgQWRkQmVoYXZpb3IobmV3IFJhbmRvbUFJKHRoaXMpKTtcclxuICAgICAgICAgICAgYXR0YWNrcG93ZXIgPSAxICsgKEdhbWUubGV2ZWwgKiAwLjVmKTtcclxuICAgICAgICAgICAgZGVmZW5zZXBvd2VyID0gMSArIChHYW1lLmxldmVsICogMC41Zik7XHJcbiAgICAgICAgICAgIGlmIChHYW1lLnBsYXlpbmcpXHJcbiAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgIEFkZEJlaGF2aW9yPEFpbWVkU2hvb3Rlcj4oKTtcclxuICAgICAgICAgICAgICAgIEdldEJlaGF2aW9yPEFpbWVkU2hvb3Rlcj4oKS5hdHRhY2twb3dlciA9IGF0dGFja3Bvd2VyO1xyXG4gICAgICAgICAgICAgICAgR2V0QmVoYXZpb3I8QWltZWRTaG9vdGVyPigpLm1heHRpbWUgPSBNYXRoLk1heCg0ODAgLSAoR2FtZS5sZXZlbCAqIDEwKSwgMzgwKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBHZXRCZWhhdmlvcjxGbGlnaHRDb250cm9scz4oKS5tYXhTcGVlZCAqPSAwLjVmO1xyXG5cclxuICAgICAgICAgICAgR3Jhdml0eUVuYWJsZWQgPSBmYWxzZTtcclxuICAgICAgICAgICAgVGVhbSA9IDI7XHJcbiAgICAgICAgICAgIEhQID0gMjtcclxuICAgICAgICB9XHJcbiAgICAgICAgcHVibGljIG92ZXJyaWRlIHZvaWQgVXBkYXRlKClcclxuICAgICAgICB7XHJcbiAgICAgICAgICAgIGJhc2UuVXBkYXRlKCk7XHJcbiAgICAgICAgICAgIEFuaS5GbGlwcGVkID0gKEhzcGVlZCA8IDApO1xyXG4gICAgICAgICAgICBBbmkuSW1hZ2VTcGVlZCA9IChmbG9hdCkoKE1hdGguQWJzKEhzcGVlZCkgKyBNYXRoLkFicyhWc3BlZWQpKSAqIDAuMTI1KTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIHB1YmxpYyB2b2lkIENoYW5nZUFuaShzdHJpbmcgYW5pbWF0aW9uLCBib29sIHJlc2V0ID0gZmFsc2UpXHJcbiAgICAgICAge1xyXG4gICAgICAgICAgICBpZiAodGhpcy5hbmltYXRpb24gPT0gYW5pbWF0aW9uKVxyXG4gICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICByZXR1cm47XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgaWYgKEFuaSA9PSBudWxsKVxyXG4gICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICBBbmkgPSBuZXcgQW5pbWF0aW9uKEFuaW1hdGlvbkxvYWRlci5HZXQoXCJpbWFnZXMvZW5lbWllcy9tcmdob3N0XCIgKyBhbmltYXRpb24pKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBlbHNlXHJcbiAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgIEFuaS5DaGFuZ2VBbmltYXRpb24oQW5pbWF0aW9uTG9hZGVyLkdldChcImltYWdlcy9lbmVtaWVzL21yZ2hvc3RcIiArIGFuaW1hdGlvbiksIHJlc2V0KTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB0aGlzLmFuaW1hdGlvbiA9IGFuaW1hdGlvbjtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIHB1YmxpYyB2b2lkIG9uRGFtYWdlZChJSGFybWZ1bEVudGl0eSBzb3VyY2UsIGZsb2F0IGFtb3VudClcclxuICAgICAgICB7XHJcbiAgICAgICAgICAgIC8vdGhyb3cgbmV3IE5vdEltcGxlbWVudGVkRXhjZXB0aW9uKCk7XHJcbiAgICAgICAgICAgIC8vaWYgKCEoc291cmNlIGlzIE1SR2hvc3R5KSlcclxuICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgSFAgLT0gKGFtb3VudCAvIGRlZmVuc2Vwb3dlcik7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgLyplbHNlXHJcbiAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgIEhlbHBlci5Mb2coXCJnaG9zdHMgYXJlIGFsbGVyZ2ljIHRvIHRoZW1zZWx2ZXM/Pz9cIik7XHJcbiAgICAgICAgICAgIH0qL1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgcHVibGljIHZvaWQgb25EZWF0aChJSGFybWZ1bEVudGl0eSBzb3VyY2UpXHJcbiAgICAgICAge1xyXG4gICAgICAgICAgICAvL3Rocm93IG5ldyBOb3RJbXBsZW1lbnRlZEV4Y2VwdGlvbigpO1xyXG4gICAgICAgICAgICBBbGl2ZSA9IGZhbHNlO1xyXG4gICAgICAgICAgICBDb2xsZWN0YWJsZUl0ZW0gUCA9IG5ldyBQb2ludEl0ZW0oR2FtZSk7XHJcbiAgICAgICAgICAgIFAuUG9zaXRpb24uQ29weUZyb20oUG9zaXRpb24pO1xyXG4gICAgICAgICAgICBQLmNvbGxlY3Rpb25EZWxheSAvPSAyO1xyXG4gICAgICAgICAgICBHYW1lLkFkZEVudGl0eShQKTtcclxuICAgICAgICAgICAgaWYgKE1hdGguUmFuZG9tKCkgPCAwLjE1KVxyXG4gICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICBQID0gbmV3IEhlYWxpbmdJdGVtKEdhbWUpO1xyXG4gICAgICAgICAgICAgICAgUC5Qb3NpdGlvbi5Db3B5RnJvbShQb3NpdGlvbik7XHJcbiAgICAgICAgICAgICAgICBQLlZzcGVlZCA9IC0yO1xyXG4gICAgICAgICAgICAgICAgUC5jb2xsZWN0aW9uRGVsYXkgLz0gMjtcclxuICAgICAgICAgICAgICAgIHRoaXMuR2FtZS5BZGRFbnRpdHkoUCk7XHJcbiAgICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBwdWJsaWMgdm9pZCBvbktpbGwoSUNvbWJhdGFudCBjb21iYXRhbnQpXHJcbiAgICAgICAge1xyXG4gICAgICAgICAgICAvL3Rocm93IG5ldyBOb3RJbXBsZW1lbnRlZEV4Y2VwdGlvbigpO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgcHVibGljIGJvb2wgb250b3VjaERhbWFnZShJQ29tYmF0YW50IHRhcmdldClcclxuICAgICAgICB7XHJcbiAgICAgICAgICAgIC8vdGhyb3cgbmV3IE5vdEltcGxlbWVudGVkRXhjZXB0aW9uKCk7XHJcbiAgICAgICAgICAgIHJldHVybiB0cnVlO1xyXG4gICAgICAgIH1cclxuICAgIH1cclxufVxyXG4iLCJ1c2luZyBTeXN0ZW07XHJcbnVzaW5nIFN5c3RlbS5Db2xsZWN0aW9ucy5HZW5lcmljO1xyXG51c2luZyBTeXN0ZW0uTGlucTtcclxudXNpbmcgU3lzdGVtLlRleHQ7XHJcbnVzaW5nIFN5c3RlbS5UaHJlYWRpbmcuVGFza3M7XHJcblxyXG5uYW1lc3BhY2UgQ2lybm9HYW1lXHJcbntcclxuICAgIHB1YmxpYyBjbGFzcyBQbGF5ZXJDaGFyYWN0ZXIgOiBQbGF0Zm9ybWVyRW50aXR5LCBJQ29tYmF0YW50XHJcbiAgICB7XHJcbiAgICAgICAgcHVibGljIHN0cmluZyBhbmltYXRpb24gPSBcIj8/P1wiO1xyXG4gICAgICAgIHB1YmxpYyBpbnQgc2hvb3R0aW1lID0gMDtcclxuICAgICAgICBwdWJsaWMgc3RyaW5nIHByZWZpeCA9IFwiXCI7XHJcbiAgICAgICAgcHJpdmF0ZSBib29sIG5ld0lucHV0O1xyXG4gICAgICAgIHB1YmxpYyBpbnRbXSB0YXBUaW1lcjtcclxuICAgICAgICBwdWJsaWMgaW50IHNob290UmVjaGFyZ2UgPSAwO1xyXG4gICAgICAgIHB1YmxpYyBpbnQgdHVybnRpbWUgPSAwOy8vdGhlIGFtb3VudCBvZiB0aW1lIHRoZSB1c2VyIGhhcyBiZWVuIG1vdmluZyBub3JtYWxseS9zdGFuZGluZyBzdGlsbCwgaWYgbG9uZyBlbm91Z2ggdGhlIGNoYXJhY3RlciB3aWxsIHR1cm4gbm9ybWFsbHkuXHJcbiAgICAgICAgcHVibGljIGludCBzY29yZSA9IDA7XHJcbiAgICAgICAgcHVibGljIGludCBvcmJzID0gMDtcclxuICAgICAgICBwdWJsaWMgaW50IGtleXMgPSAwO1xyXG4gICAgICAgIHB1YmxpYyBmbG9hdCBlbmVyZ3lSZWNoYXJnZSA9IDAuMDIyZjtcclxuICAgICAgICBwdWJsaWMgZmxvYXQgbWF4RW5lcmd5ID0gNDtcclxuICAgICAgICBwdWJsaWMgZmxvYXQgZW5lcmd5ID0gNDtcclxuXHJcbiAgICAgICAgcHVibGljIGludCBUZWFtIHsgZ2V0OyBzZXQ7IH1cclxuXHJcbiAgICAgICAgcHVibGljIGZsb2F0IG1heEhQID0gMjA7XHJcbiAgICAgICAgcHVibGljIGZsb2F0IEhQIHsgZ2V0OyBzZXQ7IH1cclxuICAgICAgICBwdWJsaWMgZmxvYXQgcmVnZW5SYXRlID0gMWY7XHJcbiAgICAgICAgcHVibGljIFZlY3RvcjIgU3Bhd25Mb2NhdGlvbiA9IG5ldyBWZWN0b3IyKCk7XHJcbiAgICAgICAgcHVibGljIGludCBsaXZlcyA9IDM7XHJcbiAgICAgICAgcHVibGljIGludCBmcmFtZSA9IDA7XHJcblxyXG4gICAgICAgIHB1YmxpYyBmbG9hdCBkaWdwb3dlciA9IDEuMGY7XHJcbiAgICAgICAgcHVibGljIGZsb2F0IGF0dGFja3Bvd2VyID0gMWY7XHJcbiAgICAgICAgcHVibGljIGZsb2F0IGRlZmVuc2Vwb3dlciA9IDFmO1xyXG5cclxuICAgICAgICBwdWJsaWMgZmxvYXQgaW52aW5jaWJpbGl0eXRpbWUgPSAwO1xyXG4gICAgICAgIHB1YmxpYyBmbG9hdCBibG9ja3ByaWNlID0gNGY7XHJcblxyXG4gICAgICAgIHB1YmxpYyBmbG9hdCBpbnZpbmNpYmlsaXR5bW9kID0gMWY7XHJcblxyXG4gICAgICAgIHB1YmxpYyBpbnQgY3VycmVudHNob3QgPSAwO1xyXG4gICAgICAgIHB1YmxpYyBpbnQgc2hvdGRlbGF5ID0gNTtcclxuICAgICAgICBwdWJsaWMgaW50IGN1cnJlbnRzaG90ZGVsYXkgPSAwO1xyXG4gICAgICAgIHB1YmxpYyBpbnQgdG90YWxzaG90cyA9IDE7Ly9udW1iZXIgb2Ygc2hvdHMgcGVyIGNvbW1hbmRcclxuXHJcbiAgICAgICAgcHVibGljIEZsb2F0aW5nTWVzc2FnZSBNU0c7XHJcblxyXG5cclxuICAgICAgICBwdWJsaWMgaW50IFBvaW50c0ZvcktpbGxpbmdcclxuICAgICAgICB7XHJcbiAgICAgICAgICAgIGdldFxyXG4gICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gMzAwO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBwdWJsaWMgZmxvYXQgVGFyZ2V0UHJpb3JpdHlcclxuICAgICAgICB7XHJcbiAgICAgICAgICAgIGdldFxyXG4gICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gMC43ZjtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuICAgICAgICBwdWJsaWMgdm9pZCBNb3ZlVG9OZXdTcGF3bihWZWN0b3IyIE5ld1NwYXduTG9jYXRpb24pXHJcbiAgICAgICAge1xyXG4gICAgICAgICAgICBTcGF3bkxvY2F0aW9uLkNvcHlGcm9tKE5ld1NwYXduTG9jYXRpb24pO1xyXG4gICAgICAgICAgICBQb3NpdGlvbi5Db3B5RnJvbShTcGF3bkxvY2F0aW9uKTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIHB1YmxpYyB2b2lkIHNob290KClcclxuICAgICAgICB7XHJcbiAgICAgICAgICAgIGlmIChlbmVyZ3kgPCAxKVxyXG4gICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICByZXR1cm47XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgaWYgKHNob290dGltZSA8IDEpXHJcbiAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgIHByZWZpeCA9IFwic1wiO1xyXG4gICAgICAgICAgICAgICAgQ2hhbmdlQW5pKHByZWZpeCArIGFuaW1hdGlvbik7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgaWYgKHNob290UmVjaGFyZ2UgPD0gMClcclxuICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgY3VycmVudHNob3QgPSAxO1xyXG4gICAgICAgICAgICAgICAgRG9TaG90KCk7XHJcbiAgICAgICAgICAgICAgICBlbmVyZ3kgLT0gMTtcclxuICAgICAgICAgICAgICAgIC8vc2hvb3RSZWNoYXJnZSA9IDEyO1xyXG4gICAgICAgICAgICAgICAgXHJcbiAgICAgICAgICAgICAgICBjdXJyZW50c2hvdGRlbGF5ID0gMDtcclxuICAgICAgICAgICAgICAgIC8vc2hvb3RSZWNoYXJnZSA9IDIwO1xyXG4gICAgICAgICAgICAgICAgc2hvb3RSZWNoYXJnZSA9IDE2O1xyXG5cclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBzaG9vdHRpbWUgPSA1MDtcclxuICAgICAgICAgICAgLy9zaG9vdHRpbWUgPSA0MDtcclxuICAgICAgICAgICAgdHVybnRpbWUgPSAwO1xyXG5cclxuICAgICAgICB9XHJcbiAgICAgICAgdm9pZCBEb1Nob3QoKVxyXG4gICAgICAgIHtcclxuICAgICAgICAgICAgdmFyIFBCID0gbmV3IFBsYXllckJ1bGxldChHYW1lLCB0aGlzLCBcIkltYWdlcy9taXNjL2NyeXN0YWxcIik7XHJcbiAgICAgICAgICAgIFBCLkhzcGVlZCA9IEFuaS5GbGlwcGVkID8gLTIuNWYgOiAyLjVmO1xyXG4gICAgICAgICAgICBQQi54ID0geCArIChBbmkuRmxpcHBlZCA/IC00IDogMTIpO1xyXG4gICAgICAgICAgICBQQi55ID0geSArIDEwO1xyXG4gICAgICAgICAgICBpZiAoIUNvbnRyb2xsZXJbMF0gJiYgIUNvbnRyb2xsZXJbMV0pXHJcbiAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgIGlmIChDb250cm9sbGVyWzJdKVxyXG4gICAgICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgICAgIFBCLkhzcGVlZCAqPSAwLjhmO1xyXG4gICAgICAgICAgICAgICAgICAgIFBCLlZzcGVlZCA9IC0oZmxvYXQpTWF0aC5BYnMoUEIuSHNwZWVkKTtcclxuICAgICAgICAgICAgICAgICAgICBQQi5Ic3BlZWQgKj0gMC42ZjtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIGVsc2UgaWYgKENvbnRyb2xsZXJbM10pXHJcbiAgICAgICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICAgICAgUEIuSHNwZWVkICo9IDAuOGY7XHJcbiAgICAgICAgICAgICAgICAgICAgUEIuVnNwZWVkID0gKGZsb2F0KU1hdGguQWJzKFBCLkhzcGVlZCk7XHJcbiAgICAgICAgICAgICAgICAgICAgUEIuSHNwZWVkICo9IDAuNmY7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgZWxzZVxyXG4gICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICBpZiAoQ29udHJvbGxlclsyXSlcclxuICAgICAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgICAgICBQQi5Ic3BlZWQgKj0gMC45ZjtcclxuICAgICAgICAgICAgICAgICAgICBQQi5Wc3BlZWQgPSAtKGZsb2F0KU1hdGguQWJzKFBCLkhzcGVlZCAqIDAuNyk7XHJcblxyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgZWxzZSBpZiAoQ29udHJvbGxlclszXSlcclxuICAgICAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgICAgICBQQi5Ic3BlZWQgKj0gMC45ZjtcclxuICAgICAgICAgICAgICAgICAgICBQQi5Wc3BlZWQgPSAoZmxvYXQpTWF0aC5BYnMoUEIuSHNwZWVkICogMC43KTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBQQi54IC09IFBCLkhzcGVlZDtcclxuICAgICAgICAgICAgUEIueSAtPSBQQi5Wc3BlZWQ7XHJcbiAgICAgICAgICAgIFBCLmF0dGFja3N0ZXJyYWluID0gY3VycmVudHNob3Q9PTE7XHJcbiAgICAgICAgICAgIFBCLmRpZ3Bvd2VyID0gKGRpZ3Bvd2VyKSAqIDAuNjY2N2Y7XHJcbiAgICAgICAgICAgIFBCLnRvdWNoRGFtYWdlID0gYXR0YWNrcG93ZXIgLyAoKCh0b3RhbHNob3RzLTFmKS8yZikrMWYpO1xyXG4gICAgICAgICAgICBHYW1lLkFkZEVudGl0eShQQik7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHB1YmxpYyBQbGF5ZXJDaGFyYWN0ZXIoR2FtZSBnYW1lKSA6IGJhc2UoZ2FtZSlcclxuICAgICAgICB7XHJcbiAgICAgICAgICAgIENoYW5nZUFuaShcInN0YW5kXCIpO1xyXG4gICAgICAgICAgICBBZGRCZWhhdmlvcjxQbGF0Zm9ybWVyQ29udHJvbHM+KCk7XHJcbiAgICAgICAgICAgIC8vQWRkQmVoYXZpb3IobmV3IFBsYXRmb3JtZXJDb250cm9scyh0aGlzKSk7XHJcbiAgICAgICAgICAgIHRhcFRpbWVyID0gbmV3IGludFtDb250cm9sbGVyLkxlbmd0aF07XHJcbiAgICAgICAgICAgIFRlYW0gPSAwO1xyXG4gICAgICAgICAgICBIUCA9IG1heEhQO1xyXG4gICAgICAgICAgICBNU0cgPSBuZXcgRmxvYXRpbmdNZXNzYWdlKGdhbWUsIFwiXCIpO1xyXG4gICAgICAgICAgICBNU0cuVGV4dC5UZXh0Q29sb3IgPSBcIiNGRkZGRkZcIjtcclxuICAgICAgICAgICAgLy9NU0cuQ2hhbmdlVGV4dChcImhlbGxvIHdvcmxkXCIpO1xyXG4gICAgICAgICAgICBNU0cuYXV0b2tpbGwgPSBmYWxzZTtcclxuICAgICAgICAgICAgZ2FtZS5BZGRFbnRpdHkoTVNHKTtcclxuICAgICAgICAgICAgTVNHLlJlbW92ZWRPbkxldmVsRW5kID0gZmFsc2U7XHJcbiAgICAgICAgICAgIFJlbW92ZWRPbkxldmVsRW5kID0gZmFsc2U7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHB1YmxpYyBvdmVycmlkZSB2b2lkIFVwZGF0ZSgpXHJcbiAgICAgICAge1xyXG4gICAgICAgICAgICBiYXNlLlVwZGF0ZSgpO1xyXG4gICAgICAgICAgICBNU0cuUG9zaXRpb24uWCA9IFBvc2l0aW9uLlg7XHJcbiAgICAgICAgICAgIE1TRy5Qb3NpdGlvbi5ZID0gUG9zaXRpb24uWS0xMDtcclxuXHJcbiAgICAgICAgICAgIGlmIChzaG9vdHRpbWUgPiAwKVxyXG4gICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICBzaG9vdHRpbWUtLTtcclxuICAgICAgICAgICAgICAgIGlmIChzaG9vdHRpbWUgPCAxKVxyXG4gICAgICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgICAgIGlmIChcIlwiICsgYW5pbWF0aW9uWzBdID09IHByZWZpeClcclxuICAgICAgICAgICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIENoYW5nZUFuaShhbmltYXRpb24uU3Vic3RyaW5nKDEpKTtcclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgcHJlZml4ID0gXCJcIjtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBcclxuICAgICAgICAgICAgaWYgKG9uR3JvdW5kKVxyXG4gICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICBpZiAoSHNwZWVkICE9IDApXHJcbiAgICAgICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICAgICAgQ2hhbmdlQW5pKHByZWZpeCArIFwid2Fsa1wiKTtcclxuICAgICAgICAgICAgICAgICAgICAvLy9BbmkuRmxpcHBlZCA9IEhzcGVlZCA8IDA7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICBlbHNlXHJcbiAgICAgICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICAgICAgQ2hhbmdlQW5pKHByZWZpeCArIFwic3RhbmRcIik7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICBBbmkuSW1hZ2VTcGVlZCA9IChmbG9hdClNYXRoLkFicyhIc3BlZWQgKiAwLjEyNSk7XHJcbiAgICAgICAgICAgICAgICAvL0FuaS5JbWFnZVNwZWVkID0gQW5pLkZsaXBwZWQgPyBIc3BlZWQgKiAwLjEyNWYgOiAtSHNwZWVkICogMC4xMjVmO1xyXG4gICAgICAgICAgICAgICAgLy9BbmkuSW1hZ2VTcGVlZCA9IChBbmkuRmxpcHBlZCA/IC1Ic3BlZWQgOiBIc3BlZWQpICogMC4xMjVmO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIGVsc2VcclxuICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgQ2hhbmdlQW5pKHByZWZpeCArIFwianVtcFwiKTtcclxuICAgICAgICAgICAgICAgIC8vQW5pLkltYWdlU3BlZWQgPSAoZmxvYXQpTWF0aC5BYnMoVnNwZWVkICogMC4xMjUpO1xyXG4gICAgICAgICAgICAgICAgQW5pLkltYWdlU3BlZWQgPSAwLjE1ZiArIChmbG9hdCkoKE1hdGguQWJzKEhzcGVlZCkgKyBNYXRoLkFicyhWc3BlZWQpKSAqIDAuNyk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgaWYgKEFuaS5GbGlwcGVkICE9IEhzcGVlZCA8IDAgfHwgKEhzcGVlZCA9PSAwICYmIG9uR3JvdW5kKSlcclxuICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgdHVybnRpbWUrKztcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBlbHNlXHJcbiAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgIHR1cm50aW1lID0gMDtcclxuICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgLy9pZiAoTENvbnRyb2xsZXJbM10gIT0gQ29udHJvbGxlclszXSAmJiBDb250cm9sbGVyWzNdKVxyXG4gICAgICAgICAgICAvKmlmIChQcmVzc2VkKDMpIHx8IFByZXNzZWQoNCkgfHwgUHJlc3NlZCg1KSB8fCBQcmVzc2VkKDYpKVxyXG4gICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICBzaG9vdCgpO1xyXG4gICAgICAgICAgICB9Ki9cclxuICAgICAgICAgICAgaWYgKGN1cnJlbnRzaG90IDwgdG90YWxzaG90cylcclxuICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgY3VycmVudHNob3RkZWxheSsrO1xyXG4gICAgICAgICAgICAgICAgaWYgKGN1cnJlbnRzaG90ZGVsYXkgPj0gc2hvdGRlbGF5KVxyXG4gICAgICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgICAgIGN1cnJlbnRzaG90ZGVsYXkgPSAwO1xyXG4gICAgICAgICAgICAgICAgICAgIGN1cnJlbnRzaG90Kys7XHJcbiAgICAgICAgICAgICAgICAgICAgRG9TaG90KCk7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgZWxzZVxyXG4gICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICBpZiAoc2hvb3RSZWNoYXJnZSA+IDApXHJcbiAgICAgICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICAgICAgc2hvb3RSZWNoYXJnZS0tO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgZW5lcmd5ID0gTWF0aC5NaW4oZW5lcmd5ICsgZW5lcmd5UmVjaGFyZ2UsIG1heEVuZXJneSk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgaWYgKENvbnRyb2xsZXJbNF0pXHJcbiAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgIHR1cm50aW1lID0gMDtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAvL2lmIChQcmVzc2VkKDQpKVxyXG4gICAgICAgICAgICBpZiAoQ29udHJvbGxlcls0XSlcclxuICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgc2hvb3QoKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBpZiAoUHJlc3NlZCg2KSlcclxuICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgUGxhY2VCbG9jaygpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIFxyXG4gICAgICAgICAgICBVcGRhdGVDb250cm9sbGVyKCk7XHJcbiAgICAgICAgICAgIC8vaWYgKHR1cm50aW1lID4gMjIgJiYgSHNwZWVkICE9IDApXHJcbiAgICAgICAgICAgIC8vaWYgKHR1cm50aW1lID4gMTggJiYgSHNwZWVkICE9IDApXHJcbiAgICAgICAgICAgIC8vaWYgKHR1cm50aW1lID4gMTQgJiYgSHNwZWVkICE9IDApXHJcbiAgICAgICAgICAgIGlmICh0dXJudGltZSA+IDggJiYgSHNwZWVkICE9IDApXHJcbiAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgIEFuaS5GbGlwcGVkID0gSHNwZWVkIDwgMDtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBpZiAoaW52aW5jaWJpbGl0eXRpbWUgPiAwKVxyXG4gICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICAvL0FuaS5BbHBoYSA9IEFuaS5BbHBoYSA9PSAwID8gMSA6IDA7XHJcbiAgICAgICAgICAgICAgICBpZiAoKGZyYW1lICYgMSkgPiAwKVxyXG4gICAgICAgICAgICAgICAgICAgIFZpc2libGUgPSAhVmlzaWJsZTtcclxuICAgICAgICAgICAgICAgIGludmluY2liaWxpdHl0aW1lIC09IDE7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgZWxzZVxyXG4gICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICBWaXNpYmxlID0gdHJ1ZTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAvL2lmIChHYW1lLnRpbWVSZW1haW5pbmcgPiAwICYmIEhQPjAgJiYgaW52aW5jaWJpbGl0eXRpbWU8PTAgJiYgSFA8bWF4SFAgJiYgR2FtZS50aW1lUmVtYWluaW5nIDwgR2FtZS5kZWZhdWx0VGltZVJlbWFpbmluZylcclxuICAgICAgICAgICAgLyppZiAoR2FtZS50aW1lUmVtYWluaW5nID4gMCAmJiBIUCA+IDAgJiYgaW52aW5jaWJpbGl0eXRpbWUgPD0gMCAmJiBIUCA8IG1heEhQICYmIEdhbWUudGltZVJlbWFpbmluZyA8IEdhbWUubGFzdFN0YW5kKVxyXG4gICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICB2YXIgc3RhdGljTW9kID0gMC4wMDVmO1xyXG4gICAgICAgICAgICAgICAgdmFyIEhQUmF0ZSA9IDEtKEhQIC8gbWF4SFApO1xyXG4gICAgICAgICAgICAgICAgdmFyIFRpbWVSYXRlID0gMS0oR2FtZS50aW1lUmVtYWluaW5nIC8gR2FtZS5kZWZhdWx0VGltZVJlbWFpbmluZyk7XHJcbiAgICAgICAgICAgICAgICB2YXIgcmF0ZSA9IChIUFJhdGUgKiBUaW1lUmF0ZSAqIHJlZ2VuUmF0ZSk7XHJcbiAgICAgICAgICAgICAgICBIUCArPSAocmF0ZSAqIHN0YXRpY01vZCk7XHJcbiAgICAgICAgICAgICAgICBpZiAoSFAgPiBtYXhIUClcclxuICAgICAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgICAgICBIUCA9IG1heEhQO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9Ki9cclxuXHJcbiAgICAgICAgICAgIFxyXG4gICAgICAgICAgICBmcmFtZSsrO1xyXG4gICAgICAgIH1cclxuICAgICAgICBwdWJsaWMgdm9pZCBQbGFjZUJsb2NrKClcclxuICAgICAgICB7XHJcbiAgICAgICAgICAgIHZhciBwcmljZSA9IDEwMDAgKiBibG9ja3ByaWNlO1xyXG4gICAgICAgICAgICBpZiAoR2FtZS50aW1lUmVtYWluaW5nIDwgYmxvY2twcmljZSlcclxuICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIGZsb2F0IFcgPSBXaWR0aCAvIDM7XHJcbiAgICAgICAgICAgIGZsb2F0IFkgPSBIZWlnaHQ7XHJcbiAgICAgICAgICAgIHZhciBUID0gR2FtZS5UTS5DaGVja0ZvclRpbGUoVmVjdG9yMi5BZGQoUG9zaXRpb24sIFdpZHRoIC8gMiwgWSkpO1xyXG4gICAgICAgICAgICBpZiAoVCAhPSBudWxsICYmICghVC5lbmFibGVkIHx8ICFULnNvbGlkKSlcclxuICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgVC5zb2xpZCA9IHRydWU7XHJcbiAgICAgICAgICAgICAgICBULkJyZWFrYWJsZSA9IHRydWU7XHJcbiAgICAgICAgICAgICAgICBULmVuYWJsZWQgPSB0cnVlO1xyXG4gICAgICAgICAgICAgICAgVC50ZXh0dXJlID0gNDtcclxuICAgICAgICAgICAgICAgIFQuVXBkYXRlVGlsZSgpO1xyXG4gICAgICAgICAgICAgICAgVC5IUCA9IFQubWF4SFAgKiAyO1xyXG4gICAgICAgICAgICAgICAgR2FtZS50aW1lUmVtYWluaW5nIC09IHByaWNlO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHB1YmxpYyB2b2lkIENoYW5nZUFuaShzdHJpbmcgYW5pbWF0aW9uLCBib29sIHJlc2V0ID0gZmFsc2UpXHJcbiAgICAgICAge1xyXG4gICAgICAgICAgICBpZiAodGhpcy5hbmltYXRpb24gPT0gYW5pbWF0aW9uKVxyXG4gICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICByZXR1cm47XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgaWYgKEFuaSA9PSBudWxsKVxyXG4gICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICBBbmkgPSBuZXcgQW5pbWF0aW9uKEFuaW1hdGlvbkxvYWRlci5HZXQoXCJpbWFnZXMvY2lybm8vXCIgKyBhbmltYXRpb24pKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBlbHNlXHJcbiAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgIEFuaS5DaGFuZ2VBbmltYXRpb24oQW5pbWF0aW9uTG9hZGVyLkdldChcImltYWdlcy9jaXJuby9cIiArIGFuaW1hdGlvbiksIHJlc2V0KTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBpZiAodGhpcy5hbmltYXRpb24gIT0gXCJzdGFuZFwiKVxyXG4gICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICB0dXJudGltZSA9IDA7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgdGhpcy5hbmltYXRpb24gPSBhbmltYXRpb247XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHB1YmxpYyB2b2lkIFVwZGF0ZUNvbnRyb2xsZXIoKVxyXG4gICAgICAgIHtcclxuICAgICAgICAgICAgbmV3SW5wdXQgPSBmYWxzZTtcclxuICAgICAgICAgICAgaW50IGkgPSAwO1xyXG4gICAgICAgICAgICB3aGlsZSAoaSA8IENvbnRyb2xsZXIuTGVuZ3RoKVxyXG4gICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICB0YXBUaW1lcltpXSsrO1xyXG4gICAgICAgICAgICAgICAgaWYgKENvbnRyb2xsZXJbaV0gJiYgIUxDb250cm9sbGVyW2ldKVxyXG4gICAgICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgICAgIHRhcFRpbWVyW2ldID0gMDtcclxuICAgICAgICAgICAgICAgICAgICBuZXdJbnB1dCA9IHRydWU7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICBMQ29udHJvbGxlcltpXSA9IENvbnRyb2xsZXJbaV07XHJcbiAgICAgICAgICAgICAgICBpKys7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgLyppZiAoX2xBaW1BbmdsZSAhPSBfYWltQW5nbGUpXHJcbiAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgIG5ld0lucHV0ID0gdHJ1ZTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBfbEFpbUFuZ2xlID0gX2FpbUFuZ2xlOyovXHJcbiAgICAgICAgICAgIGlmIChuZXdJbnB1dClcclxuICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgLy9HZXRCZWhhdmlvcjxOZXR3b3JrU3luYz4oKS5TeW5jKCk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIHB1YmxpYyB2b2lkIG9uRGFtYWdlZChJSGFybWZ1bEVudGl0eSBzb3VyY2UsIGZsb2F0IGFtb3VudClcclxuICAgICAgICB7XHJcbiAgICAgICAgICAgIC8vdGhyb3cgbmV3IE5vdEltcGxlbWVudGVkRXhjZXB0aW9uKCk7XHJcbiAgICAgICAgICAgIGlmIChpbnZpbmNpYmlsaXR5dGltZSA8PSAwKVxyXG4gICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICBIUCAtPSAoYW1vdW50IC8gZGVmZW5zZXBvd2VyKTtcclxuICAgICAgICAgICAgICAgIGludmluY2liaWxpdHl0aW1lID0gNTAqaW52aW5jaWJpbGl0eW1vZDtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuICAgICAgICBwdWJsaWMgb3ZlcnJpZGUgdm9pZCBvblJlbW92ZSgpXHJcbiAgICAgICAge1xyXG4gICAgICAgICAgICBiYXNlLm9uUmVtb3ZlKCk7XHJcbiAgICAgICAgICAgIEdhbWUuUmVtb3ZlRW50aXR5KE1TRyk7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBwdWJsaWMgdm9pZCBvbkRlYXRoKElIYXJtZnVsRW50aXR5IHNvdXJjZSlcclxuICAgICAgICB7XHJcbiAgICAgICAgICAgIC8vdGhyb3cgbmV3IE5vdEltcGxlbWVudGVkRXhjZXB0aW9uKCk7XHJcbiAgICAgICAgICAgIGludmluY2liaWxpdHl0aW1lICo9IDNmO1xyXG5cclxuICAgICAgICAgICAgaWYgKEdhbWUucGxheWVyID09IHRoaXMpXHJcbiAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgIC8vaWYgKEdhbWUudGltZVJlbWFpbmluZyA+IDApXHJcbiAgICAgICAgICAgICAgICBpZiAoR2FtZS50aW1lUmVtYWluaW5nPj1HYW1lLmJhc2VMaWZlQ29zdClcclxuICAgICAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgICAgICBQb3NpdGlvbi5Db3B5RnJvbShTcGF3bkxvY2F0aW9uKTtcclxuICAgICAgICAgICAgICAgICAgICBIUCA9IG1heEhQO1xyXG4gICAgICAgICAgICAgICAgICAgIEdhbWUudGltZVJlbWFpbmluZyAtPSBHYW1lLmJhc2VMaWZlQ29zdDtcclxuICAgICAgICAgICAgICAgICAgICAvL0dhbWUudGltZVJlbWFpbmluZyAqPSAwLjg1ZjtcclxuICAgICAgICAgICAgICAgICAgICAvL0dhbWUudGltZVJlbWFpbmluZyAqPSAwLjY2NjdmO1xyXG4gICAgICAgICAgICAgICAgICAgIEdhbWUuY2FtZXJhLmluc3Rhd2FycCA9IHRydWU7XHJcbiAgICAgICAgICAgICAgICAgICAgR2FtZS5za2lwcmVuZGVyID0gdHJ1ZTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIGVsc2VcclxuICAgICAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgICAgICBHYW1lLkRvR2FtZU92ZXIoKTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBlbHNlXHJcbiAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgIFBvc2l0aW9uLkNvcHlGcm9tKFNwYXduTG9jYXRpb24pO1xyXG4gICAgICAgICAgICAgICAgSFAgPSBtYXhIUDtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgcHVibGljIHZvaWQgb25LaWxsKElDb21iYXRhbnQgY29tYmF0YW50KVxyXG4gICAgICAgIHtcclxuICAgICAgICAgICAgLy90aHJvdyBuZXcgTm90SW1wbGVtZW50ZWRFeGNlcHRpb24oKTtcclxuICAgICAgICB9XHJcbiAgICAgICAgcHVibGljIG92ZXJyaWRlIFJlY3RhbmdsZSBHZXRIaXRib3goKVxyXG4gICAgICAgIHtcclxuICAgICAgICAgICAgLy9yZXR1cm4gYmFzZS5HZXRIaXRib3goKTtcclxuICAgICAgICAgICAgaWYgKEFuaSAhPSBudWxsICYmIEFuaS5DdXJyZW50SW1hZ2UgIT0gbnVsbClcclxuICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgLyp2YXIgc2l6ZSA9IDQ7XHJcbiAgICAgICAgICAgICAgICB2YXIgVyA9IEFuaS5DdXJyZW50SW1hZ2UuV2lkdGggLyBzaXplO1xyXG4gICAgICAgICAgICAgICAgdmFyIEggPSBBbmkuQ3VycmVudEltYWdlLkhlaWdodCAvIHNpemU7XHJcbiAgICAgICAgICAgICAgICB2YXIgVzQgPSAoQW5pLkN1cnJlbnRJbWFnZS5XaWR0aCAvIDIpIC0gKFcgLyAyKTtcclxuICAgICAgICAgICAgICAgIHZhciBINCA9IChBbmkuQ3VycmVudEltYWdlLkhlaWdodCAvIDIpIC0gKEggLyAyKTtcclxuICAgICAgICAgICAgICAgIHJldHVybiBuZXcgUmVjdGFuZ2xlKEFuaS5YK1c0LCBBbmkuWStINCwgVywgSCk7Ki9cclxuICAgICAgICAgICAgICAgIHJldHVybiBuZXcgUmVjdGFuZ2xlKEFuaS5YICsgKEFuaS5DdXJyZW50SW1hZ2UuV2lkdGggLyAyZiksIEFuaS5ZICsgKEFuaS5DdXJyZW50SW1hZ2UuSGVpZ2h0IC8gMmYpLCAxLCAxKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICByZXR1cm4gbnVsbDtcclxuICAgICAgICB9XHJcbiAgICB9XHJcbn1cclxuIl0KfQo=
